{"version":3,"sources":["webpack://timetrex/./interface/html5/views/wizard/formula_builder_wizard/FormulaBuilderWizardController.js"],"names":["FormulaBuilderWizardController","BaseWizardController","options","_","defaults","el","formula_selection_pos","super","this","title","$","i18n","steps","current_step","render","find","hide","next_btn","back_btn","css","content_div","initCurrentStep","$this","empty","stepsWidgetDic","label","getLabel","text","append","form_item","Global","loadWidget","form_item_label","form_item_input_div","combobox","getComboBox","setSourceData","default_data","variables","unbind","bind","formula","selectionStart","onOptionSelect","formula_func","functions","getTextArea","getField","focus","e","target","val","getValue","pos","first_part","substring","sec_part","length","setValue","selectionEnd","stepsDataDic","current_step_ui","onDoneClick","saveCurrentStep","current_edit_record","new_formula_text","formulaInput","api","key_name","company_value1","onResult","result","isValid","remove","call_back","closeAndCallBack","details","getDetails","isArray","found","each","index","key","setErrorStyle","current_step_data","hasOwnProperty"],"mappings":"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","file":"wizard-formula_builder_wizard-FormulaBuilderWizardController.bundle.js?v=5ce0bdbda732ed82f475","sourcesContent":["export class FormulaBuilderWizardController extends BaseWizardController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '.wizard-bg',\n\n\t\t\tformula_selection_pos: 0\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\n\t\tthis.title = $.i18n._( 'Formula Builder' );\n\t\tthis.steps = 1;\n\t\tthis.current_step = 1;\n\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tsuper.render();\n\n\t\t$( this.el ).find( '.progress-bar' ).hide();\n\t\tthis.next_btn.hide();\n\t\tthis.back_btn.hide();\n\t\t$( this.el ).css( 'max-height', 500 );\n\t\tthis.content_div.css( 'top', 20 );\n\n\t\tthis.initCurrentStep();\n\t}\n\n\t//Create each page UI\n\tbuildCurrentStepUI() {\n\t\tvar $this = this;\n\t\tthis.content_div.empty();\n\n\t\tthis.stepsWidgetDic[this.current_step] = {};\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tvar label = this.getLabel();\n\t\t\t\tlabel.text( '' );\n\n\t\t\t\tthis.content_div.append( label );\n\n\t\t\t\tvar form_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tform_item.css( 'margin-left', 0 );\n\n\t\t\t\tvar combobox = this.getComboBox( 'custom_variables', true );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Custom Variables' ) + ': ' );\n\t\t\t\tform_item_input_div.append( combobox );\n\n\t\t\t\tcombobox.setSourceData( this.default_data.variables );\n\n\t\t\t\tcombobox.unbind( 'mousedown' ).bind( 'mousedown', function() {\n\t\t\t\t\t$this.formula_selection_pos = formula[0].selectionStart;\n\t\t\t\t} );\n\n\t\t\t\tcombobox.unbind( 'formItemChange' ).bind( 'formItemChange', onOptionSelect );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tform_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tform_item.css( 'margin-left', 0 );\n\n\t\t\t\tvar formula_func = this.getComboBox( 'formula_function', true );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Formula Functions' ) + ': ' );\n\t\t\t\tform_item_input_div.append( formula_func );\n\n\t\t\t\tformula_func.setSourceData( this.default_data.functions );\n\n\t\t\t\tformula_func.unbind( 'mousedown' ).bind( 'mousedown', function() {\n\t\t\t\t\t$this.formula_selection_pos = formula[0].selectionStart;\n\t\t\t\t} );\n\n\t\t\t\tformula_func.unbind( 'formItemChange' ).bind( 'formItemChange', onOptionSelect );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tform_item = $( Global.loadWidget( 'global/widgets/wizard_form_item/WizardFormItem.html' ) );\n\t\t\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\t\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\t\t\tform_item.css( 'margin-left', 0 );\n\n\t\t\t\tvar formula = this.getTextArea( 'formula', 730 );\n\n\t\t\t\tform_item_label.text( $.i18n._( 'Formula' ) + ': ' );\n\t\t\t\tform_item_input_div.append( formula );\n\n\t\t\t\tthis.content_div.append( form_item );\n\n\t\t\t\tthis.stepsWidgetDic[this.current_step][combobox.getField()] = combobox;\n\t\t\t\tthis.stepsWidgetDic[this.current_step][formula_func.getField()] = formula_func;\n\t\t\t\tthis.stepsWidgetDic[this.current_step][formula.getField()] = formula;\n\n\t\t\t\tformula.focus();\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tfunction onOptionSelect( e, target ) {\n\t\t\tvar val = target.getValue();\n\t\t\tif ( val === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar text = formula.getValue();\n\t\t\tvar pos = $this.formula_selection_pos;\n\t\t\tvar first_part = text.substring( 0, pos );\n\t\t\tvar sec_part = text.substring( pos, text.length );\n\t\t\tformula.setValue( first_part + val + sec_part );\n\t\t\tformula.focus();\n\t\t\tformula[0].selectionStart = pos + val.length;\n\t\t\tformula[0].selectionEnd = pos + val.length;\n\t\t}\n\t}\n\n\tbuildCurrentStepData() {\n\t\tvar $this = this;\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\n\t\tswitch ( this.current_step ) {\n\t\t\tcase 1:\n\t\t\t\tcurrent_step_ui.formula.setValue( this.default_data.formula );\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonDoneClick() {\n\t\tvar $this = this;\n\t\tsuper.onDoneClick();\n\t\tthis.saveCurrentStep();\n\n\t\tvar current_edit_record = this.default_data.current_edit_record;\n\t\tvar new_formula_text = this.stepsDataDic[1].formula;\n\n\t\tvar formulaInput = this.stepsWidgetDic[1].formula;\n\n\t\tif ( this.default_data.api.key_name === 'CompanyDeduction' ) {\n\t\t\tcurrent_edit_record.company_value1 = new_formula_text;\n\t\t} else {\n\t\t\tcurrent_edit_record.formula = new_formula_text;\n\t\t}\n\n\t\tthis.default_data.api['validate' + this.default_data.api.key_name]( current_edit_record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t$( $this.el ).remove();\n\t\t\t\t\t$this.call_back( new_formula_text );\n\t\t\t\t\tcloseAndCallBack();\n\t\t\t\t} else {\n\n\t\t\t\t\tvar details = result.getDetails();\n\n\t\t\t\t\tif ( !details ) {\n\t\t\t\t\t\tcloseAndCallBack();\n\t\t\t\t\t\t//Cannot set property 'formula' of null in /interface/html5/#!m=SavedReport&sm=PayStubSummaryReport&sid=4584 line 162\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( Global.isArray( details ) || typeof details === 'object' ) {\n\n\t\t\t\t\t\tvar found = false;\n\t\t\t\t\t\t$.each( details, function( index, val ) {\n\n\t\t\t\t\t\t\tfor ( var key in val ) {\n\n\t\t\t\t\t\t\t\tif ( $this.default_data.api.key_name === 'CompanyDeduction' ) {\n\t\t\t\t\t\t\t\t\tif ( key === 'company_value1' ) {\n\t\t\t\t\t\t\t\t\t\tformulaInput.setErrorStyle( val[key], true );\n\t\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif ( key === 'formula' ) {\n\t\t\t\t\t\t\t\t\t\tformulaInput.setErrorStyle( val[key], true );\n\t\t\t\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( !found ) {\n\t\t\t\t\t\t\t\tcloseAndCallBack();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tcloseAndCallBack();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction closeAndCallBack() {\n\t\t\t\t\t$( $this.el ).remove();\n\t\t\t\t\t$this.call_back( new_formula_text );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsaveCurrentStep() {\n\t\tthis.stepsDataDic[this.current_step] = {};\n\t\tvar current_step_data = this.stepsDataDic[this.current_step];\n\t\tvar current_step_ui = this.stepsWidgetDic[this.current_step];\n\t\tswitch ( this.current_step ) {\n\t\t\tdefault:\n\t\t\t\tfor ( var key in current_step_ui ) {\n\t\t\t\t\tif ( !current_step_ui.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent_step_data[key] = current_step_ui[key].getValue();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetDefaultDataToSteps() {\n\n\t\tif ( !this.default_data ) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n}"],"sourceRoot":""}