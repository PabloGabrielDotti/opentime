{"version":3,"sources":["webpack://timetrex/./interface/html5/views/company/geo_fence/GEOFenceViewController.js"],"names":["GEOFenceViewController","BaseViewController","options","_","defaults","el","type_array","company_api","drawControl","bounds","drawnItems","search_key_delay","start_coordinates","map_html_id","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APIGEOFence","APICompany","map","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","groups","label","id","exclude","ContextMenuIconName","export_excel","mass_edit","include","group","icon","Icons","onMapClick","onSaveAndContinueClick","geo_fences","Global","getProductEdition","edit_view","current_edit_record","getGridSelectIdArray","length","getSelectedItems","grid","getGridParam","IndexViewController","openEditView","remove","TTPromise","add","onAddClick","$this","wait","key","_selectedShape","edit_view_ui_dic","setValue","_map","_initLeafletMap","setView","column_filter","display_columns","len","i","name","buildEditViewUI","form_item_input","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_geo_fence_column1","edit_view_tab","find","edit_view_tabs","push","loadWidgetByName","FormItemType","TEXT_INPUT","TTextInput","field","width","addEditFieldToColumn","parent","COLOR_PICKER","TColorPicker","osm","neeed_save_punches_dic","layers","line_layers","circle_layers","directions_displays","info_panel_dic","geo_layers","undefined","Date","getTime","Debug","Text","html","Arr","APIGlobal","pre_login_data","map_provider","osmUrl","map_tile_url","registration_key","minZoom","maxZoom","attribution","noWrap","on","resolve","addLayer","startMapCoordinates","do_not_clear","edit","featureGroup","draw","polygon","shapeOptions","color","circle","polyline","rectangle","marker","circlemarker","addControl","e","removeAllLayers","layerType","new_layer","layer","editable","removable","editing","enable","is_changed","setEditMenu","validate","_initSearchBox","edit_layer","target","_layers","removeLayer","message","doNotValidate","onFormItemChange","getField","val","is_search_marker","setStyle","fillColor","bind","select","keyCode","first","click","parseInt","now","window","setTimeout","stop_suggestions","searchSuggest","css","url","map_geocode_url","encodeURIComponent","get","data","n","display_name","suggest","lat","lon","boundingbox","append","panTo","attr","address","bound00","bound01","bound10","bound11","fitBounds","padding","greenIcon","iconUrl","shadowUrl","iconSize","shadowSize","iconAnchor","shadowAnchor","popupAnchor","getCenter","draggable","is_marker","addTo","bindPopup","openPopup","fadeOut","fadeIn","user_generic_data_api","setUserGenericData","select_layout","onResult","result","isValid","result_data","getResult","TTUUID","isUUID","zero_id","not_exist_id","record","geo_circle","geo_type_id","map_level","_radius","center","getLatLng","lng","radius","_mRadius","getZoom","latlngs","getLatLngs","array","geo_polygon","getUserGenericData","filter_data","script","deleted","results","is_default","default_item","marker_connection_type","hasOwnProperty","widget","isSet","_drawCircle","_drawPolygon","centerMap","collectUIDataToCurrentEditRecord","setEditViewDataDone","parseFloat","stroke","fill","opacity","weight","geo_color","fillOpacity","is_edit","disable","getBounds","_onShapeUpdate","triangleCoords","item","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","form_item_type","APIUser","AWESOME_BOX","context_btn","addClass","grid_selected_length","removeClass","ignoreWarning","onSaveAndContinue","setPossibleDisplayColumns","buildDisplayColumnsByColumnModel","buildDisplayColumns","default_display_columns","unbind","next_select_item_id","getValue","ProgressBar","showOverlay","is_viewing","onViewClick","onEditClick","setNavigationArrowsEnabled"],"mappings":"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","file":"company-geo_fence-GEOFenceViewController.bundle.js?v=6aedd7d7548ebc576e57","sourcesContent":["// CSS\nimport 'leaflet/dist/leaflet.css';\nimport 'leaflet-draw/dist/leaflet.draw.css';\n\n// JS\nimport L from 'leaflet';\nimport 'leaflet-draw';\nimport '@/global/widgets/color-picker/TColorPicker';\n// Note: If markers are ever used in GeoFence Editor/Viewer, then see image fix in leaflet-timetrex. https://github.com/Leaflet/Leaflet/issues/4968\n\nexport class GEOFenceViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#geo_fence_view_container',\n\n\t\t\t// _required_files: {\n\t\t\t// \t15: ['leaflet-timetrex', 'TColorPicker']\n\t\t\t// },\n\t\t\ttype_array: null,\n\n\t\t\tcompany_api: null,\n\t\t\tdrawControl: null,\n\t\t\tbounds: null,\n\t\t\tdrawnItems: null,\n\t\t\tsearch_key_delay: 0,\n\t\t\tstart_coordinates: null,\n\t\t\tmap_html_id: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit() {\n\t\t//this._super('initialize' );\n\t\tthis.edit_view_tpl = 'GEOFenceEditView.html';\n\t\tthis.permission_id = 'geo_fence';\n\t\tthis.viewId = 'GEOFence';\n\t\tthis.script_name = 'GEOFenceView';\n\t\tthis.table_name_key = 'geo_fence';\n\t\tthis.context_menu_name = $.i18n._( 'GEO Fence' );\n\t\tthis.navigation_label = $.i18n._( 'GEO Fence' ) + ':';\n\t\tthis.api = TTAPI.APIGEOFence;\n\t\tthis.company_api = TTAPI.APICompany;\n\n\t\tif ( this.map ) {\n\t\t\tdelete ( this.map );\n\t\t}\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tmap: {\n\t\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\t\tid: this.viewId + 'Navigation'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [ContextMenuIconName.export_excel, ContextMenuIconName.mass_edit],\n\t\t\tinclude: [{\n\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\tid: ContextMenuIconName.map,\n\t\t\t\tgroup: 'map',\n\t\t\t\ticon: Icons.map\n\t\t\t}]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.map:\n\t\t\t\tthis.onMapClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonSaveAndContinueClick() {\n\t\tsuper.onSaveAndContinueClick();\n\t}\n\n\tonMapClick() {\n\t\t// only trigger map load in specific product editions.\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tvar geo_fences;\n\t\t\tif ( this.edit_view ) {\n\t\t\t\tgeo_fences = [this.current_edit_record];\n\t\t\t} else if ( this.getGridSelectIdArray().length > 0 ) {\n\t\t\t\tgeo_fences = this.getSelectedItems();\n\t\t\t} else {\n\t\t\t\tgeo_fences = this.grid.getGridParam( 'data' );\n\t\t\t}\n\t\t\t// Currently not doing pre-processing for geofences, handling this directly in MapViewController\n\t\t\t// var processed_data_for_map = TTMapLib.TTConvertMapData.processBasicFromGenericViewController(geo_fences);\n\t\t\tIndexViewController.openEditView( this, 'Map', geo_fences );\n\t\t}\n\t}\n\n\tonAddClick() {\n\t\t$( '.GEOFenceEditView' ).remove();\n\n\t\tTTPromise.add( 'init', 'init' );\n\t\tsuper.onAddClick();\n\n\t\tvar $this = this;\n\t\tTTPromise.wait( 'init', 'init', function() {\n\n\t\t\t// Clear the old record to prevent duplication on inserting an empty geofence record. See #2131\n\t\t\t$this._selectedShape = false;\n\t\t\t$this.current_edit_record = {};\n\t\t\tfor ( var key in $this.edit_view_ui_dic ) {\n\t\t\t\t$this.edit_view_ui_dic[key].setValue( '' );\n\t\t\t}\n\n\t\t\tif ( !$this._map ) {\n\t\t\t\t$this._initLeafletMap();\n\t\t\t}\n\n\t\t\t$this._map.setView( $this.start_coordinates, 10 );\n\t\t} );\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\t\tvar column_filter = {};\n\t\tcolumn_filter.is_owner = true;\n\t\tcolumn_filter.id = true;\n\t\tcolumn_filter.is_child = true;\n\t\tcolumn_filter.in_use = true;\n\t\tcolumn_filter.first_name = true;\n\t\tcolumn_filter.last_name = true;\n\t\tcolumn_filter.geo_circle = true;\n\t\tcolumn_filter.geo_color = true;\n\t\tcolumn_filter.geo_polygon = true;\n\t\tcolumn_filter.geo_type_id = true;\n\n\t\t// Error: Unable to get property 'getGridParam' of undefined or null reference\n\t\tvar display_columns = [];\n\t\tif ( this.grid ) {\n\t\t\tdisplay_columns = this.grid.getGridParam( 'colModel' );\n\t\t}\n\t\t//Fixed possible exception -- Error: Unable to get property 'length' of undefined or null reference in /interface/html5/views/BaseViewController.js?v=7.4.3-20140924-090129 line 5031\n\t\tif ( display_columns ) {\n\t\t\tvar len = display_columns.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar column_info = display_columns[i];\n\t\t\t\tcolumn_filter[column_info.name] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn column_filter;\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_geo_fence': { 'label': $.i18n._( 'GEO Fence' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIGEOFence,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_geo_fence',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_geo_fence = this.edit_view_tab.find( '#tab_geo_fence' );\n\n\t\tvar tab_geo_fence_column1 = tab_geo_fence.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_geo_fence_column1 );\n\n\t\t// Name\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_geo_fence_column1 );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Color\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COLOR_PICKER );\n\t\tform_item_input.TColorPicker( { field: 'geo_color' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Color' ), form_item_input, tab_geo_fence_column1 );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_geo_fence_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tthis._initLeafletMap();\n\t}\n\n\t_initLeafletMap() {\n\t\tthis.neeed_save_punches_dic = {};\n\t\tthis.layers = [];\n\t\tthis.line_layers = [];\n\t\tthis.circle_layers = [];\n\t\tthis.directions_displays = [];\n\t\tthis.info_panel_dic = {};\n\t\tthis.geo_layers = [];\n\t\t//init map\n\n\t\tif ( !this._map || this._map == undefined || $( '#tab_geo_fence:visible #map_container div.google-map' )[0] == undefined ) {\n\t\t\t//Avoid map is already initialized js exception by dynamically attaching the map element.\n\t\t\t// if (this.map_html_id && $('#' + this.map_html_id).length > 0) {\n\t\t\t// \t$( '#tab_geo_fence:visible #map_container #' + this.map_html_id ).off();\n\t\t\t// \tDebug.Text('Removed Lmap id: ' + this.map_html_id, 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10);\n\t\t\t// }\n\n\t\t\tthis.map_html_id = 'map_' + ( new Date() ).getTime();\n\t\t\tDebug.Text( 'New Lmap id: ' + this.map_html_id, 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10 );\n\n\t\t\t//append the map element, use then to ensure it's complete before initiallizing the map.\n\t\t\t$( '#tab_geo_fence:visible #map_container' ).html( '<div id=\"' + this.map_html_id + '\" class=\"google-map\"></div>' );\n\t\t\tthis._map = L.map( this.map_html_id );\n\n\t\t\tDebug.Arr( this._map, 'Lmap var', 'GEOFenceViewController.js', 'GEOFenceViewController', '_initLeafletMap', 10 );\n\t\t}\n\n\t\tvar osm;\n\t\tif ( APIGlobal.pre_login_data.map_provider == 'timetrex' ) {\n\t\t\tvar osmUrl = APIGlobal.pre_login_data.map_tile_url + '/{z}/{x}/{y}.png?tt_key=' + APIGlobal.pre_login_data.registration_key;\n\t\t\tvar osmAttrib = 'Map data by ©<a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>.';\n\t\t\tosm = new L.TileLayer( osmUrl, { minZoom: 3, maxZoom: 18, attribution: osmAttrib, noWrap: true } );\n\t\t} else {\n\t\t\tosm = L.tileLayer.provider( APIGlobal.pre_login_data.map_provider );\n\t\t}\n\n\t\tosm.on( 'load', function() {\n\t\t\tTTPromise.resolve( 'Map', 'render' );\n\t\t} );\n\n\t\tthis._map.addLayer( osm );\n\n\t\tthis.start_coordinates = this.startMapCoordinates();\n\n\t\tthis._map.setView( this.start_coordinates, 10 );\n\n\t\tthis.drawnItems = new L.FeatureGroup();\n\t\tthis.drawnItems.do_not_clear = true;\n\t\tthis._map.addLayer( this.drawnItems );\n\n\t\tthis.drawControl = new L.Control.Draw( {\n\t\t\tedit: {\n\t\t\t\tfeatureGroup: this.drawnItems,\n\t\t\t\tedit: false,\n\t\t\t\tremove: false\n\t\t\t},\n\t\t\tdraw: {\n\t\t\t\tpolygon: {\n\t\t\t\t\tshapeOptions: { color: '#0F820F' }\n\t\t\t\t},\n\t\t\t\tcircle: {\n\t\t\t\t\tshapeOptions: { color: '#0F820F' }\n\t\t\t\t},\n\t\t\t\tpolyline: false,\n\t\t\t\trectangle: false,\n\t\t\t\tmarker: false,\n\t\t\t\tcirclemarker: false\n\t\t\t}\n\t\t} );\n\n\t\tthis._map.addControl( this.drawControl );\n\n\t\tvar $this = this;\n\t\tthis._map.on( L.Draw.Event.DRAWSTART, function( e ) {\n\t\t\t$this.removeAllLayers();\n\t\t} );\n\n\t\tthis._map.on( L.Draw.Event.CREATED, function( e ) {\n\t\t\tvar type = e.layerType,\n\t\t\t\tnew_layer = e.layer;\n\t\t\tnew_layer.editable = true;\n\t\t\tnew_layer.removable = true;\n\n\t\t\t$this.removeAllLayers();\n\t\t\t$this._selectedShape = new_layer;\n\t\t\t$this.drawnItems.addLayer( new_layer );\n\t\t\tnew_layer.editing.enable();\n\t\t\t$this.is_changed = true;\n\t\t\t$this.setEditMenu();\n\t\t\t$this.validate();\n\t\t} );\n\n\t\tthis._initSearchBox();\n\t}\n\n\t_onShapeUpdate( e ) {\n\t\tvar edit_layer = e.target;\n\t\tedit_layer.editable = true;\n\t\tedit_layer.removable = true;\n\t\tthis._selectedShape = edit_layer;\n\t\tthis.drawnItems.addLayer( edit_layer );\n\t\tedit_layer.editing.enable();\n\t\tthis.is_changed = true;\n\t\tthis.setEditMenu();\n\t}\n\n\tremoveAllLayers() {\n\t\tfor ( var layer in this.drawnItems._layers ) {\n\t\t\tif ( this.drawnItems._layers[layer].removable == true ) {\n\t\t\t\ttry { //try needed for intermittent low-level non-blocking error when users navigate faster than leaflet can draw\n\t\t\t\t\tthis.drawnItems.removeLayer( this.drawnItems._layers[layer] );\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\tDebug.Text( e.message, 'GeoFenceController.js', 'GeoFenceController', 'GeoFenceController', 10 );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tsuper.onFormItemChange( target, doNotValidate );\n\t\tvar key = target.getField();\n\t\tif ( key == 'geo_color' ) {\n\t\t\tthis.drawControl.options.draw.polygon.shapeOptions.color = this.edit_view_ui_dic[key].val();\n\t\t\tthis.drawControl.options.draw.circle.shapeOptions.color = this.edit_view_ui_dic[key].val();\n\n\t\t\tfor ( var layer in this.drawnItems._layers ) {\n\t\t\t\tif ( this.drawnItems._layers[layer].is_search_marker === undefined ) { // Only change the colours for layers that are not a search marker. Otherwise this will result in an error when changing colours after a search.\n\t\t\t\t\tthis.drawnItems._layers[layer].setStyle( {\n\t\t\t\t\t\tfillColor: this.edit_view_ui_dic[key].val(),\n\t\t\t\t\t\tcolor: this.edit_view_ui_dic[key].val()\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t_initSearchBox() {\n\t\tvar $this = this;\n\t\t$( '#pac-input' ).bind( 'focus', function( e ) {\n\t\t\t$( this ).select();\n\t\t} );\n\n\t\t$( '#pac-input' ).bind( 'keyup', function( e ) {\n\t\t\tif ( e.keyCode == 13 ) {\n\t\t\t\t$( '#suggestion-box div' ).first().click();\n\t\t\t} else {\n\t\t\t\t$this.search_key_delay = parseInt( Date.now() );\n\t\t\t\twindow.setTimeout( function() {\n\t\t\t\t\tif ( parseInt( Date.now() ) - $this.search_key_delay >= 250 ) {\n\t\t\t\t\t\t$this.stop_suggestions = false;\n\t\t\t\t\t\t$this.searchSuggest();\n\t\t\t\t\t}\n\t\t\t\t}, 300 );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsearchSuggest() {\n\t\t$( '#suggestion-box' ).html( '' );\n\t\tvar $this = this;\n\t\tif ( $( '#pac-input' ).val().length >= 3 ) {\n\t\t\t$( '#pac-input' ).css( 'border', '1px dotted green' );\n\n\t\t\tvar url = APIGlobal.pre_login_data.map_geocode_url + '?q=' + encodeURIComponent( $( '#pac-input' ).val() ) + '&format=json&tt_key=' + APIGlobal.pre_login_data.registration_key;\n\n\t\t\t$.get( url, function( data ) {\n\t\t\t\t$( '#pac-input' ).css( 'border', 'none' );\n\t\t\t\tif ( $this.stop_suggestions == false ) {\n\t\t\t\t\t$( '#suggestion-box' ).html( '' );\n\t\t\t\t\tfor ( var n in data ) {\n\t\t\t\t\t\tvar name = data[n].display_name;\n\t\t\t\t\t\tvar lat = data[n].lat;\n\t\t\t\t\t\tvar lng = data[n].lon;\n\t\t\t\t\t\tvar suggest = '<div class=\\'map-suggest\\' lat=\\'' + lat + '\\' lng=\\'' + lng + '\\' bound0=\\'' + data[n].boundingbox[0] + '\\' bound1=\\'' + data[n].boundingbox[1] + '\\' bound2=\\'' + data[n].boundingbox[2] + '\\' bound3=\\'' + data[n].boundingbox[3] + '\\' style=\\'display:block;position:relative;cursor:pointer;padding:7px;background:white;\\'>' + name + '</div>';\n\t\t\t\t\t\t$( '#suggestion-box' ).append( suggest );\n\t\t\t\t\t\t$( '#suggestion-box .map-suggest' ).bind( 'click', function() {\n\t\t\t\t\t\t\t$this._map.panTo( new L.LatLng( $( this ).attr( 'lat' ), $( this ).attr( 'lng' ) ) );\n\t\t\t\t\t\t\tvar address = $( this ).html();\n\t\t\t\t\t\t\tvar bound00 = $( this ).attr( 'bound0' );\n\t\t\t\t\t\t\tvar bound01 = $( this ).attr( 'bound2' );\n\t\t\t\t\t\t\tvar bound10 = $( this ).attr( 'bound1' );\n\t\t\t\t\t\t\tvar bound11 = $( this ).attr( 'bound3' );\n\n\t\t\t\t\t\t\t$( '#pac-input' ).val( address );\n\t\t\t\t\t\t\tvar bounds = new L.latLngBounds( [bound00, bound01], [bound10, bound11] );\n\t\t\t\t\t\t\t$this._map.fitBounds( bounds, { padding: [20, 20] } );\n\t\t\t\t\t\t\t//$this._map.panTo(bounds.getCenter());\n\n\t\t\t\t\t\t\tvar greenIcon = L.icon( {\n\t\t\t\t\t\t\t\ticonUrl: 'framework/leaflet/images/marker-icon-red.png',\n\t\t\t\t\t\t\t\tshadowUrl: 'framework/leaflet/images/marker-shadow.png',\n\n\t\t\t\t\t\t\t\ticonSize: [25, 41], // size of the icon\n\t\t\t\t\t\t\t\tshadowSize: [41, 41], // size of the shadow\n\t\t\t\t\t\t\t\ticonAnchor: [0, 0], // point of the icon which will correspond to marker's location\n\t\t\t\t\t\t\t\tshadowAnchor: [0, 0],  // the same for the shadow\n\t\t\t\t\t\t\t\tpopupAnchor: [12, 0] // point from which the popup should open relative to the iconAnchor\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\tfor ( var layer in $this.drawnItems._layers ) {\n\t\t\t\t\t\t\t\tif ( $this.drawnItems._layers[layer].is_search_marker != undefined && $this.drawnItems._layers[layer].is_search_marker == true ) {\n\t\t\t\t\t\t\t\t\t$this.drawnItems.removeLayer( $this.drawnItems._layers[layer] );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar marker = L.marker( bounds.getCenter(), {\n\t\t\t\t\t\t\t\tdraggable: false,\n\t\t\t\t\t\t\t\ticon: greenIcon\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tmarker.is_marker = true;\n\t\t\t\t\t\t\tmarker.is_search_marker = true;\n\n\t\t\t\t\t\t\tmarker.addTo( $this.drawnItems ).bindPopup( address ).openPopup();\n\n\t\t\t\t\t\t\t$( '#suggestion-box' ).html( '' );\n\t\t\t\t\t\t\t$( '#suggestion-box' ).fadeOut( 'fast' );\n\t\t\t\t\t\t\t$this.stop_suggestions = true;\n\t\t\t\t\t\t} );\n\t\t\t\t\t\t$( '#suggestion-box' ).fadeIn( 'fast' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tsaveLayout() {\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( this.select_layout, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t$this.select_layout.id = result_data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tcenterMap() {\n\t\tthis._map.panTo( this.start_coordinates );\n\t}\n\n\tuniformVariable( record ) {\n\t\trecord.geo_circle = false;\n\t\trecord.geo_type_id = 10; // default to circle prevent \"Incorrect GEO type\" exception triggered.\n\t\trecord.map_level = false;\n\t\tif ( this._selectedShape && this._selectedShape._radius != undefined ) {\n\t\t\trecord.geo_circle = {};\n\t\t\trecord.geo_circle.center = [this._selectedShape.getLatLng().lat, this._selectedShape.getLatLng().lng];\n\t\t\trecord.geo_circle.radius = this._selectedShape._mRadius;\n\t\t\trecord.geo_type_id = 20;\n\t\t\trecord.map_level = this._map.getZoom();\n\t\t} else if ( this._selectedShape ) {\n\t\t\tvar latlngs = this._selectedShape.getLatLngs()[0]; //getPaths().getAt( 0 ).getArray();\n\t\t\tvar array = [];\n\t\t\tfor ( var i = 0; i < latlngs.length; i++ ) {\n\t\t\t\tarray.push( [latlngs[i].lat, latlngs[i].lng] );\n\t\t\t}\n\t\t\trecord.geo_polygon = array;\n\t\t\trecord.geo_type_id = 10;\n\t\t\trecord.map_level = this._map.getZoom();\n\t\t}\n\t\treturn record;\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.getUserGenericData( { filter_data: { script: 'MapView', deleted: false } }, {\n\t\t\tonResult: function( results ) {\n\t\t\t\tvar result_data = results.getResult();\n\t\t\t\tif ( result_data && result_data.length > 0 ) {\n\t\t\t\t\t$this.select_layout = result_data[0];\n\t\t\t\t} else {\n\t\t\t\t\t$this.select_layout = {\n\t\t\t\t\t\tscript: 'MapView',\n\t\t\t\t\t\tis_default: false,\n\t\t\t\t\t\tname: Global.default_item,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tmarker_connection_type: 'LINE'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\t//Set current edit record data to all widgets\n\t\t\t\t//$this._selectedShape && $this._deleteSelectShape();\n\t\t\t\tfor ( var key in $this.current_edit_record ) {\n\t\t\t\t\tif ( !$this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar widget = $this.edit_view_ui_dic[key];\n\t\t\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\t\t\tswitch ( key ) {\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\twidget.setValue( $this.current_edit_record[key] );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( $this.drawnItems ) {\n\t\t\t\t\t$this.removeAllLayers();\n\t\t\t\t}\n\n\t\t\t\t$this.bounds = new L.LatLngBounds();\n\t\t\t\tif ( $this.current_edit_record.geo_type_id == 20 && $this.current_edit_record.geo_circle ) {\n\t\t\t\t\t$this._drawCircle( $this.current_edit_record.geo_circle );\n\t\t\t\t} else if ( $this.current_edit_record.geo_type_id == 10 && $this.current_edit_record.geo_polygon ) {\n\t\t\t\t\t$this._drawPolygon( $this.current_edit_record.geo_polygon );\n\t\t\t\t} else {\n\t\t\t\t\t$this.centerMap();\n\t\t\t\t}\n\n\t\t\t\t$this.current_edit_record.map_level = $this._map.getZoom();\n\n\t\t\t\t$this.collectUIDataToCurrentEditRecord();\n\t\t\t\t$this.setEditViewDataDone();\n\t\t\t}\n\t\t} );\n\t}\n\n\t_drawCircle( geo_circle ) {\n\t\tDebug.Text( 'drawing circle', 'GEOFenceViewController.js', 'GEOFenceViewController', '_drawCircle', 10 );\n\t\tvar layer = new L.Circle( [parseFloat( geo_circle.center[0] ), parseFloat( geo_circle.center[1] )], parseFloat( geo_circle.radius ), {\n\t\t\tstroke: true,\n\t\t\tfill: true,\n\t\t\topacity: 0.8,\n\t\t\tweight: 2,\n\t\t\tcolor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F',\n\t\t\tfillOpacity: 0.25,\n\t\t\tfillColor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F'\n\t\t} );\n\t\tlayer.removable = true;\n\t\tlayer.addTo( this.drawnItems );//.bindPopup(this.current_edit_record.name,{closeButton:false, className:'polypopup'}).openPopup();\n\n\t\tif ( this.is_edit ) {\n\t\t\tlayer.editing.enable();\n\t\t} else {\n\t\t\tlayer.editing.disable();\n\t\t}\n\n\t\tthis._map.fitBounds( layer.getBounds(), { padding: [20, 20] } );\n\t\tthis.geo_layers.push( layer );\n\t\tvar $this = this;\n\n\t\tlayer.on( 'edit', function( e ) {\n\t\t\t$this._onShapeUpdate( e );\n\t\t} );\n\t}\n\n\t_drawPolygon( triangleCoords ) {\n\t\tDebug.Text( 'drawing polygon', 'GEOFenceViewController.js', 'GEOFenceViewController', '_drawPolygon', 10 );\n\t\tvar latlngs = _.map( triangleCoords, function( item ) {\n\t\t\treturn { lat: parseFloat( item[0] ), lng: parseFloat( item[1] ) };\n\t\t} );\n\n\t\tvar layer = new L.Polygon( triangleCoords, {\n\t\t\tstroke: true,\n\t\t\tfill: true,\n\t\t\topacity: 0.8,\n\t\t\tweight: 2,\n\t\t\tcolor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F',\n\t\t\tfillOpacity: 0.25,\n\t\t\tfillColor: this.current_edit_record.geo_color ? '#' + this.current_edit_record.geo_color : '#0F820F'\n\t\t} );\n\t\tlayer.removable = true;\n\n\t\tif ( this.is_edit ) {\n\t\t\tlayer.editing.enable();\n\t\t} else {\n\t\t\tlayer.editing.disable();\n\t\t}\n\n\t\tlayer.addTo( this.drawnItems );//.bindPopup(this.current_edit_record.name,{closeButton:false, className:'polypopup'}).openPopup();\n\n\t\tthis._map.fitBounds( layer.getBounds(), { padding: [20, 20] } );\n\t\tthis.geo_layers.push( layer );\n\t\tvar $this = this;\n\n\t\tlayer.on( 'edit', function( e ) {\n\t\t\t$this._onShapeUpdate( e );\n\t\t} );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\n\t\t];\n\t}\n\n\tsetEditMenuMapIcon( context_btn ) {\n\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuMapIcon( context_btn, grid_selected_length ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tthis.is_edit = true;\n\t\tsuper.setEditViewDataDone();\n\t\tvar $this = this;\n\t\tTTPromise.wait( null, null, function() {\n\t\t\t//set the color of the polygon at the start\n\t\t\tif ( $this.edit_view_ui_dic.geo_color ) {\n\t\t\t\t$this.drawControl.options.draw.polygon.shapeOptions.color = $this.edit_view_ui_dic.geo_color.val();\n\t\t\t\t$this.drawControl.options.draw.circle.shapeOptions.color = $this.edit_view_ui_dic.geo_color.val();\n\t\t\t}\n\n\t\t} );\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tthis.removeAllLayers();\n\t\tsuper.onSaveAndContinue();\n\t}\n\n\tsetNavigation() {\n\n\t\tvar $this = this;\n\n\t\t//Error: Unable to get value of the property 'getGridParam': object is null or undefined in /interface/html5/views/BaseViewController.js?v=8.0.0-20141230-103725 line 2575\n\t\tif ( !this.grid ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.navigation.setPossibleDisplayColumns( this.buildDisplayColumnsByColumnModel( this.grid.grid.getGridParam( 'colModel' ) ),\n\t\t\tthis.buildDisplayColumns( this.default_display_columns ) );\n\n\t\tthis.navigation.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\n\t\t\tvar key = target.getField();\n\t\t\tvar next_select_item_id = target.getValue();\n\n\t\t\tif ( !next_select_item_id ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( next_select_item_id !== $this.current_edit_record.id ) {\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\tTTPromise.add( 'Map', 'render' );\n\t\t\t\tif ( $this.is_viewing ) {\n\t\t\t\t\t$this.onViewClick( next_select_item_id ); //Dont refresh UI\n\t\t\t\t} else {\n\t\t\t\t\t$this.onEditClick( next_select_item_id ); //Dont refresh UI\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t//wait for map to render and prevent js exception from moving too fast.\n\t\t\tTTPromise.wait( 'Map', 'render', function() {\n\t\t\t\t$this.setNavigationArrowsEnabled();\n\t\t\t} );\n\n\t\t} );\n\n\t}\n}"],"sourceRoot":""}