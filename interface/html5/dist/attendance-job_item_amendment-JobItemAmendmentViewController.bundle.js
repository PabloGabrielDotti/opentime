(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["attendance-job_item_amendment-JobItemAmendmentViewController"],{1960:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"JobItemAmendmentViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#job_item_amendment_view_container",current_default_record:{}}),super(e)}init(e){this.edit_view_tpl="JobItemAmendmentEditView.html",this.permission_id="job_item",this.viewId="JobItemAmendment",this.script_name="JobItemAmendmentView",this.table_name_key="job_item_amendment",this.context_menu_name=$.i18n._("Task Amendments"),this.navigation_label=$.i18n._("Task Amendment")+":",this.api=TTAPI.APIJobItemAmendment,this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary("JobItemAmendment")}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.copy],include:[]}}buildEditViewUI(){super.buildEditViewUI();var e={"tab_task_amendment":{"label":$.i18n._("Task Amendment")},"tab_audit":!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIJobItemAmendment,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_job_item_amendment",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var t,i,a=this.edit_view_tab.find("#tab_task_amendment").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!1,setRealValueCallBack:function(e){e&&d.setValue(e.manual_id)},field:"job_id"}),i=$("<div class='widget-h-box'></div>");var d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),i.append(d),i.append(t),this.addEditFieldToColumn($.i18n._("Job"),[t,d],a,"",i),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&o.setValue(e.manual_id)},field:"item_id"}),i=$("<div class='widget-h-box'></div>");var o=Global.loadWidgetByName(FormItemType.TEXT_INPUT);o.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),o.addClass("job-coder"),i.append(o),i.append(t),this.addEditFieldToColumn($.i18n._("Task"),[t,o],a,"",i),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"estimate_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn($.i18n._("Estimated Time"),t,a,"",null,!0,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"billable_rate",width:86}),this.addEditFieldToColumn($.i18n._("Billable Rate"),t,a),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"minimum_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn($.i18n._("Minimum Billable Time"),t,a,"",null),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"estimate_quantity",width:150}),this.addEditFieldToColumn($.i18n._("Estimated Quantity"),t,a),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"estimate_bad_quantity",width:150}),this.addEditFieldToColumn($.i18n._("Estimated Bad Quantity"),t,a),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"bad_quantity_rate",width:150}),this.addEditFieldToColumn($.i18n._("Bad Quantity Rate"),t,a)}setCurrentEditRecordData(){for(var e in Global.isFalseOrNull(this.current_edit_record.user_id)&&(this.current_edit_record.user_id=LocalCacheData.getLoginUser().id),this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"item_id":var i={};i.filter_data={job_id:this.current_edit_record.job_id},t.setDefaultArgs(i),t.setValue(this.current_edit_record[e]);break;case"job_quick_search":case"job_item_quick_search":break;default:Global.isSet(this.current_default_record[e])&&(this.current_edit_record[e]=this.current_default_record[e]),t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){this.current_default_record={},super.setEditViewDataDone()}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),d=e.getValue();this.current_edit_record[a]=d;switch(a){case"job_id":this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"item_id",{job_id:i.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0);break;case"item_id":this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemAmendmentDefaultData(),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0);break;case"job_quick_search":case"job_item_quick_search":this.onJobQuickSearch(a,d,"job_id","item_id"),TTPromise.wait("BaseViewController","onJobQuickSearch",(function(){i.setJobItemAmendmentDefaultData()})),TTPromise.wait("BaseViewController","setJobItemValueWhenJobChanged",(function(){i.setJobItemAmendmentDefaultData()}));t=!0}t||this.validate()}validate(){var e=this,t={};if(this.is_mass_editing){for(var i in e.sub_view_mode&&e.parent_key&&(t[e.parent_key]=e.parent_value),this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var a=this.edit_view_ui_dic[i];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(t[i]=a.getValue())}}else t=this.current_edit_record;t=this.uniformVariable(t),this.api["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}setJobItemAmendmentDefaultData(){var e,t=this;TTUUID.isUUID(this.current_edit_record.item_id)&&this.current_edit_record.item_id!=TTUUID.zero_id&&this.is_add&&(e=this.current_edit_record.item_id,this.api["get"+this.api.key_name+"DefaultData"](e,{onResult:function(e){var i=e.getResult();i||(i=[]),t.current_default_record=i,t.setCurrentEditRecordData()}}))}}a.loadSubView=function(e,t,i){Global.loadViewSource("JobItemAmendment","SubJobItemAmendmentView.html",(function(a){var d=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(d({})),Global.isSet(i)&&TTPromise.wait("BaseViewController","initialize",(function(){i(sub_job_item_amendment_view_controller)})))}))}}}]);
//# sourceMappingURL=attendance-job_item_amendment-JobItemAmendmentViewController.bundle.js.map?v=c85ec86bcfa52ee6a3ad