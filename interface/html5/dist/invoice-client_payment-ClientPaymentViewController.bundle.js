(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["invoice-client_payment-ClientPaymentViewController","filebrowser-TImage","filebrowser-TImageAdvBrowser"],{1469:()=>{!function(e){e.fn.TImage=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,n=e.extend({},e.fn.TImage.defaults,t);return this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return null},this.setValue=function(e){if(e){var t=new Date;this.attr("src",e+"&t="+t.getTime())}else this.attr("src","")},this.each((function(){var t=e.meta?e.extend({},n,e(this).data()):n;i=t.field})),this},e.fn.TImage.defaults={},e(document).on("mouseover",".file-browser img",(function(t){var i=e(t.target).parents(".file-browser");if(!e(".file_browser_overlay")[0]&&1==e(t.target).attr("enable-delete")){var n=e(t.target).height(),a=(n-32)/2,o=e('<div class="file_browser_overlay"><img src="theme/default/images/delete-512.png" style="position:absolute;width:32px;height:32px;top:'+a+"px;left:"+a+'px;"></div>');o.css("position","absolute"),o.css("top","0px"),o.css("left","0"),o.css("cursor","pointer"),o.css("height",n+"px"),o.css("width","100%"),o.css("background","rgba(255,255,255,0.85)"),e(t.target).parents(".file-browser").append(o),e(document).on("click",".file_browser_overlay",(function(t){e(t.target).parent().find("img").attr("src");TAlertManager.showConfirmAlert(e.i18n._("This will permanently delete the image. Are you sure?"),"",(function(e){if(e){var t={type:"deleteClick",message:"Delete image clicked.",time:new Date};i.trigger(t)}}))})),e(document).on("mouseleave",".file-browser",(function(){(e(document).off("click",".file_browser_overlay"),e(".file_browser_overlay")[0])&&e(this).find(".file_browser_overlay").off().remove()}))}}))}(jQuery)},8243:()=>{!function(e){e.fn.TImageAdvBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,n,a,o=e.extend({},e.fn.TImageAdvBrowser.defaults,t),l=this,s="",c=177,r=42,d=null;return this.setEnable=function(e){e;var t=this.children().eq(1);e?t.show():t.hide()},this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return a},this.setImage=function(e){if(!e)return n.attr("src",""),void n.hide();var t=new Date;n.hide(),n.attr("src",e+"&t="+t.getTime()+"&X-CSRF-Token="+getCookie("CSRF-Token")),n.css("height","auto"),n.css("width","auto")},this.onImageLoad=function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,n=e(t).width()>0?e(t).width():t.naturalWidth;i>r&&e(t).css("height",r),n>c&&(e(t).css("width",c),e(t).css("height","auto")),l.trigger("setSize"),i<5?e(t).hide():e(t).show()},this.setValue=function(e){e||(e="")},this.setEnableDelete=function(e){var t=l.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.each((function(){var t=e.meta?e.extend({},o,e(this).data()):o;i=t.field;e(this).find("#upload_image").text(e.i18n._("Upload Image")),t.callBack&&(d=t.callBack),!1===t.show_browser&&e(this).children().eq(1).hide(),t.default_width>0&&(c=t.default_width),t.default_height>0&&(r=t.default_height),Global.isSet(t.name)&&t.name,Global.isSet(s)&&(s=t.accept_filter),Global.isSet(t.deleteImageHandler)&&l.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),e(this).children().eq(1).bind("click",(function(){IndexViewController.openWizard("UserPhotoWizard",null,(function(e){d&&d(e),a=e}))})),(n=e(this).children().eq(0)).on("load",(function(){l.onImageLoad(this)})),n.hide()})),this},e.fn.TImageAdvBrowser.defaults={}}(jQuery)},8253:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"ClientPaymentViewController":()=>n});i(1469),i(8243);class n extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#client_payment_view_container",status_array:null,type_array:null,credit_card_type_array:null,sub_document_view_controller:null,bank_account_type_array:null,document_object_type_id:null,file_browser:null}),super(e)}init(e){this.edit_view_tpl="ClientPaymentEditView.html",this.permission_id="client_payment",this.viewId="ClientPayment",this.script_name="ClientPaymentView",this.table_name_key="client_payment",this.document_object_type_id=90,this.context_menu_name=$.i18n._("Payment Methods"),this.navigation_label=$.i18n._("Payment Methods")+":",this.api=TTAPI.APIClientPayment,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary("ClientPayment")}initOptions(){this.initDropDownOption("status"),this.initDropDownOption("type"),this.initDropDownOption("bank_account_type"),this.initDropDownOption("credit_card_type","cc_type_id"),Global.isSet(this.adv_search_field_ui_dic.is_default)&&this.basic_search_field_ui_dic.is_default.setSourceData(Global.buildRecordArray({0:"False",1:"True"}))}getCustomContextMenuModel(){var e={exclude:[],include:["default"]};return this.sub_view_mode||e.include.push({label:$.i18n._("Edit Client"),id:ContextMenuIconName.edit_client,group:"navigation",icon:Icons.client},{label:$.i18n._("Client Contacts"),id:ContextMenuIconName.client_contact,group:"navigation",icon:Icons.client_contact},{label:$.i18n._("Transactions"),id:ContextMenuIconName.transaction,group:"navigation",icon:Icons.transaction},{label:$.i18n._("Invoices"),id:ContextMenuIconName.invoice,group:"navigation",icon:Icons.invoice}),e}setCurrentEditRecordData(){for(var e in this.setDefaultData({"type_id":30,"bank_account_type_id":200}),this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];Global.isSet(t)&&t.setValue(this.current_edit_record[e])}if(this.current_edit_record.signature_exists&&this.current_edit_record.id&&this.current_edit_record.client_id){var i=ServiceCaller.getURLByObjectType("file_download")+"&object_type=client_payment_signature&object_id="+this.current_edit_record.id+"&parent_id="+this.current_edit_record.client_id;this.file_browser.setImage(i)}else this.detachElement("signature");this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,n=0;n<t;n++){var a=$(this.context_menu_array[n]),o=$(a.find(".ribbon-sub-menu-icon")).attr("id");switch(a.removeClass("invisible-image"),a.removeClass("disable-image"),o){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(a,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(a,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(a,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(a,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(a,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(a,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(a,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(a,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(a,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(a,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(a,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(a,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(a,i);break;case ContextMenuIconName.login:this.setDefaultMenuLoginIcon(a,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(a,i);break;case ContextMenuIconName.import_icon:this.setDefaultMenuImportIcon(a,i);break;case ContextMenuIconName.edit_client:this.setDefaultMenuEditClientIcon(a,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(a,i)}}this.setContextMenuGroupVisibility()}}setDefaultMenuEditClientIcon(e,t,i){1===t?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.download:this.onDownloadClick();break;case ContextMenuIconName.edit_client:case ContextMenuIconName.client_contact:case ContextMenuIconName.invoice:case ContextMenuIconName.transaction:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}getFilterColumnsFromDisplayColumns(){var e={is_owner:!0,id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,client_id:!0},t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,n=0;n<i;n++){e[t[n].name]=!0}return e}onNavigationClick(e){var t,i=this,n={filter_data:{}},a=[];switch(i.edit_view&&i.current_edit_record.id?a.push(i.current_edit_record.client_id):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var n=i.getRecordFromGridById(t);a.push(n.client_id)}))),n.filter_data.client_id=a,e){case ContextMenuIconName.edit_client:a.length>0&&IndexViewController.openEditView(this,"Client",a[0]);break;case ContextMenuIconName.client_contact:Global.addViewTab(i.viewId,$.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("ClientContact",n);break;case ContextMenuIconName.invoice:Global.addViewTab(i.viewId,$.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("Invoice",n);break;case ContextMenuIconName.transaction:Global.addViewTab(i.viewId,$.i18n._("Payment Methods"),window.location.href),IndexViewController.goToView("InvoiceTransaction",n);break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name)}}buildEditViewUI(){super.buildEditViewUI();var e=this,t={"tab_payment_method":{"label":$.i18n._("Payment Method")},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIClientPayment,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_client_payment",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_payment_method").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var n=Global.loadWidgetByName(FormItemType.AWESOME_BOX);n.AComboBox({api_class:TTAPI.APIClient,allow_multiple_selection:!1,layout_name:"global_client",show_search_inputs:!0,set_empty:!0,field:"client_id"}),this.addEditFieldToColumn($.i18n._("Client"),n,i,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),n.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),n,i),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),n.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),n,i),(n=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"is_default"}),this.addEditFieldToColumn($.i18n._("Default"),n,i),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"bank_account_type_id"}),n.setSourceData(e.bank_account_type_array),this.addEditFieldToColumn($.i18n._("Bank Type"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"bank_institution",width:30}),this.addEditFieldToColumn($.i18n._("Institution Number"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"bank_transit",width:100}),this.addEditFieldToColumn($.i18n._("Bank Transit"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"bank_account",width:120}),this.addEditFieldToColumn($.i18n._("Account Number"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"cc_type_id"}),n.setSourceData(e.credit_card_type_array),this.addEditFieldToColumn($.i18n._("Credit Card Type"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"cc_number",width:120}),this.addEditFieldToColumn($.i18n._("Credit Card Number"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"cc_expire"}),this.addEditFieldToColumn($.i18n._("Expiry Date"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"cc_check",width:60}),this.addEditFieldToColumn($.i18n._("Credit Card Security Code (CSC)"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"cc_name"}),this.addEditFieldToColumn($.i18n._("Card Holder Name"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"cc_bank_phone"}),this.addEditFieldToColumn($.i18n._("Card Issuing Banks Phone Number"),n,i,"",null,!0),n=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=n.TImageAdvBrowser({field:"signature",show_browser:!1}),this.addEditFieldToColumn($.i18n._("Signature"),n,i,"",null,!0,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),n,i,"",null,null,!0),n.parent().width("45%")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Client"),in_column:1,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default"),in_column:2,field:"is_default",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),n=e.getValue();this.current_edit_record[i]=n,"type_id"===i&&this.onTypeChange(),"bank_account_type_id"===i&&this.onBankAccountTypeChange(),t||this.validate()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(){30==this.current_edit_record.type_id?(this.detachElement("bank_account_type_id"),this.detachElement("bank_institution"),this.detachElement("bank_transit"),this.detachElement("bank_account"),this.attachElement("cc_type_id"),this.attachElement("cc_number"),this.attachElement("cc_expire"),this.attachElement("cc_check"),this.attachElement("cc_name"),this.attachElement("cc_bank_phone")):40==this.current_edit_record.type_id?(this.attachElement("bank_account_type_id"),this.attachElement("bank_institution"),this.attachElement("bank_transit"),this.attachElement("bank_account"),this.detachElement("cc_type_id"),this.detachElement("cc_number"),this.detachElement("cc_expire"),this.detachElement("cc_check"),this.detachElement("cc_name"),this.detachElement("cc_bank_phone"),this.onBankAccountTypeChange()):(this.detachElement("bank_account_type_id"),this.detachElement("bank_institution"),this.detachElement("bank_transit"),this.detachElement("bank_account"),this.detachElement("cc_type_id"),this.detachElement("cc_number"),this.detachElement("cc_expire"),this.detachElement("cc_check"),this.detachElement("cc_name"),this.detachElement("cc_bank_phone")),this.editFieldResize()}onBankAccountTypeChange(){200==this.current_edit_record.bank_account_type_id&&40==this.current_edit_record.type_id?(this.attachElement("bank_institution"),this.edit_view_form_item_dic.bank_transit.find(".edit-view-form-item-label").text($.i18n._("Bank Transit")+": ")):201==this.current_edit_record.bank_account_type_id&&(this.detachElement("bank_institution"),this.edit_view_form_item_dic.bank_transit.find(".edit-view-form-item-label").text($.i18n._("Routing Number")+": ")),this.editFieldResize()}}n.loadSubView=function(e,t,i){Global.loadViewSource("ClientPayment","SubClientPaymentView.html",(function(n){var a=_.template(n);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(a({})),Global.isSet(i)&&i(sub_client_payment_view_controller))}))}}}]);
//# sourceMappingURL=invoice-client_payment-ClientPaymentViewController.bundle.js.map?v=a864a14570c83ba2a427