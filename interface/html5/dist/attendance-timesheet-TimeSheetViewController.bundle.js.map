{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImage.js","webpack://timetrex/./interface/html5/global/widgets/switch_button/SwitchButton.js","webpack://timetrex/./interface/html5/views/attendance/timesheet/TimeSheetViewController.js"],"names":["$","fn","TImage","options","Global","addCss","field","opts","extend","defaults","this","clearErrorStyle","getField","getValue","setValue","val","d","Date","attr","getTime","each","o","meta","data","document","on","e","$this_image_widget","target","parents","height","top","file_browser_overlay","css","append","parent","find","TAlertManager","showConfirmAlert","i18n","_","flag","type","message","time","trigger","off","remove","jQuery","SwitchButton","$this","btn","enabled","getEnabled","setEnable","removeClass","addClass","return_number","hasClass","setIcon","tooltip","icon","click","stopImmediatePropagation","stopPropagation","SwitchButtonIcon","daily_total","weekly_total","all_employee","strict_range","wages","TimeSheetViewController","BaseViewController","el","status_array","type_array","employee_nav","start_date_picker","full_timesheet_data","full_format","weekly_format","day_format","date_format","start_date","end_date","select_cells_Array","select_punches_array","absence_select_cells_Array","accumulated_time_cells_array","premium_cells_array","timesheet_data_source","accumulated_time_source","accumulated_time_grid","accumulated_time_source_map","branch_grid","branch_source_map","branch_source","department_grid","department_source_map","department_source","job_grid","job_source_map","job_source","job_item_grid","job_item_source_map","job_item_source","premium_grid","premium_source_map","premium_source","absence_grid","absence_source","absence_original_source","accumulated_total_grid","accumulated_total_grid_source_map","accumulated_total_grid_source","punch_note_grid","punch_note_grid_source","verification_grid","verification_grid_source","grid_dic","pay_period_map","pay_period_data","timesheet_verify_data","api_timesheet","api_user_date_total","api_date","api_station","api_punch","absence_model","select_drag_menu_id","is_mass_adding","department_cell_count","branch_cell_count","premium_cell_count","job_cell_count","task_cell_count","absence_cell_count","punch_note_account","show_navigation_box","station","scroll_position","job_api","job_item_api","api_absence_policy","pre_total_time","absence_available_balance_dataList","available_balance_info","show_job_ui","show_job_item_ui","show_branch_ui","show_department_ui","show_good_quantity_ui","show_bad_quantity_ui","show_note_ui","show_station_ui","show_absence_job_ui","show_absence_job_item_ui","show_absence_branch_ui","show_absence_department_ui","holiday_data_dic","grid_div","actual_time_label","column_maps","accmulated_order_map","url_args_before_set_date_url","allow_auto_switch","previous_absence_policy_id","events","super","permission_id","viewId","script_name","context_menu_name","navigation_label","api","TTAPI","APIPunch","APITimeSheet","APIUserDateTotal","APITTDate","APIStation","getProductEdition","APIJob","APIJobItem","APIAbsencePolicy","initPermission","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","TTPromise","resolve","initEditView","is_cancel","search","edit_view","setEditMenu","setDefaultMenu","scrollTop","p_id","PermissionManager","validate","new_item","updateSelectItem","show_search_tab","punchModeValidate","show_punch_mode_ui","is_auto_switch","jobUIValidate","jobItemUIValidate","branchUIValidate","departmentUIValidate","goodQuantityUIValidate","badQuantityUIValidate","noteUIValidate","locationUIValidate","show_location_ui","stationValidate","permission_name","selected_item","indexOf","user","getSelectEmployee","isSet","initDropDownOption","context_menu_model","groups","drag_and_drop","label","id","exclude","ContextMenuIconName","export_excel","add","copy","copy_as_new","include","add_punch","group","Icons","new_add","sort_order","add_absence","move","drag_copy","in_out","permission_result","checkTopLevelPermission","permission","schedule","pay_stub","pay_stubs","edit_employee","employee","edit_pay_period","pay_period","accumulated_time","timesheet","re_calculate_timesheet","re_cal_timesheet","generate_pay_stub","re_cal_pay_stub","print","RibbonSubMenuType","NAVIGATION","items","push","map","request","setUINotready","wait","is_edit","initEditViewUI","did_clean","key","edit_view_ui_dic","hasOwnProperty","widget","edit_view_form_item_dic","detachElement","attachElement","is_viewing","setEnabled","buildEditViewUI","form_item_input","widgetContainer","tab_model","setTabModel","tab_punch_column1","edit_view_tab","loadWidgetByName","FormItemType","TEXT","TText","addEditFieldToColumn","TIME_PICKER","TTimePicker","validation_field","DATE_PICKER","TDatePicker","TRangePicker","TEXT_INPUT","TTextInput","mode","AWESOME_BOX","AComboBox","api_class","allow_multiple_selection","layout_name","show_search_inputs","set_empty","customSearchFilter","filter","setAbsencePolicyFilter","getRealImagePath","COMBO_BOX","TComboBox","setSourceData","check_box","CHECKBOX","TCheckbox","APIBranch","APIDepartment","setRealValueCallBack","job_coder","manual_id","disable_keyup_event","job_item_coder","good","good_label","bad","bad_label","hide","TEXT_AREA","TTextArea","width","latitude","longitude","accuracy","map_icon","location_wrapper","onMapClick","current_edit_record","station_id","IndexViewController","openEditView","IMAGE","setStation","filter_data","user_id","filter_columns","absence_policy","date","dates","split","resultArray","beginDate","strToDate","endDate","nextDate","format","setDate","getDate","record","is_mass_editing","len","mass_edit_record_ids","length","i","temp_item","clone","dates_array","punch_dates","parserDatesRange","common_record","date_stamp","punch_date","key_name","onResult","result","clearErrorTips","isValid","setErrorMenu","setErrorTips","validateResult","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","c_value","setJobItemValueWhenJobChanged","status_id","job_id","setCheckBox","onJobQuickSearch","parseTimeUnit","onAvailableBalanceChange","layout_div","search_panel","form_item","loadWidget","form_item_label","form_item_input_div","text","save_search_as_input","save_btn","onSaveNewLayout","previous_saved_layout_div","previous_saved_layout_selector","update_btn","del_btn","onUpdateLayout","onDeleteLayout","control_bar","date_chooser_div","employee_nav_div","action_chooser_div","wage_btn","onWageOrModeChange","show","timezone_btn","date_chooser","date_left_arrow","date_right_arrow","continueChangeDate","new_date","doNextIfNoValueChangeInManualGrid","setDatePickerValue","LocalCacheData","last_timesheet_selected_date","bind","checkTimesheetData","timesheet_columns","select_date","getSelectDate","first_build","left_click","right_click","navigation_widget_div","APIUser","init_data_immediately","default_args","permission_section","always_include_columns","is_static_width","userValueSet","selected_user_id","reSetURL","last_timesheet_selected_user","setEmployeeNavArrowsStatus","triggerAnalyticsEditViewNavigation","doNextDone","next_select_item","selected_index","getSelectIndex","source_data","getSourceData","current_open_page","getCurrentOpenPage","getItemByIndex","onADropDownSearch","toggle_button","data_provider","value","TToggleButton","doNext","reset","getPunchMode","editor","modify_alert_message","wait_auto_save","clearTimeout","setCookie","deleteCookie","handleOverrideUserPreferenceCookie","pager_data","getPagerData","last_page_number","default_layout_id","do_update","getLayoutsArray","clearSearchPanel","temp_adv_filter_data","temp_basic_filter_data","column_selector","setSelectGridData","default_display_columns","sort_by_selector","default_layout_name","children","args","getValidSearchFilter","user_generic_data_api","setUserGenericData","res","clearViewLayoutCache","need_select_layout_name","initLayout","selectId","script","name","is_default","showErrorAlert","getSearchPanelFilter","ProgressBar","showOverlay","start_date_string","noProgressForNextCall","getTimeSheetData","removeNanobar","getResult","timesheet_dates","start_display_date","end_display_date","initInsideEditorData","onReloadSubGridResult","force","convertLayoutFilterToAPIFilter","select_layout","last_timesheet_selected_show_wage","last_timesheet_selected_timezone","last_timesheet_selected_punch_mode","buildCalendars","searchDone","columns","ui_id","grid_id","column","index","sortable","title","unload","TTGrid","hoverrows","multiselectPosition","verticalResize","onResizeGrid","hidden","cellattr","setPunchNoteGridSize","setGridHeaderBar","grid","pay_period_header","pay_period_id","punch_column_width","punch_in_out_column","formatter","onCellFormat","start_date_str","getLoginUserDateFormat","end_date_str","getAccumulatedTotalGridPayperiodHeader","column_width","column_1","column_2","setAccumulatedTotalGridPayPeriodHeaders","display_columns","getGridParam","t_grid_header_array","column_info","column_header","TGridHeader","onColumnHeaderClick","substring","getYear","highLightSelectDay","reLoadSubGridsSource","row_id","cell_index","m","cell","ondblClickRow","onGridDblClickRow","onRightClickRow","iRow","checkIsSelectedAbsenceCell","cell_val","closest","html","onCellSelect","onSelectRow","getGridWidth","setGridWidth","beforeSelectRow","preventDefault","winMultiSelect","bindTimeSheetGridColumnEvents","$trs","skips","colored","timesheet_grid","jgrid","guid","grid_setup_data","altRows","row_index","getRowData","REQUEST_ROW","checkIsSelectedPunchCell","setManualTimeSheetGridSize","setGridSize","setTimeSheetGridPayPeriodHeaders","setTimeSheetGridHolidayHeaders","gridComplete","colorTimeSheetRows","scroll","context_menu_array","need_break","context_btn","edit","is","onEditClick","view","onViewClick","isPunchCells","onAddClick","row","parseInt","PUNCH_ROW","onAccumulatedTimeClick","html_grid_id","unsetSelectedCells","setGridHeight","timesheet_sub_grid_expended_dic","updateGridHeaderBar","title_bar","img","setGridSExpendOrCollapseStatus","description","title_span","table","day_dic","current_date","day_text","date_text","callBack","object_type_id","getUserDateTotal","manual_timesheet_data","time_sheet_data_overrode_true_map","time_sheet_data_overrode_false_map","manual_timesheet_data_group_array","override_true_array","override_false_array","target_map","branch_id","department_id","job_item_id","j","branch","department","job","job_item","override","sort","m_sort_by","groupBy","updateExistedCell","unbind","currentTarget","is_saving_manual_grid","map_key","buildManualTimeSheetData","map_key_2","item","isObject","generateManualTimeSheetRecordKey","item_id_key","manual_grid_records_map","total_time","current_edit_item","removeAllRows","addRow","isEmpty","save_manual_grid_after_save","autoSaveManualPunch","getManualTimeSheetData","widget_row","rows_widgets_array","parent_controller","getRowRender","getRender","widgets","eq","default_branch_id","default_department_id","job_form_item_input","setDefaultArgs","default_job_id","default_job_item_id","display_na","need_parser_sec","do_validate","disable_plus","disable_minus","disable_dropdowns","invalid","n","Object","keys","punch_data","pay_period_date_map","field_pay_period_status","is_changed","getJob","result_data","getJobItem","job_item_widget","current_job_item_id","new_arg","getColumnFilter","task_result","setDefaultData","default_item_id","insertAfter","splice","addIconsEvent","setTimeout","onSaveClick","isSave","rowIndex","has_value","remove_ids","showNanobar","deleteUserDateTotal","task","INSIDE_EDITOR","InsideEditor","insideEditorAddRow","insideEditorGetValue","insideEditorSetValue","removeRow","insideEditorRemoveRow","render_args","row_render","buildTimeSheetsColumns","buildTimeSheetGrid","buildManualTimeSheetsColumns","buildManualTimeSheetGrid","buildAccumulatedGrid","buildSubGrid","buildAbsenceGrid","showGridBorders","buildAccumulatedTotalGrid","buildPunchNoteGrid","buildVerificationGrid","buildTimeSheetSource","buildTimeSheetRequests","buildSubGridsSource","buildTimeSheetExceptions","buildAbsenceSource","buildPunchNoteGridSource","buildVerificationGridSource","setGridExpendButton","setData","autoOpenEditViewIfNecessary","setScrollPosition","initRightClickMenu","RightClickMenuType","ABSENCE_GRID","showWarningMessageIfAny","setPunchModeClass","cols","getManualPayPeriodDefaultTrColspan","is_no_manual","is_no_punch","timesheet_grid_div","warning_bar","user_pay_period_check","hire_date","termination_date","select_date_str","getPayPeriod","payPeriodCheck","pay_period_schedule_id","policy_group_id","insertBefore","current_doing_context_action","edit_id_for_next_open_view","getAllURLArgs","t","autoOpenEditOnlyViewIfNecessary","date_string","new_tr","new_th","default_th","week_th","pay_period_th","ths","th_width","prepend","holiday_name_map","holiday_data","standard_date","colspan","size_tr","current_trs","th","createSizeColumns","createNoPayPeriodColumns","last_pay_period_id","column_number","map_array","y","p_key","time_stamp","createTh","end_index","highlight_header","$grid","setPayPeriodHeaderSize","grid_width","accumulated_grid_width","getWidth","verification_grid_width","Math","floor","bodyWidth","abs","tr","manual_grid_tr","td","cell_value","related_data","punch_info","ex_span","time_span","punch","break_span","related_punch","exception","ex","col_model","colModel","content_div","rowid","currency","getCurrentCurrencySymbol","decodeCellValue","pos","TOTAL_ROW","get","outerHTML","REGULAR_ROW","type_id","note","label_suffix","has_image","tainted","exception_color","exception_policy_type_id","exception_policy_type","EXCEPTION_ROW","isArray","calDAndA","status","array","a","p","createRequestToolTip","time_sheet_view_controller","total_time_amount","hourly_rate","MoneyRound","ABSENCE_ROW","absence","ACCUMULATED_TIME_ROW","PREMIUM_ROW","row_tr","cells_array","info","date_time","punch_time","time_stamp_num","strToDateTime","b","compare","last_clicked_grid_id","window","row_data","data_field","date_str","pending_requests","total_requests","obj","addViewTab","location","href","getLoginUser","ownerOrChildPermissionValidate","goToView","viewPermissionValidate","isValidDate","ctrlKey","metaKey","found","getCellPunch","getRelatedPunch","src_object_id","punch_info_id","shiftKey","start_row_index","start_cell_index","end_row_index","end_cell_index","tmp_row_index","tmp_cell_index","tmp_row_id","uppermost_row_index","lowermost_row_index","leftmost_cell_index","rightmost_cell_index","r_index","c_index","setTimesheetGridDragAble","request_array","request_data","request_row_index","exception_array","exception_data","timesheet_data_source_len","exception_row_index","isFalseOrNull","punch_id","punch_control_id","getTimeSheetTotalData","accumulated_user_date_total_data","meal_and_break_total_data","pay_period_accumulated_user_date_total_data","grid_selected_length","pId","editPermissionValidate","edit_only_mode","editOwnerOrChildPermissionValidate","deletePermissionValidate","deleteOwnerOrChildPermissionValidate","viewOwnerOrChildPermissionValidate","addPermissionValidate","total","key1","order","buildAccmulatedOrderMap","premium_time","absence_time","absence_time_taken","buildSubGridsData","column_len","start","branch_time","department_time","job_time","job_item_time","Debug","Text","total_result","sortAccumulatedTotalData","sortAccumulatedTimeData","buildBreakAndLunchData","getTimeUnit","total_breaks","break_name","result_array","parent_key","marked_regular_row","is_override_row","key_array","no_id","unshift","addCellCount","pay_period_verify_type_id","verify_action_bar","verify_grid_div","verify_btn","verify_title","verify_des","timeSheetVerifyPermissionValidate","display_verify_button","verification_status_display","verification_box_color","verification_confirmation_message","verifyTimeSheet","verification_data","verification_window_dates","end","verification","punch_array","absence_array","user_date_total_data","len1","last_control_id","replace","x","row_id_counter","pay_code_id","lastDayIsOverride","current_data","new_row","punch_status_id","our_row","find_position","fixed","header_text","getLoginData","language","isString","split_header_text_array","split_header_text_month","resizable","callback","filter_sort","layouts_array","empty","prop","default_filter_for_next_open_view","setSearchPanelFilter","position","cells","event","container","span","originalEvent","dataTransfer","setDragImage","pageY","offset","target_cell","parentNode","cellIndex","target_punch","target_related_punch","target_column_date","first_select_date","time_offset","target_column_date_str","savePunch","new_punch_id","target_id","target_status_id","action_type","APIPunchControl","dragNdropPunch","last_date_string","showAlert","$el","removeViewTab","loginUser","initOptions","show_wage","timezone","UNIT_TEST_MODE","base_date","current_select_date","dateStr","setMoveOrDropMode","getDefaultFormatValue","getBaseURL","setURLToBrowser","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","full_item","TTUUID","isUUID","RibbonViewController","doLogout","retval","closeOverlay","removeEditView","onRightArrowClick","setAllURLArgs","buildArgDic","ignoreWarning","current_api","getCurrentAPI","setIsIdempotent","refresh_id","zero_id","not_exist_id","onSaveAndContinueDone","getSelectedRecordId","api_args","handleViewAPICallbackResult","apply","unique_columns","result1","linked_columns","sub_view_mode","parent_value","sub_log_view_controller","getSubViewFilter","parent_view_controller","parent_edit_record","record_id","handleEditAPICallbackResult","tab_name","getEditViewTabIndex","trackView","onNavigationClick","onWizardClick","addRequestFromTimesheetCell","getUpgradeMessage","current_column_field","current_punch_id","current_punch_status_id","previous_punch_id","getRequestDefaultData","iconName","post_data","current_open_primary_controller","include_users","include_user_ids","users","time_period","include_user_id","0","1","doFormIFrameCall","postData","APIFileDownload","position_accuracy","punches","map_options","single_marker_draggable","ids","first_name","last_name","job_manual_id","job_item_manual_id","getPunch","async","then","module","processed_punches_for_map","TTConvertMapData","processPunchesFromViewController","catch","importErrorHandler","default_data","openWizard","onReCalTimeSheetDone","TopMenuManager","isCurrentView","drag_copy_icon","move_icon","drag_invisible","move_invisible","copyPermissionValidate","movePermissionValidate","date_dic","doing_save_and_new","select_cell","prev_punch_id","select_item","pre_punch","left_side_punch","saveAndContinueValidate","isMassDate","setTabStatus","clearNavigationData","onCopyAsNewClick","records","retarr","Array","check_fields","isChecked","createCurrentManualGridRecordsMap","filterManualGridRecords","updateManualGrid","dataset","successCallback","savePunchPosition","moved_unsaved_markers","setLocationValue","navigation_div","navigation","is_punch_nav","setNavigation","setMassEditMode","setNavigationArrowsStatus","setCurrentEditRecordData","SaveAndContinueBox","related_view_controller","initTabData","switchToProperTab","actual_time_value","tab_0_label","date_array","getSelectDateArray","select_employee","ServiceCaller","getURLByObjectType","actual_time_stamp","setEditViewDataDone","location_data","getAvailableBalance","editFieldResize","last_date_stamp","getProjectedAbsencePolicyBalance","getBalanceHandler","arg","getStation","is_child","is_owner","doNotSetFocus","isLocalCacheExists","setDefaultMenuAddIcon","setDefaultMenuEditIcon","setDefaultMenuViewIcon","mass_edit","setDefaultMenuMassEditIcon","setDefaultMenuCopyIcon","setDefaultMenuDragCopyIcon","delete_icon","setDefaultMenuDeleteIcon","delete_and_next","setDefaultMenuDeleteAndNextIcon","save","setDefaultMenuSaveIcon","save_and_next","setDefaultMenuSaveAndNextIcon","save_and_continue","setDefaultMenuSaveAndContinueIcon","save_and_new","setDefaultMenuSaveAndAddIcon","save_and_copy","setDefaultMenuSaveAndCopyIcon","setDefaultMenuCopyAsNewIcon","cancel","setDefaultMenuCancelIcon","setDefaultMenuEditPayPeriodIcon","setDefaultMenuMapIcon","setDefaultMenuPrintIcon","setDefaultMenuEditEmployeeIcon","setDefaultMenuPayStubIcon","setDefaultMenuReCalculateTimesheet","setDefaultMenuGeneratePayStubIcon","setDefaultMenuScheduleIcon","setDefaultMenuAccumulatedTimeIcon","setAddRequestIcon","setContextMenuGroupVisibility","reCalculateEditPermissionValidate","editChildPermissionValidate","saveAndNewValidate","setEditMenuSaveIcon","setEditMenuAddIcon","setEditMenuEditIcon","setEditMenuViewIcon","setEditMenuMassEditIcon","setEditMenuCopyIcon","setEditMenuDragCopyIcon","setEditMenuDeleteIcon","setEditMenuDeleteAndNextIcon","setEditMenuSaveAndContinueIcon","setEditMenuSaveAndAddIcon","setEditMenuSaveAndNextIcon","setEditMenuSaveAndCopyIcon","setEditMenuCopyAndAddIcon","setEditMenuMapIcon","setDefaultMenuExportIcon","cleanWhenUnloadView","enableAddRequestButton"],"mappings":"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","file":"attendance-timesheet-TimeSheetViewController.bundle.js?v=22d6176f94c46996d366","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImage = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImage.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn null;\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\t\t\tif ( !val ) {\n\t\t\t\tthis.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\tthis.attr( 'src', val + '&t=' + d.getTime() );\n\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImage.defaults = {};\n\n\t$( document ).on( 'mouseover', '.file-browser img', function( e ) {\n\t\tvar $this_image_widget = $( e.target ).parents( '.file-browser' );\n\n\t\tif ( !$( '.file_browser_overlay' )[0] && $( e.target ).attr( 'enable-delete' ) == 1 ) {\n\t\t\tvar height = $( e.target ).height();\n\t\t\tvar top = ( height - 32 ) / 2;\n\t\t\tvar left = top;\n\n\t\t\tvar file_browser_overlay = $( '<div class=\"file_browser_overlay\"><img src=\"theme/default/images/delete-512.png\" style=\"position:absolute;width:32px;height:32px;top:' + top + 'px;left:' + left + 'px;\"></div>' );\n\t\t\tfile_browser_overlay.css( 'position', 'absolute' );\n\t\t\tfile_browser_overlay.css( 'top', '0px' );\n\t\t\tfile_browser_overlay.css( 'left', '0' );\n\t\t\tfile_browser_overlay.css( 'cursor', 'pointer' );\n\t\t\tfile_browser_overlay.css( 'height', height + 'px' );\n\t\t\tfile_browser_overlay.css( 'width', '100%' );\n\t\t\tfile_browser_overlay.css( 'background', 'rgba(255,255,255,0.85)' );\n\n\t\t\t$( e.target ).parents( '.file-browser' ).append( file_browser_overlay );\n\n\t\t\t$( document ).on( 'click', '.file_browser_overlay', function( e ) {\n\t\t\t\tvar img_src = $( e.target ).parent().find( 'img' ).attr( 'src' );\n\t\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'This will permanently delete the image. Are you sure?' ), '', function( flag ) {\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\tvar e = { type: 'deleteClick', message: 'Delete image clicked.', time: new Date() };\n\t\t\t\t\t\t$this_image_widget.trigger( e );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t$( document ).on( 'mouseleave', '.file-browser', function() {\n\t\t\t\t$( document ).off( 'click', '.file_browser_overlay' );\n\t\t\t\tif ( $( '.file_browser_overlay' )[0] ) {\n\t\t\t\t\tvar file_browser_overlay = $( this ).find( '.file_browser_overlay' );\n\t\t\t\t\tfile_browser_overlay.off().remove();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t} );\n\n} )( jQuery );","( function( $ ) {\n\n\t$.fn.SwitchButton = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/switch_button/SwitchButton.css' );\n\t\tvar opts = $.extend( {}, $.fn.SwitchButton.defaults, options );\n\n\t\tvar $this = this;\n\n\t\tvar btn = null;\n\n\t\tvar enabled = true;\n\n\t\tthis.getEnabled = function() {\n\t\t\treturn enabled;\n\t\t};\n\n\t\tthis.setEnable = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tif ( !val ) {\n\t\t\t\tthis.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tthis.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\t//Error: TypeError: btn is null in /interface/html5/global/widgets/switch_button/SwitchButton.js?v=9.0.0-20150822-212724 line 31\n\t\tthis.getValue = function( return_number ) {\n\t\t\tif ( return_number ) {\n\t\t\t\treturn ( btn && btn.hasClass( 'selected' ) ) ? 1 : 0;\n\t\t\t} else {\n\t\t\t\treturn ( btn && btn.hasClass( 'selected' ) ) ? true : false;\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\t//Error: TypeError: btn is null in /interface/html5/global/widgets/switch_button/SwitchButton.js?v=8.0.0-20141230-130626 line 35\n\t\t\tif ( !btn ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbtn.removeClass( 'selected' );\n\n\t\t\tif ( val ) {\n\t\t\t\tbtn.addClass( 'selected' );\n\t\t\t}\n\t\t};\n\n\t\tthis.setIcon = function( val ) {\n\t\t\tbtn.addClass( val );\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tbtn = $( '<div></div>' );\n\n\t\t\t$this.append( btn );\n\n\t\t\tif ( o.tooltip ) {\n\t\t\t\tbtn.attr( 'title', o.tooltip );\n\t\t\t}\n\n\t\t\t$this.setIcon( o.icon );\n\n\t\t\tbtn.click( function( e ) {\n\n\t\t\t\tif ( !enabled ) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$this.setValue( !$this.getValue() );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.SwitchButton.defaults = {};\n\n} )( jQuery );\n\nexport var SwitchButtonIcon = function() {\n\n};\n\nSwitchButtonIcon.daily_total = 'daily';\nSwitchButtonIcon.weekly_total = 'weekly';\nSwitchButtonIcon.all_employee = 'all-employee';\nSwitchButtonIcon.strict_range = 'strict-range';\nSwitchButtonIcon.wages = 'strict-range';","import '@/global/widgets/filebrowser/TImage';\nimport { SwitchButtonIcon } from '@/global/widgets/switch_button/SwitchButton';\n\nexport class TimeSheetViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#timesheet_view_container', //Must set el here and can only set string, so events can work\n\t\t\t// _required_files: {\n\t\t\t// \t10: ['TImage'],\n\t\t\t// \t15: ['leaflet-timetrex']\n\t\t\t// },\n\t\t\tstatus_array: null,\n\t\t\ttype_array: null,\n\t\t\temployee_nav: null,\n\t\t\tstart_date_picker: null,\n\t\t\tfull_timesheet_data: null, //full timesheet data\n\t\t\tfull_format: 'ddd-MMM-DD-YYYY',\n\t\t\tweekly_format: 'ddd, MMM DD',\n\t\t\tday_format: 'ddd',\n\t\t\tdate_format: 'MMM DD',\n\t\t\tstart_date: null,\n\t\t\tend_date: null,\n\t\t\tselect_cells_Array: [], //Timesheet grid\n\t\t\tselect_punches_array: [], //Timesheet grid.\n\t\t\tabsence_select_cells_Array: [], //Absence grid\n\t\t\taccumulated_time_cells_array: [],\n\t\t\tpremium_cells_array: [],\n\t\t\ttimesheet_data_source: null,\n\t\t\taccumulated_time_source: null,\n\t\t\taccumulated_time_grid: null,\n\t\t\taccumulated_time_source_map: null,\n\t\t\tbranch_grid: null,\n\t\t\tbranch_source_map: null,\n\t\t\tbranch_source: null,\n\t\t\tdepartment_grid: null,\n\t\t\tdepartment_source_map: null,\n\t\t\tdepartment_source: null,\n\t\t\tjob_grid: null,\n\t\t\tjob_source_map: null,\n\t\t\tjob_source: null,\n\t\t\tjob_item_grid: null,\n\t\t\tjob_item_source_map: null,\n\t\t\tjob_item_source: null,\n\t\t\tpremium_grid: null,\n\t\t\tpremium_source_map: null,\n\t\t\tpremium_source: null,\n\t\t\tabsence_grid: null,\n\t\t\tabsence_source: null,\n\t\t\tabsence_original_source: null,\n\t\t\taccumulated_total_grid: null,\n\t\t\taccumulated_total_grid_source_map: null,\n\t\t\taccumulated_total_grid_source: null,\n\t\t\tpunch_note_grid: null,\n\t\t\tpunch_note_grid_source: null,\n\t\t\tverification_grid: null,\n\t\t\tverification_grid_source: null,\n\t\t\tgrid_dic: null,\n\t\t\tpay_period_map: null,\n\t\t\tpay_period_data: null,\n\t\t\ttimesheet_verify_data: null,\n\t\t\tapi_timesheet: null,\n\t\t\tapi_user_date_total: null,\n\t\t\tapi_date: null,\n\t\t\tapi_station: null,\n\t\t\tapi_punch: null,\n\t\t\tabsence_model: false,\n\t\t\tselect_drag_menu_id: '', //Do drag move or copy\n\t\t\tis_mass_adding: false,\n\t\t\tdepartment_cell_count: 0,\n\t\t\tbranch_cell_count: 0,\n\t\t\tpremium_cell_count: 0,\n\t\t\tjob_cell_count: 0,\n\t\t\ttask_cell_count: 0,\n\t\t\tabsence_cell_count: 0,\n\t\t\tpunch_note_account: 0,\n\t\t\tshow_navigation_box: true,\n\t\t\tstation: null,\n\t\t\tscroll_position: 0,\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\t\t\tapi_absence_policy: null,\n\t\t\tpre_total_time: null,\n\t\t\tabsence_available_balance_dataList: {},\n\t\t\tavailable_balance_info: null,\n\t\t\tshow_job_ui: false,\n\t\t\tshow_job_item_ui: false,\n\t\t\tshow_branch_ui: false,\n\t\t\tshow_department_ui: false,\n\t\t\tshow_good_quantity_ui: false,\n\t\t\tshow_bad_quantity_ui: false,\n\t\t\tshow_note_ui: false,\n\t\t\tshow_station_ui: false,\n\t\t\tshow_absence_job_ui: false,\n\t\t\tshow_absence_job_item_ui: false,\n\t\t\tshow_absence_branch_ui: false,\n\t\t\tshow_absence_department_ui: false,\n\t\t\tholiday_data_dic: {},\n\t\t\tgrid_div: null,\n\t\t\tactual_time_label: null,\n\t\t\tcolumn_maps: null,\n\t\t\taccmulated_order_map: {},\n\t\t\turl_args_before_set_date_url: {},\n\t\t\tallow_auto_switch: true,\n\n\t\t\tprevious_absence_policy_id: false,\n\t\t\tevents: {}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t////this._super('initialize', options );\n\t\tthis.permission_id = 'punch';\n\t\tthis.viewId = 'TimeSheet';\n\t\tthis.script_name = 'TimeSheetView';\n\t\tthis.context_menu_name = $.i18n._( 'TimeSheet' );\n\t\tthis.navigation_label = $.i18n._( 'TimeSheet' ) + ':';\n\t\tthis.api = TTAPI.APIPunch;\n\t\tthis.api_timesheet = TTAPI.APITimeSheet;\n\t\tthis.api_user_date_total = TTAPI.APIUserDateTotal;\n\t\tthis.api_date = TTAPI.APITTDate;\n\t\tthis.api_station = TTAPI.APIStation;\n\t\tthis.api_punch = TTAPI.APIPunch;\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\t\tthis.api_absence_policy = TTAPI.APIAbsencePolicy;\n\t\tthis.scroll_position = 0;\n\t\tthis.grid_dic = {};\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tinitEditView() {\n\t\tTTPromise.resolve( 'TimeSheetViewController', 'addclick' );\n\t\tsuper.initEditView();\n\t}\n\n\tonSubViewRemoved( is_cancel ) {\n\t\tif ( !is_cancel ) {\n\t\t\tthis.search();\n\t\t}\n\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.setDefaultMenu();\n\t\t} else {\n\t\t\tthis.setEditMenu();\n\t\t}\n\t}\n\n\tsetScrollPosition() {\n\t\tif ( this.scroll_position > 0 ) {\n\t\t\tthis.grid_div.scrollTop( this.scroll_position );\n\t\t}\n\t}\n\n\tpunchModeValidate( p_id ) {\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'punch_timesheet' ) &&\n\t\t\tPermissionManager.validate( p_id, 'manual_timesheet' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Refresh to clear warnning messages after saving from employee edit view\n\tupdateSelectUserAndRefresh( new_item ) {\n\n\t\tthis.employee_nav.updateSelectItem( new_item );\n\n\t\tthis.search();\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_quantity' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlocationUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_location' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'punch';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tstationValidate() {\n\t\tif ( PermissionManager.validate( 'station', 'enabled' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/* jshint ignore:start */\n\n\t//Special permission check for views, need override\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( !PermissionManager.validate( 'punch', 'view' ) && !PermissionManager.validate( 'punch', 'view_child' ) ) {\n\t\t\tthis.show_navigation_box = false;\n\t\t\tthis.show_search_tab = false;\n\t\t} else {\n\t\t\tthis.show_navigation_box = true;\n\t\t\tthis.show_search_tab = true;\n\t\t}\n\n\t\tif ( this.punchModeValidate() ) {\n\t\t\tthis.show_punch_mode_ui = true;\n\t\t} else {\n\t\t\tthis.show_punch_mode_ui = false;\n\t\t}\n\n\t\tthis.allow_auto_switch && this.show_punch_mode_ui && ( this.is_auto_switch = true );\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_note_ui = true;\n\t\t} else {\n\t\t\tthis.show_note_ui = false;\n\t\t}\n\n\t\tif ( this.locationUIValidate() ) {\n\t\t\tthis.show_location_ui = true;\n\t\t} else {\n\t\t\tthis.show_location_ui = false;\n\t\t}\n\n\t\tif ( this.stationValidate() ) {\n\t\t\tthis.show_station_ui = true;\n\t\t} else {\n\t\t\tthis.show_station_ui = false;\n\t\t}\n\n\t\tif ( this.jobUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate( 'absence' ) ) {\n\t\t\tthis.show_absence_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_absence_department_ui = false;\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\townerOrChildPermissionValidate( p_id, permission_name, selected_item ) {\n\t\tvar field;\n\t\tif ( permission_name && permission_name.indexOf( 'child' ) > -1 ) {\n\t\t\tfield = 'is_child';\n\t\t} else {\n\t\t\tfield = 'is_owner';\n\t\t}\n\n\t\tvar user = this.getSelectEmployee( true );\n\n\t\tif ( PermissionManager.validate( p_id, permission_name ) && ( !user || !Global.isSet( user[field] ) || ( user && user[field] ) ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\t\tthis.initDropDownOption( 'type' );\n\t\tthis.initDropDownOption( 'status' );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tdrag_and_drop: {\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop' ),\n\t\t\t\t\tid: this.viewId + 'drag_and_drop'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [\n\t\t\t\tContextMenuIconName.export_excel,\n\t\t\t\tContextMenuIconName.add,\n\t\t\t\tContextMenuIconName.copy,\n\t\t\t\tContextMenuIconName.copy_as_new\n\t\t\t],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'New<br>Punch' ),\n\t\t\t\t\tid: ContextMenuIconName.add_punch,\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\ticon: Icons.new_add,\n\t\t\t\t\tsort_order: 910\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'New<br>Absence' ),\n\t\t\t\t\tid: ContextMenuIconName.add_absence,\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\ticon: Icons.new_add,\n\t\t\t\t\tsort_order: 920\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Move' ),\n\t\t\t\t\tid: ContextMenuIconName.move,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.move\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Copy' ),\n\t\t\t\t\tid: ContextMenuIconName.drag_copy,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.copy\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'In/Out' ),\n\t\t\t\t\tid: ContextMenuIconName.in_out,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.in_out,\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'InOut' ),\n\t\t\t\t\tpermission: null\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Schedules' ),\n\t\t\t\t\tid: ContextMenuIconName.schedule,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.schedule\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Pay<br>Stubs' ),\n\t\t\t\t\tid: ContextMenuIconName.pay_stub,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.pay_stubs\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit<br>Employee' ),\n\t\t\t\t\tid: ContextMenuIconName.edit_employee,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.employee\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit Pay<br>Period' ),\n\t\t\t\t\tid: ContextMenuIconName.edit_pay_period,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.pay_period\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Accumulated<br>Time' ),\n\t\t\t\t\tid: ContextMenuIconName.accumulated_time,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.timesheet\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'ReCalculate<br>TimeSheet' ),\n\t\t\t\t\tid: ContextMenuIconName.re_calculate_timesheet,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.re_cal_timesheet\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Generate<br>Pay Stub' ),\n\t\t\t\t\tid: ContextMenuIconName.generate_pay_stub,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.re_cal_pay_stub\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Print' ),\n\t\t\t\t\tid: ContextMenuIconName.print,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.print,\n\t\t\t\t\ttype: RibbonSubMenuType.NAVIGATION,\n\t\t\t\t\titems: [ // Converted to new RibbonSubMenuNavItem() in BaseViewController.buildContextMenuModels().\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: $.i18n._( 'Summary' ),\n\t\t\t\t\t\t\tid: 'print_summary'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: $.i18n._( 'Detailed' ),\n\t\t\t\t\t\t\tid: 'print_detailed'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tpermission: true\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Map' ),\n\t\t\t\t\tid: ContextMenuIconName.map,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.map\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'request', 'add' ) ) {\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Add<br>Request' ),\n\t\t\t\t\tid: 'AddRequest',\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.request,\n\t\t\t\t\tpermission_result: true,\n\t\t\t\t\tpermission: true\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\topenEditView() {\n\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\tthis.previous_absence_policy_id = false;\n\n\t\tGlobal.setUINotready();\n\t\tTTPromise.add( 'init', 'init' );\n\t\tTTPromise.wait();\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.is_edit = true;\n\t\t\tthis.initEditViewUI( 'TimeSheet', 'TimeSheetEditView.html' );\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\n\t//set widget disablebility if view mode or edit mode\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean = false;\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar widgetContainer = this.edit_view_form_item_dic[key];\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean ) {\n\t\t\t\t\tdid_clean = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_date':\n\t\t\t\t\tcase 'punch_time':\n\t\t\t\t\tcase 'status_id':\n\t\t\t\t\tcase 'type_id':\n\t\t\t\t\tcase 'quantity':\n\t\t\t\t\tcase 'station_id':\n\t\t\t\t\tcase 'has_image':\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\tcase 'split_punch_control':\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\tcase 'src_object_id':\n\t\t\t\t\tcase 'override':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_date':\n\t\t\t\t\t\tif ( this.is_mass_adding ) {\n\t\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'quantity':\n\t\t\t\t\t\tif ( this.show_good_quantity_ui && this.show_bad_quantity_ui ) {\n\t\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'station':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_time':\n\t\t\t\t\tcase 'status_id':\n\t\t\t\t\tcase 'type_id':\n\t\t\t\t\tcase 'has_image':\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\tcase 'src_object_id':\n\t\t\t\t\tcase 'override':\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.css( 'opacity', 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_punch': { 'label': this.absence_model ? $.i18n._( 'Absence' ) : $.i18n._( 'Punch' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\t//Tab 0 start\n\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\t//Employee\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'first_last_name' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_punch_column1, '' );\n\n\t\t//Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'punch_time', validation_field: 'time_stamp' } );\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tthis.actual_time_label = $( '<span class=\\'widget-right-label\\'></span>' );\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.actual_time_label );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'punch_date', validation_field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TRangePicker( { field: 'punch_dates', validation_field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Absence Model\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'date_stamp' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Absence Model\n\t\t//Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'total_time', mode: 'time_unit' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Absence Model\n\t\t//Absence Policy TYpe\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'src_object_id',\n\t\t\tvalidation_field: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tthis.available_balance_info = $( '<img class=\"available-balance-info\" src=\"' + Global.getRealImagePath( 'images/infox16x16.png' ) + '\">' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.available_balance_info );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), [form_item_input], tab_punch_column1, '', widgetContainer, true );\n\n\t\t//Punch Type\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id' } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\tvar check_box = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tcheck_box.TCheckbox( { field: 'disable_rounding' } );\n\n\t\tvar label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Disable Rounding' ) + '</span>' );\n\n\t\twidgetContainer.append( form_item_input );\n\n\t\t// Check if view only mode. To prevent option appearing but disabled, as disabled checkboxes are not very clear - same in PunchViewController\n\t\tif ( this.is_viewing ) {\n\t\t\t// dev-note: not sure if we need to pass widgetContainer here, or if we can omit if its only one element now (due to the if is_viewing).\n\t\t\t// to be safe, will continue to use widgetContainer for this case. We only want to affect viewing mode (hide rounding checkbox), less risk of regression to keep widget container in.\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), form_item_input, tab_punch_column1, '', widgetContainer, true );\n\t\t} else {\n\t\t\twidgetContainer.append( label );\n\t\t\twidgetContainer.append( check_box );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), [form_item_input, check_box], tab_punch_column1, '', widgetContainer, true );\n\t\t}\n\n\t\t//In Out (Status)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In/Out' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\t//Default Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( !this.show_branch_ui ) {\n\t\t\t\tthis.detachElement( 'branch_id' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !this.show_absence_branch_ui ) {\n\t\t\t\tthis.detachElement( 'branch_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( !this.show_department_ui ) {\n\t\t\t\tthis.detachElement( 'department_id' );\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !this.show_absence_department_ui ) {\n\t\t\t\tthis.detachElement( 'department_id' );\n\t\t\t}\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.absence_model ) {\n\t\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( !this.show_absence_job_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//Job Item\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.absence_model ) {\n\t\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( !this.show_absence_job_item_ui ) {\n\t\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Quanitity\n\n\t\t\tvar good = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tgood.TTextInput( { field: 'quantity' } );\n\t\t\tgood.addClass( 'quantity-input' );\n\n\t\t\tvar good_label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Good' ) + ': </span>' );\n\n\t\t\tvar bad = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tbad.TTextInput( { field: 'bad_quantity' } );\n\t\t\tbad.addClass( 'quantity-input' );\n\n\t\t\tvar bad_label = $( '<span class=\\'widget-right-label\\'>/ ' + $.i18n._( 'Bad' ) + ': </span>' );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\twidgetContainer.append( good_label );\n\t\t\twidgetContainer.append( good );\n\t\t\twidgetContainer.append( bad_label );\n\t\t\twidgetContainer.append( bad );\n\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Quantity' ), [good, bad], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_bad_quantity_ui && !this.show_good_quantity_ui ) {\n\t\t\t\tthis.detachElement( 'quantity' );\n\t\t\t} else {\n\t\t\t\tif ( !this.show_bad_quantity_ui ) {\n\t\t\t\t\tbad_label.hide();\n\t\t\t\t\tbad.hide();\n\t\t\t\t}\n\n\t\t\t\tif ( !this.show_good_quantity_ui ) {\n\t\t\t\t\tgood_label.hide();\n\t\t\t\t\tgood.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( !this.show_note_ui ) {\n\t\t\tthis.detachElement( 'note' );\n\t\t}\n\n\t\t//Absence Mode\n\t\t//Override\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'override' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Override' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\t//Location\n\t\tif ( Global.getProductEdition() >= 15 ) {\n\n\t\t\tvar latitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlatitude.TText( { field: 'latitude' } );\n\t\t\tvar longitude = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tlongitude.TText( { field: 'longitude' } );\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box link-widget-box\\'></div>' );\n\t\t\tvar accuracy = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\taccuracy.TText( { field: 'position_accuracy' } );\n\t\t\tlabel = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Accuracy' ) + ':</span>' );\n\n\t\t\tvar map_icon = $( '<img class=\"widget-h-box-mapIcon\" src=\"framework/leaflet/images/marker-icon-red.png\" >' );\n\n\t\t\tthis.location_wrapper = $( '<div class=\"widget-h-box-mapLocationWrapper\"></div>' );\n\t\t\twidgetContainer.append( map_icon );\n\t\t\twidgetContainer.append( this.location_wrapper );\n\t\t\tthis.location_wrapper.append( latitude );\n\t\t\tthis.location_wrapper.append( $( '<span>, </span>' ) );\n\t\t\tthis.location_wrapper.append( longitude );\n\t\t\tthis.location_wrapper.append( label );\n\t\t\tthis.location_wrapper.append( accuracy );\n\t\t\tthis.location_wrapper.append( $( '<span>m</span>' ) );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Location' ), [latitude, longitude, accuracy], tab_punch_column1, '', widgetContainer, true );\n\t\t\twidgetContainer.click( function() {\n\t\t\t\t$this.onMapClick();\n\t\t\t} );\n\n\t\t\t// #2117 - Manual location only supported in edit because we need a punch record to append the data to.\n\t\t\tif ( ( !this.is_edit && !this.is_viewing ) || !this.show_location_ui ) {\n\t\t\t\twidgetContainer.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t}\n\t\t}\n\n\t\t//Station\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'station_id' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Station' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tform_item_input.click( function() {\n\t\t\tif ( $this.current_edit_record.station_id && $this.show_station_ui ) {\n\t\t\t\tIndexViewController.openEditView( $this, 'Station', $this.current_edit_record.station_id );\n\t\t\t}\n\n\t\t} );\n\n\t\t//Split Punch Control\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'split_punch_control' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Split Existing Punches' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t\tif ( this.is_mass_adding == false ) {\n\t\t\tthis.detachElement( 'split_punch_control' );\n\t\t}\n\n\t\t//Punch Image\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.IMAGE );\n\t\tform_item_input.TImage( { field: 'punch_image' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Image' ), form_item_input, tab_punch_column1, '', null, true, true );\n\t}\n\n\t/* jshint ignore:end */\n\n\tonEditStationDone() {\n\t\tthis.setStation();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tonSetSearchFilterFinished() {\n\t}\n\n\tonBuildBasicUIFinished() {\n\t}\n\n\tonBuildAdvUIFinished() {\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\n\t\tresultArray.push( dates[1] );\n\n\t\treturn resultArray;\n\t}\n\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = this.current_edit_record;\n\t\tvar i;\n\t\tif ( this.is_mass_editing ) {\n\t\t\trecord = [];\n\t\t\tvar len = this.mass_edit_record_ids.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar temp_item = Global.clone( this.current_edit_record );\n\t\t\t\ttemp_item.id = this.mass_edit_record_ids[i];\n\t\t\t\trecord.push( temp_item );\n\t\t\t}\n\t\t}\n\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tif ( !this.absence_model ) {\n\n\t\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.validateResult( result );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tthis.api_user_date_total['validate' + this.api_user_date_total.key_name]( record, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.clearErrorTips(); //Always clear error\n\n\t\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\t// Error: TypeError: this.current_edit_record is null in interface/html5/framework/jquery.min.js?v=9.0.5-20151222-094938 line 2 > eval line 1409\n\t\tif ( !this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.current_edit_record[key] = c_value;\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_dates':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\t\t\tif ( key === 'total_time' ) {\n\n\t\t\t\tif ( this.current_edit_record ) {\n\t\t\t\t\tthis.current_edit_record[key] = Global.parseTimeUnit( c_value );\n\t\t\t\t\t// parsed_total_time_obj = this.api_date.parseTimeUnit( c_value, { async: false } );\n\t\t\t\t\t// if ( parsed_total_time_obj ) {\n\t\t\t\t\t// \tthis.current_edit_record[key] = parsed_total_time_obj.getResult();\n\t\t\t\t\t// }\n\n\t\t\t\t\t//When handling absences, always remove the start/end time stamps otherwise they may be incorrect and trigger a validation error, as the user doesn't see them anyways.\n\t\t\t\t\t// The API will automatically calculated these on save anyways.\n\t\t\t\t\tthis.current_edit_record['start_time_stamp'] = false;\n\t\t\t\t\tthis.current_edit_record['end_time_stamp'] = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.current_edit_record[key] = c_value;\n\t\t\t}\n\n\t\t\tif ( key !== 'override' && this.edit_view_ui_dic['override'] ) {\n\t\t\t\tthis.edit_view_ui_dic['override'].setValue( true );\n\t\t\t\tthis.current_edit_record['override'] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.current_edit_record[key] = c_value;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tif ( key === 'total_time' ||\n\t\t\t\t\tkey === 'date_stamp' ||\n\t\t\t\t\tkey === 'punch_dates' ||\n\t\t\t\t\tkey === 'src_object_id' ) {\n\t\t\t\t\tthis.onAvailableBalanceChange();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tbuildSearchAndLayoutUI() {\n\t\tvar layout_div = this.search_panel.find( 'div #saved_layout_content_div' );\n\n\t\tvar form_item = $( Global.loadWidget( 'global/widgets/search_panel/FormItem.html' ) );\n\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tform_item_label.text( $.i18n._( 'Save Search As' ) + ': ' );\n\n\t\tthis.save_search_as_input = Global.loadWidget( 'global/widgets/text_input/TTextInput.html' );\n\t\tthis.save_search_as_input = $( this.save_search_as_input );\n\t\tthis.save_search_as_input.TTextInput();\n\n\t\tvar save_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Save' ) + '\\'></input>' );\n\n\t\tform_item_input_div.append( this.save_search_as_input );\n\t\tform_item_input_div.append( save_btn );\n\n\t\tvar $this = this;\n\t\tsave_btn.click( function() {\n\t\t\t$this.onSaveNewLayout();\n\t\t} );\n\n\t\t//Previous Saved Layout\n\n\t\tthis.previous_saved_layout_div = $( '<div class=\\'previous-saved-layout-div\\'></div>' );\n\n\t\tform_item_input_div.append( this.previous_saved_layout_div );\n\n\t\tform_item_label = $( '<span style=\\'margin-left: 5px\\' >' + $.i18n._( 'Previous Saved Searches' ) + ':</span>' );\n\t\tthis.previous_saved_layout_div.append( form_item_label );\n\n\t\tthis.previous_saved_layout_selector = $( '<select style=\\'margin-left: 5px\\' class=\\'t-select\\'>' );\n\t\tvar update_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Update' ) + '\\'></input>' );\n\t\tvar del_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Delete' ) + '\\'></input>' );\n\n\t\tupdate_btn.click( function() {\n\t\t\t$this.onUpdateLayout();\n\t\t} );\n\n\t\tdel_btn.click( function() {\n\t\t\t$this.onDeleteLayout();\n\t\t} );\n\n\t\tthis.previous_saved_layout_div.append( this.previous_saved_layout_selector );\n\t\tthis.previous_saved_layout_div.append( update_btn );\n\t\tthis.previous_saved_layout_div.append( del_btn );\n\n\t\tlayout_div.append( form_item );\n\n\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t}\n\n\tcheckTimesheetData() {\n\t\tif ( this.full_timesheet_data === true ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trender() {\n\n\t\tvar $this = this;\n\t\tsuper.render();\n\n\t\tvar control_bar = $( this.el ).find( '.control-bar' );\n\t\tvar date_chooser_div = control_bar.find( '.date-chooser-div' );\n\t\tvar employee_nav_div = control_bar.find( '.employee-nav-div' );\n\t\tvar action_chooser_div = control_bar.find( '.action-chooser-div' );\n\n\t\tif ( !this.show_navigation_box ) {\n\t\t\temployee_nav_div.css( 'display', 'none' );\n\t\t} else {\n\t\t\temployee_nav_div.css( 'display', 'block' );\n\t\t}\n\t\tthis.wage_btn = action_chooser_div.find( '#wages' );\n\t\tthis.wage_btn = this.wage_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.wages,\n\t\t\ttooltip: $.i18n._( 'Show Wages' )\n\t\t} );\n\t\tthis.wage_btn.click( function() {\n\t\t\t$this.onWageOrModeChange( 'wage' );\n\t\t} );\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'Wage' ) ) {\n\t\t\tthis.wage_btn.hide();\n\t\t} else {\n\t\t\tthis.wage_btn.show();\n\t\t}\n\n\t\tthis.timezone_btn = action_chooser_div.find( '#timezone' );\n\t\tthis.timezone_btn = this.timezone_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.all_employee,\n\t\t\ttooltip: $.i18n._( 'Use Employees Timezone' )\n\t\t} );\n\t\tthis.timezone_btn.click( function() {\n\t\t\t$this.onWageOrModeChange( 'timezone' );\n\t\t} );\n\n\t\tif ( !( PermissionManager.validate( 'punch', 'view' ) || PermissionManager.validate( 'punch', 'view_child' ) ) ) {\n\t\t\tthis.timezone_btn.hide();\n\t\t} else {\n\t\t\tthis.timezone_btn.show();\n\t\t}\n\n\t\t//Create Start Date Picker\n\t\tthis.start_date_picker = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tthis.start_date_picker.TDatePicker( { field: 'start_date' } );\n\t\tvar date_chooser = $( '<span class=\\'label\\'>' + $.i18n._( 'Date' ) + ':</span>' +\n\t\t\t'<img class=\\'left-arrow arrow\\' src=' + Global.getRealImagePath( 'images/left_arrow.png' ) + '>' +\n\t\t\t'<div class=\\'date-picker-div\\'></div>' +\n\t\t\t'<img class=\\'right-arrow arrow\\' src=' + Global.getRealImagePath( 'images/right_arrow.png' ) + '>' );\n\n\t\tdate_chooser_div.append( date_chooser );\n\t\tdate_chooser_div.find( '.date-picker-div' ).append( this.start_date_picker );\n\n\t\tvar date_left_arrow = date_chooser_div.find( '.left-arrow' );\n\t\tvar date_right_arrow = date_chooser_div.find( '.right-arrow' );\n\n\t\tdate_left_arrow.bind( 'click', function() {\n\t\t\t//Error: TypeError: $this.timesheet_columns is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-125919 line 2 > eval line 1569\n\t\t\tif ( !$this.checkTimesheetData() || !$this.timesheet_columns ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 7 ) ).format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( new_date );\n\n\t\t\t//see #2224 Cannot read property 'date' of undefined\n\t\t\t$this.setDefaultMenu();\n\t\t} );\n\n\t\tdate_right_arrow.bind( 'click', function() {\n\t\t\t//Error: TypeError: $this.timesheet_columns is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-125919 line 2 > eval line 1569\n\t\t\tif ( !$this.checkTimesheetData() || !$this.timesheet_columns ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 7 ) ).format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( new_date );\n\n\t\t\t//see #2224 Cannot read property 'date' of undefined\n\t\t\t$this.setDefaultMenu();\n\t\t} );\n\n\t\tthis.start_date_picker.bind( 'formItemChange', function() {\n\t\t\tvar select_date = $this.getSelectDate() ? $this.getSelectDate() : new Date().format();\n\t\t\t$this.first_build = true;\n\t\t\tcontinueChangeDate( select_date );\n\t\t} );\n\n\t\tfunction continueChangeDate( new_date ) {\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\n\t\t\tfunction reset() {\n\t\t\t\t$this.setDatePickerValue( LocalCacheData.last_timesheet_selected_date );\n\t\t\t}\n\n\t\t\tfunction doNext() {\n\t\t\t\t$this.setDatePickerValue( new_date );\n\t\t\t\t$this.search();\n\t\t\t}\n\t\t}\n\n\t\t//Create Employee Navigation\n\n\t\tvar label = employee_nav_div.find( '.navigation-label' );\n\t\tvar left_click = employee_nav_div.find( '.left-click' );\n\t\tvar right_click = employee_nav_div.find( '.right-click' );\n\t\tvar navigation_widget_div = employee_nav_div.find( '.navigation-widget-div' );\n\n\t\tthis.employee_nav = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tvar default_args = { permission_section: 'punch' };\n\t\tthis.employee_nav = this.employee_nav.AComboBox( {\n\t\t\tid: 'employee_navigation',\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tinit_data_immediately: true,\n\t\t\tdefault_args: default_args,\n\t\t\tshow_search_inputs: true,\n\t\t\talways_include_columns: ['default_branch_id', 'default_department_id', 'default_job_id', 'default_job_item_id'],\n\t\t\twidth: 200,\n\t\t\tis_static_width: true, //Use static width so the left/right navigation arrows don't move around based on the length of the employees name.\n\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t$this.userValueSet( val );\n\t\t\t} )\n\t\t} );\n\n\t\tnavigation_widget_div.append( this.employee_nav );\n\t\tthis.employee_nav.bind( 'formItemChange', function() {\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'navigation', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_user_id = $this.getSelectEmployee();\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t}\n\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t$this.first_build = true;\n\t\t\t\t/* jshint ignore:start */\n\t\t\t\tif ( LocalCacheData.last_timesheet_selected_user != selected_user_id ) {\n\t\t\t\t\t$this.search();\n\t\t\t\t}\n\t\t\t\t/* jshint ignore:end */\n\t\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t\t\t$this.absence_model = false;\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t}\n\n\t\t\tfunction reset() {\n\t\t\t\t$this.employee_nav.setValue( LocalCacheData.last_timesheet_selected_user );\n\t\t\t}\n\t\t} );\n\n\t\tthis.employee_nav.bind( 'initSourceComplete', function() {\n\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t} );\n\n\t\tleft_click.attr( 'src', Global.getRealImagePath( 'images/left_arrow.png' ) );\n\t\tright_click.attr( 'src', Global.getRealImagePath( 'images/right_arrow.png' ) );\n\t\tright_click.click( function() {\n\t\t\tif ( right_click.hasClass( 'disabled' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'right-arrow', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\t\t\tvar source_data = $this.employee_nav.getSourceData();\n\t\t\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\t\t\t\tvar next_select_item;\n\t\t\t\tif ( source_data && selected_index < ( source_data.length - 1 ) ) {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( ( selected_index + 1 ) );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t} else if ( source_data && selected_index === source_data.length - 1 ) {\n\t\t\t\t\t//onADropDownSearch() makes async calls, so we need to have a doNextDone() callback to trigger to avoid race conditions.\n\t\t\t\t\t$this.employee_nav.onADropDownSearch( 'unselect_grid', ( current_open_page + 1 ), 'first', doNextDone, false ); //Skip triggering FormItemChange as we call search() ourself below anyways, and doing both can cause race conditions and incorrect data to be displayed.\n\t\t\t\t} else {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( 0 );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction doNextDone() {\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t}\n\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t$this.first_build = true;\n\t\t\t\t$this.search();\n\t\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t\t}\n\n\t\t} );\n\n\t\tleft_click.click( function() {\n\t\t\tif ( left_click.hasClass( 'disabled' ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t$this.doNextIfNoValueChangeInManualGrid( doNext );\n\t\t\tGlobal.triggerAnalyticsEditViewNavigation( 'left-arrow', $this.viewId );\n\n\t\t\tfunction doNext() {\n\t\t\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\t\t\t//var source_data = $this.employee_nav.getSourceData();\n\t\t\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\t\t\t\tvar next_select_item;\n\t\t\t\tif ( selected_index > 0 ) {\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( ( selected_index - 1 ) );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t} else if ( current_open_page > 1 ) {\n\t\t\t\t\t//onADropDownSearch() makes async calls, so we need to have a doNextDone() callback to trigger to avoid race conditions.\n\t\t\t\t\t$this.employee_nav.onADropDownSearch( 'unselect_grid', ( current_open_page - 1 ), 'last', doNextDone, false ); //Skip triggering FormItemChange as we call search() ourself below anyways, and doing both can cause race conditions and incorrect data to be displayed.\n\t\t\t\t} else {\n\t\t\t\t\t// Error: TypeError: source_data is null in /interface/html5/framework/jquery.min.js?v=8.0.6-20150417-084000 line 2 > eval line 1691\n\t\t\t\t\tnext_select_item = $this.employee_nav.getItemByIndex( 0 );\n\t\t\t\t\t$this.employee_nav.setValue( next_select_item );\n\t\t\t\t\tdoNextDone();\n\t\t\t\t}\n\n\t\t\t\tfunction doNextDone() {\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t$this.reSetURL();\n\t\t\t\t\t}\n\t\t\t\t\t$this.allow_auto_switch && ( $this.is_auto_switch = true );\n\t\t\t\t\t$this.first_build = true;\n\t\t\t\t\t$this.search();\n\t\t\t\t\t$this.setEmployeeNavArrowsStatus();\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\n\t\tlabel.text( $.i18n._( 'Employee' ) + ':' );\n\t\t//Create timesheet mode toggle buttons\n\t\tthis.toggle_button = $( this.el ).find( '.toggle-button-div' );\n\t\tvar data_provider = [\n\t\t\t{ label: $.i18n._( 'Punch' ), value: 'punch' },\n\t\t\t{ label: $.i18n._( 'Manual' ), value: 'manual' }\n\t\t];\n\t\tthis.toggle_button = this.toggle_button.TToggleButton( { data_provider: data_provider } );\n\t\tif ( !this.show_punch_mode_ui ) {\n\t\t\tthis.toggle_button.remove();\n\t\t} else {\n\t\t\tthis.toggle_button.bind( 'change', function( e, result ) {\n\t\t\t\t$this.onWageOrModeChange( 'manual' );\n\t\t\t} );\n\t\t}\n\t}\n\n\tdoNextIfNoValueChangeInManualGrid( doNext, reset, mode ) {\n\t\t!mode && ( mode = 'manual' );\n\t\tvar $this = this;\n\t\tif ( this.getPunchMode() === mode && this.editor ) {\n\t\t\tvar records = this.editor.getValue();\n\t\t\tif ( records.length > 0 ) {\n\t\t\t\tTAlertManager.showConfirmAlert( Global.modify_alert_message, '', function( flag ) {\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\t$this.wait_auto_save && clearTimeout( $this.wait_auto_save );\n\t\t\t\t\t\tdoNext();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treset && reset();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tdoNext();\n\t\t\t}\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\t}\n\n\tgetPunchMode() {\n\t\t//Mode toggle does not exist if the user doesn't have access to it.\n\t\tif ( this.toggle_button ) {\n\t\t\treturn this.toggle_button.getValue();\n\t\t} else {\n\t\t\treturn 'punch';\n\t\t}\n\t}\n\n\thandleOverrideUserPreferenceCookie( user_id ) {\n\t\tif ( this.timezone_btn.getValue() == true ) {\n\t\t\tsetCookie( 'OverrideUserPreference', '{ \"user_id\": \"' + user_id + '\"}' );\n\t\t} else {\n\t\t\tdeleteCookie( 'OverrideUserPreference' );\n\t\t}\n\t}\n\n\tonWageOrModeChange( id ) {\n\t\tthis.first_build = true;\n\t\tvar $this = this;\n\t\tif ( id === 'wage' ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetWage );\n\t\t} else if ( id === 'timezone' ) {\n\t\t\tthis.handleOverrideUserPreferenceCookie( this.getSelectEmployee() );\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetTimeZone );\n\t\t} else if ( id === 'manual' ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, resetManual, 'punch' );\n\t\t}\n\n\t\tfunction resetWage() {\n\t\t\t$this.wage_btn.setValue( !$this.wage_btn.getValue( true ) );\n\t\t}\n\n\t\tfunction resetTimeZone() {\n\t\t\t$this.timezone_btn.setValue( !$this.timezone_btn.getValue( true ) );\n\t\t}\n\n\t\tfunction resetManual() {\n\t\t\t$this.toggle_button.setValue( 'manual' );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t$this.reSetURL();\n\t\t\t}\n\t\t\t$this.search();\n\t\t\t$this.setDefaultMenu();\n\t\t}\n\t}\n\n\tsetEmployeeNavArrowsStatus() {\n\t\tvar $this = this;\n\t\tvar employee_nav_div = $( this.el ).find( '.employee-nav-div' );\n\t\tvar left_click = employee_nav_div.find( '.left-click' );\n\t\tvar right_click = employee_nav_div.find( '.right-click' );\n\t\tvar selected_index = $this.employee_nav.getSelectIndex();\n\t\tvar source_data = $this.employee_nav.getSourceData();\n\n\t\tright_click.removeClass( 'disabled' );\n\t\tleft_click.removeClass( 'disabled' );\n\n\t\tvar pager_data = $this.employee_nav.getPagerData();\n\t\tvar current_open_page = $this.employee_nav.getCurrentOpenPage();\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of null in /interface/html5/#!m=TimeSheet&date=20150102&user_id=null line 1698\n\t\tif ( !source_data || ( selected_index === source_data.length - 1 && current_open_page === pager_data.last_page_number ) ) {\n\t\t\tright_click.addClass( 'disabled' );\n\t\t}\n\n\t\tif ( !source_data || ( selected_index === 0 && current_open_page === 1 ) ) {\n\t\t\tleft_click.addClass( 'disabled' );\n\t\t}\n\t}\n\n\tonClearSearch() {\n\t\tvar do_update = false;\n\t\tvar default_layout_id;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tdefault_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\t\t\tdo_update = true;\n\n\t\t} else {\n\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'setSelectGridData' of null in /interface/html5/#!m=TimeSheet&date=20141213&user_id=29715 line 1738\n\t\t\tif ( this.column_selector ) {\n\t\t\t\tthis.column_selector.setSelectGridData( this.default_display_columns );\n\t\t\t}\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of null in /interface/html5/#!m=TimeSheet&date=20150125&user_id=53288 line 1742\n\t\t\tif ( this.sort_by_selector ) {\n\t\t\t\tthis.sort_by_selector.setValue( null );\n\t\t\t}\n\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args;\n\t\tif ( do_update ) {\n\t\t\targs = {};\n\t\t\targs.id = default_layout_id;\n\t\t\targs.data = {};\n\t\t\targs.data.filter_data = filter_data;\n\n\t\t}\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonUpdateLayout() {\n\n\t\tvar selectId = $( this.previous_saved_layout_selector ).children( 'option:selected' ).attr( 'value' );\n\t\tvar layout_name = $( this.previous_saved_layout_selector ).children( 'option:selected' ).text();\n\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.id = selectId;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveNewLayout( default_layout_name ) {\n\t\tvar layout_name;\n\t\tif ( Global.isSet( default_layout_name ) ) {\n\t\t\tlayout_name = default_layout_name;\n\t\t} else {\n\t\t\tlayout_name = this.save_search_as_input.getValue();\n\t\t}\n\n\t\tif ( !layout_name || layout_name.length < 1 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.script = this.script_name;\n\t\targs.name = layout_name;\n\t\targs.is_default = false;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSearch() {\n\t\tGlobal.setUINotready();\n\t\tTTPromise.add( 'init', 'init' );\n\t\tTTPromise.wait();\n\n\t\tthis.temp_adv_filter_data = null;\n\t\tthis.temp_basic_filter_data = null;\n\n\t\tthis.getSearchPanelFilter();\n\t\tvar default_layout_id;\n\t\tvar layout_name;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tdefault_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tlayout_name = BaseViewController.default_layout_name;\n\n\t\t\tif ( !default_layout_id ) {\n\t\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\t\t}\n\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.id = default_layout_id;\n\t\targs.data = {};\n\t\targs.data.filter_data = filter_data;\n\n\t\tProgressBar.showOverlay();\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tupdateManualGrid() {\n\t\tvar $this = this;\n\t\tvar start_date_string = this.start_date_picker.getValue();\n\t\tvar user_id = this.getSelectEmployee();\n\t\tProgressBar.noProgressForNextCall();\n\n\t\t$this.handleOverrideUserPreferenceCookie( user_id );\n\t\t$this.api_timesheet.getTimeSheetData( user_id, start_date_string, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tProgressBar.removeNanobar();\n\t\t\t\t$this.full_timesheet_data = result.getResult();\n\t\t\t\tif ( $this.full_timesheet_data === true || !$this.full_timesheet_data.hasOwnProperty( 'timesheet_dates' ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$this.start_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.start_display_date );\n\t\t\t\t$this.end_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.end_display_date );\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t$this.initInsideEditorData( true );\n\t\t\t\t$this.accumulated_time_source_map = {};\n\t\t\t\t$this.branch_source_map = {};\n\t\t\t\t$this.department_source_map = {};\n\t\t\t\t$this.job_source_map = {};\n\t\t\t\t$this.job_item_source_map = {};\n\t\t\t\t$this.premium_source_map = {};\n\t\t\t\t$this.accumulated_total_grid_source_map = {};\n\t\t\t\t$this.accumulated_time_source = [];\n\t\t\t\t$this.branch_source = [];\n\t\t\t\t$this.department_source = [];\n\t\t\t\t$this.job_source = [];\n\t\t\t\t$this.job_item_source = [];\n\t\t\t\t$this.premium_source = [];\n\t\t\t\t$this.accumulated_total_grid_source = [];\n\t\t\t\t$this.verification_grid_source = [];\n\t\t\t\t$this.onReloadSubGridResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\t// Dev Note: TODO/REFACTOR: search() params here differ from BaseViewController.search() this could cause confusion or issues,\n\t// Currently means any search() calls in baseview using the callback param will not work here in TimeSheet.\n\tsearch( setDefaultMenu, force ) {\n\n\t\tthis.accumulated_time_cells_array = []; //reset array since the select cell is clean\n\t\tthis.premium_cells_array = []; //reset array since the select cell is clean\n\t\tthis.accumulated_time_source_map = {};\n\t\tthis.branch_source_map = {};\n\t\tthis.department_source_map = {};\n\t\tthis.job_source_map = {};\n\t\tthis.job_item_source_map = {};\n\t\tthis.premium_source_map = {};\n\t\tthis.accumulated_total_grid_source_map = {};\n\t\tthis.accumulated_time_source = [];\n\t\tthis.branch_source = [];\n\t\tthis.department_source = [];\n\t\tthis.job_source = [];\n\t\tthis.job_item_source = [];\n\t\tthis.premium_source = [];\n\t\tthis.absence_source = [];\n\t\tthis.accumulated_total_grid_source = [];\n\t\tthis.punch_note_grid_source = [];\n\t\tthis.verification_grid_source = [];\n\t\tthis.select_cells_Array = [];\n\t\tthis.select_punches_array = [];\n\t\tthis.branch_cell_count = 0;\n\t\tthis.department_cell_count = 0;\n\t\tthis.premium_cell_count = 0;\n\t\tthis.job_cell_count = 0;\n\t\tthis.task_cell_count = 0;\n\t\tthis.absence_cell_count = 0;\n\t\tthis.punch_note_account = 0;\n\t\tthis.select_punches_array = [];\n\n\t\tvar $this = this;\n\t\tvar filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\tvar start_date_string = ( this.start_date_picker ) ? this.start_date_picker.getValue() : '';\n\t\tvar user_id = this.getSelectEmployee();\n\t\tif ( !force ) {\n\t\t\tthis.doNextIfNoValueChangeInManualGrid( doNext, reset );\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\n\t\tfunction reset() {\n\t\t\t$( '.button-rotate' ).removeClass( 'button-rotate' );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tLocalCacheData.last_timesheet_selected_date = start_date_string;\n\t\t\tLocalCacheData.last_timesheet_selected_user = $this.getSelectEmployee();\n\n\t\t\tif ( LocalCacheData.last_timesheet_selected_user ) {\n\t\t\t\tLocalCacheData.last_timesheet_selected_show_wage = ( $this.wage_btn ) ? $this.wage_btn.getValue( true ) : false;\n\t\t\t\tLocalCacheData.last_timesheet_selected_timezone = ( $this.timezone_btn ) ? $this.timezone_btn.getValue( true ) : false;\n\t\t\t\tif ( $this.toggle_button ) {\n\t\t\t\t\tLocalCacheData.last_timesheet_selected_punch_mode = $this.toggle_button.getValue();\n\t\t\t\t}\n\t\t\t\tvar args = { filter_data: filter_data };\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t//Error: TypeError: this.api_timesheet.getTimeSheetData is not a function in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-155153 line 2 > eval line 1885\n\t\t\t\tif ( !$this.api_timesheet || !$this.api_timesheet || typeof ( $this.api_timesheet.getTimeSheetData ) !== 'function' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( user_id ) {\n\t\t\t\t\t$this.handleOverrideUserPreferenceCookie( user_id );\n\t\t\t\t\t$this.api_timesheet.getTimeSheetData( user_id, start_date_string, args, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\t$this.full_timesheet_data = result.getResult();\n\t\t\t\t\t\t\tif ( $this.full_timesheet_data === true || !$this.full_timesheet_data.hasOwnProperty( 'timesheet_dates' ) ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.start_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.start_display_date );\n\t\t\t\t\t\t\t$this.end_date = Global.strToDate( $this.full_timesheet_data.timesheet_dates.end_display_date );\n\n\t\t\t\t\t\t\t$this.buildCalendars();\n\n\t\t\t\t\t\t\tif ( setDefaultMenu ) {\n\t\t\t\t\t\t\t\t$this.setDefaultMenu( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.searchDone();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildVerificationGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\t\tif ( !Global.isSet( this.verification_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#verification_grid' );\n\t\t\tgrid.attr( 'id', this.ui_id + '_verification_grid' );  //Grid's id is ScriptName + _grid\n\t\t}\n\t\tvar grid_id = this.ui_id + '_verification_grid';\n\n\t\tvar column = {\n\t\t\tname: 'pay_period',\n\t\t\tindex: 'pay_period',\n\t\t\tlabel: $.i18n._( 'Pay Period' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column );\n\n\t\tcolumn = {\n\t\t\tname: 'verification',\n\t\t\tindex: 'verification',\n\t\t\tlabel: $.i18n._( 'Window' ),\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false\n\t\t};\n\t\tcolumns.push( column );\n\n\t\tif ( this.verification_grid ) {\n\t\t\tthis.verification_grid.unload();\n\t\t\tthis.verification_grid = null;\n\t\t\tthis.grid_dic.verification_grid = null;\n\t\t}\n\n\t\tthis.verification_grid = this.grid_dic.verification_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\tonResizeGrid: false\n\t\t}, columns );\n\t}\n\n\tbuildPunchNoteGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\t\tif ( !Global.isSet( this.punch_note_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#punch_note_grid' );\n\n\t\t\t//Grid's id is ScriptName + _grid\n\t\t\tgrid.attr( 'id', this.ui_id + '_punch_note_grid' );\n\t\t}\n\n\t\t//if only put one column in grid. There is a UI bug\n\t\tvar first_column = {\n\t\t\tname: 'invisible_column',\n\t\t\tindex: 'invisible_column',\n\t\t\tlabel: ' ',\n\t\t\twidth: 1,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\thidden: true\n\t\t};\n\t\tcolumns.push( first_column );\n\n\t\tvar second_column = {\n\t\t\tname: 'note',\n\t\t\tindex: 'note',\n\t\t\tlabel: ' ',\n\t\t\twidth: 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tcellattr: function( index, value ) {\n\t\t\t\treturn 'title=\"' + value + '\"';\n\t\t\t}\n\t\t};\n\t\tcolumns.push( second_column );\n\t\tvar grid_id = this.ui_id + '_punch_note_grid';\n\t\tif ( this.punch_note_grid ) {\n\t\t\tthis.punch_note_grid.unload();\n\t\t\tthis.punch_note_grid = null;\n\t\t\tthis.grid_dic.punch_note_grid = null;\n\t\t}\n\n\t\tthis.punch_note_grid = this.grid_dic.punch_note_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\tonResizeGrid: function() {\n\t\t\t\t$this.setPunchNoteGridSize();\n\t\t\t}\n\t\t}, columns );\n\n\t\tthis.setGridHeaderBar( 'punch_note_grid', 'Punch Notes' );\n\n\t\t// setGridHeaderBar() sets the width to 100vw (and sets grid title), but this causes issue as the grid is not full width of the screen unlike the others. Therefore, overide the default width of 100vw with 100%.\n\t\t// Related to issue #2712, and (via bisect) appears to be caused by 4e92c7ab463d9b3418735c0db302a50efc43e8bf when jquery.jqgrid.extend.js was removed in a JS upgrade fix.\n\t\tvar table = $( this.grid_dic.punch_note_grid.grid ).parents( '.ui-jqgrid-view' ).find( '.ui-jqgrid-hbox table' ); //grab the hbox\n\t\ttable.css( 'width', '100%' );\n\t}\n\n\tgetAccumulatedTotalGridPayperiodHeader() {\n\t\tthis.pay_period_header = $.i18n._( 'No Pay Period' );\n\n\t\tvar pay_period_id = this.timesheet_verify_data.pay_period_id;\n\n\t\tif ( pay_period_id && this.pay_period_data ) {\n\n\t\t\tfor ( var key in this.pay_period_data ) {\n\t\t\t\tvar pay_period = this.pay_period_data[key];\n\t\t\t\tif ( pay_period.id === pay_period_id ) {\n\t\t\t\t\tvar start_date = Global.strToDate( pay_period.start_date ).format();\n\t\t\t\t\tvar end_date = Global.strToDate( pay_period.end_date ).format();\n\t\t\t\t\tthis.pay_period_header = start_date + ' ' + $.i18n._( 'to' ) + ' ' + end_date;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildAccumulatedTotalGrid() {\n\t\tvar $this = this;\n\n\t\tvar columns = [];\n\n\t\tif ( !Global.isSet( this.accumulated_total_grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#accumulated_total_grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_accumulated_total_grid' );\t//Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_accumulated_total_grid' );\n\t\t}\n\n\t\tvar punch_column_width = 100;\n\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\tpunch_column_width = null;\n\t\t}\n\n\t\tvar punch_in_out_column = {\n\t\t\tname: 'punch_info',\n\t\t\tindex: 'punch_info',\n\t\t\tlabel: ' ',\n\t\t\twidth: punch_column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\t\tcolumns.push( punch_in_out_column );\n\n\t\tvar start_date_str = this.start_date.format( Global.getLoginUserDateFormat() );\n\t\tvar end_date_str = this.end_date.format( Global.getLoginUserDateFormat() );\n\n\t\tthis.getAccumulatedTotalGridPayperiodHeader();\n\n\t\tvar column_width = 100;\n\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\tcolumn_width = 150;\n\t\t}\n\t\tvar column_1 = {\n\t\t\tname: 'week',\n\t\t\tindex: 'week',\n\t\t\tlabel: start_date_str + ' ' + $.i18n._( 'to' ) + ' ' + end_date_str,\n\t\t\twidth: column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\t\tvar column_2 = {\n\t\t\tname: 'pay_period',\n\t\t\tindex: 'pay_period',\n\t\t\tlabel: this.pay_period_header,\n\t\t\twidth: column_width,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat\n\t\t};\n\n\t\tcolumns.push( column_1 );\n\t\tcolumns.push( column_2 );\n\n\t\tvar grid_id = this.ui_id + '_accumulated_total_grid';\n\t\tif ( Global.isSet( this.accumulated_total_grid ) == true ) {\n\t\t\tthis.accumulated_total_grid.unload();\n\t\t\tthis.accumulated_total_grid = null;\n\t\t\tthis.grid_dic.accumulated_total_grid = null;\n\t\t}\n\n\t\tthis.accumulated_total_grid = this.grid_dic.accumulated_total_grid = new TTGrid( grid_id, {\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tverticalResize: false,\n\t\t\tonResizeGrid: false\n\t\t}, columns );\n\n\t\tvar accumulated_total_grid_title = $( this.el ).find( '.accumulated-total-grid-title' );\n\t\taccumulated_total_grid_title.css( 'display', 'block' );\n\t\tthis.setAccumulatedTotalGridPayPeriodHeaders();\n\t}\n\n\t//Override and disable as bindTimeSheetGridColumnEvents() is used at a different point instead.\n\tbindGridColumnEvents() {\n\t}\n\n\t//Bind column click event to change sort type and save columns to t_grid_header_array to use to set column style (asc or desc)\n\tbindTimeSheetGridColumnEvents() {\n\t\tvar display_columns = this.grid.getGridParam( 'colModel' );\n\n\t\t//Exception taht display column not existed, not sure when this will happen, but may there will be a second time load if this happen\n\t\tif ( !display_columns ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar len = display_columns.length;\n\n\t\tthis.t_grid_header_array = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column_info = display_columns[i];\n\t\t\tvar column_header = $( $( this.el ).find( '#gbox_' + this.ui_id + '_grid' ).find( 'div #jqgh_' + this.ui_id + '_grid_' + column_info.name ) );\n\n\t\t\tthis.t_grid_header_array.push( column_header.TGridHeader() );\n\t\t\tcolumn_header.bind( 'click', onColumnHeaderClick );\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tfunction onColumnHeaderClick( e ) {\n\t\t\tvar field = $( this ).attr( 'id' );\n\t\t\tfield = field.substring( 10 + $this.ui_id.length + 1, field.length );\n\n\t\t\tif ( field === 'cb' || field === 'punch_info' ) { //first column, check box column.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date = Global.strToDate( field, $this.full_format );\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t$this.highLightSelectDay();\n\t\t\t\t$this.reLoadSubGridsSource();\n\t\t\t\t//select first punch cell when clicking the header row\n\t\t\t\t$( $( '.timesheet-grid tr#1 td' )[$( 'th.highlight-header' ).index()] ).click();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tcheckIsSelectedAbsenceCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.absence_select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.absence_select_cells_Array[i];\n\t\t\tif ( cell.row_id == row_id && cell.cell_index === cell_index ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildAbsenceGrid() {\n\t\tvar $this = this;\n\n\t\tvar grid_id = 'absence_grid';\n\t\tvar title = $.i18n._( 'Absence' );\n\n\t\tif ( this[grid_id] ) {\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t} else {\n\t\t\tvar grid = $( this.el ).find( '#absence_grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_absence_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_absence_grid' );\n\t\t}\n\n\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( this.ui_id + '_absence_grid', {\n\t\t\tsortable: false,\n\t\t\thoverrows: false,\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onGridDblClickRow( 'absence' );\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tif ( !$this.checkIsSelectedAbsenceCell( row_id, cell_index ) ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t$this.onCellSelect( 'absence_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'absence_grid', row_id, this );\n\n\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t} else {\n\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\tif ( $this.absence_grid && $this.absence_grid.getGridWidth() != $( 'body' ).width() ) {\n\t\t\t\t\t$this.absence_grid.setGridWidth( $( 'body' ).width() );\n\t\t\t\t}\n\t\t\t},\n\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar cell_index = 0;\n\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t} else {\n\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t}\n\n\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t$this.onCellSelect( 'absence_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'absence_grid', row_id, this );\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmultiselectPosition: 'none',\n\t\t\twinMultiSelect: false,\n\t\t\tverticalResize: false\n\n\t\t}, this.timesheet_columns, $.i18n._( 'Absence' ) );\n\n\t\tthis.bindTimeSheetGridColumnEvents();\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic.absence_grid.grid.setGridWidth( $( 'body' ).width() );\n\t\t}\n\t}\n\n\tcheckIsSelectedPunchCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.select_cells_Array[i];\n\t\t\tif ( cell.row_id == row_id && cell.cell_index == cell_index ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Paired secondary row coloring for timesheet\n\t */\n\tcolorTimeSheetRows() {\n\t\tvar $trs = $( '.timesheet-grid-div .timesheet-grid tr' );\n\t\tvar skips = 0;\n\t\tvar colored = 0;\n\t\tfor ( var i = 1; i < $trs.length - 1; i++ ) {\n\t\t\tif ( skips == 2 && colored < 2 ) {\n\t\t\t\t$( $trs[i] ).addClass( 'ui-priority-secondary' );\n\t\t\t\tcolored++;\n\t\t\t} else if ( colored == 2 ) {\n\t\t\t\tskips = 1; //Resets to 1 because we're skipping this iteration.\n\t\t\t\tcolored = 0;\n\t\t\t} else {\n\t\t\t\tskips++;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildTimeSheetGrid() {\n\t\tvar grid_id = this.ui_id + '_grid';\n\t\tvar $this = this;\n\n\t\tif ( this.timesheet_grid && !this.first_build ) {\n\t\t\t$.jgrid.guid = 1;\n\t\t} else {\n\t\t\tif ( this.timesheet_grid ) {\n\t\t\t\tthis.timesheet_grid.unload();\n\t\t\t\tthis.timesheet_grid = null;\n\t\t\t\t$.jgrid.guid = 1;\n\t\t\t}\n\t\t\tvar grid = $( this.el ).find( '#timesheet_grid' );\n\t\t\tgrid.attr( 'id', grid_id );\t//Grid's id is ScriptName + _grid\n\n\t\t\tvar grid_setup_data = {\n\t\t\t\taltRows: false,\n\t\t\t\tsortable: false,\n\t\t\t\thoverrows: false,\n\t\t\t\tondblClickRow: function( row_id, row_index, cell_index, e ) {\n\t\t\t\t\tvar row = $this.getRowData( 'timesheet_grid', row_id );\n\n\t\t\t\t\t//Make sure double click event doesn't get triggered on a request row (authorized/pending/declined)\n\t\t\t\t\t// as we are already in the process of navigating to that view, so it causes edit view and navigation operations to occur at the same time.\n\t\t\t\t\tif ( row.type !== TimeSheetViewController.REQUEST_ROW ) {\n\t\t\t\t\t\t$this.onGridDblClickRow();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\t\tif ( !$this.checkIsSelectedPunchCell( row_id, cell_index ) ) {\n\t\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t\t$this.onSelectRow( 'timesheet_grid', row_id, this );\n\n\t\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\tif ( $( '.edit-view:visible' ).length == 0 ) {\n\t\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.setEditMenu();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\t\t\tif ( $this.editor ) {\n\t\t\t\t\t\t\t$this.setManualTimeSheetGridSize();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.setGridSize();\n\t\t\t\t\t$this.setTimeSheetGridPayPeriodHeaders();\n\t\t\t\t\t$this.setTimeSheetGridHolidayHeaders();\n\t\t\t\t},\n\t\t\t\tgridComplete: function() {\n\t\t\t\t\t$this.colorTimeSheetRows();\n\t\t\t\t},\n\t\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar cell_index = 0;\n\t\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'timesheet_grid', row_id, this );\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\tverticalResize: false\n\t\t\t};\n\n\t\t\tthis.timesheet_grid = this.grid_dic.timesheet_grid = this.grid = new TTGrid( grid_id, grid_setup_data, this.timesheet_columns );\n\t\t\tthis.grid_dic.timesheet_grid.grid.setGridWidth( $( 'body' ).width() );\n\t\t}\n\n\t\tthis.grid_div.scroll( function( e ) {\n\t\t\t$this.scroll_position = $this.grid_div.scrollTop();\n\t\t} );\n\t}\n\n\tonGridDblClickRow( name ) {\n\t\tvar len = this.context_menu_array.length;\n\t\tvar need_break = false;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tif ( need_break ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tif ( context_btn.is( ':visible' ) && !context_btn.hasClass( 'disable-image' ) ) {\n\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\tthis.onEditClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tif ( need_break ) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcontext_btn = $( this.context_menu_array[i] );\n\t\t\tid = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tneed_break = true;\n\t\t\t\t\tif ( context_btn.is( ':visible' ) && !context_btn.hasClass( 'disable-image' ) ) {\n\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\tthis.onViewClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tcontext_btn = $( this.context_menu_array[i] );\n\t\t\tid = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tswitch ( id ) {\n\t\t\t\tcase 'addAbsenceIcon':\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\tcase ContextMenuIconName.add_punch:\n\t\t\t\t\t// There are 2 add icons, one for punch and one for absence.\n\t\t\t\t\t// We must ensure to check the right one to provide permissions for the add click or absence will be allowed based on the punch permissions\n\t\t\t\t\tif ( name == 'absence' && id != 'addAbsenceIcon' ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( context_btn.is( ':visible' ) && !context_btn.hasClass( 'disable-image' ) ) {\n\t\t\t\t\t\tif ( this.isPunchCells() ) {\n\t\t\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t\t\tthis.onAddClick();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tisPunchCells() {\n\t\tvar result = false;\n\t\tvar cell = this.select_cells_Array && this.select_cells_Array.length > 0 && this.select_cells_Array[0];\n\t\tvar row = cell && this.timesheet_data_source[parseInt( cell.row_id ) - 1];\n\t\tif ( row && row.type === TimeSheetViewController.PUNCH_ROW ) {\n\t\t\tresult = true;\n\t\t} else if ( this.absence_select_cells_Array && this.absence_select_cells_Array.length > 0 ) {\n\t\t\tresult = true;\n\t\t}\n\t\treturn result;\n\t}\n\n\tbuildAccumulatedGrid() {\n\t\tvar $this = this;\n\n\t\tvar grid_id = 'accumulated_time_grid';\n\t\tvar title = $.i18n._( 'Accumulated Time' );\n\n\t\tif ( this[grid_id] ) {\n\t\t\t//Commenting out the next line replicates TypeError: Failed to execute 'replaceChild' on 'Node': parameter 2 is not of type 'Node'. when using Date left arrow on timesheet.\n\t\t\t//  Also happens when clicking the top-right in-app refresh button too.\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t}\n\n\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( 'accumulated_time_grid', {\n\t\t\tsortable: false,\n\t\t\thoverrows: false,\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onAccumulatedTimeClick();\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t$this.onCellSelect( 'accumulated_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'accumulated_grid', row_id, this );\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t$this.setDefaultMenu();\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\tif ( $this.grid_dic['accumulated_time_grid'] ) {\n\t\t\t\t\t$this.grid_dic['accumulated_time_grid'].grid.setGridWidth( $( 'body' ).width() );\n\t\t\t\t}\n\t\t\t},\n\t\t\tbeforeSelectRow: function( row_id, e ) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tvar cell_index = 0;\n\t\t\t\tif ( $( e.target ).attr( 'role' ) == 'gridcell' ) {\n\t\t\t\t\tcell_index = $( e.target ).index();\n\t\t\t\t} else {\n\t\t\t\t\tcell_index = $( e.target ).parents( 'td' ).index();\n\t\t\t\t}\n\n\t\t\t\tvar cell_val = $( e.target ).text();\n\n\t\t\t\t$this.onCellSelect( 'accumulated_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t$this.onSelectRow( 'accumulated_grid', row_id, this );\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmultiselectPosition: 'none',\n\t\t\twinMultiSelect: false,\n\t\t\tverticalResize: false\n\n\t\t}, this.timesheet_columns );\n\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic[grid_id].grid.setGridWidth( $( 'body' ).width() );\n\t\t}\n\t}\n\n\tbuildSubGrid( grid_id, title ) {\n\t\tvar $this = this;\n\n\t\tvar html_grid_id = this.ui_id + '_' + grid_id;\n\t\tif ( !Global.isSet( this[grid_id] ) ) {\n\t\t\tvar grid = $( this.el ).find( '#' + grid_id );\n\t\t\tgrid.attr( 'id', html_grid_id );\t//Grid's id is ScriptName + _grid\n\t\t}\n\n\t\tif ( this[grid_id] ) {\n\t\t\tthis[grid_id].unload();\n\t\t\tthis[grid_id] = null;\n\t\t\tthis.grid_dic[grid_id] = null;\n\t\t}\n\n\t\tif ( grid_id === 'premium_grid' ) {\n\t\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( html_grid_id, {\n\t\t\t\thoverrows: false,\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\tonSelectRow: function( row_id, flag, e ) {\n\t\t\t\t\t$this.onSelectRow( 'premium_grid', row_id, this );\n\t\t\t\t},\n\t\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\t$this.onCellSelect( 'premium_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.onSelectRow( 'premium_grid', row_id, this );\n\t\t\t\t},\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\t$this.unsetSelectedCells( 'timesheet_grid' );\n\t\t\t\t\t$this.unsetSelectedCells( 'absence_grid' );\n\t\t\t\t\t$this.onCellSelect( 'premium_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.select_punches_array = [];\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t},\n\t\t\t\tondblClickRow: function() {\n\t\t\t\t\tif ( grid_id === 'premium_grid' ) {\n\t\t\t\t\t\t$this.onAccumulatedTimeClick();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.grid_dic[grid_id] ) {\n\t\t\t\t\t\t$this.grid_dic[grid_id].grid.setGridWidth( $( 'body' ).width() );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tverticalResize: false\n\t\t\t}, this.timesheet_columns );\n\n\t\t\t//subgrids might not be rendered, so we need to check for them in the grid_dic first.\n\t\t\tif ( this[grid_id] && this[grid_id].grid ) {\n\t\t\t\tthis[grid_id].grid.addClass( 'premium-grid' );\n\t\t\t}\n\t\t} else {\n\t\t\tthis[grid_id] = this.grid_dic[grid_id] = new TTGrid( html_grid_id, {\n\t\t\t\thoverrows: false,\n\t\t\t\tmultiselectPosition: 'none',\n\t\t\t\twinMultiSelect: false,\n\t\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t\t$this.unsetSelectedCells( 'timesheet_grid' );\n\t\t\t\t\t$this.unsetSelectedCells( 'absence_grid' );\n\n\t\t\t\t\t$this.onCellSelect( grid_id, row_id, cell_index, cell_val, this, e );\n\t\t\t\t\t$this.select_punches_array = [];\n\t\t\t\t\t$this.setDefaultMenu();\n\t\t\t\t},\n\t\t\t\tonResizeGrid: function() {\n\t\t\t\t\tif ( $this.grid_dic[grid_id] ) {\n\t\t\t\t\t\t$this.grid_dic[grid_id].grid.setGridWidth( $( 'body' ).width() );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tverticalResize: false\n\t\t\t}, this.timesheet_columns );\n\t\t}\n\n\t\tthis.setGridHeaderBar( grid_id, title );\n\n\t\t//this loop hits all possible grids. subgrids might not be rendered, so we need to check for them in the grid_dic first.\n\t\tif ( this.grid_dic[grid_id] && this.grid_dic[grid_id].grid ) {\n\t\t\tthis.grid_dic[grid_id].grid.setGridWidth( $( 'body' ).width() );\n\t\t}\n\t}\n\n\tsetGridSExpendOrCollapseStatus( grid_id, title ) {\n\t\tif ( this.grid_dic[grid_id] ) {\n\t\t\tvar grid = this.grid_dic[grid_id].grid;\n\t\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\t\tvar title_bar = table.find( '.title-bar' );\n\t\t\tthis.setGridHeight( grid_id );\n\n\t\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] !== true ) {\n\t\t\t\tgrid.setGridHeight( 0 );\n\t\t\t}\n\n\t\t\tthis.updateGridHeaderBar( grid_id, title );\n\t\t}\n\t}\n\n\t//Show expend and collapse button in grid title bar\n\tsetGridExpendButton( grid_id, title ) {\n\t\tvar $this = this;\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\tvar title_bar = table.find( '.title-bar' );\n\n\t\tif ( title_bar.find( '.grid-expend-btn' ).length === 0 ) { //prevent doubling up of expand arrows.\n\t\t\tvar img = $( '<img>' );\n\t\t\timg.addClass( 'grid-expend-btn' );\n\n\t\t\tif ( !Global.isSet( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] ) ||\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ) {\n\n\t\t\t\timg.attr( 'src', Global.getRealImagePath( 'images/big_collapse.png' ) );\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = true;\n\n\t\t\t} else {\n\t\t\t\timg.attr( 'src', Global.getRealImagePath( 'images/big_expand.png' ) );\n\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = false;\n\t\t\t}\n\n\t\t\ttitle_bar.append( img );\n\n\t\t\tthis.setGridSExpendOrCollapseStatus( grid_id, title );\n\n\t\t\timg.click( function( e ) {\n\n\t\t\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ) {\n\t\t\t\t\t$( this ).attr( 'src', Global.getRealImagePath( 'images/big_expand.png' ) );\n\t\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = false;\n\t\t\t\t\t$this.setGridSExpendOrCollapseStatus( grid_id, title );\n\t\t\t\t} else {\n\t\t\t\t\t$( this ).attr( 'src', Global.getRealImagePath( 'images/big_collapse.png' ) );\n\t\t\t\t\tLocalCacheData.timesheet_sub_grid_expended_dic[grid_id] = true;\n\t\t\t\t\t$this.setGridSExpendOrCollapseStatus( grid_id, title );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateGridHeaderBar( grid_id, description ) {\n\t\tvar label = description;\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_' + grid_id + ']' )[0] );\n\t\tvar title_span = table.find( '.title-span' );\n\t\tvar count = 0;\n\n\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] !== true ) {\n\t\t\tswitch ( grid_id ) {\n\t\t\t\tcase 'branch_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.branch_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'department_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.department_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_item_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.task_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.job_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'premium_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.premium_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'absence_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.absence_cell_count ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'punch_note_grid':\n\t\t\t\t\tlabel = label + ' (' + ( this.punch_note_account ) + ')';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\ttitle_span.text( label );\n\t}\n\n\tsetGridHeaderBar( grid_id, label ) {\n\t\tvar table = $( this.grid_dic[grid_id].grid ).parents( '.ui-jqgrid-view' ).find( '.ui-jqgrid-hbox table' ); //grab the hbox\n\t\t//table.empty();\n\t\ttable.css( 'width', '100vw' ); //set default width of timesheet tables to the width of the screen to set the header widths.\n\n\t\tvar label = $.i18n._( label );\n\n\t\ttable.find( 'tr:first' ).hide();\n\t\tvar title_bar = $( '<div class=\\'title-bar\\'><span class=\\'title-span\\'>' + label + '</span></div>' );\n\t\ttable.append( title_bar );\n\t}\n\n\tbuildManualTimeSheetsColumns() {\n\t\tthis.day_dic = {};\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar current_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar day_text = current_date.format( this.day_format );\n\t\t\tvar date_text = current_date.format( this.date_format );\n\t\t\tthis.day_dic['day_' + i] = { value: day_text + '<br>' + date_text, field: current_date.format() };\n\t\t}\n\t}\n\n\tgetManualTimeSheetData( callBack ) {\n\t\tvar $this = this;\n\n\t\tvar user_id = this.getSelectEmployee();\n\t\tif ( user_id ) {\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {\n\t\t\t\tuser_id: user_id,\n\t\t\t\tobject_type_id: 10,\n\t\t\t\tstart_date: this.start_date.format(),\n\t\t\t\tend_date: this.end_date.format()\n\t\t\t};\n\t\t\targs.filter_columns = {\n\t\t\t\t'id': true,\n\t\t\t\t'date_stamp': true,\n\t\t\t\t'total_time': true,\n\t\t\t\t'object_type': true,\n\t\t\t\t'name': true,\n\t\t\t\t'branch_id': true,\n\t\t\t\t'department_id': true,\n\t\t\t\t'branch': true,\n\t\t\t\t'department': true,\n\t\t\t\t'job': true,\n\t\t\t\t'job_item': true,\n\t\t\t\t'job_id': true,\n\t\t\t\t'job_item_id': true,\n\t\t\t\t'note': true,\n\t\t\t\t'override': true\n\t\t\t};\n\t\t\tthis.api_user_date_total.getUserDateTotal( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.manual_timesheet_data = result.getResult();\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tbuildManualTimeSheetData() {\n\t\tthis.time_sheet_data_overrode_true_map = {};\n\t\tthis.time_sheet_data_overrode_false_map = {};\n\t\tvar sort_by_fields = ['branch_id', 'department_id', 'job_id', 'job_item_id'],\n\t\t\tmanual_timesheet_data_group_array = [],\n\t\t\toverride_true_array = [],\n\t\t\toverride_false_array = [];\n\t\tthis.manual_timesheet_data.sort( Global.m_sort_by( sort_by_fields ) );\n\t\tmanual_timesheet_data_group_array = _.groupBy( this.manual_timesheet_data, 'override' );\n\t\toverride_true_array = manual_timesheet_data_group_array[true];\n\t\toverride_false_array = manual_timesheet_data_group_array[false];\n\t\tdoNext( override_true_array, this.time_sheet_data_overrode_true_map );\n\t\tdoNext( override_false_array, this.time_sheet_data_overrode_false_map );\n\n\t\tfunction doNext( manual_timesheet_data, target_map ) {\n\t\t\t!manual_timesheet_data && ( manual_timesheet_data = [] );\n\t\t\tfor ( var i = 0, m = manual_timesheet_data.length; i < m; i++ ) {\n\t\t\t\tvar data = manual_timesheet_data[i];\n\n\t\t\t\tvar key = data.branch_id + '-' + data.department_id + '-' + data.job_id + '-' + data.job_item_id;\n\t\t\t\tif ( !target_map[key] ) {\n\t\t\t\t\ttarget_map[key] = {};\n\t\t\t\t\ttarget_map[key].branch_id = data.branch_id;\n\t\t\t\t\ttarget_map[key].department_id = data.department_id;\n\t\t\t\t\ttarget_map[key].job_id = data.job_id;\n\t\t\t\t\ttarget_map[key].job_item_id = data.job_item_id;\n\t\t\t\t\ttarget_map[key].branch = data.branch;\n\t\t\t\t\ttarget_map[key].department = data.department;\n\t\t\t\t\ttarget_map[key].job = data.job;\n\t\t\t\t\ttarget_map[key].job_item = data.job_item;\n\t\t\t\t\ttarget_map[key].override = data.override;\n\t\t\t\t\ttarget_map[key][data.date_stamp] = data;\n\t\t\t\t} else if ( target_map[key][data.date_stamp] ) {\n\t\t\t\t\t// If already has data in this day, create next row.\n\t\t\t\t\tvar j = 1;\n\t\t\t\t\twhile ( true ) {\n\t\t\t\t\t\tif ( !target_map[key + '-' + j] ) {\n\t\t\t\t\t\t\ttarget_map[key + '-' + j] = {};\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].branch_id = data.branch_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].department_id = data.department_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job_id = data.job_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job_item_id = data.job_item_id;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].branch = data.branch;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].department = data.department;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job = data.job;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].job_item = data.job_item;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j].override = data.override;\n\t\t\t\t\t\t\ttarget_map[key + '-' + j][data.date_stamp] = data;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else if ( !target_map[key + '-' + j][data.date_stamp] ) {\n\t\t\t\t\t\t\ttarget_map[key + '-' + j][data.date_stamp] = data;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tj = j + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttarget_map[key][data.date_stamp] = data;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tinitInsideEditorData( updateExistedCell ) {\n\t\tvar $this = this;\n\t\tfor ( var key in this.day_dic ) {\n\t\t\tthis.$( '#' + key + '_date' ).html( this.day_dic[key].value );\n\t\t\tthis.$( '#' + key + '_date' ).addClass( 'manual_grid_day_' + Global.strToDate( this.day_dic[key].field ).format( this.full_format ) );\n\t\t\tthis.$( '#' + key + '_date' ).attr( 'current_date', 'manual_grid_day_' + Global.strToDate( this.day_dic[key].field ).format( this.full_format ) );\n\t\t\tthis.$( '#' + key + '_date' ).unbind( 'click' ).bind( 'click', function( e ) {\n\t\t\t\tvar target = e.currentTarget;\n\t\t\t\tvar field = $( target ).attr( 'current_date' );\n\t\t\t\tfield = field.substring( 16, field.length );\n\t\t\t\tvar date = Global.strToDate( field, $this.full_format );\n\t\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t\t$this.highLightSelectDay();\n\t\t\t\t\t$this.reLoadSubGridsSource();\n\t\t\t\t}\n\t\t\t} );\n\t\t\tthis.$( '.is-saving-manual-grid' ).removeClass( 'is-saving-manual-grid' );\n\t\t}\n\t\tif ( this.is_auto_switch ) {\n\t\t\tthis.is_auto_switch = false;\n\t\t\tdoNext();\n\t\t} else {\n\t\t\tthis.getManualTimeSheetData( function() {\n\t\t\t\tdoNext();\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\t$this.is_saving_manual_grid = false;\n\t\t\t$this.setDefaultMenu();\n\t\t\tif ( !updateExistedCell ) {\n\t\t\t\t$this.editor.removeAllRows();\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\t_.map( $this.time_sheet_data_overrode_false_map, function( data ) {\n\t\t\t\t\t\t$this.editor.addRow( data );\n\t\t\t\t\t} );\n\t\t\t\t\t_.map( $this.time_sheet_data_overrode_true_map, function( data ) {\n\t\t\t\t\t\t$this.editor.addRow( data );\n\t\t\t\t\t} );\n\t\t\t\t\tif ( _.isEmpty( $this.time_sheet_data_overrode_true_map ) ) {\n\t\t\t\t\t\t$this.editor.addRow();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t$this.editor.addRow();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\tfor ( var map_key in $this.time_sheet_data_overrode_true_map ) {\n\t\t\t\t\t\tvar data = $this.time_sheet_data_overrode_true_map[map_key];\n\t\t\t\t\t\tfor ( var map_key_2 in data ) {\n\t\t\t\t\t\t\tvar item = data[map_key_2];\n\t\t\t\t\t\t\tif ( !_.isObject( item ) ) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar key = $this.generateManualTimeSheetRecordKey( item );\n\t\t\t\t\t\t\tvar item_id_key = item.id + '-' + key;\n\n\t\t\t\t\t\t\t//Check to see if the record with no ID (pre-save) exists, and if so update it, or replace it with the saved record.\n\t\t\t\t\t\t\tif ( $this.manual_grid_records_map[item_id_key] ) {\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[item_id_key][item.date_stamp].setValue( item.total_time );\n\t\t\t\t\t\t\t} else if ( $this.manual_grid_records_map[key] ) {\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[key].current_edit_item[item.date_stamp] = item;\n\t\t\t\t\t\t\t\t$this.manual_grid_records_map[key][item.date_stamp].setValue( item.total_time );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( $this.save_manual_grid_after_save ) {\n\t\t\t\t$this.autoSaveManualPunch();\n\t\t\t\t$this.save_manual_grid_after_save = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tvar $this = this;\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tvar job_item_api = TTAPI.APIJobItem;\n\t\t\tvar job_api = TTAPI.APIJob;\n\t\t}\n\t\tvar args;\n\t\tif ( !data ) {\n\t\t\tdata = {};\n\t\t\tif ( index >= 0 ) {\n\t\t\t\tvar widget_row = this.rows_widgets_array[index - 3];\n\t\t\t\tif ( this.parent_controller.show_branch_ui ) {\n\t\t\t\t\tif ( widget_row.branch_id ) {\n\t\t\t\t\t\tdata.branch_id = widget_row.branch_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.branch_id ) {\n\t\t\t\t\t\tdata.branch_id = widget_row.current_edit_item.branch_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.branch_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_department_ui ) {\n\t\t\t\t\tif ( widget_row.department_id ) {\n\t\t\t\t\t\tdata.department_id = widget_row.department_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.department_id ) {\n\t\t\t\t\t\tdata.department_id = widget_row.current_edit_item.department_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.department_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_job_ui && Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( widget_row.job_id ) {\n\t\t\t\t\t\tdata.job_id = widget_row.job_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.job_id ) {\n\t\t\t\t\t\tdata.job_id = widget_row.current_edit_item.job_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.job_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( this.parent_controller.show_job_item_ui && Global.getProductEdition() >= 20 ) {\n\t\t\t\t\tif ( widget_row.job_item_id ) {\n\t\t\t\t\t\tdata.job_item_id = widget_row.job_item_id.getValue();\n\t\t\t\t\t} else if ( widget_row.current_edit_item && widget_row.current_edit_item.job_item_id ) {\n\t\t\t\t\t\tdata.job_item_id = widget_row.current_edit_item.job_item_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.job_item_id = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\t\tvar form_item_input;\n\t\t//Build row widgets\n\t\t//Branch\n\t\tif ( this.parent_controller.show_branch_ui ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'branch' } );\n\t\t\t\tform_item_input.setValue( data.branch );\n\t\t\t\trow.children().eq( 2 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'branch_id',\n\t\t\t\t\tis_static_width: true\n\t\t\t\t} );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'branch_id' ) ? data.branch_id : this.parent_controller.getSelectEmployee( true ).default_branch_id );\n\t\t\t\trow.children().eq( 2 ).append( form_item_input );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 2 ).hide();\n\t\t}\n\t\t//Department\n\t\tif ( this.parent_controller.show_department_ui ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'department' } );\n\t\t\t\tform_item_input.setValue( data.department );\n\t\t\t\trow.children().eq( 3 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'department_id',\n\t\t\t\t\tis_static_width: true\n\t\t\t\t} );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'department_id' ) ? data.department_id : this.parent_controller.getSelectEmployee( true ).default_department_id );\n\t\t\t\trow.children().eq( 3 ).append( form_item_input );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 3 ).hide();\n\t\t}\n\t\t//Job\n\t\tif ( this.parent_controller.show_job_ui && Global.getProductEdition() >= 20 ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'job' } );\n\t\t\t\tform_item_input.setValue( data.job );\n\t\t\t\trow.children().eq( 4 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tvar job_form_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tjob_form_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_job',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'job_id',\n\t\t\t\t\tis_static_width: true,\n\t\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )\n\t\t\t\t} );\n\t\t\t\twidgets[job_form_item_input.getField()] = job_form_item_input;\n\t\t\t\t// Set default args\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { status_id: 10, user_id: this.parent_controller.getSelectEmployee() };\n\t\t\t\tjob_form_item_input.setDefaultArgs( args );\n\t\t\t\tvar job_id = data.hasOwnProperty( 'job_id' ) ? data.job_id : this.parent_controller.getSelectEmployee( true ).default_job_id;\n\t\t\t\tjob_form_item_input.setValue( job_id );\n\t\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true, width: 30 } );\n\t\t\t\tjob_coder.css( 'display', 'inline-block' );\n\t\t\t\tjob_form_item_input.css( 'display', 'inline-block' );\n\t\t\t\trow.children().eq( 4 ).append( job_coder );\n\t\t\t\trow.children().eq( 4 ).append( job_form_item_input );\n\t\t\t\tjob_coder.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tonJobQuickSearch( target.getField(), target.getValue() );\n\t\t\t\t} );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 4 ).hide();\n\t\t}\n\n\t\t//Task\n\t\tif ( this.parent_controller.show_job_item_ui && Global.getProductEdition() >= 20 ) {\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'job_item' } );\n\t\t\t\tform_item_input.setValue( data.job_item );\n\t\t\t\trow.children().eq( 5 ).append( form_item_input );\n\t\t\t} else {\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\t\tform_item_input.AComboBox( {\n\t\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\t\twidth: 90,\n\t\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\t\tshow_search_inputs: true,\n\t\t\t\t\tset_empty: true,\n\t\t\t\t\tfield: 'job_item_id',\n\t\t\t\t\tis_static_width: true,\n\t\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} )\n\t\t\t\t} );\n\t\t\t\targs = {};\n\t\t\t\targs.filter_data = { status_id: 10, job_id: job_id };\n\t\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\t\tform_item_input.setValue( data.hasOwnProperty( 'job_item_id' ) ? data.job_item_id : this.parent_controller.getSelectEmployee( true ).default_job_item_id );\n\t\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true, width: 30 } );\n\t\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\t\tjob_item_coder.css( 'display', 'inline-block' );\n\t\t\t\tform_item_input.css( 'display', 'inline-block' );\n\t\t\t\trow.children().eq( 5 ).append( job_item_coder );\n\t\t\t\trow.children().eq( 5 ).append( form_item_input );\n\t\t\t\tjob_item_coder.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\t\tonJobQuickSearch( target.getField(), target.getValue() );\n\t\t\t\t} );\n\t\t\t}\n\t\t} else {\n\t\t\trow.children().eq( 5 ).hide();\n\t\t}\n\t\t//day 0\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_0'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 6 ).append( form_item_input );\n\n\t\t//day 1\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_1'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 7 ).append( form_item_input );\n\n\t\t//day 2\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_2'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 8 ).append( form_item_input );\n\n\t\t//day 3\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_3'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 9 ).append( form_item_input );\n\n\t\t//day 4\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_4'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 10 ).append( form_item_input );\n\n\t\t//day 5\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_5'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 11 ).append( form_item_input );\n\n\t\t//day 6\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( {\n\t\t\tfield: this.parent_controller.day_dic['day_6'].field,\n\t\t\twidth: 55,\n\t\t\tmode: 'time_unit',\n\t\t\tdisplay_na: false,\n\t\t\tneed_parser_sec: true,\n\t\t\tdo_validate: false\n\t\t} );\n\t\tform_item_input.setValue( data[form_item_input.getField()] ? data[form_item_input.getField()].total_time : 0 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 12 ).append( form_item_input );\n\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\trow.children().eq( 1 ).children().hide();\n\t\t}\n\n\t\tvar disable_plus = false;\n\t\tvar disable_minus = false;\n\t\tvar disable_dropdowns = false;\n\n\t\tfor ( var key in widgets ) {\n\t\t\tvar item = widgets[key];\n\n\t\t\t//disable if all pay_periods visible are not open.\n\t\t\tvar invalid = 0;\n\n\t\t\tfor ( var n in this.parent_controller.full_timesheet_data.pay_period_data ) {\n\t\t\t\tif ( this.parent_controller.full_timesheet_data.pay_period_data[n].status_id != 10 && this.parent_controller.full_timesheet_data.pay_period_data[n].status_id != 30 ) {\n\t\t\t\t\tinvalid++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( invalid > 0 && invalid == Object.keys( this.parent_controller.full_timesheet_data.pay_period_data ).length ) {\n\t\t\t\tif ( this.parent_controller.full_timesheet_data.punch_data.length != 0 ) {\n\t\t\t\t\tdisable_plus = true;\n\t\t\t\t\tdisable_minus = true;\n\t\t\t\t\tif ( Object.keys( data ).length == 0 ) {\n\t\t\t\t\t\treturn; //don't show a blank row if all pay periods are closed\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//disable fields under closed pay periods\n\t\t\tif ( this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[item.getField()]] ) {\n\t\t\t\tvar field_pay_period_status = parseInt( this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[item.getField()]].status_id );\n\t\t\t\tif ( field_pay_period_status != 10 && field_pay_period_status != 30 ) {\n\t\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\t\tif ( item.getField() != 'branch_id' && item.getField() != 'department_id' && item.getField() != 'job_id' && item.getField() != 'job_item_id' && typeof data[item.getField()] != 'undefined' ) {\n\t\t\t\t\t\t//only disable dropdowns if there is data in the disabled fields\n\t\t\t\t\t\tdisable_dropdowns = true;\n\t\t\t\t\t\tdisable_minus = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( data.hasOwnProperty( 'override' ) && !data.override ) {\n\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\titem.getValue() > 0 && item.hasClass( 't-text-input' ) >= 0 && item.css( 'color', 'red' );\n\t\t\t}\n\t\t\titem.unbind( 'formItemChange' ).bind( 'formItemChange', function( e, target ) {\n\t\t\t\ttarget.is_changed = true;\n\t\t\t\tif ( target.getField() === 'job_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tjob_coder.setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tsetJobItemValueWhenJobChanged( target.getValue( true ) );\n\t\t\t\t} else if ( target.getField() === 'job_item_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\tjob_item_coder.setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t} else if ( target.getField() === 'branch_id' || target.getField() === 'department_id' ) {\n\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t}\n\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t} );\n\t\t}\n\n\t\tif ( disable_dropdowns ) {\n\t\t\tfor ( var key in widgets ) {\n\t\t\t\tvar item = widgets[key];\n\t\t\t\tif ( item.getField() == 'branch_id' || item.getField() == 'department_id' || item.getField() == 'job_id' || item.getField() == 'job_item_id' ) {\n\t\t\t\t\tif ( item.getField() == 'job_id' || item.getField() == 'job_item_id' ) {\n\t\t\t\t\t\titem.parents( 'td' ).find( 'input[type=\"text\"]' ).hide(); //hide job and task lookup box\n\t\t\t\t\t}\n\t\t\t\t\titem.setEnabled && item.setEnabled( false );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( disable_plus == true ) {\n\t\t\trow.find( '.plus-icon' ).hide();\n\t\t}\n\n\t\tif ( disable_minus == true ) {\n\t\t\trow.find( '.minus-icon' ).hide();\n\t\t}\n\n\t\tif ( typeof index != 'undefined' ) {\n\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t} else {\n\t\t\t$( render ).append( row );\n\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t}\n\t\t//Save current set item\n\t\twidgets.current_edit_item = data;\n\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\n\t\tfunction onJobQuickSearch( key, value ) {\n\t\t\tvar args = {};\n\t\t\tif ( key === 'job_quick_search' ) {\n\t\t\t\targs.filter_data = {\n\t\t\t\t\tmanual_id: value,\n\t\t\t\t\tuser_id: $this.parent_controller.getSelectEmployee(),\n\t\t\t\t\tstatus_id: '10'\n\t\t\t\t};\n\t\t\t\tjob_api.getJob( args, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t\twidgets['job_id'].setValue( result_data[0].id );\n\t\t\t\t\t\t\tsetJobItemValueWhenJobChanged( result_data[0] );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidgets['job_id'].setValue( '' );\n\t\t\t\t\t\t\tsetJobItemValueWhenJobChanged( false );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else if ( key === 'job_item_quick_search' ) {\n\t\t\t\targs.filter_data = { manual_id: value, job_id: widgets['job_id'].getValue(), status_id: '10' };\n\t\t\t\tjob_item_api.getJobItem( args, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\twidgets.is_changed = true;\n\t\t\t\t\t\t$this.parent_controller.autoSaveManualPunch();\n\t\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t\twidgets['job_item_id'].setValue( result_data[0].id );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidgets['job_item_id'].setValue( '' );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\tfunction setJobItemValueWhenJobChanged( job ) {\n\t\t\tvar job_item_widget = widgets['job_item_id'];\n\t\t\tif ( !job_item_widget ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar current_job_item_id = job_item_widget.getValue();\n\t\t\tjob_item_widget.setSourceData( null );\n\t\t\tvar args = {};\n\t\t\targs.filter_data = { status_id: 10, job_id: widgets['job_id'].getValue() };\n\t\t\tjob_item_widget.setDefaultArgs( args );\n\t\t\tif ( current_job_item_id ) {\n\t\t\t\tvar new_arg = Global.clone( args );\n\t\t\t\tnew_arg.filter_data.id = current_job_item_id;\n\t\t\t\tnew_arg.filter_columns = job_item_widget.getColumnFilter();\n\t\t\t\tjob_item_api.getJobItem( new_arg, {\n\t\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\t\tjob_item_widget.setValue( current_job_item_id );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetDefaultData();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tsetDefaultData();\n\t\t\t}\n\n\t\t\tfunction setDefaultData() {\n\t\t\t\tif ( widgets['job_id'].getValue() ) {\n\t\t\t\t\tjob_item_widget.setValue( job.default_item_id );\n\t\t\t\t\tif ( job.default_item_id === false || job.default_item_id === 0 ) {\n\t\t\t\t\t\tjob_item_coder.setValue( '' );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tjob_item_widget.setValue( '' );\n\t\t\t\t\tjob_item_coder.setValue( '' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tautoSaveManualPunch() {\n\t\tvar $this = this;\n\t\tif ( this.is_saving_manual_grid ) {\n\t\t\tthis.save_manual_grid_after_save = true;\n\t\t\treturn;\n\t\t}\n\t\tthis.wait_auto_save && clearTimeout( this.wait_auto_save );\n\t\tthis.wait_auto_save = setTimeout( function() {\n\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t$this.onSaveClick();\n\t\t\t}\n\t\t}, 2000 );\n\t}\n\n\tinsideEditorGetValue( isSave ) {\n\t\tvar len = this.rows_widgets_array.length;\n\t\tvar result = [];\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\t\tvar current_date = new Date( new Date( this.parent_controller.start_date.getTime() ).setDate( this.parent_controller.start_date.getDate() + j ) );\n\t\t\t\tvar field = current_date.format();\n\t\t\t\tvar common_record = {};\n\t\t\t\tif ( !row[field] ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcommon_record.total_time = row[field].getValue();\n\t\t\t\tif ( row[field].is_changed || ( row.is_changed && row.current_edit_item[field] ) ) {\n\t\t\t\t\trow.branch_id && ( common_record.branch_id = row.branch_id.getValue() );\n\t\t\t\t\trow.department_id && ( common_record.department_id = row.department_id.getValue() );\n\t\t\t\t\trow.job_id && ( common_record.job_id = row.job_id.getValue() );\n\t\t\t\t\trow.job_item_id && ( common_record.job_item_id = row.job_item_id.getValue() );\n\t\t\t\t\tcommon_record.date_stamp = field;\n\t\t\t\t\tcommon_record.user_id = this.parent_controller.getSelectEmployee();\n\t\t\t\t\tcommon_record.object_type_id = 10;\n\t\t\t\t\tcommon_record.override = true;\n\t\t\t\t\tcommon_record.row = row;\n\t\t\t\t\trow.current_edit_item[field] && ( common_record.id = row.current_edit_item[field].id );\n\t\t\t\t\tresult.push( common_record );\n\t\t\t\t\tif ( isSave ) {\n\t\t\t\t\t\trow[field].is_changed = false;\n\t\t\t\t\t\trow[field].addClass( 'is-saving-manual-grid' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( isSave ) {\n\t\t\t\trow.is_changed = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 3;\n\t\tvar widget_row = this.rows_widgets_array[index];\n\t\tvar has_value = false;\n\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\tvar current_date = new Date( new Date( this.parent_controller.start_date.getTime() ).setDate( this.parent_controller.start_date.getDate() + j ) );\n\t\t\tvar field = current_date.format();\n\t\t\tif ( widget_row[field].getValue() > 0 || widget_row.current_edit_item[field] ) {\n\t\t\t\thas_value = true;\n\t\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'You are about to delete the entire week worth of time for this row. Are you sure you wish to continue?' ), '', doNext );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t!has_value && doNext( true );\n\n\t\tfunction doNext( flag ) {\n\t\t\tif ( flag ) {\n\t\t\t\tvar remove_ids = [];\n\t\t\t\tfor ( var j = 0; j < 7; j++ ) {\n\t\t\t\t\tvar current_date = new Date( new Date( $this.parent_controller.start_date.getTime() ).setDate( $this.parent_controller.start_date.getDate() + j ) );\n\t\t\t\t\tvar field = current_date.format();\n\t\t\t\t\twidget_row.current_edit_item[field] && ( remove_ids.push( widget_row.current_edit_item[field].id ) );\n\t\t\t\t}\n\t\t\t\tif ( remove_ids.length > 0 ) {\n\t\t\t\t\tProgressBar.noProgressForNextCall();\n\t\t\t\t\tProgressBar.showNanobar();\n\t\t\t\t\t$this.is_saving_manual_grid = true;\n\t\t\t\t\t$this.parent_controller.setDefaultMenu();\n\t\t\t\t\t$this.api.deleteUserDateTotal( remove_ids, {\n\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t$this.parent_controller.reLoadSubGridsSource( true );\n\t\t\t\t\t\t\tProgressBar.removeNanobar();\n\t\t\t\t\t\t\t$this.parent_controller.setDefaultMenu();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\trow.remove();\n\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t$this.addRow();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildManualTimeSheetGrid() {\n\t\tvar args = {\n\t\t\tbranch: $.i18n._( 'Branch' ),\n\t\t\tdepartment: $.i18n._( 'Department' ),\n\t\t\tjob: $.i18n._( 'Job' ),\n\t\t\ttask: $.i18n._( 'Task' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\ttitle: '',\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tparent_controller: this,\n\t\t\trender: 'views/attendance/timesheet/ManualTimeSheetInsideEditorRender.html',\n\t\t\trender_args: args,\n\t\t\tapi: this.api_user_date_total,\n\t\t\trow_render: 'views/attendance/timesheet/ManualTimeSheetInsideEditorRow.html'\n\t\t} );\n\t\tvar inside_editor_div = this.$( '.manual-timesheet-inside-editor-div' );\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildCalendars() {\n\t\tvar $this = this;\n\t\tif ( this.is_auto_switch ) {\n\t\t\tthis.getManualTimeSheetData( function() {\n\t\t\t\tif ( $this.manual_timesheet_data.length > 0 ) {\n\t\t\t\t\t$this.buildManualTimeSheetData();\n\t\t\t\t\tvar is_no_manual = _.isEmpty( $this.time_sheet_data_overrode_true_map );\n\t\t\t\t\tvar is_no_punch = _.isEmpty( $this.time_sheet_data_overrode_false_map );\n\t\t\t\t\tif ( is_no_manual && !is_no_punch ) {\n\t\t\t\t\t\t$this.toggle_button.setValue( 'punch' );\n\t\t\t\t\t\t$this.is_auto_switch = false;\n\t\t\t\t\t} else if ( !is_no_manual && is_no_punch ) {\n\t\t\t\t\t\t$this.toggle_button.setValue( 'manual' );\n\t\t\t\t\t}\n\t\t\t\t\t$this.reSetURL();\n\t\t\t\t\tdoNext();\n\t\t\t\t} else {\n\t\t\t\t\t$this.getPunchMode() === 'punch' && ( $this.is_auto_switch = false );\n\t\t\t\t\tdoNext();\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tdoNext();\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\t$this.pay_period_data = $this.full_timesheet_data.pay_period_data;\n\t\t\t$this.pay_period_map = $this.full_timesheet_data.timesheet_dates.pay_period_date_map;\n\t\t\t$this.timesheet_verify_data = $this.full_timesheet_data.timesheet_verify_data;\n\t\t\t$this.grid_div = $( $this.el ).find( '.timesheet-grid-div' );\n\t\t\t// Punch grid\n\t\t\t$this.buildTimeSheetsColumns();\n\t\t\t$this.buildTimeSheetGrid();\n\t\t\tif ( $this.getPunchMode() === 'manual' ) {\n\t\t\t\t$this.$( '.timesheet-punch-grid-wrapper' ).hide();\n\t\t\t\t$this.$( '.manual-timesheet-inside-editor-div' ).show();\n\t\t\t\tif ( !$this.editor ) {\n\t\t\t\t\t$this.buildManualTimeSheetsColumns();\n\t\t\t\t\t$this.buildManualTimeSheetGrid();\n\t\t\t\t\t$this.initInsideEditorData();\n\t\t\t\t} else {\n\t\t\t\t\t$this.buildManualTimeSheetsColumns();\n\t\t\t\t\t$this.initInsideEditorData();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_job_ui || Global.getProductEdition() < 20 ) {\n\t\t\t\t\t$this.$( '.job-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_job_item_ui || Global.getProductEdition() < 20 ) {\n\t\t\t\t\t$this.$( '.job-item-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_branch_ui ) {\n\t\t\t\t\t$this.$( '.branch-header' ).hide();\n\t\t\t\t}\n\t\t\t\tif ( !$this.show_department_ui ) {\n\t\t\t\t\t$this.$( '.department-header' ).hide();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$this.$( '.timesheet-punch-grid-wrapper' ).show();\n\t\t\t\t$this.$( '.manual-timesheet-inside-editor-div' ).hide();\n\t\t\t}\n\n\t\t\t$this.buildAccumulatedGrid();\n\n\t\t\t$this.buildSubGrid( 'branch_grid', 'Branch' );\n\t\t\t$this.buildSubGrid( 'department_grid', 'Department' );\n\t\t\t$this.buildSubGrid( 'job_grid', 'Job' );\n\t\t\t$this.buildSubGrid( 'job_item_grid', 'Task' );\n\t\t\t$this.buildSubGrid( 'premium_grid', 'Premium' );\n\t\t\t$this.buildAbsenceGrid();\n\t\t\t$this.showGridBorders();\n\t\t\t$this.buildAccumulatedTotalGrid();\n\t\t\t$this.buildPunchNoteGrid();\n\t\t\t$this.buildVerificationGrid();\n\t\t\t//TimeSheet grid\n\t\t\t$this.buildTimeSheetSource(); //Create punch data\n\t\t\t$this.buildTimeSheetRequests();\n\t\t\t//Accumulated Time, Branch, Department, Job, Task, Pre\n\t\t\t$this.buildSubGridsSource();\n\t\t\t//Make sure exception rows goes after Lanuch and break create from buildSubGridsSource\n\t\t\t$this.buildTimeSheetExceptions();\n\t\t\t//Absence Grid source\n\t\t\t$this.buildAbsenceSource(); //Create punch data\n\t\t\t//Show punch notes in a grid\n\t\t\t$this.buildPunchNoteGridSource();\n\t\t\t//buildVerificationGridSource\n\t\t\t$this.buildVerificationGridSource();\n\t\t\t$this.setGridExpendButton( 'accumulated_time_grid', $.i18n._( 'Accumulated Time' ) );\n\t\t\t$this.setGridExpendButton( 'branch_grid', $.i18n._( 'Branch' ) );\n\t\t\t$this.setGridExpendButton( 'department_grid', $.i18n._( 'Department' ) );\n\t\t\t$this.setGridExpendButton( 'job_grid', $.i18n._( 'Job' ) );\n\t\t\t$this.setGridExpendButton( 'job_item_grid', $.i18n._( 'Task' ) );\n\t\t\t$this.setGridExpendButton( 'premium_grid', $.i18n._( 'Premium' ) );\n\t\t\t$this.setGridExpendButton( 'absence_grid', $.i18n._( 'Absence' ) );\n\t\t\t$this.setGridExpendButton( 'punch_note_grid', $.i18n._( 'Punch Notes' ) );\n\n\t\t\tif ( $this.getPunchMode() === 'punch' ) {\n\t\t\t\t//var selection = $this.grid.getSelection(); //provides memory of selected cells\n\t\t\t\t$this.grid.setData( $this.timesheet_data_source, true );\n\t\t\t\t//$this.grid.setTimesheetSelection( selection ); //resets selection after refreshing grid data -- currently broken, see setTimesheetSelection() for details.\n\t\t\t}\n\n\t\t\tif ( typeof $this.accumulated_time_grid.setData == 'function' ) {\n\t\t\t\t$this.accumulated_time_grid.setData( $this.accumulated_time_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.branch_grid.setData == 'function' ) {\n\t\t\t\t$this.branch_grid.setData( $this.branch_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.department_grid.setData == 'function' ) {\n\t\t\t\t$this.department_grid.setData( $this.department_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.job_grid.setData == 'function' ) {\n\t\t\t\t$this.job_grid.setData( $this.job_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.job_item_grid.setData == 'function' ) {\n\t\t\t\t$this.job_item_grid.setData( $this.job_item_source, false );\n\t\t\t}\n\n\t\t\tif ( typeof $this.premium_grid.setData == 'function' ) {\n\t\t\t\t$this.premium_grid.setData( $this.premium_source, false );\n\t\t\t}\n\n\t\t\tif ( $this.absence_grid ) {\n\t\t\t\t$this.absence_grid.setData( $this.absence_source, false );\n\t\t\t}\n\n\t\t\tif ( $this.accumulated_total_grid_source.length === 0 ) {\n\t\t\t\t$this.accumulated_total_grid_source.push();\n\t\t\t}\n\n\t\t\t$this.accumulated_total_grid.setData( $this.accumulated_total_grid_source, false );\n\t\t\t$this.punch_note_grid.setData( $this.punch_note_grid_source, false );\n\t\t\t$this.verification_grid.setData( $this.verification_grid_source, false );\n\n\t\t\t$this.setGridSize();\n\n\t\t\t$this.setTimeSheetGridPayPeriodHeaders();\n\t\t\t$this.setTimeSheetGridHolidayHeaders();\n\t\t\t$this.highLightSelectDay();\n\t\t\t$this.autoOpenEditViewIfNecessary();\n\t\t\t$this.setScrollPosition();\n\t\t\t$this.initRightClickMenu();\n\t\t\t$this.initRightClickMenu( RightClickMenuType.ABSENCE_GRID );\n\t\t\t$this.showWarningMessageIfAny();\n\t\t\t$this.setPunchModeClass();\n\n\t\t\tif ( $this.getPunchMode() != 'punch' ) {\n\t\t\t\tvar cols = $this.getManualPayPeriodDefaultTrColspan();\n\t\t\t\tfor ( var i = 1; i < cols; i++ ) {\n\t\t\t\t\t$( '.sub-grid td:nth-child(' + i + ')' ).css( 'border-right', 'none' );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsearchDone() {\n\t\t$( '.button-rotate' ).removeClass( 'button-rotate' ); //the rotate icon from search panel\n\n\t\tTTPromise.resolve( 'init', 'init' );\n\t\tTTPromise.wait();\n\n\t\t// TTPromise.wait( null, null, function () {\n\t\t//  //This was triggering JS exception: Permission denied to access property \"apply\" -- Seems like its no longer needed either.\n\t\t// \t$( window ).trigger( 'resize' );\n\t\t// } );\n\t}\n\n\tshowWarningMessageIfAny() {\n\t\tvar $this = this;\n\t\tvar timesheet_grid_div;\n\t\tvar warning_bar = $( this.el ).find( '.timesheet-warning-title-bar' );\n\t\twarning_bar.length > 0 && warning_bar.remove() && ( warning_bar = $( this.el ).find( '.timesheet-warning-title-bar' ) );\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\ttimesheet_grid_div = $( this.el ).find( '#gbox_' + this.ui_id + '_grid' );\n\t\t} else {\n\t\t\ttimesheet_grid_div = $( this.el ).find( '.manual-timesheet-inside-editor-div' );\n\t\t}\n\n\t\tvar user = this.getSelectEmployee( true );\n\t\tvar user_pay_period_check = payPeriodCheck( user );\n\n\t\t//There seems to be a race condition here where if the server hasn't returned all the user data for the dropdown box (due to being slow/including many columns), \"user.id\" will exist, but no other object properties will.\n\t\t//  This could trigger the below error message(s) to show when they shouldn't. So now we check to make sure there is at least more than 1 object property, and we check that the object properties actually exist and are actually blank, as compared to just checking that they don't exist previously.\n\t\tif ( Global.isObject( user ) && Object.keys( user ).length > 1 && ( ( user.hasOwnProperty( 'pay_period_schedule_id' ) && user.pay_period_schedule_id == '' ) || ( user.hasOwnProperty( 'policy_group_id' ) && user.policy_group_id == '' ) || user_pay_period_check == false ) ) {\n\t\t\twarning_bar = $( '<div class=\\'timesheet-warning-title-bar\\'><span class=\\'p-message\\'></span><span class=\\'g-message\\'></span><span class=\\'pp-message\\'></span></div>' );\n\t\t\twarning_bar.insertBefore( timesheet_grid_div );\n\n\t\t\tif ( user.hasOwnProperty( 'pay_period_schedule_id' ) && user.pay_period_schedule_id == '' ) { //!user.pay_period_schedule_id\n\t\t\t\twarning_bar.children().eq( 0 ).html( $.i18n._( 'WARNING: Employee is not assigned to a pay period schedule.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 0 ).html( '' );\n\t\t\t}\n\t\t\tif ( user.hasOwnProperty( 'policy_group_id' ) && user.policy_group_id == '' ) { //!user.policy_group_id\n\t\t\t\twarning_bar.children().eq( 1 ).html( $.i18n._( 'WARNING: Employee is not assigned to a policy group.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 1 ).html( '' );\n\t\t\t}\n\n\t\t\tif ( user_pay_period_check == false ) {\n\t\t\t\twarning_bar.children().eq( 2 ).html( $.i18n._( 'WARNING: Employee has day(s) not assigned to a pay period. Please perform a pay period import to correct.' ) );\n\t\t\t} else {\n\t\t\t\twarning_bar.children().eq( 2 ).html( '' );\n\t\t\t}\n\n\t\t} else {\n\t\t\tif ( warning_bar.length > 0 ) {\n\t\t\t\twarning_bar.remove();\n\t\t\t}\n\t\t}\n\n\t\tfunction payPeriodCheck( user ) {\n\t\t\tif ( $this.start_date ) {\n\t\t\t\tvar hire_date = user.hire_date;\n\t\t\t\tvar termination_date = user.termination_date;\n\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar select_date = new Date( new Date( $this.start_date.getTime() ).setDate( $this.start_date.getDate() + i ) );\n\t\t\t\t\tvar select_date_str = select_date.format();\n\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'getTime' of null in interface/html5/index.php?user_name=dustin#!m=TimeSheet&date=20151214&user_id=38599&show_wage=0 line 2947\n\t\t\t\t\tif ( !select_date ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( select_date.getTime() < new Date().getTime() && !$this.getPayPeriod( select_date_str ) &&\n\t\t\t\t\t\t( !hire_date || select_date.getTime() >= Global.strToDate( hire_date ).getTime() ) &&\n\t\t\t\t\t\t( !termination_date || select_date.getTime() <= Global.strToDate( termination_date ).getTime() ) ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tautoOpenEditViewIfNecessary() {\n\t\t//Auto open edit view. Should set in IndexController\n\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'edit':\n\t\t\t\tif ( LocalCacheData.edit_id_for_next_open_view ) {\n\t\t\t\t\tthis.onEditClick( LocalCacheData.edit_id_for_next_open_view, LocalCacheData.getAllURLArgs().t );\n\t\t\t\t\tLocalCacheData.edit_id_for_next_open_view = null;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase 'view':\n\t\t\t\tif ( LocalCacheData.edit_id_for_next_open_view ) {\n\t\t\t\t\tthis.onViewClick( LocalCacheData.edit_id_for_next_open_view, LocalCacheData.getAllURLArgs().t );\n\t\t\t\t\tLocalCacheData.edit_id_for_next_open_view = null;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'new':\n\t\t\t\tif ( !this.edit_view ) {\n\t\t\t\t\tif ( LocalCacheData.getAllURLArgs().t === 'absence' ) {\n\t\t\t\t\t\tthis.absence_model = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.absence_model = false;\n\t\t\t\t\t}\n\t\t\t\t\tthis.onAddClick();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.autoOpenEditOnlyViewIfNecessary();\n\t}\n\n\tgetWeekDayIndexFromADate( date_string ) {\n\n\t\tvar len = this.timesheet_columns.length;\n\n\t\tfor ( var i = 1; i < len; i++ ) {\n\t\t\tvar column = this.timesheet_columns[i];\n\t\t\tvar column_date_string = Global.strToDate( column.index, this.full_format ).format();\n\t\t\tif ( date_string === column_date_string ) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn 7;\n\t}\n\n\tsetAccumulatedTotalGridPayPeriodHeaders() {\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_accumulated_total_grid]' )[0] );\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr\"  role=\"rowheader\"  >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\" >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar default_th = new_th.clone();\n\n\t\tvar week_th = new_th.clone();\n\n\t\tvar pay_period_th = new_th.clone();\n\n\t\tweek_th.children( 0 ).text( $.i18n._( 'Week' ) );\n\t\tpay_period_th.children( 0 ).text( $.i18n._( 'Pay Period' ) );\n\n\t\tnew_tr.append( default_th );\n\t\tnew_tr.append( week_th );\n\t\tnew_tr.append( pay_period_th );\n\n\t\t//caused a render bug in v10. put back for v11\n\t\tvar ths = table.children( 0 ).find( 'th' );\n\t\tfor ( var i = 1; i < ths.length; i++ ) {\n\t\t\tvar th_width = $( ths[i] ).width();\n\t\t\tnew_tr.width( th_width );\n\t\t}\n\t\ttable.find( '.rowheader' ).remove();\n\t\ttable.find( 'thead' ).prepend( new_tr );\n\t}\n\n\tsetTimeSheetGridHolidayHeaders() {\n\t\tvar holiday_name_map = {};\n\t\tif ( this.full_timesheet_data && this.full_timesheet_data.holiday_data ) {\n\t\t\tfor ( var i = 0; i < this.full_timesheet_data.holiday_data.length; i++ ) {\n\t\t\t\tvar item = this.full_timesheet_data.holiday_data[i];\n\t\t\t\tvar standard_date = Global.strToDate( item.date_stamp ).format( this.full_format );\n\n\t\t\t\tvar cell = $( '<div></div>' );\n\t\t\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t\t\tcell = $( '.manual_grid_day_' + standard_date );\n\t\t\t\t} else {\n\t\t\t\t\tcell = $( 'div[id=\"jqgh_' + this.ui_id + '_grid_' + standard_date + '\"]' );\n\t\t\t\t}\n\n\t\t\t\tif ( cell && cell.text().indexOf( item.name ) == -1 && !holiday_name_map[item.name] ) {\n\t\t\t\t\tcell.html( cell.html() + '<br>' + item.name );\n\t\t\t\t\tholiday_name_map[item.name] = true;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\tgetManualPayPeriodDefaultTrColspan() {\n\t\tvar colspan = 2;\n\t\tif ( this.show_branch_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_department_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_job_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\tif ( this.show_job_item_ui ) {\n\t\t\tcolspan++;\n\t\t}\n\n\t\treturn colspan;\n\t}\n\n\tsetTimeSheetGridPayPeriodHeaders() {\n\t\tvar $this = this;\n\t\tvar table,\n\t\t\tsize_tr;\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\ttable = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' )[0] );\n\t\t\tsize_tr = $( '<tr class=\"size-tr\" role=\"row\" style=\"height: 0;\" >' + '</tr>' );\n\t\t} else {\n\t\t\ttable = this.$( '.grid-inside-editor-render' );\n\t\t\ttable.find( '.group-column-tr' ).remove();\n\t\t\tsize_tr = $( this.$( '.grid-inside-editor-render' ).find( 'tr' )[0] );\n\t\t}\n\n\t\ttable.find( '.group-column-tr' ).remove();\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr pay_period_header_row\"></tr>' );\n\t\tvar new_th = $( '<th class=\"group-column-th\"><span class=\"group-column-label\"></span></th>' );\n\t\tvar current_trs = table.find( '.ui-jqgrid-labels' );\n\n\t\t// createSizeColumns was added in 2014. When manual timesheet mode was added in 2016, things were refactored and this should have been pulled out.\n\t\t// Leaving it in causes  header row solumns to be out of alignment with the timesheet punch grid by a few pixels.\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\tcreateSizeColumns();\n\t\t\tsize_tr.insertBefore( table.find( 'thead .ui-jqgrid-labels' ) );\n\t\t}\n\n\t\tvar default_th;\n\t\tif ( Object.keys( this.pay_period_data ).length === 0 ) {\n\t\t\tdefault_th = new_th.clone();\n\t\t\tnew_tr.append( default_th );\n\t\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t\tdefault_th.attr( 'colspan', this.getManualPayPeriodDefaultTrColspan() );\n\t\t\t}\n\t\t\tcreateNoPayPeriodColumns( 7 );\n\t\t\tnew_tr.insertAfter( size_tr );\n\t\t\treturn;\n\t\t}\n\t\tvar current_end_index = 0;\n\t\tvar last_pay_period_id;\n\t\tvar column_number = 0;\n\t\tvar pay_period;\n\t\tvar map_array = [];\n\t\tfor ( var y = 0; y < this.column_maps.length; y++ ) {\n\t\t\tvar p_key = this.column_maps[y];\n\t\t\tvar pay_period_id = this.pay_period_map[p_key];\n\t\t\tif ( !pay_period_id ) {\n\t\t\t\tpay_period_id = -1;\n\t\t\t}\n\t\t\tmap_array.push( { date: p_key, time_stamp: Global.strToDate( p_key ).getTime(), id: pay_period_id } );\n\t\t}\n\n\t\tdefault_th = new_th.clone();\n\t\tnew_tr.append( default_th );\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tdefault_th.attr( 'colspan', this.getManualPayPeriodDefaultTrColspan() );\n\t\t}\n\t\tfor ( var j = 0; j < map_array.length; j++ ) {\n\t\t\tif ( !last_pay_period_id ) {\n\t\t\t\tlast_pay_period_id = map_array[j].id;\n\t\t\t\tpay_period = getPayPeriod( map_array[j].id );\n\t\t\t\tcolumn_number = column_number + 1;\n\t\t\t} else if ( last_pay_period_id !== map_array[j].id ) {\n\t\t\t\tif ( pay_period ) {\n\t\t\t\t\tcreateTh();\n\t\t\t\t} else {\n\t\t\t\t\tcreateNoPayPeriodColumns( column_number );\n\t\t\t\t}\n\t\t\t\tlast_pay_period_id = map_array[j].id;\n\t\t\t\tpay_period = getPayPeriod( map_array[j].id );\n\t\t\t\tcolumn_number = 1;\n\n\t\t\t} else {\n\t\t\t\tcolumn_number = column_number + 1;\n\t\t\t}\n\t\t\tif ( j === map_array.length - 1 && column_number > 0 ) {\n\t\t\t\tif ( pay_period ) {\n\t\t\t\t\tcreateTh();\n\t\t\t\t} else {\n\t\t\t\t\tcreateNoPayPeriodColumns( column_number );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t$( '.pay_period_header_row' ).remove();\n\t\tnew_tr.insertAfter( size_tr );\n\n\t\tfunction createTh() {\n\t\t\tvar start_date = Global.strToDate( pay_period.start_date ).format();\n\t\t\tvar end_date = Global.strToDate( pay_period.end_date ).format();\n\t\t\tvar colspan = column_number;\n\t\t\tvar pay_period_th = new_th.clone();\n\t\t\tpay_period_th.children( 0 ).text( start_date + ' ' + $.i18n._( 'to' ) + ' ' + end_date );\n\t\t\tpay_period_th.attr( 'colspan', colspan );\n\t\t\t/* jshint ignore:start */\n\t\t\tif ( pay_period.status_id == 12 || pay_period.status_id == 20 ) {\n\t\t\t\tpay_period_th.css( 'background', '#EC0000' );\n\t\t\t} else if ( pay_period.status_id == 30 ) {\n\t\t\t\tpay_period_th.css( 'background', '#EED614' );\n\t\t\t}\n\t\t\t/* jshint ignore:end */\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tfunction getPayPeriod( id ) {\n\t\t\tfor ( var key in $this.pay_period_data ) {\n\t\t\t\tvar pay_period = $this.pay_period_data[key];\n\t\t\t\tif ( pay_period.id === id ) {\n\t\t\t\t\treturn pay_period;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction createNoPayPeriodColumns( end_index ) {\n\t\t\tvar pay_period_th = new_th.clone();\n\t\t\tpay_period_th.addClass( 'no_pay_period_header' );\n\t\t\tpay_period_th.children( 0 ).text( $.i18n._( 'No Pay Period' ) );\n\t\t\tpay_period_th.attr( 'colspan', end_index );\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tfunction createSizeColumns() {\n\t\t\tvar len = current_trs.children().length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar th = $( '<td class=\"\"  role=\"gridcell\">' + '</td>' );\n\t\t\t\tvar item = current_trs.children().eq( i );\n\t\t\t\t//th.width( item.width() );\n\t\t\t\tth.height( 0 );\n\t\t\t\tth.css( 'width', item.css( 'width' ) );\n\t\t\t\tsize_tr.append( th );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetPayPeriodHeaderSize() {\n\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' ) );\n\t\tvar size_tr = table.find( '.size-tr' );\n\n\t\tif ( size_tr.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\t\t/**\n\t\t * #2353 - tiemsheet sizing fix\n\t\t *\n\t\t * Due to firefox reporting th widths incorrectly via the $.width() function, the sizes must come from the (tr.jqgfirstrow) of the data table\n\t\t * firefox also refuses to set the width of the first row of th's via the $.width() function, so we ned to ship the css values directly into the inline css using the css function\n\t\t */\n\t\tvar current_trs = table.find( '.jqgfirstrow' );\n\t\tvar len = current_trs.children().length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = current_trs.children().eq( i );\n\t\t\tsize_tr.children().eq( i ).css( 'width', item.css( 'width' ) );\n\t\t}\n\t}\n\n\thighLightSelectDay( e ) {\n\n\t\tif ( this.highlight_header ) {\n\t\t\tthis.highlight_header.removeClass( 'highlight-header' );\n\t\t}\n\n\t\t//Error: TypeError: select_date is null in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-081724 line 2 > eval line 3214\n\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t!select_date && ( select_date = new Date() );\n\n\t\tif ( this.getPunchMode() === 'punch' ) {\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date );\n\t\t} else {\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '.manual_grid_day_' + select_date );\n\t\t}\n\n\t\tthis.highlight_header.addClass( 'highlight-header' );\n\n\t\tif ( $( '.timesheet-grid tr td.ui-state-highlight' ).length == 0 && !e ) {\n\t\t\t$( $( '.timesheet-grid tr#1 td' )[this.highlight_header.index()] ).addClass( 'ui-state-highlight' );\n\t\t\t$( $( '.timesheet-grid tr#1 td' )[this.highlight_header.index()] ).click(); //trigger grid selection events\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsetGridHeight( grid_id ) {\n\t\tvar grid = this.grid_dic[grid_id];\n\t\tif ( grid.grid ) {\n\t\t\tgrid = grid.grid;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tvar len = 0;\n\n\t\tswitch ( grid_id ) {\n\t\t\tcase 'timesheet_grid':\n\t\t\t\tlen = this.timesheet_data_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_time_grid':\n\t\t\t\tlen = this.accumulated_time_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'branch_grid':\n\t\t\t\tlen = this.branch_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'department_grid':\n\t\t\t\tlen = this.department_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'job_grid':\n\t\t\t\tlen = this.job_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_grid':\n\t\t\t\tlen = this.job_item_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'premium_grid':\n\t\t\t\tlen = this.premium_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'absence_grid':\n\t\t\t\tlen = this.absence_source.length;\n\t\t\t\tbreak;\n\t\t\tcase 'accumulated_total_grid':\n\t\t\t\tlen = this.accumulated_total_grid_source.length;\n\t\t\t\tif ( this.wage_btn.getValue( true ) ) {\n\t\t\t\t\tgrid.setGridWidth( 600 );\n\t\t\t\t} else {\n\t\t\t\t\tgrid.setGridWidth( 500 );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'punch_note_grid':\n\n\t\t\t\tlen = this.punch_note_grid_source.length;\n\t\t\t\tthis.setPunchNoteGridSize( grid );\n\n\t\t\t\tbreak;\n\t\t\tcase 'verification_grid':\n\t\t\t\tlen = this.verification_grid_source.length;\n\t\t\t\tgrid.setGridWidth( 400 );\n\t\t}\n\n\t\tif ( LocalCacheData.timesheet_sub_grid_expended_dic[grid_id] === true ||\n\t\t\tgrid_id === 'timesheet_grid' ||\n\t\t\tgrid_id === 'accumulated_total_grid' ||\n\t\t\tgrid_id === 'punch_note_grid' ||\n\t\t\tgrid_id === 'verification_grid' ) {\n\t\t\tgrid.setGridHeight( len * 22 );\n\t\t} else {\n\t\t\tgrid.setGridHeight( 0 );\n\n\t\t}\n\n\t\t//dont't show scroll bar of grid\n\t\tgrid.parent().parent().css( 'overflow', 'hidden' );\n\n\t\t//Do not show grid if no data in it\n\t\tif ( len === 0 && grid_id !== 'accumulated_time_grid' && grid_id !== 'verification_grid' ) {\n\t\t\tgrid.parent().parent().parent().parent().hide();\n\t\t} else {\n\t\t\tgrid.parent().parent().parent().parent().show();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetGridSize() {\n\t\tvar $this = this;\n\n\t\t//TTGrid backwards compatible.\n\t\tvar $grid = this.grid;\n\t\tif ( $grid.grid ) {\n\t\t\t$grid = $grid.grid;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\tif ( ( !$grid || !$( $grid ).is( ':visible' ) ) && ( !this.editor || !this.editor.is( ':visible' ) ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var key in this.grid_dic ) {\n\t\t\tif ( key != 'punch_note_grid' ) {\n\t\t\t\tif ( !this.grid_dic[key].grid ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar grid = this.grid_dic[key].grid;\n\t\t\t\tgrid.setGridWidth( $( 'body' ).width() );\n\t\t\t\tthis.setGridHeight( key );\n\t\t\t}\n\t\t}\n\t\t//force punch note grid to be last, so that it is drawn after the grids it is dependant on to infer its size.\n\t\tthis.setGridHeight( 'punch_note_grid' ); //can't set height on this grid. until we fix what's wrong with it.\n\t\tif ( this.search_panel.is( ':visible' ) ) {\n\t\t\tthis.grid_div.height( $( this.el ).height() - this.search_panel.height() - 72 );\n\t\t} else {\n\t\t\tthis.grid_div.height( $( this.el ).height() - 72 );\n\t\t}\n\n\t\tthis.setPayPeriodHeaderSize();\n\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\t$this.setManualTimeSheetGridSize();\n\t\t}\n\t}\n\n\tsetPunchNoteGridSize( grid ) {\n\t\tif ( !grid ) {\n\t\t\tif ( !this.punch_note_grid || !this.punch_note_grid.grid ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tgrid = this.punch_note_grid.grid;\n\t\t}\n\n\t\tvar grid_width = grid.width();\n\n\t\tvar accumulated_grid_width = ( this.accumulated_total_grid && this.accumulated_total_grid.grid ) ? this.accumulated_total_grid.getWidth() : 0;\n\t\tvar verification_grid_width = ( this.verification_grid && this.verification_grid.grid ) ? this.verification_grid.getWidth() : 0;\n\n\t\tif ( this.verification_grid_source.length !== 0 ) {\n\t\t\tgrid_width = Math.floor( Global.bodyWidth() - ( accumulated_grid_width + verification_grid_width + 25 ) );\n\t\t} else {\n\t\t\tgrid_width = Math.floor( Global.bodyWidth() - ( 25 + accumulated_grid_width ) );\n\t\t}\n\t\tgrid_width = Math.abs( grid_width );\n\n\t\tif ( grid_width != grid.width() ) {\n\t\t\t//Debug.Text(\"Setting punch note grid width to \" + grid_width, 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'setGridHeight', 10);\n\t\t\tgrid.setGridWidth( grid_width );\n\t\t\t$( 'td.notes_grid_td_container' ).css( 'width', '100%' );\n\t\t}\n\t}\n\n\tsetManualTimeSheetGridSize() {\n\t\tvar tr = $( this.accumulated_time_grid.grid.find( 'tr:first-child' )[0] );\n\t\tvar manual_grid_tr = $( this.editor.find( 'table' ).find( 'tr:first-child' )[0] );\n\t\tvar index = 0;\n\t\tfor ( var i = 0, m = manual_grid_tr.children().length; i < m; i++ ) {\n\t\t\tvar td = $( manual_grid_tr.children()[i] );\n\t\t\tif ( !td.is( ':visible' ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t$( td ).css( 'width', $( tr.children()[index] ).css( 'width' ) );\n\t\t\tindex++;\n\t\t}\n\n\t\tthis.editor.width( this.accumulated_time_grid.getGridWidth() );\n\t}\n\n\tonCellFormat( cell_value, related_data, row ) {\n\t\tvar col_model = related_data.colModel;\n\t\tvar row_id = related_data.rowid;\n\t\tvar content_div = $( '<div class=\\'punch-content-div\\'></div>' );\n\t\tvar punch_info;\n\t\tvar ex_span;\n\t\tvar i;\n\t\tvar time_span;\n\t\tvar punch;\n\t\tvar break_span;\n\t\tvar related_punch;\n\t\tvar exception;\n\t\tvar len;\n\t\tvar text;\n\t\tvar ex;\n\t\tvar data;\n\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\tcell_value = Global.decodeCellValue( cell_value );\n\t\tif ( related_data.pos === 0 ) {\n\t\t\tif ( row.type === TimeSheetViewController.TOTAL_ROW ) {\n\t\t\t\tpunch_info = $( '<span class=\\'total\\' style=\\'font-size: 11px\\'></span>' );\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tpunch_info.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\tpunch_info.text( '' );\n\t\t\t\t}\n\n\t\t\t\treturn punch_info.get( 0 ).outerHTML;\n\t\t\t} else if ( row.type === TimeSheetViewController.REGULAR_ROW ) {\n\t\t\t\tpunch_info = $( '<span class=\\'top-line-span\\' style=\\'font-size: 11px\\'></span>' );\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tpunch_info.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\tpunch_info.text( '' );\n\t\t\t\t}\n\t\t\t\treturn punch_info.get( 0 ).outerHTML;\n\t\t\t}\n\n\t\t\treturn cell_value;\n\n\t\t}\n\n\t\tif ( row.type === TimeSheetViewController.PUNCH_ROW ) {\n\t\t\tpunch = row[col_model.name + '_data'];\n\t\t\trelated_punch = row[col_model.name + '_related_data'];\n\t\t\ttime_span = $( '<span class=\\'punch-time\\'></span>' );\n\t\t\tbreak_span = $( '<span class=\\'punch-break\\'></span>' );\n\n\t\t\tif ( punch ) {\n\t\t\t\texception = punch.exception;\n\n\t\t\t\tif ( punch.type_id == 20 ) {\n\t\t\t\t\tbreak_span.text( 'L' );\n\t\t\t\t} else if ( punch.type_id == 30 ) {\n\t\t\t\t\tbreak_span.text( 'B' );\n\t\t\t\t}\n\n\t\t\t\tif ( punch.note ) {\n\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t}\n\n\t\t\t\tvar label_suffix = '';\n\n\t\t\t\tif ( punch.latitude && punch.latitude != 0 && punch.longitude && punch.longitude != 0 ) {\n\t\t\t\t\tlabel_suffix = 'G';\n\t\t\t\t}\n\n\t\t\t\tif ( punch.has_image ) {\n\t\t\t\t\tlabel_suffix = label_suffix + 'F';\n\t\t\t\t}\n\n\t\t\t\tif ( label_suffix ) {\n\t\t\t\t\tcell_value = cell_value + ' ' + label_suffix;\n\t\t\t\t}\n\n\t\t\t\tif ( punch.tainted ) {\n\t\t\t\t\ttime_span.css( 'color', '#ff0000' );\n\t\t\t\t}\n\n\t\t\t\tcontent_div.append( break_span );\n\n\t\t\t} else if ( related_punch ) {\n\t\t\t\texception = related_punch.exception;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\t\t\tif ( exception ) {\n\t\t\t\tlen = exception.length;\n\t\t\t\ttext = '';\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tex = exception[i];\n\t\t\t\t\tex_span = $( '<span class=\\'punch-exceptions\\'></span>' );\n\t\t\t\t\tex_span.css( 'color', ex.exception_color );\n\t\t\t\t\tex_span.text( ex.exception_policy_type_id );\n\t\t\t\t\tex_span.attr( 'title', ex.exception_policy_type_id + ': ' + ex.exception_policy_type );\n\t\t\t\t\tcontent_div.prepend( ex_span );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tex_span = $( '<span class=\\'punch-exceptions\\'></span>' );\n\t\t\t\tex_span.text( ' ' );\n\t\t\t\tcontent_div.prepend( ex_span );\n\t\t\t}\n\n\t\t} else if ( row.type === TimeSheetViewController.EXCEPTION_ROW ) {\n\t\t\texception = row[col_model.name + '_exceptions'];\n\n\t\t\tif ( Global.isSet( exception ) ) {\n\t\t\t\tlen = exception.length;\n\t\t\t\ttext = '';\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tex = exception[i];\n\t\t\t\t\tex_span = $( '<span class=\\'punch-exceptions-center\\'></span>' );\n\t\t\t\t\tex_span.css( 'color', ex.exception_color );\n\t\t\t\t\tex_span.text( ex.exception_policy_type_id );\n\t\t\t\t\tex_span.attr( 'title', ex.exception_policy_type_id + ': ' + ex.exception_policy_type );\n\n\t\t\t\t\tcontent_div.append( ex_span );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else if ( row.type === TimeSheetViewController.REQUEST_ROW ) {\n\t\t\ttime_span = $( '<span class=\\'request\\'></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t\ttime_span.attr( 'title', createRequestToolTip( row[col_model.name + '_request'] ) );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.TOTAL_ROW ) {\n\n\t\t\tdata = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span class=\\'total\\'></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'total--bold time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.getPunchMode() === 'punch' ) {\n\t\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif ( !data.override && row.key === 'worked_time' ) {\n\t\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.REGULAR_ROW ) {\n\n\t\t\tcontent_div.addClass( 'top-line' );\n\n\t\t\tdata = row[col_model.name + '_data'];\n\n\t\t\ttime_span = $( '<span></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.ABSENCE_ROW ) {\n\n\t\t\tvar absence = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( absence ) {\n\n\t\t\t\t\tif ( absence.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( absence.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.text( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else if ( row.type === TimeSheetViewController.ACCUMULATED_TIME_ROW ||\n\t\t\trow.type === TimeSheetViewController.PREMIUM_ROW ) {\n\t\t\tdata = row[col_model.name + '_data'];\n\t\t\ttime_span = $( '<span  style=\\'width: 100%\\'></span>' );\n\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\tif ( data ) {\n\n\t\t\t\t\tif ( data.hasOwnProperty( 'note' ) && data.note ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( time_sheet_view_controller.wage_btn && time_sheet_view_controller.wage_btn.getValue( true ) && data.hasOwnProperty( 'total_time_amount' ) && data.total_time_amount && data.hasOwnProperty( 'hourly_rate' ) && data.hourly_rate ) {\n\t\t\t\t\t\ttime_span = $( '<div class=\\'time-sheet-view-wage-container\\'></div>' );\n\t\t\t\t\t\tcell_value = '<span class=\"time-sheet-view-wage-hour-rate\">' + currency + Global.MoneyRound( data.hourly_rate ) + '/hr @</span>' +\n\t\t\t\t\t\t\t'<span class=\"time-sheet-view-wage-value\">' + cell_value +\n\t\t\t\t\t\t\t'</span ><span class=\"time-sheet-view-wage-amount\" >= ' + currency + Global.MoneyRound( data.total_time_amount ) +\n\t\t\t\t\t\t\t'</span>';\n\t\t\t\t\t}\n\t\t\t\t\tif ( data.hasOwnProperty( 'override' ) && data.override === true ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-override' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\n\t\t} else {\n\t\t\ttime_span = $( '<span class=\\'punch-time\\'></span>' );\n\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\ttime_span.text( cell_value );\n\t\t\t} else {\n\t\t\t\ttime_span.text( '' );\n\t\t\t}\n\t\t\tcontent_div.prepend( time_span );\n\t\t}\n\n\t\tfunction createRequestToolTip( value ) {\n\t\t\tvar label;\n\t\t\tif ( Global.isArray( value ) ) {\n\t\t\t\tlabel = calDAndA( value );\n\t\t\t} else if ( Global.isObject( value ) && value.status ) {\n\t\t\t\tlabel = value.status; //Use the label directly from the API.\n\t\t\t}\n\n\t\t\tfunction calDAndA( array ) {\n\t\t\t\tvar len = array.length;\n\t\t\t\tvar a = 0;\n\t\t\t\tvar d = 0;\n\t\t\t\tvar p = 0;\n\t\t\t\tvar label = '';\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tvar item = array[i];\n\t\t\t\t\tif ( item.status_id == 50 ) {\n\t\t\t\t\t\ta = a + 1;\n\t\t\t\t\t} else if ( item.status_id == 55 ) {\n\t\t\t\t\t\td = d + 1;\n\t\t\t\t\t} else if ( item.status_id == 30 ) {\n\t\t\t\t\t\tp = p + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ( a > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Authorized' ) + ': ' + a;\n\t\t\t\t}\n\t\t\t\tif ( p > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Pending' ) + ': ' + p;\n\t\t\t\t}\n\t\t\t\tif ( d > 0 ) {\n\t\t\t\t\tlabel += ' ' + $.i18n._( 'Declined' ) + ': ' + d;\n\t\t\t\t}\n\t\t\t\treturn label;\n\t\t\t}\n\n\t\t\treturn label;\n\t\t}\n\n\t\tcontent_div.addClass( 'date-column' );\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tonSelectRow( grid_id, row_id, target ) {\n\t\tvar $this = this;\n\t\tvar row_tr = $( target ).find( 'tr#' + row_id );\n\t\t$this.timesheet_grid.grid.find( 'td.ui-state-highlight' ).removeClass( 'ui-state-highlight' );\n\t\tvar cells_array = [];\n\t\tvar len = 0;\n\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\tcells_array = $this.select_cells_Array;\n\t\t\tlen = $this.select_cells_Array.length;\n\t\t\t$this.absence_select_cells_Array = [];\n\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\tcells_array = $this.absence_select_cells_Array;\n\t\t\tlen = $this.absence_select_cells_Array.length;\n\t\t\t$this.select_cells_Array = [];\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\tcells_array = $this.accumulated_time_cells_array;\n\t\t\tlen = $this.accumulated_time_cells_array.length;\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\tcells_array = $this.premium_cells_array;\n\t\t\tlen = $this.premium_cells_array.length;\n\t\t}\n\t\tthis.select_punches_array = [];\n\t\t/* jshint ignore:start */\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.addClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\n\t\t\tif ( info.punch && info.punch.id ) {\n\n\t\t\t\tif ( Global.isSet( info.punch.time_stamp ) ) { //date + time number\n\t\t\t\t\tvar date = Global.strToDate( info.punch.punch_date ).format( 'MM-DD-YYYY' );\n\t\t\t\t\tvar date_time = date + ' ' + info.punch.punch_time;\n\t\t\t\t\tinfo.punch.time_stamp_num = Global.strToDateTime( date_time ).getTime();\n\t\t\t\t} else {\n\t\t\t\t\tinfo.punch.time_stamp_num = info.time_stamp_num; //Uer time_stamp_num from cell select setting, a date number\n\t\t\t\t}\n\t\t\t\tthis.select_punches_array.push( info.punch );\n\t\t\t\tthis.select_punches_array.sort( function( a, b ) {\n\t\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t\t/* jshint ignore:end */\n\t}\n\n\tunsetSelectedCells( grid_id ) {\n\t\tif ( grid_id == 'accumulated_grid' ) {\n\t\t\tgrid_id = 'accumulated_time_grid';\n\t\t}\n\n\t\tif ( this.last_clicked_grid_id && grid_id != this.last_clicked_grid_id ) {\n\t\t\t//Use window setTimeout to make this code asyncchronous for speed, it's the fastest way.\n\t\t\t//web worker : 850ms\n\t\t\t//inline code : 700ms\n\t\t\t//setTimeout: 400ms\n\t\t\twindow.setTimeout( function( t, n ) {\n\t\t\t\tt.grid_dic[n].grid.trigger( 'reloadGrid' );\n\t\t\t}, 0, this, this.last_clicked_grid_id );\n\t\t}\n\n\t\t//this.setDefaultMenu();\n\t\tthis.last_clicked_grid_id = grid_id;\n\t}\n\n\tgetRowData( grid_id, row_id ) {\n\t\tvar $this = this;\n\n\t\tvar row_data = null;\n\n\t\tif ( grid_id === 'absence_grid' ) {\n\t\t\trow_data = $this.absence_grid.getGridParam( 'data' );\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\trow_data = $this.accumulated_time_grid.getGridParam( 'data' );\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\trow_data = $this.premium_grid.getGridParam( 'data' );\n\t\t} else { //Should be: timesheet_grid\n\t\t\trow_data = $this.grid.getGridParam( 'data' );\n\t\t}\n\n\t\tvar row = false;\n\n\t\tfor ( var i in row_data ) {\n\t\t\tif ( row_data[i].id == row_id ) {\n\t\t\t\trow = row_data[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn row;\n\t}\n\n\tonCellSelect( grid_id, row_id, cell_index, cell_val, target, e ) {\n\t\t$( '#ribbon_view_container .context-menu:visible a' ).click();\n\n\t\tif ( cell_index < 0 ) {\n\t\t\tthis.unsetSelectedCells( grid_id );\n\t\t\tthis.setDefaultMenu();\n\t\t\treturn true; //continue default processing.\n\t\t}\n\n\t\tcell_index = parseInt( cell_index );\n\n\t\tvar $this = this;\n\t\tvar row;\n\t\tvar colModel;\n\t\tvar data_field;\n\t\tvar punch;\n\t\tvar related_punch;\n\t\tvar cells_array = [];\n\t\tvar date;\n\t\t$this.absence_model = false;\n\n\t\trow = $this.getRowData( grid_id, row_id );\n\n\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\tcells_array = $this.select_cells_Array;\n\n\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row.type === TimeSheetViewController.REQUEST_ROW ) {\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tfilter.filter_data.user_id = this.getSelectEmployee();\n\t\t\t\tfilter.filter_data.start_date = $this.full_timesheet_data.timesheet_dates.start_display_date;\n\t\t\t\tfilter.filter_data.end_date = $this.full_timesheet_data.timesheet_dates.end_display_date;\n\t\t\t\tfilter.filter_data.id = [];\n\n\t\t\t\t$this.unsetSelectedCells( grid_id );\n\t\t\t\tvar pending_requests = 0;\n\t\t\t\tvar total_requests = 0;\n\t\t\t\tif ( Global.isArray( row[data_field + '_request'] ) ) {\n\t\t\t\t\tfor ( var n in row[data_field + '_request'] ) {\n\t\t\t\t\t\tvar obj = row[data_field + '_request'][n];\n\t\t\t\t\t\tfilter.filter_data.id.push( obj.id );\n\t\t\t\t\t\tif ( obj.status == $.i18n._( 'PENDING' ) ) {\n\t\t\t\t\t\t\tpending_requests += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttotal_requests += 1;\n\t\t\t\t\t}\n\t\t\t\t} else if ( row[data_field + '_request'] ) {\n\t\t\t\t\t//is object;\n\t\t\t\t\tfilter.filter_data.id.push( row[data_field + '_request'].id );\n\t\t\t\t\tif ( row[data_field + '_request'].status == $.i18n._( 'PENDING' ) ) {\n\t\t\t\t\t\tpending_requests = 1;\n\t\t\t\t\t}\n\t\t\t\t\ttotal_requests = 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\n\t\t\t\tif ( total_requests > 0 ) {\n\t\t\t\t\tif ( this.getSelectEmployee() != LocalCacheData.getLoginUser().id && pending_requests > 0 ) {\n\t\t\t\t\t\t//Handle cases where an administrator who can see all requests might click on a pending request cell and want to be taken to MyAccount -> Requests\n\t\t\t\t\t\t//rather than MyAccount -> Request Authorization, which wouldn't show anything.\n\t\t\t\t\t\tif ( this.ownerOrChildPermissionValidate( 'request', 'view_child', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'RequestAuthorization', filter );\n\t\t\t\t\t\t} else if ( this.viewPermissionValidate( 'request', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'Request', filter );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//If the request isn't pending, then go to MyAccount -> Requests, and MyAccount -> Request Authorization wouldn't show anything.\n\t\t\t\t\t\tif ( this.viewPermissionValidate( 'request', filter.filter_data.id ) ) {\n\t\t\t\t\t\t\tIndexViewController.goToView( 'Request', filter );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( row && row[data_field + '_data'] ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\trelated_punch = row[data_field + '_related_data'];\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\tcells_array = $this.absence_select_cells_Array;\n\n\t\t\tcolModel = $this.absence_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\t// Error: Uncaught TypeError: Cannot read property 'punch_info_data' of undefined in interface/html5/#!m=TimeSheet&date=20151220&user_id=null&show_wage=0 line 3761\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t$this.absence_model = true;\n\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\n\t\t\tcells_array = $this.accumulated_time_cells_array;\n\n\t\t\tcolModel = $this.accumulated_time_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t} else if ( grid_id === 'premium_grid' ) {\n\n\t\t\tcells_array = $this.premium_cells_array;\n\n\t\t\tcolModel = $this.premium_grid.getGridParam( 'colModel' );\n\n\t\t\tdata_field = colModel[cell_index].name;\n\n\t\t\tif ( row ) {\n\t\t\t\tpunch = row[data_field + '_data'];\n\t\t\t} else {\n\t\t\t\tpunch = null;\n\t\t\t}\n\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t}\n\n\t\tif ( Global.isValidDate( date ) == false ) {\n\t\t\t$this.unsetSelectedCells( grid_id );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar info;\n\t\tvar row_tr;\n\t\tvar cell_td;\n\t\t//Clean all select cells first\n\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\tinfo = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\t$( target ).find( 'tr' ).removeClass( 'ui-state-highlight' );\n\t\t\tcell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', false );\n\t\t}\n\n\t\tvar date_str;\n\t\tvar time_stamp_num;\n\n\t\t// Add multiple selectiend_display_date if click cell and hold ctrl or command\n\t\tif ( e.ctrlKey || e.metaKey ) {\n\t\t\tvar found = false;\n\t\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\t\t\t\tif ( row_id == info.row_id && cell_index == info.cell_index ) {\n\t\t\t\t\tcells_array.splice( i, 1 );\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdate_str = date.format();\n\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\tif ( !found ) {\n\t\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t\tpunch = getCellPunch( row_id, cell_index );\n\t\t\t\t\trelated_punch = getRelatedPunch( row_id, cell_index );\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t\t\t$this.select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t\t\t$this.absence_select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if ( e.shiftKey && cells_array.length > 0 ) {\n\t\t\tvar status_id = cells_array[0].status_id; //Get status_id of first punch so we can defaults to that on new.\n\n\t\t\t//cell.row_id is numeric here.\n\t\t\tvar start_row_index = parseInt( cells_array[0].row_id );\n\t\t\tvar start_cell_index = parseInt( cells_array[0].cell_index );\n\n\t\t\tvar end_row_index = row_id;\n\t\t\tvar end_cell_index = cell_index;\n\n\t\t\tif ( start_row_index > end_row_index ) {\n\t\t\t\tvar tmp_row_index = start_row_index;\n\t\t\t\tstart_row_index = end_row_index;\n\t\t\t\tend_row_index = tmp_row_index;\n\t\t\t}\n\n\t\t\tif ( start_cell_index > end_cell_index ) {\n\t\t\t\tvar tmp_cell_index = start_cell_index;\n\t\t\t\tstart_cell_index = end_cell_index;\n\t\t\t\tend_cell_index = tmp_cell_index;\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < cells_array.length; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\n\t\t\t\tvar tmp_row_id = parseInt( info.row_id );\n\n\t\t\t\tif ( tmp_row_id < start_row_index ) {\n\t\t\t\t\tstart_row_index = tmp_row_id;\n\t\t\t\t}\n\t\t\t\tif ( tmp_row_id > end_row_index ) {\n\t\t\t\t\tend_row_index = tmp_row_id;\n\t\t\t\t}\n\n\t\t\t\tif ( info.cell_index < start_cell_index ) {\n\t\t\t\t\tstart_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t\tif ( info.cell_index > end_cell_index ) {\n\t\t\t\t\tend_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//If the click is inside the existing selection, truncate the existing selection to the click.\n\t\t\t//Check in ScheduleViewController.js for related change\n\t\t\t//Make sure to check for cells_array and cells_array.length before the other checks or when the user clicks into another grid while holding shift, it throws the following error:\n\t\t\t//Cannot read property 'cell_index' of undefined\n\n\t\t\tvar uppermost_row_index = parseInt( cells_array[0].row_id );\n\t\t\tvar lowermost_row_index = parseInt( cells_array[cells_array.length - 1].row_id );\n\t\t\tvar leftmost_cell_index = parseInt( cells_array[0].cell_index );\n\t\t\tvar rightmost_cell_index = parseInt( cells_array[cells_array.length - 1].cell_index );\n\n\t\t\tif ( cells_array && cells_array.length > 0 && cells_array[cells_array.length - 1].cell_index && cells_array[0].cell_index\n\t\t\t\t&& rightmost_cell_index >= cell_index\n\t\t\t\t&& leftmost_cell_index <= cell_index\n\t\t\t\t&& lowermost_row_index >= row_id\n\t\t\t\t&& uppermost_row_index <= row_id ) {\n\t\t\t\tend_row_index = row_id;\n\t\t\t\tend_cell_index = cell_index;\n\t\t\t}\n\n\t\t\t//build cells_array\n\t\t\tcells_array = [];\n\n\t\t\tfor ( var i = start_row_index; i <= end_row_index; i++ ) {\n\t\t\t\tvar r_index = i;\n\t\t\t\tfor ( var j = start_cell_index; j <= end_cell_index; j++ ) {\n\t\t\t\t\tvar c_index = j;\n\n\t\t\t\t\trow_tr = $( target ).find( 'tr#' + r_index );\n\n\t\t\t\t\tcell_td = $( row_tr.find( 'td' )[c_index] );\n\n\t\t\t\t\tcell_val = cell_td[0].outerHTML;\n\n\t\t\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t\t\tpunch = getCellPunch( i, j );\n\t\t\t\t\t\trelated_punch = getRelatedPunch( i, j );\n\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\t\trow_id: r_index,\n\t\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\t\tstatus_id: status_id,\n\t\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t\t\tcolModel = $this.absence_grid.getGridParam( 'colModel' );\n\n\t\t\t\t\t\tdata_field = colModel[c_index].name;\n\n\t\t\t\t\t\tpunch = row[data_field + '_data'];\n\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = date.getTime();\n\n\t\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\t\trow_id: r_index, //see bug #2149\n\t\t\t\t\t\t\t//row_id: r_index.toString(),\n\t\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t\t\tcells_array = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t\t$this.select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t\t$this.absence_select_cells_Array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t\t$this.accumulated_time_cells_array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t\t$this.premium_cells_array.sort( Global.m_sort_by( ['time_stamp_num', 'row_id'] ) );\n\t\t\t}\n\n\t\t} else {\n\t\t\tdate_str = date ? date.format() : '';\n\t\t\ttime_stamp_num = date ? date.getTime() : 0;\n\t\t\tif ( grid_id === 'timesheet_grid' ) {\n\t\t\t\t//get the punch data.\n\t\t\t\tpunch = getCellPunch( row_id, cell_index );\n\n\t\t\t\trelated_punch = getRelatedPunch( row_id, cell_index );\n\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tstatus_id: ( row && row.status_id ) ? row.status_id : null,\n\t\t\t\t\t\trelated_punch: related_punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.select_cells_Array = cells_array;\n\t\t\t} else if ( grid_id === 'absence_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tpunch: punch,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tsrc_object_id: ( row.punch_info_id ) ? row.punch_info_id : null,\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.absence_select_cells_Array = cells_array;\n\t\t\t} else if ( grid_id === 'accumulated_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.accumulated_time_cells_array = cells_array;\n\t\t\t} else if ( grid_id === 'premium_grid' ) {\n\t\t\t\tcells_array = [\n\t\t\t\t\t{\n\t\t\t\t\t\trow_id: row_id,\n\t\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num\n\t\t\t\t\t}\n\t\t\t\t];\n\n\t\t\t\t$this.premium_cells_array = cells_array;\n\t\t\t}\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\tthis.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\tthis.highLightSelectDay( e );\n\t\t\t\tthis.reLoadSubGridsSource();\n\t\t\t}\n\n\t\t\tthis.unsetSelectedCells( grid_id );\n\t\t}\n\n\t\t//now set the selected punches array\n\t\tthis.select_punches_array = [];\n\t\tfor ( var n in cells_array ) {\n\t\t\tif ( cells_array[n].punch ) {\n\t\t\t\tthis.select_punches_array.push( cells_array[n].punch );\n\t\t\t}\n\t\t}\n\t\tthis.setTimesheetGridDragAble();\n\n\t\tfunction getCellPunch( row_id, cell_index ) {\n\t\t\tvar punch = null;\n\t\t\trow = null;\n\t\t\tfor ( var i in $this.timesheet_data_source ) {\n\t\t\t\tif ( $this.timesheet_data_source[i].id == row_id ) {\n\t\t\t\t\trow = $this.timesheet_data_source[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( row ) {\n\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdata_field = colModel[cell_index].name;\n\t\t\t\tpunch = row[data_field + '_data'] ? row[data_field + '_data'] : null;\n\t\t\t}\n\t\t\treturn punch;\n\t\t}\n\n\t\tfunction getRelatedPunch( row_id, cell_index ) {\n\t\t\tvar related_punch = null;\n\t\t\trow = null;\n\t\t\tfor ( var i in $this.timesheet_data_source ) {\n\t\t\t\tif ( $this.timesheet_data_source[i].id == row_id ) {\n\t\t\t\t\trow = $this.timesheet_data_source[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t//row = $this.timesheet_data_source[row_id -1 ];\n\t\t\tif ( row ) {\n\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdata_field = colModel[cell_index].name;\n\t\t\t\trelated_punch = row[data_field + '_related_data'] ? row[data_field + '_related_data'] : null;\n\t\t\t}\n\t\t\treturn related_punch;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget_selected_punch_array() {\n\t}\n\n\tbuildTimeSheetRequests() {\n\t\tvar request_array = this.full_timesheet_data.request_data;\n\t\tvar len = request_array.length;\n\t\tvar request_row_index = null;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar request = request_array[i];\n\n\t\t\tvar date_string = Global.strToDate( request.date_stamp ).format( this.full_format );\n\n\t\t\tvar row;\n\t\t\t//Build Exception row at bottom\n\t\t\tif ( !request_row_index ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = $.i18n._( 'Requests' );\n\t\t\t\trow.user_id = request.user_id;\n\t\t\t\trow[date_string] = request.status;\n\t\t\t\trow[date_string + '_request'] = request;\n\n\t\t\t\trow.type = TimeSheetViewController.REQUEST_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\trequest_row_index = this.timesheet_data_source.length - 1;\n\t\t\t} else {\n\t\t\t\trow = this.timesheet_data_source[request_row_index];\n\t\t\t\tif ( !Global.isSet( row[date_string + '_request'] ) ) {\n\t\t\t\t\trow[date_string] = request.status;\n\t\t\t\t\trow[date_string + '_request'] = request;\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( $.type( row[date_string + '_request'] ) === 'array' ) {\n\t\t\t\t\t\trow[date_string + '_request'].push( request );\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string + '_request'] = [row[date_string + '_request']];\n\t\t\t\t\t\trow[date_string + '_request'].push( request );\n\t\t\t\t\t}\n\n\t\t\t\t\trow[date_string] = calDAndA( row[date_string + '_request'] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tfunction calDAndA( array ) {\n\t\t\tvar len = array.length;\n\t\t\tvar a = 0;\n\t\t\tvar d = 0;\n\t\t\tvar p = 0;\n\t\t\tvar label = '';\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = array[i];\n\t\t\t\tif ( item.status_id == 50 ) {\n\t\t\t\t\ta = a + 1;\n\t\t\t\t} else if ( item.status_id == 55 ) {\n\t\t\t\t\td = d + 1;\n\t\t\t\t} else if ( item.status_id == 30 ) {\n\t\t\t\t\tp = p + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( a > 0 ) {\n\t\t\t\tlabel += ' A: ' + a;\n\t\t\t}\n\t\t\tif ( p > 0 ) {\n\t\t\t\tlabel += ' P: ' + p;\n\t\t\t}\n\t\t\tif ( d > 0 ) {\n\t\t\t\tlabel += ' D: ' + d;\n\t\t\t}\n\t\t\treturn label;\n\t\t}\n\t}\n\n\tbuildTimeSheetExceptions() {\n\t\tvar exception_array = this.full_timesheet_data.exception_data;\n\n\t\tvar len = exception_array.length;\n\t\tvar timesheet_data_source_len = this.timesheet_data_source.length;\n\t\tvar exception_row_index = null;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar ex = exception_array[i];\n\t\t\tvar date_string = Global.strToDate( ex.date_stamp ).format( this.full_format );\n\t\t\tvar row;\n\t\t\t//Build Exception row at bottom\n\t\t\tif ( !exception_row_index ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = $.i18n._( 'Exceptions' );\n\t\t\t\trow.user_id = ex.user_id;\n\t\t\t\trow[date_string] = '';\n\t\t\t\trow[date_string + '_exceptions'] = [ex];\n\n\t\t\t\trow.type = TimeSheetViewController.EXCEPTION_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\texception_row_index = this.timesheet_data_source.length - 1;\n\t\t\t} else {\n\t\t\t\trow = this.timesheet_data_source[exception_row_index];\n\t\t\t\tif ( !Global.isSet( row[date_string + '_exceptions'] ) ) {\n\t\t\t\t\trow[date_string + '_exceptions'] = [ex];\n\t\t\t\t} else {\n\t\t\t\t\trow[date_string + '_exceptions'].push( ex );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar punch;\n\t\t\tvar j;\n\t\t\tif ( !Global.isFalseOrNull( ex.punch_id ) ) {\n\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\n\t\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( row[date_string + '_data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_data'];\n\t\t\t\t\t} else if ( row[date_string + '_related__data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_related_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( punch && punch.id === ex.punch_id && !punch.exception ) {\n\t\t\t\t\t\tpunch.exception = [ex];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( !Global.isFalseOrNull( ex.punch_control_id ) ) {\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\n\t\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( row[date_string + '_data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_data'];\n\t\t\t\t\t} else if ( row[date_string + '_related__data'] ) {\n\t\t\t\t\t\tpunch = row[date_string + '_related_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( punch && punch.punch_control_id === ex.punch_control_id && !punch.exception ) {\n\t\t\t\t\t\tpunch.exception = [ex];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Make sure Totle_time go to last item\n\tsortAccumulatedTotalData() {\n\n\t\tvar sort_fields = ['order', 'punch_info'];\n\t\tthis.accumulated_total_grid_source.sort( Global.m_sort_by( sort_fields ) );\n\t}\n\n\t// Make sure total time go to last item\n\tsortAccumulatedTimeData() {\n\n\t\tvar sort_fields = ['order', 'punch_info'];\n\t\tthis.accumulated_time_source.sort( Global.m_sort_by( sort_fields ) );\n\t}\n\n\treLoadSubGridsSource( force ) {\n\t\t// Error: Uncaught TypeError: Cannot read property 'pay_period_id' of undefined in interface/html5/#!m=TimeSheet&date=20151214&user_id=null&show_wage=0 line 4290\n\t\tif ( !this.full_timesheet_data || !this.full_timesheet_data.timesheet_verify_data ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !force ) {\n\t\t\tif ( this.full_timesheet_data.timesheet_verify_data.pay_period_id === this.pay_period_map[this.getSelectDate()] ||\n\t\t\t\t( !Global.isSet( this.full_timesheet_data.timesheet_verify_data.pay_period_id ) && !this.pay_period_map[this.getSelectDate()] )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.accumulated_time_source_map = {};\n\t\tthis.branch_source_map = {};\n\t\tthis.department_source_map = {};\n\t\tthis.job_source_map = {};\n\t\tthis.job_item_source_map = {};\n\t\tthis.premium_source_map = {};\n\t\tthis.accumulated_total_grid_source_map = {};\n\t\tthis.accumulated_time_source = [];\n\t\tthis.branch_source = [];\n\t\tthis.department_source = [];\n\t\tthis.job_source = [];\n\t\tthis.job_item_source = [];\n\t\tthis.premium_source = [];\n\t\tthis.accumulated_total_grid_source = [];\n\t\tthis.verification_grid_source = [];\n\t\tvar $this = this;\n\t\tvar start_date_string = this.start_date_picker.getValue();\n\t\tvar user_id = this.getSelectEmployee();\n\t\tthis.api_timesheet.getTimeSheetTotalData( user_id, start_date_string, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onReloadSubGridResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonReloadSubGridResult( result ) {\n\t\tvar $this = this;\n\t\tresult = result.getResult();\n\t\t$this.full_timesheet_data.accumulated_user_date_total_data = result.accumulated_user_date_total_data;\n\t\t$this.full_timesheet_data.meal_and_break_total_data = result.meal_and_break_total_data;\n\t\t$this.full_timesheet_data.pay_period_accumulated_user_date_total_data = result.pay_period_accumulated_user_date_total_data;\n\t\t$this.full_timesheet_data.timesheet_verify_data = result.timesheet_verify_data;\n\t\t$this.full_timesheet_data.pay_period_data = result.pay_period_data;\n\t\t$this.timesheet_verify_data = $this.full_timesheet_data.timesheet_verify_data;\n\n\t\t$this.buildSubGridsSource();\n\n\t\t$this.buildAccumulatedTotalGrid();\n\t\t$this.buildVerificationGridSource();\n\n\t\t$this.accumulated_time_grid.setData( $this.accumulated_time_source, false );\n\t\t$this.branch_grid.setData( $this.branch_source, false );\n\t\t$this.department_grid.setData( $this.department_source, false );\n\t\t$this.job_grid.setData( $this.job_source, false );\n\t\t$this.job_item_grid.setData( $this.job_item_source, false );\n\t\t$this.premium_grid.setData( $this.premium_source, false );\n\n\t\tif ( $this.accumulated_total_grid_source.length === 0 ) {\n\t\t\t$this.accumulated_total_grid_source.push();\n\t\t}\n\t\t$this.accumulated_total_grid.setData( $this.accumulated_total_grid_source, false );\n\n\t\t$this.punch_note_grid.setData( $this.punch_note_grid_source, false );\n\t\t$this.verification_grid.setData( $this.verification_grid_source, false );\n\n\t\t$this.setGridSize();\n\t}\n\n\tsetDefaultMenuEditIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.editPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length === 1 && this.editOwnerOrChildPermissionValidate( pId ) && ( this.getPunchMode() === 'punch' || pId === 'absence' ) ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuDeleteIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.deletePermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 && this.deleteOwnerOrChildPermissionValidate( pId ) && ( this.getPunchMode() === 'punch' || pId === 'absence' ) ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuViewIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.viewPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length === 1 && this.viewOwnerOrChildPermissionValidate() && ( this.getPunchMode() === 'punch' || pId === 'absence' ) ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuAddIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.addPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.getPunchMode() === 'manual' && pId !== 'absence' ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuSaveIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( ( !this.addPermissionValidate( pId ) && !this.editPermissionValidate( pId ) ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tif ( ( !this.addPermissionValidate( pId ) && !this.editPermissionValidate( pId ) ) ) {\n\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t}\n\t\t\tif ( this.is_saving_manual_grid ) {\n\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t}\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tbuildAccmulatedOrderMap( total ) {\n\n\t\tif ( !total ) {\n\t\t\treturn;\n\t\t}\n\t\tfor ( var key in total ) {\n\n\t\t\tfor ( var key1 in total[key] ) {\n\t\t\t\tthis.accmulated_order_map[key1] = total[key][key1].order;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildSubGridsSource() {\n\n\t\tvar accumulated_user_date_total_data = this.full_timesheet_data.accumulated_user_date_total_data;\n\t\tvar meal_and_break_total_data = this.full_timesheet_data.meal_and_break_total_data;\n\t\tvar pay_period_accumulated_user_date_total_data = this.full_timesheet_data.pay_period_accumulated_user_date_total_data;\n\n\t\tthis.accmulated_order_map = {};\n\n\t\t// Save the order, will do sort after all data prepared.\n\t\tif ( accumulated_user_date_total_data.total ) {\n\t\t\tthis.buildAccmulatedOrderMap( accumulated_user_date_total_data.total );\n\t\t}\n\n\t\tif ( pay_period_accumulated_user_date_total_data ) {\n\t\t\tthis.buildAccmulatedOrderMap( pay_period_accumulated_user_date_total_data );\n\t\t}\n\n\t\t//Build Accumulated Total Grid Pay_period column data\n\t\tvar accumulated_time = pay_period_accumulated_user_date_total_data.accumulated_time;\n\t\tvar premium_time = pay_period_accumulated_user_date_total_data.premium_time;\n\t\tvar absence_time = pay_period_accumulated_user_date_total_data.absence_time_taken;\n\n\t\tif ( Global.isSet( accumulated_time ) ) {\n\t\t\tthis.buildSubGridsData( accumulated_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t} else {\n\t\t\taccumulated_time = { total: { label: $.i18n._( 'Total Time' ), total_time: '0' } };\n\t\t\tthis.buildSubGridsData( accumulated_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t}\n\n\t\tif ( Global.isSet( premium_time ) ) {\n\t\t\tthis.buildSubGridsData( premium_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'premium_time' );\n\t\t}\n\n\t\tif ( Global.isSet( absence_time ) ) {\n\t\t\tthis.buildSubGridsData( absence_time, 'pay_period', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'absence_time' );\n\t\t}\n\n\t\t//Build Accumulated Total Grid Pay_period column data end\n\n\t\tvar column_len = this.timesheet_columns.length;\n\t\taccumulated_time = { total: { label: $.i18n._( 'Total Time' ), total_time: '0' } };\n\t\tvar date_string;\n\t\tvar date;\n\n\t\tvar start = 1;\n\t\t//#2160 - subgrid column offset must be dynamic to parallel existence of dynamic columns (job, task, branch, department)\n\t\tif ( this.getPunchMode() != 'punch' ) {\n\t\t\tvar start = this.getManualPayPeriodDefaultTrColspan();\n\t\t}\n\n\t\tfor ( var i = start; i < column_len; i++ ) {\n\t\t\tdate_string = this.timesheet_columns[i].name;\n\t\t\tif ( date_string.indexOf( 'empty_cell' ) >= 0 ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.buildSubGridsData( accumulated_time, date_string, this.accumulated_time_source_map, this.accumulated_time_source, 'accumulated_time' );\n\t\t}\n\t\tthis.buildSubGridsData( accumulated_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\n\t\tfor ( var key in accumulated_user_date_total_data ) {\n\n\t\t\t//Build Accumulated Total Grid week column data\n\t\t\tif ( key === 'total' ) {\n\t\t\t\tvar total_result = accumulated_user_date_total_data.total;\n\t\t\t\taccumulated_time = total_result.accumulated_time;\n\t\t\t\tpremium_time = total_result.premium_time;\n\t\t\t\tabsence_time = total_result.absence_time_taken;\n\n\t\t\t\tif ( Global.isSet( accumulated_time ) ) {\n\n\t\t\t\t\tthis.buildSubGridsData( accumulated_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'accumulated_time' );\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( premium_time ) ) {\n\t\t\t\t\tthis.buildSubGridsData( premium_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'premium_time' );\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( absence_time ) ) {\n\t\t\t\t\tthis.buildSubGridsData( absence_time, 'week', this.accumulated_total_grid_source_map, this.accumulated_total_grid_source, 'absence_time' );\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//Build Accumulated Total Grid week column data end\n\t\t\t//Build all sub grids data\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151117&user_id=35367&show_wage=0 line 4478\n\t\t\tdate = Global.strToDate( key );\n\t\t\tif ( !date ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tdate_string = date.format( this.full_format );\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'accumulated_time' of undefined\n\t\t\tif ( typeof accumulated_user_date_total_data[key] != 'undefined' ) {\n\t\t\t\taccumulated_time = accumulated_user_date_total_data[key].accumulated_time;\n\t\t\t\tvar branch_time = accumulated_user_date_total_data[key].branch_time;\n\t\t\t\tvar department_time = accumulated_user_date_total_data[key].department_time;\n\t\t\t\tvar job_time = accumulated_user_date_total_data[key].job_time;\n\t\t\t\tvar job_item_time = accumulated_user_date_total_data[key].job_item_time;\n\t\t\t\tpremium_time = accumulated_user_date_total_data[key].premium_time;\n\t\t\t} else {\n\t\t\t\tDebug.Text( 'ERROR: accumulated_user_date_total_data[key] is null or undefined!', 'TimesheetViewController.js', 'TimesheetViewController', 'buildSubGridsSource', 1 );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accumulated_time ) ) {\n\t\t\t\tthis.buildSubGridsData( accumulated_time, date_string, this.accumulated_time_source_map, this.accumulated_time_source, 'accumulated_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( branch_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( branch_time, date_string, this.branch_source_map, this.branch_source, 'branch_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( department_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( department_time, date_string, this.department_source_map, this.department_source, 'department_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( job_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( job_time, date_string, this.job_source_map, this.job_source, 'job_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( job_item_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( job_item_time, date_string, this.job_item_source_map, this.job_item_source, 'job_item_time' );\n\t\t\t}\n\n\t\t\tif ( Global.isSet( premium_time ) ) {\n\n\t\t\t\tthis.buildSubGridsData( premium_time, date_string, this.premium_source_map, this.premium_source, 'premium_time' );\n\t\t\t}\n\n\t\t}\n\n\t\tthis.sortAccumulatedTotalData();\n\t\tthis.sortAccumulatedTimeData();\n\n\t\tif ( Global.isSet( meal_and_break_total_data ) ) {\n\n\t\t\tfor ( var key in meal_and_break_total_data ) {\n\t\t\t\t// Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151119&user_id=55338&show_wage=0 line 4527\n\t\t\t\tdate = Global.strToDate( key );\n\t\t\t\tif ( !date ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tdate_string = date.format( this.full_format );\n\n\t\t\t\tthis.buildBreakAndLunchData( meal_and_break_total_data[key], date_string );\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildBreakAndLunchData( array, date_string ) {\n\t\tvar row;\n\t\tfor ( var key in array ) {\n\t\t\tif ( !this.accumulated_time_source_map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.punch_info = array[key].break_name;\n\t\t\t\tarray[key].key = key;\n\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time ) + ' (' + array[key].total_breaks + ')';\n\t\t\t\trow[date_string + '_data'] = array[key];\n\t\t\t\tthis.timesheet_data_source.push( row );\n\t\t\t\tthis.accumulated_time_source_map[key] = row;\n\t\t\t} else {\n\t\t\t\trow = this.accumulated_time_source_map[key];\n\t\t\t\tif ( !row[date_string] ) {\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time ) + ' (' + array[key].total_breaks + ')';\n\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\taddCellCount( key ) {\n\t\tswitch ( key ) {\n\t\t\tcase 'branch_time':\n\t\t\t\tthis.branch_cell_count = this.branch_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'department_time':\n\t\t\t\tthis.department_cell_count = this.department_cell_count + 1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'premium_time':\n\t\t\t\tthis.premium_cell_count = this.premium_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'job_time':\n\t\t\t\tthis.job_cell_count = this.job_cell_count + 1;\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_time':\n\t\t\t\tthis.task_cell_count = this.task_cell_count + 1;\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tbuildSubGridsData( array, date_string, map, result_array, parent_key ) {\n\t\tvar row;\n\t\tvar marked_regular_row = false; //Only mark the first regular time row, as thats where the bold top-line is going to go.\n\t\tfor ( var key in array ) {\n\t\t\tif ( !map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.parent_key = parent_key;\n\t\t\t\trow.key = key;\n\n\t\t\t\tif ( parent_key === 'accumulated_time' ) {\n\n\t\t\t\t\tif ( key === 'total' || key === 'worked_time' ) {\n\t\t\t\t\t\trow.type = TimeSheetViewController.TOTAL_ROW;\n\t\t\t\t\t} else if ( marked_regular_row == false && key.indexOf( 'regular_time' ) === 0 ) {\n\t\t\t\t\t\trow.type = TimeSheetViewController.REGULAR_ROW;\n\t\t\t\t\t\tmarked_regular_row = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.type = TimeSheetViewController.ACCUMULATED_TIME_ROW;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( parent_key === 'premium_time' ) {\n\t\t\t\t\trow.type = TimeSheetViewController.PREMIUM_ROW;\n\t\t\t\t}\n\n\t\t\t\tif ( this.accmulated_order_map[key] ) {\n\t\t\t\t\trow.order = this.accmulated_order_map[key];\n\t\t\t\t}\n\n\t\t\t\trow.punch_info = array[key].label;\n\n\t\t\t\tvar key_array = key.split( '_' );\n\t\t\t\tvar no_id = false;\n\t\t\t\tif ( key_array.length > 1 && key_array[1] == '0' ) {\n\t\t\t\t\tno_id = true;\n\t\t\t\t}\n\n\t\t\t\tarray[key].key = key;\n\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t//if id == 0, put the row as first row.\n\t\t\t\tif ( no_id ) {\n\t\t\t\t\tresult_array.unshift( row );\n\t\t\t\t} else {\n\t\t\t\t\tresult_array.push( row );\n\t\t\t\t}\n\n\t\t\t\tmap[key] = row;\n\t\t\t} else {\n\t\t\t\trow = map[key];\n\t\t\t\tif ( row[date_string] && key === 'total' ) { //Override total cell data since we set all to 00:00 at beginning\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t\tif ( row.parent_key === 'accumulated_time' ) {\n\t\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray[key].key = key;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( array[key].total_time );\n\t\t\t\t\trow[date_string + '_data'] = array[key];\n\n\t\t\t\t\tif ( row.parent_key === 'accumulated_time' ) {\n\t\t\t\t\t\tif ( array[key].override ) {\n\t\t\t\t\t\t\trow.is_override_row = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.addCellCount( parent_key );\n\t\t}\n\t}\n\n\ttimeSheetVerifyPermissionValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'verify_time_sheet' ) &&\n\t\t\tthis.timesheet_verify_data.hasOwnProperty( 'pay_period_verify_type_id' ) &&\n\t\t\tthis.timesheet_verify_data.pay_period_verify_type_id != 10 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildVerificationGridSource() {\n\t\tthis.verification_grid_source = [];\n\t\tvar $this = this;\n\t\tvar verify_action_bar = $( this.el ).find( '.verification-action-bar' );\n\t\tvar verify_grid_div = $( this.el ).find( '.verification-grid-div' );\n\t\tvar verify_btn = $( this.el ).find( '.verify-button' );\n\t\tvar verify_title = $( this.el ).find( '.verification-grid-title' );\n\t\tvar verify_des = $( this.el ).find( '.verify-description' );\n\n\t\tif ( this.timeSheetVerifyPermissionValidate() &&\n\t\t\tGlobal.isSet( this.timesheet_verify_data.pay_period_id ) &&\n\t\t\tGlobal.isSet( this.timesheet_verify_data.pay_period_verify_type_id ) &&\n\t\t\tthis.timesheet_verify_data.pay_period_verify_type_id !== '10' ) {\n\n\t\t\tif ( !this.timesheet_verify_data.display_verify_button ) {\n\t\t\t\tverify_btn.css( 'display', 'none' );\n\t\t\t\tverify_title.css( 'display', 'none' );\n\t\t\t} else {\n\t\t\t\tverify_btn.css( 'display', 'inline-block' );\n\t\t\t\tverify_title.css( 'display', 'block' );\n\t\t\t}\n\n\t\t\tverify_grid_div.css( 'display', 'block' );\n\t\t\tverify_des.text( this.timesheet_verify_data.verification_status_display );\n\n\t\t\tif ( this.timesheet_verify_data.verification_box_color ) {\n\t\t\t\tverify_action_bar.css( 'background', this.timesheet_verify_data.verification_box_color );\n\t\t\t} else {\n\t\t\t\tverify_action_bar.css( 'background', '#ffffff' );\n\t\t\t}\n\n\t\t\tverify_btn.unbind( 'click' ).bind( 'click', function() {\n\t\t\t\tTAlertManager.showConfirmAlert( $this.timesheet_verify_data.verification_confirmation_message, '', function( flag ) {\n\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\t$this.api_timesheet.verifyTimeSheet( $this.getSelectEmployee(), $this.timesheet_verify_data.pay_period_id,\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tverify_btn.css( 'display', 'none' );\n\t\t\tverify_grid_div.css( 'display', 'none' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar verification_data = this.timesheet_verify_data.verification_window_dates.start + ' ' + $.i18n._( 'to' ) + ' ' + this.timesheet_verify_data.verification_window_dates.end;\n\n\t\tvar pay_period_data = this.pay_period_header;\n\n\t\tthis.verification_grid_source.push( { pay_period: pay_period_data, verification: verification_data } );\n\n\t\t//This can be called by clicking on a different date column header, or using the top right refresh icon, so not all grids are resized at that time necessarily.\n\t\t$this.setGridHeight( 'verification_grid' );\n\t}\n\n\tbuildPunchNoteGridSource() {\n\t\tthis.punch_note_grid_source = [];\n\t\tvar punch_array = this.full_timesheet_data.punch_data;\n\t\tvar absence_array = this.full_timesheet_data.user_date_total_data;\n\t\tvar len = punch_array.length;\n\t\tvar len1 = absence_array.length;\n\t\tvar last_control_id = '';\n\t\tvar date;\n\t\tvar date_string;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar punch = punch_array[i];\n\t\t\tdate = Global.strToDate( punch.date_stamp );\n\t\t\tdate_string = date.format();\n\t\t\tif ( punch.note && punch.punch_control_id !== last_control_id ) {\n\t\t\t\tthis.punch_note_account = this.punch_note_account + 1;\n\t\t\t\tthis.punch_note_grid_source.push( { note: date_string + ' @ ' + punch.punch_time + ': ' + punch.note.replace( /\\n/g, ' ' ) } );\n\t\t\t\tlast_control_id = punch.punch_control_id;\n\t\t\t}\n\t\t}\n\t\tfor ( var x = 0; x < len1; x++ ) {\n\t\t\tvar absence = absence_array[x];\n\t\t\tdate = Global.strToDate( absence.date_stamp );\n\t\t\tdate_string = date.format();\n\t\t\tif ( absence.note ) {\n\t\t\t\tthis.punch_note_account = this.punch_note_account + 1;\n\t\t\t\tthis.punch_note_grid_source.push( { note: date_string + ' @ ' + Global.getTimeUnit( absence.total_time ) + ': ' + absence.note.replace( /\\n/g, ' ' ) } );\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildAbsenceSource() {\n\n\t\tvar map = {};\n\t\tthis.absence_source = [];\n\t\tthis.absence_original_source = [];\n\t\tvar absence_array = this.full_timesheet_data.user_date_total_data;\n\t\tvar len = absence_array.length;\n\t\tvar row;\n\t\tvar row_id_counter = 1;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar absence = absence_array[i];\n\n\t\t\tif ( absence.object_type_id != 50 ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.absence_original_source.push( absence );\n\t\t\tvar date = Global.strToDate( absence.date_stamp );\n\t\t\tvar date_string = date.format( this.full_format );\n\t\t\tvar key = absence.src_object_id + '-' + absence.pay_code_id;\n\n\t\t\tif ( !map[key] ) {\n\t\t\t\trow = {};\n\t\t\t\trow.id = row_id_counter;\n\t\t\t\trow.type = TimeSheetViewController.ABSENCE_ROW;\n\t\t\t\trow.punch_info = absence.name; //Was: absence.absence_policy\n\t\t\t\trow.punch_info_id = absence.src_object_id;\n\t\t\t\trow.user_id = absence.user_id;\n\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\tthis.absence_source.push( row );\n\t\t\t\tmap[key] = row;\n\t\t\t} else {\n\t\t\t\trow = map[key];\n\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.id = row_id_counter;\n\t\t\t\t\trow.type = TimeSheetViewController.ABSENCE_ROW;\n\t\t\t\t\trow.punch_info = absence.name; //Was: absence.absence_policy\n\t\t\t\t\trow.punch_info_id = absence.src_object_id;\n\t\t\t\t\trow.user_id = absence.user_id;\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\n\t\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\t\tthis.absence_source.push( row );\n\t\t\t\t\tmap[key] = row;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis.lastDayIsOverride( date, row, absence );\n\t\t\t\t\trow[date_string] = Global.getTimeUnit( absence.total_time );\n\t\t\t\t\trow[date_string + '_data'] = absence;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trow_id_counter++;\n\n\t\t\tthis.absence_cell_count = this.absence_cell_count + 1;\n\n\t\t}\n\n\t\tif ( this.absence_source.length === 0 ) {\n\t\t\trow = {};\n\t\t\trow.id = 1;\n\t\t\trow.punch_info = '';\n\t\t\trow.user_id = this.getSelectEmployee();\n\t\t\tthis.absence_source.push( row );\n\t\t}\n\t}\n\n\tlastDayIsOverride( current_date, row, current_data ) {\n\n\t\tvar last_date = new Date( new Date( current_date.getTime() ).setDate( current_date.getDate() - 1 ) );\n\n\t\tvar date_str = last_date.format( this.full_format );\n\n\t\tvar data = row[date_str + '_data'];\n\n\t\tif ( data && data.override && current_data.src_object_id === data.src_object_id ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildTimeSheetSource() {\n\t\tthis.select_punches_array = [];\n\t\tthis.timesheet_data_source = [];\n\n\t\tvar punch_array = this.full_timesheet_data.punch_data;\n\t\tvar len = punch_array.length;\n\t\tvar row;\n\t\tvar new_row;\n\t\tvar row_id_counter = 1;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar punch = punch_array[i];\n\t\t\t// Error: TypeError: Global.strToDate(...) is null in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-081724 line 2 > eval line 4869\n\t\t\t// Punch must have a date\n\t\t\tif ( !punch.date_stamp ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar date = Global.strToDate( punch.date_stamp );\n\t\t\tvar date_string = date.format( this.full_format );\n\n\t\t\tvar punch_status_id = punch.status_id;\n\n\t\t\t//row 1.\n\t\t\tif ( i === 0 ) {\n\t\t\t\trow = {};\n\t\t\t\trow.id = row_id_counter;\n\t\t\t\trow_id_counter++;\n\t\t\t\trow.punch_info = punch.status;\n\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\trow.user_id = punch.user_id;\n\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\tthis.timesheet_data_source.push( row );\n\n\t\t\t\tif ( punch_status_id == 10 ) {\n\n\t\t\t\t\tvar our_row = {};\n\t\t\t\t\tour_row.punch_info = $.i18n._( 'Out' );\n\t\t\t\t\tour_row.user_id = punch.user_id;\n\t\t\t\t\tour_row[date_string] = '';\n\t\t\t\t\tour_row[date_string + '_data'] = null;\n\t\t\t\t\tour_row[date_string + '_related_data'] = punch;\n\t\t\t\t\tour_row.status_id = 20;\n\t\t\t\t\tour_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\tour_row.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.push( our_row );\n\n\t\t\t\t} else {\n\t\t\t\t\tnew_row = {};\n\t\t\t\t\tnew_row.punch_info = $.i18n._( 'In' );\n\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\tnew_row.status_id = 10;\n\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.splice( this.timesheet_data_source.length - 1, 0, new_row );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tvar timesheet_data_source_len = this.timesheet_data_source.length;\n\t\t\t\tfor ( var j = 0; j < timesheet_data_source_len; j++ ) {\n\t\t\t\t\trow = this.timesheet_data_source[j];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else if ( !row[date_string] && row[date_string + '_related_data'] ) {\n\t\t\t\t\t\tvar related_punch = row[date_string + '_related_data'];\n\n\t\t\t\t\t\tif ( related_punch.punch_control_id === punch.punch_control_id ) {\n\t\t\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( !row[date_string] && !row[date_string + '_related_data'] && punch.status_id == row.status_id ) {\n\t\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\t\t\tfind_position = true;\n\n\t\t\t\t\t\tif ( punch.status_id == 10 ) {\n\t\t\t\t\t\t\tnew_row = this.timesheet_data_source[j + 1];\n\t\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tnew_row = this.timesheet_data_source[j - 1];\n\t\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//Need add a new row\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.punch_info = punch.status;\n\t\t\t\t\trow.user_id = punch.user_id;\n\t\t\t\t\trow[date_string] = punch.punch_time;\n\t\t\t\t\trow[date_string + '_data'] = punch;\n\t\t\t\t\trow[date_string + '_related_data'] = null;\n\t\t\t\t\trow.status_id = punch_status_id;\n\t\t\t\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\trow.id = row_id_counter;\n\t\t\t\t\trow_id_counter++;\n\t\t\t\t\tthis.timesheet_data_source.push( row );\n\n\t\t\t\t\tif ( punch_status_id == 10 ) {\n\n\t\t\t\t\t\tnew_row = {};\n\t\t\t\t\t\tnew_row.punch_info = $.i18n._( 'Out' );\n\t\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\tnew_row.status_id = 20;\n\t\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\t\trow_id_counter++;\n\t\t\t\t\t\tthis.timesheet_data_source.push( new_row );\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnew_row = {};\n\t\t\t\t\t\tnew_row.punch_info = $.i18n._( 'In' );\n\t\t\t\t\t\tnew_row.user_id = punch.user_id;\n\t\t\t\t\t\tnew_row[date_string] = '';\n\t\t\t\t\t\tnew_row[date_string + '_data'] = null;\n\t\t\t\t\t\tnew_row[date_string + '_related_data'] = punch;\n\t\t\t\t\t\tnew_row.status_id = 10;\n\t\t\t\t\t\tnew_row.type = TimeSheetViewController.PUNCH_ROW;\n\t\t\t\t\t\tnew_row.id = row_id_counter;\n\t\t\t\t\t\trow_id_counter++;\n\t\t\t\t\t\tthis.timesheet_data_source.splice( this.timesheet_data_source.length - 1, 0, new_row );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\trow = {};\n\t\trow.punch_info = $.i18n._( 'In' );\n\t\trow.user_id = this.getSelectEmployee();\n\t\trow.status_id = 10;\n\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\trow.id = row_id_counter;\n\t\trow_id_counter++;\n\t\tthis.timesheet_data_source.push( row );\n\n\t\trow = {};\n\t\trow.punch_info = $.i18n._( 'Out' );\n\t\trow.user_id = this.getSelectEmployee();\n\t\trow.status_id = 20;\n\t\trow.type = TimeSheetViewController.PUNCH_ROW;\n\t\trow.id = row_id_counter;\n\t\trow_id_counter++;\n\t\tthis.timesheet_data_source.push( row );\n\t}\n\n\tbuildTimeSheetsColumns() {\n\t\tthis.timesheet_columns = [];\n\t\tif ( this.getPunchMode() === 'manual' ) {\n\t\t\tfor ( var i = 0; i < 5; i++ ) {\n\t\t\t\tvar column_width = i > 1 ? 123 : 25;\n\t\t\t\tif ( i === 4 ) {\n\t\t\t\t\tcolumn_width = 160;\n\t\t\t\t}\n\t\t\t\tif ( i === 0 && !this.show_branch_ui ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif ( i === 1 && !this.show_department_ui ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif ( i === 2 && ( !this.show_job_ui || Global.getProductEdition() <= 15 ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif ( i === 3 && ( !this.show_job_item_ui || Global.getProductEdition() <= 15 ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar column = {\n\t\t\t\t\tname: 'empty_cell_' + i,\n\t\t\t\t\tindex: 'empty_cell_' + i,\n\t\t\t\t\tlabel: ' ',\n\t\t\t\t\twidth: column_width,\n\t\t\t\t\tsortable: false,\n\t\t\t\t\ttitle: false,\n\t\t\t\t\tfixed: true\n\t\t\t\t};\n\t\t\t\tthis.timesheet_columns.push( column );\n\t\t\t}\n\t\t}\n\n\t\tvar punch_in_out_column = {\n\t\t\tname: 'punch_info',\n\t\t\tindex: 'punch_info',\n\t\t\tlabel: ' ',\n\t\t\t//if not set to 0 in punch timesheet mode, the date column headers are a few px out of alignment and look bad.\n\t\t\t//see #2091 notes for link to the percent-based js fiddle\n\t\t\twidth: this.getPunchMode() === 'manual' ? 160 : 100,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: this.onCellFormat,\n\t\t\tfixed: this.getPunchMode() === 'manual' ? true : false\n\t\t};\n\t\tthis.timesheet_columns.push( punch_in_out_column );\n\n\t\t//save full week columns map use to build no pey period column\n\t\tthis.column_maps = [];\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar current_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\n\t\t\t//Localize the day of week and month text.\n\t\t\tif ( LocalCacheData.getLoginData().language != 'en' && Global.isString( header_text ) ) {\n\t\t\t\tvar split_header_text_array = header_text.split( ',' );\n\t\t\t\tvar split_header_text_month = split_header_text_array[1].split( ' ' );\n\t\t\t\theader_text = $.i18n._( split_header_text_array[0] ) + ', ' + $.i18n._( split_header_text_month[1] ) + ' ' + split_header_text_month[2];\n\t\t\t}\n\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\tthis.column_maps.push( current_date.format() );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field,\n\t\t\t\tindex: data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 100,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: this.onCellFormat\n\t\t\t};\n\t\t\tthis.timesheet_columns.push( column_info );\n\t\t}\n\n\t\treturn this.timesheet_columns;\n\t}\n\n\tgetDefaultDisplayColumns( callback ) {\n\t\t// Overriden to allow use of initLayout in BaseViewController, but no default display columns in this view, hence this function is 'disabled'\n\t\tcallback();\n\t}\n\n\tsetSelectLayout() {\n\t\tvar $this = this;\n\n\t\tif ( !Global.isSet( this.grid ) ) {\n\t\t\tvar grid = $( this.el ).find( '#grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid = $( this.el ).find( '#' + this.ui_id + '_grid' );\n\t\t}\n\n\t\tif ( !this.select_layout ) { //Set to defalt layout if no layout at all\n\t\t\tthis.select_layout = { id: '' };\n\t\t\tthis.select_layout.data = { filter_data: {}, filter_sort: {} };\n\t\t}\n\n\t\t//search panel doesn't always exist.\n\t\tif ( this.search_panel ) {\n\t\t\t//Set Previous Saved layout combobox in layout panel\n\t\t\tvar layouts_array = this.search_panel.getLayoutsArray();\n\t\t\tif ( this.previous_saved_layout_selector ) {\n\t\t\t\tthis.previous_saved_layout_selector.empty();\n\t\t\t}\n\n\t\t\tif ( layouts_array && layouts_array.length > 0 ) {\n\t\t\t\tthis.previous_saved_layout_div.css( 'display', 'inline' );\n\n\t\t\t\tvar len = layouts_array.length;\n\t\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\t\tvar item = layouts_array[i];\n\t\t\t\t\tthis.previous_saved_layout_selector.append( $( '<option value=\"' + item.id + '\"></option>' ).text( item.name ) );\n\t\t\t\t}\n\n\t\t\t\t$( this.previous_saved_layout_selector.find( 'option' ) ).filter( function() {\n\t\t\t\t\treturn $( this ).attr( 'value' ) === $this.select_layout.id;\n\t\t\t\t} ).prop( 'selected', true ).attr( 'selected', true );\n\n\t\t\t} else {\n\t\t\t\tif ( this.previous_saved_layout_div ) {\n\t\t\t\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//replace select layout filter_data to filter set in onNavigation function when goto view from navigation context group\n\t\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\t\tthis.select_layout.data.filter_data = LocalCacheData.default_filter_for_next_open_view.filter_data;\n\t\t\t\tLocalCacheData.default_filter_for_next_open_view = null;\n\t\t\t}\n\n\t\t\tthis.filter_data = this.select_layout.data.filter_data;\n\n\t\t\tthis.setSearchPanelFilter( true ); //Auto change to property tab when set value to search fields.\n\t\t}\n\n\t\t// this.search( true ); // get punches base on userid, data and filter - commented out as this is already called in BaseViewController.initLayout()\n\t}\n\n\t//Start Drag\n\tsetTimesheetGridDragAble() {\n\t\tvar $this = this;\n\n\t\tvar position = 0;\n\t\tvar cells = this.grid.grid.find( '.date-column' ).parents( 'td' );\n\t\tcells.attr( 'draggable', true );\n\n\t\tcells.off( 'dragstart' ).on( 'dragstart', function( event ) {\n\n\t\t\tvar td = event.target;\n\t\t\tif ( $this.select_punches_array.length < 1 || !$( td ).hasClass( 'ui-state-highlight' ) || !$this.select_drag_menu_id ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar container = $( '<div class=\\'drag-holder-div\\'></div>' );\n\n\t\t\tvar len = $this.select_punches_array.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar punch = $this.select_punches_array[i];\n\n\t\t\t\tvar span = $( '<span class=\\'drag-span\\'></span>' );\n\t\t\t\tspan.text( punch.status + ': ' + punch.time_stamp );\n\t\t\t\tcontainer.append( span );\n\t\t\t}\n\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t\t$( 'body' ).append( container );\n\n\t\t\tevent.originalEvent.dataTransfer.setData( 'Text', 'timesheet' );//JUST ELEMENT references is ok here NO ID\n\n\t\t\tif ( event.originalEvent.dataTransfer.setDragImage ) {\n\t\t\t\tevent.originalEvent.dataTransfer.setDragImage( container[0], 0, 0 );\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t} );\n\n\t\tcells.off( 'dragover' ).on( 'dragover', function( e ) {\n\n\t\t\tvar event = e.originalEvent;\n\n\t\t\tevent.preventDefault();\n\t\t\tvar $this = this;\n\t\t\tvar target = $( this );\n\n\t\t\t$( '.timesheet-drag-over' ).removeClass( 'timesheet-drag-over' );\n\t\t\t$( '.drag-over-top' ).removeClass( 'drag-over-top' );\n\t\t\t$( '.drag-over-center' ).removeClass( 'drag-over-center' );\n\t\t\t$( '.drag-over-bottom' ).removeClass( ' drag-over-bottom' );\n\n\t\t\t$( $this ).addClass( 'timesheet-drag-over' );\n\n\t\t\t//judge which area mouse on in the target cell and set proper style, Keep checking this in drag event.\n\t\t\tif ( event.pageY - target.offset().top <= 8 ) {\n\t\t\t\tposition = -1;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-top' );\n\t\t\t} else if ( event.pageY - target.offset().top >= target.height() - 5 ) {\n\t\t\t\tposition = 1;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-bottom' );\n\t\t\t} else {\n\t\t\t\tposition = 0;\n\t\t\t\ttarget.removeClass( 'drag-over-top drag-over-center drag-over-bottom' ).addClass( 'drag-over-center' );\n\t\t\t}\n\n\t\t} );\n\n\t\tcells.off( 'dragend' ).on( 'dragend', function( event ) {\n\n\t\t\t$( '.timesheet-drag-over' ).removeClass( 'timesheet-drag-over' );\n\t\t\t$( '.drag-over-top' ).removeClass( 'drag-over-top' );\n\t\t\t$( '.drag-over-center' ).removeClass( 'drag-over-center' );\n\t\t\t$( '.drag-over-bottom' ).removeClass( ' drag-over-bottom' );\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t} );\n\n\t\tcells.off( 'drop' ).on( 'drop', function( event ) {\n\n\t\t\tevent.preventDefault();\n\t\t\tif ( event.stopPropagation ) {\n\t\t\t\tevent.stopPropagation(); // stops the browser from redirecting.\n\t\t\t}\n\n\t\t\t$( this ).removeClass( 'drag-over-top drag-over-center drag-over-bottom timesheet-drag-over' );\n\t\t\tvar target_cell = event.currentTarget;\n\t\t\tvar i = 0; //start index;\n\n\t\t\tif ( $( target_cell ).index() === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'punch_date' of undefined in /interface/html5/#!m=TimeSheet&date=20141118&user_id=32916 line 4563\n\t\t\tif ( !$this.select_punches_array || !$this.select_punches_array[i] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar punch = $this.select_punches_array[i];\n\n\t\t\tvar punch_date = Global.strToDate( punch.punch_date );\n\n\t\t\tvar row = $this.timesheet_data_source[target_cell.parentNode.rowIndex - 1];\n\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'status_id' of undefined in /interface/html5/#!m=TimeSheet&date=20150108&user_id=1068 line 5174\n\t\t\tif ( !row ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t\tvar data_field = colModel[target_cell.cellIndex].name;\n\n\t\t\tvar target_punch = row[data_field + '_data'];\n\n\t\t\tvar target_related_punch = row[data_field + '_related_data'];\n\n\t\t\tvar target_column_date = Global.strToDate( data_field, $this.full_format );\n\n\t\t\tvar first_select_date = punch_date;\n\n\t\t\tvar time_offset = target_column_date.getTime() - punch_date.getTime();\n\n\t\t\tvar target_column_date_str = target_column_date.format();\n\n\t\t\tsavePunch();\n\n\t\t\tfunction savePunch() {\n\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in /interface/html5/#!m=TimeSheet&date=20141229&user_id=39555 line 5207\n\t\t\t\tif ( !$this.select_punches_array ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar new_punch_id = punch.id;\n\t\t\t\tvar target_id = false;\n\t\t\t\tvar target_status_id = row.status_id;\n\t\t\t\tvar action_type = $this.select_drag_menu_id === ContextMenuIconName.move ? 1 : 0;\n\n\t\t\t\t//Issue #2008 - All in-punches need target_id to be false to ensure that each pair retains its punch_control settings.\n\t\t\t\t//Most out-punches need their target id to be the related in-punch.\n\t\t\t\t//If these conditions are not met, copying groups of punches with different punch_control data will result in all copied punches having the same punch_control data as the first punch pair.\n\t\t\t\tif ( target_punch && punch.status_id == 20 ) {\n\t\t\t\t\ttarget_id = target_punch.id;\n\t\t\t\t\ttarget_status_id = false;\n\t\t\t\t} else if ( target_related_punch ) {\n\t\t\t\t\ttarget_id = target_related_punch.id;\n\t\t\t\t\tif ( target_related_punch.status_id == 10 ) {\n\t\t\t\t\t\tposition = 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tposition = -1;\n\t\t\t\t\t}\n\t\t\t\t\ttarget_status_id = false;\n\t\t\t\t}\n\n\t\t\t\tvar api_punch_control = TTAPI.APIPunchControl;\n\n\t\t\t\tapi_punch_control.dragNdropPunch( new_punch_id, target_id, target_status_id, position, action_type, target_column_date_str, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in interface/html5/#!m=TimeSheet&date=20150831&user_id=129895&show_wage=0 line 5286\n\t\t\t\t\t\tif ( result.isValid() && $this.select_punches_array && $this.select_punches_array.length > 0 ) {\n\t\t\t\t\t\t\ti = i + 1;\n\t\t\t\t\t\t\tif ( i > $this.select_cells_Array.length - 1 ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'date_stamp' of undefined in interface/html5/#!m=TimeSheet&date=20150831&user_id=129895&show_wage=0 line 5286\n\t\t\t\t\t\t\tif ( !$this.select_punches_array[i] ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twhile ( !$this.select_punches_array[i].date_stamp ) {\n\t\t\t\t\t\t\t\ti = i + 1;\n\t\t\t\t\t\t\t\tif ( i > $this.select_cells_Array.length - 1 ) {\n\t\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tposition = 1; //put next punch below last one\n\t\t\t\t\t\t\tvar last_date_string = target_column_date_str;\n\t\t\t\t\t\t\tpunch = $this.select_punches_array[i];\n\t\t\t\t\t\t\tpunch_date = Global.strToDate( punch.punch_date );\n\t\t\t\t\t\t\trow = $this.timesheet_data_source[target_cell.parentNode.rowIndex - 1];\n\t\t\t\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\t\t\t\tdata_field = colModel[target_cell.cellIndex].name;\n\t\t\t\t\t\t\ttime_offset = punch_date.getTime() - first_select_date.getTime();\n\t\t\t\t\t\t\t//drop column date\n\t\t\t\t\t\t\ttarget_column_date = Global.strToDate( data_field, $this.full_format );\n\t\t\t\t\t\t\t//Real target column date str\n\t\t\t\t\t\t\ttarget_column_date_str = new Date( target_column_date.getTime() + time_offset ).format();\n\t\t\t\t\t\t\ttarget_punch = { id: result_data };\n\t\t\t\t\t\t\ttarget_related_punch = null;\n\t\t\t\t\t\t\tif ( target_column_date_str !== last_date_string ) {\n\t\t\t\t\t\t\t\tposition = 0;\n\t\t\t\t\t\t\t\ttarget_punch = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsavePunch();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Unable to drag and drop punch to the specified location' ) );\n\t\t\t\t\t\t\tif ( i > 0 ) {\n\t\t\t\t\t\t\t\t$this.search( true );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetPunchModeClass() {\n\t\tthis.$el.removeClass( 'timesheet-punch-mode' );\n\t\tthis.$el.removeClass( 'timesheet-manual-mode' );\n\t\tthis.getPunchMode() === 'punch' ? this.$el.addClass( 'timesheet-punch-mode' ) : this.$el.addClass( 'timesheet-manual-mode' );\n\t}\n\n\tinitData() {\n\t\tvar $this = this;\n\t\tGlobal.removeViewTab( this.viewId );\n\t\tvar loginUser = LocalCacheData.getLoginUser();\n\t\tthis.initOptions();\n\t\tProgressBar.showOverlay();\n\t\t// Set Wage\n\t\tif ( !LocalCacheData.last_timesheet_selected_show_wage ) {\n\t\t\tthis.wage_btn.setValue( false );\n\t\t} else {\n\t\t\tthis.wage_btn.setValue( LocalCacheData.last_timesheet_selected_show_wage );\n\t\t}\n\n\t\t//Error: TypeError: Cannot read property 'show_wage' of null\n\t\t//just need to check that the variable exists before checking properties for the case of the LocalCacheData being empty\n\t\tif ( Global.isSet( LocalCacheData.getAllURLArgs() ) && LocalCacheData.getAllURLArgs().show_wage ) {\n\t\t\tthis.wage_btn.setValue( LocalCacheData.getAllURLArgs().show_wage === '1' ? true : false );\n\t\t}\n\n\t\t// Set Use Employee TimeSheet\n\t\tif ( !LocalCacheData.last_timesheet_selected_timezone ) {\n\t\t\tthis.timezone_btn.setValue( false );\n\t\t} else {\n\t\t\tthis.timezone_btn.setValue( LocalCacheData.last_timesheet_selected_timezone );\n\t\t}\n\n\t\t//Error: TypeError: Cannot read property 'show_wage' of null\n\t\t//just need to check that the variable exists before checking properties for the case of the LocalCacheData being empty\n\t\tif ( Global.isSet( LocalCacheData.getAllURLArgs() ) && LocalCacheData.getAllURLArgs().timezone ) {\n\t\t\tthis.timezone_btn.setValue( LocalCacheData.getAllURLArgs().timezone === '1' ? true : false );\n\t\t}\n\n\t\t// Set punch mode\n\t\tif ( !this.show_punch_mode_ui ) {\n\t\t\tif ( !PermissionManager.validate( this.permission_id, 'punch_timesheet' ) && !PermissionManager.validate( this.permission_id, 'manual_timesheet' ) ) {\n\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\t\t\t} else {\n\t\t\t\tif ( PermissionManager.validate( this.permission_id, 'punch_timesheet' ) ) {\n\t\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\t\t\t\t}\n\t\t\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( this.permission_id, 'manual_timesheet' ) ) {\n\t\t\t\t\tthis.toggle_button.setValue( 'manual' );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif ( !LocalCacheData.last_timesheet_selected_punch_mode ) {\n\t\t\t\tthis.toggle_button.setValue( 'punch' );\n\n\t\t\t} else {\n\t\t\t\tthis.toggle_button.setValue( LocalCacheData.last_timesheet_selected_punch_mode );\n\t\t\t}\n\t\t\tif ( LocalCacheData.getAllURLArgs().mode ) {\n\t\t\t\t// Fix wrong value from url\n\t\t\t\tthis.toggle_button.setValue( LocalCacheData.getAllURLArgs().mode === 'manual' ? 'manual' : 'punch' );\n\t\t\t}\n\t\t}\n\n\t\tif ( Global.UNIT_TEST_MODE == true ) {\n\t\t\tLocalCacheData.last_timesheet_selected_date = '15-Feb-18';\n\t\t}\n\t\t//replace select layout filter_data to filter set in onNavigation function when goto view from navigation context group\n\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\tthis.employee_nav.setValue( LocalCacheData.default_filter_for_next_open_view.user_id );\n\t\t\tthis.setDatePickerValue( LocalCacheData.default_filter_for_next_open_view.base_date );\n\t\t} else {\n\t\t\tif ( LocalCacheData.getAllURLArgs().user_id ) {\n\t\t\t\tthis.employee_nav.setValue( LocalCacheData.getAllURLArgs().user_id );\n\t\t\t} else if ( LocalCacheData.last_timesheet_selected_user ) {\n\t\t\t\tthis.employee_nav.setValue( LocalCacheData.last_timesheet_selected_user );\n\t\t\t} else {\n\t\t\t\t//Default set current login user as select Employee\n\t\t\t\tthis.employee_nav.setValue( loginUser );\n\t\t\t}\n\n\t\t\tif ( !LocalCacheData.last_timesheet_selected_date ) { //Saved current select date in cache. so still select last select date when go to other view and back\n\t\t\t\tif ( LocalCacheData.current_select_date && Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ) ) { //Select date get from URL.\n\t\t\t\t\tthis.setDatePickerValue( Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ).format() );\n\t\t\t\t\tLocalCacheData.current_select_date = '';\n\t\t\t\t} else {\n\t\t\t\t\tvar date = new Date();\n\t\t\t\t\tvar format = Global.getLoginUserDateFormat();\n\t\t\t\t\tvar dateStr = date.format( format );\n\t\t\t\t\tthis.setDatePickerValue( dateStr );\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tthis.setDatePickerValue( LocalCacheData.last_timesheet_selected_date );\n\t\t\t}\n\t\t}\n\n\t\t$this.initLayout();\n\t\tthis.setMoveOrDropMode( ContextMenuIconName.move );\n\t}\n\n\tsetDatePickerValue( val ) {\n\t\tthis.start_date_picker.setValue( val );\n\n\t\tvar default_date = this.start_date_picker.getDefaultFormatValue();\n\n\t\tvar user_id = this.getSelectEmployee();\n\n\t\tif ( user_id &&\n\t\t\t!this.edit_view &&\n\t\t\t//Removing date from the generated URLs to avoid bookmarking to stale dates by users.\n\t\t\t//(window.location.href.indexOf( 'date=' + default_date ) === -1 || window.location.href.indexOf( 'user_id=' + this.getSelectEmployee() === -1 )) ) {\n\t\t\t( window.location.href.indexOf( 'user_id=' + user_id ) === -1 ) ) {\n\n\t\t\t//var location = Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + default_date + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\t\tvar location = Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + user_id + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\n\t\t\tif ( LocalCacheData.getAllURLArgs() ) {\n\t\t\t\tfor ( var key in LocalCacheData.getAllURLArgs() ) {\n\t\t\t\t\t//if ( key === 'm' || key === 'date' || key === 'user_id' || key === 'show_wage' || key === 'mode' ) {\n\t\t\t\t\tif ( key === 'm' || key === 'user_id' || key === 'show_wage' || key === 'timezone' || key === 'mode' ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlocation = location + '&' + key + '=' + LocalCacheData.getAllURLArgs()[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tGlobal.setURLToBrowser( location );\n\n\t\t}\n\n\t\tLocalCacheData.last_timesheet_selected_date = val;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Branch' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Punch Department' ),\n\t\t\t\tfield: 'department_id',\n\t\t\t\tin_column: 1,\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_id',\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tgetSelectEmployee( full_item ) {\n\t\tvar user = false;\n\t\tif ( this.show_navigation_box && this.employee_nav && typeof this.employee_nav.getValue == 'function' ) {\n\t\t\tuser = this.employee_nav.getValue( true ); //Always try to get the object (not the id), however in some cases like recalculating timesheets it still seems to return the ID instead of the object.\n\t\t}\n\n\t\t//Convert object if it isn't already, to make logic lower down easier.\n\t\tif ( Global.isObject( user ) == false ) {\n\t\t\tuser = { id: user };\n\t\t}\n\n\t\tif ( Global.isObject( user ) == false || ( Global.isObject( user ) == true && ( user.hasOwnProperty( 'id' ) == false || TTUUID.isUUID( user.id ) == false ) ) ) {\n\t\t\tuser = LocalCacheData.getLoginUser();\n\n\t\t\tif ( Global.isObject( user ) == false || ( Global.isObject( user ) == true && ( user.hasOwnProperty( 'id' ) == false || TTUUID.isUUID( user.id ) == false ) ) ) {\n\t\t\t\t//currently logged in user object is corrupt.\n\t\t\t\tvar r = new RibbonViewController();\n\t\t\t\tr.doLogout(); //Keep in mind that many other functions can still run after doLogout() is called, which can then trigger JS exceptions. So the entire stack needs to handle this returning false/null and stop executing further.\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif ( full_item != true && ( Global.isObject( user ) == true && user.hasOwnProperty( 'id' ) == true && TTUUID.isUUID( user.id ) == true ) ) {\n\t\t\tuser = user.id;\n\t\t}\n\n\t\treturn user;\n\t}\n\n\tgetSelectDate() {\n\t\tif ( this.start_date_picker ) {\n\t\t\tvar retval = this.start_date_picker.getValue();\n\n\t\t\tif ( retval == 'Invalid date' ) {\n\t\t\t\tretval = new Date();\n\t\t\t}\n\n\t\t\treturn retval;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tonDeleteResult( result ) {\n\t\tvar $this = this;\n\t\t$this.timesheet_grid.grid.find( 'td.ui-state-highlight' ).removeClass( 'ui-state-highlight' );\n\t\tProgressBar.closeOverlay();\n\t\tif ( result.isValid() ) {\n\t\t\tif ( $this.edit_view && LocalCacheData.current_doing_context_action === 'delete' ) {\n\t\t\t\t$this.removeEditView();\n\t\t\t}\n\t\t\tif ( $this.edit_view && LocalCacheData.current_doing_context_action === 'delete_and_next' ) {\n\t\t\t\t$this.onRightArrowClick();\n\t\t\t}\n\t\t} else {\n\t\t\tTAlertManager.showErrorAlert( result );\n\t\t}\n\n\t\t// refresh and rebuild search grid, as well as default menu\n\t\t$this.first_build = true;\n\t\t$this.search();\n\t\t$this.setDefaultMenu(); //Default menu needs to be set as we need to deactivate icons that are valid for the predeletion selection\n\t}\n\n\tgetDeleteSelectedRecordId() {\n\t\tvar retval = [];\n\t\tif ( this.edit_view ) {\n\t\t\tretval.push( this.current_edit_record.id );\n\t\t} else {\n\t\t\tfor ( var i in this.select_punches_array ) {\n\t\t\t\tvar item = this.select_punches_array[i];\n\t\t\t\tretval.push( item.id );\n\t\t\t}\n\t\t}\n\t\treturn retval;\n\t}\n\n\treSetURL() {\n\t\t//var args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\tvar args = '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&timezone=' + this.timezone_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue();\n\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\tLocalCacheData.setAllURLArgs( Global.buildArgDic( args.split( '&' ) ) );\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_continue';\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tif ( this.is_mass_adding && this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length === 1 ) {\n\t\t\tthis.current_edit_record.punch_date = this.current_edit_record.punch_dates[0];\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( this.current_edit_record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tvar refresh_id;\n\t\t\t\t\tif ( result_data === true ) {\n\t\t\t\t\t\trefresh_id = $this.current_edit_record.id;\n\n\t\t\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\trefresh_id = result_data;\n\t\t\t\t\t}\n\t\t\t\t\t$this.search();\n\t\t\t\t\t$this.onEditClick( refresh_id );\n\n\t\t\t\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\n\t\t\t\t\t$this.onSaveAndContinueDone( result );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectedRecordId( record ) {\n\t\tvar retval = false;\n\n\t\tif ( Global.isSet( record ) ) {\n\t\t\tif ( Global.isObject( record ) && record.id ) {\n\t\t\t\tretval = record.id;\n\t\t\t} else if ( Global.isString( record ) && TTUUID.isUUID( record ) ) {\n\t\t\t\tretval = record;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\tretval = this.select_punches_array[0].id;\n\t\t\t} else {\n\t\t\t\tretval = null;\n\t\t\t}\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tgetViewSelectedRecordId( record ) {\n\t\treturn this.getSelectedRecordId( record );\n\t}\n\n\tdoViewAPICall( filter, api_args ) {\n\t\tvar current_api = this.getCurrentAPI();\n\t\tvar callback = { onResult: this.handleViewAPICallbackResult.bind( this ) };\n\t\tif ( api_args ) {\n\t\t\t// If api_args specified, use api_args.filter, and ignore function filter parameter.\n\t\t\tapi_args.push( callback );\n\t\t\treturn current_api['get' + current_api.key_name].apply( current_api, api_args );\n\t\t} else {\n\t\t\treturn current_api['get' + current_api.key_name]( filter, callback );\n\t\t}\n\t}\n\n\tonViewClick( record, type ) {\n\t\tif ( type ) {\n\t\t\tif ( type === 'absence' ) {\n\t\t\t\tthis.absence_model = true;\n\t\t\t} else {\n\t\t\t\tthis.absence_model = false;\n\t\t\t}\n\t\t}\n\t\tsuper.onViewClick( record );\n\t}\n\n\tbuildOtherFieldUI( field, label ) {\n\n\t\tif ( !this.edit_view_tab ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar form_item_input;\n\t\tvar $this = this;\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\tif ( $this.edit_view_ui_dic[field] ) {\n\t\t\tform_item_input = $this.edit_view_ui_dic[field];\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t} else {\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: field } );\n\t\t\tvar input_div = $this.addEditFieldToColumn( label, form_item_input, tab_punch_column1 );\n\n\t\t\tinput_div.insertBefore( this.edit_view_form_item_dic['note'] );\n\n\t\t\tform_item_input.setValue( $this.current_edit_record[field] );\n\t\t}\n\t\tform_item_input.css( 'opacity', 1 );\n\t\tform_item_input.css( 'minWidth', 300 );\n\n\t\tif ( $this.is_viewing ) {\n\t\t\tform_item_input.setEnabled( false );\n\t\t} else {\n\t\t\tform_item_input.setEnabled( true );\n\t\t}\n\t}\n\n\tonMassEditClick() {\n\t\tvar $this = this;\n\t\tLocalCacheData.current_doing_context_action = 'mass_edit';\n\t\t$this.openEditView();\n\t\tthis.is_mass_adding = false;\n\t\tthis.is_viewing = false;\n\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tvar filter = {};\n\t\tthis.mass_edit_record_ids = [];\n\n\t\t$.each( this.select_punches_array, function( index, value ) {\n\t\t\t$this.mass_edit_record_ids.push( value.id );\n\t\t} );\n\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = this.mass_edit_record_ids;\n\n\t\tcurrent_api['getCommon' + current_api.key_name + 'Data']( filter, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tcurrent_api['getOptions']( 'unique_columns', {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.unique_columns = result.getResult();\n\t\t\t\t\t\tcurrent_api['getOptions']( 'linked_columns', {\n\t\t\t\t\t\t\tonResult: function( result1 ) {\n\n\t\t\t\t\t\t\t\t$this.linked_columns = result1.getResult();\n\n\t\t\t\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t\t\t$this.is_mass_editing = true;\n\t\t\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSubLogViewFilter() {\n\t\tif ( !this.sub_log_view_controller ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.sub_log_view_controller.getSubViewFilter = function( filter ) {\n\n\t\t\tif ( !this.parent_view_controller.absence_model ) {\n\t\t\t\tfilter['table_name_object_id'] = {\n\t\t\t\t\t'punch': [this.parent_edit_record.id],\n\t\t\t\t\t'punch_control': [this.parent_edit_record.punch_control_id]\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tfilter['table_name'] = 'user_date_total';\n\t\t\t\tfilter['object_id'] = this.parent_edit_record.id;\n\n\t\t\t}\n\n\t\t\treturn filter;\n\t\t};\n\n\t\treturn true;\n\t}\n\n\tgetEditSelectedRecordId( record_id ) {\n\t\treturn this.getSelectedRecordId( record_id );\n\t}\n\n\tdoEditAPICall( filter, api_args ) {\n\t\tvar current_api = this.getCurrentAPI();\n\t\tvar callback = { onResult: this.handleEditAPICallbackResult.bind( this ) };\n\t\tif ( api_args ) {\n\t\t\t// If api_args specified, use api_args.filter, and ignore function filter parameter.\n\t\t\tapi_args.push( callback );\n\t\t\treturn current_api['get' + current_api.key_name].apply( current_api, api_args );\n\t\t} else {\n\t\t\treturn current_api['get' + current_api.key_name]( filter, callback );\n\t\t}\n\t}\n\n\tonEditClick( record_id, type ) {\n\t\tif ( type ) {\n\t\t\tif ( type === 'absence' ) {\n\t\t\t\tthis.absence_model = true;\n\t\t\t} else {\n\t\t\t\tthis.absence_model = false;\n\t\t\t}\n\t\t}\n\t\tsuper.onEditClick( record_id );\n\t}\n\n\tsetURL() {\n\t\tvar t = this.absence_model ? 'absence' : 'punch';\n\t\tvar a = '';\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'new':\n\t\t\tcase 'edit':\n\t\t\tcase 'view':\n\t\t\t\ta = LocalCacheData.current_doing_context_action;\n\t\t\t\tbreak;\n\t\t\tcase 'copy_as_new':\n\t\t\t\ta = 'new';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar tab_name = this.edit_view_tab ? this.edit_view_tab.find( '.edit-view-tab-bar-label' ).children().eq( this.getEditViewTabIndex() ).text() : '';\n\t\ttab_name = tab_name.replace( /\\/|\\s+/g, '' );\n\n\t\t//Error: Unable to get property 'id' of undefined or null reference in /interface/html5/views/BaseViewController.js?v=8.0.0-20141117-132941 line 2234\n\t\tif ( this.current_edit_record && this.current_edit_record.id ) {\n\n\t\t\tif ( a ) {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&id=' + this.current_edit_record.id + '&t=' + t +\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&id=' + this.current_edit_record.id + '&t=' + t + '&tab=' + tab_name );\n\t\t\t} else {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&id=' + this.current_edit_record.id + '&t=' + t );\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&id=' + this.current_edit_record.id + '&t=' + t );\n\t\t\t}\n\n\t\t\tGlobal.trackView();\n\n\t\t} else {\n\n\t\t\tif ( a ) {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&t=' + t +\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&a=' + a + '&t=' + t + '&tab=' + tab_name );\n\t\t\t} else {\n\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&t=' + t );\n\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&user_id=' + this.getSelectEmployee() + '&show_wage=' + this.wage_btn.getValue( true ) + '&mode=' + this.toggle_button.getValue() + '&t=' + t );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.add: //This is caught by onContextMenuClick(), so we have to use a different id: add_punch instead.\n\t\t\tcase ContextMenuIconName.add_punch:\n\t\t\t\tthis.absence_model = false;\n\t\t\t\tthis.onAddClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.add_absence:\n\t\t\t\tthis.absence_model = true;\n\t\t\t\tthis.onAddClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.move:\n\t\t\tcase ContextMenuIconName.drag_copy:\n\t\t\t\tthis.setMoveOrDropMode( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.in_out:\n\t\t\tcase ContextMenuIconName.schedule:\n\t\t\tcase ContextMenuIconName.pay_stub:\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\tcase ContextMenuIconName.edit_pay_period:\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.re_calculate_timesheet:\n\t\t\tcase ContextMenuIconName.generate_pay_stub:\n\t\t\t\tthis.onWizardClick( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.map:\n\t\t\t\tthis.onMapClick( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.accumulated_time:\n\t\t\t\tthis.onAccumulatedTimeClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\t// Preventing TypeError: Cannot read property 'date' of undefined\n\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\tthis.addRequestFromTimesheetCell( id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\taddRequestFromTimesheetCell( id ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar current_column_field = Global.strToDate( this.select_cells_Array[0].date ? this.select_cells_Array[0].date : this.start_date_picker.getValue() ).format( this.full_format );\n\n\t\tif ( this.select_cells_Array[0].punch ) {\n\t\t\tvar punch_control_id = this.select_cells_Array[0].punch.punch_control_id;\n\t\t\tvar current_punch_id = this.select_cells_Array[0].punch.id;\n\t\t\tvar current_punch_status_id = this.select_cells_Array[0].punch.status_id;\n\t\t\tvar type_id = this.select_cells_Array[0].punch.type_id;\n\t\t\tvar user_id = this.select_cells_Array[0].punch.user_id;\n\t\t} else {\n\t\t\tvar user_id = this.getSelectEmployee();\n\t\t\tvar punch_control_id = null;\n\t\t\tvar current_punch_id = null;\n\t\t\tvar current_punch_status_id = 10;\n\t\t\tvar type_id = 10;\n\t\t}\n\n\t\tvar previous_punch_id = null;\n\t\tif ( !current_punch_id ) {\n\t\t\t//row_id is numeric here.\n\t\t\tif ( this.select_cells_Array[0].row_id > 1 && this.timesheet_data_source[this.select_cells_Array[0].row_id - 2] && this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'] ) {\n\t\t\t\tprevious_punch_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'].id;\n\t\t\t\ttype_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 2][current_column_field + '_data'].type_id;\n\t\t\t}\n\n\t\t\t//blank and has no previous punch so we need to infer status_id from the selected row's status\n\t\t\tif ( this.timesheet_data_source[this.select_cells_Array[0].row_id - 1] ) {\n\t\t\t\tcurrent_punch_status_id = this.timesheet_data_source[this.select_cells_Array[0].row_id - 1].status_id;\n\t\t\t}\n\t\t}\n\n\t\tvar date = this.select_cells_Array[0].time_stamp_num / 1000;\n\t\tvar $this = this;\n\t\tthis.api_punch.getRequestDefaultData(\n\t\t\tuser_id,\n\t\t\tdate,\n\t\t\tpunch_control_id,\n\t\t\tprevious_punch_id,\n\t\t\tcurrent_punch_status_id,\n\t\t\ttype_id,\n\t\t\tcurrent_punch_id, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar request = result.getResult();\n\t\t\t\t\tIndexViewController.openEditView( $this, 'Request', request, null, 'openAddView' );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tgetPayPeriod( date ) {\n\t\tvar current_date = this.getSelectDate();\n\n\t\t//if pass a date in, use the date\n\t\tif ( date ) {\n\t\t\tcurrent_date = date;\n\t\t}\n\n\t\tif ( this.pay_period_map && this.pay_period_map[current_date] && this.pay_period_map[current_date] != TTUUID.zero_id && TTUUID.isUUID( this.pay_period_map[current_date] ) == true ) {\n\t\t\treturn this.pay_period_map[current_date];\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tif ( !this.checkTimesheetData() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar post_data;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.in_out:\n\t\t\t\tIndexViewController.openEditView( LocalCacheData.current_open_primary_controller, 'InOut' );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\tIndexViewController.openEditView( this, 'Employee', this.getSelectEmployee() );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.edit_pay_period:\n\t\t\t\tvar pay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'PayPeriods', pay_period_id );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.schedule:\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tvar include_users = { value: [this.getSelectEmployee()] };\n\t\t\t\tfilter.filter_data.include_user_ids = include_users;\n\t\t\t\tfilter.select_date = this.getSelectDate();\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Schedule', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.pay_stub:\n\t\t\t\tfilter = { filter_data: {} };\n\t\t\t\tvar users = { value: [this.getSelectEmployee()] };\n\t\t\t\tfilter.filter_data.user_id = users;\n\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'TimeSheet' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'PayStub', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase 'print_summary':\n\n\t\t\t\tfilter = { time_period: {} };\n\t\t\t\tfilter.time_period.time_period = 'custom_pay_period';\n\t\t\t\tfilter.time_period.pay_period_id = this.timesheet_verify_data.pay_period_id;\n\t\t\t\tfilter.include_user_id = [this.getSelectEmployee()];\n\t\t\t\tpost_data = { 0: filter, 1: 'pdf_timesheet' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t\tcase 'print_detailed':\n\t\t\t\tfilter = { time_period: {} };\n\t\t\t\tfilter.time_period.time_period = 'custom_pay_period';\n\t\t\t\tfilter.time_period.pay_period_id = this.timesheet_verify_data.pay_period_id;\n\t\t\t\tfilter.include_user_id = [this.getSelectEmployee()];\n\t\t\t\tpost_data = { 0: filter, 1: 'pdf_timesheet_detail' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( 'APITimesheetDetailReport', 'getTimesheetDetailReport', postData );\n\t}\n\n\tonAccumulatedTimeClick() {\n\t\tif ( PermissionManager.checkTopLevelPermission( 'AccumulatedTime' ) ) {\n\t\t\tvar select_date = Global.strToDate( this.getSelectDate() ).format( 'YYYY-MM-DD' );\n\t\t\tIndexViewController.openEditView( this, 'UserDateTotalParent', select_date );\n\t\t}\n\t}\n\n\tonMapClick() {\n\t\t// only trigger map load in specific product editions.\n\t\tif ( ( Global.getProductEdition() >= 15 ) ) {\n\n\t\t\t// TODO: this is repeated below, perhaps in future now that getFilterColumnsFromDisplayColumns() is commented out, this can be consolidated?\n\t\t\tvar data = {\n\t\t\t\tfilter_columns: {\n\t\t\t\t\tid: true,\n\t\t\t\t\tlatitude: true,\n\t\t\t\t\tlongitude: true,\n\t\t\t\t\tpunch_date: true,\n\t\t\t\t\tpunch_time: true,\n\t\t\t\t\tposition_accuracy: true,\n\t\t\t\t\tuser_id: true\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar punches = [];\n\t\t\tvar map_options = {};\n\n\t\t\tif ( this.edit_view ) {\n\t\t\t\tpunches.push( this.current_edit_record );\n\t\t\t\tif ( !this.is_viewing ) {\n\t\t\t\t\t// make sure that when view only (so no save) marker is not draggable, and thus no new marker can be added either.\n\t\t\t\t\tmap_options.single_marker_draggable = true;\n\t\t\t\t}\n\t\t\t} else if ( this.select_punches_array && this.select_punches_array.length > 0 ) {\n\t\t\t\tvar ids = [];\n\t\t\t\tthis.select_punches_array.map( function( punch ) {\n\t\t\t\t\tif ( punch.id ) {\n\t\t\t\t\t\tids.push( punch.id );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tdata.filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\t\t\tif ( data.filter_data && ids.length > 0 ) {\n\t\t\t\t\tdata.filter_data.id = ids;\n\t\t\t\t}\n\t\t\t\t// data.filter_columns = this.getFilterColumnsFromDisplayColumns()\n\t\t\t\tdata.filter_columns.first_name = true;\n\t\t\t\tdata.filter_columns.last_name = true;\n\t\t\t\tdata.filter_columns.user_id = true;\n\t\t\t\tdata.filter_columns.date_stamp = true; // #2735 - grouping punches by date_stamp instead of punch_date, to allow cross date punch controls to plot distances.\n\t\t\t\tdata.filter_columns.punch_date = true;\n\t\t\t\tdata.filter_columns.punch_time = true;\n\t\t\t\tdata.filter_columns.time_stamp = true;\n\t\t\t\tdata.filter_columns.status = true;\n\t\t\t\tdata.filter_columns.punch_control_id = true;\n\t\t\t\tdata.filter_columns.branch = true;\n\t\t\t\tdata.filter_columns.branch_id = true;\n\t\t\t\tdata.filter_columns.department = true;\n\t\t\t\tdata.filter_columns.department_id = true;\n\t\t\t\tdata.filter_columns.job_manual_id = true;\n\t\t\t\tdata.filter_columns.job = true;\n\t\t\t\tdata.filter_columns.job_id = true;\n\t\t\t\tdata.filter_columns.job_item_manual_id = true;\n\t\t\t\tdata.filter_columns.job_item = true; // also known as Task\n\t\t\t\tdata.filter_columns.job_item_id = true;\n\t\t\t\tdata.filter_columns.total_time = true;\n\t\t\t\tdata.filter_columns.latitude = true;\n\t\t\t\tdata.filter_columns.longitude = true;\n\t\t\t\tdata.filter_columns.position_accuracy = true;\n\n\t\t\t\tpunches = this.api.getPunch( data, { async: false } ).getResult();\n\t\t\t}\n\n\t\t\tif ( !this.is_mass_editing ) {\n\t\t\t\t// There is not enough detail in the 'punches' data pulled from the grid, get the full data from api, like PunchesViewController\n\t\t\t\t// Note there seems to be a multple ways to get the data e.g. select_punches_array,\n\t\t\t\t// but other view controllers use .getGridSelectIdArray() and theres also select_cells_Array.\n\t\t\t\t// TODO-future: Perhaps look at a future refactor/consolidation of all these?\n\n\t\t\t\tif ( Global.isArray( punches ) ) {\n\t\t\t\t\timport( /* webpackChunkName: \"leaflet-timetrex\" */ '@/framework/leaflet/leaflet-timetrex' ).then(( module )=>{\n\t\t\t\t\t\tvar processed_punches_for_map = module.TTConvertMapData.processPunchesFromViewController( punches, map_options );\n\t\t\t\t\t\tIndexViewController.openEditView( this, 'Map', processed_punches_for_map );\n\t\t\t\t\t}).catch( Global.importErrorHandler );\n\t\t\t\t} else {\n\t\t\t\t\tDebug.Text( 'ERROR: Either punches is not an array, or data is empty', 'TimeSheetViewController.js', 'TimeSheetViewController', 'onMapClick', 1 );\n\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Selected punches no longer exist, unable to map.' ) );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonWizardClick( iconName ) {\n\n\t\tvar $this = this;\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.re_calculate_timesheet:\n\t\t\t\tvar default_data = {};\n\t\t\t\tdefault_data.user_id = this.getSelectEmployee();\n\n\t\t\t\tvar pay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tdefault_data.pay_period_id = pay_period_id;\n\t\t\t\t}\n\t\t\t\tIndexViewController.openWizard( 'ReCalculateTimeSheetWizard', default_data, function() {\n\n\t\t\t\t\t$this.onReCalTimeSheetDone();\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.generate_pay_stub:\n\n\t\t\t\tdefault_data = {};\n\t\t\t\tdefault_data.user_id = this.getSelectEmployee();\n\n\t\t\t\tpay_period_id = this.getPayPeriod();\n\t\t\t\tif ( pay_period_id ) {\n\t\t\t\t\tdefault_data.pay_period_id = [pay_period_id];\n\t\t\t\t} else {\n\t\t\t\t\tdefault_data.pay_period_id = [];\n\t\t\t\t}\n\t\t\t\tIndexViewController.openWizard( 'GeneratePayStubWizard', default_data, function() {\n\t\t\t\t\t$this.search();\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonReCalTimeSheetDone() {\n\t\t//Its possible the user has navigated away from the timesheet while a recalculation is in progress, if so, don't try to refresh the timesheet.\n\t\t//Also fixes: Uncaught TypeError: Failed to execute 'replaceChild' on 'Node': parameter 2 is not of type 'Node'.\n\t\tif ( TopMenuManager.isCurrentView( 'TimeSheet' ) ) {\n\t\t\tTopMenuManager.goToView( 'TimeSheet', true );\n\t\t\t//this.initData(); //Do a generic view refresh rather than just initData() as its less likely to cause problems.\n\t\t}\n\t}\n\n\tsetMoveOrDropMode( id ) {\n\t\tvar drag_copy_icon = $( '#' + ContextMenuIconName.drag_copy );\n\t\tvar move_icon = $( '#' + ContextMenuIconName.move );\n\t\tdrag_copy_icon.removeClass( 'selected-menu' );\n\t\tmove_icon.removeClass( 'selected-menu' );\n\n\t\tvar drag_invisible = false;\n\t\tvar move_invisible = false;\n\n\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\tdrag_invisible = true;\n\t\t}\n\n\t\tif ( !this.movePermissionValidate() ) {\n\t\t\tmove_invisible = true;\n\t\t}\n\n\t\tif ( move_invisible && id === ContextMenuIconName.move ) {\n\t\t\tdrag_copy_icon.addClass( 'selected-menu' );\n\t\t} else {\n\t\t\t$( '#' + id ).addClass( 'selected-menu' );\n\t\t}\n\n\t\tif ( drag_invisible && move_invisible ) {\n\t\t\tthis.select_drag_menu_id = null;\n\t\t} else {\n\t\t\tthis.select_drag_menu_id = id;\n\t\t}\n\t}\n\n\tgetSelectDateArray() {\n\n\t\tvar result = [];\n\n\t\tvar cells_array = this.absence_model ? this.absence_select_cells_Array : this.select_cells_Array;\n\n\t\tvar len = cells_array.length;\n\n\t\tvar date_dic = {};\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\t\t\tdate_dic[item.date] = true;\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\tif ( result.length === 0 ) {\n\t\t\tresult = [this.getSelectDate()];\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonAddClick( doing_save_and_new ) {\n\t\tTTPromise.add( 'TimeSheetViewController', 'addclick' );\n\t\tTTPromise.wait();\n\t\tvar $this = this;\n\t\tthis.is_viewing = false;\n\t\tthis.is_mass_adding = true;\n\t\tLocalCacheData.current_doing_context_action = 'new';\n\t\tvar punch_control_id = null;\n\t\tvar prev_punch_id = null;\n\t\tvar related_punch = null;\n\t\tvar date = this.getSelectDate();\n\t\tvar status_id = 10, type_id = 10, select_cell;\n\n\t\tif ( !this.absence_model ) {\n\t\t\tif ( this.select_cells_Array.length === 1 ) {\n\t\t\t\tvar select_item = this.select_cells_Array[0];\n\t\t\t\tif ( select_item.related_punch ) {\n\t\t\t\t\trelated_punch = select_item.related_punch;\n\t\t\t\t\tpunch_control_id = select_item.related_punch.punch_control_id;\n\t\t\t\t\tprev_punch_id = select_item.related_punch.id;\n\t\t\t\t} else {\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=TimeSheet&date=20151006&user_id=51085&show_wage=0 line 6292\n\t\t\t\t\tvar current_column_field = Global.strToDate( select_item.date ? select_item.date : this.start_date_picker.getValue() ).format( this.full_format );\n\n\t\t\t\t\t//row_id is nbumeric here\n\t\t\t\t\tif ( this.timesheet_data_source && this.timesheet_data_source[select_item.row_id - 2] ) {\n\t\t\t\t\t\tvar pre_punch = this.timesheet_data_source[select_item.row_id - 2][current_column_field + '_data'];\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( pre_punch ) {\n\t\t\t\t\t\tprev_punch_id = pre_punch.id;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t// To use proper context menu for each punch or abseonce mode.\n\t\t\tthis.setDefaultMenu();\n\t\t\t$this.openEditView();\n\n\t\t\tif ( doing_save_and_new ) {\n\t\t\t\tdate = this.current_edit_record.punch_date;\n\t\t\t\trelated_punch = null;\n\t\t\t\tif ( this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\tpunch_control_id = this.current_edit_record.punch_control_id;\n\t\t\t\t} else {\n\t\t\t\t\tpunch_control_id = null;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( this.select_cells_Array.length === 1 ) {\n\t\t\t\tselect_cell = this.select_cells_Array[0];\n\t\t\t\tstatus_id = select_cell.status_id;\n\n\t\t\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\t\tvar new_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\tif ( new_date.getTime() < this.start_date.getTime() ) {\n\t\t\t\t\ttype_id = 10;\n\t\t\t\t} else {\n\t\t\t\t\tvar row_data = this.timesheet_data_source[select_cell.row_id - 1];\n\t\t\t\t\t//Error: Unable to get property 'Sun-Dec-13-2015_data' of undefined or null reference in interface/html5/ line 6362\n\t\t\t\t\tvar left_side_punch = row_data && row_data[new_date.format( this.full_format ) + '_data'];\n\t\t\t\t\tif ( left_side_punch ) {\n\t\t\t\t\t\ttype_id = left_side_punch.type_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttype_id = 10;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselect_cell = this.select_cells_Array[0];\n\t\t\t\tif ( select_cell && select_cell.status_id ) {\n\t\t\t\t\tstatus_id = select_cell.status_id;\n\t\t\t\t} else {\n\t\t\t\t\tstatus_id = 10; //In\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.api['get' + this.api.key_name + 'DefaultData']( this.getSelectEmployee(),\n\t\t\t\tdate,\n\t\t\t\tpunch_control_id,\n\t\t\t\tprev_punch_id,\n\t\t\t\tstatus_id,\n\t\t\t\ttype_id,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$this.is_mass_adding && related_punch ) {\n\t\t\t\t\t\t\tresult_data.punch_date = related_punch.punch_date;\n\t\t\t\t\t\t\tresult_data.punch_time = related_punch.punch_time;\n\n\t\t\t\t\t\t\tif ( related_punch.status_id == 10 ) {\n\t\t\t\t\t\t\t\tresult_data.status_id = 20;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult_data.status_id = 10;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult_data.punch_date = $this.getSelectDate();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( doing_save_and_new ) {\n\t\t\t\t\t\t\tresult_data.punch_date = $this.current_edit_record.punch_date;\n\n\t\t\t\t\t\t\tif ( $this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\t\t\t\tresult_data.status_id = 20;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult_data.status_id = 10;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t} else { //Absence model branch\n\n\t\t\tif ( doing_save_and_new ) {\n\t\t\t\tdate = this.current_edit_record.date_stamp;\n\t\t\t}\n\t\t\t// To use proper context menu for each punch or abseonce mode.\n\t\t\t$this.setDefaultMenu();\n\t\t\t$this.openEditView();\n\t\t\tthis.api_user_date_total['get' + this.api_user_date_total.key_name + 'DefaultData']( this.getSelectEmployee(),\n\t\t\t\tdate,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t\tif ( !Global.isSet( result_data.time_stamp ) ) {\n\t\t\t\t\t\t\tresult_data.time_stamp = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( Global.isSet( $this.absence_select_cells_Array[0] ) ) {\n\t\t\t\t\t\t\tresult_data.src_object_id = $this.absence_select_cells_Array[0].src_object_id;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult_data.object_type_id = 50;\n\n\t\t\t\t\t\tresult_data.date_stamp = $this.getSelectDate();\n\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t}\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\t\tif ( this.absence_select_cells_Array.length > 0 ) {\n\t\t\tthis.absence_model = true;\n\t\t} else {\n\t\t\tthis.absence_model = false;\n\t\t}\n\t\tthis.setDefaultMenu();\n\t}\n\n\tisMassDate() {\n\t\t//Error: Unable to get property 'punch_dates' of undefined or null reference in /interface/html5/ line 6300\n\t\tif ( this.is_mass_adding && this.current_edit_record && this.current_edit_record.punch_dates && this.current_edit_record.punch_dates.length > 1 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetEditMenuSaveAndContinueIcon( context_btn, pId ) {\n\t\tthis.saveAndContinueValidate( context_btn, pId );\n\n\t\tif ( this.is_mass_editing || this.is_viewing || this.isMassDate() ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonSaveAndNewClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tvar current_api = this.getCurrentAPI();\n\t\tLocalCacheData.current_doing_context_action = 'new';\n\n\t\tvar record = this.current_edit_record;\n\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t$this.search( false );\n\t\t\t\t\t$this.onAddClick( true );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tthis.is_mass_adding = true;\n\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.current_edit_record.id = '';\n\n\t\t\tif ( !this.absence_model ) {\n\n\t\t\t\tthis.current_edit_record.punch_control_id = '';\n\n\t\t\t\tif ( this.current_edit_record.status_id == 10 ) {\n\t\t\t\t\tthis.current_edit_record.status_id = 20;\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.current_edit_record.status_id = 10;\n\t\t\t\t}\n\n\t\t\t\tthis.edit_view_ui_dic['status_id'].setValue( this.current_edit_record.status_id );\n\t\t\t}\n\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.openEditView();\n\t\t\tthis.initEditView();\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\t\t}\n\t}\n\n\tonSaveAndCopy( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tvar current_api = this.getCurrentAPI();\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_copy';\n\t\tvar record = this.current_edit_record;\n\t\tif ( this.is_mass_adding ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tthis.clearNavigationData();\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t$this.search( false );\n\t\t\t\t\t$this.onCopyAsNewClick();\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetCurrentAPI() {\n\t\tvar current_api = this.api;\n\n\t\tif ( this.absence_model ) {\n\t\t\tcurrent_api = this.api_user_date_total;\n\t\t}\n\n\t\treturn current_api;\n\t}\n\n\tgenerateManualTimeSheetRecordKey( item ) {\n\t\tvar key = item.date_stamp + '-' + ( ( this.show_branch_ui && item.branch_id ) ? item.branch_id : TTUUID.zero_id ) +\n\t\t\t'-' + ( ( this.show_department_ui && item.department_id ) ? item.department_id : TTUUID.zero_id )\n\t\t\t+ '-' + ( ( this.show_job_ui && item.job_id && Global.getProductEdition() >= 20 ) ? item.job_id : TTUUID.zero_id ) +\n\t\t\t'-' + ( ( this.show_job_item_ui && item.job_item_id && Global.getProductEdition() >= 20 ) ? item.job_item_id : TTUUID.zero_id ) +\n\t\t\t'-' + item.total_time;\n\n\t\treturn key;\n\t}\n\n\tcreateCurrentManualGridRecordsMap( records ) {\n\t\tthis.manual_grid_records_map = {};\n\n\t\tfor ( var i = 0, m = records.length; i < m; i++ ) {\n\t\t\tvar item = records[i];\n\n\t\t\tvar key = this.generateManualTimeSheetRecordKey( item );\n\t\t\tif ( item.id ) {\n\t\t\t\tkey = item.id + '-' + key;\n\t\t\t}\n\n\t\t\tthis.manual_grid_records_map[key] = item.row;\n\t\t\tdelete item.row;\n\t\t}\n\t}\n\n\t//Don't send records with blank total_time to the API, to better handle cases where the employees hire date is in the middle of the week and they accidently enter time on the Monday, which cause a popup validation error.\n\t//This allows them to get out of the scenario by simply clearing out the field or setting it back to 0.\n\tfilterManualGridRecords( records ) {\n\t\tvar retarr = Array();\n\n\t\tfor ( var i = 0; i < records.length; i++ ) {\n\t\t\tvar item = records[i];\n\n\t\t\tif ( item.id || ( !item.id && item.total_time && item.total_time != 0 ) ) {\n\t\t\t\tretarr.push( item );\n\t\t\t}\n\t\t}\n\n\t\treturn retarr;\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tvar record;\n\t\t// Save manual punch\n\t\tif ( this.getPunchMode() === 'manual' && !this.edit_view ) {\n\t\t\tvar records = this.editor.getValue( true ); // reset is_changed\n\t\t\tif ( records.length > 0 ) {\n\t\t\t\tthis.wait_auto_save && clearTimeout( this.wait_auto_save );\n\t\t\t\tthis.createCurrentManualGridRecordsMap( records );\n\t\t\t\tProgressBar.noProgressForNextCall();\n\t\t\t\tthis.is_saving_manual_grid = true;\n\t\t\t\tthis.setDefaultMenu();\n\n\t\t\t\trecords = this.filterManualGridRecords( records );\n\t\t\t\tif ( records.length > 0 ) {\n\t\t\t\t\tthis.api_user_date_total['set' + this.api_user_date_total.key_name]( records, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$this.updateManualGrid();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\t\t\t\t\t$this.updateManualGrid();\n\t\t\t\t}\n\n\t\t\t\tProgressBar.showNanobar();\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t} else {\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t//Save normal punch\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tif ( this.is_mass_editing ) {\n\n\t\t\tvar check_fields = {};\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() ) {\n\t\t\t\t\t\tcheck_fields[key] = this.current_edit_record[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\tvar common_record = Global.clone( check_fields );\n\t\t\t\tcommon_record.id = value;\n\t\t\t\trecord.push( common_record );\n\n\t\t\t} );\n\t\t} else {\n\t\t\trecord = this.current_edit_record;\n\t\t}\n\n\t\t// Error: Uncaught TypeError: Cannot read property 'punch_dates' of null in /interface/html5/#!m=TimeSheet&date=20150323&user_id=69543 line 6448\n\t\tif ( this.is_mass_adding && this.current_edit_record ) {\n\n\t\t\trecord = [];\n\t\t\tvar dates_array = this.current_edit_record.punch_dates;\n\n\t\t\tif ( dates_array && dates_array.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tdates_array = this.parserDatesRange( dates_array );\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < dates_array.length; i++ ) {\n\t\t\t\tvar common_record = Global.clone( this.current_edit_record );\n\t\t\t\tdelete common_record.punch_dates;\n\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\tcommon_record.date_stamp = dates_array[i];\n\t\t\t\t} else {\n\t\t\t\t\tcommon_record.punch_date = dates_array[i];\n\t\t\t\t}\n\n\t\t\t\trecord.push( common_record );\n\t\t\t}\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tcurrent_api['set' + current_api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t$this.first_build = true;\n\t\t\t\t\t$this.search();\n\n\t\t\t\t\t$this.removeEditView();\n\n\t\t\t\t\t//#2295 - Re-initialize previous_absence_policy_id to ensure that previously saved values are passed correctly into the estimation of projected available balance.\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonMapSaveClick( dataset, successCallback ) {\n\t\tthis.savePunchPosition( dataset, successCallback );\n\t}\n\n\tsavePunchPosition( moved_unsaved_markers, successCallback ) {\n\t\tif ( !moved_unsaved_markers || moved_unsaved_markers.length !== 1 ) {\n\t\t\tDebug.Text( 'ERROR: Invalid params/data passed to function.', 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'savePunchPosition', 1 );\n\t\t\treturn false;\n\t\t}\n\t\tthis.setLocationValue( moved_unsaved_markers[0] );\n\t\tsuccessCallback();\n\t\tthis.is_changed = true;\n\t\treturn true;\n\t}\n\n\tgetOtherFieldTypeId() {\n\t\tvar res = 15;\n\n\t\tif ( this.absence_model ) {\n\t\t\tres = 0;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * This function is special as it handles an edit view that deals with both absences and punches.\n\t * This is the only place where 2 different data layouts need to be handled by the same navigation without a change of view.\n\t */\n\tsetEditViewData() {\n\t\tvar $this = this;\n\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\tvar navigation_widget_div = navigation_div.find( '.navigation-widget-div' );\n\n\t\tthis.is_changed = false;\n\n\t\tif ( Global.isSet( this.current_edit_record.id ) && this.current_edit_record.id ) {\n\t\t\t//fixing both #2171 and #2227\n\t\t\t//preventing unclickable navigation and \"cannot find property or function has of undefined.\"\n\t\t\tnavigation_div.css( 'display', 'block' );\n\t\t\tthis.navigation = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\t//Set Navigation Awesomebox\n\t\t\tif ( this.absence_model ) {\n\t\t\t\tthis.navigation.AComboBox( {\n\t\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\t\tlayout_name: 'global_absence'\n\t\t\t\t} );\n\n\t\t\t\tif ( this.absence_original_source ) {\n\t\t\t\t\tthis.navigation.setSourceData( this.absence_original_source );\n\t\t\t\t\tthis.navigation.is_punch_nav = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.navigation.AComboBox( {\n\t\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\t\tlayout_name: 'global_timesheet'\n\t\t\t\t} );\n\n\t\t\t\tif ( this.full_timesheet_data ) {\n\t\t\t\t\tthis.navigation.setSourceData( this.full_timesheet_data.punch_data );\n\t\t\t\t\tthis.navigation.is_punch_nav = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.navigation.setValue( this.current_edit_record );\n\n\t\t\tnavigation_widget_div.html( this.navigation );\n\t\t\t// #2122 - Fixes navigation errors including: \"Cannot read property 'current_page' of null\" & \"Cannot read property 'has' of null\"\n\t\t\t// Prevents user clicking on drop-down to navigate to the first record then immediately clicking the left arrow which triggers the errors.\n\t\t\tthis.setNavigation();\n\n\t\t} else {\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t}\n\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t//Set all UI field to current edit record, we need validate all UI fielld when save and validate\n\t\t\tif ( !Global.isSet( $this.current_edit_record[key] ) && !this.is_mass_editing ) {\n\t\t\t\t$this.current_edit_record[key] = false;\n\t\t\t}\n\t\t}\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.setMassEditMode ) ) {\n\t\t\t\t\twidget.setMassEditMode( true );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t$.each( this.unique_columns, function( index, value ) {\n\n\t\t\t\tif ( Global.isSet( $this.edit_view_ui_dic[value] ) && Global.isSet( $this.edit_view_ui_dic[value].setEnabled ) ) {\n\t\t\t\t\t$this.edit_view_ui_dic[value].setEnabled( false );\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.setNavigationArrowsStatus();\n\n\t\t// Create this function alone because of the column value of view is different from each other, some columns need to be handle specially. and easily to rewrite this function in sub-class.\n\t\tthis.setCurrentEditRecordData();\n\n\t\t//Init *Please save this record before modifying any related data* box\n\t\tthis.edit_view.find( '.save-and-continue-div' ).SaveAndContinueBox( { related_view_controller: this } );\n\t\tthis.edit_view.find( '.save-and-continue-div' ).css( 'display', 'none' );\n\n\t\tthis.initTabData();\n\t\tthis.switchToProperTab();\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\n\t\tvar tab_0_label = this.edit_view.find( 'a[ref=tab_punch]' );\n\n\t\tif ( this.absence_model ) {\n\t\t\ttab_0_label.text( $.i18n._( 'Absence' ) );\n\t\t} else {\n\t\t\ttab_0_label.text( $.i18n._( 'Punch' ) );\n\t\t}\n\n\t\t//This needs to be done here or the user id gets stuck and subsequent punches for subordinates go to the admin's timesheet.\n\t\tthis.current_edit_record.user_id = this.getSelectEmployee();\n\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar args;\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'punch_dates':\n\t\t\t\t\t\tvar date_array;\n\t\t\t\t\t\tif ( !this.current_edit_record.punch_dates ) {\n\t\t\t\t\t\t\tdate_array = this.getSelectDateArray();\n\t\t\t\t\t\t\tthis.current_edit_record.punch_dates = date_array;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdate_array = this.current_edit_record.punch_dates;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'first_last_name':\n\t\t\t\t\t\tvar select_employee = this.getSelectEmployee( true ); //Get full item\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'first_name' of null in interface/html5/#!m=TimeSheet&date=null&user_id=null&show_wage=0&a=new&t=punch&tab=Punch line 6810\n\t\t\t\t\t\tif ( select_employee ) {\n\t\t\t\t\t\t\twidget.setValue( select_employee['first_name'] + ' ' + select_employee['last_name'] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\tif ( this.absence_model ) {\n\t\t\t\t\t\t\tvar result = Global.getTimeUnit( this.current_edit_record[key] );\n\t\t\t\t\t\t\twidget.setValue( result );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'station_id':\n\t\t\t\t\t\tif ( this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tthis.setStation();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( 'N/A' );\n\t\t\t\t\t\t\twidget.css( 'cursor', 'default' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_image':\n\t\t\t\t\t\tvar station_form_item = this.edit_view_form_item_dic['station_id'];\n\t\t\t\t\t\tif ( this.current_edit_record['has_image'] ) {\n\t\t\t\t\t\t\tthis.attachElement( 'punch_image' );\n\t\t\t\t\t\t\twidget.setValue( ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=punch_image&parent_id=' + this.current_edit_record.user_id + '&object_id=' + this.current_edit_record.id );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.detachElement( 'punch_image' );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\targs = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\targs = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'latitude':\n\t\t\t\t\tcase 'longitude':\n\t\t\t\t\tcase 'position_accuracy':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\n\t\t\tif ( this.current_edit_record.id ) {\n\t\t\t\tthis.pre_total_time = this.current_edit_record.total_time;\n\t\t\t} else {\n\t\t\t\tthis.pre_total_time = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.pre_total_time = 0;\n\t\t}\n\n\t\tvar actual_time_value;\n\t\tif ( this.current_edit_record.id ) {\n\n\t\t\tif ( this.current_edit_record.actual_time_stamp ) {\n\t\t\t\tactual_time_value = $.i18n._( 'Actual Time' ) + ': ' + this.current_edit_record.actual_time_stamp;\n\t\t\t} else {\n\t\t\t\tactual_time_value = 'N/A';\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setLocationValue( this.current_edit_record );\n\n\t\tthis.actual_time_label.text( actual_time_value );\n\n\t\tthis.onAvailableBalanceChange();\n\n\t\tthis.setEditMenu(); //To make sure save & continue icon disabled correct when multi dates\n\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\t//can't check is_edit here because in timesheet it can be both.\n\t\tif ( this.is_viewing == true && ( this.current_edit_record.latitude == 0 || this.current_edit_record.longitude == 0 ) ) {\n\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).hide();\n\t\t} else {\n\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t$( '.widget-h-box-mapLocationWrapper' ).parents( '.edit-view-form-item-div' ).show();\n\t\t\t}\n\t\t}\n\t}\n\n\tsetLocationValue( location_data ) {\n\t\tif ( Global.getProductEdition() >= 15\n\t\t\t&& this.edit_view_ui_dic['latitude']\n\t\t\t&& this.edit_view_ui_dic['longitude']\n\t\t\t&& this.edit_view_ui_dic['position_accuracy']\n\t\t) {\n\t\t\tif ( location_data ) {\n\t\t\t\tthis.current_edit_record.latitude = location_data.latitude;\n\t\t\t\tthis.current_edit_record.longitude = location_data.longitude;\n\t\t\t\tthis.current_edit_record.position_accuracy = location_data.position_accuracy;\n\t\t\t}\n\t\t\tthis.edit_view_ui_dic['latitude'].setValue( this.current_edit_record.latitude );\n\t\t\tthis.edit_view_ui_dic['longitude'].setValue( this.current_edit_record.longitude );\n\t\t\tthis.edit_view_ui_dic['position_accuracy'].setValue( this.current_edit_record.position_accuracy ? this.current_edit_record.position_accuracy : 0 );\n\n\t\t\tif ( !this.current_edit_record.latitude && !this.is_mass_editing ) {\n\t\t\t\tthis.location_wrapper.hide();\n\t\t\t} else {\n\t\t\t\tif ( this.show_location_ui ) {\n\t\t\t\t\tthis.location_wrapper.show();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonAvailableBalanceChange() {\n\t\tif ( this.current_edit_record.hasOwnProperty( 'src_object_id' ) &&\n\t\t\tthis.current_edit_record.src_object_id && !this.is_mass_editing ) {\n\t\t\tthis.getAvailableBalance();\n\t\t} else {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\t\tthis.editFieldResize();\n\t}\n\n\tgetAvailableBalance() {\n\n\t\tvar $this = this;\n\t\tvar result_data;\n\n\t\t//On first run, set previous_absence_policy_id.\n\t\tif ( this.previous_absence_policy_id == false ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.src_object_id;\n\t\t}\n\n\t\tif ( this.absence_model ) {\n\n\t\t\tvar last_date_stamp = this.current_edit_record.date_stamp;\n\t\t\tvar total_time = this.current_edit_record.total_time;\n\n\t\t\tif ( this.is_mass_adding ) {\n\n\t\t\t\tlast_date_stamp = this.current_edit_record.punch_dates;\n\t\t\t\t//get dates from date ranger\n\t\t\t\tif ( last_date_stamp && last_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t\t\t$.type( last_date_stamp ) === 'array' ) {\n\n\t\t\t\t\tif ( last_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\t\t\tlast_date_stamp = this.parserDatesRange( last_date_stamp );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( last_date_stamp.length > 0 ) {\n\t\t\t\t\t\ttotal_time = total_time * last_date_stamp.length;\n\t\t\t\t\t\tlast_date_stamp = last_date_stamp[last_date_stamp.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.api_absence_policy.getProjectedAbsencePolicyBalance(\n\t\t\t\tthis.current_edit_record.src_object_id,\n\t\t\t\tthis.getSelectEmployee(),\n\t\t\t\tlast_date_stamp,\n\t\t\t\ttotal_time,\n\t\t\t\tthis.pre_total_time,\n\t\t\t\tthis.previous_absence_policy_id,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.getBalanceHandler( result, last_date_stamp );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\n\t\t}\n\t}\n\n\tsetStation() {\n\n\t\tvar $this = this;\n\t\tvar arg = { filter_data: { id: this.current_edit_record.station_id } };\n\n\t\tthis.api_station.getStation( arg, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\t$this.station = result.getResult()[0];\n\n\t\t\t\tvar widget = $this.edit_view_ui_dic['station_id'];\n\t\t\t\tif ( $this.station ) {\n\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of undefined in /interface/html5/#!m=TimeSheet&date=20140925 line 6017\n\t\t\t\t\tif ( widget ) {\n\t\t\t\t\t\twidget.setValue( $this.station.type + '-' + $this.station.description );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( widget ) {\n\t\t\t\t\t\twidget.setValue( 'N/A' );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( PermissionManager.validate( 'station', 'view' ) ||\n\t\t\t\t\t( PermissionManager.validate( 'station', 'view_child' ) && $this.station.is_child ) ||\n\t\t\t\t\t( PermissionManager.validate( 'station', 'view_own' ) && $this.station.is_owner ) ) {\n\t\t\t\t\t$this.show_station_ui = true;\n\t\t\t\t} else {\n\t\t\t\t\t$this.show_station_ui = false;\n\t\t\t\t}\n\n\t\t\t\t// Error: TypeError: form_item_input is undefined in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-091549 line 2 > eval line 7119\n\t\t\t\tif ( $this.show_station_ui && widget ) {\n\t\t\t\t\twidget.css( 'cursor', 'pointer' );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectedItems() {\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\treturn [this.current_edit_record];\n\t\t} else {\n\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\treturn this.select_punches_array;\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetSelectedItem() {\n\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\tselected_item = this.current_edit_record;\n\t\t} else {\n\n\t\t\tif ( this.select_punches_array.length > 0 ) {\n\t\t\t\tselected_item = this.select_punches_array[0];\n\t\t\t} else {\n\t\t\t\tselected_item = null;\n\t\t\t}\n\t\t}\n\n\t\treturn Global.clone( selected_item );\n\t}\n\n\taddPermissionValidate( p_id ) {\n\t\tif ( !Global.isSet( p_id ) ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'add' ) && this.editPermissionValidate( p_id ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\t//Check if there is a current_company object at all.\n\t\tif ( LocalCacheData.isLocalCacheExists( 'current_company' ) == false ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// if ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t// \tthis.selectContextMenu();\n\t\t// }\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_length = this.select_punches_array.length;\n\n\t\tvar p_id = this.absence_model ? 'absence' : 'punch';\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\tcase ContextMenuIconName.add_punch:\n\t\t\t\t\tthis.setDefaultMenuAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.add_absence:\n\t\t\t\t\tthis.setDefaultMenuAddIcon( context_btn, grid_selected_length, 'absence' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setDefaultMenuMassEditIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setDefaultMenuCopyIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.drag_copy:\n\t\t\t\t\tthis.setDefaultMenuDragCopyIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setDefaultMenuDeleteIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setDefaultMenuDeleteAndNextIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setDefaultMenuSaveAndNextIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setDefaultMenuSaveAndContinueIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setDefaultMenuSaveAndAddIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setDefaultMenuSaveAndCopyIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.move:\n\t\t\t\t\tif ( !this.movePermissionValidate( p_id ) ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_pay_period:\n\t\t\t\t\tthis.setDefaultMenuEditPayPeriodIcon( context_btn, grid_selected_length, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.map:\n\t\t\t\t\tthis.setDefaultMenuMapIcon( context_btn, grid_selected_length, p_id );\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.print:\n\t\t\t\t\tthis.setDefaultMenuPrintIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.pay_stub:\n\t\t\t\t\tthis.setDefaultMenuPayStubIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.re_calculate_timesheet:\n\t\t\t\t\tthis.setDefaultMenuReCalculateTimesheet( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.generate_pay_stub:\n\t\t\t\t\tthis.setDefaultMenuGeneratePayStubIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.schedule:\n\t\t\t\t\tthis.setDefaultMenuScheduleIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.accumulated_time:\n\t\t\t\t\tthis.setDefaultMenuAccumulatedTimeIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AddRequest':\n\t\t\t\t\tthis.setAddRequestIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tsetEditMenuDragCopyIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.copyPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuDragCopyIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.copyPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.getPunchMode() == 'manual' ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuScheduleIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'Schedule' ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\treCalculateEditPermissionValidate() {\n\n\t\tvar p_id = this.permission_id;\n\n\t\tif ( PermissionManager.validate( p_id, 'edit' ) || this.ownerOrChildPermissionValidate( p_id, 'edit_child' ) ) {\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tsetDefaultMenuReCalculateTimesheet( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !this.reCalculateEditPermissionValidate() ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuGeneratePayStubIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'GeneratePayStubs' ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuPayStubIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'PayStub' ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditPayPeriodIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !this.editPermissionValidate( 'pay_period_schedule' ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tvar $this = this;\n\t\tcontext_btn.addClass( 'disable-image' );\n\t\tif ( $this.getPayPeriod() ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuAccumulatedTimeIcon( context_btn, pId ) {\n\n\t\tif ( !PermissionManager.checkTopLevelPermission( 'AccumulatedTime' ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !this.editChildPermissionValidate( 'user' ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t}\n\n\teditOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'edit' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'edit_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'edit_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tviewOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'view' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'view_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'view_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdeleteOwnerOrChildPermissionValidate( p_id, selected_item ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !selected_item ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (\n\t\t\tPermissionManager.validate( p_id, 'delete' ) ||\n\t\t\t( selected_item && selected_item.is_owner && PermissionManager.validate( p_id, 'delete_own' ) ) ||\n\t\t\t( selected_item && selected_item.is_child && PermissionManager.validate( p_id, 'delete_child' ) ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\t}\n\n\teditChildPermissionValidate( p_id, selected_item ) {\n\t\tif ( !Global.isSet( p_id ) ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( !Global.isSet( selected_item ) ) {\n\t\t\tselected_item = this.getSelectEmployee( true );\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( !PermissionManager.validate( p_id, 'enabled' ) ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit' ) ||\n\t\t\tthis.ownerOrChildPermissionValidate( p_id, 'edit_child', selected_item ) ) {\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tonReportMenuClick( id ) {\n\t\tthis.onNavigationClick( id );\n\t}\n\n\tsetDefaultMenuPrintIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetEditMenuMapIcon( context_btn, pId ) {\n\t\tsuper.setDefaultMenuMapIcon( context_btn );\n\n\t\tif ( context_btn.hasClass( 'disable-image' ) == false ) {\n\t\t\tif ( this.absence_model || this.getPunchMode() == 'manual' ) {\n\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndAddIcon( context_btn, pId ) {\n\t\tthis.saveAndNewValidate( context_btn, pId );\n\n\t\tif ( this.is_viewing || this.is_mass_editing ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuMapIcon( context_btn, grid_selected_length, pId ) {\n\t\tsuper.setDefaultMenuMapIcon( context_btn );\n\n\t\tif ( context_btn.hasClass( 'disable-image' ) == false ) {\n\t\t\tif ( this.absence_model || this.getPunchMode() == 'manual' ) {\n\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndNextIcon( context_btn, pId ) {\n\t\tif ( !this.editPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || this.is_viewing || this.is_mass_adding ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndCopyIcon( context_btn, pId ) {\n\t\tthis.saveAndNewValidate( context_btn, pId );\n\n\t\tif ( this.is_viewing || this.is_mass_editing ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuCopyAndAddIcon( context_btn, pId ) {\n\t\tif ( !this.addPermissionValidate( pId ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) || this.is_viewing || this.is_mass_adding ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenu() {\n\t\t//this.selectContextMenu();\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar p_id = this.absence_model ? 'absence' : 'punch';\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tswitch ( id ) {\n\t\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t//no need reset invisible-image, inhert from default menu\n//\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\tcase ContextMenuIconName.add_punch:\n\t\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.add_absence:\n\t\t\t\t\tthis.setEditMenuAddIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setEditMenuEditIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setEditMenuViewIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setEditMenuMassEditIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setEditMenuCopyIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.drag_copy:\n\t\t\t\t\tthis.setEditMenuDragCopyIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.move:\n\t\t\t\t\tif ( !this.movePermissionValidate( p_id ) ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setEditMenuDeleteIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setEditMenuDeleteAndNextIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setEditMenuSaveAndContinueIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setEditMenuSaveAndAddIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setEditMenuSaveAndNextIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setEditMenuSaveAndCopyIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setEditMenuCopyAndAddIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.map:\n\t\t\t\t\tthis.setEditMenuMapIcon( context_btn, p_id );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.accumulated_time:\n\t\t\t\t\tthis.setDefaultMenuAccumulatedTimeIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_pay_period:\n\t\t\t\t\tthis.setDefaultMenuEditPayPeriodIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.re_calculate_timesheet:\n\t\t\t\t\tthis.setDefaultMenuReCalculateTimesheet( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.generate_pay_stub:\n\t\t\t\t\tthis.setDefaultMenuGeneratePayStubIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AddRequest':\n\t\t\t\t\tthis.setAddRequestIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\t//Ensure the proper drag&drop icons are still selected after existed from Edit Punch or Edit Absence view.\n\t\tthis.setMoveOrDropMode( ContextMenuIconName.move );\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tenableAddRequestButton() {\n\t\tvar grid_selected_id_array = this.select_cells_Array;\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tif ( grid_selected_length == 1 ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tcleanWhenUnloadView( callBack ) {\n\n\t\t$( '#timesheet_view_container' ).remove();\n\t\tsuper.cleanWhenUnloadView( callBack );\n\t}\n\n\tsetAddRequestIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( Global.getProductEdition() <= 10 || !this.addPermissionValidate( 'request' ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.enableAddRequestButton() === true ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tuserValueSet( val ) {\n\t\t//If the value here is null, the timesheet data will be missing therefore we want to force the value to the currently logged in user.\n\t\t//Mostly caused when developers switch instances or databases during testing.\n\t\tif ( typeof val == 'undefined' ) {\n\t\t\tthis.employee_nav.setValue( LocalCacheData.getLoginUser() );\n\t\t\tDebug.Text( 'ERROR: Invalid User ID in URL. Switching to current User ID.', 'TimesheetViewConroller.js', 'TimesheetViewConroller', 'userValueSet', 10 );\n\t\t}\n\t}\n\n}\n\nTimeSheetViewController.PUNCH_ROW = 1;\nTimeSheetViewController.EXCEPTION_ROW = 2;\nTimeSheetViewController.REQUEST_ROW = 3;\nTimeSheetViewController.TOTAL_ROW = 4;\nTimeSheetViewController.REGULAR_ROW = 5;\nTimeSheetViewController.ABSENCE_ROW = 6;\nTimeSheetViewController.ACCUMULATED_TIME_ROW = 7;\nTimeSheetViewController.PREMIUM_ROW = 8;\n"],"sourceRoot":""}