(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["common-EmbeddedMessageCommon"],{7664:(e,d,a)=>{"use strict";a.r(d),a.d(d,{"EmbeddedMessage":()=>t});a(5853);var t={message_control_api:null,init:function(e,d,a,t,s,i,l){var n={filter_data:{}};n.filter_data.object_type_id=d,n.filter_data.object_id=e;var o=[];this.message_control_api=TTAPI.APIMessageControl;var m=this;this.message_control_api.getEmbeddedMessage(n,{onResult:function(e){if(t&&i.from){var d=e.getResult();if(Global.isArray(d)){$(t.find(".separate")).css("display","block"),a.messages=d;var n=$("<div></div>");for(var r in d){var b=d[r];10==b.status_id&&o.push(b.id);var f=b.from_first_name+" "+b.from_last_name+" @ "+b.updated_date;i.from.setValue(f),i.subject.setValue(Global.htmlDecode(b.subject)),i.body.html(Global.htmlDecode(b.body).linkify({nl2br:!0,className:"linkified"})),i.body.setResizeEvent();var c=$(s.find("#tab_request").find(".edit-view-tab").find(".embedded-message-template")).clone();c.removeClass("embedded-message-template"),c.addClass("embedded-message-container"),c.css("display","block"),c.css("margin","0px"),c.appendTo(n)}o.length>0&&m.message_control_api.markRecipientMessageAsRead(o,{onResult:function(e){}}),$(s.find("#tab_request").find(".edit-view-tab").find(".embedded-message-column")).hide(),s.find("#tab_request").find(".edit-view-tab").find(".embedded-message-container").hide(),s.find("#tab_request").find(".edit-view-tab").find(".embedded-message-container").remove(),s.find("#tab_request").find(".edit-view-tab").append(n.html())}else $(t.find(".separate")).css("display","none");l()}}})},initUI:function(e,d){var a=d.find(".separate").css("display","none"),t=Global.loadWidgetByName(FormItemType.SEPARATED_BOX);t.SeparatedBox({label:$.i18n._("Messages")}),e.addEditFieldToColumn(null,t,a);var s=d.find(".embedded-message-template");(t=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"from",selected_able:!0}),e.addEditFieldToColumn($.i18n._("From"),t,s,""),(t=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"subject",selected_able:!0}),e.addEditFieldToColumn($.i18n._("Subject"),t,s),(t=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"body",width:600,height:400,selected_able:!0}),e.addEditFieldToColumn($.i18n._("Body"),t,s,"",null,null,!0),e.edit_view_tabs[0].push(s),s.css("display","none")},reply:function(e,d,a){this.message_control_api.setMessageControl(e,!1,d,{onResult:function(e){a&&a(e)}})}}}}]);
//# sourceMappingURL=common-EmbeddedMessageCommon.bundle.js.map?v=0704729cc16a92ec787b