{"version":3,"sources":["webpack://timetrex/./interface/html5/views/company/permission_control/PermissionControlViewController.js"],"names":["PermissionControlViewController","BaseViewController","options","_","defaults","el","level_array","user_api","permission_array","quick_search_dic","quick_search_typed_keys","quick_search_timer","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APIPermissionControl","APIUser","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","e","focus","$this","edit_view_tab_selected_index","LocalCacheData","openAwesomeBox","length","localName","a_dropdown","edit_view_ui_dic","permission","keyCode","preventDefault","getAllowMultipleSelection","onUnSelectGridDoubleClick","onSelectGridDoubleClick","target_grid","next_index","next_select_item","clearTimeout","setTimeout","Global","KEYCODES","which","getTreeMode","getFocusInSeletGrid","getSelectGrid","getUnSelectGrid","td","search_index","tds","grid","find","filter","text","toLowerCase","indexOf","unSelectAll","parent","index","jqGrid","setSelectItem","getItemByIndex","sub_log_view_controller","getSubViewFilter","parent_edit_record","id","exclude","ContextMenuIconName","mass_edit","include","label","permission_wizard","group","icon","Icons","setEditViewTabHeight","setHeight","edit_view_tab","height","context_menu_id","current_edit_record","buildAPIFormPermissionResult","type","IndexViewController","openWizard","result","action","new_permission_array","convertPermissionData","concat","removeDuplicatePermission","setValue","setSelectGridHighlight","setUnSelectGridHighlight","moveItems","getValue","new_array","each","i","inArray","push","valueOnly","arr","val_array","key","sArr","cKey","item","resItem","value","sortKey","sort","a","b","compare","initDropDownOption","getPermissionOptions","onResult","res","getResult","buildPermissionArray","widget","isSet","collectUIDataToCurrentEditRecord","setGridColumnsWidths","setEditViewDataDone","ar","items","len","select_value","buildEditViewUI","edit_view","children","eq","css","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_permission_group_column1","edit_view_tabs","form_item_input","loadWidgetByName","FormItemType","TEXT_INPUT","TTextInput","field","width","addEditFieldToColumn","COMBO_BOX","TComboBox","setSourceData","AWESOME_BOX","set_empty","AWESOME_DROPDOWN","display_columns","ALayoutCache","getDefaultColumn","convertColumnsTojGridFormat","ADropDown","display_show_all","allow_drag_to_order","display_close_btn","auto_sort","display_column_settings","default_height","addClass","setColumns","setUnselectedGridData","records","val","split","buildSearchFields","search_fields","SearchField","in_column","basic_search","adv_search","form_item_type","multiple"],"mappings":"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","file":"company-permission_control-PermissionControlViewController.bundle.js?v=5212c3e28a89cd648ce5","sourcesContent":["export class PermissionControlViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#permission_control_view_container',\n\n\n\n\t\t\tlevel_array: null,\n\t\t\tuser_api: null,\n\t\t\tpermission_array: null,\n\n\t\t\tquick_search_dic: {},\n\n\t\t\t//Save multi key typed when quick search\n\t\t\tquick_search_typed_keys: '',\n\n\t\t\t//use to juedge if need to clear quick_search_this.quick_search_typed_keyss\n\t\t\tquick_search_timer: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'PermissionControlEditView.html';\n\t\tthis.permission_id = 'permission';\n\t\tthis.viewId = 'PermissionControl';\n\t\tthis.script_name = 'PermissionControlView';\n\t\tthis.table_name_key = 'permission_control';\n\t\tthis.context_menu_name = $.i18n._( 'Permission Group' );\n\t\tthis.navigation_label = $.i18n._( 'Permission Group' ) + ':';\n\t\tthis.api = TTAPI.APIPermissionControl;\n\t\tthis.user_api = TTAPI.APIUser;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tonKeyDown( e ) {\n\t\tvar focus = $( ':focus' );\n\t\tvar $this = this;\n\n\t\tif ( this.edit_view_tab_selected_index === 0 && !LocalCacheData.openAwesomeBox &&\n\t\t\t( focus.length < 1 || focus[0].localName !== 'input' ) ) {\n\t\t\tvar a_dropdown = this.edit_view_ui_dic.permission;\n\n\t\t\tif ( e.keyCode === 39 ) { //right\n\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif ( a_dropdown.getAllowMultipleSelection() ) {\n\n\t\t\t\t\ta_dropdown.onUnSelectGridDoubleClick();\n\t\t\t\t}\n\t\t\t} else if ( e.keyCode === 37 ) { //left\n\n\t\t\t\te.preventDefault();\n\n\t\t\t\tif ( a_dropdown.getAllowMultipleSelection() ) {\n\n\t\t\t\t\ta_dropdown.onSelectGridDoubleClick();\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tif ( e.keyCode === 16 ||\n\t\t\t\t\te.keyCode === 17 ||\n\t\t\t\t\te.keyCode === 91 ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( this.quick_search_timer ) {\n\t\t\t\t\tclearTimeout( this.quick_search_timer );\n\t\t\t\t}\n\n\t\t\t\tthis.quick_search_timer = setTimeout( function() {\n\t\t\t\t\t$this.quick_search_typed_keys = '';\n\t\t\t\t}, 200 );\n\n\t\t\t\te.preventDefault();\n\t\t\t\tvar target_grid;\n\t\t\t\tvar next_index;\n\t\t\t\tvar next_select_item;\n\t\t\t\tthis.quick_search_typed_keys = this.quick_search_typed_keys + Global.KEYCODES[e.which];\n\n\t\t\t\tif ( a_dropdown.getAllowMultipleSelection() || a_dropdown.getTreeMode() ) {\n\t\t\t\t\tif ( this.quick_search_typed_keys ) {\n\t\t\t\t\t\ttarget_grid = a_dropdown.getFocusInSeletGrid() ? a_dropdown.getSelectGrid() : a_dropdown.getUnSelectGrid();\n\t\t\t\t\t\tvar search_index = this.quick_search_dic[this.quick_search_typed_keys] ? this.quick_search_dic[this.quick_search_typed_keys] : 0;\n\t\t\t\t\t\tvar tds = $( target_grid.grid.find( 'tr' ).find( 'td:eq(1)' ).filter( function() {\n\t\t\t\t\t\t\treturn $.text( [this] ).toLowerCase().indexOf( $this.quick_search_typed_keys ) == 0;\n\t\t\t\t\t\t} ) );\n\n\t\t\t\t\t\tvar td;\n\t\t\t\t\t\tif ( search_index > 0 && search_index < tds.length ) {\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsearch_index = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttd = $( tds[search_index] );\n\n\t\t\t\t\t\ta_dropdown.unSelectAll( target_grid, true );\n\n\t\t\t\t\t\tnext_index = td.parent().index() - 1;\n\t\t\t\t\t\tnext_select_item = target_grid.grid.jqGrid( 'getGridParam', 'data' )[next_index];\n\t\t\t\t\t\ta_dropdown.setSelectItem( next_select_item, target_grid );\n\t\t\t\t\t\tthis.quick_search_dic = {};\n\t\t\t\t\t\tthis.quick_search_dic[this.quick_search_typed_keys] = search_index + 1;\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tif ( this.quick_search_typed_keys ) {\n\t\t\t\t\t\tsearch_index = this.quick_search_dic[this.quick_search_typed_keys] ? this.quick_search_dic[this.quick_search_typed_keys] : 0;\n\t\t\t\t\t\ttds = $( a_dropdown.getUnSelectGrid().find( 'tr' ).find( 'td:first' ).filter( function() {\n\t\t\t\t\t\t\treturn $.text( [this] ).toLowerCase().indexOf( $this.quick_search_typed_keys ) == 0;\n\t\t\t\t\t\t} ) );\n\t\t\t\t\t\tif ( search_index > 0 && search_index < tds.length ) {\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsearch_index = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttd = $( tds[search_index] );\n\n\t\t\t\t\t\tnext_index = td.parent().index() - 1;\n\t\t\t\t\t\tnext_select_item = this.getItemByIndex( next_index );\n\t\t\t\t\t\ta_dropdown.setSelectItem( next_select_item );\n\n\t\t\t\t\t\tthis.quick_search_dic = {};\n\t\t\t\t\t\tthis.quick_search_dic[this.quick_search_typed_keys] = search_index + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetSubLogViewFilter() {\n\t\tif ( !this.sub_log_view_controller ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.sub_log_view_controller.getSubViewFilter = function( filter ) {\n\t\t\tfilter['table_name_object_id'] = {\n\t\t\t\t'permission_user': [this.parent_edit_record.id],\n\t\t\t\t'permission': [this.parent_edit_record.id],\n\t\t\t\t'permission_control': [this.parent_edit_record.id]\n\t\t\t};\n\n\t\t\treturn filter;\n\t\t};\n\n\t\treturn true;\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.mass_edit],\n\t\t\tinclude: [{\n\t\t\t\tlabel: $.i18n._( 'Permission<br>Wizard' ),\n\t\t\t\tid: ContextMenuIconName.permission_wizard,\n\t\t\t\tgroup: 'other',\n\t\t\t\ticon: Icons.permission_wizard\n\t\t\t}]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tsetEditViewTabHeight() {\n\t\tsuper.setEditViewTabHeight();\n\n\t\tvar permission_grid = this.edit_view_ui_dic.permission;\n\n\t\tpermission_grid.setHeight( ( this.edit_view_tab.height() - 325 ) );\n\t}\n\n\tonCustomContextClick( context_menu_id ) {\n\n\t\tvar $this = this;\n\n\t\t$this.current_edit_record.permission = this.buildAPIFormPermissionResult();\n\n\t\tif ( $.type( $this.current_edit_record.permission ) !== 'array' ) {\n\t\t\t$this.current_edit_record.permission = [];\n\t\t}\n\n\t\tswitch ( context_menu_id ) {\n\t\t\tcase ContextMenuIconName.permission_wizard:\n\t\t\t\tIndexViewController.openWizard( 'PermissionWizard', null, function( result, action ) {\n\t\t\t\t\tif ( result ) {\n\n\t\t\t\t\t\tswitch ( action ) {\n\t\t\t\t\t\t\tcase 'allow':\n\t\t\t\t\t\t\t\tvar new_permission_array = $this.convertPermissionData( result );\n\t\t\t\t\t\t\t\t$this.current_edit_record.permission = $this.current_edit_record.permission.concat( new_permission_array );\n\t\t\t\t\t\t\t\t$this.removeDuplicatePermission();\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setValue( $this.current_edit_record.permission );\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setSelectGridHighlight( new_permission_array );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'highlight':\n\t\t\t\t\t\t\t\tnew_permission_array = $this.convertPermissionData( result );\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setSelectGridHighlight( new_permission_array );\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setUnSelectGridHighlight( new_permission_array );\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'deny':\n\t\t\t\t\t\t\t\tnew_permission_array = $this.convertPermissionData( result );\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setSelectGridHighlight( new_permission_array );\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.moveItems( false, new_permission_array );\n\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.permission.setUnSelectGridHighlight( new_permission_array );\n\n\t\t\t\t\t\t\t\t$this.current_edit_record.permission = $this.edit_view_ui_dic.permission.getValue();\n\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t}\n\t}\n\n\tremoveDuplicatePermission() {\n\t\tvar new_array = [];\n\t\t$.each( this.current_edit_record.permission, function( i, el ) {\n\t\t\tif ( $.inArray( el, new_array ) === -1 ) {\n\t\t\t\tnew_array.push( el );\n\t\t\t}\n\t\t} );\n\n\t\tthis.current_edit_record.permission = new_array;\n\t}\n\n\tbuildPermissionArray( result, valueOnly ) {\n\n\t\tvar arr = [];\n\t\tvar val_array = [];\n\t\tvar id = 1000;\n\t\tfor ( var key in result ) {\n\t\t\tvar sArr = [];\n\t\t\tfor ( var cKey in result[key] ) {\n\t\t\t\tvar item = result[key];\n\t\t\t\tvar resItem = {};\n\t\t\t\tresItem.value = key + '->' + cKey;\n\t\t\t\tval_array.push( resItem.value );\n\t\t\t\tresItem.sortKey = key;\n\t\t\t\tresItem.label = item[cKey];\n\t\t\t\tresItem.id = resItem.value;\n\t\t\t\tsArr.push( resItem );\n\t\t\t\tid++;\n\t\t\t}\n\n\t\t\tarr = arr.concat( sArr );\n\t\t}\n\n\t\tarr.sort( function( a, b ) {\n\t\t\treturn Global.compare( a, b, 'label' );\n\t\t} );\n\n\t\tif ( !valueOnly ) {\n\t\t\treturn arr;\n\t\t} else {\n\t\t\treturn val_array;\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'level', 'level' );\n\t\tthis.api.getPermissionOptions( {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\t\t\t\tres = $this.buildPermissionArray( res );\n\t\t\t\t$this.permission_array = res;\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'permission':\n\t\t\t\t\t\tif ( this.current_edit_record.permission ) {\n\t\t\t\t\t\t\tthis.current_edit_record.permission = this.convertPermissionData( this.current_edit_record.permission );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record.permission );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.edit_view_ui_dic.permission.setGridColumnsWidths();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tconvertPermissionData( permission ) {\n\n\t\tvar result = [];\n\t\tfor ( var key in permission ) {\n\t\t\tvar ar = [];\n\t\t\tfor ( var cKey in permission[key] ) {\n\t\t\t\tif ( permission[key][cKey] === true ) {\n\t\t\t\t\tar.push( key + '->' + cKey );\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult = result.concat( ar );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildSelectItems() {\n\n\t\tvar items = [];\n\t\tvar len = this.permission_array.length;\n\n\t\tfor ( var key in this.current_edit_record.permission ) {\n\t\t\tvar select_value = this.current_edit_record.permission[key];\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = this.permission_array[i];\n\t\t\t\tif ( select_value === item.value ) {\n\t\t\t\t\titems.push( item );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tthis.edit_view.children().eq( 0 ).css( 'min-width', 1170 );\n\n\t\tvar tab_model = {\n\t\t\t'tab_permission_group': { 'label': $.i18n._( 'Permission Group' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIPermissionControl,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_permission_control',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_permission_group = this.edit_view_tab.find( '#tab_permission_group' );\n\n\t\tvar tab_permission_group_column1 = tab_permission_group.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_permission_group_column1 );\n\n\t\t//Name\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_permission_group_column1, '' );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Description\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_permission_group_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Level\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'level' } );\n\t\tform_item_input.setSourceData( $this.level_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Level' ), form_item_input, tab_permission_group_column1 );\n\n\t\t//Employee\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'user'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employees' ), form_item_input, tab_permission_group_column1, '' );\n\n\t\t//Permissions\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_DROPDOWN );\n\n\t\tvar display_columns = ALayoutCache.getDefaultColumn( 'global_option_column' ); //Get Default columns base on different layout name\n\t\tdisplay_columns = Global.convertColumnsTojGridFormat( display_columns, 'global_option_column' ); //Convert to jQgrid format\n\n\t\tform_item_input.ADropDown( {\n\t\t\tfield: 'permission',\n\t\t\tdisplay_show_all: false,\n\t\t\tid: 'permission_dropdown',\n\t\t\tkey: 'value',\n\t\t\tallow_drag_to_order: false,\n\t\t\tdisplay_close_btn: false,\n\t\t\tauto_sort: true,\n\t\t\tdisplay_column_settings: false,\n\t\t\tdefault_height: ( this.edit_view_tab.height() - 325 ),\n\t\t} );\n\t\tform_item_input.addClass( 'splayed-adropdown' );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Permissions' ), form_item_input, tab_permission_group_column1, '', null, true, true );\n\n\t\tform_item_input.setColumns( display_columns );\n\t\tform_item_input.setUnselectedGridData( this.permission_array );\n\t}\n\n\tuniformVariable( records ) {\n\n\t\trecords.permission = this.buildAPIFormPermissionResult();\n\t\treturn records;\n\t}\n\n\tbuildAPIFormPermissionResult() {\n\n\t\tvar val = this.edit_view_ui_dic.permission.getValue();\n\t\tvar permission = {};\n\n\t\tvar key = '';\n\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\tvar item = val[i].value;\n\t\t\tkey = item.split( '->' )[0];\n\n\t\t\tif ( !permission[key] ) {\n\t\t\t\tpermission[key] = {};\n\t\t\t}\n\n\t\t\tpermission[key][item.split( '->' )[1]] = true;\n\n\t\t}\n\n\t\treturn permission;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Description' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'description',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n}\n"],"sourceRoot":""}