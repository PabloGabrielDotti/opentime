(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["company-wage-WageViewController"],{2085:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"WageViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#wage_view_container",user_api:null,user_group_api:null,company_api:null,currency_api:null,type_array:null,status_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,e_province_array:null,currency:"",code:"",is_mass_adding:!1,events:{}}),super(e)}init(e){this.edit_view_tpl="WageEditView.html",this.permission_id="wage",this.script_name="WageView",this.viewId="Wage",this.table_name_key="user_wage",this.context_menu_name=$.i18n._("Wage"),this.navigation_label=$.i18n._("Wage")+":",this.document_object_type_id=110,this.api=TTAPI.APIUserWage,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.user_api=TTAPI.APIUser,this.currency_api=TTAPI.APICurrency,this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){var e=this;this.initDropDownOption("type"),this.initDropDownOption("status","",this.user_api),this.initDropDownOption("country","country",this.company_api),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),e.user_group_array=t,e.sub_view_mode||e.adv_search_field_ui_dic.group_id.setSourceData(t)}})}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.copy],include:[{label:$.i18n._("Import"),id:ContextMenuIconName.import_icon,group:"other",icon:Icons.import_icon,permission_result:PermissionManager.checkTopLevelPermission("ImportCSVWage"),permission:null,sort_order:8e3}]}}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();switch(this.current_edit_record[i]=a,i){case"type_id":this.onTypeChange(!0);break;case"user_id":$.isArray(this.current_edit_record.user_id)&&this.current_edit_record.user_id.length>1?this.is_mass_adding=!0:this.is_mass_adding=!1,this.setCurrency();break;case"wage":case"weekly_time":this.getHourlyRate()}t||this.validate()}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var n=$(this.context_menu_array[a]),s=$(n.find(".ribbon-sub-menu-icon")).attr("id");switch(n.removeClass("invisible-image"),n.removeClass("disable-image"),s){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(n,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(n,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(n,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(n,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(n,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(n,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(n,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(n,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(n,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(n,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(n,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(n,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(n,i);break;case ContextMenuIconName.login:this.setDefaultMenuLoginIcon(n,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(n,i);break;case ContextMenuIconName.import_icon:this.setDefaultMenuImportIcon(n,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(n,i)}}this.setContextMenuGroupVisibility()}}validate(){var e=this,t={};if(LocalCacheData.current_doing_context_action="validate",this.is_mass_editing)for(var i in this.edit_view_ui_dic){var a=this.edit_view_ui_dic[i];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(t[i]=a.getValue())}else Global.isArray(this.current_edit_record.user_id)&&this.current_edit_record.user_id.length>0?(t=[],$.each(this.current_edit_record.user_id,(function(i,a){var n=Global.clone(e.current_edit_record);n.user_id=a,t.push(n)}))):t=this.current_edit_record;this.api["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}setDefaultMenuImportIcon(e,t,i){}onCustomContextClick(e){switch(e){case ContextMenuIconName.import_icon:this.onImportClick()}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","UserWage",(function(){e.search()}))}doSaveAPICall(e,t,i){e=this.buildMassAddRecord(e),super.doSaveAPICall(e,t,i)}setEditMenuSaveAndContinueIcon(e,t){this.saveAndContinueValidate(e),!this.is_mass_adding&&this.current_edit_record||e.addClass("disable-image")}setEditMenuSaveAndAddIcon(e,t){this.saveAndNewValidate(e),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}setEditMenuSaveAndCopyIcon(e,t){this.saveAndContinueValidate(e),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}setEditViewData(){if(super.setEditViewData(),this.setCurrency(),!this.sub_view_mode){var e=this.edit_view_ui_dic.user_id;e&&(this.current_edit_record&&this.current_edit_record.id||this.is_mass_editing?e.setAllowMultipleSelection(!1):e.setAllowMultipleSelection(!0))}this.onTypeChange(!1)}setCurrency(){var e=this;if(Global.isSet(this.current_edit_record.user_id)){var t={};t.filter_data={user_id:this.current_edit_record.user_id},this.currency_api.getCurrency(t,!1,!1,{onResult:function(t){t=t.getResult(),Global.isArray(t)?(e.currency.text(t[0].symbol),e.code.text(t[0].iso_code)):(e.currency.text(""),e.code.text(""))}})}}getHourlyRate(){var e=this;this.current_edit_record.wage&&this.current_edit_record.weekly_time&&this.current_edit_record.type_id&&10!=this.current_edit_record.type_id&&this.api.getHourlyRate(this.current_edit_record.wage,e.edit_view_ui_dic.weekly_time.getInputValue(),this.current_edit_record.type_id,{onResult:function(t){var i=t.getResult();t.isValid()&&(e.current_edit_record.hourly_rate=i,e.edit_view_ui_dic.hourly_rate.val(i))}})}onTypeChange(e){10!=parseInt(this.current_edit_record.type_id)?(this.attachElement("weekly_time"),this.attachElement("hourly_rate"),e&&this.getHourlyRate()):(this.detachElement("weekly_time"),this.detachElement("hourly_rate"))}buildEditViewUI(){super.buildEditViewUI();var e={"tab_wage":{"label":$.i18n._("Wage")},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIUserWage,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var t,i,a,n=this.edit_view_tab.find("#tab_wage").find(".first-column");if(!this.sub_view_mode){(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"});var s={permission_section:"wage"};t.setDefaultArgs(s),this.addEditFieldToColumn($.i18n._("Employee"),t,n,"")}(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIWageGroup,allow_multiple_selection:!1,layout_name:"global_wage_group",show_search_inputs:!0,set_default:!0,field:"wage_group_id"}),this.sub_view_mode?this.addEditFieldToColumn($.i18n._("Wage Group"),t,n,""):this.addEditFieldToColumn($.i18n._("Wage Group"),t,n),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),t.setSourceData(this.type_array),this.addEditFieldToColumn($.i18n._("Type"),t,n),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"wage",width:90}),i=$("<div class='widget-h-box'></div>"),this.currency=$("<span class='widget-left-label'></span>"),this.code=$("<span class='widget-right-label'></span>"),i.append(this.currency),i.append(t),i.append(this.code),this.addEditFieldToColumn($.i18n._("Wage"),t,n,"",i),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"weekly_time",need_parser_sec:!0}),i=$("<div class='widget-h-box'></div>"),a=$("<span class='widget-right-label'>( "+$.i18n._("ie")+": "+$.i18n._("40 hours / week")+" )</span>"),i.append(t),i.append(a),this.addEditFieldToColumn($.i18n._("Average Time / Week"),t,n,"",i,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"hourly_rate"}),this.addEditFieldToColumn($.i18n._("Annual Hourly Rate"),t,n,"",null,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"labor_burden_percent",width:50}),i=$("<div class='widget-h-box'></div>"),a=$("<span class='widget-right-label'>% ( "+$.i18n._("ie")+": "+$.i18n._("25% burden")+" )</span>"),i.append(t),i.append(a),this.addEditFieldToColumn($.i18n._("Labor Burden Percent"),t,n,"",i),(t=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"effective_date",width:120}),this.addEditFieldToColumn($.i18n._("Effective Date"),t,n),(t=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:389,height:117}),this.addEditFieldToColumn($.i18n._("Note"),t,n,"",null,null,!0)}setSelectLayout(){this.sub_view_mode?super.setSelectLayout(["first_name","last_name"]):super.setSelectLayout()}setProvince(e,t){var i=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e),i.adv_search_field_ui_dic.province.setSourceData(i.province_array)}}):(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e){var t=this,i=t.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),t.e_province_array=Global.buildRecordArray(e),i.setSourceData(t.e_province_array)}}):(t.e_province_array=[],i.setSourceData([]))}onSetSearchFilterFinished(){if(1===this.search_panel.getSelectTabIndex()){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}buildSearchFields(){super.buildSearchFields();this.search_fields=[new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",default_args:{permission_section:"wage"},api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Wage Group"),in_column:1,field:"wage_group_id",layout_name:"global_wage_group",api_class:TTAPI.APIWageGroup,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Country"),in_column:3,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:3,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})]}cleanWhenUnloadView(e){$("#wage_view_container").remove(),super.cleanWhenUnloadView(e)}searchDone(){TTPromise.resolve("WageView","init"),super.searchDone()}}a.loadView=function(e){Global.loadViewSource("Wage","WageView.html",(function(t){var i={},a=_.template(t);Global.isSet(e)?e.html(a(i)):Global.contentContainer().html(a(i))}))},a.loadSubView=function(e,t,i){Global.loadViewSource("Wage","SubWageView.html",(function(a){var n=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(n({})),Global.isSet(i)&&i(sub_wage_view_controller))}))}}}]);
//# sourceMappingURL=company-wage-WageViewController.bundle.js.map?v=6ab4f50e59552649dd54