{"version":3,"sources":["webpack://timetrex/./interface/html5/views/company/hierarchy_control/HierarchyControlViewController.js"],"names":["HierarchyControlViewController","BaseViewController","options","_","defaults","el","object_type_array","editor","hierarchy_level_api","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APIHierarchyControl","APIHierarchyLevel","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","exclude","ContextMenuIconName","mass_edit","include","initDropDownOption","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","api_class","id","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_hierarchy","edit_view_tab","find","tab_hierarchy_column1","edit_view_tabs","push","form_item_input","Global","loadWidgetByName","FormItemType","TEXT_INPUT","TTextInput","field","width","addEditFieldToColumn","parent","AWESOME_BOX","set_empty","key","setSourceData","APIUser","inside_editor_div","args","level","superiors","INSIDE_EDITOR","InsideEditor","title","addRow","insideEditorAddRow","getValue","insideEditorGetValue","setValue","insideEditorSetValue","removeRow","insideEditorRemoveRow","parent_controller","render_args","row_render","append","val","len","length","removeAllRows","i","isSet","row","current_edit_record","getDefaultData","setEditViewDataDone","initInsideEditorData","$this","filter_data","hierarchy_control_id","copied_record_id","getHierarchyLevel","onResult","res","edit_view","data","getResult","index","rowIndex","remove_id","rows_widgets_array","current_edit_item","TTUUID","isUUID","zero_id","not_exist_id","delete_ids","remove","splice","removeLastRowLine","getRowRender","getRender","widgets","getField","children","eq","setWidgetEnableBaseOnParentController","user_id","insertAfter","is_viewing","hide","addIconsEvent","current_edit_item_id","result","isValid","result_data","refresh_id","saveInsideEditorData","search","onSaveDone","removeEditView","setErrorMenu","setErrorTips","onCopyAsNewClick","callBack","remove_ids","deleteHierarchyLevel","ReMapHierarchyLevels","res_data","setHierarchyLevel","re","buildSearchFields","search_fields","SearchField","label","in_column","multiple","basic_search","adv_search","form_item_type","setCurrentEditViewState","LocalCacheData","current_doing_context_action","_continueDoCopyAsNew","TAlertManager","showAlert","onCancelClick","openEditView","sub_view_mode","parent_key","parent_value","initEditView"],"mappings":"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","file":"company-hierarchy_control-HierarchyControlViewController.bundle.js?v=c15ba2f3f7ddc960c5d5","sourcesContent":["export class HierarchyControlViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#hierarchy_control_view_container',\n\n\n\n\t\t\tobject_type_array: null,\n\t\t\teditor: null,\n\n\t\t\thierarchy_level_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'HierarchyControlEditView.html';\n\t\tthis.permission_id = 'hierarchy';\n\t\tthis.viewId = 'HierarchyControl';\n\t\tthis.script_name = 'HierarchyControlView';\n\t\tthis.table_name_key = 'hierarchy_control';\n\t\tthis.context_menu_name = $.i18n._( 'Hierarchy' );\n\t\tthis.navigation_label = $.i18n._( 'Hierarchy' ) + ':';\n\t\tthis.api = TTAPI.APIHierarchyControl;\n\t\tthis.hierarchy_level_api = TTAPI.APIHierarchyLevel;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary( 'HierarchyControl' );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.mass_edit],\n\t\t\tinclude: []\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'object_type', 'object_type' );\n\t}\n\n\tbuildEditViewUI() {\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_hierarchy': { 'label': $.i18n._( 'Hierarchy' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIHierarchyControl,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_hierarchy',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_hierarchy = this.edit_view_tab.find( '#tab_hierarchy' );\n\n\t\tvar tab_hierarchy_column1 = tab_hierarchy.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_hierarchy_column1 );\n\n\t\t//Name\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_hierarchy_column1, '' );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Description\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_hierarchy_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Objects\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_option_column',\n\t\t\tshow_search_inputs: false,\n\t\t\tset_empty: true,\n\t\t\tkey: 'value',\n\t\t\tfield: 'object_type'\n\t\t} );\n\t\tform_item_input.setSourceData( $this.object_type_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Objects' ), form_item_input, tab_hierarchy_column1 );\n\n\t\t// Subordinates\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'user'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Subordinates' ), form_item_input, tab_hierarchy_column1, '' );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_hierarchy.find( '.inside-editor-div' );\n\t\tvar args = {\n\t\t\tlevel: $.i18n._( 'Level' ),\n\t\t\tsuperiors: $.i18n._( 'Superiors' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\tthis.editor.InsideEditor( {\n\t\t\ttitle: $.i18n._( 'NOTE: Level one denotes the top or last level of the hierarchy and employees at the same level share responsibilities.' ),\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tparent_controller: this,\n\t\t\trender: 'views/company/hierarchy_control/HierarchyInsideEditorRender.html',\n\t\t\trender_args: args,\n\t\t\tapi: this.hierarchy_level_api,\n\t\t\trow_render: 'views/company/hierarchy_control/HierarchyInsideEditorRow.html'\n\t\t} );\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tinsideEditorSetValue( val ) {\n\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\n\t\t\t\t\tif ( !this.parent_controller.current_edit_record.id ) { //Copy as New, clear the ID field.\n\t\t\t\t\t\trow.id = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.initInsideEditorData();\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\t\targs.filter_data.hierarchy_control_id = this.current_edit_record.id ? this.current_edit_record.id : ( this.copied_record_id ? this.copied_record_id : '' );\n\n\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id ) && !this.copied_record_id ) {\n\t\t\tthis.editor.addRow();\n\t\t} else {\n\t\t\tthis.hierarchy_level_api.getHierarchyLevel( args, true, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar data = res.getResult();\n\n\t\t\t\t\t$this.editor.setValue( data );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].current_edit_item.id;\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tthis.delete_ids.push( remove_id );\n\t\t}\n\t\trow.remove();\n\t\tthis.rows_widgets_array.splice( index, 1 );\n\t\tthis.removeLastRowLine();\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tif ( !data ) {\n\t\t\tdata = {};\n\t\t}\n\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t//Build row widgets\n\n\t\t//Level\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'level', width: 50 } );\n\t\tform_item_input.setValue( data.level ? data.level : 1 );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 0 ).append( form_item_input );\n\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t//Superiors\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\twidth: 132,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'user_id'\n\t\t} );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\tform_item_input.setValue( data.user_id ? data.user_id : '' );\n\t\trow.children().eq( 1 ).append( form_item_input );\n\n\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t} else {\n\t\t\t$( render ).append( row );\n\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t}\n\n\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\trow.find( '.control-icon' ).hide();\n\t\t}\n\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t//Save current set item\n\t\twidgets.current_edit_item = data;\n\n\t\tif ( !this.parent_controller.current_edit_record.id ) {\n\t\t\twidgets.current_edit_item.id = '';\n\t\t}\n\n\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\tthis.removeLastRowLine();\n\t}\n\n\tinsideEditorGetValue( current_edit_item_id ) {\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tvar data = { level: row.level.getValue(), user_id: row.user_id.getValue() };\n\t\t\tdata.hierarchy_control_id = current_edit_item_id;\n\t\t\tdata.id = row.current_edit_item.id ? row.current_edit_item.id : '';\n\t\t\tresult.push( data );\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search();\n\t\t\t\t$this.onSaveDone( result );\n\n\t\t\t\t$this.removeEditView();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t// onSaveAndContinueResult( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t// \t\t\t$this.refresh_id = result_data;\n\t//\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t//\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onEditClick( $this.refresh_id, true );\n\t//\n\t// \t\t\t$this.onSaveAndContinueDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t// onSaveAndNewResult: function( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onAddClick( true );\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\t\t\t$this.copied_record_id = $this.refresh_id;\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\t\t\t\t$this.onCopyAsNewClick();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\tsaveInsideEditorData( callBack ) {\n\n\t\tvar $this = this;\n\n\t\tvar data = this.editor.getValue( this.refresh_id );\n\n\t\tvar remove_ids = this.editor.delete_ids;\n\n\t\tif ( remove_ids.length > 0 ) {\n\t\t\tthis.hierarchy_level_api.deleteHierarchyLevel( remove_ids, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t$this.editor.delete_ids = [];\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tthis.hierarchy_level_api.ReMapHierarchyLevels( data, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tvar res_data = res.getResult();\n\t\t\t\t$this.hierarchy_level_api.setHierarchyLevel( res_data, {\n\t\t\t\t\tonResult: function( re ) {\n\n\t\t\t\t\t\tcallBack();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Description' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'description',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Superior' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'superior_user_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Subordinate' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Object Type' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'object_type',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\t//\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tfor ( var i = 0; i < this.editor.rows_widgets_array.length; i++ ) {\n\t\t\t\tthis.editor.rows_widgets_array[i].current_edit_item.id = '';\n\t\t\t}\n\t\t}\n\t\tsuper._continueDoCopyAsNew();\n\t}\n\n\tonCopyAsNewResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\n\t\tif ( !result_data ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t$this.onCancelClick();\n\t\t\treturn;\n\t\t}\n\n\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\tresult_data = result_data[0];\n\n\t\tthis.copied_record_id = result_data.id;\n\t\tresult_data.id = '';\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n}\n"],"sourceRoot":""}