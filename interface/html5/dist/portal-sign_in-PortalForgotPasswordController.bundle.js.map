{"version":3,"sources":["webpack://timetrex/./interface/html5/views/portal/sign_in/PortalForgotPasswordController.js"],"names":["PortalForgotPasswordController","TTBackboneView","options","_","defaults","events","super","initialize","this","api","el","Global","loadWidget","setElement","template","emailInput","$","render","$this","focus","unbind","bind","e","keyCode","sendResetEmail","append","$el","modal","on","remove","email","val","resetPassword","onResult","result","isValid","getResult","hasOwnProperty","IndexViewController","instance","router","showTipModal","i18n","showErrorAlert","details","getDetails","getDescription","error_string","isArray","each","index","error","i","key","css","tooltip","title"],"mappings":"4NAGO,MAAMA,UAAuC,EAAAC,eACnD,YAAaC,EAAU,IACtBC,EAAEC,SAAUF,EAAS,CACpBG,OAAQ,CACP,0BAA2B,oBAI7BC,MAAOJ,GAGR,WAAYA,GACXI,MAAMC,WAAYL,GAClBM,KAAKC,IAAM,iCACX,IAAIC,EAAKC,OAAOC,WAAY,kDAC5BJ,KAAKK,WAAYV,EAAEW,SAAUJ,EAAZP,IACjBK,KAAKO,WAAaP,KAAKQ,EAAG,UAC1BR,KAAKS,SAGN,SACC,IAAIC,EAAQV,KACZA,KAAKO,WAAWI,QAChBX,KAAKO,WAAWK,OAAQ,WAAYC,KAAM,WAAW,SAAUC,GAC3C,KAAdA,EAAEC,SACNL,EAAMM,oBAGRR,EAAG,QAASS,OAAQjB,KAAKkB,KACzBlB,KAAKkB,IAAIC,MAAO,CACf,QAAQ,EACR,WAAY,WAEbnB,KAAKkB,IAAIE,GAAI,mBAAmB,WAC/BV,EAAMQ,IAAIG,YAIZ,iBACC,IAAIX,EAAQV,KACRsB,EAAQtB,KAAKO,WAAWgB,MAC5BvB,KAAKC,IAAIuB,cAAeF,EAAO,CAC9BG,SAAU,SAAUC,GACbA,EAAOC,UAGGD,EAAOE,YACRC,eAAgB,gBAC7BnB,EAAMQ,IAAIC,MAAO,QACjBW,oBAAoBC,SAASC,OAAOC,aAAczB,EAAE0B,KAAKvC,EAAG,qFAL7De,EAAMyB,eAAgBT,MAY1B,eAAgBA,GACf,IAAIU,EAAUV,EAAOW,aAIfD,IACLA,EAAUV,EAAOY,kBAElB,IAAIC,EAAe,GAEdpC,OAAOqC,QAASJ,IAAgC,iBAAZA,EAExC5B,EAAEiC,KAAML,GAAS,SAAUM,EAAOnB,GAE5BA,EAAIM,eAAgB,WACxBN,EAAMA,EAAIoB,OAEX,IAAIC,EAAI,EACR,IAAM,IAAIC,KAAOtB,EAChBgB,GAA8BhB,EAAIsB,GAC7BD,EAAI,IACRL,GAAgB,QAEjBK,OAIFL,EAAeH,EAEhBpC,KAAKO,WAAWuC,IAAK,SAAU,iBAC/B9C,KAAKO,WAAWwC,QAAS,CACxBC,MAAOT,IAERvC,KAAKO,WAAWwC,QAAS","file":"portal-sign_in-PortalForgotPasswordController.bundle.js?v=321e65520b1e63fe1859","sourcesContent":["import { TTBackboneView } from '@/views/TTBackboneView';\nimport { TTAPI } from '@/services/TimeTrexClientAPI';\n\nexport class PortalForgotPasswordController extends TTBackboneView {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tevents: {\n\t\t\t\t'click .send-reset-email': 'sendResetEmail'\n\t\t\t}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\t\tthis.api = TTAPI.APIRecruitmentAuthentication;\n\t\tvar el = Global.loadWidget( 'views/portal/sign_in/PortalForgotPassword.html' );\n\t\tthis.setElement( _.template( el )() );\n\t\tthis.emailInput = this.$( '#email' );\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tthis.emailInput.focus();\n\t\tthis.emailInput.unbind( 'keydown' ).bind( 'keydown', function( e ) {\n\t\t\tif ( e.keyCode === 13 ) {\n\t\t\t\t$this.sendResetEmail();\n\t\t\t}\n\t\t} );\n\t\t$( 'body' ).append( this.$el );\n\t\tthis.$el.modal( {\n\t\t\t'show': true,\n\t\t\t'backdrop': 'static'\n\t\t} );\n\t\tthis.$el.on( 'hidden.bs.modal', function() {\n\t\t\t$this.$el.remove();\n\t\t} );\n\t}\n\n\tsendResetEmail() {\n\t\tvar $this = this;\n\t\tvar email = this.emailInput.val();\n\t\tthis.api.resetPassword( email, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t$this.showErrorAlert( result );\n\t\t\t\t} else {\n\t\t\t\t\tvar response = result.getResult();\n\t\t\t\t\tif ( response.hasOwnProperty( 'email_sent' ) ) { // make sure email if is sent successfully\n\t\t\t\t\t\t$this.$el.modal( 'hide' );\n\t\t\t\t\t\tIndexViewController.instance.router.showTipModal( $.i18n._( 'An email has been sent to you with instructions on how to change your password.' ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tshowErrorAlert( result ) {\n\t\tvar details = result.getDetails();\n\t\t// if ( details.hasOwnProperty( 'error' ) ) {\n\t\t//\n\t\t// }\n\t\tif ( !details ) {\n\t\t\tdetails = result.getDescription(); // If the details is empty, try to get description to show.\n\t\t}\n\t\tvar error_string = '';\n\n\t\tif ( Global.isArray( details ) || typeof details === 'object' ) {\n\n\t\t\t$.each( details, function( index, val ) {\n\n\t\t\t\tif ( val.hasOwnProperty( 'error' ) ) {\n\t\t\t\t\tval = val.error;\n\t\t\t\t}\n\t\t\t\tvar i = 0;\n\t\t\t\tfor ( var key in val ) {\n\t\t\t\t\terror_string = error_string + val[key];\n\t\t\t\t\tif ( i > 0 ) {\n\t\t\t\t\t\terror_string += '<br>';\n\t\t\t\t\t}\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\terror_string = details;\n\t\t}\n\t\tthis.emailInput.css( 'border', '1px solid red' );\n\t\tthis.emailInput.tooltip( {\n\t\t\ttitle: error_string\n\t\t} );\n\t\tthis.emailInput.tooltip( 'show' );\n\t}\n\n}"],"sourceRoot":""}