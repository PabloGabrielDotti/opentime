(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["my_account-expense-ExpenseAuthorizationViewController","filebrowser-TImageBrowser"],{3536:()=>{!function(e){e.fn.TImageBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a,o=e.extend({},e.fn.TImageBrowser.defaults,t),n=this,s="filedata",r="",d=177,l=42;this.setEnabled=function(e){e;var t=this.find(".browser-form input");e?(t.removeAttr("disabled"),t.removeClass("disable-element")):(t.attr("disabled",!0),t.removeClass("disable-element").addClass("disable-element"))},this.clearErrorStyle=function(){},this.getFileName=function(){return a.val()},this.getField=function(){return i},this.setEnableDelete=function(e){var t=n.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.getValue=function(){return a&&a.val()?"undefined"==typeof FormData?n.find(".browser-form"):new FormData(e(n.find(".browser-form"))[0]):null},this.getImageSrc=function(){return n.find(".image").attr("src")},this.setImage=function(e){var t=n.find(".image");if(!e)return t.attr("src",""),void t.hide();var i=new Date;t.hide(),t.attr("src",e+"&t="+i.getTime()),t.css("height","auto"),t.css("width","auto")};return this.setValue=function(e){e||(e="")},this.each((function(){var t=e.meta?e.extend({},o,e(this).data()):o;i=t.field,t.default_width>0&&(d=t.default_width),t.default_height>0&&(l=t.default_height),Global.isSet(t.name)&&(s=t.name),Global.isSet(r)&&(r=t.accept_filter),a=e(this).find(".browser");var c=e(this).find(".image");c.hide(),c.on("load",(function(){!function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,a=e(t).width()>0?e(t).width():t.naturalWidth;i>l&&e(t).css("height",l),a>d&&(e(t).css("width",d),e(t).css("height","auto")),n.trigger("setSize"),i<5?e(t).hide():e(t).show()}(this)})),r?a.attr("accept",r):(r="image/*",a.attr("accept","image/*")),a.attr("id","file_browser"),a.attr("name",s),Global.isSet(t.changeHandler)&&n.bind("imageChange",t.changeHandler),Global.isSet(t.deleteImageHandler)&&this.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),a.bind("change",(function(){if(c.hide(),"undefined"!=typeof FileReader){var e=this.files?this.files:[];if(!e.length||!window.FileReader)return;if("image/*"===r){var t=new FileReader;t.readAsDataURL(e[0]),t.onloadend=function(){var e=this.result;c.attr("src",e)}}}n.trigger("imageChange",[n])}))})),this},e.fn.TImageBrowser.defaults={}}(jQuery)},936:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"ExpenseAuthorizationViewController":()=>a});i(3536);class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#expense_authorization_view_container",hierarchy_level_array:null,status_array:null,payment_method_array:null,sub_document_view_controller:null,document_object_type_id:null,relatedExpenseArray:null,document_api:null}),super(e)}init(e){this.edit_view_tpl="ExpenseAuthorizationEditView.html",this.permission_id="user_expense",this.viewId="ExpenseAuthorization",this.script_name="ExpenseAuthorizationView",this.table_name_key="user_expense",this.context_menu_name=$.i18n._("Expense (Authorizations)"),this.navigation_label=$.i18n._("Expense")+":",this.api=TTAPI.APIUserExpense,this.message_control_api=TTAPI.APIMessageControl,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem),this.document_api=TTAPI.APIDocument,this.authorization_api=TTAPI.APIAuthorization,this.document_object_type_id=400,this.hierarchy_type_id=200,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){var e=this,t={},i={type_id:[10,20,30]};i.user_id=[this.current_edit_record?this.current_edit_record.user_id:LocalCacheData.getLoginUser().id],this.initDropDownOption("status"),this.initDropDownOption("payment_method"),t.filter_data=i,Global.isSet(e.basic_search_field_ui_dic.expense_policy_id)&&e.basic_search_field_ui_dic.expense_policy_id.setDefaultArgs(t);var a=this.api.getHierarchyLevelOptions([-1],{async:!1}).getResult();e.hierarchy_level_array=Global.buildRecordArray(a),Global.isSet(e.basic_search_field_ui_dic.hierarchy_level)&&e.basic_search_field_ui_dic.hierarchy_level.setSourceData(Global.buildRecordArray(a))}getSubViewFilter(e){return 0===e.length&&(e={}),e.parent_id=0,Global.isSet(e.hierarchy_level)||(e.hierarchy_level=1,this.filter_data.hierarchy_level={field:"hierarchy_level",id:"",value:this.basic_search_field_ui_dic.hierarchy_level.getValue(!0)}),e}getCustomContextMenuModel(){return{groups:{authorization:{label:$.i18n._("Authorization"),id:this.script_name+"Authorization"},objects:{label:$.i18n._("Objects"),id:this.script_name+"objects"}},exclude:["default"],include:[{label:$.i18n._("View"),id:ContextMenuIconName.edit,group:"editor",icon:Icons.view},{label:$.i18n._("Cancel"),id:ContextMenuIconName.cancel,group:"editor",icon:Icons.cancel},{label:$.i18n._("Authorize"),id:ContextMenuIconName.authorization,group:"authorization",icon:Icons.authorization},{label:$.i18n._("Pass"),id:ContextMenuIconName.pass,group:"authorization",icon:Icons.pass},{label:$.i18n._("Decline"),id:ContextMenuIconName.decline,group:"authorization",icon:Icons.decline},{label:$.i18n._("Request<br>Authorizations"),id:ContextMenuIconName.authorization_request,group:"objects",icon:Icons.authorization_request,permission_result:PermissionManager.checkTopLevelPermission("RequestAuthorization")},{label:$.i18n._("TimeSheet<br>Authorizations"),id:ContextMenuIconName.authorization_timesheet,group:"objects",icon:Icons.authorization_timesheet,selected:!1,permission_result:PermissionManager.checkTopLevelPermission("TimeSheetAuthorization")},{label:$.i18n._("Expense<br>Authorizations"),id:ContextMenuIconName.authorization_expense,group:"objects",icon:Icons.authorization_expense,selected:!0,permission_result:PermissionManager.checkTopLevelPermission("ExpenseAuthorization")},{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Schedule"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Export"),id:ContextMenuIconName.export_excel,group:"other",icon:Icons.export_excel,sort_order:9e3}]}}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var o=$(this.context_menu_array[a]),n=$(o.find(".ribbon-sub-menu-icon")).attr("id");switch(o.removeClass("invisible-image"),o.removeClass("disable-image"),n){case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(o,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(o,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(o,i);break;case ContextMenuIconName.authorization:this.setDefaultMenuAuthorizationIcon(o,i);break;case ContextMenuIconName.pass:this.setDefaultMenuPassIcon(o,i);break;case ContextMenuIconName.decline:this.setDefaultMenuDeclineIcon(o,i);break;case ContextMenuIconName.authorization_request:this.setDefaultMenuAuthorizationRequestIcon(o,i);break;case ContextMenuIconName.authorization_timesheet:this.setDefaultMenuAuthorizationTimesheetIcon(o,i);break;case ContextMenuIconName.authorization_expense:this.setDefaultMenuAuthorizationExpenseIcon(o,i);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(o,i,"punch");break;case ContextMenuIconName.schedule:this.setDefaultMenuViewIcon(o,i,"schedule");break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditIcon(o,i,"user");break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(o)}}this.setContextMenuGroupVisibility()}}setDefaultMenuEditIcon(e,t,i){1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuSaveIcon(e,t,i){e.addClass("invisible-image")}setDefaultMenuAuthorizationIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuPassIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuDeclineIcon(e,t,i){e.addClass("disable-image")}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");if(i.removeClass("disable-image"),this.is_mass_editing)switch(a){case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;default:i.addClass("disable-image")}else switch(a){case ContextMenuIconName.edit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.authorization:this.setEditMenuAuthorizationIcon(i);break;case ContextMenuIconName.pass:this.setEditMenuPassIcon(i);break;case ContextMenuIconName.decline:this.setEditMenuDeclineIcon(i);break;case ContextMenuIconName.authorization_request:this.setEditMenuAuthorizationRequestIcon(i);break;case ContextMenuIconName.authorization_timesheet:this.setEditMenuAuthorizationTimesheetIcon(i);break;case ContextMenuIconName.authorization_expense:this.setEditMenuAuthorizationExpenseIcon(i);break;case ContextMenuIconName.timesheet:this.setEditMenuNavViewIcon(i,"punch");break;case ContextMenuIconName.schedule:this.setEditMenuNavViewIcon(i,"schedule");break;case ContextMenuIconName.edit_employee:this.setEditMenuNavEditIcon(i,"user");break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}setDefaultMenuAuthorizationRequestIcon(e,t,i){e.removeClass("disable-image")}setDefaultMenuAuthorizationTimesheetIcon(e,t,i){e.removeClass("disable-image")}setDefaultMenuAuthorizationExpenseIcon(e,t,i){Global.getProductEdition()>=25||e.addClass("invisible-image"),e.removeClass("disable-image")}setEditMenuAuthorizationRequestIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuAuthorizationTimesheetIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuAuthorizationExpenseIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuEditIcon(e){e.addClass("disable-image")}setEditMenuSaveIcon(e){e.addClass("invisible-image")}setEditMenuAuthorizationIcon(e){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuPassIcon(e){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuDeclineIcon(e){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.authorization:this.onAuthorizationClick();break;case ContextMenuIconName.pass:this.onPassClick();break;case ContextMenuIconName.decline:this.onDeclineClick();break;case ContextMenuIconName.authorization_request:this.onAuthorizationRequestClick();break;case ContextMenuIconName.authorization_timesheet:this.onAuthorizationTimesheetClick();break;case ContextMenuIconName.authorization_expense:this.onAuthorizationExpenseClick();break;case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.edit_employee:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}onNavigationClick(e){var t,i,a=this,o={},n=[],s=[];switch(a.edit_view&&a.current_edit_record.id?(n.push(a.current_edit_record.id),s.push(a.current_edit_record.user_id),i=a.current_edit_record.incurred_date):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var o=a.getRecordFromGridById(t);n.push(o.id),s.push(o.user_id),i=o.start_date}))),e){case ContextMenuIconName.edit_employee:s.length>0&&IndexViewController.openEditView(this,$.i18n._("Employee"),s[0]);break;case ContextMenuIconName.timesheet:s.length>0&&(o.user_id=s[0],o.base_date=i,Global.addViewTab(a.viewId,$.i18n._("Authorization - Expense"),window.location.href),IndexViewController.goToView("TimeSheet",o));break;case ContextMenuIconName.schedule:o.filter_data={};var r={value:s};o.filter_data.include_user_ids=r,o.select_date=i,Global.addViewTab(this.viewId,$.i18n._("Authorization - Expense"),window.location.href),IndexViewController.goToView("Schedule",o);break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name)}}onAuthorizationExpenseClick(){IndexViewController.goToView("ExpenseAuthorization")}onAuthorizationTimesheetClick(){IndexViewController.goToView("TimeSheetAuthorization")}onAuthorizationRequestClick(){IndexViewController.goToView("RequestAuthorization")}onAuthorizationClick(){var e=this,t=this.current_edit_record;t=this.uniformVariable(t),this.api["set"+this.api.key_name](t,!1,!1,{onResult:function(t){t.isValid()?(e.is_changed=!1,e.onSaveResult(t),e.setAuthorization(!0)):(e.setErrorMenu(),e.setErrorTips(t,!0))}})}onPassClick(){var e=this;this.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Pass"})}))}onDeclineClick(){this.setAuthorization(!1)}setAuthorization(e){var t=this,i={};i.authorized=e||!1,i.object_id=t.current_edit_record.id,i.object_type_id=200,t.authorization_api.setAuthorization([i],{onResult:function(i){t.onRightArrowClick((function(){t.search();var i=e?"Authorize":"Decline";$().TFeedback({source:i})}))}})}buildEditViewUI(){super.buildEditViewUI();var e={"tab_expense":{"label":$.i18n._("Expense")},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIUserExpense,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_expense",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var t,i,a,o=this.edit_view_tab.find("#tab_expense"),n=o.find(".first-column"),s=o.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(n),this.edit_view_tabs[0].push(s),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",field:"user_id",set_empty:!1}),this.addEditFieldToColumn($.i18n._("Employee"),t,n,"",null),(t=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"incurred_date"}),this.addEditFieldToColumn($.i18n._("Date Incurred"),t,n,"",null),(t=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn($.i18n._("Description"),t,n,"",null,null,!0),t.parent().width("45%"),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"payment_method_id"}),t.setSourceData(this.payment_method_array),this.addEditFieldToColumn($.i18n._("Payment Method"),t,n);var r={},d={type_id:[10,20,30]};d.user_id=[LocalCacheData.getLoginUser().id],r.filter_data=d,(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIExpensePolicy,allow_multiple_selection:!1,layout_name:"global_expense_policy",show_search_inputs:!0,set_empty:!0,field:"expense_policy_id"}),t.setDefaultArgs(r),this.addEditFieldToColumn($.i18n._("Type"),t,n),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"gross_amount1"}),i=$("<div class='widget-h-box '></div>"),a=$("<span class='widget-right-label'> "+$.i18n._("Reimburse")+":  </span>");var l=Global.loadWidgetByName(FormItemType.CHECKBOX);if(l.TCheckbox({field:"is_reimbursable"}),i.append(t),i.append(a),i.append(l),this.addEditFieldToColumn($.i18n._("Amount"),[t,l],n,"",i),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,set_empty:!0,field:"currency_id"}),this.addEditFieldToColumn($.i18n._("Currency"),t,s,""),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn($.i18n._("Branch"),t,s),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn($.i18n._("Department"),t,s),Global.getProductEdition()>=20){(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&c.setValue(e.manual_id)},field:"job_id"}),i=$("<div class='widget-h-box'></div>");var c=Global.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),c.addClass("job-coder"),i.append(c),i.append(t),this.addEditFieldToColumn($.i18n._("Job"),[t,c],s,"",i),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&u.setValue(e.manual_id)},field:"job_item_id"}),i=$("<div class='widget-h-box'></div>");var u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),u.addClass("job-coder"),i.append(u),i.append(t),this.addEditFieldToColumn($.i18n._("Task"),[t,u],s,"",i)}(t=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:930}),this.addEditFieldToColumn($.i18n._("Tags"),t,s,"",null,null,!0);var _=o.find(".inside-editor-div"),h={name:$.i18n._("Attachment  Name"),action:$.i18n._("Action")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEditorAddRow,removeRow:this.insideEditorRemoveRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,parent_controller:this,api:this.document_api,render:"views/my_account/expense/DocumentViewInsideEditorRender.html",render_args:h,row_render:"views/my_account/expense/DocumentViewInsideEditorRow.html"}),_.append(this.editor)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Type"),in_column:1,field:"expense_policy_id",layout_name:"global_expense_policy",api_class:TTAPI.APIExpensePolicy,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!1,in_column:1,object_type_id:930,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Hierarchy Level"),in_column:2,multiple:!1,set_any:!1,field:"hierarchy_level",basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX})]}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"user_id":t.setValue(this.current_edit_record[e]),t.setEnabled(!1);break;case"gross_amount1":t.setValue(this.current_edit_record.gross_amount);break;case"gross_amount":case"net_amount":break;case"job_id":Global.getProductEdition()>=20&&t.setValue(this.current_edit_record[e]);break;case"job_item_id":if(Global.getProductEdition()>=20){var i={};i.filter_data={job_id:this.current_edit_record.job_id},t.setDefaultArgs(i),t.setValue(this.current_edit_record[e])}break;case"job_quick_search":case"job_item_quick_search":break;default:t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone();this.is_changed=!1,Global.isSet(this.current_edit_record.related_expenses)&&(this.relatedExpenseArray=this.current_edit_record.related_expenses,this.setRelatedExpense(this.current_edit_record.related_expenses)),this.initInsideEditorData(),AuthorizationHistory.init(this)}initInsideEditorData(){var e=this,t={filter_data:{}};this.current_edit_record&&this.current_edit_record.id?(t.filter_data.object_type_id=this.document_object_type_id,t.filter_data.object_id=this.current_edit_record.id,e.api.getAttachment(t,{onResult:function(t){if(e.edit_view){var i=t.getResult();e.editor.setValue(i)}}})):(e.editor.removeAllRows(),e.editor.getDefaultData())}insideEditorSetValue(e){var t=e.length;if(this.removeAllRows(),t>0){for(var i=0;i<e.length;i++)if(Global.isSet(e[i])){var a=e[i];this.addRow(a)}}else this.getDefaultData()}insideEditorGetValue(){for(var e=this.rows_widgets_array.length,t=[],i=0;i<e;i++){var a=this.rows_widgets_array[i];if(Global.isSet(a.file)){var o={name:a.name.getValue(),file:a.file.getValue()};if("No File Selected"===o.name)continue;t.push(o)}}return t}insideEditorAddRow(e,t){if(e){var i=this.getRowRender(),a=this.getRender(),o={},n=Global.loadWidgetByName(FormItemType.TEXT);if(n.TText({field:"name",width:400}),n.setValue(e.name?e.name:$.i18n._("No File Selected")),n.setClassStyle(e.name?{"font-weight":"bold"}:null),o[n.getField()]=n,i.children().eq(0).append(n),n.attr("document_id",e.id&&this.parent_controller.current_edit_record.id?e.id:""),n.attr("document_revision_id",e.document_revision_id&&this.parent_controller.current_edit_record.id?e.document_revision_id:""),e.name){var s=$("<div class='widget-h-box'></div>"),r=$("<button type='button' class=' download-button t-button widget-right-label'>"+$.i18n._("Download")+"</button>"),d=$("<button type='button' class=' view-button t-button widget-right-label'>"+$.i18n._("View")+"</button>");r.attr({document_id:e.id,document_revision_id:e.document_revision_id,object_type_id:this.parent_controller.document_object_type_id}),d.attr({document_id:e.id,document_revision_id:e.document_revision_id,object_type_id:this.parent_controller.document_object_type_id}),r.bind("click",this.parent_controller.downloadFile),d.bind("click",this.parent_controller.downloadFile),s.append(r),s.append(d),i.children().eq(1).append(s)}else{var l=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER);this.file_browser=l.TImageBrowser({field:"file",name:"filedata",accept_filter:"*",changeHandler:function(e){var t=$(this).find(".browser")[0].files[0].name;n.setValue(t)}});o[l.getField()]=l,i.children().eq(1).append(l)}void 0!==t?(i.insertAfter($(a).find("tr").eq(t)),this.rows_widgets_array.splice(t,0,o)):($(a).append(i),this.rows_widgets_array.push(o)),this.parent_controller.is_viewing&&i.find(".control-icon").hide(),this.addIconsEvent(i),this.removeLastRowLine()}else this.getDefaultData(t)}downloadFile(){var e=$(this),t=e.attr("document_id"),i=e.attr("document_revision_id"),a=e.attr("object_type_id"),o=ServiceCaller.getURLByObjectType("file_download")+"&object_type=document&parent_id="+t+"&parent_object_type_id="+a+"&object_id="+i;Global.APIFileDownload(null,null,null,o)}insideEditorRemoveRow(e){var t=this,i=e[0].rowIndex-1,a=this.rows_widgets_array[i].name.attr("document_id");TTUUID.isUUID(a)&&a!=TTUUID.zero_id&&a!=TTUUID.not_exist_id?TAlertManager.showConfirmAlert("Are you sure to "+this.rows_widgets_array[i].name.text()+"?",null,(function(o){o&&(ProgressBar.showOverlay(),t.api["delete"+t.api.key_name](a,{onResult:function(a){ProgressBar.closeOverlay(),a.isValid()&&(e.remove(),t.rows_widgets_array.splice(i,1),0===t.rows_widgets_array.length&&t.getDefaultData())}}))})):(e.remove(),t.rows_widgets_array.splice(i,1)),this.removeLastRowLine()}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),o=e.getValue();this.current_edit_record[a]=o;var n=!1;switch(a){case"expense_policy_id":case"gross_amount1":this.current_edit_record.gross_amount1=this.current_edit_record.gross_amount1?this.current_edit_record.gross_amount1:this.current_edit_record.gross_amount,this.api.calcRelatedExpenses(this.current_edit_record.expense_policy_id,this.current_edit_record.gross_amount1,n,this.current_edit_record.is_reimbursable,{onResult:function(e){i.relatedExpenseArray=e.getResult(),i.setRelatedExpense(i.relatedExpenseArray)}});break;case"is_reimbursable":this.current_edit_record.gross_amount1=this.current_edit_record.gross_amount1?this.current_edit_record.gross_amount1:this.current_edit_record.gross_amount,n=!!this.relatedExpenseArray&&this.relatedExpenseArray,this.api.calcRelatedExpenses(this.current_edit_record.expense_policy_id,this.current_edit_record.gross_amount1,n,this.current_edit_record.is_reimbursable,{onResult:function(e){i.relatedExpenseArray=e.getResult(),i.setRelatedExpense(i.relatedExpenseArray)}});break;case"amount":var s=e.attr("id");this.current_edit_record.gross_amount1=this.current_edit_record.gross_amount1?this.current_edit_record.gross_amount1:this.current_edit_record.gross_amount,this.relatedExpenseArray.taxes[s].amount=o,this.api.calcRelatedExpenses(this.current_edit_record.expense_policy_id,this.current_edit_record.gross_amount1,this.relatedExpenseArray,this.current_edit_record.is_reimbursable,{onResult:function(e){i.relatedExpenseArray=e.getResult(),i.setRelatedExpenseData(i.relatedExpenseArray,s)}});break;case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(a,o),t=!0)}t||this.validate()}setRelatedExpenseData(e,t){var i=this.edit_view_tab.find("#tab_expense").find(".third-column");i.find("#net_amount").val(e.net_amount),i.find("#gross_amount").val(e.gross_amount),i.find("#reimburse_amount").val(e.reimburse_amount);for(var a=i.find(".tax_input"),o=0;o<a.length;o++){var n=$(a[o]);if(n.length>0){var s=n.attr("id");t&&t==s||n.val(e.taxes[s].amount)}}}setRelatedExpense(e){var t=this.edit_view_tab.find("#tab_expense").find(".third-column").empty();if(this.edit_view_tabs[0].length<3&&this.edit_view_tabs[0].push(t),e||(e={net_amount:0,gross_amount:0,reimburse_amount:this.current_edit_record.reimburse_amount}),e&&e.taxes&&Object.keys(e.taxes).length>0){var i=Global.loadWidgetByName(FormItemType.TEXT_INPUT);if(i.TTextInput({field:"net_amount"}),i.setValue(e.net_amount),i.attr("id","net_amount"),i.setEnabled(!1),this.addEditFieldToColumn($.i18n._("Net Amount"),i,t,"",null,!0),this.edit_view_ui_dic.net_amount.css("opacity",1),e.taxes)for(var a in e.taxes){var o=e.taxes[a];(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"amount"}),i.setValue(o.amount),i.attr("id",o.expense_policy_id),i.addClass("tax_input"),this.addEditFieldToColumn($.i18n._(o.expense_policy_name),i,t,"",null,!0),this.edit_view_ui_dic.amount.css("opacity",1)}(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"gross_amount"}),i.setValue(e.gross_amount),i.attr("id","gross_amount"),this.addEditFieldToColumn($.i18n._("Amount"),i,t,"",null,!0),this.edit_view_ui_dic.gross_amount.css("opacity",1)}(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"reimburse_amount"}),i.setValue(e.reimburse_amount),i.attr("id","reimburse_amount"),this.addEditFieldToColumn($.i18n._("Reimburse Amount"),i,t,"",null,!0),this.edit_view_ui_dic.reimburse_amount.css("opacity",1),this.editFieldResize(0)}uniformVariable(e){return this.relatedExpenseArray&&(e.related_expenses=this.relatedExpenseArray,e.gross_amount=this.relatedExpenseArray.gross_amount,e.net_amount=this.relatedExpenseArray.net_amount,e.reimburse_amount=this.relatedExpenseArray.reimburse_amount),e}onCancelClick(e,t,i){var a=this;super.onCancelClick(e,t,(function(){i&&i(),a.search()}))}onSaveAndCopyResult(e){var t=this;if(e.isValid()){var i=e.getResult();!0===i?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.saveInsideEditorData((function(){t.search(!1),t.onCopyAsNewClick()}))}else t.setErrorTips(e),t.setErrorMenu()}onSaveResult(e){var t=this;if(e.isValid()){var i=e.getResult();!0===i?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.saveInsideEditorData((function(){t.search()}))}else t.setErrorMenu(),t.setErrorTips(e)}saveInsideEditorData(e){var t=this.editor.getValue(),i=t.length;if(i>0){var a=0;for(var o in t){var n=t[o];if(Global.isSet(n.file)){var s=this.api.addAttachment(n.name,this.document_object_type_id,this.refresh_id,{async:!1}).getResult();this.api.uploadFile(n.file,"object_type=document_revision&object_id="+s+"&parent_object_type_id="+this.document_object_type_id,{}),a++}else e()}a===i&&e()}else e()}uploadFile(e,t){var i=e.getResult();this.api.uploadFile(t,"object_type=document_revision&object_id="+i,{onResult:function(e){}})}}}}]);
//# sourceMappingURL=my_account-expense-ExpenseAuthorizationViewController.bundle.js.map?v=dd39a1da72d6e72478d2