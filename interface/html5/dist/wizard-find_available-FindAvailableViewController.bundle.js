(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["wizard-find_available-FindAvailableViewController"],{2921:(e,a,i)=>{"use strict";i.r(a),i.d(a,{"FindAvailableViewController":()=>t});class t extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#find_available_view_container",status_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,company_api:null}),super(e)}init(e){this.permission_id="user",this.viewId="FindAvailable",this.script_name="PopUpEmployeeView",this.api=TTAPI.APIScheduleAdvanced,this.company_api=TTAPI.APICompany,$(this.el).css("opacity",0),this.render(),this.initData()}initRightClickMenu(e){}showNoResultCover(e){super.showNoResultCover(!1)}setGridSize(){var e=this;this.grid.setGridWidth($(this.el).width()),this.grid.setGridHeight($(this.el).height()-this.search_panel.height()-65),$(window).off("resize").on("resize",(function(){e.grid.setGridWidth($(e.el).width()),e.grid.setGridHeight($(e.el).height()-e.search_panel.height()-65)}))}search(e,a,i){this.setGridSize(),Global.isSet(e)||(e=!0);var t=this,r={filter_data:{},filter_sort:{}};if(r.filter_columns=this.getFilterColumnsFromDisplayColumns(),r.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)r.filter_page="next"===a?this.pager_data.next_page:1;else switch(a){case"next":r.filter_page=this.pager_data.next_page;break;case"last":r.filter_page=this.pager_data.previous_page;break;case"start":r.filter_page=1;break;case"end":r.filter_page=this.pager_data.last_page_number;break;case"go_to":r.filter_page=i;break;default:r.filter_page=this.pager_data.current_page}else r.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),r.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),r.filter_sort=this.select_layout.data.filter_sort,TTUUID.isUUID(this.refresh_id)&&(r.filter_data={},r.filter_data.id=[this.refresh_id]),this.api.getScheduleAvailableUsers(r,{onResult:function(i){var r=i.getResult();if(Global.isArray(r)?(t.removeNoResultCover(),Global.isSet(t.__createRowId)&&(r=t.__createRowId(r)),r=Global.formatGridData(r,t.api.key_name)):t.showNoResultCover(),TTUUID.isUUID(t.refresh_id)){t.refresh_id=null;var l=t.grid.getData(),_=l.length;"array"!==$.type(l)&&(l=[]);for(var s=!1,n=r[0],o=0;o<_;o++){if(l[o].id==n.id){t.grid.setRowData(n.id,n),s=!0;break}}s||(l.push(n),t.grid.setData(l))}else{if(t.pager_data=i.getPagerData(),0!==LocalCacheData.paging_type&&(t.paging_widget.setPagerData(t.pager_data),t.paging_widget_2.setPagerData(t.pager_data)),0===LocalCacheData.paging_type&&"next"===a)r=t.grid.getGridParam("data").concat(r);t.grid.setData(r)}t.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&t.setDefaultMenu(!0),0===LocalCacheData.paging_type&&(!t.pager_data||t.pager_data.is_last_page?t.paging_widget.css("display","none"):t.paging_widget.css("display","block")),t.autoOpenEditViewIfNecessary(),t.searchDone()}})}searchDone(){$(".button-rotate").removeClass("button-rotate"),this.setTotalDisplaySpan(),this.setGridSize(this.ui_id,this.sub_view_mode,this.sub_view_grid_autosize,this.pager_data),TTPromise.resolve("init","init"),$(this.el).css("opacity",1)}setCurrentViewPosition(){var e=this.search_panel.find(".layout-selector-div"),a=this.search_panel.find("a[ref='saved_layout']").parent(),i=a.offset().left-(Global.bodyWidth()/2-500);e.css("left",i+a.width()+20)}initOptions(e){var a=this,i=TTAPI.APIUser,t=TTAPI.APIUserGroup,r=[{option_name:"status",field_name:null,api:i},{option_name:"sex",field_name:null,api:i},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(r,(function(i){t.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),a.edit_only_mode||!a.sub_view_mode&&a.basic_search_field_ui_dic.group_id&&(a.basic_search_field_ui_dic.group_id.setSourceData(t),a.adv_search_field_ui_dic.group_id.setSourceData(t)),a.user_group_array=t,e&&e(i)}})}))}onSetSearchFilterFinished(){if(1===this.search_panel.getSelectTabIndex()){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}setProvince(e,a){var i=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e),i.adv_search_field_ui_dic.province.setSourceData(i.province_array)}}):(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]))}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("First Name"),in_column:1,field:"first_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Last Name"),field:"last_name",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Home Phone"),field:"home_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Employee Number"),field:"employee_number",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Sex"),in_column:2,field:"sex_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Country"),in_column:1,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:1,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Title"),field:"title_id",in_column:2,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Min. Time Between Shifts"),field:"minimum_time_between_shift",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT})]}}}}]);
//# sourceMappingURL=wizard-find_available-FindAvailableViewController.bundle.js.map?v=1b49e40626098434d774