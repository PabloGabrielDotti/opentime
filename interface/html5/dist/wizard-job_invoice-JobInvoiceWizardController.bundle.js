(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["wizard-job_invoice-JobInvoiceWizardController"],{428:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"JobInvoiceWizardController":()=>s});class s extends BaseWizardController{constructor(e={}){_.defaults(e,{el:".wizard-bg"}),super(e)}init(e){this.title=$.i18n._("Job Invoice Wizard"),this.steps=3,this.current_step=1,this.render()}render(){super.render(),this.initCurrentStep()}buildCurrentStepUI(){var e=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var t=this.getLabel();t.text($.i18n._("Select one or more jobs you wish to invoice")+":");var i=this.getAComboBox(TTAPI.APIJob,!0,"global_job","job_id",!0),s=$("<div class='wizard-acombobox-div'></div>");s.append(i),this.content_div.append(t),this.content_div.append(s),this.stepsWidgetDic[this.current_step][i.getField()]=i;break;case 2:(t=this.getLabel()).text($.i18n._("Select the date range you wish to invoice jobs for")+":"),this.content_div.append(t);var a=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),r=a.find(".form-item-label"),n=a.find(".form-item-input-div"),o=this.getComboBox("time_period",!0);r.text($.i18n._("Time Period")+": "),n.append(o),this.content_div.append(a),r=(a=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),n=a.find(".form-item-input-div");var d=this.getDatePicker("start_date");r.text($.i18n._("Start Date")+": "),n.append(d),this.content_div.append(a),r=(a=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),n=a.find(".form-item-input-div");var p=this.getDatePicker("end_date");r.text($.i18n._("End Date")+": "),n.append(p),this.content_div.append(a),r=(a=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),n=a.find(".form-item-input-div");var l=this.getAComboBox(TTAPI.APIPayPeriod,!0,"global_Pay_period","pay_period_id");r.text($.i18n._("Pay Period")+": "),n.append(l),this.content_div.append(a),r=(a=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),n=a.find(".form-item-input-div");var c=this.getAComboBox(TTAPI.APIPayPeriodSchedule,!0,"global_pay_period_schedule","pay_period_schedule_id");r.text($.i18n._("Pay Period Schedule")+": "),n.append(c),this.content_div.append(a),o.bind("formItemChange",(function(t,i){e.onTimePeriodChange(i)}));var _=this.getLabel();_.text($.i18n._("Select the date to be displayed on the invoice")+":"),this.content_div.append(_);var h=this.getDatePicker("effective_date");this.content_div.append(h),this.stepsWidgetDic[this.current_step][o.getField()]=o,this.stepsWidgetDic[this.current_step][h.getField()]=h,this.stepsWidgetDic[this.current_step][d.getField()]=d,this.stepsWidgetDic[this.current_step][p.getField()]=p,this.stepsWidgetDic[this.current_step][l.getField()]=l,this.stepsWidgetDic[this.current_step][c.getField()]=c,e.onTimePeriodChange(o);break;case 3:(t=this.getLabel()).text($.i18n._("Please select invoice options")),s=$('<div style="text-align: left;margin-left: 15px;"></div>'),this.content_div.append(t);var u=e.getCheckBox("create_invoices"),g=$('<label class="wizard-checkbox-label" style="display: block;">'+$.i18n._("Create Invoices")+"</label>");g.prepend(u),s.append(g),this.stepsWidgetDic[this.current_step][u.getField()]=u,u=e.getCheckBox("include_pending_transactions"),(g=$('<label class="wizard-checkbox-label" style="display: block;">'+$.i18n._("Include all non-invoiced transactions in the same date range")+"</label>")).prepend(u),s.append(g),this.stepsWidgetDic[this.current_step][u.getField()]=u,u=e.getCheckBox("overwrite_duplicate_transactions"),(g=$('<label class="wizard-checkbox-label" style="display: block;">'+$.i18n._("Overwrite already existing duplicate transactions")+"</label>")).prepend(u),s.append(g),this.stepsWidgetDic[this.current_step][u.getField()]=u,this.content_div.append(s)}}onTimePeriodChange(e){var t=e.getValue(),i=this.stepsWidgetDic[this.current_step].start_date.parent().parent(),s=this.stepsWidgetDic[this.current_step].end_date.parent().parent(),a=this.stepsWidgetDic[this.current_step].pay_period_id.parent().parent(),r=this.stepsWidgetDic[this.current_step].pay_period_schedule_id.parent().parent();"custom_date"===t?(i.css("display","block"),s.css("display","block"),a.css("display","none"),r.css("display","none")):"custom_pay_period"===t?(i.css("display","none"),s.css("display","none"),a.css("display","block"),r.css("display","none")):"this_pay_period"===t||"last_pay_period"===t||"to_last_pay_period"===t||"to_this_pay_period"===t?(i.css("display","none"),s.css("display","none"),a.css("display","none"),r.css("display","block")):(i.css("display","none"),s.css("display","none"),a.css("display","none"),r.css("display","none"))}buildCurrentStepData(){var e=this,t=this.stepsDataDic[this.current_step],i=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:if(t)for(var s in t)t.hasOwnProperty(s)&&i[s].setValue(t[s]);else for(var s in i)i.hasOwnProperty(s)&&i[s].setValue(-1);break;case 2:TTAPI.APIJobSummaryReport.getOptions("time_period",{onResult:function(s){if(i.time_period.setSourceData(Global.buildRecordArray(s.getResult())),t)for(var a in t)t.hasOwnProperty(a)&&i[a].setValue(t[a]);else{var r=new Date;i.effective_date.setValue(r.format()),i.time_period.setValue("today")}e.onTimePeriodChange(i.time_period)}});break;case 3:if(t)for(var s in t)t.hasOwnProperty(s)&&i[s].setValue(t[s]);else for(var s in i)i.hasOwnProperty(s)&&i[s].setValue(!0);break;default:for(var s in t)t.hasOwnProperty(s)&&i[s].setValue(t[s])}}onDoneClick(){var e=this;super.onDoneClick(),this.saveCurrentStep();var t={};for(var i in t.time_period=this.stepsDataDic[2].time_period,this.stepsDataDic[2])this.stepsDataDic[2].hasOwnProperty([i])&&"time_period"!==i&&"effective_date"!==i&&(t[i]=this.stepsDataDic[2][i]);var s=this.stepsDataDic[2].effective_date,a=this.stepsDataDic[1].job_id,r={};r.create_invoices=this.stepsDataDic[3].create_invoices,r.include_pending_transactions=this.stepsDataDic[3].include_pending_transactions,r.overwrite_duplicate_transactions=this.stepsDataDic[3].overwrite_duplicate_transactions,TTAPI.APIJob.generateInvoices(t,s,a,r,{onResult:function(t){if(t.isValid()){var i=t.getAttributeInAPIDetails("user_generic_status_batch_id");i&&TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&UserGenericStatusWindowController.open(i,[LocalCacheData.getLoginUser().id])}e.onCloseClick(),e.call_back&&e.call_back()}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var e=this.stepsDataDic[this.current_step],t=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 2:for(var i in t)t.hasOwnProperty(i)&&t[i].is(":visible")&&(e[i]=t[i].getValue());break;default:for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i].getValue())}}setDefaultDataToSteps(){if(!this.default_data)return null}}}}]);
//# sourceMappingURL=wizard-job_invoice-JobInvoiceWizardController.bundle.js.map?v=e0a1986ac08b9c73af86