{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/formula_builder/FormulaBuilder.js"],"names":["$","jQuery","fn","FormulaBuilder","options","field","error_tip_box","opts","extend","defaults","$this","this","error_string","check_box","enabled","text_input","getEnabled","setEnabled","val","children","attr","addClass","removeAttr","removeClass","setCheckBox","eq","checked","isChecked","setMassEditMode","insertBefore","change","trigger","remove","setValue","setErrorStyle","errStr","show","isWarning","showErrorTip","sec","Global","isSet","loadWidgetByName","WidgetNamesDic","ERROR_TOOLTIP","ErrorTipBox","hasClass","hideErrorTip","clearErrorStyle","setField","getField","getValue","each","o","meta","data","formula_btn","text","i18n","_","unbind","bind","onFormulaBtnClick","width","indexOf","css","height","rows","style","mouseover","length","mouseout","is","focusin","LocalCacheData","current_open_sub_controller","edit_view","is_viewing","current_open_primary_controller","view_mode_message","focusout","TTPromise","wait","parents"],"mappings":"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","file":"formula_builder-FormulaBuilder.bundle.js?v=1bd219a7554bb2975a32","sourcesContent":["( function( $ ) {\n\n\t$.fn.FormulaBuilder = function( options ) {\n\t\tvar opts = $.extend( {}, $.fn.FormulaBuilder.defaults, options );\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tvar error_string = '';\n\t\tvar error_tip_box;\n\n\t\tvar mass_edit_mode = false;\n\t\tvar check_box = null;\n\n\t\tvar enabled = true;\n\n\t\tvar text_input = null;\n\n\t\tthis.getEnabled = function() {\n\t\t\treturn enabled;\n\t\t};\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\t\t\tif ( val === false || val === '' ) {\n\t\t\t\ttext_input.children().attr( 'disabled', 'true' );\n\t\t\t\ttext_input.addClass( 't-text-area-readonly' );\n\t\t\t} else {\n\t\t\t\ttext_input.children().removeAttr( 'disabled' );\n\t\t\t\ttext_input.removeClass( 't-text-area-readonly' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setCheckBox = function( val ) {\n\t\t\tif ( check_box ) {\n\t\t\t\tcheck_box.children().eq( 0 )[0].checked = val;\n\t\t\t}\n\t\t};\n\n\t\tthis.isChecked = function() {\n\t\t\tif ( check_box ) {\n\t\t\t\tif ( check_box.children().eq( 0 )[0].checked === true ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.setMassEditMode = function( val ) {\n\t\t\tmass_edit_mode = val;\n\n\t\t\tif ( mass_edit_mode ) {\n\t\t\t\tcheck_box = $( ' <div class=\"mass-edit-checkbox-wrapper\"><input type=\"checkbox\" class=\"mass-edit-checkbox\"></input>' +\n\t\t\t\t\t'<label for=\"checkbox-input-1\" class=\"input-helper input-helper--checkbox\"></label></div>' );\n\t\t\t\tcheck_box.insertBefore( text_input );\n\n\t\t\t\tcheck_box.change( function() {\n\t\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\tcheck_box.remove();\n\t\t\t\t\tcheck_box = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\n\t\t};\n\n\t\tthis.setErrorStyle = function( errStr, show, isWarning ) {\n\t\t\tif ( isWarning ) {\n\t\t\t\ttext_input.addClass( 'warning-tip' );\n\t\t\t} else {\n\t\t\t\ttext_input.addClass( 'error-tip' );\n\t\t\t}\n\t\t\terror_string = errStr;\n\n\t\t\tif ( show ) {\n\t\t\t\tthis.showErrorTip();\n\t\t\t}\n\t\t};\n\n\t\tthis.showErrorTip = function( sec ) {\n\n\t\t\tif ( !Global.isSet( sec ) ) {\n\t\t\t\tsec = 2;\n\t\t\t}\n\n\t\t\tif ( !error_tip_box ) {\n\t\t\t\terror_tip_box = Global.loadWidgetByName( WidgetNamesDic.ERROR_TOOLTIP );\n\t\t\t\terror_tip_box = error_tip_box.ErrorTipBox();\n\t\t\t}\n\t\t\tif ( text_input.hasClass( 'warning-tip' ) ) {\n\t\t\t\terror_tip_box.show( this, error_string, sec, true );\n\t\t\t} else {\n\t\t\t\terror_tip_box.show( this, error_string, sec );\n\t\t\t}\n\t\t};\n\n\t\tthis.hideErrorTip = function() {\n\n\t\t\tif ( Global.isSet( error_tip_box ) ) {\n\t\t\t\terror_tip_box.remove();\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\t\t\ttext_input.removeClass( 'error-tip' );\n\t\t\ttext_input.removeClass( 'warning-tip' );\n\t\t\tthis.hideErrorTip();\n\t\t\terror_string = '';\n\t\t};\n\n\t\tthis.setField = function( val ) {\n\t\t\tfield = val;\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn text_input.val();\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\t\t\ttext_input = $( this ).children().eq( 0 );\n\n\t\t\tvar formula_btn = $( this ).children().eq( 1 );\n\n\t\t\tformula_btn.text( $.i18n._( 'Formula Builder' ) );\n\n\t\t\tformula_btn.unbind( 'click' ).bind( 'click', function() {\n\n\t\t\t\tif ( o.onFormulaBtnClick ) {\n\t\t\t\t\to.onFormulaBtnClick();\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tif ( o.width && ( o.width > 0 || o.width.indexOf( '%' ) > 0 ) ) {\n\t\t\t\tif ( o.width.indexOf( '%' ) > 0 ) {\n\t\t\t\t\t$this.width( o.width );\n\t\t\t\t\ttext_input.css( 'width', 'calc( 100% - 115px )' );\n\t\t\t\t} else {\n\t\t\t\t\ttext_input.width( o.width );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext_input.width( 300 );\n\t\t\t}\n\t\t\tif ( o.height > 0 ) {\n\t\t\t\ttext_input.height( o.height );\n\t\t\t}\n\n\t\t\tif ( o.rows > 0 ) {\n\t\t\t\ttext_input.attr( 'rows', o.rows );\n\t\t\t} else {\n\t\t\t\ttext_input.attr( 'rows', 5 );\n\t\t\t}\n\n\t\t\tif ( o.style ) {\n\t\t\t\t$this.css( o.style );\n\t\t\t}\n\n\t\t\ttext_input.change( function() {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\t$this.setCheckBox( true );\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t} );\n\n\t\t\ttext_input.mouseover( function() {\n\n\t\t\t\tif ( enabled ) {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\ttext_input.mouseout( function() {\n\t\t\t\tif ( !$( $this ).is( ':focus' ) ) {\n\t\t\t\t\t$this.hideErrorTip();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusin( function() {\n\t\t\t\tif ( !enabled ) {\n\t\t\t\t\tif ( !check_box ) {\n\t\t\t\t\t\tif ( LocalCacheData.current_open_sub_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = Global.view_mode_message;\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t} else if ( LocalCacheData.current_open_primary_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = Global.view_mode_message;\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusout( function() {\n\t\t\t\t$this.hideErrorTip();\n\t\t\t} );\n\n\t\t\t//Prevent missing formula input box from appearing during first load.\n\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\ttext_input.parents( '.formula-builder' ).css( 'opacity', 1 );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.FormulaBuilder.defaults = {};\n\n} )( jQuery );"],"sourceRoot":""}