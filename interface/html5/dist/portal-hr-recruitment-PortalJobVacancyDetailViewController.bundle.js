(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["portal-hr-recruitment-PortalJobVacancyDetailViewController","portal-hr-recruitment-PortalJobVacancyDetailController","filebrowser-TImageBrowser"],{3807:e=>{var t,i,a,r=(t=jQuery,i={detectionDivs:{bootstrap:{xs:t('<div class="device-xs visible-xs visible-xs-block"></div>'),sm:t('<div class="device-sm visible-sm visible-sm-block"></div>'),md:t('<div class="device-md visible-md visible-md-block"></div>'),lg:t('<div class="device-lg visible-lg visible-lg-block"></div>')},foundation:{small:t('<div class="device-xs show-for-small-only"></div>'),medium:t('<div class="device-sm show-for-medium-only"></div>'),large:t('<div class="device-md show-for-large-only"></div>'),xlarge:t('<div class="device-lg show-for-xlarge-only"></div>')}},applyDetectionDivs:function(){t(document).ready((function(){t.each(a.breakpoints,(function(e){a.breakpoints[e].appendTo(".responsive-bootstrap-toolkit")}))}))},isAnExpression:function(e){return"<"==e.charAt(0)||">"==e.charAt(0)},splitExpression:function(e){var t=e.charAt(0),i="="==e.charAt(1),a=1+(i?1:0);return{operator:t,orEqual:i,breakpointName:e.slice(a)}},isAnyActive:function(e){var i=!1;return t.each(e,(function(e,t){return a.breakpoints[t].is(":visible")?(i=!0,!1):void 0})),i},isMatchingExpression:function(e){var t=i.splitExpression(e),r=Object.keys(a.breakpoints),o=r.indexOf(t.breakpointName);if(-1!==o){var n=0,s=0;"<"==t.operator&&(n=0,s=t.orEqual?++o:o),">"==t.operator&&(n=t.orEqual?o:++o,s=void 0);var l=r.slice(n,s);return i.isAnyActive(l)}}},a={interval:300,framework:null,breakpoints:null,is:function(e){return i.isAnExpression(e)?i.isMatchingExpression(e):a.breakpoints[e]&&a.breakpoints[e].is(":visible")},use:function(e,t){a.framework=e.toLowerCase(),"bootstrap"===a.framework||"foundation"===a.framework?a.breakpoints=i.detectionDivs[a.framework]:a.breakpoints=t,i.applyDetectionDivs()},current:function(){var e="unrecognized";return t.each(a.breakpoints,(function(t){a.is(t)&&(e=t)})),e},changed:function(e,t){var i;return function(){clearTimeout(i),i=setTimeout((function(){e()}),t||a.interval)}}},t(document).ready((function(){t('<div class="responsive-bootstrap-toolkit"></div>').appendTo("body")})),null===a.framework&&a.use("bootstrap"),a);e.exports&&(e.exports=r)},3536:()=>{!function(e){e.fn.TImageBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a,r=e.extend({},e.fn.TImageBrowser.defaults,t),o=this,n="filedata",s="",l=177,c=42;this.setEnabled=function(e){e;var t=this.find(".browser-form input");e?(t.removeAttr("disabled"),t.removeClass("disable-element")):(t.attr("disabled",!0),t.removeClass("disable-element").addClass("disable-element"))},this.clearErrorStyle=function(){},this.getFileName=function(){return a.val()},this.getField=function(){return i},this.setEnableDelete=function(e){var t=o.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.getValue=function(){return a&&a.val()?"undefined"==typeof FormData?o.find(".browser-form"):new FormData(e(o.find(".browser-form"))[0]):null},this.getImageSrc=function(){return o.find(".image").attr("src")},this.setImage=function(e){var t=o.find(".image");if(!e)return t.attr("src",""),void t.hide();var i=new Date;t.hide(),t.attr("src",e+"&t="+i.getTime()),t.css("height","auto"),t.css("width","auto")};return this.setValue=function(e){e||(e="")},this.each((function(){var t=e.meta?e.extend({},r,e(this).data()):r;i=t.field,t.default_width>0&&(l=t.default_width),t.default_height>0&&(c=t.default_height),Global.isSet(t.name)&&(n=t.name),Global.isSet(s)&&(s=t.accept_filter),a=e(this).find(".browser");var d=e(this).find(".image");d.hide(),d.on("load",(function(){!function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,a=e(t).width()>0?e(t).width():t.naturalWidth;i>c&&e(t).css("height",c),a>l&&(e(t).css("width",l),e(t).css("height","auto")),o.trigger("setSize"),i<5?e(t).hide():e(t).show()}(this)})),s?a.attr("accept",s):(s="image/*",a.attr("accept","image/*")),a.attr("id","file_browser"),a.attr("name",n),Global.isSet(t.changeHandler)&&o.bind("imageChange",t.changeHandler),Global.isSet(t.deleteImageHandler)&&this.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),a.bind("change",(function(){if(d.hide(),"undefined"!=typeof FileReader){var e=this.files?this.files:[];if(!e.length||!window.FileReader)return;if("image/*"===s){var t=new FileReader;t.readAsDataURL(e[0]),t.onloadend=function(){var e=this.result;d.attr("src",e)}}}o.trigger("imageChange",[o])}))})),this},e.fn.TImageBrowser.defaults={}}(jQuery)},86:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"PortalJobVacancyDetailController":()=>p});var a=i(3807),r=i.n(a),o=i(97),n=i(7526),s=(i(3536),i(12)),l=i(4936),c=i(7575),d=i.n(c);i(6890),i(1768),i(2682),i(5209);class p extends o.PortalBaseViewController{constructor(e={}){_.defaults(e,{edit_view_error_ui_dic:{},events:{"click #applyBtn":"onApplyJobClick","click #available_jobs":"availableJobsClick","click #applied_jobs":"appliedJobsClick","click #applied_btn":"appliedJobsClick","click .sign-in":"signIN"}}),super(e)}init(){this.viewId="PortalJobVacancyDetail",this.script_name="JobVacancyDetailView",this.job_applicant_api=n.y.APIJobApplicantPortal,this.viewport=$.extend({},r()),this.render()}render(){var e=this;LocalCacheData.getPortalLoginUser()?this.setRegisterContainerStatus((function(t){e.showJobVacancy({applied:t})})):this.showJobVacancy()}showJobVacancy(e){var t=this,i=Global.loadWidget("views/portal/hr/recruitment/PortalJobVacancyDetail.html"),a={first_name:"",last_name:"",email:"",applied:!1};for(var r in LocalCacheData.getPortalLoginUser()&&(a={first_name:LocalCacheData.getPortalLoginUser().first_name,last_name:LocalCacheData.getPortalLoginUser().last_name,email:LocalCacheData.getPortalLoginUser().email}),Global.isSet(e)&&Global.isSet(e.applied)&&(a.applied=e.applied),this.model.attributes)0==this.model.get(r)&&this.model.set(r,"");if(this.$el.html(_.template(i)($.extend(a,this.model.toJSON()))),!_.isUndefined($(".tinymce-textarea")[0]))var o=setInterval((function(){var e=$(".tinymce-textarea").find("iframe").height(),t=$(".tinymce-textarea").find("iframe").contents().find("body").height();_.isUndefined($(".job-detail-summary-description")[0])?($(".tinymce-textarea").find("iframe").contents().find("body").css({"background-color":"#F6F6F6","font-size":"14px","margin-top":0,"color":"#404042"}),$(".tinymce-textarea").find("iframe").contents().find("body p:first-child").css("margin-top",0)):($(".tinymce-textarea").find("iframe").contents().find("body").css({"margin":0,"background-color":"#E8E8E8","font-size":"14px","margin-top":0,"color":"#404042"}),$(".tinymce-textarea").find("iframe").contents().find("body p:first-child").css("margin-top",0)),e>t&&(clearInterval(o),$(".tinymce-textarea").find("iframe").css("height",t))}),50);this.$('input[type="text"], input[type="email"]').each((function(){$(this).unbind("focus").bind("focus",(function(){$(this).parent().addClass("job-apply-form-focus")}))})),this.$('input[type="text"], input[type="email"]').each((function(){$(this).unbind("blur").bind("blur",(function(){$(this).parent().removeClass("job-apply-form-focus")}))})),this.setDetailAndApplyFormHeight(),$(window).resize(t.viewport.changed((function(){t.setDetailAndApplyFormHeight()}))),this.uploader=this.$(".register-resume").TImageBrowser({field:"file",name:"filedata",accept_filter:"*",changeHandler:function(e){var i=$(this).find(".browser")[0].files[0].name;t.$(".apply-form #file_name").val(i)}});var n,s=d().editors;for(n in s)s.hasOwnProperty(n)&&s[n].remove();tinymce.init({plugins:"autoresize, link",readonly:!0,selector:"#description",menubar:!1,statusbar:!1,toolbar:!1,theme:"silver",skin_url:"../../dist/tinymce-skins/ui/oxide",content_css:"../../dist/tinymce-skins/content/default/content.css"})}setDetailAndApplyFormHeight(){var e=this.$(".job-header").height(),t=this.$(".job-apply").height();this.viewport.is("md")||this.viewport.is(">md")?e!==t&&(e>t?this.$(".job-apply").height(e-20):this.$(".job-header").height(t+20)):this.viewport.is("<=sm")&&this.$(".job-apply").height(70)}onApplyJobClick(){var e=this;LocalCacheData.getPortalLoginUser()?this.getJobApplication((function(t){if(t.isValid()){var i=t.getResult();if(Global.isArray(i)||(i=[]),i.length>0){var a=Global.getBaseURL()+"#!m=MyProfile&company_id="+LocalCacheData.getAllURLArgs().company_id;window.location=a}else e.uploadResume(),e.saveCurrentJobVacancy()}})):this.registerNewUser((function(t,i){n.y.APIRecruitmentAuthentication.Login(t,i,{onResult:function(t){e.onLoginSuccess(t)}})}))}availableJobsClick(){window.location=Global.getBaseURL()+"#!m=PortalJobVacancy&company_id="+LocalCacheData.getAllURLArgs().company_id,LocalCacheData.setAllURLArgs({})}appliedJobsClick(){window.location=Global.getBaseURL()+"#!m=MyJobApplication&company_id="+LocalCacheData.getAllURLArgs().company_id,LocalCacheData.setAllURLArgs({})}signIN(){new SignInController({_delegate:this})}onLoginSuccess(e,t){var i,a=this;i=t||e.getResult(),s.n.cancel_all_error=!1,LocalCacheData.setSessionID(i),setCookie(Global.getSessionIDKey(),i),n.y.APIJobApplicantPortal.getJobApplicant({onResult:function(e){e.isValid()?(LocalCacheData.setPortalLoginUser(e.getResult()[0]),IndexViewController.instance.router.headerView.render(),a.uploadResume(),a.saveCurrentJobVacancy()):ProgressBar.closeOverlay()}})}setRegisterContainerStatus(e){this.getJobApplication((function(t){var i=!1;if(t.isValid()){var a=t.getResult();Global.isArray(a)||(a=[]),a.length>0&&(i=!0)}e(i)}))}getJobApplication(e){var t={filter_data:{}};t.filter_data.job_vacancy_id=this.model.id,this.job_applicant_api.getJobApplication(t,{onResult:function(t){e(t)}})}saveCurrentJobVacancy(e){var t=this,i={};i.job_vacancy_id=this.model.id,this.job_applicant_api.setJobApplication(i,{onResult:function(e){e.isValid()?t.render():t.showValidateErrorTips(e)}})}showAlert(e){IndexViewController.instance.router.showTipModal(e,{style:{"border":"2px solid #154575","color":"#154575"}})}uploadResume(){if(!this.uploader)return!1;var e=this.uploader,t=(e.attr("file_name"),e.getValue());if(t){this.document_api=n.y.APIDocumentPortal;var i="Resume - "+this.$('.apply-form input[id="first_name"]').val()+" "+this.$('.apply-form input[id="last_name"]').val(),a=this.document_api.addAttachment(i,"",{async:!1}).getResult().document_revision_id;this.uploadFile(t,a)}else this.applySuccess()}applySuccess(){var e=Global.getBaseURL()+"#!m=MyProfile&company_id="+LocalCacheData.getAllURLArgs().company_id,t=$("<div>");t.append("<p>"+$.i18n._("Application sent successfully!")+"</p>"),t.append("<p>"+$.i18n._("Please ensure that your profile is accurate and complete.")+"</p>"),this.showAlert(t),window.location=e}uploadFile(e,t){var i=this,a=s.n.getAPIURL("Class="+this.document_api.className+"&Method=uploadAttachment&v=2");LocalCacheData.getAllURLArgs().company_id&&(a=a+"&company_id="+LocalCacheData.getAllURLArgs().company_id),a=a+"&object_id="+t;var r=l.d.generateUUID();ProgressBar.showProgressBar(r),ProgressBar.changeProgressBarMessage("File Uploading"),$.ajax({url:a,headers:{"X-Client-ID":"Browser-TimeTrex","X-CSRF-Token":getCookie("CSRF-Token")},type:"POST",data:e,success:function(e){ProgressBar.removeProgressBar(),""==e.error&&i.applySuccess()},cache:!1,contentType:!1,processData:!1})}registerNewUser(e){var t=this,i={};if(i.first_name=this.$('.apply-form input[id="first_name"]').val(),i.last_name=this.$('.apply-form input[id="last_name"]').val(),i.user_name=this.$('.apply-form input[id="email"]').val(),i.email=i.user_name,i.password=Math.random().toString(36).replace(/[^a-z0-9]+/g,""),i.company_id=LocalCacheData.getAllURLArgs().company_id,this.$('.apply-form input[id="email"]').val()===this.$('.apply-form input[id="confirm_email"]').val()){if(this.edit_view_error_ui_dic.hasOwnProperty("confirm_email")&&(this.edit_view_error_ui_dic.confirm_email.removeClass("error-tip"),this.edit_view_error_ui_dic.confirm_email.tooltip().qtip("destroy")),""!=i.first_name&&""!=i.last_name&&""!=i.email&&!this.uploader.getValue())return void IndexViewController.instance.router.showConfirmModal($.i18n._("Are you sure you want to apply for this position without uploading a resume?"),{title:"",actions:[{label:"No",isClose:!0,callBack:function(e){}},{label:"Yes",callBack:function(a){IndexViewController.instance.router.hideConfirmModal(),t.setJobApplicant(i,e)}}]});this.setJobApplicant(i,e)}else{this.removeValidateErrorTips();var a=this.$(".apply-form").find('input[id="confirm_email"]');a.addClass("error-tip"),a.tooltip({"title":$.i18n._("Confirm email does not match email")}),a.tooltip("show"),this.edit_view_error_ui_dic.confirm_email=a}}setJobApplicant(e,t){var i=this;this.job_applicant_api.setJobApplicant(e,{onResult:function(a){a.isValid()?(i.removeValidateErrorTips(),i.edit_view_error_ui_dic={},t(e.user_name,e.password)):i.showValidateErrorTips(a)}})}showValidateErrorTips(e,t){var i=e.getDetails();i||(i=e.getDescription());var a=this;return(Global.isArray(i)||"object"==typeof i)&&(this.removeValidateErrorTips(),$.each(i,(function(e,t){for(var i in t.hasOwnProperty("error")&&(t=t.error),t)if(t.hasOwnProperty(i)){var r="";"user_name"===i&&(i="email",r=$.i18n._("Email address already exists, please login instead"));var o=null;(o=a.$(".apply-form").find('input[id="'+i+'"]')[0]?a.$(".apply-form").find('input[id="'+i+'"]'):a.$(".apply-form"))&&(o.addClass("error-tip"),r||(r=_.isArray(t[i])?t[i][0]:t[i]),o.attr({"title":r,"data-original-title":r}),o.tooltip("show"),a.edit_view_error_ui_dic[i]=o)}}))),!1}removeValidateErrorTips(){for(var e in this.edit_view_error_ui_dic)"email"!==e&&"confirm_email"!==e&&""!==this.edit_view_error_ui_dic[e].val()&&(this.edit_view_error_ui_dic[e].removeClass("error-tip"),this.edit_view_error_ui_dic[e].tooltip().qtip("destroy",!0))}}},5246:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"PortalJobVacancyDetailViewController":()=>s});var a=i(97),r=i(7526),o=i(86),n=i(1748);class s extends a.PortalBaseViewController{constructor(e={}){_.defaults(e,{el:".job-vacancy-detail-view",api:null}),super(e)}init(){this.script_name="JobVacancyDetailView",this.api=r.y.APIJobVacancyPortal,this.job_detail_panel=this.$(".search-result"),this.job_detail_panel.empty(),this.render()}render(){ProgressBar.showOverlay(),this.search()}search(){var e=this,t={filter_data:{}};LocalCacheData.edit_id_for_next_open_view&&(this.view_id=LocalCacheData.edit_id_for_next_open_view,t.filter_data.id=[this.view_id],ProgressBar.showOverlay(),this.api.getJobVacancy(t,{onResult:function(t){var i=t.getResult();if(i||(i=[]),i=i[0]){var a=new Backbone.Model(i),r=new o.PortalJobVacancyDetailController({model:a,el:e.$el});n.g.instance.router.headerView.jobVacancyDetailController=r}}}),LocalCacheData.edit_id_for_next_open_view=null)}goPortalLogin(){if(window.location.href===Global.getBaseURL()+"#!m=PortalJobVacancy")n.g.instance.router.reloadView("PortalJobVacancy");else{var e=Global.getBaseURL()+"#!m=PortalJobVacancy";if(LocalCacheData.getAllURLArgs().company_id){for(var t in LocalCacheData.getAllURLArgs())"m"!==t&&(e=e+"&"+t+"="+LocalCacheData.getAllURLArgs()[t]);window.location=e}}}}},5209:(e,t,i)=>{i(8578)},8578:()=>{!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Delay"),a=function(e){return e.getParam("min_height",e.getElement().offsetHeight,"number")},r=function(e,t,a,o,n){i.setEditorTimeout(e,(function(){s(e,t),a--?r(e,t,a,o,n):n&&n()}),o)},o=function(e,t){var i=e.getBody();i&&(i.style.overflowY=t?"":"hidden",t||(i.scrollTop=0))},n=function(e,t,i,a){var r=parseInt(e.getStyle(t,i,a),10);return isNaN(r)?0:r},s=function(e,i){var r=e.dom,l=e.getDoc();if(l)if(function(e){return e.plugins.fullscreen&&e.plugins.fullscreen.isFullscreen()}(e))o(e,!0);else{var c=l.documentElement,d=function(e){return e.getParam("autoresize_bottom_margin",50,"number")}(e),p=a(e),u=n(r,c,"margin-top",!0),h=n(r,c,"margin-bottom",!0),m=c.offsetHeight+u+h+d;m<0&&(m=0);var f=e.getContainer().offsetHeight-e.getContentAreaContainer().offsetHeight;m+f>a(e)&&(p=m+f);var g=function(e){return e.getParam("max_height",0,"number")}(e);if(g&&p>g?(p=g,o(e,!0)):o(e,!1),p!==i.get()){var v=p-i.get();if(r.setStyle(e.getContainer(),"height",p+"px"),i.set(p),function(e){e.fire("ResizeEditor")}(e),t.browser.isSafari()&&t.mac){var b=e.getWin();b.scrollTo(b.pageXOffset,b.pageYOffset)}e.hasFocus()&&e.selection.scrollIntoView(e.selection.getNode()),t.webkit&&v<0&&s(e,i)}}};e.add("autoresize",(function(e){if(e.settings.hasOwnProperty("resize")||(e.settings.resize=!1),!e.inline){var t=(i=0,{get:function(){return i},set:function(e){i=e}});!function(e,t){e.addCommand("mceAutoResize",(function(){s(e,t)}))}(e,t),function(e,t){e.on("init",(function(){var t=function(e){return e.getParam("autoresize_overflow_padding",1,"number")}(e),i=e.dom;i.setStyles(e.getDoc().documentElement,{height:"auto"}),i.setStyles(e.getBody(),{"paddingLeft":t,"paddingRight":t,"min-height":0})})),e.on("NodeChange SetContent keyup FullscreenStateChanged ResizeContent",(function(){s(e,t)})),function(e){return e.getParam("autoresize_on_init",!0,"boolean")}(e)&&e.on("init",(function(){r(e,t,20,100,(function(){r(e,t,5,1e3)}))}))}(e,t)}var i}))}()}}]);
//# sourceMappingURL=portal-hr-recruitment-PortalJobVacancyDetailViewController.bundle.js.map?v=8c50addda825a240af98