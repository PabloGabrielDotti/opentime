{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/ribbon/RibbonViewController.js"],"names":["RibbonViewController","TTBackboneView","options","_","defaults","el","user_api","subMenuNavMap","super","initialize","TopMenuManager","ribbon_view_controller","this","render","e","ui","target","id","$this","sub_menu","LocalCacheData","openRibbonNaviMenu","attr","close","items","get","box","$","i","length","item","item_node","append","unbind","click","onReportMenuClick","RibbonSubMenuNavWidget","showNavItems","Global","parent_view","current_open_edit_only_controller","current_open_primary_controller","IndexViewController","openReport","TAlertManager","showAlert","setSelectSubMenu","openSelectView","ribbon_menu_array","ribbon_menus","ribbon_menu_label_node","ribbon_menu_root_node","len","ribbon_menu","ribbon_menu_group_array","ribbon_menu_ui","len1","x","ribbon_menu_group","ribbon_sub_menu_array","sub_menu_ui_nodes","ribbon_menu_group_ui","len2","y","ribbon_sub_menu","sub_menu_ui_node","RibbonSubMenuType","NAVIGATION","children","eq","addClass","find","onSubMenuNavClick","onSubMenuClick","setRibbonMenuVisibility","tab_array","menu_id","parent","hide","buildRibbonMenus","tabs","setSelectMenu","selected_menu_id","selected_sub_menu_id","ServiceCaller","getURLByObjectType","getLoginUserPreference","bind","goToView","name","index","openWizard","search","PermissionManager","checkTopLevelPermission","viewId","setEditMenu","openEditView","doLogout","doPortalLogout","url","getLoginData","application_version","window","open","location","href","APIGlobal","pre_login_data","support_email","getCurrentCompany","registration_key","user","getLoginUser","user_name","openWizardController","onCancelClick","TTPromise","wait","removeClass","i18n","current_user_api","TTAPI","APIAuthentication","Logout","analytics_enabled","ga","clearTimeout","lh_inst","timeoutStatuscheck","showBrowserTopBanner","css","result","template","html"],"mappings":"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","file":"ribbon-RibbonViewController.bundle.js?v=8e39e22a9b8554f3a889","sourcesContent":["import { TTBackboneView } from '@/views/TTBackboneView';\nimport { Global } from '@/global/Global';\n\nexport class RibbonViewController extends TTBackboneView {\n\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#ribbon_view_container', //Must set el here and can only set string, so events can work\n\t\t\tuser_api: null,\n\t\t\tsubMenuNavMap: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\n\t\t// TopMenuManager should be initialized before render to avoid possible race condition.\n\t\t// Error: TypeError: TopMenuManager.ribbon_view_controller is null in /interface/html5/framework/jquery.min.js?v=10.5.0-20170331-081453 line 2 > eval line 218\n\n\t\tTopMenuManager.ribbon_view_controller = this;\n\t\tvar $this = this;\n\n\t\t$this.render();\n\t}\n\n\tonMenuSelect( e, ui ) {\n\t\treturn;\n\t\t// No longer used because we only support a single context menu now.\n\t\t// if ( TopMenuManager.selected_menu_id && TopMenuManager.selected_menu_id.indexOf( 'ContextMenu' ) >= 0 ) {\n\t\t// \t$( '.context-menu-active' ).removeClass( 'context-menu-active' );\n\t\t// }\n\t\t// TopMenuManager.selected_menu_id = $( e.currentTarget ).attr( 'ref' );\n\t\t// if ( TopMenuManager.selected_menu_id && TopMenuManager.selected_menu_id.indexOf( 'ContextMenu' ) >= 0 ) {\n\t\t// \t$( e.target ).parent().addClass( 'context-menu-active' );\n\t\t// }\n\t}\n\n\tonSubMenuNavClick( target, id ) {\n\t\tvar $this = this;\n\t\tvar sub_menu = this.subMenuNavMap[id];\n\t\tif ( LocalCacheData.openRibbonNaviMenu ) {\n\n\t\t\tif ( LocalCacheData.openRibbonNaviMenu.attr( 'id' ) === 'sub_nav' + id ) {\n\t\t\t\tLocalCacheData.openRibbonNaviMenu.close();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tLocalCacheData.openRibbonNaviMenu.close();\n\t\t\t}\n\t\t}\n\t\tshowNavItems();\n\n\t\tfunction showNavItems() {\n\t\t\tvar items = sub_menu.get( 'items' );\n\t\t\tvar box = $( '<ul id=\\'sub_nav' + id + '\\' class=\\'ribbon-sub-menu-nav\\'> </ul>' );\n\t\t\tfor ( var i = 0; i < items.length; i++ ) {\n\t\t\t\tvar item = items[i];\n\t\t\t\tvar item_node = $( '<li class=\\'ribbon-sub-menu-nav-item\\' id=\\'' + item.get( 'id' ) + '\\'><span class=\\'label\\'>' + item.get( 'label' ) + '</span></li>' );\n\t\t\t\tbox.append( item_node );\n\n\t\t\t\titem_node.unbind( 'click' ).click( function() {\n\n\t\t\t\t\tvar id = $( this ).attr( 'id' );\n\t\t\t\t\t$this.onReportMenuClick( id );\n\t\t\t\t} );\n\t\t\t}\n\t\t\tbox = box.RibbonSubMenuNavWidget();\n\t\t\tLocalCacheData.openRibbonNaviMenu = box;\n\t\t\t$( target ).append( box );\n\t\t}\n\n\t}\n\n\tonReportMenuClick( id ) {\n\t\tGlobal.closeEditViews( function() {\n\t\t\tif ( id === 'AffordableCareReport' && !( Global.getProductEdition() >= 15 ) ) {\n\t\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\t} else {\n\t\t\t\tvar parent_view = LocalCacheData.current_open_edit_only_controller ? LocalCacheData.current_open_edit_only_controller : LocalCacheData.current_open_primary_controller;\n\t\t\t\tIndexViewController.openReport( parent_view, id );\n\t\t\t}\n\t\t} );\n\n\t}\n\n\t//FIXME: Stops punch inout from being able to exit via the menu system except on items with dropdowns\n\t//Does not trigger on Report menu items with dropdowns (see the right event)\n\tonSubMenuClick( id ) {\n\t\tvar $this = this;\n\t\t//#2342 see onCancelClick in BaseViewController and Gloabl.closeEditViews.\n\n\t\tGlobal.closeEditViews( function() {\n\t\t\t$this.setSelectSubMenu( id );\n\t\t\t$this.openSelectView( id );\n\t\t} );\n\t}\n\n\tbuildRibbonMenus() {\n\t\tvar $this = this;\n\t\tthis.subMenuNavMap = {};\n\t\tvar ribbon_menu_array = TopMenuManager.ribbon_menus;\n\t\tvar ribbon_menu_label_node = $( '.ribbonTabLabel' );\n\t\tvar ribbon_menu_root_node = $( '.ribbon' );\n\n\t\tvar len = ribbon_menu_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\n\t\t\tvar ribbon_menu = ribbon_menu_array[i];\n\n\t\t\tif ( ribbon_menu.get( 'permission_result' ) === false ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar ribbon_menu_group_array = ribbon_menu.get( 'sub_menu_groups' );\n\t\t\tvar ribbon_menu_ui = $( '<div id=\"' + ribbon_menu.get( 'id' ) + '\" class=\"ribbon-tab-out-side\"><div class=\"ribbon-tab\"><div class=\"ribbon-sub-menu\"></div></div></div>' );\n\n\t\t\tvar len1 = ribbon_menu_group_array.length;\n\t\t\tfor ( var x = 0; x < len1; x++ ) {\n\t\t\t\tvar ribbon_menu_group = ribbon_menu_group_array[x];\n\t\t\t\tvar ribbon_sub_menu_array = ribbon_menu_group.get( 'sub_menus' );\n\t\t\t\tvar sub_menu_ui_nodes = $( '<ul></ul>' );\n\t\t\t\tvar ribbon_menu_group_ui = $( '<div class=\"menu top-ribbon-menu\"></div>' );\n\n\t\t\t\tvar len2 = ribbon_sub_menu_array.length;\n\t\t\t\tfor ( var y = 0; y < len2; y++ ) {\n\t\t\t\t\tvar ribbon_sub_menu = ribbon_sub_menu_array[y];\n\t\t\t\t\tvar sub_menu_ui_node = $( '<li><div class=\"ribbon-sub-menu-icon\" id=\"' + ribbon_sub_menu.get( 'id' ) + '\"><img src=\"' + ribbon_sub_menu.get( 'icon' ) + '\" ><span class=\"ribbon-label\">' + ribbon_sub_menu.get( 'label' ) + '</span></div></li>' );\n\n\t\t\t\t\tif ( ribbon_sub_menu.get( 'type' ) === RibbonSubMenuType.NAVIGATION ) {\n\t\t\t\t\t\tif ( ribbon_sub_menu.get( 'items' ).length > 0 ) {\n\t\t\t\t\t\t\tsub_menu_ui_nodes.append( sub_menu_ui_node );\n\t\t\t\t\t\t\tsub_menu_ui_node.children().eq( 0 ).addClass( 'ribbon-sub-menu-nav-icon' );\n\t\t\t\t\t\t\t$this.subMenuNavMap[ribbon_sub_menu.get( 'id' )] = ribbon_sub_menu;\n\n\t\t\t\t\t\t\tsub_menu_ui_node.click( Global.debounce( function SubMenuNavClickEvent( e ) {\n\t\t\t\t\t\t\t\tvar id = $( this ).find( '.ribbon-sub-menu-icon' ).attr( 'id' );\n\t\t\t\t\t\t\t\t$this.onSubMenuNavClick( this, id );\n\t\t\t\t\t\t\t}, Global.calcDebounceWaitTimeBasedOnNetwork(), true ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsub_menu_ui_nodes.append( sub_menu_ui_node );\n\n\t\t\t\t\t\t//Debounce to help prevent double clicks.\n\t\t\t\t\t\tsub_menu_ui_node.click( Global.debounce( function RibbonMenuSubMenuClickEvent( e ) {\n\t\t\t\t\t\t\tvar id = $( this ).find( '.ribbon-sub-menu-icon' ).attr( 'id' );\n\t\t\t\t\t\t\t$this.onSubMenuClick( id );\n\t\t\t\t\t\t}, Global.calcDebounceWaitTimeBasedOnNetwork(), true ) );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//If there is any menu\n\t\t\t\tif ( sub_menu_ui_nodes.children().length > 0 ) {\n\t\t\t\t\tribbon_menu_group_ui.append( sub_menu_ui_nodes );\n\t\t\t\t\tribbon_menu_group_ui.append( $( '<div class=\"menu-bottom\"><span class=\"menu-bottom-span\">' + ribbon_menu_group.get( 'label' ) + '</span></div>' ) );\n\t\t\t\t\tribbon_menu_ui.find( '.ribbon-sub-menu' ).append( ribbon_menu_group_ui );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ribbon_menu_ui.find( '.ribbon-sub-menu' ).children().length > 0 ) {\n\t\t\t\tribbon_menu_label_node.append( $( '<li><a id=\"menu:' + ribbon_menu.get( 'id' ) + '\"  ref=\"' + ribbon_menu.get( 'id' ) + '\" href=\"#' + ribbon_menu.get( 'id' ) + '\">' + ribbon_menu.get( 'label' ) + '</a></li>' ) );\n\t\t\t\tribbon_menu_root_node.append( ribbon_menu_ui );\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setRibbonMenuVisibility();\n\n\t}\n\n\tsetRibbonMenuVisibility() {\n\t\t// Set Employee tab visibility\n\n\t\tvar tab_array = ['companyMenu', 'employeeMenu', 'payrollMenu'];\n\n\t\tvar len = tab_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar menu_id = tab_array[i];\n\n\t\t\tvar tab_content = Global.topContainer().find( '#' + menu_id ).find( 'li' );\n\t\t\tif ( tab_content.length < 1 ) {\n\t\t\t\tvar tab = Global.topContainer().find( 'a[ref=\\'' + menu_id + '\\']' );\n\t\t\t\ttab.parent().hide();\n\t\t\t}\n\t\t}\n\n//\t\t  // Set COmpany tab visibility\n//\t\t  var employee_tab_content = Global.topContainer().find('#employeeMenu ' ).find('li');\n//\t\t  if(employee_tab_content.length < 1){\n//\t\t\t  var employee_tab = Global.topContainer().find(\"a[ref='employeeMenu']\" );\n//\t\t\t  employee_tab.parent().hide();\n//\t\t  }\n\n\t}\n\n\trender() {\n\t\t// Error: TypeError: $(...).tabs is not a function in /interface/html5/framework/jquery.min.js?v=8.0.6-20150417-104146 line 2 > eval line 205\n\t\tif ( !this.el ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buildRibbonMenus();\n\n\t\tvar $this = this;\n\t\t$( this.el ).tabs( {\n\t\t\t// No longer used because we only support a single context menu now.\n\t\t\t// activate( e, ui ) {\n\t\t\t// \t$this.onMenuSelect( e, ui );\n\t\t\t// }\n\t\t} );\n\n\t\tthis.setSelectMenu( TopMenuManager.selected_menu_id );\n\n\t\tthis.setSelectSubMenu( TopMenuManager.selected_sub_menu_id );\n\n\t\t$( '#leftLogo' ).attr( 'src', Global.getRealImagePath( 'css/global/widgets/ribbon/images/logo.png' ) );\n\t\t$( '#rightLogo' ).attr( 'src', ServiceCaller.getURLByObjectType( 'company_logo' ) );\n\n\t\tif ( LocalCacheData.getLoginUserPreference() ) {\n\t\t\t$( '#leftLogo' ).unbind( 'click' ).bind( 'click', function() {\n\t\t\t\tGlobal.closeEditViews( function() {\n\t\t\t\t\tTopMenuManager.goToView( 'Home' );\n\t\t\t\t} );\n\n\t\t\t} );\n\t\t}\n\t}\n\n\tsetSelectMenu( name ) {\n\t\t// if ( name ) {\n\t\t// \tvar index = $(this.el).find('#ribbon a[ref=' + name + ']').parent().index();\n\t\t// \t//$(this.el).tabs({'selected': index});\n\t\t// \t$(this.el).tabs('option','active',index)\n\t\t// \tTopMenuManager.selected_menu_id = name;\n\t\t// }\n\t\t//#2353 - exception: can't find #ribbon a[ref=]\n\t\tif ( !name ) {\n\t\t\tname = 'Home';\n\t\t}\n\n\t\tvar index = $( this.el ).find( '#ribbon a[ref=' + name + ']' ).parent().index();\n\t\tif ( index >= 0 ) { //Without this check, the last tab is always selected first and causes more obvious \"flashing\" when refreshing the browser. This just changes it to the first tab instead is all though.\n\t\t\t$( this.el ).tabs( 'option', 'active', index );\n\t\t}\n\t\tTopMenuManager.selected_menu_id = name;\n\t}\n\n\topenSelectView( name ) {\n\t\tGlobal.setUINotready();\n\t\tswitch ( name ) {\n\t\t\tcase 'ImportCSV':\n\t\t\t\tIndexViewController.openWizard( 'ImportCSVWizard', null, function() {\n\t\t\t\t\t//Error: TypeError: LocalCacheData.current_open_primary_controller.search is not a function in interface/html5/framework/jquery.min.js?v=9.0.0-20151016-110437 line 2 > eval line 248\n\t\t\t\t\tif ( LocalCacheData.current_open_primary_controller && typeof LocalCacheData.current_open_primary_controller.search === 'function' ) {\n\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.search();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'QuickStartWizard':\n\t\t\t\tif ( PermissionManager.checkTopLevelPermission( 'QuickStartWizard' ) ) {\n\t\t\t\t\tIndexViewController.openWizard( 'QuickStartWizard' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'InOut':\n\t\t\tcase 'UserDefault':\n\t\t\tcase 'Company':\n\t\t\tcase 'LoginUserContact':\n\t\t\tcase 'LoginUserPreference':\n\t\t\tcase 'ChangePassword':\n\t\t\tcase 'InvoiceConfig':\n\t\t\tcase 'RecruitmentPortalConfig':\n\t\t\tcase 'About':\n\t\t\t\tif ( LocalCacheData.current_open_edit_only_controller && LocalCacheData.current_open_edit_only_controller.viewId == name ) { //#2557 - A - Ensure that opening edit only views on top of same edit only view just resets the edit menu\n\t\t\t\t\tLocalCacheData.current_open_edit_only_controller.setEditMenu();\n\t\t\t\t\t$( '#ribbon_view_container .context-menu:visible a' ).click();\n\t\t\t\t} else if ( LocalCacheData.current_open_edit_only_controller ) { //#2557 - B - Ensure that opening edit only views on top of different edit only  view sets the parent to the existing edit only view\n\t\t\t\t\tIndexViewController.openEditView( LocalCacheData.current_open_edit_only_controller, name );\n\t\t\t\t} else {\n\t\t\t\t\tIndexViewController.openEditView( LocalCacheData.current_open_primary_controller, name ); //#2557 - C - Ensure that opening edit views as normal works as before\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Logout':\n\t\t\t\tthis.doLogout();\n\t\t\t\tbreak;\n\t\t\tcase 'PortalLogout':\n\t\t\t\tthis.doPortalLogout();\n\t\t\t\tbreak;\n\t\t\tcase 'AdminGuide':\n\t\t\t\tvar url = 'https://www.timetrex.com/h?id=admin_guide&v=' + LocalCacheData.getLoginData().application_version + '&e=' + Global.getProductEdition();\n\t\t\t\twindow.open( url, '_blank' );\n\t\t\t\tbreak;\n\t\t\tcase 'FAQS':\n\t\t\t\turl = 'https://www.timetrex.com/h?id=faq&v=' + LocalCacheData.getLoginData().application_version + '&e=' + Global.getProductEdition();\n\t\t\t\twindow.open( url, '_blank' );\n\t\t\t\tbreak;\n\t\t\tcase 'WhatsNew':\n\t\t\t\turl = 'https://www.timetrex.com/h?id=changelog&v=' + LocalCacheData.getLoginData().application_version + '&e=' + Global.getProductEdition();\n\t\t\t\twindow.open( url, '_blank' );\n\t\t\t\tbreak;\n\t\t\tcase 'EmailHelp':\n\t\t\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\t\t\tlocation.href = 'mailto:' + APIGlobal.pre_login_data.support_email + '?subject=Company: ' + LocalCacheData.getCurrentCompany().name + '&body=Company: ' + LocalCacheData.getCurrentCompany().name + '  ' + 'Registration Key: ' + LocalCacheData.getLoginData().registration_key;\n\t\t\t\t} else {\n\t\t\t\t\turl = 'https://www.timetrex.com/r?id=29';\n\t\t\t\t\twindow.open( url, '_blank' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'Sandbox':\n\t\t\t\tif ( APIGlobal.pre_login_data['sandbox_url'] && APIGlobal.pre_login_data['sandbox_url'].length > 0 ) {\n\t\t\t\t\tvar user = LocalCacheData.getLoginUser();\n\t\t\t\t\tGlobal.NewSession( user.user_name, 'SANDBOX', true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'ProcessPayrollWizard':\n\t\t\t\tIndexViewController.openWizard( 'ProcessPayrollWizard', null, function() {\n\t\t\t\t\t//Error: TypeError: LocalCacheData.current_open_primary_controller.search is not a function in interface/html5/framework/jquery.min.js?v=9.0.0-20151016-110437 line 2 > eval line 248\n\t\t\t\t\tif ( LocalCacheData.current_open_primary_controller && typeof LocalCacheData.current_open_primary_controller.search === 'function' ) {\n\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.search();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'PayrollRemittanceAgencyEventWizard':\n\t\t\t\tIndexViewController.openWizardController( 'PayrollRemittanceAgencyEventWizardController', null, function() {\n\t\t\t\t\t//Error: TypeError: LocalCacheData.current_open_primary_controller.search is not a function in interface/html5/framework/jquery.min.js?v=9.0.0-20151016-110437 line 2 > eval line 248\n\t\t\t\t\tif ( LocalCacheData.current_open_primary_controller && typeof LocalCacheData.current_open_primary_controller.search === 'function' ) {\n\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.search();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'ProcessTransactionsWizard':\n\t\t\t\tIndexViewController.openWizardController( 'ProcessTransactionsWizard', null, function() {\n\t\t\t\t\t//Error: TypeError: LocalCacheData.current_open_primary_controller.search is not a function in interface/html5/framework/jquery.min.js?v=9.0.0-20151016-110437 line 2 > eval line 248\n\t\t\t\t\tif ( LocalCacheData.current_open_primary_controller && typeof LocalCacheData.current_open_primary_controller.search === 'function' ) {\n\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.search();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'LegalEntity':\n\t\t\t\tif ( Global.getProductEdition() >= 15 ) {\n\t\t\t\t\tTopMenuManager.goToView( TopMenuManager.selected_sub_menu_id );\n\t\t\t\t} else {\n\t\t\t\t\tIndexViewController.openEditView( LocalCacheData.current_open_primary_controller, name, false );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\t//#2557 - When opening a view from the submenus, ensure that similarily named edit only views are cancelled (with confirm) first.\n\t\t\t\tif ( LocalCacheData.current_open_edit_only_controller && LocalCacheData.current_open_edit_only_controller.viewId == name ) {\n\t\t\t\t\tLocalCacheData.current_open_edit_only_controller.onCancelClick();\n\t\t\t\t\tTTPromise.wait( 'base', 'onCancelClick', function() {\n\t\t\t\t\t\tTopMenuManager.goToView( TopMenuManager.selected_sub_menu_id );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tTopMenuManager.goToView( TopMenuManager.selected_sub_menu_id );\n\t\t\t\t}\n\t\t}\n\t}\n\n\tsetSelectSubMenu( name ) {\n\t\tswitch ( name ) {\n\t\t\tcase 'InOut':\n\t\t\tcase 'UserDefault':\n\t\t\tcase 'Company':\n\t\t\tcase 'LoginUserContact':\n\t\t\tcase 'ImportCSV':\n\t\t\tcase 'QuickStartWizard':\n\t\t\tcase 'InvoiceConfig':\n\t\t\tcase 'LoginUserPreference':\n\t\t\tcase 'RecruitmentPortalConfig':\n\t\t\t\tbreak;\n\t\t\tcase 'Logout':\n\t\t\t\tbreak;\n\t\t\tcase 'AdminGuide':\n\t\t\t\tbreak;\n\t\t\tcase 'FAQS':\n\t\t\t\tbreak;\n\t\t\tcase 'WhatsNew':\n\t\t\t\tbreak;\n\t\t\tcase 'EmailHelp':\n\t\t\t\tbreak;\n\t\t\tcase 'ProcessPayrollWizard':\n\t\t\tcase 'PayrollRemittanceAgencyWizard':\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( TopMenuManager.selected_sub_menu_id ) {\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t$( '#' + TopMenuManager.selected_sub_menu_id ).removeClass( 'selected-menu' );\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tTopMenuManager.selected_sub_menu_id = '';\n\t\t\t\t\t\tTopMenuManager.selected_menu_id = '';\n\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Invalid view name' ) );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( !name ) {\n\t\t\t\t\tname = 'Home';\n\t\t\t\t}\n\n\t\t\t\t$( '#' + name ).addClass( 'selected-menu' );\n\t\t\t\tTopMenuManager.selected_sub_menu_id = name;\n\n\t\t}\n\n\t}\n\n\tdoLogout() {\n\t\t//Don't wait for result of logout in case of slow or disconnected internet. Just clear local cookies and move on.\n\t\tvar current_user_api = TTAPI.APIAuthentication;\n\t\tif ( typeof current_user_api.Logout !== 'undefined' ) { //Fix JS exception: Uncaught TypeError: current_user_api.Logout is not a function -- Which can occur when offline and clicking Logout.\n\t\t\tcurrent_user_api.Logout( {\n\t\t\t\tonResult() {\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tGlobal.setAnalyticDimensions();\n\t\tif ( typeof ( ga ) != 'undefined' && APIGlobal.pre_login_data.analytics_enabled === true ) {\n\t\t\ttry {\n\t\t\t\tga( 'send', 'pageview', { 'sessionControl': 'end' } );\n\t\t\t} catch ( e ) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\t//A bare \"if\" wrapped around lh_inst doesn't work here for some reason.\n\t\tif ( typeof ( lh_inst ) != 'undefined' ) {\n\t\t\t//stop the update loop for live chat with support\n\t\t\tclearTimeout( lh_inst.timeoutStatuscheck );\n\t\t}\n\n\t\tGlobal.Logout();\n\t\tTopMenuManager.goToView( 'Login' );\n\n\t\tTAlertManager.showBrowserTopBanner();\n\n\t\treturn;\n\t}\n\n\tstatic loadView() {\n\t\tGlobal.topContainer().css( 'display', 'block' );\n\t\tvar result = Global.loadPageSync( 'global/widgets/ribbon/RibbonView.html' );\n\t\tvar template = _.template( result );\n\t\tGlobal.topContainer().html( template );\n\n\t}\n}\n"],"sourceRoot":""}