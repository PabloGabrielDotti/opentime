(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["wizard-formula_builder_wizard-FormulaBuilderWizardController"],{3313:(t,e,i)=>{"use strict";i.r(e),i.d(e,{"FormulaBuilderWizardController":()=>a});class a extends BaseWizardController{constructor(t={}){_.defaults(t,{el:".wizard-bg",formula_selection_pos:0}),super(t)}init(t){this.title=$.i18n._("Formula Builder"),this.steps=1,this.current_step=1,this.render()}render(){super.render(),$(this.el).find(".progress-bar").hide(),this.next_btn.hide(),this.back_btn.hide(),$(this.el).css("max-height",500),this.content_div.css("top",20),this.initCurrentStep()}buildCurrentStepUI(){var t=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var e=this.getLabel();e.text(""),this.content_div.append(e);var i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),a=i.find(".form-item-label"),s=i.find(".form-item-input-div");i.css("margin-left",0);var r=this.getComboBox("custom_variables",!0);a.text($.i18n._("Custom Variables")+": "),s.append(r),r.setSourceData(this.default_data.variables),r.unbind("mousedown").bind("mousedown",(function(){t.formula_selection_pos=o[0].selectionStart})),r.unbind("formItemChange").bind("formItemChange",l),this.content_div.append(i),a=(i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),s=i.find(".form-item-input-div"),i.css("margin-left",0);var n=this.getComboBox("formula_function",!0);a.text($.i18n._("Formula Functions")+": "),s.append(n),n.setSourceData(this.default_data.functions),n.unbind("mousedown").bind("mousedown",(function(){t.formula_selection_pos=o[0].selectionStart})),n.unbind("formItemChange").bind("formItemChange",l),this.content_div.append(i),a=(i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),s=i.find(".form-item-input-div"),i.css("margin-left",0);var o=this.getTextArea("formula",730);a.text($.i18n._("Formula")+": "),s.append(o),this.content_div.append(i),this.stepsWidgetDic[this.current_step][r.getField()]=r,this.stepsWidgetDic[this.current_step][n.getField()]=n,this.stepsWidgetDic[this.current_step][o.getField()]=o,o.focus()}function l(e,i){var a=i.getValue();if(0!==a){var s=o.getValue(),r=t.formula_selection_pos,n=s.substring(0,r),l=s.substring(r,s.length);o.setValue(n+a+l),o.focus(),o[0].selectionStart=r+a.length,o[0].selectionEnd=r+a.length}}}buildCurrentStepData(){this.stepsDataDic[this.current_step];var t=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:t.formula.setValue(this.default_data.formula)}}onDoneClick(){var t=this;super.onDoneClick(),this.saveCurrentStep();var e=this.default_data.current_edit_record,i=this.stepsDataDic[1].formula,a=this.stepsWidgetDic[1].formula;"CompanyDeduction"===this.default_data.api.key_name?e.company_value1=i:e.formula=i,this.default_data.api["validate"+this.default_data.api.key_name](e,{onResult:function(e){if(e.isValid())$(t.el).remove(),t.call_back(i),n();else{var s=e.getDetails();if(!s)return void n();if(Global.isArray(s)||"object"==typeof s){var r=!1;$.each(s,(function(e,i){for(var s in i)"CompanyDeduction"===t.default_data.api.key_name?"company_value1"===s&&(a.setErrorStyle(i[s],!0),r=!0):"formula"===s&&(a.setErrorStyle(i[s],!0),r=!0);r||n()}))}else n()}function n(){$(t.el).remove(),t.call_back(i)}}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var t=this.stepsDataDic[this.current_step],e=this.stepsWidgetDic[this.current_step];for(var i in this.current_step,e)e.hasOwnProperty(i)&&(t[i]=e[i].getValue())}setDefaultDataToSteps(){if(!this.default_data)return null}}}}]);
//# sourceMappingURL=wizard-formula_builder_wizard-FormulaBuilderWizardController.bundle.js.map?v=5ce0bdbda732ed82f475