(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["attendance-punches-PunchesViewController","filebrowser-TImage"],{1469:()=>{!function(e){e.fn.TImage=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a=e.extend({},e.fn.TImage.defaults,t);return this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return null},this.setValue=function(e){if(e){var t=new Date;this.attr("src",e+"&t="+t.getTime())}else this.attr("src","")},this.each((function(){var t=e.meta?e.extend({},a,e(this).data()):a;i=t.field})),this},e.fn.TImage.defaults={},e(document).on("mouseover",".file-browser img",(function(t){var i=e(t.target).parents(".file-browser");if(!e(".file_browser_overlay")[0]&&1==e(t.target).attr("enable-delete")){var a=e(t.target).height(),s=(a-32)/2,n=e('<div class="file_browser_overlay"><img src="theme/default/images/delete-512.png" style="position:absolute;width:32px;height:32px;top:'+s+"px;left:"+s+'px;"></div>');n.css("position","absolute"),n.css("top","0px"),n.css("left","0"),n.css("cursor","pointer"),n.css("height",a+"px"),n.css("width","100%"),n.css("background","rgba(255,255,255,0.85)"),e(t.target).parents(".file-browser").append(n),e(document).on("click",".file_browser_overlay",(function(t){e(t.target).parent().find("img").attr("src");TAlertManager.showConfirmAlert(e.i18n._("This will permanently delete the image. Are you sure?"),"",(function(e){if(e){var t={type:"deleteClick",message:"Delete image clicked.",time:new Date};i.trigger(t)}}))})),e(document).on("mouseleave",".file-browser",(function(){(e(document).off("click",".file_browser_overlay"),e(".file_browser_overlay")[0])&&e(this).find(".file_browser_overlay").off().remove()}))}}))}(jQuery)},1274:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"PunchesViewController":()=>a});i(1469);class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#punches_view_container",old_type_status:{},user_api:null,user_group_api:null,api_station:null,type_array:null,actual_time_label:null,is_mass_adding:!1}),super(e)}init(e){this.edit_view_tpl="PunchesEditView.html",this.permission_id="punch",this.viewId="Punches",this.script_name="PunchesView",this.table_name_key="punch",this.context_menu_name=$.i18n._("Punches"),this.navigation_label=$.i18n._("Punch")+":",this.api=TTAPI.APIPunch,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem),this.api_station=TTAPI.APIStation,this.initPermission(),this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}jobUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate("job","enabled")||!PermissionManager.validate(e,"edit_job"))}jobItemUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate("job_item","enabled")||!PermissionManager.validate(e,"edit_job_item"))}branchUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_department")}goodQuantityUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_quantity")}badQuantityUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate(e,"edit_quantity")||!PermissionManager.validate(e,"edit_bad_quantity"))}transferUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_transfer")}noteUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_note")}locationUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_location")}stationValidate(){return!!PermissionManager.validate("station","enabled")}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.transferUIValidate()?this.show_transfer_ui=!0:this.show_transfer_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1,this.locationUIValidate()?this.show_location_ui=!0:this.show_location_ui=!1,this.stationValidate()?this.show_station_ui=!0:this.show_station_ui=!1}initOptions(){var e=this;this.initDropDownOption("type"),this.initDropDownOption("status","status_id",this.api,null,"status_array"),this.initDropDownOption("status","user_status_id",this.user_api,null,"user_status_array"),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),e.user_group_array=t,e.basic_search_field_ui_dic.group_id.setSourceData(t),e.adv_search_field_ui_dic.group_id.setSourceData(t)}})}onEditStationDone(){this.setStation()}setStation(){var e=this,t={filter_data:{id:this.current_edit_record.station_id}};this.api_station.getStation(t,{onResult:function(t){e.station=t.getResult()[0];var i=e.edit_view_ui_dic.station_id;i.setValue(e.station.type+"-"+e.station.description),i.css("cursor","pointer")}})}uniformVariable(e){return e.hasOwnProperty("time_stamp")||(e.time_stamp=!1),e}buildEditViewUI(){super.buildEditViewUI();var e,t,i=this,a={"tab_punch":{"label":$.i18n._("Punch")},"tab_audit":!0};this.setTabModel(a),this.navigation.AComboBox({api_class:TTAPI.APIPunch,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_punch",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var s=this.edit_view_tab.find("#tab_punch").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(s),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"});var n={permission_section:"punch"};e.setDefaultArgs(n),this.addEditFieldToColumn($.i18n._("Employee"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.TIME_PICKER)).TTimePicker({field:"punch_time",validation_field:"time_stamp"}),t=$("<div class='widget-h-box'></div>"),this.actual_time_label=$("<span class='widget-right-label'></span>"),t.append(e),t.append(this.actual_time_label),this.addEditFieldToColumn($.i18n._("Time"),e,s,"",t),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"punch_date",validation_field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TRangePicker({field:"punch_dates",validation_field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"transfer"}),this.addEditFieldToColumn($.i18n._("Transfer"),e,s,"",null,!0),0!=this.show_transfer_ui&&0!=this.is_add||this.detachElement("transfer"),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),e.setSourceData(i.type_array),t=$("<div class='widget-h-box'></div>");var o=Global.loadWidgetByName(FormItemType.CHECKBOX);o.TCheckbox({field:"disable_rounding"});var r=$("<span class='widget-right-label'>"+$.i18n._("Disable Rounding")+"</span>");if(t.append(e),this.is_viewing?this.addEditFieldToColumn($.i18n._("Punch Type"),e,s,"",t,!0):(t.append(r),t.append(o),this.addEditFieldToColumn($.i18n._("Punch Type"),[e,o],s,"",t,!0)),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),e.setSourceData(i.status_array),this.addEditFieldToColumn($.i18n._("In/Out"),e,s),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",addition_source_function:function(e,t){return i.onSourceDataCreate(e,t)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:$.i18n._("-- Current Shift --")}]}),this.addEditFieldToColumn($.i18n._("Branch"),e,s,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",addition_source_function:function(e,t){return i.onSourceDataCreate(e,t)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:$.i18n._("-- Current Shift --")}]}),this.addEditFieldToColumn($.i18n._("Department"),e,s,"",null,!0),this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&d.setValue(e.manual_id)},field:"job_id",addition_source_function:function(e,t){return i.onSourceDataCreate(e,t)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:$.i18n._("-- Current Shift --")}]}),t=$("<div class='widget-h-box'></div>");var d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),t.append(d),t.append(e),this.addEditFieldToColumn($.i18n._("Job"),[e,d],s,"",t,!0),this.show_job_ui||this.detachElement("job_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&_.setValue(e.manual_id)},field:"job_item_id",addition_source_function:function(e,t){return i.onSourceDataCreate(e,t)},added_items:[{value:TTUUID.not_exist_id,label:Global.default_item},{value:"ffffffff-ffff-ffff-ffff-000000000002",label:$.i18n._("-- Current Shift --")}]}),t=$("<div class='widget-h-box'></div>");var _=Global.loadWidgetByName(FormItemType.TEXT_INPUT);_.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),_.addClass("job-coder"),t.append(_),t.append(e),this.addEditFieldToColumn($.i18n._("Task"),[e,_],s,"",t,!0),this.show_job_item_ui||this.detachElement("job_item_id")}if(Global.getProductEdition()>=20){var l=Global.loadWidgetByName(FormItemType.TEXT_INPUT);l.TTextInput({field:"quantity",width:40}),l.addClass("quantity-input");var c=$("<span class='widget-right-label'>"+$.i18n._("Good")+": </span>"),u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"bad_quantity",width:40}),u.addClass("quantity-input");var h=$("<span class='widget-right-label'>/ "+$.i18n._("Bad")+": </span>");(t=$("<div class='widget-h-box'></div>")).append(c),t.append(l),t.append(h),t.append(u),this.addEditFieldToColumn($.i18n._("Quantity"),[l,u],s,"",t,!0),this.show_bad_quantity_ui||this.show_good_quantity_ui?(this.show_bad_quantity_ui||(h.hide(),u.hide()),this.show_good_quantity_ui||(c.hide(),l.hide())):this.detachElement("quantity")}if((e=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),e,s,"",null,!0,!0),e.parent().width("45%"),this.show_note_ui||this.detachElement("note"),Global.getProductEdition()>=15){var m=Global.loadWidgetByName(FormItemType.TEXT);m.TText({field:"latitude"});var p=Global.loadWidgetByName(FormItemType.TEXT);p.TText({field:"longitude"}),t=$("<div class='widget-h-box link-widget-box'></div>");var b=Global.loadWidgetByName(FormItemType.TEXT);b.TText({field:"position_accuracy"}),r=$("<span class='widget-right-label'>"+$.i18n._("Accuracy")+":</span>");var f=$('<img class="widget-h-box-mapIcon" src="framework/leaflet/images/marker-icon-red.png" >');this.location_wrapper=$('<div class="widget-h-box-mapLocationWrapper"></div>'),t.append(f),t.append(this.location_wrapper),this.location_wrapper.append(m),this.location_wrapper.append($("<span>, </span>")),this.location_wrapper.append(p),this.location_wrapper.append(r),this.location_wrapper.append(b),this.location_wrapper.append($("<span>m</span>")),this.addEditFieldToColumn($.i18n._("Location"),[m,p,b],s,"",t,!0),t.click((function(){i.onMapClick()})),(this.is_edit||this.is_viewing)&&this.show_location_ui||t.parents(".edit-view-form-item-div").hide()}(e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"station_id"}),this.addEditFieldToColumn($.i18n._("Station"),e,s,"",null,!0,!0),e.click((function(){i.current_edit_record.station_id&&i.show_station_ui&&IndexViewController.openEditView(i,"Station",i.current_edit_record.station_id)})),(e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"split_punch_control"}),this.addEditFieldToColumn($.i18n._("Split Existing Punches"),e,s,"",null,!0),0==this.is_add&&this.detachElement("split_punch_control"),(e=Global.loadWidgetByName(FormItemType.IMAGE)).TImage({field:"punch_image"}),this.addEditFieldToColumn($.i18n._("Image"),e,s,"",null,!0,!0),this.is_mass_editing&&(this.detachElement("punch_image"),this.detachElement("user_id"))}onSourceDataCreate(e,t){var i=e.getDisplayColumns(),a={},s={};return $.each(i,(function(e,t){return a.id=TTUUID.not_exist_id,a[t.name]=Global.default_item,s.id="ffffffff-ffff-ffff-ffff-000000000002",s[t.name]=$.i18n._("-- Current Shift --"),!1})),t&&"array"===$.type(t)||(t=[]),t.unshift(s),t.unshift(a),t}setEditViewWidgetsMode(){var e={};for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var i=this.edit_view_ui_dic[t];this.edit_view_form_item_dic[t];i.css("opacity",1);var a=i.parent().parent().parent(),s=a.parent().attr("id");switch(a.hasClass("v-box")||e[s]||(e[s]=!0),t){case"punch_dates":this.is_mass_editing||!this.is_mass_adding&&this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(this.detachElement(t),i.css("opacity",0)):(this.attachElement(t),i.css("opacity",1));break;case"punch_date":this.is_mass_editing||!this.is_mass_adding&&this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(this.attachElement(t),i.css("opacity",1)):(this.detachElement(t),i.css("opacity",0))}this.is_viewing?Global.isSet(i.setEnabled)&&i.setEnabled(!1):Global.isSet(i.setEnabled)&&i.setEnabled(!0)}}onTransferChanged(e){var t=!1;this.edit_view_ui_dic&&this.edit_view_ui_dic.transfer&&1==this.edit_view_ui_dic.transfer.getValue()&&(t=!0);var i=this.edit_view_ui_dic.type_id,a=this.edit_view_ui_dic.status_id;t&&i&&a?(i.setEnabled(!1),a.setEnabled(!1),this.old_type_status.type_id=i.getValue(),this.old_type_status.status_id=a.getValue(),i.setValue(10),a.setValue(10),this.current_edit_record.type_id=10,this.current_edit_record.status_id=10):i&&a&&(i.setEnabled(!0),a.setEnabled(!0),this.old_type_status.hasOwnProperty("type_id")&&(i.setValue(this.old_type_status.type_id),a.setValue(this.old_type_status.status_id),this.current_edit_record.type_id=this.old_type_status.type_id,this.current_edit_record.status_id=this.old_type_status.status_id)),1==t?(""==this.original_note?this.original_note=this.current_edit_record.note:this.original_note=this.edit_view_ui_dic.note.getValue(),this.edit_view_ui_dic.note.setValue(this.new_note?this.new_note:""),this.current_edit_record.note=this.new_note?this.new_note:""):void 0!==e&&!1!==e||(this.new_note=this.edit_view_ui_dic.note.getValue(),this.edit_view_ui_dic.note.setValue(this.original_note?this.original_note:""),this.current_edit_record.note=this.original_note?this.original_note:"")}validate(){var e=this,t={};if(this.is_mass_editing){for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var a=this.edit_view_ui_dic[i];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(t[i]=a.getValue())}t.id=this.mass_edit_record_ids[0],t=this.uniformVariable(t)}else this.is_mass_adding?t=this.buildMassAddRecord(this.current_edit_record):(t=this.current_edit_record,t=this.uniformVariable(t));this.api["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}buildMassEditSaveRecord(e,t){var i=[];return $.each(e,(function(e,a){var s=Global.clone(t);s.id=a,i.push(s)})),i}buildMassAddRecord(e){var t=[],i=e.punch_dates;i.indexOf(" - ")>0&&(i=this.parserDatesRange(i));for(var a=0;a<i.length;a++){var s=Global.clone(e);delete s.punch_dates,s.punch_date=i[a];var n=this.current_edit_record.user_id;if(Global.isArray(n))for(var o=0;o<n.length;o++){var r=Global.clone(s);r.user_id=this.current_edit_record.user_id[o],r=this.uniformVariable(r),t.push(r)}else s=this.uniformVariable(s),t.push(s)}return t}parserDatesRange(e){for(var t=e.split(" - "),i=[],a=Global.strToDate(t[0]),s=Global.strToDate(t[1]),n=a;n.getTime()<s.getTime();)i.push(n.format()),n=new Date(new Date(n.getTime()).setDate(n.getDate()+1));return i.push(t[1]),i}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"punch_dates":var i;this.current_edit_record.punch_dates?i=this.current_edit_record.punch_dates:(i=[this.current_edit_record.punch_date],this.current_edit_record.punch_dates=i),t.setValue(i);break;case"country":this.setCountryValue(t,e);break;case"enable_email_notification_message":t.setValue(this.current_edit_record[e]);break;case"job_id":if(Global.getProductEdition()>=20)(a={}).filter_data={status_id:10,user_id:this.current_edit_record.user_id},t.setDefaultArgs(a),t.setValue(this.current_edit_record[e]);break;case"job_item_id":var a;if(Global.getProductEdition()>=20)(a={}).filter_data={status_id:10,job_id:this.current_edit_record.job_id},t.setDefaultArgs(a),t.setValue(this.current_edit_record[e]);break;case"job_quick_search":case"job_item_quick_search":break;case"station_id":this.current_edit_record[e]?this.setStation():(t.setValue("N/A"),t.css("cursor","default"));break;case"punch_image":this.edit_view_form_item_dic.station_id;this.current_edit_record.has_image?(this.attachElement("punch_image"),t.setValue(ServiceCaller.getURLByObjectType("file_download")+"&object_type=punch_image&parent_id="+this.current_edit_record.user_id+"&object_id="+this.current_edit_record.id)):this.detachElement("punch_image");break;default:t.setValue(this.current_edit_record[e])}}var s;this.current_edit_record.id&&(s=this.current_edit_record.actual_time_stamp?$.i18n._("Actual Time")+": "+this.current_edit_record.actual_time_stamp:"N/A"),this.actual_time_label.text(s),this.collectUIDataToCurrentEditRecord(),this.setLocationValue(),this.setEditViewDataDone(),this.isEditChange()}setLocationValue(e){Global.getProductEdition()>=15&&(e&&(this.current_edit_record.latitude=e.latitude,this.current_edit_record.longitude=e.longitude,this.current_edit_record.position_accuracy=e.position_accuracy),this.edit_view_ui_dic.latitude.setValue(this.current_edit_record.latitude),this.edit_view_ui_dic.longitude.setValue(this.current_edit_record.longitude),this.edit_view_ui_dic.position_accuracy.setValue(this.current_edit_record.position_accuracy?this.current_edit_record.position_accuracy:0),this.current_edit_record.latitude||this.is_mass_editing?this.show_location_ui&&this.location_wrapper.show():this.location_wrapper.hide())}isEditChange(){this.current_edit_record.id||this.is_mass_editing?this.edit_view_ui_dic.user_id.setEnabled(!1):this.edit_view_ui_dic.user_id.setEnabled(!0)}setEditViewDataDone(){this.setTabOVisibility(!0),1==this.is_edit?this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!1):this.edit_view_ui_dic.user_id.setAllowMultipleSelection(!0),0!=this.is_edit||0!=this.current_edit_record.latitude&&0!=this.current_edit_record.longitude?this.show_location_ui&&$(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").show():$(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").hide(),this.navigation.setValue(this.current_edit_record.id),$(".edit-view-tab-bar").css("opacity",1),TTPromise.resolve("init","init")}setSubLogViewFilter(){return!!this.sub_log_view_controller&&(this.sub_log_view_controller.getSubViewFilter=function(e){return e.table_name_object_id={"punch":[this.parent_edit_record.id],"punch_control":[this.parent_edit_record.punch_control_id]},e},!0)}buildOtherFieldUI(e,t){if(this.edit_view_tab){var i,a=this,s=this.edit_view_tab.find("#tab_punch").find(".first-column");if(a.edit_view_ui_dic[e])(i=a.edit_view_ui_dic[e]).setValue(a.current_edit_record[e]);else(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:e}),a.addEditFieldToColumn(t,i,s).insertBefore(this.edit_view_form_item_dic.note),i.setValue(a.current_edit_record[e]);i.css("opacity",1),i.css("minWidth",300),a.is_viewing?i.setEnabled(!1):i.setEnabled(!0)}}onAddResult(e){var t=this,i=e.getResult();i||(i=[]),i.company=LocalCacheData.current_company.name,i.punch_date=(new Date).format(),t.sub_view_mode&&t.parent_key&&(i[t.parent_key]=t.parent_value),t.current_edit_record=i,t.initEditView()}buildSearchFields(){super.buildSearchFields();this.search_fields=[new SearchField({label:$.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Start Date"),in_column:1,field:"start_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:$.i18n._("End Date"),in_column:1,field:"end_date",basic_search:!1,adv_search:!0,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",default_args:{permission_section:"punch"},api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Title"),in_column:2,field:"title_id",layout_name:"global_user_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Punch Branch"),in_column:2,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Punch Department"),in_column:2,field:"department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:1,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),in_column:1,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:Global.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:!1,adv_search:this.show_job_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:Global.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:!1,adv_search:this.show_job_item_ui&&Global.getProductEdition()>=20,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}getCustomContextMenuModel(){var e={exclude:[ContextMenuIconName.copy],include:[{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee}]};return Global.getProductEdition()>=15&&e.include.push({label:$.i18n._("Map"),id:ContextMenuIconName.map,group:"other",icon:Icons.map},{label:$.i18n._("Import"),id:ContextMenuIconName.import_icon,group:"other",icon:Icons.import_icon,sort_order:8e3}),e}onMapClick(){if(Global.getProductEdition()>=15){ProgressBar.showProgressBar();var e={filter_columns:{id:!0,latitude:!0,longitude:!0,punch_date:!0,punch_time:!0,position_accuracy:!0,user_id:!0}},t=[],a={};if(this.is_edit)t.push(this.current_edit_record),this.is_viewing||(a.single_marker_draggable=!0);else{var s=this.getGridSelectIdArray();a.single_marker_draggable=!1,e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.length>0&&(e.filter_data.id=s),e.filter_columns.first_name=!0,e.filter_columns.last_name=!0,e.filter_columns.user_id=!0,e.filter_columns.date_stamp=!0,e.filter_columns.punch_date=!0,e.filter_columns.punch_time=!0,e.filter_columns.time_stamp=!0,e.filter_columns.status=!0,e.filter_columns.punch_control_id=!0,e.filter_columns.branch=!0,e.filter_columns.branch_id=!0,e.filter_columns.department=!0,e.filter_columns.department_id=!0,e.filter_columns.job_manual_id=!0,e.filter_columns.job=!0,e.filter_columns.job_id=!0,e.filter_columns.job_item_manual_id=!0,e.filter_columns.job_item=!0,e.filter_columns.job_item_id=!0,e.filter_columns.total_time=!0,e.filter_columns.latitude=!0,e.filter_columns.longitude=!0,e.filter_columns.position_accuracy=!0,t=this.api.getPunch(e,{async:!1}).getResult()}this.is_mass_editing||Promise.all([i.e("vendors-node_modules_leaflet-draw_dist_leaflet_draw_js-node_modules_leaflet_dist_leaflet-src_js"),i.e("vendors-node_modules_leaflet_dist_images_marker-icon-2x_png-node_modules_leaflet_dist_images_-e2a419"),i.e("interface_html5_framework_leaflet_leaflet-timetrex_js"),i.e("leaflet-timetrex")]).then(i.bind(i,6889)).then((e=>{var i=e.TTConvertMapData.processPunchesFromViewController(t,a);IndexViewController.openEditView(this,"Map",i)})).catch(Global.importErrorHandler)}}onCustomContextClick(e){switch(e){case ContextMenuIconName.timesheet:case ContextMenuIconName.edit_employee:this.onNavigationClick(e);break;case ContextMenuIconName.map:this.onMapClick();break;case ContextMenuIconName.import_icon:this.onImportClick()}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","Punch",(function(){e.search()}))}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var s=$(this.context_menu_array[a]),n=$(s.find(".ribbon-sub-menu-icon")).attr("id");switch(s.removeClass("invisible-image"),s.removeClass("disable-image"),n){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(s,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(s,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(s,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(s,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(s,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(s,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(s,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(s,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(s,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(s,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(s,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(s,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(s,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(s,i);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(s,i,"punch");break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditIcon(s,i,"user");break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(s,i);break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(s)}}this.setContextMenuGroupVisibility()}}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");if(i.removeClass("disable-image"),this.is_mass_editing)switch(a){case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;default:i.addClass("disable-image")}else switch(a){case ContextMenuIconName.add:this.setEditMenuAddIcon(i);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(i);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(i);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(i);break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(i);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(i);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(i);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(i);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(i);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(i);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.timesheet:this.setEditMenuNavViewIcon(i,"punch");break;case ContextMenuIconName.edit_employee:this.setEditMenuNavEditIcon(i,"user");break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}onNavigationClick(e){var t,i,a,s=this;switch(e){case ContextMenuIconName.timesheet:if(t={filter_data:{}},Global.isSet(this.current_edit_record))t.user_id=this.current_edit_record.user_id,t.base_date=this.current_edit_record.punch_date,Global.addViewTab(this.viewId,$.i18n._("Punches"),window.location.href),IndexViewController.goToView("TimeSheet",t);else if(i={},(a=this.getGridSelectIdArray()).length>0){var n=a[0];i.filter_data={},i.filter_data.id=[n],this.api["get"+this.api.key_name](i,{onResult:function(e){var i=e.getResult();i||(i=[]),i=i[0],t.user_id=i.user_id,t.base_date=i.punch_date,Global.addViewTab(s.viewId,$.i18n._("Punches"),window.location.href),IndexViewController.goToView("TimeSheet",t)}})}break;case ContextMenuIconName.edit_employee:t={filter_data:{}},Global.isSet(this.current_edit_record)?IndexViewController.openEditView(this,"Employee",this.current_edit_record.user_id):(i={},(a=this.getGridSelectIdArray()).length>0&&(n=a[0],i.filter_data={},i.filter_data.id=[n],this.api["get"+this.api.key_name](i,{onResult:function(e){var t=e.getResult();t||(t=[]),t=t[0],IndexViewController.openEditView(s,"Employee",t.user_id)}})))}}setEditMenuSaveAndContinueIcon(e,t){this.saveAndContinueValidate(e,t),(this.is_mass_editing||this.is_viewing||this.isMassDateOrMassUser())&&e.addClass("disable-image")}copyAsNewResetIds(e){return e.id="",e.punch_control_id="",e}_continueDoCopyAsNew(){(this.setCurrentEditViewState("new"),this.is_mass_adding=!0,LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view))?(this.current_edit_record=this.copyAsNewResetIds(this.current_edit_record),this.edit_view.find(".navigation-div").css("display","none"),this.openEditView(),this.initEditView(),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay()):super._continueDoCopyAsNew()}isMassDateOrMassUser(){return!!this.is_mass_adding&&(!!(this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length>1)||!!(this.current_edit_record.user_id&&this.current_edit_record.user_id.length>1))}onSaveAndCopy(e){var t=this;Global.isSet(e)||(e=!1),this.is_add=!0,this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var i=this.current_edit_record;i=this.is_mass_adding?this.buildMassAddRecord(i):this.uniformVariable(i),this.clearNavigationData(),this.api["set"+this.api.key_name](i,!1,e,{onResult:function(e){t.onSaveAndCopyResult(e)}})}onSaveAndNewClick(e){var t=this;Global.isSet(e)||(e=!1),this.setCurrentEditViewState("new");var i=this.current_edit_record;i=this.is_mass_adding?this.buildMassAddRecord(i):this.uniformVariable(i),this.api["set"+this.api.key_name](i,!1,e,{onResult:function(e){t.onSaveAndNewResult(e)}})}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,this.is_mass_adding=!1,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var t={},i=this.getGridSelectIdArray();i.length;this.mass_edit_record_ids=[],$.each(i,(function(t,i){e.mass_edit_record_ids.push(i)})),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(t){var i=t.getResult();i||(i=[]),e.api.getOptions("unique_columns",{onResult:function(t){e.unique_columns=t.getResult(),e.api.getOptions("linked_columns",{onResult:function(t){e.linked_columns=t.getResult(),e.sub_view_mode&&e.parent_key&&(i[e.parent_key]=e.parent_value),e.current_edit_record=i,e.initEditView()}})}})}})}onSaveAndContinue(e){var t=this;Global.isSet(e)||(e=!1),this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_continue",this.is_mass_adding&&(this.current_edit_record.punch_dates&&1===this.current_edit_record.punch_dates.length&&(this.current_edit_record.punch_date=this.current_edit_record.punch_dates[0]),this.current_edit_record.user_id&&1===this.current_edit_record.user_id.length&&(this.current_edit_record.user_id=this.current_edit_record.user_id[0])),this.current_edit_record=this.uniformVariable(this.current_edit_record),this.api["set"+this.api.key_name](this.current_edit_record,!1,e,{onResult:function(e){t.onSaveAndContinueResult(e)}})}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();switch(this.current_edit_record[i]=a,i){case"user_id":$.isArray(this.current_edit_record.user_id)?this.is_mass_adding=!0:this.is_mass_adding=!1,this.setEditMenu();break;case"punch_date":this.current_edit_record.punch_dates=[a];break;case"punch_dates":this.is_mass_adding=!0,this.setEditMenu();break;case"transfer":this.onTransferChanged();break;case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&this.onJobQuickSearch(i,a);break;default:this.current_edit_record[i]=a}t||this.validate()}onMapSaveClick(e,t){this.savePunchPosition(e,t)}savePunchPosition(e,t){return e&&1===e.length?(this.setLocationValue(e[0]),t(),this.is_changed=!0,!0):(Debug.Text("ERROR: Invalid params/data passed to function.","PunchesViewController.js","PunchesViewController","savePunchPosition",1),!1)}getSelectEmployee(e){return e?LocalCacheData.getLoginUser():LocalCacheData.getLoginUser().id}getFilterColumnsFromDisplayColumns(e,t){return null==e&&(e={}),e.latitude=!0,e.longitude=!0,this._getFilterColumnsFromDisplayColumns(e,t)}}}}]);
//# sourceMappingURL=attendance-punches-PunchesViewController.bundle.js.map?v=8905607cec8cd27c59d0