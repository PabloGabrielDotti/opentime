(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["hr-recruitment-JobApplicationViewController"],{392:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"JobApplicationViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#job_application_view_container",status_array:null,type_array:null,priority_array:null,document_object_type_id:null,user_api:null,job_applicant_api:null}),super(e)}init(e){this.edit_view_tpl="JobApplicationEditView.html",this.permission_id="job_application",this.viewId="JobApplication",this.script_name="JobApplicationView",this.table_name_key="job_application",this.context_menu_name=$.i18n._("Job Application"),this.navigation_label=$.i18n._("Job Application")+":",this.api=TTAPI.APIJobApplication,this.document_api=TTAPI.APIDocument,this.user_api=TTAPI.APIUser,this.job_applicant_api=TTAPI.APIJobApplicant,this.document_object_type_id=170,this.job_applicant_document_object_type_id=160,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary("JobApplication")}initOptions(){this.initDropDownOption("status"),this.initDropDownOption("type"),this.initDropDownOption("priority")}buildEditViewUI(){super.buildEditViewUI();var e=this,t={"tab_job_application":{"label":$.i18n._("Job Application")},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIJobApplication,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_job_application",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_job_application").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var a=Global.loadWidgetByName(FormItemType.AWESOME_BOX);a.AComboBox({api_class:TTAPI.APIJobApplicant,allow_multiple_selection:!1,layout_name:"global_job_applicant",field:"job_applicant_id",set_empty:!0,show_search_inputs:!0});var o=$("<div class='widget-h-box'></div>"),n=$("<a href =\"\" target=\"_blank\" id =\"job-email-link\"> <input class='t-button' style='margin-left: 5px; height: 25px;' type='button' value='"+$.i18n._("Email")+"'> </a>");o.append(a),o.append(n),this.addEditFieldToColumn($.i18n._("Job Applicant"),a,i,"",o),(a=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobVacancy,allow_multiple_selection:!1,layout_name:"global_job_vacancy",field:"job_vacancy_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn($.i18n._("Job Vacancy"),a,i),(a=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),a.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),a,i),(a=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),a.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),a,i),(a=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"priority_id"}),a.setSourceData(e.priority_array),this.addEditFieldToColumn($.i18n._("Priority"),a,i),(a=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",field:"interviewer_user_id",set_empty:!0,show_search_inputs:!0});var l={permission_section:"job_application"};a.setDefaultArgs(l),this.addEditFieldToColumn($.i18n._("Interviewer"),a,i),(a=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"next_action_date"}),this.addEditFieldToColumn($.i18n._("Next Action Date"),a,i,"",null),(a=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"interview_date"}),this.addEditFieldToColumn($.i18n._("Interview Date"),a,i,"",null),(a=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),a,i,"",null,null,!0),a.parent().width("45%"),(a=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:950}),this.addEditFieldToColumn($.i18n._("Tags"),a,i,"",null,null,!0),(a=Global.loadWidgetByName(FormItemType.SEPARATED_BOX)).SeparatedBox({label:$.i18n._("Resume")}),a.addClass("resume-label"),this.addEditFieldToColumn(null,a,i)}setEditViewDataDone(){if(super.setEditViewDataDone(),!this.is_add){this.updateEmailLink(),this.removeFormItemResumePdf();var e=this,t=$("<div></div>").addClass("edit-view-form-item-div form_item_resume_pdf");e.edit_view_tab.find("#tab_job_application").find(".first-column").append(t);var i={filter_data:{},filter_columns:{"id":!0,"document_revision_id":!0}};i.filter_data.object_id=this.current_edit_record.job_applicant_id,i.filter_data.object_type_id=this.job_applicant_document_object_type_id,this.document_api["get"+this.document_api.key_name](i,{onResult:function(i){var a=[],o=i.getResult();!0!==o&&_.isArray(o)?(_.each(o,(function(t){var i=ServiceCaller.getURLByObjectType("file_download")+"&object_type=document&parent_id="+t.id;i=(i=i+"&parent_object_type_id="+e.job_applicant_document_object_type_id)+"&object_id="+t.document_revision_id,a.push(i)})),new TTPDFViewer({urls:a,target:t[0]})):t.append('<p class="no-documents-message">'+$.i18n._("Sorry, no documents have been attached yet.")+"</p>")}})}}buildSearchFields(){super.buildSearchFields();var e={permission_section:"job_application"};this.search_fields=[new SearchField({label:$.i18n._("Job Applicant"),in_column:1,field:"job_applicant_id",layout_name:"global_job_applicant",api_class:TTAPI.APIJobApplicant,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Job Vacancy"),in_column:1,field:"job_vacancy_id",layout_name:"global_job_vacancy",api_class:TTAPI.APIJobVacancy,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Interviewer"),in_column:1,field:"interviewer_user_id",default_args:e,layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:2,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:2,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Priority"),in_column:2,field:"priority_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:1,object_type_id:950,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.copy],include:[{label:$.i18n._("Edit<br>Applicant"),id:ContextMenuIconName.edit_job_applicant,group:"navigation",icon:Icons.edit},{label:$.i18n._("Hire Applicant"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Map"),id:ContextMenuIconName.map,group:"navigation",icon:Icons.map}]}}removeFormItemResumePdf(){this.edit_view&&this.edit_view.find(".form_item_resume_pdf").length>0&&this.edit_view.find(".form_item_resume_pdf").remove()}onCustomContextClick(e){switch(e){case ContextMenuIconName.map:this.onMapClick();break;case ContextMenuIconName.edit_job_applicant:case ContextMenuIconName.edit_employee:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}onMapClick(){if(Global.getProductEdition()>=15){this.is_viewing=!1;var e=this.getSelectedItems();this.is_mass_editing||Promise.all([i.e("vendors-node_modules_leaflet-draw_dist_leaflet_draw_js-node_modules_leaflet_dist_leaflet-src_js"),i.e("vendors-node_modules_leaflet_dist_images_marker-icon-2x_png-node_modules_leaflet_dist_images_-e2a419"),i.e("interface_html5_framework_leaflet_leaflet-timetrex_js"),i.e("leaflet-timetrex")]).then(i.bind(i,6889)).then((t=>{var i=t.TTConvertMapData.processBasicFromGenericViewController(e);IndexViewController.openEditView(this,"Map",i)})).catch(Global.importErrorHandler)}}getFilterColumnsFromDisplayColumns(){var e=super.getFilterColumnsFromDisplayColumns();return null==e&&(e={}),e.job_applicant_id=!0,e.latitude=!0,e.longitude=!0,this._getFilterColumnsFromDisplayColumns(e)}onNavigationClick(e){var t,i,a,o=this;switch(e){case ContextMenuIconName.edit_job_applicant:var n=this.getSelectedItem();IndexViewController.openEditView(o,"JobApplicant",n.job_applicant_id);break;case ContextMenuIconName.edit_employee:({filter_data:{}}),a=function(e){t={},i=o.edit_view?o.current_edit_record:o.getSelectedItem(),t.filter_data={},t.filter_data.id=[i.job_applicant_id],o.job_applicant_api.getJobApplicant(t,{onResult:function(t){var i=t.getResult();if(Global.isArray(i)&&i[0])for(var a in i=i[0],e)i[a]||(i[a]=e[a]);else i=[];IndexViewController.openEditView(o,"Employee",i)}})},o.user_api.getUserDefaultData({onResult:function(e){var t=e.getResult();a(t)}});break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name)}}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var o=$(this.context_menu_array[a]),n=$(o.find(".ribbon-sub-menu-icon")).attr("id");switch(o.removeClass("invisible-image"),o.removeClass("disable-image"),n){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(o,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(o,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(o,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(o,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(o,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(o,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(o,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(o,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(o,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(o,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(o,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(o,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(o,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(o,i);break;case ContextMenuIconName.edit_job_applicant:case ContextMenuIconName.edit_employee:this.setDefaultMenuEditIcon(o,i,"user");break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(o,i,"user");break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(o)}}this.setContextMenuGroupVisibility()}}setDefaultMenuMapIcon(e){Global.getProductEdition()<=10&&e.addClass("invisible-image");var t=!1;if(this.grid){var i=this.getSelectedItems();if(i.length>0)for(var a=0;a<i.length;a++)if(i[a]&&i[a].latitude&&i[a].longitude){t=!0;break}}t?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuMapIcon(e){this.setDefaultMenuMapIcon(e)}searchDone(){super.searchDone(),TTPromise.resolve("JobAppView","init")}onFormItemChange(e,t){if(this.current_edit_record){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField();this.current_edit_record[i]=e.getValue(),"job_applicant_id"===i&&this.updateEmailLink(),t||this.validate()}}updateEmailLink(){var e={};e.filter_data={id:this.current_edit_record.job_applicant_id},e.filter_columns={email:!0},this.job_applicant_api.getJobApplicant(e,{onResult:e=>{var t=e.getResult();t[0].email&&(document.getElementById("job-email-link").href="mailto:"+t[0].email+"?subject="+$.i18n._("Re")+": "+this.current_edit_record.job_vacancy+" "+$.i18n._("Application"))}})}}a.loadSubView=function(e,t,i){Global.loadViewSource("JobApplication","SubApplicationView.html",(function(a){var o=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(o({})),Global.isSet(i)&&i(sub_job_application_view_controller))}))}}}]);
//# sourceMappingURL=hr-recruitment-JobApplicationViewController.bundle.js.map?v=f352505a309c05c30466