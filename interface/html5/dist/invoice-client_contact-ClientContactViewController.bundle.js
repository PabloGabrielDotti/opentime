(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["invoice-client_contact-ClientContactViewController"],{7397:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"ClientContactViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#client_contact_view_container",status_array:null,type_array:null,country_array:null,province_array:null,e_province_array:null,district_array:null,company_api:null,area_policy_api:null,sub_document_view_controller:null,document_object_type_id:null}),super(e)}init(e){this.edit_view_tpl="ClientContactEditView.html",this.permission_id="client",this.viewId="ClientContact",this.script_name="ClientContactView",this.table_name_key="client_contact",this.document_object_type_id=85,this.context_menu_name=$.i18n._("Client Contacts"),this.navigation_label=$.i18n._("Client Contact")+":",this.api=TTAPI.APIClientContact,this.company_api=TTAPI.APICompany,this.area_policy_api=TTAPI.APIAreaPolicy,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){this.initDropDownOption("status"),this.initDropDownOption("type"),this.initDropDownOption("country","country",this.company_api)}getFilterColumnsFromDisplayColumns(){var e={client_id:!0};this._getFilterColumnsFromDisplayColumns(e,!0)}getCustomContextMenuModel(){var e={exclude:[],include:[{label:$.i18n._("Add<br>Company"),id:ContextMenuIconName.add_company,group:"other",icon:Icons.companies},{label:$.i18n._("Map"),id:ContextMenuIconName.map,group:"other",icon:Icons.map}]};return this.sub_view_mode?e.exclude.push(ContextMenuIconName.export_excel):e.include.push({label:$.i18n._("Edit Client"),id:ContextMenuIconName.edit_client,group:"navigation",icon:Icons.client},{label:$.i18n._("Invoices"),id:ContextMenuIconName.invoice,group:"navigation",icon:Icons.invoice},{label:$.i18n._("Transactions"),id:ContextMenuIconName.transaction,group:"navigation",icon:Icons.transaction},{label:$.i18n._("Payment Methods"),id:ContextMenuIconName.payment_method,group:"navigation",icon:Icons.payment_method},ContextMenuIconName.export_excel),e}setDefaultMenuAddCompanyIcon(e,t){PermissionManager.validate("company","enabled")&&PermissionManager.validate("company","add")||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var n=$(this.context_menu_array[a]),o=$(n.find(".ribbon-sub-menu-icon")).attr("id");switch(n.removeClass("invisible-image"),n.removeClass("disable-image"),o){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(n,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(n,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(n,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(n,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(n,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(n,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(n,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(n,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(n,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(n,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(n,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(n,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(n,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(n,i);break;case ContextMenuIconName.edit_client:this.setDefaultMenuEditClientIcon(n,i);break;case ContextMenuIconName.add_company:this.setDefaultMenuAddCompanyIcon(n,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(n,i);break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(n)}}this.setContextMenuGroupVisibility()}}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");if(i.removeClass("disable-image"),this.is_mass_editing)switch(a){case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;default:i.addClass("disable-image")}else switch(a){case ContextMenuIconName.add:this.setEditMenuAddIcon(i);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(i);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(i);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(i);break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(i);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(i);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(i);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(i);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(i);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(i);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.edit_client:this.setEditMenuEditClientIcon(i);break;case ContextMenuIconName.add_company:this.setEditMenuAddCompanyIcon(i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}setEditMenuAddCompanyIcon(e,t){this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuEditClientIcon(e,t){e.removeClass("disable-image"),this.is_mass_editing&&e.addClass("disable-image")}setDefaultMenuEditClientIcon(e,t,i){1===t?e.removeClass("disable-image"):e.addClass("disable-image")}onMapClick(){if(Global.getProductEdition()>=15){this.is_viewing=!1,ProgressBar.showProgressBar();var e={filter_columns:{id:!0,client:!0,first_name:!0,last_name:!0,type:!0,address1:!0,address2:!0,city:!0,province:!0,country:!0,postal_code:!0,latitude:!0,longitude:!0}},t=this.getGridSelectIdArray();e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),t.length>0&&(e.filter_data.id=t);var a=this.api.getClientContact(e,{async:!1}).getResult();this.is_mass_editing||Promise.all([i.e("vendors-node_modules_leaflet-draw_dist_leaflet_draw_js-node_modules_leaflet_dist_leaflet-src_js"),i.e("vendors-node_modules_leaflet_dist_images_marker-icon-2x_png-node_modules_leaflet_dist_images_-e2a419"),i.e("interface_html5_framework_leaflet_leaflet-timetrex_js"),i.e("leaflet-timetrex")]).then(i.bind(i,6889)).then((e=>{var t=e.TTConvertMapData.processBasicFromGenericViewController(a);IndexViewController.openEditView(this,"Map",t)})).catch(Global.importErrorHandler)}}onCustomContextClick(e){switch(e){case ContextMenuIconName.edit_client:case ContextMenuIconName.invoice:case ContextMenuIconName.transaction:case ContextMenuIconName.payment_method:this.onNavigationClick(e);break;case ContextMenuIconName.add_company:this.onAddCompanyClick();break;case ContextMenuIconName.map:this.onMapClick()}}onAddCompanyClick(){var e=this,t="";t=this.edit_view?this.current_edit_record.id:this.getGridSelectIdArray()[0],this.api.addCompany(t,{onResult:function(t){t.isValid()?e.search():TAlertManager.showErrorAlert(t)}})}onNavigationClick(e){var t,i=this,a={filter_data:{}},n=[];switch(i.edit_view&&i.current_edit_record.id?n.push(i.current_edit_record.client_id):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var a=i.getRecordFromGridById(t);n.push(a.client_id)}))),a.filter_data.client_id=n,e){case ContextMenuIconName.edit_client:n.length>0&&IndexViewController.openEditView(this,"Client",n[0]);break;case ContextMenuIconName.invoice:Global.addViewTab(i.viewId,$.i18n._("Client Contacts"),window.location.href),IndexViewController.goToView("Invoice",a);break;case ContextMenuIconName.transaction:Global.addViewTab(i.viewId,$.i18n._("Client Contacts"),window.location.href),IndexViewController.goToView("InvoiceTransaction",a);break;case ContextMenuIconName.payment_method:Global.addViewTab(i.viewId,$.i18n._("Client Contacts"),window.location.href),IndexViewController.goToView("ClientPayment",a)}}buildEditViewUI(){super.buildEditViewUI();var e=this,t={"tab_contact_information":{"label":$.i18n._("Contact Information")},"tab_policy":{"label":$.i18n._("Policy")},"tab_portal":{"label":$.i18n._("Portal")},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIUserTitle,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_client_contact",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_contact_information"),a=i.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a);var n=Global.loadWidgetByName(FormItemType.AWESOME_BOX);n.AComboBox({api_class:TTAPI.APIClient,allow_multiple_selection:!1,layout_name:"global_client",show_search_inputs:!0,set_empty:!0,field:"client_id"}),this.addEditFieldToColumn($.i18n._("Client"),n,a,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),n.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),n,a),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),n.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),n,a),(n=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"is_default"}),this.addEditFieldToColumn($.i18n._("Default"),n,a),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,field:"currency_id"}),this.addEditFieldToColumn($.i18n._("Currency"),n,a),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"first_name",width:150}),this.addEditFieldToColumn($.i18n._("First Name"),n,a),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"last_name",width:150}),this.addEditFieldToColumn($.i18n._("Last Name"),n,a),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address(Line 1)"),n,a),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address(Line 2)"),n,a),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address3",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address(Line 3)"),n,a),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:810}),this.addEditFieldToColumn($.i18n._("Tags"),n,a,"",null,null,!0);var o=i.find(".second-column");this.edit_view_tabs[0].push(o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"city",width:150}),this.addEditFieldToColumn($.i18n._("City"),n,o,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"country",set_empty:!0}),n.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Country"),n,o),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"province"}),n.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province / State"),n,o),n.change($.proxy((function(){var e=this.edit_view_ui_dic.country.getValue(),t=this.edit_view_ui_dic.province.getValue();this.setDistrict(e,t)}),this)),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"invoice_district_id",set_empty:!0}),n.setSourceData([]),this.addEditFieldToColumn($.i18n._("District"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"postal_code",width:150}),this.addEditFieldToColumn($.i18n._("Postal/ZIP Code"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone",width:150}),this.addEditFieldToColumn($.i18n._("Work Phone"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"mobile_phone",width:200}),this.addEditFieldToColumn($.i18n._("Mobile Phone"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"fax_phone",width:150}),this.addEditFieldToColumn($.i18n._("Fax"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"email",width:220}),this.addEditFieldToColumn($.i18n._("Email"),n,o),(n=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),n,o,"",null,null,!0),n.parent().width("45%");var l=this.edit_view_tab.find("#tab_policy").find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(l),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"include_tax_policy"}),this.addEditFieldToColumn($.i18n._("Include Tax Policy"),n,l,""),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"exclude_tax_policy"}),this.addEditFieldToColumn($.i18n._("Exclude Tax Policy"),n,l,"");var s=this.edit_view_tab.find("#tab_portal").find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(s),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"user_name",width:150}),this.addEditFieldToColumn($.i18n._("User Name"),n,s,""),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password",width:150}),this.addEditFieldToColumn($.i18n._("Password"),n,s),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password2",width:150}),this.addEditFieldToColumn($.i18n._("Password (Confirm)"),n,s,"")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Client"),in_column:1,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("First Name"),in_column:1,field:"first_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Last Name"),in_column:1,field:"last_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:1,object_type_id:810,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Phone"),field:"any_phone",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Email"),field:"email",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}setSelectLayout(){this.sub_view_mode?super.setSelectLayout(["client"]):super.setSelectLayout()}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField();switch(this.current_edit_record[i]=e.getValue(),i){case"country":var a=this.edit_view_ui_dic.province;a.setValue(null);break;case"province":(a=this.edit_view_ui_dic.invoice_district_id).setValue(null)}"country"!==i?t||this.validate():this.onCountryChange()}onGridDblClickRow(){this.onEditClick()}setCurrentEditRecordData(){for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"country":this.setCountryValue(t,e);break;case"province":this.setDistrict(this.current_edit_record.country,this.current_edit_record[e]),t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}onSetSearchFilterFinished(){if(1===this.search_panel.getSelectTabIndex()){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e)}}setProvince(e,t){var i=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e),i.adv_search_field_ui_dic.province.setSourceData(i.province_array)}}):(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e,t){var i=this,a=i.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.e_province_array=Global.buildRecordArray(e),t&&i.e_province_array.length>0&&(i.current_edit_record.province=i.e_province_array[0].value,a.setValue(i.current_edit_record.province)),a.setSourceData(i.e_province_array)}}):(i.e_province_array=[],a.setSourceData([]))}setDistrict(e,t){var i=this,a=i.edit_view_ui_dic.invoice_district_id;Global.isSet(e)&&"-1"!==e&&"0"!==e&&Global.isSet(t)&&"-1"!==t&&"0"!==t?this.area_policy_api.getDistrictOptions(e,t,{onResult:function(e){(e=e.getResult())||(e=[]),i.district_array=Global.buildRecordArray(e),a.setSourceData(i.district_array)}}):(i.district_array=[],a.setSourceData([]))}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}removeEditView(){super.removeEditView(),this.sub_client_contact_view_controller=null}}a.loadSubView=function(e,t,i){Global.loadViewSource("ClientContact","SubClientContactView.html",(function(a){var n=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(n({})),Global.isSet(i)&&i(sub_client_contact_view_controller))}))}}}]);
//# sourceMappingURL=invoice-client_contact-ClientContactViewController.bundle.js.map?v=7ae6514bc450c588d88e