{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImageBrowser.js","webpack://timetrex/./interface/html5/views/my_account/expense/ExpenseAuthorizationViewController.js"],"names":["$","fn","TImageBrowser","options","Global","addCss","field","browser","opts","extend","defaults","$this","this","name","accept_filter","default_width","default_height","setEnabled","val","btn","find","removeAttr","removeClass","attr","addClass","clearErrorStyle","getFileName","getField","setEnableDelete","image","getValue","FormData","getImageSrc","setImage","hide","d","Date","getTime","css","setValue","each","o","meta","data","isSet","on","image_height","height","naturalHeight","image_width","width","naturalWidth","trigger","show","onImageLoad","changeHandler","bind","deleteImageHandler","FileReader","files","length","window","reader","readAsDataURL","onloadend","url","result","jQuery","ExpenseAuthorizationViewController","BaseViewController","_","el","hierarchy_level_array","status_array","payment_method_array","sub_document_view_controller","document_object_type_id","relatedExpenseArray","document_api","super","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","i18n","navigation_label","api","TTAPI","APIUserExpense","message_control_api","APIMessageControl","getProductEdition","job_api","APIJob","job_item_api","APIJobItem","APIDocument","authorization_api","APIAuthorization","hierarchy_type_id","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","args","filter_data","user_id","current_edit_record","LocalCacheData","getLoginUser","id","initDropDownOption","basic_search_field_ui_dic","setDefaultArgs","getHierarchyLevelOptions","async","getResult","buildRecordArray","setSourceData","filter","hierarchy_level","value","groups","authorization","label","objects","exclude","include","ContextMenuIconName","edit","group","icon","Icons","view","cancel","pass","decline","authorization_request","permission_result","PermissionManager","checkTopLevelPermission","authorization_timesheet","selected","authorization_expense","timesheet","schedule","edit_employee","employee","export_excel","sort_order","doNotSetFocus","context_menu_array","selectContextMenu","setTotalDisplaySpan","len","grid_selected_length","getGridSelectIdArray","i","context_btn","setDefaultMenuEditIcon","save","setDefaultMenuSaveIcon","setDefaultMenuCancelIcon","setDefaultMenuAuthorizationIcon","setDefaultMenuPassIcon","setDefaultMenuDeclineIcon","setDefaultMenuAuthorizationRequestIcon","setDefaultMenuAuthorizationTimesheetIcon","setDefaultMenuAuthorizationExpenseIcon","setDefaultMenuViewIcon","setDefaultMenuExportIcon","setContextMenuGroupVisibility","pId","is_mass_editing","setEditMenuSaveIcon","setEditMenuEditIcon","setEditMenuAuthorizationIcon","setEditMenuPassIcon","setEditMenuDeclineIcon","setEditMenuAuthorizationRequestIcon","setEditMenuAuthorizationTimesheetIcon","setEditMenuAuthorizationExpenseIcon","setEditMenuNavViewIcon","setEditMenuNavEditIcon","onAuthorizationClick","onPassClick","onDeclineClick","onAuthorizationRequestClick","onAuthorizationTimesheetClick","onAuthorizationExpenseClick","onNavigationClick","iconName","grid_selected_id_array","base_date","ids","user_ids","edit_view","push","incurred_date","index","grid_selected_row","getRecordFromGridById","start_date","IndexViewController","openEditView","addViewTab","location","href","goToView","include_users","include_user_ids","select_date","onExportClick","key_name","record","uniformVariable","onResult","isValid","is_changed","onSaveResult","setAuthorization","setErrorMenu","setErrorTips","onRightArrowClick","search","TFeedback","source","authorized","object_id","object_type_id","res","authorization_value","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","form_item_input","widgetContainer","tab_expense","edit_view_tab","tab_expense_column1","tab_expense_column2","edit_view_tabs","loadWidgetByName","FormItemType","AWESOME_BOX","APIUser","set_empty","addEditFieldToColumn","DATE_PICKER","TDatePicker","TEXT_AREA","TTextArea","parent","COMBO_BOX","TComboBox","APIExpensePolicy","TEXT_INPUT","TTextInput","widget_checkbox","CHECKBOX","TCheckbox","append","APICurrency","APIBranch","APIDepartment","setRealValueCallBack","job_coder","manual_id","disable_keyup_event","job_item_coder","TAG_INPUT","TTagInput","inside_editor_div","inside_editor_args","action","editor","INSIDE_EDITOR","InsideEditor","addRow","insideEditorAddRow","removeRow","insideEditorRemoveRow","insideEditorGetValue","insideEditorSetValue","parent_controller","render_args","row_render","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","set_any","key","hasOwnProperty","widget","edit_view_ui_dic","job_id","collectUIDataToCurrentEditRecord","setEditViewDataDone","setRelatedExpense","initInsideEditorData","AuthorizationHistory","init","removeAllRows","getDefaultData","row","rows_widgets_array","file","getRowRender","getRender","widgets","form_item_file_name","TEXT","TText","setClassStyle","children","eq","document_revision_id","download","document_id","downloadFile","form_item_file","IMAGE_BROWSER","file_browser","a","file_name","insertAfter","splice","is_viewing","addIconsEvent","removeLastRowLine","document_attachment_id","ServiceCaller","getURLByObjectType","APIFileDownload","rowIndex","remove_id","TTUUID","isUUID","zero_id","not_exist_id","TAlertManager","showConfirmAlert","text","ProgressBar","showOverlay","closeOverlay","remove","target","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","c_value","amount_arr","related_expense_policy_id","setRelatedExpenseData","setJobItemValueWhenJobChanged","setCheckBox","onJobQuickSearch","validate","expenses","selected_related_expense_policy_id","tab_expense_column3","tax_inputs","n","amount","empty","net_amount","gross_amount","reimburse_amount","Object","keys","item","editFieldResize","records","related_expenses","force_no_confirm","cancel_all","callback","onCancelClick","result_data","refresh_id","saveInsideEditorData","onCopyAsNewClick","callBack","success","fileItem","addAttachment","uploadFile","document_result","file_data","upload_file_result"],"mappings":"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","file":"my_account-expense-ExpenseAuthorizationViewController.bundle.js?v=dd39a1da72d6e72478d2","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageBrowser = function( options ) {\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar id = 'file_browser';\n\t\tvar name = 'filedata';\n\t\tvar browser;\n\n\t\tvar accept_filter = '';\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\t\tvar enabled = true;\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.find( '.browser-form input' );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getFileName = function() {\n\n\t\t\treturn browser.val();\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\tvar form_data;\n\t\t\tif ( browser && browser.val() ) {\n\n\t\t\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\t\t\tform_data = $this.find( '.browser-form' );\n\t\t\t\t} else {\n\t\t\t\t\tform_data = new FormData( $( $this.find( '.browser-form' ) )[0] );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tform_data = null;\n\t\t\t}\n\n\t\t\treturn form_data;\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t$this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.each( function() {\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\t// var $this = this;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tbrowser = $( this ).find( '.browser' );\n\t\t\tvar image = $( this ).find( '.image' );\n\t\t\timage.hide();\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tif ( accept_filter ) {\n\t\t\t\tbrowser.attr( 'accept', accept_filter );\n\t\t\t} else {\n\t\t\t\taccept_filter = 'image/*';\n\t\t\t\tbrowser.attr( 'accept', 'image/*' );\n\t\t\t}\n\n\t\t\tbrowser.attr( 'id', id );\n\t\t\tbrowser.attr( 'name', name );\n\n\t\t\tif ( Global.isSet( o.changeHandler ) ) {\n\n\t\t\t\t$this.bind( 'imageChange', o.changeHandler );\n\t\t\t}\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\tthis.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tbrowser.bind( 'change', function() {\n\t\t\t\timage.hide();\n\n\t\t\t\tif ( typeof FileReader != 'undefined' ) {\n\n\t\t\t\t\tvar files = !!this.files ? this.files : [];\n\n\t\t\t\t\t// If no files were selected, or no FileReader support, return\n\t\t\t\t\tif ( !files.length || !window.FileReader ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( accept_filter === 'image/*' ) {\n\t\t\t\t\t\t// Create a new instance of the FileReader\n\t\t\t\t\t\tvar reader = new FileReader();\n\n\t\t\t\t\t\t// Read the local file as a DataURL\n\t\t\t\t\t\treader.readAsDataURL( files[0] );\n\n\t\t\t\t\t\t// When loaded, set image data as background of div\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = this.result;\n\t\t\t\t\t\t\timage.attr( 'src', url );\n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'imageChange', [$this] );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageBrowser.defaults = {};\n\n} )( jQuery );","import '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class ExpenseAuthorizationViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#expense_authorization_view_container',\n\n\t\t\t// _required_files: ['TImageBrowser'],\n\n\t\t\thierarchy_level_array: null,\n\t\t\tstatus_array: null,\n\n\t\t\tpayment_method_array: null,\n\n\t\t\tsub_document_view_controller: null,\n\n\t\t\tdocument_object_type_id: null,\n\n\t\t\trelatedExpenseArray: null,\n\n\t\t\tdocument_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'ExpenseAuthorizationEditView.html';\n\t\tthis.permission_id = 'user_expense';\n\t\tthis.viewId = 'ExpenseAuthorization';\n\t\tthis.script_name = 'ExpenseAuthorizationView';\n\t\tthis.table_name_key = 'user_expense';\n\t\tthis.context_menu_name = $.i18n._( 'Expense (Authorizations)' );\n\t\tthis.navigation_label = $.i18n._( 'Expense' ) + ':';\n\t\tthis.api = TTAPI.APIUserExpense;\n\t\tthis.message_control_api = TTAPI.APIMessageControl;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\n\t\tthis.document_api = TTAPI.APIDocument;\n\t\tthis.authorization_api = TTAPI.APIAuthorization;\n\n\t\tthis.document_object_type_id = 400;\n\n\t\tthis.hierarchy_type_id = 200;\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [this.current_edit_record ? this.current_edit_record.user_id : LocalCacheData.getLoginUser().id];\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.initDropDownOption( 'payment_method' );\n\n\t\targs.filter_data = filter_data;\n\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['expense_policy_id'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['expense_policy_id'].setDefaultArgs( args );\n\t\t}\n\n\t\tvar res = this.api.getHierarchyLevelOptions( [-1], { async: false } );\n\t\tvar data = res.getResult();\n\t\t$this['hierarchy_level_array'] = Global.buildRecordArray( data );\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['hierarchy_level'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['hierarchy_level'].setSourceData( Global.buildRecordArray( data ) );\n\t\t}\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tfilter['parent_id'] = 0;\n\t\tif ( !Global.isSet( filter.hierarchy_level ) ) {\n\t\t\tfilter['hierarchy_level'] = 1;\n\t\t\tthis.filter_data['hierarchy_level'] = {\n\t\t\t\tfield: 'hierarchy_level',\n\t\t\t\tid: '',\n\t\t\t\tvalue: this.basic_search_field_ui_dic['hierarchy_level'].getValue( true )\n\t\t\t};\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tauthorization: {\n\t\t\t\t\tlabel: $.i18n._( 'Authorization' ),\n\t\t\t\t\tid: this.script_name + 'Authorization'\n\t\t\t\t},\n\t\t\t\tobjects: {\n\t\t\t\t\tlabel: $.i18n._( 'Objects' ),\n\t\t\t\t\tid: this.script_name + 'objects'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View' ),\n\t\t\t\t\tid: ContextMenuIconName.edit, // copy pasted this value, but 'edit' seems deliberate. clicking this icon opens edit view, not view. Double check before changing.\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\ticon: Icons.view\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Cancel' ),\n\t\t\t\t\tid: ContextMenuIconName.cancel,\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\ticon: Icons.cancel\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Authorize' ),\n\t\t\t\t\tid: ContextMenuIconName.authorization,\n\t\t\t\t\tgroup: 'authorization',\n\t\t\t\t\ticon: Icons.authorization\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Pass' ),\n\t\t\t\t\tid: ContextMenuIconName.pass,\n\t\t\t\t\tgroup: 'authorization',\n\t\t\t\t\ticon: Icons.pass\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Decline' ),\n\t\t\t\t\tid: ContextMenuIconName.decline,\n\t\t\t\t\tgroup: 'authorization',\n\t\t\t\t\ticon: Icons.decline\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Request<br>Authorizations' ),\n\t\t\t\t\tid: ContextMenuIconName.authorization_request,\n\t\t\t\t\tgroup: 'objects',\n\t\t\t\t\ticon: Icons.authorization_request,\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'RequestAuthorization' )\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet<br>Authorizations' ),\n\t\t\t\t\tid: ContextMenuIconName.authorization_timesheet,\n\t\t\t\t\tgroup: 'objects',\n\t\t\t\t\ticon: Icons.authorization_timesheet,\n\t\t\t\t\tselected: false,\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'TimeSheetAuthorization' )\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Expense<br>Authorizations' ),\n\t\t\t\t\tid: ContextMenuIconName.authorization_expense,\n\t\t\t\t\tgroup: 'objects',\n\t\t\t\t\ticon: Icons.authorization_expense,\n\t\t\t\t\tselected: true,\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'ExpenseAuthorization' )\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet' ),\n\t\t\t\t\tid: ContextMenuIconName.timesheet,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.timesheet\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Schedule' ),\n\t\t\t\t\tid: ContextMenuIconName.schedule,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.schedule\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit<br>Employee' ),\n\t\t\t\t\tid: ContextMenuIconName.edit_employee,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.employee\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Export' ),\n\t\t\t\t\tid: ContextMenuIconName.export_excel,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.export_excel,\n\t\t\t\t\tsort_order: 9000\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t\tthis.selectContextMenu();\n\t\t}\n\n\t\tthis.setTotalDisplaySpan();\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization:\n\t\t\t\t\tthis.setDefaultMenuAuthorizationIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.pass:\n\t\t\t\t\tthis.setDefaultMenuPassIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.decline:\n\t\t\t\t\tthis.setDefaultMenuDeclineIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_request:\n\t\t\t\t\tthis.setDefaultMenuAuthorizationRequestIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_timesheet:\n\t\t\t\t\tthis.setDefaultMenuAuthorizationTimesheetIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_expense:\n\t\t\t\t\tthis.setDefaultMenuAuthorizationExpenseIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, 'punch' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.schedule:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length, 'schedule' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length, 'user' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tsetDefaultMenuEditIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuSaveIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.addClass( 'invisible-image' );\n\t}\n\n\tsetDefaultMenuAuthorizationIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuPassIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuDeclineIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetEditMenu() {\n\n\t\tthis.selectContextMenu();\n\t\tvar len = this.context_menu_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tswitch ( id ) {\n\t\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setEditMenuEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization:\n\t\t\t\t\tthis.setEditMenuAuthorizationIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.pass:\n\t\t\t\t\tthis.setEditMenuPassIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.decline:\n\t\t\t\t\tthis.setEditMenuDeclineIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_request:\n\t\t\t\t\tthis.setEditMenuAuthorizationRequestIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_timesheet:\n\t\t\t\t\tthis.setEditMenuAuthorizationTimesheetIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.authorization_expense:\n\t\t\t\t\tthis.setEditMenuAuthorizationExpenseIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\t\tthis.setEditMenuNavViewIcon( context_btn, 'punch' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.schedule:\n\t\t\t\t\tthis.setEditMenuNavViewIcon( context_btn, 'schedule' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\t\tthis.setEditMenuNavEditIcon( context_btn, 'user' );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tsetDefaultMenuAuthorizationRequestIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuAuthorizationTimesheetIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuAuthorizationExpenseIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !( Global.getProductEdition() >= 25 ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetEditMenuAuthorizationRequestIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuAuthorizationTimesheetIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuAuthorizationExpenseIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuEditIcon( context_btn ) {\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetEditMenuSaveIcon( context_btn ) {\n\t\tcontext_btn.addClass( 'invisible-image' );\n\t}\n\n\tsetEditMenuAuthorizationIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuPassIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuDeclineIcon( context_btn ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.authorization:\n\t\t\t\tthis.onAuthorizationClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.pass:\n\t\t\t\tthis.onPassClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.decline:\n\t\t\t\tthis.onDeclineClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.authorization_request:\n\t\t\t\tthis.onAuthorizationRequestClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.authorization_timesheet:\n\t\t\t\tthis.onAuthorizationTimesheetClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.authorization_expense:\n\t\t\t\tthis.onAuthorizationExpenseClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\tcase ContextMenuIconName.schedule:\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tvar $this = this;\n\n\t\tvar grid_selected_id_array;\n\n\t\tvar filter = {};\n\n\t\tvar ids = [];\n\n\t\tvar user_ids = [];\n\n\t\tvar base_date;\n\t\tif ( $this.edit_view && $this.current_edit_record.id ) {\n\t\t\tids.push( $this.current_edit_record.id );\n\t\t\tuser_ids.push( $this.current_edit_record.user_id );\n\t\t\tbase_date = $this.current_edit_record.incurred_date;\n\t\t} else {\n\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t\tvar grid_selected_row = $this.getRecordFromGridById( value );\n\t\t\t\tids.push( grid_selected_row.id );\n\t\t\t\tuser_ids.push( grid_selected_row.user_id );\n\t\t\t\tbase_date = grid_selected_row.start_date;\n\t\t\t} );\n\t\t}\n\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\tif ( user_ids.length > 0 ) {\n\t\t\t\t\tIndexViewController.openEditView( this, $.i18n._( 'Employee' ), user_ids[0] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\tif ( user_ids.length > 0 ) {\n\t\t\t\t\tfilter.user_id = user_ids[0];\n\t\t\t\t\tfilter.base_date = base_date;\n\t\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Authorization - Expense' ), window.location.href );\n\t\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.schedule:\n\t\t\t\tfilter.filter_data = {};\n\t\t\t\tvar include_users = { value: user_ids };\n\t\t\t\tfilter.filter_data.include_user_ids = include_users;\n\t\t\t\tfilter.select_date = base_date;\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'Authorization - Expense' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Schedule', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\tthis.onExportClick( 'export' + this.api.key_name );\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tonAuthorizationExpenseClick() {\n\t\tIndexViewController.goToView( 'ExpenseAuthorization' );\n\t}\n\n\tonAuthorizationTimesheetClick() {\n\t\tIndexViewController.goToView( 'TimeSheetAuthorization' );\n\t}\n\n\tonAuthorizationRequestClick() {\n\t\tIndexViewController.goToView( 'RequestAuthorization' );\n\t}\n\n\tonAuthorizationClick() {\n\t\tvar $this = this;\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.uniformVariable( record );\n\n\t\tthis.api['set' + this.api.key_name]( record, false, false, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) { //Don't try to authorize the expense if validation fails, display the validation errors and stop.\n\t\t\t\t\t$this.is_changed = false;\n\t\t\t\t\t$this.onSaveResult( result );\n\n\t\t\t\t\t$this.setAuthorization( true );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t\t$this.setErrorTips( result, true );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tonPassClick() {\n\t\tvar $this = this;\n\t\tthis.onRightArrowClick( function() {\n\t\t\t$this.search();\n\t\t\t$().TFeedback( {\n\t\t\t\tsource: 'Pass'\n\t\t\t} );\n\t\t} );\n\t}\n\n\tonDeclineClick() {\n\t\tthis.setAuthorization( false );\n\t}\n\n\tsetAuthorization( authorized ) {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\n\t\tfilter.authorized = authorized ? authorized : false;\n\t\tfilter.object_id = $this.current_edit_record.id;\n\t\tfilter.object_type_id = 200;\n\n\t\t$this.authorization_api['setAuthorization']( [filter], {\n\t\t\tonResult: function( res ) {\n\t\t\t\t$this.onRightArrowClick( function() {\n\t\t\t\t\t$this.search();\n\t\t\t\t\tvar authorization_value = authorized ? 'Authorize' : 'Decline';\n\t\t\t\t\t$().TFeedback( {\n\t\t\t\t\t\tsource: authorization_value\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_expense': { 'label': $.i18n._( 'Expense' ) },\n\t\t\t'tab_attachment': true,\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUserExpense,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\n\t\tvar tab_expense_column1 = tab_expense.find( '.first-column' );\n\t\tvar tab_expense_column2 = tab_expense.find( '.second-column' );\n\t\t//var authorization_history_column = tab_expense.find( '.auth-history-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_expense_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_expense_column2 );\n\t\t//this.edit_view_tabs[0].push( authorization_history_column );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Employee\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tfield: 'user_id',\n\t\t\tset_empty: false\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Date Incurred\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'incurred_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date Incurred' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_expense_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Payment Method\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'payment_method_id' } );\n\t\tform_item_input.setSourceData( $this.payment_method_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Method' ), form_item_input, tab_expense_column1 );\n\n\t\t// Type\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_data = filter_data;\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense_policy',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'expense_policy_id'\n\t\t} );\n\n\t\tform_item_input.setDefaultArgs( args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_expense_column1 );\n\n\t\t//Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'gross_amount1' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box \\'></div>' );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'Reimburse' ) + ': ' + ' </span>' );\n\n\t\tvar widget_checkbox = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\twidget_checkbox.TCheckbox( { field: 'is_reimbursable' } );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( label );\n\t\twidgetContainer.append( widget_checkbox );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), [form_item_input, widget_checkbox], tab_expense_column1, '', widgetContainer );\n\n\t\t// Currency\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_expense_column2, '' );\n\n\t\t//Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_expense_column2 );\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_expense_column2 );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t}\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 930 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_expense_column2, '', null, null, true );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_expense.find( '.inside-editor-div' );\n\n\t\tvar inside_editor_args = {\n\t\t\tname: $.i18n._( 'Attachment  Name' ),\n\t\t\taction: $.i18n._( 'Action' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.document_api,\n\t\t\trender: 'views/my_account/expense/DocumentViewInsideEditorRender.html',\n\t\t\trender_args: inside_editor_args,\n\t\t\trow_render: 'views/my_account/expense/DocumentViewInsideEditorRow.html'\n\n\t\t} );\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'expense_policy_id',\n\t\t\t\tlayout_name: 'global_expense_policy',\n\t\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 930,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Hierarchy Level' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: false,\n\t\t\t\tset_any: false,\n\t\t\t\tfield: 'hierarchy_level',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\t/* jshint ignore:start */\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount1':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record['gross_amount'] );\n\t\t\t\t\t\t//this.onFormItemChange(widget); //This causes onFormItemChange() to trigger for gross_amount1, causing the related expense policies to be recalculated when the view appears. So if the user specified custom taxes they will get wiped out.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount':\n\t\t\t\t\tcase 'net_amount':\n\t\t\t\t\t\t// Don't do anything.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\n\t\tthis.setEditViewDataDone();\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tvar $this = this;\n\t\tthis.is_changed = false;\n\n\t\tif ( Global.isSet( this.current_edit_record['related_expenses'] ) ) {\n\t\t\tthis.relatedExpenseArray = this.current_edit_record['related_expenses'];\n\t\t\tthis.setRelatedExpense( this.current_edit_record['related_expenses'] );\n\t\t}\n\n\t\tthis.initInsideEditorData();\n\t\tAuthorizationHistory.init( this );\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\t\t} else {\n\n\t\t\targs.filter_data.object_type_id = this.document_object_type_id;\n\t\t\targs.filter_data.object_id = this.current_edit_record['id'];\n\n\t\t\t$this.api['getAttachment']( args, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\t$this.editor.setValue( data );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tinsideEditorGetValue() {\n\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tif ( Global.isSet( row.file ) ) {\n\t\t\t\tvar data = {\n\t\t\t\t\tname: row.name.getValue(),\n\t\t\t\t\tfile: row.file.getValue()\n\t\t\t\t};\n\n\t\t\t\tif ( data.name === 'No File Selected' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\t\t\tvar row = this.getRowRender(); //Get Row render\n\t\t\tvar render = this.getRender(); //get render, should be a table\n\t\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t\t//Build row widgets\n\n\t\t\t// Attachment Name\n\t\t\tvar form_item_file_name = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_file_name.TText( { field: 'name', width: 400 } );\n\t\t\tform_item_file_name.setValue( data.name ? data.name : $.i18n._( 'No File Selected' ) );\n\t\t\tform_item_file_name.setClassStyle( data.name ? { 'font-weight': 'bold' } : null );\n\t\t\twidgets[form_item_file_name.getField()] = form_item_file_name;\n\t\t\trow.children().eq( 0 ).append( form_item_file_name );\n\t\t\tform_item_file_name.attr( 'document_id', ( data.id && this.parent_controller.current_edit_record.id ) ? data.id : '' );\n\t\t\tform_item_file_name.attr( 'document_revision_id', ( data.document_revision_id && this.parent_controller.current_edit_record.id ) ? data.document_revision_id : '' );\n\n\t\t\t// Action\n\t\t\tif ( data.name ) {\n\n\t\t\t\tvar widgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\t\tvar download = $( '<button type=\\'button\\' class=\\' download-button t-button widget-right-label\\'>' + $.i18n._( 'Download' ) + '</button>' );\n\t\t\t\tvar view = $( '<button type=\\'button\\' class=\\' view-button t-button widget-right-label\\'>' + $.i18n._( 'View' ) + '</button>' );\n\n\t\t\t\tdownload.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\t\t\t\tview.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\n\t\t\t\tdownload.bind( 'click', this.parent_controller.downloadFile );\n\t\t\t\tview.bind( 'click', this.parent_controller.downloadFile );\n\n\t\t\t\twidgetContainer.append( download );\n\t\t\t\twidgetContainer.append( view );\n\n\t\t\t\trow.children().eq( 1 ).append( widgetContainer );\n\t\t\t} else {\n\t\t\t\tvar form_item_file = Global.loadWidgetByName( FormItemType.IMAGE_BROWSER );\n\n\t\t\t\tvar $this = this.file_browser = form_item_file.TImageBrowser( {\n\t\t\t\t\t\tfield: 'file',\n\t\t\t\t\t\tname: 'filedata',\n\t\t\t\t\t\taccept_filter: '*',\n\t\t\t\t\t\tchangeHandler: function( a ) {\n\t\t\t\t\t\t\tvar file_name = $( this ).find( '.browser' )[0].files[0].name;\n\t\t\t\t\t\t\tform_item_file_name.setValue( file_name );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\twidgets[form_item_file.getField()] = form_item_file;\n\t\t\t\trow.children().eq( 1 ).append( form_item_file );\n\n\t\t\t}\n\n\t\t\t// end\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\t}\n\n\tdownloadFile() {\n\n\t\tvar $this = $( this );\n\t\tvar document_attachment_id = $this.attr( 'document_id' );\n\t\tvar document_revision_id = $this.attr( 'document_revision_id' );\n\t\tvar object_type_id = $this.attr( 'object_type_id' );\n\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + document_attachment_id + '&parent_object_type_id=' + object_type_id + '&object_id=' + document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].name.attr( 'document_id' );\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showConfirmAlert( 'Are you sure to ' + this.rows_widgets_array[index].name.text() + '?', null, function( result ) {\n\t\t\t\tif ( result ) {\n\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t$this.api['delete' + $this.api.key_name]( remove_id, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\t\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t\t\t\t\t$this.getDefaultData();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\trow.remove();\n\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t}\n\n\t\tthis.removeLastRowLine();\n\t}\n\n\t/* jshint ignore:start */\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tvar amount_arr = false;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'expense_policy_id':\n\t\t\tcase 'gross_amount1':\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t{\n\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'is_reimbursable':\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tamount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t{\n\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'amount':\n\t\t\t\tvar related_expense_policy_id = target.attr( 'id' );\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tthis.relatedExpenseArray['taxes'][related_expense_policy_id]['amount'] = c_value;\n\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], this.relatedExpenseArray, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t{\n\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t$this.setRelatedExpenseData( $this.relatedExpenseArray, related_expense_policy_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', { job_id: this.current_edit_record.job_id } );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\t/**\n\t * this just sets the subform data\n\t * should be called in most cases\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpenseData( expenses, selected_related_expense_policy_id ) {\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' );\n\n\t\ttab_expense_column3.find( '#net_amount' ).val( expenses['net_amount'] );\n\t\ttab_expense_column3.find( '#gross_amount' ).val( expenses['gross_amount'] );\n\t\ttab_expense_column3.find( '#reimburse_amount' ).val( expenses['reimburse_amount'] );\n\n\t\tvar tax_inputs = tab_expense_column3.find( '.tax_input' );\n\t\tfor ( var n = 0; n < tax_inputs.length; n++ ) {\n\t\t\tvar el = $( tax_inputs[n] );\n\t\t\tif ( el.length > 0 ) {\n\t\t\t\tvar id = el.attr( 'id' );\n\t\t\t\tif ( !selected_related_expense_policy_id || selected_related_expense_policy_id != id ) {\n\t\t\t\t\tel.val( expenses['taxes'][id].amount );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\t/**\n\t * rebuilds the entire subform ui\n\t * we need to call this when type changes or reimburse is checked to add and remove fields\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpense( expenses ) {\n\n\t\t// Third column start\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' ).empty();\n\n\t\tif ( this.edit_view_tabs[0].length < 3 ) {\n\t\t\tthis.edit_view_tabs[0].push( tab_expense_column3 );\n\t\t}\n\n\t\tif ( !expenses ) {\n\t\t\texpenses = { net_amount: 0, gross_amount: 0, reimburse_amount: this.current_edit_record.reimburse_amount };\n\t\t}\n\n\t\tif ( expenses && expenses['taxes'] && Object.keys( expenses['taxes'] ).length > 0 ) {\n\t\t\t// Net Amount\n\t\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'net_amount' } );\n\t\t\tform_item_input.setValue( expenses['net_amount'] );\n\t\t\tform_item_input.attr( 'id', 'net_amount' );\n\t\t\tform_item_input.setEnabled( false );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Net Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['net_amount'].css( 'opacity', 1 );\n\n\t\t\tif ( expenses['taxes'] ) {\n\t\t\t\tfor ( var key in expenses['taxes'] ) {\n\t\t\t\t\tvar item = expenses['taxes'][key];\n\n\t\t\t\t\t// taxes\n\t\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\t\tform_item_input.TTextInput( { field: 'amount' } );\n\t\t\t\t\tform_item_input.setValue( item['amount'] );\n\t\t\t\t\tform_item_input.attr( 'id', item['expense_policy_id'] );\n\t\t\t\t\tform_item_input.addClass( 'tax_input' );\n\t\t\t\t\tthis.addEditFieldToColumn( $.i18n._( item['expense_policy_name'] ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\t\t\tthis.edit_view_ui_dic['amount'].css( 'opacity', 1 );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Amount\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_input.TText( { field: 'gross_amount' } );\n\t\t\tform_item_input.setValue( expenses['gross_amount'] );\n\t\t\tform_item_input.attr( 'id', 'gross_amount' );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['gross_amount'].css( 'opacity', 1 );\n\t\t}\n\n\t\t// Reimburse Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'reimburse_amount' } );\n\t\tform_item_input.setValue( expenses['reimburse_amount'] );\n\t\tform_item_input.attr( 'id', 'reimburse_amount' );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Reimburse Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\tthis.edit_view_ui_dic['reimburse_amount'].css( 'opacity', 1 );\n\n\t\tthis.editFieldResize( 0 );\n\t}\n\n\tuniformVariable( records ) {\n\t\tif ( this.relatedExpenseArray ) {\n\t\t\trecords.related_expenses = this.relatedExpenseArray;\n\t\t\trecords.gross_amount = this.relatedExpenseArray.gross_amount;\n\t\t\trecords.net_amount = this.relatedExpenseArray.net_amount;\n\t\t\trecords.reimburse_amount = this.relatedExpenseArray.reimburse_amount;\n\t\t}\n\n\t\treturn records;\n\t}\n\n\t// onSaveAndContinueResult( result ) {\n\t//\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onEditClick( $this.refresh_id, true );\n\t//\n\t// \t\t\t$this.onSaveAndContinueDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t// onSaveAndNewResult: function( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onAddClick( true );\n\t//\n\t// \t\t} );\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonCancelClick( force_no_confirm, cancel_all, callback ) {\n\t\t//Refresh grid on cancel as its not done during authorize/decline anymore.\n\t\tvar $this = this;\n\t\tsuper.onCancelClick( force_no_confirm, cancel_all, function() {\n\t\t\t//Since we are overriding the callback function to call this.search(), make sure the original callback is still called.\n\t\t\tif ( callback ) {\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\t$this.search();\n\t\t} );\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\n\t\t\t\t$this.onCopyAsNewClick();\n\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\t// onSaveAndNextResult( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.onRightArrowClick();\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onSaveAndNextDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsaveInsideEditorData( callBack ) {\n\t\tvar $this = this;\n\t\tvar data = this.editor.getValue();\n\t\tvar files = data.length;\n\t\tif ( files > 0 ) {\n\t\t\tvar success = 0;\n\t\t\tfor ( var key in data ) {\n\t\t\t\tvar fileItem = data[key];\n\t\t\t\tif ( Global.isSet( fileItem.file ) ) {\n\n\t\t\t\t\tvar document_revision_id = this.api.addAttachment( fileItem.name, this.document_object_type_id, this.refresh_id, { async: false } ).getResult();\n\t\t\t\t\t$this.api.uploadFile( fileItem.file, 'object_type=document_revision&object_id=' + document_revision_id + '&parent_object_type_id=' + this.document_object_type_id, {} );\n\n\t\t\t\t\tsuccess++;\n\n\t\t\t\t} else {\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( success === files ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\n\t\t} else {\n\t\t\tcallBack();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tuploadFile( document_result, file_data ) {\n\t\tvar document_revision_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\t$this.api.uploadFile( file_data, 'object_type=document_revision&object_id=' + document_revision_id, {\n\t\t\tonResult: function( upload_file_result ) {\n\t\t\t}\n\t\t} );\n\t}\n}\n"],"sourceRoot":""}