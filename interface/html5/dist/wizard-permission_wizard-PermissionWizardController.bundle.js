(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["wizard-permission_wizard-PermissionWizardController"],{1827:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"PermissionWizardController":()=>s});class s extends BaseWizardController{constructor(e={}){_.defaults(e,{el:".wizard-bg",api_permission:null}),super(e)}init(e){this.title=$.i18n._("Permission Wizard"),this.steps=3,this.current_step=1,this.render()}render(){super.render(),this.api_permission=TTAPI.APIPermission,this.initCurrentStep()}buildCurrentStepUI(){var e=this;switch(this.content_div.empty(),this.stepsWidgetDic[this.current_step]={},this.current_step){case 1:var t=this.getLabel();t.text($.i18n._("Choose role and permission actions")+":"),this.content_div.append(t);var i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html")),s=i.find(".form-item-label"),r=i.find(".form-item-input-div"),o=this.getComboBox("role",!1);s.text($.i18n._("Role")+": "),r.append(o),this.content_div.append(i),s=(i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),r=i.find(".form-item-input-div");var n=this.getAComboBox(null,!0,"global_option_column","permission",!1,"value");s.text($.i18n._("Permissions")+": "),r.append(n),this.content_div.append(i),this.stepsWidgetDic[this.current_step][o.getField()]=o,this.stepsWidgetDic[this.current_step][n.getField()]=n;break;case 2:(t=this.getLabel()).text($.i18n._("Choose modules and sub-modules")),this.content_div.append(t),s=(i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),r=i.find(".form-item-input-div");var a=this.getAComboBox(null,!0,"global_option_column","section_group",!1,"value");s.text($.i18n._("Modules")+": "),r.append(a),this.content_div.append(i),i.bind("formItemChange",(function(t,i){var s=i.getValue();e.setSection(s,!0)})),s=(i=$(Global.loadWidget("global/widgets/wizard_form_item/WizardFormItem.html"))).find(".form-item-label"),r=i.find(".form-item-input-div");var l=this.getAComboBox(null,!0,"global_option_column","section",!1,"value");s.text($.i18n._("Sub-Modules")+": "),r.append(l),this.content_div.append(i),this.stepsWidgetDic[this.current_step][a.getField()]=a,this.stepsWidgetDic[this.current_step][l.getField()]=l;break;case 3:(t=this.getLabel()).text($.i18n._("Would you like to allow, deny or simply highlight the chosen permissions")+":"),this.content_div.append(t);var c=$('<input type="radio" name="action" id="allow" value="allow"><label for="allow">Allow </label>'),p=$('<input type="radio" name="action" id="deny" value="deny"><label for="deny">Deny </label>'),d=$('<input type="radio" name="action" id="highlight" value="highlight"><label for="highlight">Highlight Only </label>');this.content_div.append(c),this.content_div.append(p),this.content_div.append(d),this.stepsWidgetDic[this.current_step].allow=c,this.stepsWidgetDic[this.current_step].deny=p,this.stepsWidgetDic[this.current_step].highlight=d}}setSection(e,t){var i=this.stepsWidgetDic[this.current_step];this.api_permission.getSectionBySectionGroup(e,{onResult:function(e){var s=Global.buildRecordArray(e.getResult());i.section.setSourceData(s),t&&i.section.setValue(s)}})}buildCurrentStepData(){var e=this,t=this.stepsDataDic[this.current_step],i=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 1:this.api_permission.getOptions("preset",{onResult:function(e){var s=Global.buildRecordArray(e.getResult());if(s.unshift({value:0,label:$.i18n._("CUSTOM")}),i.role.setSourceData(s),t&&i.role.setValue(t.role),LocalCacheData.current_open_primary_controller.current_edit_record&&LocalCacheData.current_open_primary_controller.current_edit_record.name){var r=LocalCacheData.current_open_primary_controller.current_edit_record.name.toLowerCase();for(var o in s)if(s[o].label.toLowerCase()==r){i.role.setSelectedIndex(o);break}}}}),this.api_permission.getOptions("common_permissions",{onResult:function(e){var s=Global.buildRecordArray(e.getResult());i.permission.setSourceData(s),t?i.permission.setValue(t.permission):i.permission.setValue(s)}});break;case 2:this.api_permission.getOptions("section_group",{onResult:function(s){var r=Global.buildRecordArray(s.getResult());i.section_group.setSourceData(r),t?t.section_group&&t.section_group.length>0&&(i.section_group.setValue(t.section_group),e.setSection(t.section_group),i.section.setValue(t.section)):(i.section_group.setValue(r[0].value),e.setSection(r[0].value,!0))}});break;case 3:t?i[t.action].prop("checked","checked"):i.allow.prop("checked","checked")}}onDoneClick(){var e=this;super.onDoneClick(),this.saveCurrentStep();var t=this.stepsDataDic[1].role,i=this.stepsDataDic[2].section,s=this.stepsDataDic[1].permission,r=this.stepsDataDic[3].action;this.api_permission.filterPresetPermissions(t,i,s,{onResult:function(t){t.isValid?(e.onCloseClick(),e.call_back&&e.call_back(t.getResult(),r)):(TAlertManager.showErrorAlert(t),e.onCloseClick())}})}saveCurrentStep(){this.stepsDataDic[this.current_step]={};var e=this.stepsDataDic[this.current_step],t=this.stepsWidgetDic[this.current_step];switch(this.current_step){case 3:for(var i in t)t.hasOwnProperty(i)&&(t[i].prop("checked")||!0===t[i][0].checked)&&(e.action=i);break;default:for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i].getValue())}}setDefaultDataToSteps(){if(!this.default_data)return null}}}}]);
//# sourceMappingURL=wizard-permission_wizard-PermissionWizardController.bundle.js.map?v=fe35c4493b1dd5613618