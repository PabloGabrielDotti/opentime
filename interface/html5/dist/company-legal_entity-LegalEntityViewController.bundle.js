(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["company-legal_entity-LegalEntityViewController","filebrowser-TImage","filebrowser-TImageAdvBrowser"],{1469:()=>{!function(e){e.fn.TImage=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a=e.extend({},e.fn.TImage.defaults,t);return this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return null},this.setValue=function(e){if(e){var t=new Date;this.attr("src",e+"&t="+t.getTime())}else this.attr("src","")},this.each((function(){var t=e.meta?e.extend({},a,e(this).data()):a;i=t.field})),this},e.fn.TImage.defaults={},e(document).on("mouseover",".file-browser img",(function(t){var i=e(t.target).parents(".file-browser");if(!e(".file_browser_overlay")[0]&&1==e(t.target).attr("enable-delete")){var a=e(t.target).height(),n=(a-32)/2,r=e('<div class="file_browser_overlay"><img src="theme/default/images/delete-512.png" style="position:absolute;width:32px;height:32px;top:'+n+"px;left:"+n+'px;"></div>');r.css("position","absolute"),r.css("top","0px"),r.css("left","0"),r.css("cursor","pointer"),r.css("height",a+"px"),r.css("width","100%"),r.css("background","rgba(255,255,255,0.85)"),e(t.target).parents(".file-browser").append(r),e(document).on("click",".file_browser_overlay",(function(t){e(t.target).parent().find("img").attr("src");TAlertManager.showConfirmAlert(e.i18n._("This will permanently delete the image. Are you sure?"),"",(function(e){if(e){var t={type:"deleteClick",message:"Delete image clicked.",time:new Date};i.trigger(t)}}))})),e(document).on("mouseleave",".file-browser",(function(){(e(document).off("click",".file_browser_overlay"),e(".file_browser_overlay")[0])&&e(this).find(".file_browser_overlay").off().remove()}))}}))}(jQuery)},8243:()=>{!function(e){e.fn.TImageAdvBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a,n,r=e.extend({},e.fn.TImageAdvBrowser.defaults,t),l=this,o="",s=177,d=42,_=null;return this.setEnable=function(e){e;var t=this.children().eq(1);e?t.show():t.hide()},this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return n},this.setImage=function(e){if(!e)return a.attr("src",""),void a.hide();var t=new Date;a.hide(),a.attr("src",e+"&t="+t.getTime()+"&X-CSRF-Token="+getCookie("CSRF-Token")),a.css("height","auto"),a.css("width","auto")},this.onImageLoad=function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,a=e(t).width()>0?e(t).width():t.naturalWidth;i>d&&e(t).css("height",d),a>s&&(e(t).css("width",s),e(t).css("height","auto")),l.trigger("setSize"),i<5?e(t).hide():e(t).show()},this.setValue=function(e){e||(e="")},this.setEnableDelete=function(e){var t=l.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.each((function(){var t=e.meta?e.extend({},r,e(this).data()):r;i=t.field;e(this).find("#upload_image").text(e.i18n._("Upload Image")),t.callBack&&(_=t.callBack),!1===t.show_browser&&e(this).children().eq(1).hide(),t.default_width>0&&(s=t.default_width),t.default_height>0&&(d=t.default_height),Global.isSet(t.name)&&t.name,Global.isSet(o)&&(o=t.accept_filter),Global.isSet(t.deleteImageHandler)&&l.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),e(this).children().eq(1).bind("click",(function(){IndexViewController.openWizard("UserPhotoWizard",null,(function(e){_&&_(e),n=e}))})),(a=e(this).children().eq(0)).on("load",(function(){l.onImageLoad(this)})),a.hide()})),this},e.fn.TImageAdvBrowser.defaults={}}(jQuery)},9514:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"LegalEntityViewController":()=>a});i(1469),i(8243);class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#legal_entity_view_container",status_array:null,type_array:null,classification_code_array:null,country_array:null,province_array:null,e_province_array:null,payment_services_status_array:null,company_api:null}),super(e)}init(){this.edit_view_tpl="LegalEntityEditView.html",this.permission_id="legal_entity",this.viewId="LegalEntity",this.script_name="LegalEntityView",this.table_name_key="legal_entity",this.context_menu_name=$.i18n._("Legal Entities"),this.navigation_label=$.i18n._("Legal Entity")+":",this.api=TTAPI.APILegalEntity,this.company_api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){this.initDropDownOption("status"),this.initDropDownOption("type"),this.initDropDownOption("classification_code"),this.initDropDownOption("country","country",this.company_api),this.initDropDownOption("payment_services_status")}onSetSearchFilterFinished(){var e;0===this.search_panel.getSelectTabIndex()?(e=this.basic_search_field_ui_dic.country.getValue(),this.setProvince(e)):1===this.search_panel.getSelectTabIndex()&&(e=this.adv_search_field_ui_dic.country.getValue(),this.setProvince(e))}getLogoUrl(){var e=!1;return this.current_edit_record.id&&(e=Global.getBaseURL()+"../send_file.php?api=1&object_type=legal_entity_logo&object_id="+this.current_edit_record.id),Debug.Text(e,"LegalEntityViewController.js","LegalEntityViewController","getLogoUrl",10),e}setEditViewDataDone(){this.onPaymentServicesStatusChange(),super.setEditViewDataDone(),this.file_browser.setImage(this.getLogoUrl())}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.export_excel],include:[{label:$.i18n._("Payment Services<br>Statement"),id:ContextMenuIconName.payment_services_statement,group:"other",icon:Icons.payroll_export_report}]}}setDefaultMenu(e){super.setDefaultMenu(e);for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var n=$(this.context_menu_array[a]);switch($(n.find(".ribbon-sub-menu-icon")).attr("id")){case ContextMenuIconName.payment_services_statement:this.setDefaultMenuPaymentServicesStatementIcon(n,i)}}}setDefaultMenuPaymentServicesStatementIcon(e,t,i){1===t?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.payment_services_statement:this.onPaymentServicesStatementClick()}}onPaymentServicesStatementClick(){this.doFormIFrameCall({0:null,1:null})}doFormIFrameCall(e){Global.APIFileDownload(this.api.className,"getPaymentServicesAccountStatementReport",e)}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change($.proxy((function(){var e=this.basic_search_field_ui_dic.country.getValue();this.setProvince(e),this.basic_search_field_ui_dic.province.setValue(null)}),this))}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();switch(i){case"country":if(a.toString()===this.current_edit_record[i].toString())break;this.eSetProvince(a);break;case"payment_services_status_id":this.current_edit_record[i]=a,this.onPaymentServicesStatusChange()}this.current_edit_record[i]=a,"country"!==i?t||this.validate():this.onCountryChange()}openEditView(e){if(0==e){var t=this;this.initOptions(),this.api.getLegalEntity({filter_items_per_page:1},{onResult:function(e){var i=e.getResult();"object"==typeof i&&(t.initEditViewUI(t.viewId,t.edit_view_tpl),t.current_edit_record=i[0],t.initEditView())}})}else super.openEditView()}onPaymentServicesStatusChange(){this.current_edit_record&&10==this.current_edit_record.payment_services_status_id?(this.attachElement("payment_services_user_name"),this.attachElement("payment_services_api_key")):(this.detachElement("payment_services_user_name"),this.detachElement("payment_services_api_key")),this.editFieldResize()}buildEditViewUI(){super.buildEditViewUI();var e,t=this,i={"tab_legal_entity":{"label":$.i18n._("Legal Entity")},"tab_payment_services":{"label":$.i18n._("Payment Services"),"display_on_mass_edit":!1},"tab_audit":!0};this.setTabModel(i),this.navigation&&(this.navigation.AComboBox({api_class:TTAPI.APILegalEntity,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_legal_entity",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var a=this.edit_view_tab.find("#tab_legal_entity").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a);var n=this.edit_view_tab.find("#tab_payment_services").find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(n),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),e.setSourceData(t.status_array),this.addEditFieldToColumn($.i18n._("Status"),e,a,""),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),e.setSourceData(t.type_array),this.addEditFieldToColumn($.i18n._("Type"),e,a,""),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"classification_code"}),e.setSourceData(t.classification_code_array),this.addEditFieldToColumn($.i18n._("Classification Code"),e,a,""),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"legal_name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Legal Name"),e,a),e.parent().width("45%"),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"trade_name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Trade Name"),e,a),e.parent().width("45%"),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"short_name",width:"150"}),this.addEditFieldToColumn($.i18n._("Short Name/Abbreviation"),e,a),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 1)"),e,a),e.parent().width("45%"),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 2)"),e,a),e.parent().width("45%"),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"city",width:149}),this.addEditFieldToColumn($.i18n._("City"),e,a),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"country",set_empty:!0}),e.setSourceData(t.country_array),this.addEditFieldToColumn($.i18n._("Country"),e,a),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"province"}),e.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province/State"),e,a),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn($.i18n._("Postal/ZIP Code"),e,a),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone",width:149}),this.addEditFieldToColumn($.i18n._("Phone"),e,a),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"fax_phone",width:149}),this.addEditFieldToColumn($.i18n._("Fax"),e,a),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"start_date"}),this.addEditFieldToColumn($.i18n._("Start Date"),e,a),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"end_date"}),this.addEditFieldToColumn($.i18n._("End Date"),e,a),"undefined"==typeof FormData?(e=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=e.TImageBrowser({field:"",default_width:128,default_height:128}),this.file_browser.bind("imageChange",(function(e,i){(new ServiceCaller).uploadFile(i.getValue(),"object_type=legal_entity_logo&object_id="+t.current_edit_record.id,{onResult:function(e){"true"===e.toLowerCase()?t.file_browser.setImage(t.getLogoUrl()):TAlertManager.showAlert(e,"Error")}})}))):(e=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=e.TImageAdvBrowser({field:"",callBack:function(e){(new ServiceCaller).uploadFile(e,"object_type=legal_entity_logo&object_id="+t.current_edit_record.id,{onResult:function(e){"true"===e.toLowerCase()?t.file_browser.setImage(t.getLogoUrl()):TAlertManager.showAlert(e,"Error")}})}})),this.is_edit&&(this.file_browser.setEnableDelete(!0),this.file_browser.bind("deleteClick",(function(e,i){t.api.deleteImage(t.current_edit_record.id,{onResult:function(e){t.onDeleteImage()}})}))),this.addEditFieldToColumn($.i18n._("Logo"),this.file_browser,a,"",null,!1,!0),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"payment_services_status_id"}),e.setSourceData(t.payment_services_status_array),this.addEditFieldToColumn($.i18n._("Status"),e,n,"",null,!0),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"payment_services_user_name",width:250}),this.addEditFieldToColumn($.i18n._("User Name"),e,n,"",null,!0),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"payment_services_api_key",width:510}),this.addEditFieldToColumn($.i18n._("API Key"),e,n,"",null,!0)}setProvince(e,t){var i=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e),i.adv_search_field_ui_dic.province.setSourceData(i.province_array),i.basic_search_field_ui_dic.province.setSourceData(i.province_array)}}):(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e,t){var i=this,a=i.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.e_province_array=Global.buildRecordArray(e),t&&i.e_province_array.length>0&&(i.current_edit_record.province=i.e_province_array[0].value,a.setValue(i.current_edit_record.province)),a.setSourceData(i.e_province_array)}}):(i.e_province_array=[],a.setSourceData([]))}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Legal Name"),in_column:1,field:"legal_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Trade Name"),in_column:1,field:"trade_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Phone"),field:"work_phone",basic_search:!1,adv_search:!0,in_column:1,object_type_id:110,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Fax"),field:"fax_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Address (Line1)"),field:"address1",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Address (Line2)"),field:"address2",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Postal/ZIP Code"),field:"postal_code",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!0,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:3,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:3,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}}}}]);
//# sourceMappingURL=company-legal_entity-LegalEntityViewController.bundle.js.map?v=935c61735d0fe01ae799