{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImage.js","webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImageBrowser.js","webpack://timetrex/./interface/html5/views/document/DocumentViewController.js"],"names":["$","fn","TImage","options","Global","addCss","field","opts","extend","defaults","this","clearErrorStyle","getField","getValue","setValue","val","d","Date","attr","getTime","each","o","meta","data","document","on","e","$this_image_widget","target","parents","height","top","file_browser_overlay","css","append","parent","find","TAlertManager","showConfirmAlert","i18n","_","flag","type","message","time","trigger","off","remove","jQuery","TImageBrowser","browser","$this","name","accept_filter","default_width","default_height","setEnabled","btn","removeAttr","removeClass","addClass","getFileName","setEnableDelete","image","FormData","getImageSrc","setImage","hide","isSet","image_height","naturalHeight","image_width","width","naturalWidth","show","onImageLoad","changeHandler","bind","deleteImageHandler","FileReader","files","length","window","reader","readAsDataURL","onloadend","url","result","DocumentViewController","BaseViewController","el","status_array","document_group_array","document_group_api","document_revision_api","document_attach_api","sub_document_revision_view_controller","sub_revision_view_controller","document_object_type_id","super","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","navigation_label","api","TTAPI","APIDocument","APIDocumentGroup","APIDocumentRevision","APIDocumentAttachment","render","sub_view_mode","buildContextMenu","initData","groups","download","label","id","exclude","ContextMenuIconName","copy","include","group","icon","Icons","view_file","view","doNotSetFocus","context_menu_array","selectContextMenu","setTotalDisplaySpan","len","grid_selected_length","getGridSelectIdArray","i","context_btn","add","setDefaultMenuAddIcon","edit","setDefaultMenuEditIcon","setDefaultMenuViewIcon","mass_edit","setDefaultMenuMassEditIcon","setDefaultMenuCopyIcon","delete_icon","setDefaultMenuDeleteIcon","delete_and_next","setDefaultMenuDeleteAndNextIcon","save","setDefaultMenuSaveIcon","save_and_next","setDefaultMenuSaveAndNextIcon","save_and_continue","setDefaultMenuSaveAndContinueIcon","save_and_new","setDefaultMenuSaveAndAddIcon","save_and_copy","setDefaultMenuSaveAndCopyIcon","copy_as_new","setDefaultMenuCopyAsNewIcon","cancel","setDefaultMenuCancelIcon","setDefaultMenuDownIcon","export_excel","setDefaultMenuExportIcon","setContextMenuGroupVisibility","pId","initDropDownOption","getDocumentGroup","onResult","res","getResult","buildTreeRecord","basic_search_field_ui_dic","setSourceData","adv_search_field_ui_dic","filter","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","layout_name","form_item_type","FormItemType","AWESOME_BOX","TEXT_INPUT","object_type_id","TAG_INPUT","tree_mode","CHECKBOX","PermissionManager","validate","api_class","APIUser","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","allow_multiple_selection","navigation_mode","show_search_inputs","setNavigation","tab_document_column1","edit_view_tab","edit_view_tabs","push","form_item_input","loadWidgetByName","COMBO_BOX","TComboBox","addEditFieldToColumn","TTextInput","FILE_BROWSER","file_browser","set_empty","TCheckbox","TEXT_AREA","TTextArea","TTagInput","current_edit_record","is_mass_editing","detachElement","attachElement","editFieldResize","setEditViewDataDone","isEditChange","onDownloadClick","ServiceCaller","getURLByObjectType","document_revision_id","APIFileDownload","edit_view","doFormIFrameCall","selectedId","grid_selected_id_array","filter_data","result_data","key_name","async","getAPIFilters","company","LocalCacheData","current_company","revision","parent_key","parent_value","initEditView","document_result","super_fun_name","document_id","TTUUID","isUUID","args","object_id","setDocumentAttachment","file_data","isValid","document_revision_record","document_revision_result","uploadFile","upload_file_result","setAttachmentBinding","showErrorAlert","handleSaveResult","setEditMenuSaveIcon","setEditMenuAddIcon","setEditMenuEditIcon","setEditMenuViewIcon","setEditMenuMassEditIcon","setEditMenuCopyIcon","setEditMenuDeleteIcon","setEditMenuDeleteAndNextIcon","setEditMenuSaveAndContinueIcon","setEditMenuSaveAndAddIcon","setEditMenuSaveAndNextIcon","setEditMenuSaveAndCopyIcon","setEditMenuCopyAndAddIcon","setEditMenuDownloadIcon","retval","container_selector","sub_grid_mode","onGridResize","onSelectRow","onGridSelectRow","onCellSelect","onSelectAll","onGridSelectAll","ondblClickRow","onGridDblClickRow","onRightClickRow","rowId","indexOf","grid","resetSelection","setSelection","setGridSize","baseViewSubTabGridResize","removeEditView","setDefaultMenu","parent_edit_record","parent_view_controller","loadScript","firstColumn","trackView","TTPromise","wait","DocumentRevisionViewController","loadSubView","beforeLoadView","afterLoadView","resolve","subViewController","searchDone","container","beforeViewLoadedFun","afterViewLoadedFun","loadViewSource","template","html","sub_document_view_controller"],"mappings":"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","file":"document-DocumentViewController.bundle.js?v=10e55a78c6937b6435b3","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImage = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImage.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn null;\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\t\t\tif ( !val ) {\n\t\t\t\tthis.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\tthis.attr( 'src', val + '&t=' + d.getTime() );\n\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImage.defaults = {};\n\n\t$( document ).on( 'mouseover', '.file-browser img', function( e ) {\n\t\tvar $this_image_widget = $( e.target ).parents( '.file-browser' );\n\n\t\tif ( !$( '.file_browser_overlay' )[0] && $( e.target ).attr( 'enable-delete' ) == 1 ) {\n\t\t\tvar height = $( e.target ).height();\n\t\t\tvar top = ( height - 32 ) / 2;\n\t\t\tvar left = top;\n\n\t\t\tvar file_browser_overlay = $( '<div class=\"file_browser_overlay\"><img src=\"theme/default/images/delete-512.png\" style=\"position:absolute;width:32px;height:32px;top:' + top + 'px;left:' + left + 'px;\"></div>' );\n\t\t\tfile_browser_overlay.css( 'position', 'absolute' );\n\t\t\tfile_browser_overlay.css( 'top', '0px' );\n\t\t\tfile_browser_overlay.css( 'left', '0' );\n\t\t\tfile_browser_overlay.css( 'cursor', 'pointer' );\n\t\t\tfile_browser_overlay.css( 'height', height + 'px' );\n\t\t\tfile_browser_overlay.css( 'width', '100%' );\n\t\t\tfile_browser_overlay.css( 'background', 'rgba(255,255,255,0.85)' );\n\n\t\t\t$( e.target ).parents( '.file-browser' ).append( file_browser_overlay );\n\n\t\t\t$( document ).on( 'click', '.file_browser_overlay', function( e ) {\n\t\t\t\tvar img_src = $( e.target ).parent().find( 'img' ).attr( 'src' );\n\t\t\t\tTAlertManager.showConfirmAlert( $.i18n._( 'This will permanently delete the image. Are you sure?' ), '', function( flag ) {\n\t\t\t\t\tif ( flag ) {\n\t\t\t\t\t\tvar e = { type: 'deleteClick', message: 'Delete image clicked.', time: new Date() };\n\t\t\t\t\t\t$this_image_widget.trigger( e );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t\t$( document ).on( 'mouseleave', '.file-browser', function() {\n\t\t\t\t$( document ).off( 'click', '.file_browser_overlay' );\n\t\t\t\tif ( $( '.file_browser_overlay' )[0] ) {\n\t\t\t\t\tvar file_browser_overlay = $( this ).find( '.file_browser_overlay' );\n\t\t\t\t\tfile_browser_overlay.off().remove();\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t} );\n\n} )( jQuery );","( function( $ ) {\n\n\t$.fn.TImageBrowser = function( options ) {\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar id = 'file_browser';\n\t\tvar name = 'filedata';\n\t\tvar browser;\n\n\t\tvar accept_filter = '';\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\t\tvar enabled = true;\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.find( '.browser-form input' );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getFileName = function() {\n\n\t\t\treturn browser.val();\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\tvar form_data;\n\t\t\tif ( browser && browser.val() ) {\n\n\t\t\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\t\t\tform_data = $this.find( '.browser-form' );\n\t\t\t\t} else {\n\t\t\t\t\tform_data = new FormData( $( $this.find( '.browser-form' ) )[0] );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tform_data = null;\n\t\t\t}\n\n\t\t\treturn form_data;\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t$this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.each( function() {\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\t// var $this = this;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tbrowser = $( this ).find( '.browser' );\n\t\t\tvar image = $( this ).find( '.image' );\n\t\t\timage.hide();\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tif ( accept_filter ) {\n\t\t\t\tbrowser.attr( 'accept', accept_filter );\n\t\t\t} else {\n\t\t\t\taccept_filter = 'image/*';\n\t\t\t\tbrowser.attr( 'accept', 'image/*' );\n\t\t\t}\n\n\t\t\tbrowser.attr( 'id', id );\n\t\t\tbrowser.attr( 'name', name );\n\n\t\t\tif ( Global.isSet( o.changeHandler ) ) {\n\n\t\t\t\t$this.bind( 'imageChange', o.changeHandler );\n\t\t\t}\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\tthis.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tbrowser.bind( 'change', function() {\n\t\t\t\timage.hide();\n\n\t\t\t\tif ( typeof FileReader != 'undefined' ) {\n\n\t\t\t\t\tvar files = !!this.files ? this.files : [];\n\n\t\t\t\t\t// If no files were selected, or no FileReader support, return\n\t\t\t\t\tif ( !files.length || !window.FileReader ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( accept_filter === 'image/*' ) {\n\t\t\t\t\t\t// Create a new instance of the FileReader\n\t\t\t\t\t\tvar reader = new FileReader();\n\n\t\t\t\t\t\t// Read the local file as a DataURL\n\t\t\t\t\t\treader.readAsDataURL( files[0] );\n\n\t\t\t\t\t\t// When loaded, set image data as background of div\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = this.result;\n\t\t\t\t\t\t\timage.attr( 'src', url );\n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'imageChange', [$this] );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageBrowser.defaults = {};\n\n} )( jQuery );","import '@/global/widgets/filebrowser/TImage';\nimport '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class DocumentViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#document_view_container',\n\n\t\t\t// _required_files: ['TImageBrowser', 'TImage'],\n\n\t\t\tstatus_array: null,\n\t\t\tdocument_group_array: null,\n\n\t\t\tdocument_group_api: null,\n\t\t\tdocument_revision_api: null,\n\t\t\tdocument_attach_api: null,\n\t\t\tsub_document_revision_view_controller: null,\n\t\t\tsub_revision_view_controller: null,\n\n\t\t\tdocument_object_type_id: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'DocumentEditView.html';\n\t\tthis.permission_id = 'document';\n\t\tthis.viewId = 'Document';\n\t\tthis.script_name = 'DocumentView';\n\t\tthis.table_name_key = 'document';\n\t\tthis.context_menu_name = $.i18n._( 'Documents' );\n\t\tthis.navigation_label = $.i18n._( 'Document' ) + ':';\n\t\tthis.api = TTAPI.APIDocument;\n\t\tthis.document_group_api = TTAPI.APIDocumentGroup;\n\t\tthis.document_revision_api = TTAPI.APIDocumentRevision;\n\t\tthis.document_attach_api = TTAPI.APIDocumentAttachment;\n\n\t\tthis.render();\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tthis.buildContextMenu( true );\n\t\t} else {\n\t\t\tthis.buildContextMenu();\n\t\t}\n\n\t\t//call init data in parent view\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tthis.initData();\n\t\t}\n\n\t\t//$this.setSelectRibbonMenuIfNecessary( 'UserContact' )\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tdownload: {\n\t\t\t\t\tlabel: $.i18n._( 'Download' ),\n\t\t\t\t\tid: this.script_name + 'download'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [ContextMenuIconName.copy],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Download' ),\n\t\t\t\t\tid: ContextMenuIconName.download,\n\t\t\t\t\tgroup: 'download',\n\t\t\t\t\ticon: Icons.download\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'View' ),\n\t\t\t\t\tid: ContextMenuIconName.view_file,\n\t\t\t\t\tgroup: 'download',\n\t\t\t\t\ticon: Icons.view\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\t//Call this when select grid row\n\t//Call this when setLayout\n\n\t/* jshint ignore:start */\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t\tthis.selectContextMenu();\n\t\t}\n\n\t\tthis.setTotalDisplaySpan();\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setDefaultMenuAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setDefaultMenuMassEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setDefaultMenuCopyIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setDefaultMenuDeleteIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setDefaultMenuDeleteAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setDefaultMenuSaveAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setDefaultMenuSaveAndContinueIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setDefaultMenuSaveAndAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setDefaultMenuSaveAndCopyIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ContextMenuIconName.download:\n\t\t\t\tcase ContextMenuIconName.view_file:\n\t\t\t\t\tthis.setDefaultMenuDownIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetDefaultMenuDownIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\t\tthis.initDropDownOption( 'status' );\n\n\t\tthis.document_group_api.getDocumentGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tres = res.getResult();\n\t\t\t\tres = Global.buildTreeRecord( res );\n\n\t\t\t\tif ( !$this.sub_view_mode ) {\n\t\t\t\t\tif ( !$this.sub_view_mode && $this.basic_search_field_ui_dic['group_id'] ) {\n\t\t\t\t\t\t$this.basic_search_field_ui_dic['group_id'].setSourceData( res );\n\t\t\t\t\t\t$this.adv_search_field_ui_dic['group_id'].setSourceData( res );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this.document_group_array = res;\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tif ( this.sub_view_mode && Global.isSet( this.document_object_type_id ) ) {\n\t\t\tfilter['object_type_id'] = this.document_object_type_id;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Description' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'description',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'File Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'remote_file_name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 700,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'group_id',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Template' ),\n\t\t\t\tfield: 'template',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Private' ),\n\t\t\t\tfield: 'private',\n\t\t\t\tbasic_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) ) ? true : false,\n\t\t\t\tadv_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) ) ? true : false,\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Attachments' ),\n\t\t\t\tfield: 'is_attachment',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( PermissionManager.validate( 'document', 'view' ) && PermissionManager.validate( 'document', 'view_private' ) && PermissionManager.validate( 'document', 'edit' ) && PermissionManager.validate( 'user', 'edit' ) ) ? true : false, //Require additional permissions other than just document ones to show document attachments.\n\t\t\t\tin_column: 2,\n\t\t\t\tform_item_type: FormItemType.CHECKBOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_document': { 'label': $.i18n._( 'Document' ) },\n\t\t\t'tab_revision': {\n\t\t\t\t'label': $.i18n._( 'Revision' ),\n\t\t\t\t'init_callback': 'initSubDocumentRevisionView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDocument,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_document',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_document = this.edit_view_tab.find( '#tab_document' );\n\n\t\tvar tab_document_column1 = tab_document.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_document_column1 );\n\n\t\t// Status\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_document_column1, '' );\n\n\t\t// Name\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_document_column1 );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Revision\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'revision', width: 114 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Revision' ), form_item_input, tab_document_column1, '', null, true );\n\n\t\t// File\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.FILE_BROWSER );\n\n\t\tthis.file_browser = form_item_input.TImageBrowser( { field: 'file', name: 'filedata', accept_filter: '*' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'File' ), form_item_input, tab_document_column1, '', null, true, true );\n\n\t\t// Group\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\ttree_mode: true,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_tree_column',\n\t\t\tfield: 'group_id',\n\t\t\tset_empty: true\n\t\t} );\n\t\tform_item_input.setSourceData( $this.document_group_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Group' ), form_item_input, tab_document_column1 );\n\n\t\t// Template\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'template' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Template' ), form_item_input, tab_document_column1 );\n\n\t\t// Private\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'private' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Private' ), form_item_input, tab_document_column1 );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_document_column1, '', null, false, true );\n\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 700 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_document_column1, '', null, null, true );\n\t}\n\n\tisEditChange() {\n\n\t\tif ( this.current_edit_record.id ) {\n\t\t\tthis.detachElement( 'revision' );\n\t\t\tthis.detachElement( 'file' );\n\t\t} else if ( this.is_mass_editing ) {\n\t\t\tthis.detachElement( 'revision' );\n\t\t\tthis.detachElement( 'file' );\n\t\t} else {\n\t\t\tthis.attachElement( 'revision' );\n\t\t\tthis.attachElement( 'file' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.isEditChange();\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.view_file:\n\t\t\t\tthis.onDownloadClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall() {\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + this.current_edit_record.id;\n\t\tif ( Global.isSet( this.document_object_type_id ) ) {\n\t\t\turl = url + '&parent_object_type_id=' + this.document_object_type_id;\n\t\t}\n\t\turl = url + '&object_id=' + this.current_edit_record.document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tonDownloadClick() {\n\n\t\tvar $this = this;\n\t\tvar url;\n\t\tif ( this.edit_view && this.current_edit_record.id ) {\n\t\t\tthis.doFormIFrameCall();\n\n\t\t} else {\n\t\t\tvar filter = {};\n\t\t\tvar selectedId;\n\t\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\t\t\tvar grid_selected_length = grid_selected_id_array.length;\n\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\tselectedId = grid_selected_id_array[0];\n\t\t\t}\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = [selectedId];\n\t\t\tfilter.filter_data.object_type_id = this.document_object_type_id;\n\n\t\t\tvar result = this.api['get' + this.api.key_name]( filter, { async: false } );\n\n\t\t\tvar result_data = result.getResult();\n\n\t\t\tif ( !result_data ) {\n\t\t\t\tresult_data = [];\n\t\t\t}\n\n\t\t\tresult_data = result_data[0];\n\n\t\t\t$this.current_edit_record = result_data;\n\n\t\t\t$this.doFormIFrameCall();\n\n\t\t}\n\t}\n\n\tgetAPIFilters() {\n\t\tvar filter = super.getAPIFilters();\n\t\tfilter.filter_data.object_type_id = this.document_object_type_id; // Note: On My Account->Documents data.object_type_id is NULL, but this is definately used in other areas, like Edit Employee->Attachments.\n\n\t\treturn filter;\n\t}\n\n\tonAddResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\n\t\tif ( !result_data ) {\n\t\t\tresult_data = [];\n\t\t}\n\n\t\tresult_data.company = LocalCacheData.current_company.name;\n\t\tresult_data.revision = '1.0';\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.download:\n\t\t\tcase ContextMenuIconName.view_file:\n\t\t\t\tthis.onDownloadClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetAttachmentBinding( document_result, super_fun_name ) {\n\t\tvar $this = this;\n\t\tvar document_id = document_result.getResult();\n\n\t\t/* jshint ignore:start */\n\t\tif ( TTUUID.isUUID( document_id ) == false ) {\n\t\t\tsuper[super_fun_name]( document_result );\n\t\t\treturn;\n\t\t}\n\t\t/* jshint ignore:end */\n\n\t\tif ( $this.sub_view_mode ) {\n\t\t\tvar args = {};\n\t\t\targs.object_type_id = $this.document_object_type_id;\n\t\t\targs.object_id = $this.parent_value;\n\t\t\targs.document_id = document_id;\n\t\t\t$this.document_attach_api.setDocumentAttachment( args, {\n\t\t\t\tonResult: () => {\n\t\t\t\t\tsuper[super_fun_name]( document_result );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tsuper[super_fun_name]( document_result );\n\t\t}\n\t}\n\n\thandleSaveResult( document_result, super_fun_name ) {\n\t\tvar document_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\tvar file_data;\n\n\t\tif ( !$this.current_edit_record.id && !this.is_mass_editing ) {\n\t\t\tfile_data = $this.file_browser.getValue();\n\t\t} else {\n\t\t\tfile_data = null;\n\t\t}\n\n\t\t//Save a document revision data if has upload file, otherwise don't\n\t\tif ( document_result.isValid() == true && file_data ) {\n\t\t\tvar document_revision_record = {};\n\t\t\tdocument_revision_record['document_id'] = document_id;\n\t\t\tdocument_revision_record['revision'] = this.current_edit_record.revision;\n\n\t\t\t$this.document_revision_api['set' + $this.document_revision_api.key_name]( document_revision_record,\n\t\t\t\t{\n\t\t\t\t\tonResult: function( document_revision_result ) {\n\t\t\t\t\t\tif ( document_revision_result.isValid() ) {\n\t\t\t\t\t\t\tvar url = 'object_type=document_revision&object_id=' + document_revision_result.getResult();\n\t\t\t\t\t\t\tif ( Global.isSet( $this.document_object_type_id ) ) {\n\t\t\t\t\t\t\t\turl = url + '&parent_object_type_id=' + $this.document_object_type_id;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.api.uploadFile( file_data, url, {\n\t\t\t\t\t\t\t\tonResult: function( upload_file_result ) {\n\t\t\t\t\t\t\t\t\t$this.setAttachmentBinding( document_result, super_fun_name );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.api['delete' + $this.api.key_name]( [document_id], {\n\t\t\t\t\t\t\t\tonResult: function() {\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tTAlertManager.showErrorAlert( document_revision_result );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setAttachmentBinding( document_result, super_fun_name );\n\t\t}\n\t}\n\n\t// Dev note: this is not the ideal refactor, as would like to remove the use of 'super_fun_name'\n\t// but its the best quickest most reliable way to refactor this for now.\n\tonSaveResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveResult' );\n\t}\n\n\tonSaveAndContinueResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndContinueResult' );\n\t}\n\n\tonSaveAndNewResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndNewResult' );\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\treturn this.handleSaveResult( result, 'onSaveAndCopyResult' );\n\t}\n\n\t/* jshint ignore:start */\n\tsetEditMenu() {\n\t\tthis.selectContextMenu();\n\t\tvar len = this.context_menu_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tswitch ( id ) {\n\t\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setEditMenuEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setEditMenuViewIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setEditMenuMassEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setEditMenuCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setEditMenuDeleteIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setEditMenuDeleteAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setEditMenuSaveAndContinueIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setEditMenuSaveAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setEditMenuSaveAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setEditMenuSaveAndCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setEditMenuCopyAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.download:\n\t\t\t\tcase ContextMenuIconName.view_file:\n\t\t\t\t\tthis.setEditMenuDownloadIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\t/* jshint ignore:end */\n\n\tsetEditMenuDownloadIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tgetGridSetup() {\n\t\tvar $this = this;\n\t\tvar retval = {\n\t\t\tcontainer_selector: this.sub_view_mode ? '.edit-view-tab-bar' : '.view',\n\t\t\tsub_grid_mode: false,\n\t\t\tonGridResize: true,\n\t\t\tonSelectRow: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonCellSelect: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonSelectAll: function() {\n\t\t\t\t$this.onGridSelectAll();\n\t\t\t},\n\t\t\tondblClickRow: function( e ) {\n\t\t\t\t$this.onGridDblClickRow( e );\n\t\t\t},\n\t\t\tonRightClickRow: function( rowId ) {\n\t\t\t\tvar id_array = $this.getGridSelectIdArray();\n\t\t\t\tif ( id_array.indexOf( rowId ) < 0 ) {\n\t\t\t\t\t$this.grid.grid.resetSelection();\n\t\t\t\t\t$this.grid.grid.setSelection( rowId );\n\t\t\t\t\t$this.onGridSelectRow();\n\t\t\t\t}\n\t\t\t},\n\t\t\theight: 200\n\t\t};\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tretval.setGridSize = function() {\n\t\t\t\t$this.baseViewSubTabGridResize( 'tab_attachment' );\n\t\t\t};\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\n\t\tthis.sub_revision_view_controller = null;\n\t}\n\n\tinitSubDocumentRevisionView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_revision_view_controller ) {\n\t\t\tthis.sub_revision_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_revision_view_controller.setDefaultMenu();\n\t\t\t$this.sub_revision_view_controller.parent_key = 'document_id';\n\t\t\t$this.sub_revision_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_revision_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_revision_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_revision_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/document/DocumentRevisionViewController.js', function() {\n\t\t\tvar tab_revision = $this.edit_view_tab.find( '#tab_revision' );\n\t\t\tvar firstColumn = tab_revision.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'DocumentRevision' + 'View' );\n\t\t\tTTPromise.wait( 'BaseViewController', 'initialize', function() {\n\t\t\t\tDocumentRevisionViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\t\t\t} );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_revision_view_controller = subViewController;\n\t\t\t$this.sub_revision_view_controller.parent_key = 'document_id';\n\t\t\t$this.sub_revision_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_revision_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_revision_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_revision_view_controller.initData();\n\t\t}\n\t}\n\n\tsearchDone() {\n\t\tTTPromise.resolve( 'initSubDocumentView', 'init' );\n\t\tsuper.searchDone();\n\t}\n}\n\nDocumentViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'Document', 'SubDocumentView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) ); //This populates the grid outer div below 'first-column-sub-view'\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tTTPromise.wait( 'BaseViewController', 'initialize', function() {\n\t\t\t\t\tafterViewLoadedFun( sub_document_view_controller );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t} );\n};"],"sourceRoot":""}