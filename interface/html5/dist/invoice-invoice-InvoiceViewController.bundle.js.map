{"version":3,"sources":["webpack://timetrex/./interface/html5/views/invoice/invoice/InvoiceViewController.js"],"names":["InvoiceViewController","BaseViewController","options","_","defaults","status_array","client_group_array","client_group_api","client_api","client_contact_api","product_api","transaction_api","el","sub_client_contact_view_controller","sub_client_payment_view_controller","sub_transaction_view_controller","total_data_render","total_data_row_render","owing_amount","transaction_paid_data","history","editor","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APIInvoice","APIClientGroup","APIClient","APIProduct","APITransaction","APIClientContact","render","buildContextMenu","sub_view_mode","initData","setSelectRibbonMenuIfNecessary","context_menu_model","groups","payments","label","id","exclude","ContextMenuIconName","mass_edit","include","packing_slip","group","icon","Icons","sort_order","payment","payment_method","push","edit_client","client","client_contact","transaction","doNotSetFocus","context_menu_array","Global","isSet","selectContextMenu","setTotalDisplaySpan","len","length","grid_selected_length","getGridSelectIdArray","i","context_btn","find","attr","removeClass","view","setDefaultMenuViewIcon","setDefaultMenuPackingSlipIcon","add","setDefaultMenuAddIcon","edit","setDefaultMenuEditIcon","delete_icon","setDefaultMenuDeleteIcon","delete_and_next","setDefaultMenuDeleteAndNextIcon","copy","setDefaultMenuCopyIcon","copy_as_new","setDefaultMenuCopyAsNewIcon","save","setDefaultMenuSaveIcon","save_and_continue","setDefaultMenuSaveAndContinueIcon","save_and_new","setDefaultMenuSaveAndAddIcon","save_and_copy","setDefaultMenuSaveAndCopyIcon","save_and_next","setDefaultMenuSaveAndNextIcon","cancel","setDefaultMenuCancelIcon","setDefaultMenuPaymentIcon","setDefaultMenuEditClientIcon","setDefaultMenuClientIcon","setDefaultMenuClientContactIcon","setDefaultMenuTransactionIcon","setDefaultMenuPaymentMethodIcon","export_excel","setDefaultMenuExportIcon","setContextMenuGroupVisibility","is_mass_editing","setEditMenuSaveIcon","addClass","setEditMenuAddIcon","setEditMenuEditIcon","setEditMenuViewIcon","setEditMenuMassEditIcon","setEditMenuCopyIcon","setEditMenuDeleteIcon","setEditMenuDeleteAndNextIcon","setEditMenuSaveAndContinueIcon","setEditMenuSaveAndAddIcon","setEditMenuSaveAndNextIcon","setEditMenuSaveAndCopyIcon","setEditMenuCopyAndAddIcon","import_icon","setEditMenuImportIcon","setEditMenuPackingSlipIcon","setEditMenuPaymentIcon","pId","viewPermissionValidate","edit_only_mode","current_edit_record","viewOwnerOrChildPermissionValidate","column_filter","display_columns","grid","getGridParam","name","onNavigationClick","iconName","grid_selected_id_array","invoice_id","currency_id","$this","filter","filter_data","ids","client_ids","edit_view","client_id","each","index","value","grid_selected_row","getRecordFromGridById","post_data","args","IndexViewController","openEditView","type_id","addViewTab","window","location","href","goToView","0","1","2","doFormIFrameCall","postData","APIFileDownload","className","key_name","initDropDownOption","getClientGroup","onResult","res","getResult","buildTreeRecord","basic_search_field_ui_dic","setSourceData","adv_search_field_ui_dic","buildEditViewUI","children","eq","css","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","form_item_input","widgetContainer","tab_invoice","edit_view_tab","tab_invoice_column1","tab_invoice_column2","tab_invoice_column3","edit_view_tabs","loadWidgetByName","FormItemType","AWESOME_BOX","set_empty","field","addEditFieldToColumn","TEXT","TText","COMBO_BOX","TComboBox","APICurrency","TEXT_INPUT","TTextInput","width","TAG_INPUT","TTagInput","object_type_id","DATE_PICKER","TDatePicker","APIUser","inside_editor_div","product","description","qty","price","prorate","total","INSIDE_EDITOR","InsideEditor","addRow","insideEditorAddRow","removeRow","insideEditorRemoveRow","getValue","insideEditorGetValue","setValue","insideEditorSetValue","parent_controller","render_args","row_render","append","TEXT_AREA","TTextArea","height","email_invoice","CHECKBOX","TCheckbox","email_cc","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","tree_mode","setSelectLayout","setCurrentEditViewState","LocalCacheData","current_doing_context_action","setEditMenu","setTabStatus","detachElement","attachElement","edit_view_ui_dic","is_changed","ProgressBar","closeOverlay","_continueDoCopyAsNew","key","hasOwnProperty","widget","getClient","getLoginUser","copied_record_id","collectUIDataToCurrentEditRecord","setEditViewDataDone","is_edit","is_add","target","doNotValidate","setPaymentIconDisabled","setMassEditingFieldsWhenFormChange","setIsChanged","getField","c_value","setDefaultCurrency","getInvoiceTotalData","getShippingOptions","validate","result","filter_only","filter_columns","result_data","isArray","default_billing_contact_id","default_shipping_contact_id","default_other_contact_id","setDefaultArgs","showClientColumn","initInsideEditorData","update_status","transaction_id","product_type_id","status_id","payment_type","confirm_number","amount","status","client_payment","paid_res","updateStatus","paid","setTransactionHistoryData","removeAllRows","getDefaultData","remove","val","row","transaction_data","transaction_record","temp_transaction_record","item","setInvoiceTotalData","loadWidget","title","template","render_div","v","tmp_template","total_data","viewTotalDataUI","removeSortPrefixFromArray","parseFloat","previous_balance","combined_shipping_policy_id","buildRecordArray","isValid","setDefaultMenu","parent_key","parent_value","parent_edit_record","loadScript","firstColumn","trackView","ClientContactViewController","loadSubView","beforeLoadView","afterLoadView","TTPromise","resolve","subViewController","parent_view_controller","postInit","ClientPaymentViewController","InvoiceTransactionViewController","removeEditView","data","getRowRender","getRender","widgets","current_edit_item","is_static_width","product_id","setWidgetEnableBaseOnParentController","bind","e","onRowChanges","parent","no_validate_timer_sec","quantity","unit_price","pro_rate_numerator","pro_rate_denominator","setReadOnly","insertAfter","rows_widgets_array","splice","is_viewing","hide","plus_icon","minus_icon","click","removeLastRowLine","TTUUID","isUUID","zero_id","price_locked","description_locked","rowIndex","remove_id","not_exist_id","delete_ids","current_row","part_number","p_res","u_res","calcTransactionRowTotal","isNaN","isFinite","toFixed","current_edit_item_id","Date","format","effective_date","record","transactions","TAlertManager","showAlert","onCancelClick","initEditView","container","beforeViewLoadedFun","afterViewLoadedFun","loadViewSource","html","sub_invoice_view_controller"],"mappings":"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","file":"invoice-invoice-InvoiceViewController.bundle.js?v=8bb228afeb68bc1d1c4f","sourcesContent":["export class InvoiceViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tstatus_array: null,\n\n\t\t\tclient_group_array: null,\n\t\t\tclient_group_api: null,\n\t\t\tclient_api: null,\n\t\t\tclient_contact_api: null,\n\t\t\tproduct_api: null,\n\t\t\ttransaction_api: null,\n\n\t\t\tel: '#invoice_view_container',\n\n\t\t\tsub_client_contact_view_controller: null,\n\t\t\tsub_client_payment_view_controller: null,\n\t\t\tsub_transaction_view_controller: null,\n\n\t\t\ttotal_data_render: null,\n\t\t\ttotal_data_row_render: null,\n\n\t\t\towing_amount: null,\n\n\t\t\ttransaction_paid_data: null,\n\n\t\t\thistory: null,\n\n\t\t\teditor: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'InvoiceEditView.html';\n\t\tthis.permission_id = 'invoice';\n\t\tthis.viewId = 'Invoice';\n\t\tthis.script_name = 'InvoiceView';\n\t\tthis.table_name_key = 'invoice';\n\t\tthis.context_menu_name = $.i18n._( 'Invoices' );\n\t\tthis.navigation_label = $.i18n._( 'Invoice' ) + ':';\n\t\tthis.api = TTAPI.APIInvoice;\n\t\tthis.client_group_api = TTAPI.APIClientGroup;\n\t\tthis.client_api = TTAPI.APIClient;\n\t\tthis.product_api = TTAPI.APIProduct;\n\t\tthis.transaction_api = TTAPI.APITransaction;\n\t\tthis.client_contact_api = TTAPI.APIClientContact;\n\n\t\tthis.render();\n\n\t\tthis.buildContextMenu();\n\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tthis.initData();\n\t\t}\n\t\tthis.setSelectRibbonMenuIfNecessary( 'Invoice' );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tpayments: {\n\t\t\t\t\tlabel: $.i18n._( 'Payments' ),\n\t\t\t\t\tid: 'payments'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [ContextMenuIconName.mass_edit],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Packing<br>Slip' ),\n\t\t\t\t\tid: ContextMenuIconName.packing_slip,\n\t\t\t\t\tgroup: 'editor',\n\t\t\t\t\ticon: Icons.packing_slip,\n\t\t\t\t\tsort_order: 1012, //After View icon.\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Payment' ),\n\t\t\t\t\tid: ContextMenuIconName.payment,\n\t\t\t\t\tgroup: 'payments',\n\t\t\t\t\ticon: Icons.payment_method\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Edit<br>Client' ),\n\t\t\t\tid: ContextMenuIconName.edit_client,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: Icons.client\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Clients' ),\n\t\t\t\tid: ContextMenuIconName.client,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: 'client_groups-35x35.png',\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Client<br>Contacts' ),\n\t\t\t\tid: ContextMenuIconName.client_contact,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: Icons.client_contact\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Transactions' ),\n\t\t\t\tid: ContextMenuIconName.transaction,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: Icons.transaction\n\t\t\t} );\n\n\t\t\tcontext_menu_model['include'].push( {\n\t\t\t\tlabel: $.i18n._( 'Payment<br>Methods' ),\n\t\t\t\tid: ContextMenuIconName.payment_method,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\ticon: Icons.payment_method\n\t\t\t} );\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\t/* jshint ignore:start */\n\tsetDefaultMenu( doNotSetFocus ) {\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t\tthis.selectContextMenu();\n\t\t}\n\n\t\tthis.setTotalDisplaySpan();\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.packing_slip:\n\t\t\t\t\tthis.setDefaultMenuPackingSlipIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setDefaultMenuAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setDefaultMenuDeleteIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setDefaultMenuDeleteAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setDefaultMenuCopyIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setDefaultMenuSaveAndContinueIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setDefaultMenuSaveAndAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setDefaultMenuSaveAndCopyIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setDefaultMenuSaveAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.payment:\n\t\t\t\t\tthis.setDefaultMenuPaymentIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\t\t\tthis.setDefaultMenuEditClientIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.client:\n\t\t\t\t\tthis.setDefaultMenuClientIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.client_contact:\n\t\t\t\t\tthis.setDefaultMenuClientContactIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.transaction:\n\t\t\t\t\tthis.setDefaultMenuTransactionIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.payment_method:\n\t\t\t\t\tthis.setDefaultMenuPaymentMethodIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\t/* jshint ignore:end */\n\n\t/* jshint ignore:start */\n\tsetEditMenu() {\n\n\t\tthis.selectContextMenu();\n\t\tvar len = this.context_menu_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tif ( this.is_mass_editing ) {\n\t\t\t\tswitch ( id ) {\n\t\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setEditMenuEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setEditMenuViewIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setEditMenuMassEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setEditMenuCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setEditMenuDeleteIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setEditMenuDeleteAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setEditMenuSaveAndContinueIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setEditMenuSaveAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setEditMenuSaveAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setEditMenuSaveAndCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setEditMenuCopyAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.import_icon:\n\t\t\t\t\tthis.setEditMenuImportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.packing_slip:\n\t\t\t\t\tthis.setEditMenuPackingSlipIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.payment:\n\t\t\t\t\tthis.setEditMenuPaymentIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\t/* jshint ignore:end */\n\tsetEditMenuViewIcon( context_btn, pId ) {\n\t\tif ( !this.viewPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuPackingSlipIcon( context_btn, pId ) {\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuPaymentIcon( context_btn, pId ) {\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuViewIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.viewPermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length > 0 && this.viewOwnerOrChildPermissionValidate() ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuPackingSlipIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuPaymentIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuEditClientIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuClientIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuClientContactIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuTransactionIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuPaymentMethodIcon( context_btn, grid_selected_length, pId ) {\n\t\tcontext_btn.removeClass( 'disable-image' );\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\t\tvar column_filter = {};\n\t\tcolumn_filter.is_owner = true;\n\t\tcolumn_filter.id = true;\n\t\tcolumn_filter.is_child = true;\n\t\tcolumn_filter.in_use = true;\n\t\tcolumn_filter.first_name = true;\n\t\tcolumn_filter.last_name = true;\n\t\tcolumn_filter.client_id = true;\n\n\t\t// Error: Unable to get property 'getGridParam' of undefined or null reference\n\t\tvar display_columns = [];\n\t\tif ( this.grid ) {\n\t\t\tdisplay_columns = this.grid.getGridParam( 'colModel' );\n\t\t}\n\n\t\tif ( display_columns ) {\n\t\t\tvar len = display_columns.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar column_info = display_columns[i];\n\t\t\t\tcolumn_filter[column_info.name] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn column_filter;\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\tcase ContextMenuIconName.client:\n\t\t\tcase ContextMenuIconName.client_contact:\n\t\t\tcase ContextMenuIconName.transaction:\n\t\t\tcase ContextMenuIconName.payment_method:\n\t\t\tcase ContextMenuIconName.payment:\n\t\t\tcase ContextMenuIconName.view:\n\t\t\tcase ContextMenuIconName.packing_slip:\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonViewClick() {\n\t\treturn this.onNavigationClick( ContextMenuIconName.view );\n\t}\n\n\tonNavigationClick( iconName ) {\n\t\tvar $this = this;\n\t\tvar grid_selected_id_array;\n\t\tvar filter = { filter_data: {} };\n\t\tvar ids = [];\n\t\tvar client_ids = [];\n\t\tvar invoice_id;\n\t\tvar currency_id;\n\t\tif ( $this.edit_view ) {\n\t\t\tif ( $this.current_edit_record.client_id ) {\n\t\t\t\tclient_ids.push( $this.current_edit_record.client_id );\n\t\t\t}\n\t\t\tcurrency_id = $this.current_edit_record.currency_id;\n\t\t\tif ( $this.current_edit_record.id ) {\n\t\t\t\tinvoice_id = $this.current_edit_record.id;\n\t\t\t\tids.push( $this.current_edit_record.id );\n\t\t\t}\n\t\t} else {\n\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t\tvar grid_selected_row = $this.getRecordFromGridById( value );\n\t\t\t\tids.push( grid_selected_row.id );\n\t\t\t\tclient_ids.push( grid_selected_row.client_id );\n\t\t\t} );\n\t\t}\n\t\tfilter.filter_data.client_id = client_ids;\n\t\tvar args = { filter_data: { id: ids } };\n\t\tvar post_data;\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\t\tif ( client_ids.length > 0 ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'Client', client_ids[0] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.payment:\n\t\t\t\tif ( invoice_id ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'InvoiceTransaction', {\n\t\t\t\t\t\ttype_id: 20,\n\t\t\t\t\t\tinvoice_id: invoice_id,\n\t\t\t\t\t\tclient_id: client_ids[0],\n\t\t\t\t\t\tcurrency_id: currency_id,\n\t\t\t\t\t\towing_amount: this.owing_amount\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.client:\n\t\t\t\tfilter.filter_data.id = filter.filter_data.client_id;\n\t\t\t\tdelete filter.filter_data.client_id;\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Client', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.client_contact:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientContact', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.transaction:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'InvoiceTransaction', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.payment_method:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Invoices' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientPayment', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.view:\n\t\t\t\tpost_data = { 0: args, 1: false, 2: 'pdf' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.packing_slip:\n\t\t\t\tpost_data = { 0: args, 1: false, 2: 'pdf_packing_slip' };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( this.api.className, 'get' + this.api.key_name, postData );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.client_group_api.getClientGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\tif ( !$this.edit_only_mode && !$this.sub_view_mode ) {\n\t\t\t\t\t$this.basic_search_field_ui_dic['client_group_id'].setSourceData( res );\n\t\t\t\t\t$this.adv_search_field_ui_dic['client_group_id'].setSourceData( res );\n\t\t\t\t}\n\n\t\t\t\t$this.client_group_array = res;\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tthis.edit_view.children().eq( 0 ).css( 'min-width', 1050 );\n\n\t\tvar tab_model = {\n\t\t\t'tab_invoice': { 'label': $.i18n._( 'Invoice' ) },\n\t\t\t'tab_client_contacts': {\n\t\t\t\t'label': $.i18n._( 'Client Contacts' ),\n\t\t\t\t'init_callback': 'initSubClientContactView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_payment_methods': {\n\t\t\t\t'label': $.i18n._( 'Payment Methods' ),\n\t\t\t\t'init_callback': 'initSubClientPaymentView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_transactions': {\n\t\t\t\t'label': $.i18n._( 'Transactions' ),\n\t\t\t\t'init_callback': 'initSubTransactionView',\n\t\t\t\t'display_on_mass_edit': false\n\t\t\t},\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIInvoice,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_invoice',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\n\t\tvar tab_invoice_column1 = tab_invoice.find( '.first-column' );\n\t\tvar tab_invoice_column2 = tab_invoice.find( '.second-column' );\n\t\tvar tab_invoice_column3 = tab_invoice.find( '.third-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column2 );\n\t\tthis.edit_view_tabs[0].push( tab_invoice_column3 );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Client\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClient,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'client_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Client' ), form_item_input, tab_invoice_column1, '', null, true );\n\n\t\t// Client\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'client' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Client' ), form_item_input, tab_invoice_column1, '', null, true );\n\n\t\t// Status\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Billing Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'billing_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Billing Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Shipping Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'shipping_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipping Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Other Contact\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_contact',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'other_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Other Contact' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Currency\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_invoice_column1 );\n\n\t\t// PO Number\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'po_number', width: 100 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'PO Number' ), form_item_input, tab_invoice_column1 );\n\n\t\t// Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 910 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_invoice_column1, '', null, null, true );\n\n\t\t// Invoice #\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'invoice_number' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Invoice #' ), form_item_input, tab_invoice_column2, '' );\n\n\t\t// Invoice Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'invoice_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Invoice Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Order Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'order_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Order Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Payment Required\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'required_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Required' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Shipped Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'shipped_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipped Date' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Sales Rep\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'sales_contact_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Sales Rep' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Tracking Number\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'tracking_number' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tracking Number' ), form_item_input, tab_invoice_column2 );\n\n\t\t// Shipping Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'combined_shipping_policy_id' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Shipping Policy' ), form_item_input, tab_invoice_column2, '' );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_invoice.find( '.inside-editor-div' );\n\n\t\tvar args = {\n\t\t\tproduct: $.i18n._( 'Product' ),\n\t\t\tdescription: $.i18n._( 'Description' ),\n\t\t\tqty: $.i18n._( 'QTY' ),\n\t\t\tprice: $.i18n._( 'Price' ),\n\t\t\tprorate: $.i18n._( 'ProRate' ),\n\t\t\ttotal: $.i18n._( 'Total' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.transaction_api,\n\t\t\trender: 'views/invoice/invoice/ProductViewInsideEditorRender.html',\n\t\t\trender_args: args,\n\t\t\trow_render: 'views/invoice/invoice/ProductViewInsideEditorRow.html'\n\n\t\t} );\n\n\t\tinside_editor_div.append( this.editor );\n\n\t\t// Note(private)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'private_note', width: 800, height: 50 } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note(private)' ), form_item_input, tab_invoice_column3, '', null, null, true );\n\n\t\t// Note(public)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'public_note', width: 500, height: 50 } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note(public)' ), form_item_input, tab_invoice_column3, '', null, null, true );\n\n\t\t// Email Invoice To Contact(s)\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tvar email_invoice = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\temail_invoice.TCheckbox( { field: 'email_invoice' } );\n\t\twidgetContainer.append( email_invoice );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'CC' ) + '</span>' );\n\t\twidgetContainer.append( label );\n\t\tvar email_cc = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\temail_cc.TTextInput( { field: 'email_other_cc', width: 200 } );\n\t\twidgetContainer.append( email_cc );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Email Invoice To Contact(s)' ), [email_invoice, email_cc], tab_invoice_column3, '', widgetContainer );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Client' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'client_id',\n\t\t\t\tlayout_name: 'global_client',\n\t\t\t\tapi_class: TTAPI.APIClient,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Client Group' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'client_group_id',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Invoice Number' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'invoice_number',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'PO Number' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'po_number',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Sales Rep' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'sales_contact_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Billing Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'billing_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Shipping Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'shipping_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Other Contact' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'other_contact_id',\n\t\t\t\tlayout_name: 'global_client_contact',\n\t\t\t\tapi_class: TTAPI.APIClientContact,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tin_column: 2,\n\t\t\t\tobject_type_id: 910,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} )\n\n\t\t];\n\t}\n\n\tsetSelectLayout() {\n\t\tif ( this.sub_view_mode ) {\n\t\t\tsuper.setSelectLayout( ['client'] );\n\t\t} else {\n\t\t\tsuper.setSelectLayout();\n\t\t}\n\t}\n\n\t_continueDoCopyAsNew() {\n\n\t\tvar $this = this;\n\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\n\t\t\tthis.current_edit_record.id = '';\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\n\t\t\tthis.detachElement( 'client' );\n\t\t\tthis.attachElement( 'client_id' );\n\t\t\tthis.edit_view_ui_dic['invoice_number'].setValue( $.i18n._( 'N/A' ) );\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\n\t\t} else {\n\t\t\tsuper._continueDoCopyAsNew();\n\t\t}\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'client_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setSourceData( null );\n\t\t\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setSourceData( null );\n\t\t\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setSourceData( null );\n\n\t\t\t\t\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) { //New in sub view, the client_id is set\n\t\t\t\t\t\t\tthis.getClient( this.current_edit_record[key] );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.getClient( this.current_edit_record[key], true );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'combined_shipping_policy_id':\n\t\t\t\t\t\t//set when get shipping options;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'currency_id':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tthis.current_edit_record[key] = LocalCacheData.getLoginUser().currency_id;\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'invoice_number':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] || this.copied_record_id ) {\n\t\t\t\t\t\t\twidget.setValue( $.i18n._( 'N/A' ) );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tshowClientColumn() {\n\t\tif ( this.is_edit ) {\n\t\t\tthis.attachElement( 'client' );\n\t\t\tthis.detachElement( 'client_id' );\n\t\t} else if ( this.is_add ) {\n\t\t\tthis.detachElement( 'client' );\n\t\t\tthis.attachElement( 'client_id' );\n\n\t\t}\n\t}\n\n\tsetPaymentIconDisabled() {\n\t\tvar context_btn = $( this.context_menu_array[14] );\n\t\tthis.setDefaultMenuPaymentIcon( context_btn );\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tthis.setPaymentIconDisabled();\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tthis.setIsChanged( target );\n\t\tvar $this = this;\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\tthis.current_edit_record[key] = target.getValue();\n\n\t\tswitch ( key ) {\n\t\t\tcase 'client_id':\n\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['billing_contact_id'].setValue( false );\n\t\t\t\tthis.edit_view_ui_dic['shipping_contact_id'].setValue( false );\n\t\t\t\tthis.edit_view_ui_dic['other_contact_id'].setValue( false );\n\n\t\t\t\tthis.current_edit_record['billing_contact_id'] = false;\n\t\t\t\tthis.current_edit_record['shipping_contact_id'] = false;\n\t\t\t\tthis.current_edit_record['other_contact_id'] = false;\n\t\t\t\tthis.getClient( c_value );\n\t\t\t\tbreak;\n\t\t\tcase 'billing_contact_id':\n\n\t\t\t\tif ( this.current_edit_record['billing_contact_id'] ) {\n\t\t\t\t\tthis.setDefaultCurrency();\n\t\t\t\t} else {\n\t\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\t}\n\n\t\t}\n\n\t\tswitch ( key ) {\n\t\t\tcase 'currency_id':\n\t\t\tcase 'shipping_contact_id':\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tthis.getShippingOptions();\n\t\t\t\tbreak;\n\t\t\tcase 'combined_shipping_policy_id':\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetDefaultCurrency() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\t\targs.filter_data.id = this.current_edit_record['billing_contact_id'];\n\t\tthis.client_contact_api['get' + this.client_contact_api.key_name]( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tvar result = res.getResult()[0];\n\t\t\t\t// FIXED JS EXCEPTION: Cannot set property 'currency_id' of null\n\t\t\t\tif ( $this.edit_view_ui_dic && $this.current_edit_record ) {\n\t\t\t\t\t//Fixed possible exception -- Error: Unable to get property 'currency_id' of undefined or null reference in /interface/html5/ line 1246\n\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t$this.current_edit_record['currency_id'] = result.currency_id;\n\t\t\t\t\t\t$this.edit_view_ui_dic['currency_id'].setValue( result.currency_id );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.current_edit_record['currency_id'] = LocalCacheData.getLoginUser().currency_id;\n\t\t\t\t\t\t$this.edit_view_ui_dic['currency_id'].setValue( LocalCacheData.getLoginUser().currency_id );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$this.getInvoiceTotalData();\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetClient( client_id, filter_only ) {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\t\tfilter.filter_data = { 'id': client_id };\n\t\tfilter.filter_columns = {\n\t\t\t'invoice_number': true,\n\t\t\t'default_other_contact_id': true,\n\t\t\t'client': true,\n\t\t\t'default_billing_contact_id': true,\n\t\t\t'invoice_date': true,\n\t\t\t'status': true,\n\t\t\t'default_shipping_contact_id': true\n\t\t};\n\t\tif ( client_id ) {\n\t\t\tthis.client_api['get' + this.client_api.key_name]( filter, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar result_data = res.getResult();\n\t\t\t\t\tif ( Global.isArray( result_data ) ) {\n\t\t\t\t\t\tvar result = result_data[0];\n\n\t\t\t\t\t\t//When set it first time in setCurrentEditRecord, don't use default value\n\t\t\t\t\t\tif ( !filter_only ) {\n\n\t\t\t\t\t\t\tvar default_billing_contact_id = result.default_billing_contact_id;\n\t\t\t\t\t\t\tvar default_shipping_contact_id = result.default_shipping_contact_id;\n\t\t\t\t\t\t\tvar default_other_contact_id = result.default_other_contact_id;\n\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['billing_contact_id'].setValue( default_billing_contact_id );\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['shipping_contact_id'].setValue( default_shipping_contact_id );\n\t\t\t\t\t\t\t$this.edit_view_ui_dic['other_contact_id'].setValue( default_other_contact_id );\n\n\t\t\t\t\t\t\t$this.current_edit_record['billing_contact_id'] = default_billing_contact_id;\n\t\t\t\t\t\t\t$this.current_edit_record['shipping_contact_id'] = default_shipping_contact_id;\n\t\t\t\t\t\t\t$this.current_edit_record['other_contact_id'] = default_other_contact_id;\n\n\t\t\t\t\t\t\t$this.setDefaultCurrency();\n\t\t\t\t\t\t\t$this.getShippingOptions();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.edit_view_ui_dic['billing_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\t\t\t\t\t\t$this.edit_view_ui_dic['shipping_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\t\t\t\t\t\t$this.edit_view_ui_dic['other_contact_id'].setDefaultArgs( { 'filter_data': { 'client_id': client_id } } );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\n\t\t\tif ( !filter_only ) {\n\t\t\t\tthis.getInvoiceTotalData();\n\t\t\t\tthis.getShippingOptions();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.showClientColumn();\n\t\tthis.initInsideEditorData();\n\t}\n\n\tinitInsideEditorData( update_status ) {\n\n\t\tvar $this = this;\n\n\t\tvar transaction_id = this.current_edit_record.id ? this.current_edit_record.id : this.copied_record_id;\n\t\tthis.copied_record_id = '';\n\n\t\tif ( !transaction_id ) {\n\n\t\t\tthis.transaction_paid_data = null;\n\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\n\t\t\tif ( this.total_data_render ) {\n\t\t\t\tthis.total_data_render.remove();\n\t\t\t\tthis.total_data_render = null;\n\t\t\t\tthis.total_data_row_render = null;\n\t\t\t}\n\n\t\t\tif ( this.history ) {\n\t\t\t\tthis.history.remove();\n\t\t\t\tthis.history = null;\n\t\t\t}\n\n\t\t\t$this.getInvoiceTotalData();\n\t\t\t$this.getShippingOptions();\n\n\t\t} else {\n\n\t\t\tvar filter = {};\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.invoice_id = transaction_id;\n\t\t\tfilter.filter_data.type_id = 10;\n\t\t\tfilter.filter_data.product_type_id = [10, 20];\n\n\t\t\tthis.transaction_api['get' + this.transaction_api.key_name]( filter, true, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tvar result = res.getResult();\n\n\t\t\t\t\t// get the paid data.\n\t\t\t\t\tfilter.filter_data = {};\n\t\t\t\t\tfilter.filter_columns = {\n\t\t\t\t\t\ttype_id: true,\n\t\t\t\t\t\tstatus_id: true,\n\t\t\t\t\t\tpayment_type: true,\n\t\t\t\t\t\tconfirm_number: true,\n\t\t\t\t\t\tid: true,\n\t\t\t\t\t\tclient_id: true,\n\t\t\t\t\t\tinvoice_id: true,\n\t\t\t\t\t\tamount: true,\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tclient_payment: true\n\t\t\t\t\t};\n\t\t\t\t\tfilter.filter_data.type_id = 20;\n\t\t\t\t\tfilter.filter_data.invoice_id = transaction_id;\n\n\t\t\t\t\t$this.transaction_api['get' + $this.transaction_api.key_name]( filter, true, {\n\t\t\t\t\t\tonResult: function( paid_res ) {\n\n\t\t\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( Global.isSet( update_status ) ) {\n\t\t\t\t\t\t\t\t$this.updateStatus();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar paid = paid_res.getResult();\n\t\t\t\t\t\t\tif ( paid === true ) {\n\t\t\t\t\t\t\t\t$this.transaction_paid_data = null;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$this.transaction_paid_data = paid;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$this.editor.setValue( result );\n\t\t\t\t\t\t\t$this.getInvoiceTotalData( result );\n\t\t\t\t\t\t\t$this.getShippingOptions( result );\n\t\t\t\t\t\t\t$this.setTransactionHistoryData();\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tgetInvoiceTotalData( transaction_data ) {\n\n\t\tvar $this = this;\n\t\tvar transaction_record;\n\n\t\tif ( !$this.edit_view ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Global.isSet( transaction_data ) ) {\n\t\t\ttransaction_record = transaction_data;\n\t\t} else {\n\t\t\ttransaction_record = this.editor.getValue();\n\t\t}\n\n\t\tif ( this.transaction_paid_data ) {\n\t\t\tvar temp_transaction_record = [];\n\t\t\t$.each( transaction_record, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\t\t\t$.each( this.transaction_paid_data, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\n\t\t\ttransaction_record = temp_transaction_record;\n\t\t}\n\n\t\tthis.api.getInvoiceTotalData( transaction_record, this.current_edit_record, false, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tvar result = res.getResult();\n\t\t\t\t$this.setInvoiceTotalData( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetTransactionHistoryData() {\n\n\t\tif ( this.transaction_paid_data ) {\n\n\t\t\tif ( this.history ) {\n\t\t\t\tthis.history.remove();\n\t\t\t}\n\n\t\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\t\t\tvar inside_editor_div = tab_invoice.find( '.inside-transaction-history-div' );\n\n\t\t\tvar render = Global.loadWidget( 'views/invoice/invoice/HistoryViewInsideEditorRender.html' );\n\t\t\tvar row_render = Global.loadWidget( 'views/invoice/invoice/HistoryViewInsideEditorRow.html' );\n\n\t\t\tvar title = {\n\t\t\t\tstatus: $.i18n._( 'Status' ),\n\t\t\t\tpayment_type: $.i18n._( 'Payment Type' ),\n\t\t\t\tclient_payment: $.i18n._( 'Payment Method' ),\n\t\t\t\tconfirm_number: $.i18n._( 'Confirmation Number' ),\n\t\t\t\tamount: $.i18n._( 'Amount' )\n\t\t\t};\n\n\t\t\tvar history = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\t\tvar template = _.template( render );\n\n\t\t\tvar render_div = history.children().eq( 1 );\n\t\t\trender_div.append( template( title ) );\n\n\t\t\trender = $( render_div.find( '.inside-editor-render' ) );\n\t\t\t/* jshint ignore:start */\n\t\t\tfor ( var key in this.transaction_paid_data ) {\n\t\t\t\tvar row = this.transaction_paid_data[key];\n\t\t\t\t$.each( row, function( i, v ) {\n\t\t\t\t\trow[i] = v ? v : '--';\n\t\t\t\t} );\n\n\t\t\t\tvar tmp_template = _.template( row_render );\n\t\t\t\trender.append( tmp_template( row ) );\n\t\t\t}\n\t\t\t/* jshint ignore:end */\n\t\t\tinside_editor_div.append( render );\n\n\t\t\tthis.history = $( render );\n\t\t}\n\t}\n\n\tsetInvoiceTotalData( total_data ) {\n\n\t\tif ( !this.edit_view ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( Global.isSet( this.total_data_render ) ) {\n\t\t\tthis.total_data_render.remove();\n\t\t\tthis.total_data_render = null;\n\t\t}\n\n\t\tvar tab_invoice = this.edit_view_tab.find( '#tab_invoice' );\n\t\tvar inside_editor_div = tab_invoice.find( '.inside-total-data-editor-div' );\n\t\tthis.total_data_row_render = Global.loadWidget( 'views/invoice/invoice/InvoiceTotalDataEditorRow.html' );\n\t\tthis.total_data_render = $( Global.loadWidget( 'views/invoice/invoice/InvoiceTotalDataEditorRender.html' ) );\n\n\t\tvar render_args = this.viewTotalDataUI( Global.removeSortPrefixFromArray( total_data ) );\n\n\t\tif ( Global.isSet( render_args ) ) {\n\t\t\tinside_editor_div.append( this.total_data_render );\n\t\t}\n\t}\n\n\tviewTotalDataUI( total_data ) {\n\n\t\tvar render_args = null;\n\n\t\tfor ( var key in total_data ) {\n\t\t\tvar row = total_data[key];\n\n\t\t\tif ( typeof row === 'object' ) {\n\t\t\t\tif ( key === 'owing' ) {\n\t\t\t\t\tthis.owing_amount = row.amount;\n\t\t\t\t}\n\t\t\t\tif ( Global.isSet( row.amount ) && ( parseFloat( row.amount ) !== 0 || ( key === 'owing' && parseFloat( total_data.paid.amount ) === 0 && parseFloat( total_data.previous_balance.amount ) !== 0 ) ) ) {\n\t\t\t\t\trender_args = { label: row.name, value: row.amount };\n\t\t\t\t\tvar template = _.template( this.total_data_row_render );\n\t\t\t\t\tthis.total_data_render.append( template( render_args ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis.viewTotalDataUI( row );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\treturn render_args;\n\t}\n\n\tgetShippingOptions( transaction_data ) {\n\t\tvar $this = this;\n\t\tvar transaction_record;\n\t\tif ( Global.isSet( transaction_data ) ) {\n\t\t\ttransaction_record = transaction_data;\n\t\t} else {\n\t\t\ttransaction_record = this.editor.getValue();\n\t\t}\n\n\t\tif ( this.transaction_paid_data ) {\n\t\t\tvar temp_transaction_record = [];\n\t\t\t$.each( transaction_record, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\t\t\t$.each( this.transaction_paid_data, function( key, item ) {\n\t\t\t\ttemp_transaction_record.push( item );\n\t\t\t} );\n\n\t\t\ttransaction_record = temp_transaction_record;\n\t\t}\n\n\t\tthis.api.getShippingOptions( transaction_record, this.current_edit_record, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar result = res.getResult();\n\t\t\t\tvar combined_shipping_policy_id = $this.current_edit_record.combined_shipping_policy_id;\n\t\t\t\t$this.edit_view_ui_dic['combined_shipping_policy_id'].setSourceData( Global.buildRecordArray( result ) );\n\t\t\t\t$this.edit_view_ui_dic['combined_shipping_policy_id'].setValue( combined_shipping_policy_id );\n\t\t\t}\n\t\t} );\n\t}\n\n\tupdateStatus() {\n\t\tvar $this = this;\n\t\tthis.api['updateStatus']( this.current_edit_record.id, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\tvar status_id = res.getResult();\n\t\t\t\t\t$this.edit_view_ui_dic['status_id'].setValue( status_id );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tinitSubClientContactView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_client_contact_view_controller ) {\n\t\t\tthis.sub_client_contact_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_client_contact_view_controller.setDefaultMenu();\n\t\t\t$this.sub_client_contact_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_contact_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_contact_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_contact_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/client_contact/ClientContactViewController.js', function() {\n\t\t\tvar tab_client_contacts = $this.edit_view_tab.find( '#tab_client_contacts' );\n\t\t\tvar firstColumn = tab_client_contacts.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'ClientContact' + 'View' );\n\t\t\tClientContactViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_client_contact_view_controller = subViewController;\n\t\t\t$this.sub_client_contact_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_contact_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_contact_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_contact_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_client_contact_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tinitSubClientPaymentView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_client_payment_view_controller ) {\n\t\t\tthis.sub_client_payment_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_client_payment_view_controller.setDefaultMenu();\n\t\t\t$this.sub_client_payment_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_payment_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_payment_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_payment_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/client_payment/ClientPaymentViewController.js', function() {\n\t\t\tvar tab_payment_methods = $this.edit_view_tab.find( '#tab_payment_methods' );\n\t\t\tvar firstColumn = tab_payment_methods.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'ClientPayment' + 'View' );\n\t\t\tClientPaymentViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_client_payment_view_controller = subViewController;\n\t\t\t$this.sub_client_payment_view_controller.parent_key = 'client_id';\n\t\t\t$this.sub_client_payment_view_controller.parent_value = $this.current_edit_record.client_id;\n\t\t\t$this.sub_client_payment_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_client_payment_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_client_payment_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tinitSubTransactionView() {\n\t\tvar $this = this;\n\n\t\tif ( !this.current_edit_record.id ) {\n\t\t\tTTPromise.resolve( 'BaseViewController', 'onTabShow' ); //Since search() isn't called in this case, and we just display the \"Please Save This Record ...\" message, resolve the promise.\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.sub_transaction_view_controller ) {\n\t\t\tthis.sub_transaction_view_controller.buildContextMenu( true );\n\t\t\tthis.sub_transaction_view_controller.setDefaultMenu();\n\t\t\t$this.sub_transaction_view_controller.parent_key = 'invoice_id';\n\t\t\t$this.sub_transaction_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_transaction_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_transaction_view_controller.initData();\n\t\t\treturn;\n\t\t}\n\n\t\tGlobal.loadScript( 'views/invoice/invoice_transaction/InvoiceTransactionViewController.js', function() {\n\t\t\tvar tab_transactions = $this.edit_view_tab.find( '#tab_transactions' );\n\t\t\tvar firstColumn = tab_transactions.find( '.first-column-sub-view' );\n\n\t\t\tGlobal.trackView( 'Sub' + 'InvoiceTransaction' + 'View' );\n\t\t\tInvoiceTransactionViewController.loadSubView( firstColumn, beforeLoadView, afterLoadView );\n\n\t\t} );\n\n\t\tfunction beforeLoadView() {\n\n\t\t}\n\n\t\tfunction afterLoadView( subViewController ) {\n\t\t\t$this.sub_transaction_view_controller = subViewController;\n\t\t\t$this.sub_transaction_view_controller.parent_key = 'invoice_id';\n\t\t\t$this.sub_transaction_view_controller.parent_value = $this.current_edit_record.id;\n\t\t\t$this.sub_transaction_view_controller.parent_edit_record = $this.current_edit_record;\n\t\t\t$this.sub_transaction_view_controller.parent_view_controller = $this;\n\t\t\t$this.sub_transaction_view_controller.postInit = function() {\n\t\t\t\tthis.initData();\n\t\t\t};\n\t\t}\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\t\tthis.history = null;\n\t\tthis.editor = null;\n\t\tthis.total_data_render = null;\n\t\tthis.total_data_row_render = null;\n\t\tthis.transaction_paid_data = null;\n\t\tthis.sub_client_contact_view_controller = null;\n\t\tthis.sub_client_payment_view_controller = null;\n\t\tthis.sub_transaction_view_controller = null;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\n\t\tvar $this = this;\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\n\t\t\t//Save current set item\n\t\t\twidgets.current_edit_item = data;\n\n\t\t\t//Build row widgets\n\n\t\t\t// Product\n\t\t\tvar args = {};\n\t\t\targs.filter_data = {};\n\t\t\targs.filter_data.type_id = [10, 20];\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\twidth: 203,\n\t\t\t\tis_static_width: true,\n\t\t\t\tapi_class: TTAPI.APIProduct,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_product',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tfield: 'product_id'\n\t\t\t} );\n\t\t\tform_item_input.setDefaultArgs( args );\n\t\t\tform_item_input.setValue( data.product_id ? data.product_id : '' );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 0 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target ) {\n\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t} );\n\n\t\t\t// Description\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'description', width: 500 } );\n\t\t\tform_item_input.setValue( data.description ? data.description : '' );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 1 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// QTY\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'quantity', width: 50, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.quantity ? data.quantity : '' );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 2 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// Price\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'unit_price', width: 50, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.unit_price ? data.unit_price : '' );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 3 ).append( form_item_input );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// ProRate\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'pro_rate_numerator', width: 50, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.pro_rate_numerator ? data.pro_rate_numerator : 1 );\n\t\t\tform_item_input.attr( 'maxlength', 3 );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\twidgetContainer.append( form_item_input );\n\n\t\t\tvar label = $( '<span class=\\'widget-right-label\\'>/</span>' );\n\t\t\twidgetContainer.append( label );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'pro_rate_denominator', width: 50, no_validate_timer_sec: 100 } );\n\t\t\tform_item_input.setValue( data.pro_rate_denominator ? data.pro_rate_denominator : 1 );\n\t\t\tform_item_input.attr( 'maxlength', 3 );\n\n\t\t\tform_item_input.bind( 'formItemChange', function( e, target, doNotValidate ) {\n\t\t\t\tif ( doNotValidate ) {\n\t\t\t\t\t$this.parent_controller.onRowChanges( $( this ).parent().parent().parent().index() - 1, target );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\twidgetContainer.append( form_item_input );\n\n\t\t\trow.children().eq( 4 ).append( widgetContainer );\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\t// Total\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'amount', width: 100 } );\n\t\t\tform_item_input.setValue( data.amount ? data.amount : '' );\n\t\t\tform_item_input.setReadOnly( true );\n//\t\t\tform_item_input.attr( 'readonly', 'readonly' );\n\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 5 ).append( form_item_input );\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t\tvar plus_icon = row.find( '.plus-icon' );\n\t\t\tvar minus_icon = row.find( '.minus-icon' );\n\n\t\t\tplus_icon.click( function() {\n\t\t\t\t$this.parent_controller.setPaymentIconDisabled();\n\t\t\t\t$this.addRow( null, $( this ).parent().parent().index() );\n\t\t\t} );\n\n\t\t\tminus_icon.click( function() {\n\t\t\t\t$this.parent_controller.setPaymentIconDisabled();\n\t\t\t\t$this.removeRow( row );\n\n\t\t\t\tif ( render.find( 'tr' ).length === 1 ) {\n\t\t\t\t\t$this.addRow();\n\t\t\t\t}\n\n\t\t\t} );\n\n//\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\n\t\tif ( data && TTUUID.isUUID( data.product_id ) && data.product_id != TTUUID.zero_id ) {\n\t\t\tvar filter = {};\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = data.product_id;\n\t\t\tfilter.filter_columns = { id: true, price_locked: true, description_locked: true };\n\t\t\tthis.parent_controller.product_api['get' + this.parent_controller.product_api.key_name]( filter, {\n\t\t\t\tonResult: function( res ) {\n\t\t\t\t\tvar result = res.getResult()[0];\n\t\t\t\t\twidgets['description'].setReadOnly( result.description_locked );\n\t\t\t\t\twidgets['unit_price'].setReadOnly( result.price_locked );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].current_edit_item.id;\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tthis.delete_ids.push( remove_id );\n\t\t}\n\t\trow.remove();\n\t\tthis.rows_widgets_array.splice( index, 1 );\n\t\tthis.parent_controller.getInvoiceTotalData();\n\t\tthis.removeLastRowLine();\n\t}\n\n\tonRowChanges( index, target ) {\n\t\tthis.setPaymentIconDisabled();\n\t\tvar $this = this;\n\t\tvar current_row = this.editor.rows_widgets_array[index];\n\t\tvar key = target.getField();\n\t\tvar value = target.getValue();\n\t\tvar filter = {};\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_columns = {};\n\t\tfilter.filter_columns.description = true;\n\t\tfilter.filter_columns.name = true;\n\t\tfilter.filter_columns.part_number = true;\n\t\tfilter.filter_columns.type_id = true;\n\t\tfilter.filter_columns.currency_id = true;\n\t\tfilter.filter_columns.id = true;\n\t\tfilter.filter_columns.price_locked = true;\n\t\tfilter.filter_columns.description_locked = true;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'quantity':\n\t\t\tcase 'product_id':\n\t\t\t\tvar product_id;\n\t\t\t\tvar quantity;\n\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\tquantity = 1;\n\t\t\t\t\tproduct_id = value;\n\t\t\t\t} else {\n\t\t\t\t\tquantity = value;\n\t\t\t\t\tproduct_id = current_row['product_id'].getValue();\n\t\t\t\t}\n\t\t\t\tif ( TTUUID.isUUID( product_id ) && product_id != TTUUID.zero_id ) {\n\t\t\t\t\tfilter.filter_data.id = product_id;\n\t\t\t\t\tthis.product_api['get' + this.product_api.key_name]( filter, {\n\t\t\t\t\t\tonResult: function( p_res ) {\n\t\t\t\t\t\t\tvar result_data = p_res.getResult()[0];\n\t\t\t\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\t\t\t\tcurrent_row['description'].setValue( result_data['description'] );\n\t\t\t\t\t\t\t\tcurrent_row['description'].setReadOnly( result_data['description_locked'] );\n\t\t\t\t\t\t\t\tcurrent_row['unit_price'].setReadOnly( result_data['price_locked'] );\n\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_type_id'] = result_data['type_id'];\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_name'] = result_data['name'];\n\t\t\t\t\t\t\t\tcurrent_row['current_edit_item']['product_part_number'] = result_data['part_number'];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( result_data.id && $this.current_edit_record && $this.current_edit_record['currency_id'] ) {\n\t\t\t\t\t\t\t\t$this.product_api['getProductQuantityUnitPrice']( result_data.id, quantity, $this.current_edit_record['currency_id'], {\n\t\t\t\t\t\t\t\t\tonResult: function( u_res ) {\n\t\t\t\t\t\t\t\t\t\tvar unit_price = u_res.getResult();\n\t\t\t\t\t\t\t\t\t\tif ( key === 'product_id' ) {\n\t\t\t\t\t\t\t\t\t\t\tcurrent_row['quantity'].setValue( quantity );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcurrent_row['unit_price'].setValue( unit_price );\n\t\t\t\t\t\t\t\t\t\t$this.calcTransactionRowTotal( current_row );\n\t\t\t\t\t\t\t\t\t\tif ( $this.editor && $this.editor.rows_widgets_array ) {\n\t\t\t\t\t\t\t\t\t\t\t$this.editor.rows_widgets_array[index] = current_row;\n\t\t\t\t\t\t\t\t\t\t\tvar transaction_data = $this.editor.getValue();\n\t\t\t\t\t\t\t\t\t\t\t$this.getInvoiceTotalData( transaction_data );\n\t\t\t\t\t\t\t\t\t\t\t$this.getShippingOptions( transaction_data );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'pro_rate_numerator':\n\t\t\tcase 'pro_rate_denominator':\n\t\t\tcase 'unit_price':\n\t\t\t\tthis.calcTransactionRowTotal( current_row );\n\t\t\t\tvar transaction_data = $this.editor.getValue();\n\t\t\t\tthis.getInvoiceTotalData( transaction_data );\n\t\t\t\tthis.getShippingOptions( transaction_data );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tcalcTransactionRowTotal( current_row ) {\n\t\tvar total = 0.00;\n\t\tvar pro_rate_numerator = parseFloat( current_row['pro_rate_numerator'].getValue() );\n\t\tvar pro_rate_denominator = parseFloat( current_row['pro_rate_denominator'].getValue() );\n\t\tvar quantity = parseFloat( current_row['quantity'].getValue() );\n\t\tvar unit_price = parseFloat( current_row['unit_price'].getValue() );\n\n\t\tif ( ( !isNaN( quantity ) && isFinite( quantity ) ) && ( !isNaN( unit_price ) && isFinite( unit_price ) ) ) {\n\t\t\ttotal = quantity * unit_price;\n\t\t}\n\n\t\tif ( ( !isNaN( pro_rate_numerator ) && isFinite( pro_rate_numerator ) ) && ( !isNaN( pro_rate_denominator ) && isFinite( pro_rate_denominator ) ) ) {\n\t\t\ttotal = total * ( pro_rate_numerator / pro_rate_denominator );\n\t\t}\n\n\t\tcurrent_row['amount'].setValue( parseFloat( total ).toFixed( 2 ) );\n\t}\n\n\tinsideEditorGetValue( current_edit_item_id ) {\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tvar data = {};\n\t\t\tdata['status_id'] = row.current_edit_item['status_id'];\n\t\t\tdata['product_part_number'] = row.current_edit_item['product_part_number'];\n\t\t\tdata['id'] = row.current_edit_item['id'];\n\t\t\tdata['description'] = row.current_edit_item['description'];\n\t\t\tdata['product_name'] = row.current_edit_item['product_name'];\n\t\t\tdata['amount'] = row.current_edit_item['amount'];\n\t\t\tdata['unit_price'] = row.current_edit_item['unit_price'];\n\t\t\tdata['product_type_id'] = row.current_edit_item['product_type_id'];\n\t\t\tdata['type_id'] = row.current_edit_item['type_id'];\n\t\t\tdata['pro_rate_denominator'] = row.current_edit_item['pro_rate_denominator'];\n\t\t\tdata['client_id'] = row.current_edit_item['client_id'];\n\t\t\tdata['quantity'] = row.current_edit_item['quantity'];\n\t\t\tdata['product_id'] = row.current_edit_item['product_id'];\n\t\t\tdata['invoice_id'] = row.current_edit_item['invoice_id'];\n\t\t\tdata['pro_rate_numerator'] = row.current_edit_item['pro_rate_numerator'];\n\t\t\tdata['effective_date'] = row.current_edit_item['effective_date'];\n\n\t\t\tvar product_id = row['product_id'].getValue();\n\n\t\t\tif ( typeof current_edit_item_id !== 'undefined' && ( current_edit_item_id === '' || current_edit_item_id === false ) ) {\n\t\t\t\tdata['id'] = '';\n\t\t\t\tdata['invoice_id'] = '';\n\t\t\t\tdata['type_id'] = 10;\n\t\t\t\tdata['effective_date'] = new Date().format();\n\t\t\t}\n\n\t\t\tif ( typeof data.effective_date === 'undefined' ) {\n\t\t\t\tdata['effective_date'] = new Date().format();\n\t\t\t}\n\n\t\t\tif ( typeof data.type_id === 'undefined' ) {\n\t\t\t\tdata['type_id'] = 10;\n\t\t\t}\n\n\t\t\tif ( TTUUID.isUUID( product_id ) && product_id != TTUUID.zero_id ) {\n\t\t\t\tdata['product_id'] = product_id;\n\t\t\t\tdata['quantity'] = row['quantity'].getValue();\n\t\t\t\tdata['pro_rate_numerator'] = row['pro_rate_numerator'].getValue();\n\t\t\t\tdata['description'] = row['description'].getValue();\n\t\t\t\tdata['pro_rate_denominator'] = row['pro_rate_denominator'].getValue();\n\t\t\t\tdata['amount'] = row['amount'].getValue();\n\t\t\t\tdata['unit_price'] = row['unit_price'].getValue();\n\t\t\t\tdata['client_id'] = this.parent_controller.current_edit_record['client_id'];\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tuniformVariable( record ) {\n\n\t\tif ( !Global.isSet( record ) ) {\n\t\t\trecord = {};\n\t\t}\n\t\tvar transaction_data = this.editor.getValue( this.current_edit_record.id );\n\t\tif ( transaction_data.length > 0 ) {\n\t\t\trecord.transactions = transaction_data;\n\t\t}\n\n\t\treturn record;\n\t}\n\n\tonCopyAsNewResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\t\tif ( !result_data ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t$this.onCancelClick();\n\t\t\treturn;\n\t\t}\n\n\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\tresult_data = result_data[0];\n\t\tthis.copied_record_id = result_data.id;\n\n\t\tresult_data.id = '';\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n}\n\nInvoiceViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'Invoice', 'SubInvoiceView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) );\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tafterViewLoadedFun( sub_invoice_view_controller );\n\t\t\t}\n\t\t}\n\t} );\n};\n"],"sourceRoot":""}