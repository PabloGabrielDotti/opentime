{"version":3,"sources":["webpack://timetrex/./interface/html5/quick_punch/IndexController.js","webpack://timetrex/./interface/html5/views/quick_punch/QuickPunchBaseViewController.js","webpack://timetrex/./interface/html5/views/quick_punch/header/HeaderViewController.js","webpack://timetrex/./interface/html5/views/quick_punch/punch/QuickPunchViewController.js"],"names":["ApplicationRouter","Backbone","Router","options","_","defaults","controller","headerView","routes","super","view_id","Global","loadViewSource","result","template","contentContainer","html","LocalCacheData","current_open_view_id","trackView","eval","this","loadView","url","new_url","getBaseURL","split","setURLToBrowser","viewName","$this","args","needReloadBrowser","window","location","reload","buildArgDic","indexOf","sanitizeViewId","m","fullUrlParameterStr","setAllURLArgs","reg","RegExp","timeout_count","loadViewRequiredJSReady","showRibbonMenuAndLoadView","auto_login_timer","setInterval","clearInterval","$","removeClass","HeaderViewController","el","loadViewController","view_controller","topContainer","css","bottomContainer","children","length","i","attr","current_open_primary_controller","ui_id","remove","e","addClass","loadScript","TopMenuController","callBack","clean","viewController","clearErrorTips","edit_view","sub_log_view_controller","edit_view_ui_dic","edit_view_ui_validation_field_dic","edit_view_form_item_dic","edit_view_error_ui_dic","current_doing_context_action","current_open_edit_only_controller","empty","cleanWhenUnloadView","isSet","IndexViewController","View","router","instance","History","started","history","start","QuickPunchBaseViewController","TTBackboneView","initialize","tpl","loadWidget","render","setElement","company_logo","QuickPunchViewController","type_array","status_array","branch_array","department_array","job_array","job_item_array","job_api","job_item_api","old_type_status","show_job_ui","show_job_item_ui","show_branch_ui","show_department_ui","show_good_quantity_ui","show_bad_quantity_ui","show_transfer_ui","show_node_ui","events","getPunchLoginUser","current_edit_record","permission_id","other_fields","api","branch_api","department_api","other_field_api","getProductEdition","company_api","api_station","current_user_api","initPermission","ProgressBar","showOverlay","TTPromise","add","initOptions","getUserPunch","getOtherFields","wait","jobUIValidate","jobItemUIValidate","branchUIValidate","departmentUIValidate","goodQuantityUIValidate","badQuantityUIValidate","transferUIValidate","noteUIValidate","isFunction","isBranchAndDepartmentAndJobAndJobItemEnabled","onResult","getResult","branch","department","job","job_item","PermissionManager","validate","setSourceData","$el","field","getFirstAvailableField","setAttribute","focus","QuickPunchModalController","_timedRedirect","is_modal","_delegateCallback","onSaveClick","id","name","getOptions","resolve","getBranch","getDepartment","user","filter_data","status_id","user_id","filter_columns","manual_id","default_item_id","getJob","job_id","getJobItem","min","parseInt","getOtherField","type_id","res_data","type","$res_data","permission","getPermissionData","push","label","value","row","onCancelClick","first_name","last_name","punch_time","punch_date","transfer","quantity","bad_quantity","note","save_btn","on","cancel_btn","preRender","document","off","event","attrs","target","attributes","keyCode","preventDefault","shiftKey","parents","index","button","station_id","getStationID","doNext","setStationID","getCurrentStation","result_data","isValid","showErrorAlert","setTimeout","doLogout","callback","error_list","getDetails","hasOwnProperty","error","container","key","error_string","error_obj","isArray","text","i18n","append","size","doNotValidate","currentTarget","c_value","val","find","setJobItemValueWhenJobChanged","is","onTransferChanged","onJobQuickSearch","setUserPunch","validateResult","setErrorTips","no_obj_error_string","getDescription","removeAttr","field_obj","showErrorTips","focus_obj","item","error_msg","tooltip","trigger","clear_all","destroy","job_item_id","job_item_id_col_name","undefined","job_item_widget","current_job_item_id","new_arg","clone","task_result","data","setDefaultData","source_data","set_empty","field_selector","$field","prop","each","option","optionEl","hide","back","record","setIsIdempotent","user_full_name","return_date","is_mobile","isUndefined","Logout","setAnalyticDimensions","APIGlobal","pre_login_data","analytics_enabled","ga","clearTimeout","lh_inst","timeoutStatuscheck","deleteCookie","setPunchLoginUser","setCurrentCompany","sessionStorage","clear","href","timed_redirect_time","onpopstate","timer","stopTimedRedirect","delegateCallback","timedRedirect","modal","backdrop","show","removeTimedRedirect","time","updateTimedRedirect"],"mappings":"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","file":"quick_punch-punch-QuickPunchViewController.bundle.js?v=e62a113d9363ec36ea1c","sourcesContent":["import { HeaderViewController } from '@/views/quick_punch/header/HeaderViewController';\n\nexport class ApplicationRouter extends Backbone.Router {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tcontroller: null,\n\t\t\theaderView: null,\n\t\t\troutes: {\n\t\t\t\t'': 'onViewChange',\n\t\t\t\t'!:viewName': 'onViewChange',\n\t\t\t\t'*notFound': 'notFound'\n\t\t\t}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tloadView( view_id ) {\n\t\tGlobal.loadViewSource( view_id, view_id + 'View.html', function( result ) {\n\t\t\tvar template = _.template( result );\n\t\t\tGlobal.contentContainer().html( template );\n\n\t\t\tLocalCacheData.current_open_view_id = view_id;\n\n\t\t\tGlobal.trackView( view_id );\n\t\t} );\n\t}\n\n\treloadView( view_id ) {\n\t\t//error: Uncaught ReferenceError: XXXXViewController is not defined ininterface/html5/#!m=TimeSheet line 3\n\t\t// Happens when quickly click on context menu and network is slow.\n\t\tif ( eval( 'typeof '+ view_id + 'ViewController' ) === 'function' ) { //Was ES5: window[view_id + 'ViewController'] &&\n\t\t\tthis.loadView( view_id );\n\t\t}\n\t}\n\n\tnotFound( url ) {\n\t\tvar new_url = Global.getBaseURL().split( '#' )[0];\n\n\t\tGlobal.setURLToBrowser( new_url + '#!m=QuickPunchLogin' );\n\t}\n\n\t/* jshint ignore:start */\n\tonViewChange( viewName ) {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\tvar view_id;\n\n\t\tif ( Global.needReloadBrowser ) {\n\t\t\tGlobal.needReloadBrowser = false;\n\t\t\twindow.location.reload();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( viewName ) {\n\t\t\targs = Global.buildArgDic( viewName.split( '&' ) );\n\t\t}\n\t\tif ( viewName && viewName.indexOf( 'm=' ) >= 0 && viewName.indexOf( 'QuickPunch' ) >= 0 ) {\n\t\t\tview_id = Global.sanitizeViewId( args.m );\n\t\t} else {\n\t\t\tview_id = 'QuickPunchLogin';\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL().split( '#' )[0] + '#!m=QuickPunchLogin' );\n\t\t}\n\n\t\tLocalCacheData.fullUrlParameterStr = viewName;\n\n\t\tLocalCacheData.setAllURLArgs( args );\n\t\tvar reg = new RegExp( '^[0-9]*$' );\n\t\tvar timeout_count;\n\t\ttimeout_count = 0;\n\t\t// $('link[title=\"application css\"]').prop('disabled', true);\n\t\tif ( LocalCacheData.loadViewRequiredJSReady ) {\n\t\t\tshowRibbonMenuAndLoadView();\n\t\t} else {\n\t\t\tvar auto_login_timer = setInterval( function() {\n\t\t\t\tif ( timeout_count == 100 ) {\n\t\t\t\t\tclearInterval( auto_login_timer );\n\t\t\t\t}\n\t\t\t\ttimeout_count = timeout_count + 1;\n\t\t\t\tif ( LocalCacheData.loadViewRequiredJSReady ) {\n\t\t\t\t\tshowRibbonMenuAndLoadView();\n\t\t\t\t\tclearInterval( auto_login_timer );\n\t\t\t\t}\n\t\t\t}, 600 );\n\t\t}\n\n\t\tfunction showRibbonMenuAndLoadView() {\n\t\t\t$( 'body' ).removeClass( 'login-bg' );\n\t\t\t// Global.loadStyleSheet( '../theme/default/css/quickPunch.css' + '?v=' + APIGlobal.pre_login_data.application_build ); // #2844 quickpunch css will now be loaded at start.\n\t\t\tif ( !$this.headerView ) {\n\t\t\t\t$this.headerView = new HeaderViewController();\n\t\t\t\t$( '#topContainer' ).html( $this.headerView.el );\n\t\t\t}\n\t\t\tloadViewController();\n\t\t}\n\n\t\tfunction loadViewController() {\n\t\t\tGlobal.loadViewSource( view_id, view_id + 'ViewController.js', function() {\n\t\t\t\t/* jshint ignore:start */\n\t\t\t\tvar view_controller = eval( 'new ' + view_id + 'ViewController(); ' );\n\t\t\t\tGlobal.trackView( view_id );\n\t\t\t\t/* jshint ignore:end */\n\n\t\t\t\t// Only show the top and bottom containers until after the view html is loaded, otherwise the download app links flash up at the top of the page, where the login header should be.\n\t\t\t\t// TODO: Improve this with Vue to be smoother and more structured, rather than trial and error.\n\t\t\t\tGlobal.topContainer().css( 'display', 'block' );\n\t\t\t\tGlobal.bottomContainer().css( 'display', 'block' );\n\t\t\t} );\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\n\tcleanAnySubViewUI() {\n\t\tvar children = Global.contentContainer().children();\n\n\t\tif ( children.length > 1 ) {\n\t\t\tfor ( var i = 1; i < children.length; i++ ) {\n\t\t\t\t// Object doesn't support property or method 'remove', Not sure why, add try catch to ingore this error since this should no harm\n\t\t\t\ttry {\n\n\t\t\t\t\tif ( $( children[i] ).attr( 'id' ) === LocalCacheData.current_open_primary_controller.ui_id ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchildren[i].remove();\n\t\t\t\t\t}\n\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t//Do nothing\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t}\n\n\tsetContentDivHeight() {\n\t\tGlobal.contentContainer().removeClass( 'content-container' );\n\t\tGlobal.contentContainer().addClass( 'content-container-after-login' );\n\t\tGlobal.topContainer().addClass( 'top-container-after-login' );\n\n\t}\n\n\taddTopMenu() {\n\t\tGlobal.loadScript( 'global/widgets/top_menu/TopMenuController.js' );\n\t\tif ( TopMenuController ) {\n\t\t\tTopMenuController.loadView();\n\t\t}\n\n\t}\n\n\tremoveCurrentView( callBack ) {\n\t\tif ( LocalCacheData.current_open_edit_only_controller ) {\n\t\t\tclean( LocalCacheData.current_open_edit_only_controller );\n\t\t\tLocalCacheData.current_open_edit_only_controller = null;\n\t\t}\n\n\t\tif ( LocalCacheData.current_open_primary_controller ) {\n\t\t\tif ( LocalCacheData.current_open_primary_controller.edit_view ) {\n\t\t\t\tclean( LocalCacheData.current_open_primary_controller );\n\t\t\t}\n\t\t\tGlobal.contentContainer().empty();\n\t\t\tLocalCacheData.current_open_primary_controller.cleanWhenUnloadView( callBack );\n\t\t} else {\n\n\t\t\tif ( Global.isSet( callBack ) ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\t\t}\n\n\t\tfunction clean( viewController ) {\n\t\t\tviewController.clearErrorTips();\n\t\t\t// Cannot read property 'remove' of null in interface/html5/IndexController.js?v=9.0.0-20151016-153057 line 439\n\t\t\tif ( viewController.edit_view ) {\n\t\t\t\tviewController.edit_view.remove();\n\t\t\t}\n\t\t\tviewController.sub_log_view_controller = null;\n\t\t\tviewController.edit_view_ui_dic = {};\n\t\t\tviewController.edit_view_ui_validation_field_dic = {};\n\t\t\tviewController.edit_view_form_item_dic = {};\n\t\t\tviewController.edit_view_error_ui_dic = {};\n\t\t\tLocalCacheData.current_doing_context_action = '';\n\t\t}\n\t}\n}\n\nexport class IndexViewController extends Backbone.View {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: 'body', //So we can add event listener for all elements\n\t\t\trouter: null,\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tIndexViewController.instance = this;\n\t\tthis.router = new ApplicationRouter();\n\t\t//Set title in index.php instead.\n\t\t//$( 'title' ).html( '' );\n\t\tthis.router.controller = this;\n\t\t//Error: Backbone.history has already been started in interface/html5/framework/backbone/backbone-min.js?v=9.0.1-20151022-162110 line 28\n\t\tif ( !Backbone.History.started ) {\n\t\t\tBackbone.history.start();\n\t\t}\n\t}\n}\n\nIndexViewController.instance = null;","import { TTBackboneView } from '@/views/TTBackboneView';\n\nexport class QuickPunchBaseViewController extends TTBackboneView {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {} );\n\n\t\tsuper( options );\n\t}\n\n\t// getRequiredFiles() {\n\t// \t//override in child class\n\t// \treturn [];\n\t// }\n\n\t/**\n\t * When changing this function, you need to look for all occurences of this function because it was needed in several bases\n\t * BaseViewController, HomeViewController, BaseWizardController, QuickPunchBaseViewControler\n\t *\n\t * @returns {Array}\n\t */\n\t// filterRequiredFiles() {\n\t// \tvar retval = [];\n\t// \tvar required_files;\n\t//\n\t// \tif ( typeof this._required_files == 'object' ) {\n\t// \t\trequired_files = this._required_files;\n\t// \t} else {\n\t// \t\trequired_files = this.getRequiredFiles();\n\t// \t}\n\t//\n\t// \tif ( required_files && required_files[0] ) {\n\t// \t\tretval = required_files;\n\t// \t} else {\n\t// \t\tfor ( var edition_id in required_files ) {\n\t// \t\t\tif ( Global.getProductEdition() >= edition_id ) {\n\t// \t\t\t\tretval = retval.concat( required_files[edition_id] );\n\t// \t\t\t}\n\t// \t\t}\n\t// \t}\n\t//\n\t// \tDebug.Arr( retval, 'RETVAL', 'BaseViewController.js', 'BaseViewController', 'filterRequiredFiles', 10 );\n\t// \treturn retval;\n\t// }\n}\n","import { TTBackboneView } from '@/views/TTBackboneView';\nimport { ServiceCaller } from '@/services/ServiceCaller';\n\nexport class HeaderViewController extends TTBackboneView {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\t\tvar tpl = Global.loadWidget( 'views/quick_punch/header/HeaderView.html' );\n\t\tif ( tpl ) { //JS Exception: Uncaught TypeError: Cannot read property 'replace' of undefined\n\t\t\tthis.tpl = _.template( tpl );\n\t\t}\n\t\tthis.render();\n\t}\n\n\trender() {\n\t\tvar url = ServiceCaller.getURLByObjectType( 'primary_company_logo' );\n\t\tif ( this.tpl ) {\n\t\t\tthis.setElement( this.tpl( { company_logo: url } ) );\n\t\t}\n\t}\n\n}\n","import { QuickPunchBaseViewController } from '@/views/quick_punch/QuickPunchBaseViewController';\nimport { IndexViewController } from '@/quick_punch/IndexController';\nimport { TTAPI } from '@/services/TimeTrexClientAPI';\nimport { TAlertManager } from '@/global/TAlertManager';\nimport { TTUUID } from '@/global/TTUUID';\n\nexport class QuickPunchViewController extends QuickPunchBaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\ttype_array: null,\n\t\t\tstatus_array: null,\n\t\t\tbranch_array: null,\n\t\t\tdepartment_array: null,\n\t\t\tjob_array: null,\n\t\t\tjob_item_array: null,\n\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\n\t\t\told_type_status: {},\n\n\t\t\tshow_job_ui: false,\n\t\t\tshow_job_item_ui: false,\n\t\t\tshow_branch_ui: false,\n\t\t\tshow_department_ui: false,\n\t\t\tshow_good_quantity_ui: false,\n\t\t\tshow_bad_quantity_ui: false,\n\t\t\tshow_transfer_ui: false,\n\t\t\tshow_node_ui: false,\n\t\t\tel: '#quick_punch_container',\n\t\t\tevents: {\n\t\t\t\t'change input[type=\"text\"]': 'onFormItemChange',\n\t\t\t\t'change input[type=\"checkbox\"]': 'onFormItemChange',\n\t\t\t\t'change select.form-control': 'onFormItemChange',\n\t\t\t\t'change textarea.form-control': 'onFormItemChange'\n\t\t\t}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\n\t\tif ( !LocalCacheData.getPunchLoginUser() ) {\n\t\t\tIndexViewController.instance.router.navigate( 'QuickPunchLogin', true );\n\t\t\treturn false;\n\t\t}\n\t\tthis.current_edit_record = null;\n\t\tthis.edit_view_error_ui_dic = {};\n\t\tthis.permission_id = 'punch';\n\t\tthis.other_fields = [];\n\n\t\tthis.api = TTAPI.APIPunch;\n\t\tthis.branch_api = TTAPI.APIBranch;\n\t\tthis.department_api = TTAPI.APIDepartment;\n\t\tthis.other_field_api = TTAPI.APIOtherField;\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\t\tthis.company_api = TTAPI.APICompany;\n\t\tthis.api_station = TTAPI.APIStation;\n\t\tthis.current_user_api = TTAPI.APIAuthentication;\n\t\tthis.initPermission();\n\t\tProgressBar.showOverlay();\n\n\t\tTTPromise.add( 'QuickPunch', 'CurrentEditRecordComplete' );\n\n\t\tthis.initOptions();\n\t\tthis.getUserPunch();\n\n\t\tvar $this = this;\n\t\tthis.getOtherFields( function() {\n\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\t$this.render();\n\t\t\t} );\n\t\t} );\n\t}\n\n\tinitPermission() {\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.transferUIValidate() ) {\n\t\t\tthis.show_transfer_ui = true;\n\t\t} else {\n\t\t\tthis.show_transfer_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_node_ui = true;\n\t\t} else {\n\t\t\tthis.show_node_ui = false;\n\t\t}\n\n\t\t// Error: Uncaught TypeError: (intermediate value).isBranchAndDepartmentAndJobAndJobItemEnabled is not a function on line 207\n\t\tif ( this.company_api && _.isFunction( this.company_api.isBranchAndDepartmentAndJobAndJobItemEnabled ) ) {\n\t\t\tvar $this = this;\n\t\t\tthis.company_api.isBranchAndDepartmentAndJobAndJobItemEnabled( {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t//tried to fix Unable to get property 'getResult' of undefined or null reference, added if(!result)\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$this.show_branch_ui = false;\n\t\t\t\t\t\t$this.show_department_ui = false;\n\t\t\t\t\t\t$this.show_job_ui = false;\n\t\t\t\t\t\t$this.show_job_item_ui = false;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = result.getResult();\n\t\t\t\t\t\tif ( !result.branch ) {\n\t\t\t\t\t\t\t$this.show_branch_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.department ) {\n\t\t\t\t\t\t\t$this.show_department_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.job ) {\n\t\t\t\t\t\t\t$this.show_job_ui = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !result.job_item ) {\n\t\t\t\t\t\t\t$this.show_job_item_ui = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tjobUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttransferUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_transfer' ) || PermissionManager.validate( 'punch', 'default_transfer' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpreRender( callBack ) {\n\t\tvar $this = this;\n\t\tTTPromise.wait( 'QuickPunch_options', null, function() {\n\t\t\t$this.setSourceData( 'status_id', $this.status_array, true );\n\t\t\t$this.setSourceData( 'type_id', $this.type_array, true );\n\t\t\t$this.setSourceData( 'branch_id', $this.branch_array, true );\n\t\t\t$this.setSourceData( 'department_id', $this.department_array, true );\n\t\t\t$this.setSourceData( 'job_id', $this.job_array, true );\n\t\t\t$this.setSourceData( 'job_item_id', $this.job_item_array, true );\n\n\t\t\tGlobal.contentContainer().html( $this.$el );\n\n\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\tvar field = $this.getFirstAvailableField();\n\t\t\t\tfield.setAttribute( 'tab-start', '' );\n\t\t\t\tfield.focus();\n\t\t\t\tvar quick_punch_success_controller = new QuickPunchModalController( {\n\t\t\t\t\tel: $this.el,\n\t\t\t\t\t_timedRedirect: 10,\n\t\t\t\t\tis_modal: false,\n\t\t\t\t\t_delegateCallback: function() {\n\t\t\t\t\t\t$this.onSaveClick();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t} );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true\n\t\t};\n\t\tTTPromise.add( 'QuickPunch_options', 'Status' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Type' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Branch' );\n\t\tTTPromise.add( 'QuickPunch_options', 'Department' );\n\t\tthis.api.getOptions( 'status', {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.status_array = result.getResult();\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Status' );\n\t\t\t}\n\t\t} );\n\t\tthis.api.getOptions( 'type', {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.type_array = result.getResult();\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Type' );\n\t\t\t}\n\t\t} );\n\t\tthis.branch_api.getBranch( args, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.branch_array = result.getResult();\n\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Branch' );\n\t\t\t}\n\t\t} );\n\t\tthis.department_api.getDepartment( args, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.department_array = result.getResult();\n\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Department' );\n\t\t\t}\n\t\t} );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tTTPromise.add( 'QuickPunch_options', 'Job' );\n\t\t\tTTPromise.add( 'QuickPunch_options', 'JobItem' );\n\n\t\t\tvar user = LocalCacheData.getPunchLoginUser();\n\t\t\targs.filter_data = { status_id: 10, user_id: user.id };\n\t\t\targs.filter_columns.manual_id = args.filter_columns.default_item_id = true;\n\t\t\tthis.job_api.getJob( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.job_array = result.getResult();\n\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'Job' );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\targs.filter_data = { status_id: 10, job_id: $this.current_edit_record.job_id };\n\t\t\t\targs.filter_columns.default_item_id = false;\n\t\t\t\t$this.job_item_api.getJobItem( args, true, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.job_item_array = result.getResult();\n\t\t\t\t\t\tTTPromise.resolve( 'QuickPunch_options', 'JobItem' );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetFirstAvailableField() {\n\t\treturn _.min( this.$( 'input[tabindex], select[tabindex], textarea[tabindex]' ), function( el ) {\n\t\t\tif ( $( el ).attr( 'tabindex' ) ) {\n\t\t\t\treturn parseInt( $( el ).attr( 'tabindex' ) );\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetOtherFields( callBack ) {\n\t\tvar $this = this;\n\t\tvar filter = { filter_data: { type_id: 15 } };// punch type\n\t\tthis.other_field_api.getOtherField( filter, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar res_data = result.getResult();\n\t\t\t\tif ( $.type( res_data ) === 'array' && res_data.length > 0 ) {\n\t\t\t\t\tvar $res_data = res_data[0];\n\t\t\t\t\tTTPromise.wait( 'QuickPunch', 'CurrentEditRecordComplete', function() {\n\t\t\t\t\t\tfor ( var i = 1; i < 10; i++ ) {\n\t\t\t\t\t\t\tif ( $res_data['other_id' + i] ) {\n\t\t\t\t\t\t\t\tvar permission = PermissionManager.getPermissionData();\n\t\t\t\t\t\t\t\tif ( Global.isSet( permission[$this.permission_id]['edit_other_id' + i] ) ) {\n\t\t\t\t\t\t\t\t\tif ( PermissionManager.validate( $this.permission_id, 'edit_other_id' + i ) == false ) {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// field: 'other_id' + i,\n\t\t\t\t\t\t\t\t// value: res_data['other_id' + i]\n\t\t\t\t\t\t\t\t$this.other_fields.push( {\n\t\t\t\t\t\t\t\t\tfield: 'other_id' + i,\n\t\t\t\t\t\t\t\t\tlabel: $res_data['other_id' + i],\n\t\t\t\t\t\t\t\t\tvalue: $this.current_edit_record['other_id' + i]\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tcallBack();\n\t\t\t}\n\t\t} );\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tvar row = Global.loadWidget( 'views/quick_punch/punch/QuickPunchView.html' );\n\n\t\t//#2571 exception: null is not an object (evaluating 'this.current_edit_record['first_name']')\n\t\t//cancel when error case is hit\n\t\tif ( !this.current_edit_record ) {\n\t\t\tthis.onCancelClick();\n\t\t}\n\n\t\tthis.setElement( _.template( row )( {\n\t\t\tshow_job_ui: this.show_job_ui,\n\t\t\tshow_job_item_ui: this.show_job_item_ui,\n\t\t\tshow_branch_ui: this.show_branch_ui,\n\t\t\tshow_department_ui: this.show_department_ui,\n\t\t\tshow_good_quantity_ui: this.show_good_quantity_ui,\n\t\t\tshow_bad_quantity_ui: this.show_bad_quantity_ui,\n\t\t\tshow_transfer_ui: this.show_transfer_ui,\n\t\t\tshow_node_ui: this.show_node_ui,\n\t\t\tfirst_name: this.current_edit_record['first_name'],\n\t\t\tlast_name: this.current_edit_record['last_name'],\n\t\t\tpunch_time: this.current_edit_record['punch_time'],\n\t\t\tpunch_date: this.current_edit_record['punch_date'],\n\t\t\ttransfer: this.current_edit_record['transfer'],\n\t\t\tquantity: this.current_edit_record['quantity'],\n\t\t\tbad_quantity: this.current_edit_record['bad_quantity'],\n\t\t\tnote: this.current_edit_record['note'],\n\t\t\tother_fields: this.other_fields\n\t\t} ) );\n\t\tthis.save_btn = this.$( '#save_btn' );\n\t\tthis.save_btn.on( 'click', function() {\n\t\t\t$this.onSaveClick();\n\t\t} );\n\t\tthis.cancel_btn = this.$( '#cancel_btn' );\n\t\tthis.cancel_btn.on( 'click', function() {\n\t\t\t$this.onCancelClick();\n\t\t} );\n\n\t\tthis.preRender();\n\n\t\t//this.initOptions();\n\t\t$( document ).off( 'keydown' ).on( 'keydown', function( event ) {\n\t\t\tvar attrs = event.target.attributes;\n\t\t\tif ( event.keyCode === 13 && $( event.target ).attr( 'id' ) != 'cancel_btn' ) {\n\t\t\t\tif ( $this.save_btn.attr( 'disabled' ) == 'disabled' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( event.target.name == 'note' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$this.onSaveClick();\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t} else if ( ( event.keyCode === 13 || event.keyCode === 32 ) && $( event.target ).attr( 'id' ) == 'cancel_btn' ) {\n\t\t\t\t$this.onCancelClick();\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode === 9 && event.shiftKey ) {\n\t\t\t\t//ensure the first editable item is selected.\n\t\t\t\tif ( $( event.target ).parents( '.form-group' ).index() == $( $( '.quick-punch-form-container select,input,textarea' )[0] ).parents( '.form-group' ).index() ) {\n\n\t\t\t\t\t$( '#cancel_btn' ).focus();\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( attrs['tab-end'] && event.shiftKey === false ) {\n\t\t\t\tvar button = $this.$( 'input[tab-start]', $this.$el );\n\t\t\t\tif ( button.length > 0 ) { //Uncaught TypeError: Cannot read property 'focus' of undefined\n\t\t\t\t\tbutton[0].focus();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t} );\n\t\treturn this;\n\t}\n\n\tgetUserPunch() {\n\t\tvar $this = this;\n\n\t\tvar station_id = Global.getStationID();\n\n\t\tif ( station_id ) {\n\t\t\tthis.api_station.getCurrentStation( station_id, '10', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tdoNext( result );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.api_station.getCurrentStation( '', '10', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tdoNext( result );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext( result ) {\n\t\t\tif ( !$this.api || typeof $this.api['getUserPunch'] !== 'function' ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar res_data = result.getResult();\n\t\t\t// setCookie( 'StationID', res_data );\n\t\t\tGlobal.setStationID( res_data );\n\t\t}\n\n\t\t$this.api.getUserPunch( {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar result_data = result.getResult();\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t$this.showErrorAlert( result, function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$this.doLogout();\n\t\t\t\t\t\t}, 5000 );\n\t\t\t\t\t} );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif ( Global.isSet( result_data ) ) {\n\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t$this.old_type_status.status_id = result_data.status_id;\n\t\t\t\t\t$this.old_type_status.type_id = result_data.type_id;\n\t\t\t\t\tTTPromise.resolve( 'QuickPunch', 'CurrentEditRecordComplete' );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tshowErrorAlert( result, callback ) {\n\t\tvar error_list = result.getDetails() ? result.getDetails()[0] : {};\n\t\tif ( error_list && error_list.hasOwnProperty( 'error' ) ) {\n\t\t\terror_list = error_list.error;\n\t\t}\n\t\tvar container = $( '<div>' ).addClass( 'alert' ).addClass( 'alert-danger' ).attr( 'role', 'alert' );\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar error_obj = $( '<p>' ).addClass( 'text-center' );\n\t\t\tvar error_string;\n\t\t\tif ( _.isArray( error_list[key] ) ) {\n\t\t\t\terror_string = error_list[key][0];\n\t\t\t} else {\n\t\t\t\terror_string = error_list[key];\n\t\t\t}\n\t\t\terror_obj.text( $.i18n._( error_string ) );\n\t\t\tcontainer.append( error_obj );\n\t\t}\n\t\tif ( _.size( error_list ) > 0 ) {\n\t\t\tGlobal.contentContainer().html( container );\n\t\t}\n\t\tcallback();\n\t}\n\n\tonFormItemChange( e, doNotValidate ) {\n\t\tvar key = e.currentTarget.name;\n\t\tvar c_value = $( e.currentTarget ).val();\n\t\tthis.current_edit_record[key] = c_value;\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tvar manual_id = $( $( e.currentTarget ).find( 'option[value=\\'' + c_value + '\\']' ) ).attr( 'manual_id' );\n\t\t\t\t\tthis.$( 'input[name=\"job_quick_search\"]' ).val( manual_id ? manual_id : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( c_value );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tvar manual_id = $( $( e.currentTarget ).find( 'option[value=\\'' + c_value + '\\']' ) ).attr( 'manual_id' );\n\t\t\t\t\tthis.$( 'input[name=\"job_item_quick_search\"]' ).val( manual_id ? manual_id : '' );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'transfer':\n\t\t\t\tvar c_value;\n\t\t\t\tif ( $( e.currentTarget ).is( ':checked' ) ) {\n\t\t\t\t\tc_value = true;\n\t\t\t\t} else {\n\t\t\t\t\tc_value = false;\n\t\t\t\t}\n\t\t\t\tthis.current_edit_record[key] = c_value;\n\t\t\t\tthis.onTransferChanged( c_value );\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tvalidate() {\n\t\tvar $this = this;\n\t\tthis.api.setUserPunch( this.current_edit_record, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tvalidateResult( result ) {\n\t\tvar $this = this;\n\t\tif ( !result.isValid() ) {\n\t\t\t$this.setErrorTips( result );\n\t\t}\n\t}\n\n\tsetErrorTips( result ) {\n\t\tthis.clearErrorTips( true );\n\t\tvar error_list = {};\n\t\tvar no_obj_error_string = '';\n\t\tif ( result.getDetails() ) {\n\t\t\terror_list = result.getDetails()[0];\n\t\t} else {\n\t\t\tvar error = result.getDescription();\n\t\t\tTAlertManager.showAlert( error, 'Error' );\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\treturn;\n\t\t}\n\t\tif ( error_list && error_list.hasOwnProperty( 'error' ) ) {\n\t\t\terror_list = error_list.error;\n\t\t}\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar field_obj;\n\t\t\tvar error_string;\n\t\t\tswitch ( key ) {\n\t\t\t\t// case 'time_stamp':\n\t\t\t\t//     field_obj = this.$('p[name=\"punch_time\"]');\n\t\t\t\t//     break;\n\t\t\t\t// case 'lic_obj':\n\t\t\t\t//     field_obj = this.$('p[name=\"user_full_name\"]');\n\t\t\t\t//     break;\n\t\t\t\tdefault:\n\t\t\t\t\tif ( this.$( 'input[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'input[name=\"' + key + '\"]' );\n\t\t\t\t\t} else if ( this.$( 'select[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'select[name=\"' + key + '\"]' );\n\t\t\t\t\t} else if ( this.$( 'textarea[name=\"' + key + '\"]' )[0] ) {\n\t\t\t\t\t\tfield_obj = this.$( 'textarea[name=\"' + key + '\"]' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif ( _.isArray( error_list[key] ) ) {\n\t\t\t\terror_string = error_list[key][0];\n\t\t\t} else {\n\t\t\t\terror_string = error_list[key];\n\t\t\t}\n\t\t\tif ( field_obj ) {\n\t\t\t\tthis.showErrorTips( field_obj, error_string );\n\t\t\t\tthis.edit_view_error_ui_dic[key] = field_obj;\n\t\t\t} else {\n\t\t\t\tno_obj_error_string += error_string + '</br>';\n\t\t\t}\n\t\t}\n\t\tif ( _.size( this.edit_view_error_ui_dic ) > 0 ) {\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\tvar focus_obj = _.min( this.edit_view_error_ui_dic, function( item ) {\n\t\t\t\tif ( item.attr( 'tabindex' ) ) {\n\t\t\t\t\treturn parseInt( item.attr( 'tabindex' ) );\n\t\t\t\t}\n\t\t\t} );\n\t\t\tif ( typeof focus_obj.focus !== 'undefined' ) {\n\t\t\t\tfocus_obj.focus();\n\t\t\t} else {\n\t\t\t\tvar field = this.getFirstAvailableField();\n\t\t\t\tfield.focus();\n\t\t\t}\n\t\t}\n\t\tif ( no_obj_error_string != '' ) {\n\t\t\tthis.save_btn.removeAttr( 'disabled' );\n\t\t\tTAlertManager.showAlert( no_obj_error_string, 'Error' );\n\t\t}\n\t}\n\n\tshowErrorTips( field_obj, error_msg ) {\n\t\tfield_obj.addClass( 'error-tip' );\n\t\tfield_obj.attr( 'data-original-title', error_msg );\n\t\tfield_obj.tooltip( {\n\t\t\t// title: error_msg,\n\t\t\tcontainer: 'body',\n\t\t\ttrigger: 'hover focus'\n\t\t\t// placement: 'right'\n\t\t\t// delay: { \"show\": 0, \"hide\": 0 }\n\t\t} );\n\t\tfield_obj.tooltip( 'show' );\n\t\t// field_obj.tooltip('show');\n\t}\n\n\tclearErrorTips( clear_all, destroy ) {\n\t\tfor ( var key in this.edit_view_error_ui_dic ) {\n\t\t\tif ( this.edit_view_error_ui_dic[key].val() !== '' || clear_all ) {\n\t\t\t\tthis.edit_view_error_ui_dic[key].removeClass( 'error-tip' );\n\t\t\t\tthis.edit_view_error_ui_dic[key].attr( 'data-original-title', '' );\n\t\t\t}\n\t\t\tif ( destroy ) {\n\t\t\t\tthis.edit_view_error_ui_dic[key].tooltip( 'dipose' );\n\t\t\t}\n\t\t}\n\t\tthis.edit_view_error_ui_dic = {};\n\t}\n\n\tonJobQuickSearch( key, value ) {\n\t\tvar args = {};\n\t\tvar $this = this;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true\n\t\t};\n\t\tif ( key === 'job_quick_search' ) {\n\t\t\targs.filter_data = { manual_id: value, user_id: this.current_edit_record.user_id, status_id: '10' };\n\t\t\targs.filter_columns.default_item_id = true;\n\t\t\tthis.job_api.getJob( args, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_id\"]' ).val( result_data[0].id );\n\t\t\t\t\t\t$this.current_edit_record.job_id = result_data[0].id;\n\t\t\t\t\t\t$this.setJobItemValueWhenJobChanged( result_data[0].id );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_id\"]' ).val( '' );\n\t\t\t\t\t\t$this.current_edit_record.job_id = false;\n\t\t\t\t\t\t$this.setJobItemValueWhenJobChanged( null );\n\t\t\t\t\t}\n\t\t\t\t\t// $this.$( 'select[name=\"job_id\"]' ).selectpicker('refresh');\n\t\t\t\t}\n\t\t\t} );\n\t\t} else if ( key === 'job_item_quick_search' ) {\n\t\t\targs.filter_data = { manual_id: value, job_id: this.current_edit_record.job_id, status_id: '10' };\n\t\t\tthis.job_item_api.getJobItem( args, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tif ( result_data.length > 0 ) {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_item_id\"]' ).val( result_data[0].id );\n\t\t\t\t\t\t$this.current_edit_record.job_item_id = result_data[0].id;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.$( 'select[name=\"job_item_id\"]' ).val( '' );\n\t\t\t\t\t\t$this.current_edit_record.job_item_id = false;\n\t\t\t\t\t}\n\t\t\t\t\t// $this.$( 'select[name=\"job_item_id\"]' ).selectpicker('refresh');\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonTransferChanged( value ) {\n\t\tif ( value ) {\n\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).attr( 'disabled', true );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).attr( 'disabled', true );\n\n\t\t\tthis.old_type_status.type_id = this.$( 'select[name=\"type_id\"]' ).val();\n\t\t\tthis.old_type_status.status_id = this.$( 'select[name=\"status_id\"]' ).val();\n\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).val( 10 );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).val( 10 );\n\n\t\t\tthis.current_edit_record.type_id = 10;\n\t\t\tthis.current_edit_record.status_id = 10;\n\n\t\t} else {\n\t\t\tthis.$( 'select[name=\"type_id\"]' ).removeAttr( 'disabled' );\n\t\t\tthis.$( 'select[name=\"status_id\"]' ).removeAttr( 'disabled' );\n\n\t\t\tif ( this.old_type_status.hasOwnProperty( 'type_id' ) ) {\n\t\t\t\tthis.$( 'select[name=\"type_id\"]' ).val( this.old_type_status.type_id );\n\t\t\t\tthis.$( 'select[name=\"status_id\"]' ).val( this.old_type_status.status_id );\n\n\t\t\t\tthis.current_edit_record.type_id = this.old_type_status.type_id;\n\t\t\t\tthis.current_edit_record.status_id = this.old_type_status.status_id;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetJobItemValueWhenJobChanged( job, job_item_id_col_name, filter_data ) {\n\t\tvar $this = this;\n\t\tif ( job_item_id_col_name == undefined ) {\n\t\t\tjob_item_id_col_name = 'job_item_id';\n\t\t}\n\t\tif ( filter_data == undefined ) {\n\t\t\tfilter_data = { status_id: 10, job_id: job };\n\t\t}\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\targs.filter_columns = {\n\t\t\tid: true,\n\t\t\tname: true,\n\t\t\tmanual_id: true\n\t\t};\n\t\tvar job_item_widget = $this.$( 'select[name=\"' + job_item_id_col_name + '\"]' );\n\t\tvar current_job_item_id = job_item_widget.val();\n\n\t\tif ( TTUUID.isUUID( current_job_item_id ) && current_job_item_id != TTUUID.zero_id && current_job_item_id != TTUUID.not_exist_id ) {\n\t\t\tvar new_arg = Global.clone( args );\n\t\t\tnew_arg.filter_data.job_id = job;\n\t\t\t$this.job_item_api.getJobItem( new_arg, {\n\t\t\t\tonResult: function( task_result ) {\n\t\t\t\t\tvar data = task_result.getResult();\n\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\t$this.current_edit_record[job_item_id_col_name] = current_job_item_id;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsetDefaultData( job_item_id_col_name );\n\t\t\t\t\t}\n\t\t\t\t\t$this.setSourceData( job_item_id_col_name, data, true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\t\t\tsetDefaultData( job_item_id_col_name );\n\t\t\t$this.job_item_api.getJobItem( args, true, {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.setSourceData( job_item_id_col_name, result.getResult(), true );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction setDefaultData( job_item_id_col_name ) {\n\t\t\tif ( job_item_id_col_name == undefined ) {\n\t\t\t\tjob_item_id_col_name = 'job_item_id';\n\t\t\t}\n\t\t\tif ( $this.current_edit_record.job_id ) {\n\t\t\t\t// job_item_widget.val( $this.$('select[name=\"job_id\"] option[value=\"'+ job +'\"]').attr('default_item_id') );\n\t\t\t\tvar default_item_id = $this.$( 'select[name=\"job_id\"] option[value=\"' + job + '\"]' ).attr( 'default_item_id' );\n\t\t\t\t$this.current_edit_record[job_item_id_col_name] = default_item_id;\n\t\t\t\tif ( default_item_id === false || default_item_id === 0 ) {\n\t\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( '' );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tjob_item_widget.val( '' );\n\t\t\t\t$this.current_edit_record[job_item_id_col_name] = false;\n\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( '' );\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSourceData( field, source_data, set_empty ) {\n\t\tvar $this = this;\n\t\tvar field_selector = 'select[name=\"' + field + '\"]';\n\t\tif ( $( this.$el ).find( field_selector ) && $( this.$el ).find( field_selector )[0] ) {\n\t\t\t$( this.$el ).find( field_selector ).empty();\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tif ( _.size( source_data ) == 0 ) {\n\t\t\tset_empty = true;\n\t\t}\n\t\tif ( set_empty === true ) {\n\t\t\tvar $field = $( $this.$el ).find( field_selector );\n\t\t\tswitch ( field ) {\n\t\t\t\tcase 'status_id':\n\t\t\t\tcase 'type_id':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t$field.append( $( '<option></option>' ).prop( 'value', '0' ).text( '-- ' + $.i18n._( 'None' ) + ' --' ) ).attr( 'selected', 'selected' );\n\t\t\t\t// $($this.$el).find(field_selector).selectpicker();\n\t\t\t}\n\t\t}\n\t\tif ( _.size( source_data ) > 0 ) {\n\t\t\tif ( _.isArray( source_data ) ) {\n\t\t\t\t_.each( source_data, function( option ) {\n\t\t\t\t\tvar optionEl = $( '<option></option>' ).prop( 'value', option.id ).text( option.name );\n\t\t\t\t\tif ( field == 'job_id' || field == 'job_item_id' ) {\n\t\t\t\t\t\toptionEl.attr( 'manual_id', option.manual_id );\n\t\t\t\t\t}\n\t\t\t\t\tif ( field == 'job_id' ) {\n\t\t\t\t\t\toptionEl.attr( 'default_item_id', option.default_item_id );\n\t\t\t\t\t}\n\t\t\t\t\t$( $this.$el ).find( field_selector ).append( optionEl );\n\t\t\t\t\tif ( $this.current_edit_record[field] == option.id ) {\n\t\t\t\t\t\t$( $this.$el ).find( field_selector ).val( option.id );\n\t\t\t\t\t\tif ( field == 'job_id' ) {\n\t\t\t\t\t\t\t$this.$( 'input[name=\"job_quick_search\"]' ).val( option.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( field == 'job_item_id' ) {\n\t\t\t\t\t\t\t$this.$( 'input[name=\"job_item_quick_search\"]' ).val( option.manual_id );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\t$.each( source_data, function( value, label ) {\n\t\t\t\t\t$( $this.$el ).find( field_selector ).append( $( '<option></option>' ).prop( 'value', value ).text( label ) );\n\t\t\t\t\tif ( field == 'status_id' || field == 'type_id' ) {\n\t\t\t\t\t\tif ( $this.current_edit_record.transfer == true ) {\n\t\t\t\t\t\t\t$this.current_edit_record[field] = 10;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( $this.current_edit_record[field] == value ) {\n\t\t\t\t\t\t$( $this.$el ).find( field_selector ).val( value );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\t// $this.$($this.el).find(field_selector).selectpicker('refresh');\n\t\t} else {\n\t\t\tswitch ( field ) {\n\t\t\t\tcase 'branch_id':\n\t\t\t\tcase 'department_id':\n\t\t\t\t\t$( $this.$el ).find( 'div.' + field ).hide();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'job_id':\n\t\t\t\t\t$( $this.$el ).find( 'div.' + field ).hide();\n\t\t\t\t\t$( $this.$el ).find( 'div.job_item_id' ).hide();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tonCancelClick() {\n\t\twindow.history.back();\n\t}\n\n\tonSaveClick() {\n\t\tvar $this = this;\n\t\tvar record = this.current_edit_record;\n\t\tthis.save_btn.attr( 'disabled', 'disabled' );\n\t\tthis.clearErrorTips( true, true );\n\n\t\tthis.api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\tthis.api.setUserPunch( record, false, false, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\tvar quick_punch_success_controller = new QuickPunchModalController( {\n\t\t\t\t\t\tel: _.template( Global.loadWidget( 'views/quick_punch/punch/QuickPunchSuccessView.html' ) )( {\n\t\t\t\t\t\t\tuser_full_name: $this.current_edit_record['first_name'] + ' ' + $this.current_edit_record['last_name'],\n\t\t\t\t\t\t\tlabel: $this.current_edit_record['status_id'] == 10 ? $.i18n._( 'In' ) : $.i18n._( 'Out' ),\n\t\t\t\t\t\t\treturn_date: $this.current_edit_record['time_stamp'],\n\t\t\t\t\t\t\tis_mobile: ( _.isUndefined( window.is_mobile ) == false )\n\t\t\t\t\t\t} ),\n\t\t\t\t\t\t_timedRedirect: 5,\n\t\t\t\t\t\tis_modal: true,\n\t\t\t\t\t\t_delegateCallback: function() {\n\t\t\t\t\t\t\t$this.doLogout();\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tdoLogout() {\n\t\t//Don't wait for result of logout in case of slow or disconnected internet. Just clear local cookies and move on.\n\t\tthis.current_user_api.Logout( {\n\t\t\tonResult: function() {\n\t\t\t}\n\t\t} );\n\t\tGlobal.setAnalyticDimensions();\n\t\tif ( typeof ( ga ) != 'undefined' && APIGlobal.pre_login_data.analytics_enabled === true ) {\n\t\t\ttry {\n\t\t\t\tga( 'send', 'pageview', { 'sessionControl': 'end' } );\n\t\t\t} catch ( e ) {\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\t\t//A bare \"if\" wrapped around lh_inst doesn't work here for some reason.\n\t\tif ( typeof ( lh_inst ) != 'undefined' ) {\n\t\t\t//stop the update loop for live chat with support\n\t\t\tclearTimeout( lh_inst.timeoutStatuscheck );\n\t\t}\n\t\tdeleteCookie( 'SessionID-QP' );\n\t\tLocalCacheData.setPunchLoginUser( null );\n\t\tLocalCacheData.setCurrentCompany( null );\n\t\tsessionStorage.clear();\n\t\tif ( window.location.href === Global.getBaseURL() + '#!m=QuickPunchLogin' ) {\n\t\t\tIndexViewController.instance.router.reloadView( 'QuickPunchLogin' );\n\t\t} else {\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=QuickPunchLogin' );\n\t\t}\n\t}\n\n}\n\nexport class QuickPunchModalController extends Backbone.View { //Must extend Backbone.View rather than TTBackbone otherwise Quick Punch success modal fails.\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\ttimed_redirect_time: 0\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\t//super.initialize( options );\n\t\tvar $this = this;\n\t\tthis._delegateCallback = options._delegateCallback || null;\n\t\tthis._timedRedirect = options._timedRedirect;\n\t\tthis.is_modal = options.is_modal;\n\t\tthis.render();\n\n\t\t//Back button or Forward button\n\t\twindow.onpopstate = function() {\n\t\t\tclearTimeout( $this.timer );\n\t\t};\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\t$( document ).off( 'keyup' ).on( 'keyup', function() {\n\t\t\t$this.stopTimedRedirect();\n\t\t} );\n\n\t\t//must use core Javascript as the jquery function did not catch the event properly and did not stop the timer when opening selects.\n\t\t// $(document).on('mouseup', function () {\n\t\t// \t$this.stopTimedRedirect();\n\t\t// });\n\t\t$( document ).off( 'mousedown' ).on( 'mousedown', function() {\n\t\t\t$this.stopTimedRedirect();\n\t\t} );\n\t\tif ( this.is_modal ) {\n\t\t\t$( this.el ).on( 'hidden.bs.modal', function() {\n\t\t\t\t$this.remove();\n\t\t\t\t$this.delegateCallback();\n\t\t\t} );\n\t\t\t$( this.el ).on( 'shown.bs.modal', function() {\n\t\t\t\t$this.timedRedirect( $this._timedRedirect );\n\t\t\t} );\n\t\t\t$( 'body' ).append( $( this.el ).modal( {\n\t\t\t\tbackdrop: 'static',\n\t\t\t\tshow: true\n\t\t\t} ) );\n\t\t} else {\n\t\t\t$this.timedRedirect( $this._timedRedirect );\n\t\t}\n\t\treturn this;\n\t}\n\n\tdelegateCallback() {\n\t\tif ( this._delegateCallback ) {\n\t\t\tthis._delegateCallback();\n\t\t}\n\t}\n\n\tstopTimedRedirect() {\n\t\tif ( this.is_modal === false ) {\n\t\t\tthis._delegateCallback = null;\n\t\t}\n\t\tthis.removeTimedRedirect();\n\t}\n\n\tupdateTimedRedirect( time ) {\n\t\tif ( time != 'undefined' && time > 0 ) {\n\t\t\tthis.timed_redirect_time = time;\n\t\t}\n\t}\n\n\tremoveTimedRedirect() {\n\t\tclearTimeout( this.timer );\n\t\tif ( this.is_modal ) {\n\t\t\tthis.$el.modal( 'hide' );\n\t\t} else {\n\t\t\tthis.$( '#timedRedirect' ).remove();\n\t\t\tthis.delegateCallback();\n\t\t}\n\t}\n\n\ttimedRedirect( time ) {\n\t\tvar $this = this;\n\t\tthis.updateTimedRedirect( time );\n\t\tif ( this.timed_redirect_time > 0 ) {\n\t\t\tthis.$( '#timedRedirect' ).html( '( ' + this.timed_redirect_time + ' )' );\n\t\t\tthis.timed_redirect_time--;\n\t\t\tthis.timer = setTimeout( function() {\n\t\t\t\t$this.timedRedirect( null );\n\t\t\t}, 1000 );\n\t\t} else if ( this.timed_redirect_time == 0 ) {\n\t\t\tthis.removeTimedRedirect();\n\t\t}\n\t}\n}\n"],"sourceRoot":""}