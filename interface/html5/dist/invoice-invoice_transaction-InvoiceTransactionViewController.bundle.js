(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["invoice-invoice_transaction-InvoiceTransactionViewController"],{5229:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"InvoiceTransactionViewController":()=>n});class n extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#invoice_transaction_view_container",status_array:null,type_array:null,payment_type_array:null,currency_array:null,currency_api:null}),super(e)}init(e){this.edit_view_tpl="InvoiceTransactionEditView.html",this.permission_id="transaction",this.viewId="InvoiceTransaction",this.script_name="InvoiceTransactionView",this.table_name_key="invoice_transaction",this.context_menu_name=$.i18n._("Transactions"),this.navigation_label=$.i18n._("Transaction")+":",this.api=TTAPI.APITransaction,this.currency_api=TTAPI.APICurrency,this.render(),this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary("InvoiceTransaction")}initOptions(e){var t=this,i=[{option_name:"status",field_name:null,api:null},{option_name:"type",field_name:null,api:null},{option_name:"payment_type",field_name:null,api:null}];this.currency_api.getCurrency({filter_columns:{name:!0,id:!0}},!1,{onResult:function(n){n=n.getResult();var a={};$.each(n,(function(e,t){a[t.id]=t.name})),t.currency_array=Global.buildRecordArray(a),t.initDropDownOptions(i,(function(t){e&&e(t)}))}})}getCustomContextMenuModel(){var e={exclude:["default"],include:[ContextMenuIconName.edit,ContextMenuIconName.delete_icon,ContextMenuIconName.delete_and_next,ContextMenuIconName.save,ContextMenuIconName.save_and_continue,ContextMenuIconName.save_and_next,ContextMenuIconName.cancel]};return this.sub_view_mode||this.edit_only_mode||e.include.push({label:$.i18n._("Edit<br>Client"),id:ContextMenuIconName.edit_client,group:"navigation",icon:Icons.client},{label:$.i18n._("Client<br>Contacts"),id:ContextMenuIconName.client_contact,group:"navigation",icon:Icons.client_contact},{label:$.i18n._("Invoices"),id:ContextMenuIconName.invoice,group:"navigation",icon:Icons.invoice},{label:$.i18n._("Payment<br>Methods"),id:ContextMenuIconName.payment_method,group:"navigation",icon:Icons.payment_method},ContextMenuIconName.export_excel),e}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,n=0;n<t;n++){var a=$(this.context_menu_array[n]),o=$(a.find(".ribbon-sub-menu-icon")).attr("id");switch(a.removeClass("invisible-image"),a.removeClass("disable-image"),o){case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(a,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(a,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(a,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(a,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(a,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(a,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(a,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(a,i);break;case ContextMenuIconName.edit_client:this.setDefaultMenuEditClientIcon(a,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(a,i)}}this.setContextMenuGroupVisibility()}}setDefaultMenuEditClientIcon(e,t,i){1===t?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.edit_client:case ContextMenuIconName.client_contact:case ContextMenuIconName.invoice:case ContextMenuIconName.payment_method:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}onNavigationClick(e){var t,i=this,n={filter_data:{}},a=[];switch(i.edit_view&&i.current_edit_record.id?a.push(i.current_edit_record.client_id):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var n=i.getRecordFromGridById(t);a.push(n.client_id)}))),n.filter_data.client_id=a,e){case ContextMenuIconName.edit_client:a.length>0&&IndexViewController.openEditView(this,"Client",a[0]);break;case ContextMenuIconName.client_contact:Global.addViewTab(i.viewId,$.i18n._("Transactions"),window.location.href),IndexViewController.goToView("ClientContact",n);break;case ContextMenuIconName.invoice:Global.addViewTab(i.viewId,$.i18n._("Transactions"),window.location.href),IndexViewController.goToView("Invoice",n);break;case ContextMenuIconName.payment_method:Global.addViewTab(i.viewId,$.i18n._("Transactions"),window.location.href),IndexViewController.goToView("ClientPayment",n);break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name)}}buildEditViewUI(){super.buildEditViewUI();var e=this,t={"tab_transaction":{"label":$.i18n._("Transaction")},"tab_audit":!0};this.setTabModel(t),this.edit_only_mode||(this.navigation.AComboBox({api_class:TTAPI.APITransaction,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_transaction",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var i=this.edit_view_tab.find("#tab_transaction").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var n=Global.loadWidgetByName(FormItemType.COMBO_BOX);n.TComboBox({field:"status_id"}),n.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),n,i,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"currency_id"}),n.setSourceData(e.currency_array),this.addEditFieldToColumn($.i18n._("Currency"),n,i),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),n.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),n,i),this.edit_only_mode||((n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIProduct,allow_multiple_selection:!1,layout_name:"global_product",show_search_inputs:!0,set_empty:!0,field:"product_id"}),this.addEditFieldToColumn($.i18n._("Product"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn($.i18n._("Description"),n,i,"",null,!0),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"quantity",width:80}),this.addEditFieldToColumn($.i18n._("Quantity"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"unit_cost",width:80}),this.addEditFieldToColumn($.i18n._("Unit Cost"),n,i,"",null,!0)),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"payment_type_id"}),n.setSourceData(e.payment_type_array),this.addEditFieldToColumn($.i18n._("Payment Type"),n,i,"",null,!0);var a={filter_data:{}};a.filter_data.client_id=-1,a.filter_data.type_id=[],(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIClientPayment,allow_multiple_selection:!1,layout_name:"global_client_payment",show_search_inputs:!0,set_empty:!0,field:"client_payment_id"}),n.setDefaultArgs(a),this.addEditFieldToColumn($.i18n._("Payment Method"),n,i,"",null,!0),this.edit_only_mode||((n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"unit_price",width:80}),this.addEditFieldToColumn($.i18n._("Unit Price"),n,i,"",null,!0)),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"amount",width:80}),this.addEditFieldToColumn($.i18n._("Amount"),n,i),(n=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"effective_date"}),this.addEditFieldToColumn($.i18n._("Effective Date"),n,i),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"confirm_number",width:120}),this.addEditFieldToColumn($.i18n._("Confirmation Number"),n,i,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),n,i,"",null,null,!0),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"payment_process_message"}),this.addEditFieldToColumn($.i18n._("Payment Process Message"),n,i,"",null,!0)}getTransactionDefaultData(e,t){this.api["get"+this.api.key_name+"DefaultData"](e.type_id,e.invoice_id,{onResult:function(i){var n=i.getResult();n||(n={}),n.invoice_id=e.invoice_id,n.client_id=e.client_id,n.type_id=e.type_id,n.currency_id=e.currency_id,n.amount=e.owing_amount,n.effective_date=(new Date).format(),t(n)}})}openEditView(e){var t=this;t.edit_only_mode?t.initOptions((function(i){t.edit_view||t.initEditViewUI(t.viewId,t.edit_view_tpl),t.getTransactionDefaultData(e,(function(e){t.current_edit_record=e,t.initEditView()}))})):this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl)}getFilterColumnsFromDisplayColumns(){var e={is_owner:!0,id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,client_id:!0},t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,n=0;n<i;n++){e[t[n].name]=!0}return e}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Product"),in_column:1,field:"product_id",layout_name:"global_product",api_class:TTAPI.APIProduct,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Invoice Number"),in_column:2,field:"invoice_number",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Client"),in_column:2,field:"client_id",layout_name:"global_client",api_class:TTAPI.APIClient,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}setSelectLayout(){this.sub_view_mode?super.setSelectLayout(["client"]):super.setSelectLayout()}onFormItemChange(e,t){var i=e.getField(),n=e.getValue();this.current_edit_record[i]=n,this.is_changed=!0,"type_id"===i&&this.onTypeChange(),"payment_type_id"===i&&this.onPaymentTypeChange(!0),t||this.validate()}setCurrentEditRecordData(){for(var e in this.current_edit_record.hasOwnProperty("payment_process_message")&&this.current_edit_record.payment_process_message?this.attachElement("payment_process_message"):this.detachElement("payment_process_message"),this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"type_id":default:t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.onPaymentTypeChange(),this.isEditChange()}onTypeChange(){10==this.current_edit_record.type_id?(this.detachElement("product_id"),this.detachElement("description"),this.detachElement("quantity"),this.detachElement("unit_cost"),this.detachElement("payment_type_id"),this.detachElement("client_payment_id"),this.detachElement("unit_price"),this.detachElement("confirm_number")):(this.edit_only_mode||(this.detachElement("product_id"),this.detachElement("description"),this.detachElement("quantity"),this.detachElement("unit_cost"),this.detachElement("unit_price")),this.attachElement("payment_type_id"),this.detachElement("client_payment_id"),this.detachElement("confirm_number")),this.editFieldResize()}onPaymentTypeChange(e){e&&(this.edit_view_ui_dic.client_payment_id.setValue(!1),this.current_edit_record.client_payment_id=!1),10==this.current_edit_record.payment_type_id?(this.detachElement("client_payment_id"),this.detachElement("confirm_number")):30==this.current_edit_record.payment_type_id||35==this.current_edit_record.payment_type_id||40==this.current_edit_record.payment_type_id?(this.edit_view_ui_dic.client_payment_id.setSourceData(null),40==this.current_edit_record.payment_type_id?(this.edit_view_ui_dic.client_payment_id.default_args.filter_data.client_id=this.current_edit_record.client_id,this.edit_view_ui_dic.client_payment_id.default_args.filter_data.type_id=[40]):(this.edit_view_ui_dic.client_payment_id.default_args.filter_data.client_id=this.current_edit_record.client_id,this.edit_view_ui_dic.client_payment_id.default_args.filter_data.type_id=[30]),this.attachElement("client_payment_id"),this.detachElement("confirm_number")):(this.attachElement("confirm_number"),this.detachElement("client_payment_id")),this.editFieldResize()}isEditChange(){this.current_edit_record.id?(this.edit_view_ui_dic.status_id.setEnabled(!1),this.edit_view_ui_dic.type_id.setEnabled(!1),this.edit_view_ui_dic.product_id.setEnabled(!1),this.edit_view_ui_dic.quantity.setEnabled(!1),this.edit_view_ui_dic.unit_cost.setEnabled(!1),this.edit_view_ui_dic.unit_price.setEnabled(!1)):this.edit_only_mode?(this.edit_view_ui_dic.status_id.setEnabled(!1),this.edit_view_ui_dic.currency_id.setEnabled(!1),this.edit_view_ui_dic.type_id.setEnabled(!1)):(this.edit_view_ui_dic.status_id.setEnabled(!0),this.edit_view_ui_dic.type_id.setEnabled(!0),this.edit_view_ui_dic.product_id.setEnabled(!0),this.edit_view_ui_dic.quantity.setEnabled(!0),this.edit_view_ui_dic.unit_cost.setEnabled(!0),this.edit_view_ui_dic.unit_price.setEnabled(!0))}onSaveResult(e){var t=this;if(e.isValid()){var i=e.getResult();this.edit_only_mode||(!0===i?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.search()),t.onSaveDone(e),t.removeEditView(),this.edit_only_mode&&t.parent_view_controller.initInsideEditorData(!0)}else t.setErrorMenu(),t.setErrorTips(e)}}n.loadSubView=function(e,t,i){Global.loadViewSource("InvoiceTransaction","SubInvoiceTransactionView.html",(function(n){var a=_.template(n);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(a({})),Global.isSet(i)&&i(sub_invoice_transaction_view_controller))}))}}}]);
//# sourceMappingURL=invoice-invoice_transaction-InvoiceTransactionViewController.bundle.js.map?v=d2a99d566aa0244b0a78