{"version":3,"sources":["webpack://timetrex/./interface/html5/views/attendance/in_out/InOutViewController.js"],"names":["InOutViewController","BaseViewController","options","_","defaults","type_array","job_api","job_item_api","old_type_status","show_job_ui","show_job_item_ui","show_branch_ui","show_department_ui","show_good_quantity_ui","show_bad_quantity_ui","show_transfer_ui","show_node_ui","original_note","new_note","super","Global","setUINotready","this","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","api","TTAPI","APIPunch","getProductEdition","APIJob","APIJobItem","render","buildContextMenu","initPermission","initData","is_changed","exclude","include","ContextMenuIconName","save","cancel","p_id","isSet","PermissionManager","validate","jobUIValidate","jobItemUIValidate","branchUIValidate","departmentUIValidate","goodQuantityUIValidate","badQuantityUIValidate","transferUIValidate","noteUIValidate","result","company_api","APICompany","isFunction","isBranchAndDepartmentAndJobAndJobItemEnabled","async","getResult","branch","department","job","job_item","callBack","initDropDownOptions","option_name","$this","station_id","getStationID","api_station","APIStation","doNext","res_data","setStationID","getUserPunch","onResult","result_data","UNIT_TEST_MODE","punch_date","punch_time","isValid","TAlertManager","showErrorAlert","onCancelClick","getCurrentStation","force_no_confirm","edit_only_mode","initOptions","edit_view","initEditViewUI","current_edit_record","initEditView","target","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","key","getField","c_value","getValue","onTransferChanged","edit_view_ui_dic","setValue","manual_id","setJobItemValueWhenJobChanged","status_id","job_id","setCheckBox","onJobQuickSearch","initial_load","is_transfer","type_id_widget","status_id_widget","setEnabled","type_id","hasOwnProperty","note","record","is_mass_editing","widget","isChecked","getEnabled","uniformVariable","setUserPunch","validateResult","ignoreWarning","callback","current_api","getCurrentAPI","onSaveResult","bind","setIsIdempotent","LocalCacheData","current_open_primary_controller","search","len","context_menu_array","length","i","context_btn","id","find","attr","removeClass","addClass","buildEditViewUI","tab_model","setTabModel","form_item_input","widgetContainer","tab_punch_column1","edit_view_tab","edit_view_tabs","push","loadWidgetByName","FormItemType","TEXT","TText","field","addEditFieldToColumn","TIME_PICKER","TTimePicker","DATE_PICKER","TDatePicker","CHECKBOX","TCheckbox","detachElement","COMBO_BOX","TComboBox","setSourceData","status_array","AWESOME_BOX","AComboBox","api_class","APIBranch","allow_multiple_selection","layout_name","show_search_inputs","set_empty","APIDepartment","setRealValueCallBack","val","job_coder","TEXT_INPUT","TTextInput","disable_keyup_event","append","job_item_coder","good","width","good_label","bad","bad_label","hide","TEXT_AREA","TTextArea","parent","first_name","last_name","args","filter_data","user_id","setDefaultArgs","collectUIDataToCurrentEditRecord","setEditViewDataDone","confirm_on_exit","loadView","loadViewSource","template","contentContainer","html"],"mappings":"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","file":"attendance-in_out-InOutViewController.bundle.js?v=18032d367bd0ce78d197","sourcesContent":["export class InOutViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\n\t\t\ttype_array: null,\n\n\t\t\tjob_api: null,\n\t\t\tjob_item_api: null,\n\n\t\t\told_type_status: {},\n\n\t\t\tshow_job_ui: false,\n\t\t\tshow_job_item_ui: false,\n\t\t\tshow_branch_ui: false,\n\t\t\tshow_department_ui: false,\n\t\t\tshow_good_quantity_ui: false,\n\t\t\tshow_bad_quantity_ui: false,\n\t\t\tshow_transfer_ui: false,\n\t\t\tshow_node_ui: false,\n\n\t\t\toriginal_note: false,\n\t\t\tnew_note: false\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\tGlobal.setUINotready( true );\n\n\t\tthis.permission_id = 'punch';\n\t\tthis.viewId = 'InOut';\n\t\tthis.script_name = 'InOutView';\n\t\tthis.table_name_key = 'punch';\n\t\tthis.context_menu_name = $.i18n._( 'In/Out' );\n\t\tthis.api = TTAPI.APIPunch;\n\n\t\t//Tried to fix  Cannot call method 'getJobItem' of null. Use ( Global.getProductEdition() >= 20 )\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initPermission();\n\n\t\tthis.initData();\n\t\tthis.is_changed = true;\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['default'],\n\t\t\tinclude: [ContextMenuIconName.save, ContextMenuIconName.cancel]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\taddPermissionValidate( p_id ) {\n\t\tif ( !Global.isSet( p_id ) ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( p_id === 'report' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'punch_in_out' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tjobUIValidate() {\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_job' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgoodQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbadQuantityUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_quantity' ) &&\n\t\t\tPermissionManager.validate( 'punch', 'edit_bad_quantity' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\ttransferUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_transfer' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tnoteUIValidate() {\n\t\tif ( PermissionManager.validate( 'punch', 'edit_note' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Speical permission check for views, need override\n\tinitPermission() {\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\n\t\tif ( this.goodQuantityUIValidate() ) {\n\t\t\tthis.show_good_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.badQuantityUIValidate() ) {\n\t\t\tthis.show_bad_quantity_ui = true;\n\t\t} else {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t}\n\n\t\tif ( this.transferUIValidate() ) {\n\t\t\tthis.show_transfer_ui = true;\n\t\t} else {\n\t\t\tthis.show_transfer_ui = false;\n\t\t}\n\n\t\tif ( this.noteUIValidate() ) {\n\t\t\tthis.show_node_ui = true;\n\t\t} else {\n\t\t\tthis.show_node_ui = false;\n\t\t}\n\n\t\tvar result = false;\n\n\t\t// Error: Uncaught TypeError: (intermediate value).isBranchAndDepartmentAndJobAndJobItemEnabled is not a function on line 207\n\t\tvar company_api = TTAPI.APICompany;\n\t\tif ( company_api && _.isFunction( company_api.isBranchAndDepartmentAndJobAndJobItemEnabled ) ) {\n\t\t\tresult = company_api.isBranchAndDepartmentAndJobAndJobItemEnabled( { async: false } );\n\t\t}\n\n\t\t//tried to fix Unable to get property 'getResult' of undefined or null reference, added if(!result)\n\t\tif ( !result ) {\n\t\t\tthis.show_branch_ui = false;\n\t\t\tthis.show_department_ui = false;\n\t\t\tthis.show_job_ui = false;\n\t\t\tthis.show_job_item_ui = false;\n\t\t} else {\n\t\t\tresult = result.getResult();\n\t\t\tif ( !result.branch ) {\n\t\t\t\tthis.show_branch_ui = false;\n\t\t\t}\n\n\t\t\tif ( !result.department ) {\n\t\t\t\tthis.show_department_ui = false;\n\t\t\t}\n\n\t\t\tif ( !result.job ) {\n\t\t\t\tthis.show_job_ui = false;\n\t\t\t}\n\n\t\t\tif ( !result.job_item ) {\n\t\t\t\tthis.show_job_item_ui = false;\n\t\t\t}\n\t\t}\n\n\t\tif ( !this.show_job_ui && !this.show_job_item_ui ) {\n\t\t\tthis.show_bad_quantity_ui = false;\n\t\t\tthis.show_good_quantity_ui = false;\n\t\t}\n\t}\n\n\trender() {\n\t\tsuper.render();\n\t}\n\n\tinitOptions( callBack ) {\n\n\t\tvar options = [\n\t\t\t{ option_name: 'type' },\n\t\t\t{ option_name: 'status' }\n\t\t];\n\n\t\tthis.initDropDownOptions( options, function( result ) {\n\t\t\tif ( callBack ) {\n\t\t\t\tcallBack( result ); // First to initialize drop down options, and then to initialize edit view UI.\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetUserPunch( callBack ) {\n\t\tvar $this = this;\n\n\t\tvar station_id = Global.getStationID();\n\n\t\tvar api_station = TTAPI.APIStation;\n\n\t\tif ( station_id ) {\n\t\t\tapi_station.getCurrentStation( station_id, '10', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tdoNext( result );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tapi_station.getCurrentStation( '', '10', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tdoNext( result );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext( result ) {\n\n\t\t\t// Error: Uncaught TypeError: undefined is not a function in /interface/html5/#!m=TimeSheet&date=20150324&user_id=36135&sm=InOut line 285\n\t\t\tif ( !$this.api || typeof $this.api['getUserPunch'] !== 'function' ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar res_data = result.getResult();\n\t\t\t//setCookie( 'StationID',  res_data );\n\t\t\tGlobal.setStationID( res_data );\n\n\t\t\t$this.api.getUserPunch( {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t//keep the inout view fields consistent for screenshots in unit test mode\n\t\t\t\t\tif ( Global.UNIT_TEST_MODE === true ) {\n\t\t\t\t\t\tresult_data.punch_date = 'UNITTEST';\n\t\t\t\t\t\tresult_data.punch_time = 'UNITTEST';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t\t$this.onCancelClick( true );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( Global.isSet( result_data ) ) {\n\t\t\t\t\t\tcallBack( result_data );\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.onCancelClick();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tonCancelClick( force_no_confirm ) {\n\t\tthis.is_changed = true;\n\t\tsuper.onCancelClick( force_no_confirm );\n\t}\n\n\topenEditView() {\n\t\tvar $this = this;\n\n\t\tif ( this.edit_only_mode && this.api ) {\n\n\t\t\tthis.initOptions( function( result ) {\n\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t$this.initEditViewUI( 'InOut', 'InOutEditView.html' );\n\t\t\t\t}\n\n\t\t\t\t$this.getUserPunch( function( result ) {\n\t\t\t\t\t// Waiting for the TTAPI.API returns data to set the current edit record.\n\t\t\t\t\t$this.current_edit_record = result;\n\n\t\t\t\t\t//keep fields consistent in unit test mode for consistent screenshots\n\t\t\t\t\tif ( Global.UNIT_TEST_MODE === true ) {\n\t\t\t\t\t\t$this.current_edit_record.punch_date = 'UNITTEST';\n\t\t\t\t\t\t$this.current_edit_record.punch_time = 'UNITTEST';\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'transfer':\n\t\t\t\tthis.onTransferChanged();\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tonTransferChanged( initial_load ) {\n\n\t\tvar is_transfer = false;\n\t\tif ( this.edit_view_ui_dic && this.edit_view_ui_dic['transfer'] && this.edit_view_ui_dic['transfer'].getValue() == true ) {\n\t\t\tis_transfer = true;\n\t\t}\n\n\t\t// type_id_widget is undefined in interface/html5/framework/jquery.min.js?v=9.0.1-20151022-091549 line 2 > eval line 390\n\t\tvar type_id_widget = this.edit_view_ui_dic['type_id'];\n\t\tvar status_id_widget = this.edit_view_ui_dic['status_id'];\n\t\tif ( is_transfer && type_id_widget && status_id_widget ) {\n\n\t\t\ttype_id_widget.setEnabled( false );\n\t\t\tstatus_id_widget.setEnabled( false );\n\n\t\t\tthis.old_type_status.type_id = type_id_widget.getValue();\n\t\t\tthis.old_type_status.status_id = status_id_widget.getValue();\n\n\t\t\ttype_id_widget.setValue( 10 );\n\t\t\tstatus_id_widget.setValue( 10 );\n\n\t\t\tthis.current_edit_record.type_id = 10;\n\t\t\tthis.current_edit_record.status_id = 10;\n\n\t\t} else if ( type_id_widget && status_id_widget ) {\n\t\t\ttype_id_widget.setEnabled( true );\n\t\t\tstatus_id_widget.setEnabled( true );\n\n\t\t\tif ( this.old_type_status.hasOwnProperty( 'type_id' ) ) {\n\t\t\t\ttype_id_widget.setValue( this.old_type_status.type_id );\n\t\t\t\tstatus_id_widget.setValue( this.old_type_status.status_id );\n\n\t\t\t\tthis.current_edit_record.type_id = this.old_type_status.type_id;\n\t\t\t\tthis.current_edit_record.status_id = this.old_type_status.status_id;\n\t\t\t}\n\n\t\t}\n\n\t\tif ( is_transfer == true ) {\n\t\t\tif ( this.original_note == '' ) {\n\t\t\t\tthis.original_note = this.current_edit_record.note;\n\t\t\t} else {\n\t\t\t\tthis.original_note = this.edit_view_ui_dic.note.getValue();\n\t\t\t}\n\t\t\tthis.edit_view_ui_dic.note.setValue( this.new_note ? this.new_note : '' );\n\t\t\tthis.current_edit_record.note = this.new_note ? this.new_note : '';\n\n\t\t} else if ( typeof initial_load == 'undefined' || initial_load === false ) {\n\n\t\t\tthis.new_note = this.edit_view_ui_dic.note.getValue();\n\t\t\tthis.edit_view_ui_dic.note.setValue( this.original_note ? this.original_note : '' );\n\t\t\tthis.current_edit_record.note = this.original_note ? this.original_note : '';\n\t\t}\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\n\t\tvar $this = this;\n\n\t\tvar record = {};\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\trecord[key] = widget.getValue();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\trecord = this.current_edit_record;\n\t\t}\n\n\t\trecord = this.uniformVariable( record );\n\n\t\tthis.api.setUserPunch( record, true, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t// Overrides BaseViewController\n\tdoSaveAPICall( record, ignoreWarning, callback ) {\n\t\tvar current_api = this.getCurrentAPI();\n\n\t\tif ( !callback ) {\n\t\t\tcallback = {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tthis.onSaveResult( result );\n\t\t\t\t}.bind( this )\n\t\t\t};\n\t\t}\n\n\t\tcurrent_api.setIsIdempotent( true ); //Force to idempotent API call to avoid duplicate network requests from causing errors displayed to the user.\n\t\treturn current_api.setUserPunch( record, false, ignoreWarning, callback );\n\t}\n\n\tonSaveResult( result ) {\n\t\tsuper.onSaveResult( result );\n\t\tif ( LocalCacheData.current_open_primary_controller && LocalCacheData.current_open_primary_controller.viewId === 'TimeSheet' ) {\n\t\t\tLocalCacheData.current_open_primary_controller.search();\n\t\t}\n\t}\n\n\tsetErrorMenu() {\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tgetOtherFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_punch': { 'label': $.i18n._( 'Punch' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_punch = this.edit_view_tab.find( '#tab_punch' );\n\n\t\tvar tab_punch_column1 = tab_punch.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_punch_column1 );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Employee\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\n\t\tform_item_input.TText( {\n\t\t\tfield: 'user_id_readonly'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_punch_column1, '' );\n\n\t\t// Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'punch_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Time' ), form_item_input, tab_punch_column1 );\n\n\t\t// Date\n//\t\t  punch_date, punch_dates\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'punch_date' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_punch_column1 );\n\n\t\t//Transfer\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'transfer' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Transfer' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.show_transfer_ui ) {\n\t\t\tthis.detachElement( 'transfer' );\n\t\t}\n\n\t\t// Punch\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id' } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Punch Type' ), form_item_input, tab_punch_column1 );\n\n\t\t// In/Out\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In/Out' ), form_item_input, tab_punch_column1 );\n\n\t\t// Branch\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\t\t}\n\n\t\t// Department\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_punch_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\t//Job\n\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t// Task\n\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\n\t\t}\n\n\t\t// Quantity\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\tvar good = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tgood.TTextInput( { field: 'quantity', width: 40 } );\n\t\t\tgood.addClass( 'quantity-input' );\n\n\t\t\tvar good_label = $( '<span class=\\'widget-right-label\\'>' + $.i18n._( 'Good' ) + ': </span>' );\n\n\t\t\tvar bad = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tbad.TTextInput( { field: 'bad_quantity', width: 40 } );\n\t\t\tbad.addClass( 'quantity-input' );\n\n\t\t\tvar bad_label = $( '<span class=\\'widget-right-label\\'>/ ' + $.i18n._( 'Bad' ) + ': </span>' );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\twidgetContainer.append( good_label );\n\t\t\twidgetContainer.append( good );\n\t\t\twidgetContainer.append( bad_label );\n\t\t\twidgetContainer.append( bad );\n\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Quantity' ), [good, bad], tab_punch_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_bad_quantity_ui && !this.show_good_quantity_ui ) {\n\t\t\t\tthis.detachElement( 'quantity' );\n\t\t\t} else {\n\t\t\t\tif ( !this.show_bad_quantity_ui ) {\n\t\t\t\t\tbad_label.hide();\n\t\t\t\t\tbad.hide();\n\t\t\t\t}\n\n\t\t\t\tif ( !this.show_good_quantity_ui ) {\n\t\t\t\t\tgood_label.hide();\n\t\t\t\t\tgood.hide();\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_punch_column1, '', null, true, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( !this.show_node_ui ) {\n\t\t\tthis.detachElement( 'note' );\n\t\t}\n\t}\n\n\tsetCurrentEditRecordData() {\n\n\t\t// reset old_types, should only be set when type change and transfer is true. fixed bug 1500\n\t\tthis.old_type_status = {};\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_id_readonly':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record.first_name + ' ' + this.current_edit_record.last_name );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'transfer':\n\t\t\t\t\t\t// do this at last\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'punch_time':\n\t\t\t\t\tcase 'punch_date':\n\t\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of undefined in interface/html5/#!m=TimeSheet&date=20151019&user_id=25869&show_wage=0&sm=InOut line 926\n\t\t//The API will return if transfer should be enabled/disabled by default.\n\t\tif ( this.show_transfer_ui && this.edit_view_ui_dic['transfer'] ) {\n\t\t\tthis.edit_view_ui_dic['transfer'].setValue( this.current_edit_record['transfer'] );\n\t\t}\n\n\t\tthis.onTransferChanged( true );\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.confirm_on_exit = true; //confirm on leaving even if no changes have been made so users can't accidentally not save punches by logging out without clicking save for example\n\t}\n}\n\nInOutViewController.loadView = function() {\n\n\tGlobal.loadViewSource( 'InOut', 'InOutView.html', function( result ) {\n\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tGlobal.contentContainer().html( template( args ) );\n\t} );\n\n};\n"],"sourceRoot":""}