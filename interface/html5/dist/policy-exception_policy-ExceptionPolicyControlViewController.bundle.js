(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["policy-exception_policy-ExceptionPolicyControlViewController"],{6556:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"ExceptionPolicyControlViewController":()=>o});class o extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#exception_policy_control_view_container",severity_array:null,email_notification_array:null,editor:null,api_exception_policy:null,date_api:null}),super(e)}init(e){this.edit_view_tpl="ExceptionPolicyControlEditView.html",this.permission_id="exception_policy",this.viewId="ExceptionPolicyControl",this.script_name="ExceptionPolicyControlView",this.table_name_key="exception_policy_control",this.context_menu_name=$.i18n._("Exception Policy"),this.navigation_label=$.i18n._("Exception Policy")+":",this.api=TTAPI.APIExceptionPolicyControl,this.api_exception_policy=TTAPI.APIExceptionPolicy,this.date_api=TTAPI.APITTDate,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary("ExceptionPolicyControl")}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.mass_edit],include:[]}}initOptions(){this.initDropDownOption("severity","severity_id",this.api_exception_policy),this.initDropDownOption("email_notification","email_notification_id",this.api_exception_policy)}buildEditViewUI(){super.buildEditViewUI();var e={"tab_exception_policy":{"label":$.i18n._("Exception Policy")},"tab_audit":!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIExceptionPolicyControl,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_hierarchy",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_exception_policy"),t=i.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t);var o=Global.loadWidgetByName(FormItemType.TEXT_INPUT);o.TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Name"),o,t,"first_last"),o.parent().width("45%"),(o=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn($.i18n._("Description"),o,t,"",null,null,!0),o.parent().width("45%");var a=i.find(".inside-editor-div"),r={active:$.i18n._("Active"),code:$.i18n._("Code"),name:$.i18n._("Name"),severity:$.i18n._("Severity"),grace:$.i18n._("Grace"),"watch_window":$.i18n._("Watch Window"),"demerit":$.i18n._("Demerit Points"),"email_notification":$.i18n._("Email Notification")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({title:"",addRow:this.insideEditorAddRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,updateAllRows:this.insideEditorUpdateAllRows,parent_controller:this,render:"views/policy/exception_policy/ExceptionPolicyControlInsideEditorRender.html",render_args:r,row_render:"views/policy/exception_policy/ExceptionPolicyControlInsideEditorRow.html"}),a.append(this.editor)}_continueDoCopyAsNew(){if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view))for(var e=0;e<this.editor.rows_widgets_array.length;e++)this.editor.rows_widgets_array[e].current_edit_item.id="";super._continueDoCopyAsNew()}onCopyAsNewResult(e){var i=this,t=e.getResult();if(!t)return TAlertManager.showAlert($.i18n._("Record does not exist")),void i.onCancelClick();i.openEditView(),t=t[0],this.copied_record_id=t.id,t.id="",i.sub_view_mode&&i.parent_key&&(t[i.parent_key]=i.parent_value),i.current_edit_record=t,i.initEditView()}setEditViewDataDone(){super.setEditViewDataDone(),this.initInsideEditorData()}initInsideEditorData(){var e=this,i={filter_data:{}},t=this.current_edit_record.id?this.current_edit_record.id:this.copied_record_id;this.copied_record_id="",t?(i.filter_data.exception_policy_control_id=t,this.api_exception_policy.getExceptionPolicyDefaultData(i,!0,{onResult:function(i){if(e.edit_view){var o=i.getResult(),a=[];for(var r in o)o.hasOwnProperty(r)&&(o[r].id="",a.push(o[r]));a=a.sort((function(e,i){return Global.compare(e,i,"type_id")})),e.editor.setValue(a);var n={};n.filter_data={exception_policy_control_id:t},e.api_exception_policy.getExceptionPolicy(n,!0,{onResult:function(i){if(e.edit_view){var t=i.getResult(),o=[];for(var a in t)t.hasOwnProperty(a)&&o.push(t[a]);o=o.sort((function(e,i){return Global.compare(e,i,"type_id")})),e.editor.setValue(o)}}})}}})):this.api_exception_policy.getExceptionPolicyDefaultData(i,!0,{onResult:function(i){if(e.edit_view){var t=i.getResult(),o=[];for(var a in t)t.hasOwnProperty(a)&&(t[a].id="",o.push(t[a]));o=o.sort((function(e,i){return Global.compare(e,i,"type_id")})),e.editor.setValue(o)}}})}insideEditorUpdateAllRows(e){for(var i=this.rows_widgets_array.length,t=0;t<i;t++)for(var o=this.rows_widgets_array[t],a=o.current_edit_item,r=e.length,n=0;n<r;n++){var l=e[n];if(l.type_id===a.type_id){o.current_edit_item=l,this.parent_controller.current_edit_record.id||(o.current_edit_item.id=""),o.active.setValue(l.active),o.severity_id.setValue(l.severity_id),l.is_enabled_grace&&o.grace.setValue(l.grace),l.is_enabled_watch_window&&o.watch_window.setValue(l.watch_window),o.demerit.setValue(l.demerit),o.email_notification_id.setValue(l.email_notification_id),e.splice(n,1);break}}}insideEditorSetValue(e){if(0!==e.length)if(e[0].id)this.updateAllRows(e);else{this.removeAllRows();for(var i=0;i<e.length;i++)if(Global.isSet(e[i])){var t=e[i];this.addRow(t)}}}insideEditorAddRow(e,i){e||(e={});var t=this.getRowRender(),o=this.getRender(),a={},r=Global.loadWidgetByName(FormItemType.CHECKBOX);r.TCheckbox({field:"active"}),r.setValue(e.active),a[r.getField()]=r,t.children().eq(0).append(r),r.attr("exception_policy_id",e.id&&this.parent_controller.current_edit_record.id?e.id:""),this.setWidgetEnableBaseOnParentController(r),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"type_id"}),r.setValue(e.type_id),a[r.getField()]=r,t.children().eq(1).append(r),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"name"}),r.setValue(e.name),a[r.getField()]=r,t.children().eq(2).append(r),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"severity_id",set_empty:!1}),this.setWidgetEnableBaseOnParentController(r),r.setSourceData(this.parent_controller.severity_array),r.setValue(e.severity_id),a[r.getField()]=r,t.children().eq(3).append(r),e.is_enabled_grace&&((r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"grace",width:90,need_parser_sec:!0}),r.setValue(e.grace),a[r.getField()]=r,t.children().eq(4).append(r),this.setWidgetEnableBaseOnParentController(r)),e.is_enabled_watch_window&&((r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"watch_window",width:90,need_parser_sec:!0}),r.setValue(e.watch_window),a[r.getField()]=r,t.children().eq(5).append(r),this.setWidgetEnableBaseOnParentController(r)),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"demerit",width:50,need_parser_sec:!1}),r.setValue(e.demerit),a[r.getField()]=r,t.children().eq(6).append(r),this.setWidgetEnableBaseOnParentController(r),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"email_notification_id",set_empty:!1}),r.setSourceData(this.parent_controller.email_notification_array),r.setValue(e.email_notification_id),a[r.getField()]=r,t.children().eq(7).append(r),this.setWidgetEnableBaseOnParentController(r),a.current_edit_item=e,void 0!==i?(t.insertAfter($(o).find("tr").eq(i)),this.rows_widgets_array.splice(i,0,a)):($(o).append(t),this.rows_widgets_array.push(a)),this.parent_controller.is_viewing&&t.find(".control-icon").hide(),this.removeLastRowLine()}insideEditorGetValue(e){for(var i=this.rows_widgets_array.length,t=[],o=0;o<i;o++){var a=this.rows_widgets_array[o],r=a.current_edit_item;r.exception_policy_control_id=e,r.active=a.active.getValue(),r.severity_id=a.severity_id.getValue(),r.is_enabled_grace&&(r.grace=a.grace.getValue()),r.is_enabled_watch_window&&(r.watch_window=a.watch_window.getValue()),r.demerit=a.demerit.getValue(),r.email_notification_id=a.email_notification_id.getValue(),t.push(r)}return t}onSaveResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(),i.onSaveDone(e),i.removeEditView()}))}else i.setErrorMenu(),i.setErrorTips(e)}onSaveAndCopyResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(!1),i.onCopyAsNewClick()}))}else i.setErrorTips(e),i.setErrorMenu()}saveInsideEditorData(e){var i=this.editor.getValue(this.refresh_id);this.api_exception_policy.setExceptionPolicy(i,{onResult:function(i){Global.isSet(e)&&e()}})}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}}}}]);
//# sourceMappingURL=policy-exception_policy-ExceptionPolicyControlViewController.bundle.js.map?v=fdb9eba94386c841f931