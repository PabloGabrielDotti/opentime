{"version":3,"sources":["webpack://timetrex/./interface/html5/views/policy/exception_policy/ExceptionPolicyControlViewController.js"],"names":["ExceptionPolicyControlViewController","BaseViewController","options","_","defaults","el","severity_array","email_notification_array","editor","api_exception_policy","date_api","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APIExceptionPolicyControl","APIExceptionPolicy","APITTDate","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","exclude","ContextMenuIconName","mass_edit","include","initDropDownOption","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","api_class","id","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_exception_policy","edit_view_tab","find","tab_exception_policy_column1","edit_view_tabs","push","form_item_input","Global","loadWidgetByName","FormItemType","TEXT_INPUT","TTextInput","field","width","addEditFieldToColumn","parent","TEXT_AREA","TTextArea","inside_editor_div","args","active","code","name","severity","grace","INSIDE_EDITOR","InsideEditor","title","addRow","insideEditorAddRow","getValue","insideEditorGetValue","setValue","insideEditorSetValue","updateAllRows","insideEditorUpdateAllRows","parent_controller","render_args","row_render","append","setCurrentEditViewState","LocalCacheData","current_doing_context_action","isSet","edit_view","i","rows_widgets_array","length","current_edit_item","_continueDoCopyAsNew","result","$this","result_data","getResult","TAlertManager","showAlert","onCancelClick","openEditView","copied_record_id","sub_view_mode","parent_key","parent_value","current_edit_record","initEditView","setEditViewDataDone","initInsideEditorData","exception_control_id","filter_data","exception_policy_control_id","getExceptionPolicyDefaultData","onResult","res","data","array_data","key","hasOwnProperty","sort","a","b","compare","ep_filter","getExceptionPolicy","ep_res","val","len","c_row","c_row_data","len1","j","new_row","type_id","severity_id","is_enabled_grace","is_enabled_watch_window","watch_window","demerit","email_notification_id","splice","removeAllRows","row","index","getRowRender","getRender","widgets","CHECKBOX","TCheckbox","getField","children","eq","attr","setWidgetEnableBaseOnParentController","TEXT","TText","COMBO_BOX","TComboBox","set_empty","setSourceData","need_parser_sec","insertAfter","is_viewing","hide","removeLastRowLine","current_edit_item_id","isValid","refresh_id","TTUUID","isUUID","zero_id","not_exist_id","saveInsideEditorData","search","onSaveDone","removeEditView","setErrorMenu","setErrorTips","onCopyAsNewClick","callBack","setExceptionPolicy","buildSearchFields","search_fields","SearchField","label","in_column","multiple","basic_search","adv_search","form_item_type","APIUser","AWESOME_BOX"],"mappings":"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","file":"policy-exception_policy-ExceptionPolicyControlViewController.bundle.js?v=fdb9eba94386c841f931","sourcesContent":["export class ExceptionPolicyControlViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#exception_policy_control_view_container',\n\n\t\t\tseverity_array: null,\n\t\t\temail_notification_array: null,\n\t\t\teditor: null,\n\t\t\tapi_exception_policy: null,\n\t\t\tdate_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'ExceptionPolicyControlEditView.html';\n\t\tthis.permission_id = 'exception_policy';\n\t\tthis.viewId = 'ExceptionPolicyControl';\n\t\tthis.script_name = 'ExceptionPolicyControlView';\n\t\tthis.table_name_key = 'exception_policy_control';\n\t\tthis.context_menu_name = $.i18n._( 'Exception Policy' );\n\t\tthis.navigation_label = $.i18n._( 'Exception Policy' ) + ':';\n\t\tthis.api = TTAPI.APIExceptionPolicyControl;\n\t\tthis.api_exception_policy = TTAPI.APIExceptionPolicy;\n\t\tthis.date_api = TTAPI.APITTDate;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary( 'ExceptionPolicyControl' );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.mass_edit],\n\t\t\tinclude: []\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'severity', 'severity_id', this.api_exception_policy );\n\t\tthis.initDropDownOption( 'email_notification', 'email_notification_id', this.api_exception_policy );\n\t}\n\n\tbuildEditViewUI() {\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_exception_policy': { 'label': $.i18n._( 'Exception Policy' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIExceptionPolicyControl,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_hierarchy',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_exception_policy = this.edit_view_tab.find( '#tab_exception_policy' );\n\n\t\tvar tab_exception_policy_column1 = tab_exception_policy.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_exception_policy_column1 );\n\n\t\t//Name\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_exception_policy_column1, 'first_last' );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_exception_policy_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_exception_policy.find( '.inside-editor-div' );\n\t\tvar args = {\n\t\t\tactive: $.i18n._( 'Active' ),\n\t\t\tcode: $.i18n._( 'Code' ),\n\t\t\tname: $.i18n._( 'Name' ),\n\t\t\tseverity: $.i18n._( 'Severity' ),\n\t\t\tgrace: $.i18n._( 'Grace' ),\n\t\t\t'watch_window': $.i18n._( 'Watch Window' ),\n\t\t\t'demerit': $.i18n._( 'Demerit Points' ),\n\t\t\t'email_notification': $.i18n._( 'Email Notification' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\n\t\tthis.editor.InsideEditor( {\n\t\t\ttitle: '',\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tupdateAllRows: this.insideEditorUpdateAllRows,\n\t\t\tparent_controller: this,\n\t\t\trender: 'views/policy/exception_policy/ExceptionPolicyControlInsideEditorRender.html',\n\t\t\trender_args: args,\n\t\t\trow_render: 'views/policy/exception_policy/ExceptionPolicyControlInsideEditorRow.html'\n\t\t} );\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tfor ( var i = 0; i < this.editor.rows_widgets_array.length; i++ ) {\n\t\t\t\tthis.editor.rows_widgets_array[i].current_edit_item.id = '';\n\t\t\t}\n\t\t}\n\t\tsuper._continueDoCopyAsNew();\n\t}\n\n\tonCopyAsNewResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\n\t\tif ( !result_data ) {\n\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t$this.onCancelClick();\n\t\t\treturn;\n\t\t}\n\n\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\tresult_data = result_data[0];\n\n\t\tthis.copied_record_id = result_data.id;\n\t\tresult_data.id = '';\n\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.initInsideEditorData();\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\n\t\tvar exception_control_id = this.current_edit_record.id ? this.current_edit_record.id : this.copied_record_id;\n\t\tthis.copied_record_id = '';\n\n\t\tif ( !exception_control_id ) {\n\n\t\t\tthis.api_exception_policy.getExceptionPolicyDefaultData( args, true, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\tvar array_data = [];\n\t\t\t\t\tfor ( var key in data ) {\n\n\t\t\t\t\t\tif ( !data.hasOwnProperty( key ) ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[key].id = '';\n\t\t\t\t\t\tarray_data.push( data[key] );\n\t\t\t\t\t}\n\t\t\t\t\tarray_data = array_data.sort( function( a, b ) {\n\t\t\t\t\t\treturn Global.compare( a, b, 'type_id' );\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.editor.setValue( array_data );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\targs.filter_data.exception_policy_control_id = exception_control_id;\n\n\t\t\tthis.api_exception_policy.getExceptionPolicyDefaultData( args, true, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\tvar array_data = [];\n\n\t\t\t\t\tfor ( var key in data ) {\n\n\t\t\t\t\t\tif ( !data.hasOwnProperty( key ) ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[key].id = '';\n\t\t\t\t\t\tarray_data.push( data[key] );\n\t\t\t\t\t}\n\n\t\t\t\t\tarray_data = array_data.sort( function( a, b ) {\n\t\t\t\t\t\treturn Global.compare( a, b, 'type_id' );\n\t\t\t\t\t} );\n\n\t\t\t\t\t$this.editor.setValue( array_data );\n\n\t\t\t\t\tvar ep_filter = {};\n\t\t\t\t\tep_filter.filter_data = { exception_policy_control_id: exception_control_id };\n\n\t\t\t\t\t$this.api_exception_policy.getExceptionPolicy( ep_filter, true, {\n\t\t\t\t\t\tonResult: function( ep_res ) {\n\n\t\t\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar data = ep_res.getResult();\n\t\t\t\t\t\t\tvar array_data = [];\n\t\t\t\t\t\t\tfor ( var key in data ) {\n\n\t\t\t\t\t\t\t\tif ( !data.hasOwnProperty( key ) ) {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tarray_data.push( data[key] );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarray_data = array_data.sort( function( a, b ) {\n\t\t\t\t\t\t\t\treturn Global.compare( a, b, 'type_id' );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t$this.editor.setValue( array_data );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tinsideEditorUpdateAllRows( val ) {\n\t\tvar len = this.rows_widgets_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar c_row = this.rows_widgets_array[i];\n\t\t\tvar c_row_data = c_row.current_edit_item;\n\n\t\t\tvar len1 = val.length;\n\n\t\t\tfor ( var j = 0; j < len1; j++ ) {\n\t\t\t\tvar new_row = val[j];\n\n\t\t\t\tif ( new_row.type_id === c_row_data.type_id ) {\n\t\t\t\t\tc_row.current_edit_item = new_row;\n\n\t\t\t\t\tif ( !this.parent_controller.current_edit_record.id ) {\n\t\t\t\t\t\tc_row.current_edit_item.id = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tc_row.active.setValue( new_row.active );\n\t\t\t\t\tc_row.severity_id.setValue( new_row.severity_id );\n\n\t\t\t\t\tif ( new_row.is_enabled_grace ) {\n\t\t\t\t\t\tc_row.grace.setValue( new_row.grace );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( new_row.is_enabled_watch_window ) {\n\t\t\t\t\t\tc_row.watch_window.setValue( new_row.watch_window );\n\t\t\t\t\t}\n\n\t\t\t\t\tc_row.demerit.setValue( new_row.demerit );\n\t\t\t\t\tc_row.email_notification_id.setValue( new_row.email_notification_id );\n\n\t\t\t\t\tval.splice( j, 1 );\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\n\t\tif ( len === 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !val[0].id ) {\n\t\t\tthis.removeAllRows();\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.updateAllRows( val );\n\t\t}\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\t\tif ( !data ) {\n\t\t\tdata = {};\n\t\t}\n\n\t\tvar row = this.getRowRender(); //Get Row render\n\t\tvar render = this.getRender(); //get render, should be a table\n\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t//Build row widgets\n\n\t\t//Active\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\tform_item_input.TCheckbox( { field: 'active' } );\n\t\tform_item_input.setValue( data.active );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 0 ).append( form_item_input );\n\t\tform_item_input.attr( 'exception_policy_id', ( data.id && this.parent_controller.current_edit_record.id ) ? data.id : '' );\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t//Code\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'type_id' } );\n\t\tform_item_input.setValue( data.type_id );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 1 ).append( form_item_input );\n\n\t\t//Name\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'name' } );\n\t\tform_item_input.setValue( data.name );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 2 ).append( form_item_input );\n\n\t\t//Severity\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'severity_id', set_empty: false } );\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\t\tform_item_input.setSourceData( this.parent_controller.severity_array );\n\t\tform_item_input.setValue( data.severity_id );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 3 ).append( form_item_input );\n\n\t\tif ( data.is_enabled_grace ) {\n\t\t\t//Grace\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'grace', width: 90, need_parser_sec: true } );\n\t\t\tform_item_input.setValue( data.grace );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 4 ).append( form_item_input );\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\t\t}\n\n\t\tif ( data.is_enabled_watch_window ) {\n\t\t\t//Watch Window\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tform_item_input.TTextInput( { field: 'watch_window', width: 90, need_parser_sec: true } );\n\t\t\tform_item_input.setValue( data.watch_window );\n\t\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\t\trow.children().eq( 5 ).append( form_item_input );\n\t\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\t\t}\n\n\t\t//Demerits\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'demerit', width: 50, need_parser_sec: false } );\n\t\tform_item_input.setValue( data.demerit );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 6 ).append( form_item_input );\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t//Email Notification\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'email_notification_id', set_empty: false } );\n\t\tform_item_input.setSourceData( this.parent_controller.email_notification_array );\n\t\tform_item_input.setValue( data.email_notification_id );\n\t\twidgets[form_item_input.getField()] = form_item_input;\n\t\trow.children().eq( 7 ).append( form_item_input );\n\t\tthis.setWidgetEnableBaseOnParentController( form_item_input );\n\n\t\t//Save current set item\n\t\twidgets.current_edit_item = data;\n\n\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t} else {\n\t\t\t$( render ).append( row );\n\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t}\n\n\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\trow.find( '.control-icon' ).hide();\n\t\t}\n\n\t\tthis.removeLastRowLine();\n\t}\n\n\tinsideEditorGetValue( current_edit_item_id ) {\n\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tvar data = row.current_edit_item;\n\t\t\tdata.exception_policy_control_id = current_edit_item_id;\n\t\t\tdata.active = row.active.getValue();\n\t\t\tdata.severity_id = row.severity_id.getValue();\n\t\t\tif ( data.is_enabled_grace ) {\n\t\t\t\tdata.grace = row.grace.getValue();\n\t\t\t}\n\n\t\t\tif ( data.is_enabled_watch_window ) {\n\t\t\t\tdata.watch_window = row.watch_window.getValue();\n\t\t\t}\n\n\t\t\tdata.demerit = row.demerit.getValue();\n\t\t\tdata.email_notification_id = row.email_notification_id.getValue();\n\n\t\t\tresult.push( data );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search();\n\t\t\t\t$this.onSaveDone( result );\n\n\t\t\t\t$this.removeEditView();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t// onSaveAndContinueResult( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onEditClick( $this.refresh_id, true );\n\t//\n\t// \t\t\t$this.onSaveAndContinueDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t// onSaveAndNewResult: function( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onAddClick( true );\n\t//\n\t// \t\t} );\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\t\t\t\t$this.onCopyAsNewClick();\n\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\t// onSaveAndNextResult( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.onRightArrowClick();\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onSaveAndNextDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tsaveInsideEditorData( callBack ) {\n\n\t\tvar data = this.editor.getValue( this.refresh_id );\n\n\t\tthis.api_exception_policy.setExceptionPolicy( data, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( Global.isSet( callBack ) ) {\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n}\n"],"sourceRoot":""}