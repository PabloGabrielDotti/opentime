(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["quick_punch-login-QuickPunchLoginViewController","quick_punch-QuickPunchBaseViewController"],{9942:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"QuickPunchBaseViewController":()=>a});var o=i(6739);class a extends o.TTBackboneView{constructor(e={}){_.defaults(e,{}),super(e)}}},3562:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"QuickPunchLoginViewController":()=>s});var o=i(9942),a=i(7526),n=i(4936),r=i(9239);class s extends o.QuickPunchBaseViewController{constructor(e={}){_.defaults(e,{events:{"change #language":"onLanguageChange"},authentication_api:null}),super(e)}initialize(e){super.initialize(e);var t=Global.loadWidget("views/quick_punch/login/QuickPunchLoginView.html");this.template=_.template(t),this.setElement(this.template({})),Global.contentContainer().html(this.$el),this.checkForWebkitTextSecuritySupport(),this.api=a.y.APIPunch,this.authentication_api=a.y.APIAuthentication,this.currentUser_api=a.y.APIAuthentication,this.user_preference_api=a.y.APIUserPreference,this.date_api=a.y.APITTDate,this.permission_api=a.y.APIPermission,this.edit_view_error_ui_dic={},LocalCacheData.setAllURLArgs({}),this.render()}render(){var e=this;return this.login_btn=this.$("button#punch_login"),this.login_btn.on("click",(function(t){e.onLogin(t)})),this.$('input[name="quick_punch_id"]').focus(),this.setLanguageSourceData("language"),$(document).off("keydown").on("keydown",(function(t){var i=t.target.attributes;if(13===t.keyCode){if("disabled"==e.login_btn.attr("disabled"))return;e.onLogin(),t.preventDefault()}9===t.keyCode&&t.shiftKey&&i["tab-start"]&&(e.$("button[tabindex=0]",e.$el)[0].focus(),t.preventDefault()),i["tab-end"]&&!1===t.shiftKey&&(e.$("input[tabindex=1]",e.$el)[0].focus(),t.preventDefault())})),this}onLogin(e){var t=this,i=this.$("#quick_punch_id").val(),o=this.$("#quick_punch_password").val();this.login_btn.attr("disabled","disabled"),this.clearErrorTips(!0,!0),Global.refreshCSRFToken((function(e){t.authentication_api.PunchLogin(i,o,{onResult:function(e){if(e.isValid()){var i=e.getResult();TTPromise.add("QPLogin","init"),TTPromise.add("QPLogin","CurrentStation"),t.getCurrentStation(),TTPromise.add("QPLogin","CurrentUser"),t.getCurrentUser(),setCookie("SessionID-QP",i.SessionID,{expires:30,path:LocalCacheData.cookie_path}),TTPromise.add("QPLogin","Permissions"),t.permission_api.getPermissions({onResult:function(e){var t=e.getResult();0!=t?(LocalCacheData.setPermissionData(t),TTPromise.resolve("QPLogin","Permissions")):(Debug.Text("User does not have any permissions!","QuickPunchLoginController.js","QuickPunchViewController","getPermission",10),r.K.showAlert($.i18n._("Unable to login due to permissions, please try again and if the problem persists contact customer support."),"",(function(){Global.Logout(),window.location.reload()})))}}),TTPromise.add("QPLogin","CurrentCompany"),t.authentication_api.getCurrentCompany({onResult:function(e){var t=e.getResult();0!=t?(1==t.is_setup_complete?t.is_setup_complete=!0:t.is_setup_complete=!1,LocalCacheData.setCurrentCompany(t),Debug.Text("Version: Client: "+APIGlobal.pre_login_data.application_build+" Server: "+t.application_build,"LoginViewController.js","LoginViewController","onUserPreference:next",10),1==APIGlobal.pre_login_data.production&&APIGlobal.pre_login_data.application_build!=t.application_build&&(Debug.Text("Version mismatch on login: Reloading...","LoginViewController.js","LoginViewController","onUserPreference:next",10),window.location.reload(!0)),TTPromise.resolve("QPLogin","CurrentCompany")):(Debug.Text("Unable to get company information!","QuickPunchLoginController.js","QuickPunchViewController","getPermission",10),r.K.showAlert($.i18n._("Unable to download required information, please check your network connection and try again. If the problem persists contact customer support."),"",(function(){Global.Logout(),window.location.reload()})))}}),TTPromise.add("QPLogin","Locale"),t.getLocale(),TTPromise.wait("QPLogin",null,(function(){t.goToView()})),TTPromise.resolve("QPLogin","init")}else t.setErrorTips(e)}})}))}checkForWebkitTextSecuritySupport(){if("function"!=typeof CSS||!CSS.supports("-webkit-text-security","disc")){var e=$("input#quick_punch_password"),t=e.clone(!0);t.attr("type","password"),e.replaceWith(t)}}getLocale(){this.authentication_api.getLocale($('select[name="language"]').val(),{onResult:function(e){var t="en_US";e&&(t=e.getResult());var i=n.d.generateUUID();null!=LocalCacheData.getLoginData().locale&&t!==LocalCacheData.getLoginData().locale&&(ProgressBar.showProgressBar(i),ProgressBar.changeProgressBarMessage($.i18n._("Language changed, reloading")+"..."),Global.setLanguageCookie(t),LocalCacheData.setI18nDic(null),setTimeout((function(){window.location.reload(!0)}),5e3)),TTPromise.resolve("QPLogin","Locale")}})}getCurrentUser(){this.currentUser_api.getCurrentUser({onResult:this.onGetCurrentUser,delegate:this})}getCurrentStation(e){var t=Global.getStationID();t||(t=""),a.y.APIStation.getCurrentStation(t,"10",{onResult:function(e){TTPromise.resolve("QPLogin","CurrentStation")}})}onGetCurrentUser(e){LocalCacheData.setPunchLoginUser(e.getResult()),TTPromise.resolve("QPLogin","CurrentUser")}goToView(){this.doing_login=!1,LocalCacheData.currentShownContextMenuName=null,Global.setURLToBrowser(Global.getBaseURL()+"#!m=QuickPunch");var e=LocalCacheData.getCurrentCompany();LocalCacheData&&e&&Global.setAnalyticDimensions(LocalCacheData.getPunchLoginUser().first_name+" ("+LocalCacheData.getPunchLoginUser().id+")",e.name)}setErrorTips(e){this.clearErrorTips(!0);var t=e.getDetails()?e.getDetails()[0]:{};for(var i in t&&t.hasOwnProperty("error")&&(t=t.error),t){var o,a;if(t.hasOwnProperty(i))if(this.$('input[name="'+i+'"]')[0]?o=this.$('input[name="'+i+'"]'):this.$('select[name="'+i+'"]')[0]&&(o=this.$('select[name="'+i+'"]')),o)o.addClass("error-tip"),a=_.isArray(t[i])?t[i][0]:t[i],o.attr("data-original-title",a),o.tooltip("show"),this.edit_view_error_ui_dic[i]=o}_.size(this.edit_view_error_ui_dic)>0&&(this.login_btn.removeAttr("disabled"),_.min(this.edit_view_error_ui_dic,(function(e){if(e.attr("tabindex"))return parseInt(e.attr("tabindex"))})).focus())}clearErrorTips(e,t){for(var i in this.edit_view_error_ui_dic)(""!==this.edit_view_error_ui_dic[i].val()||e)&&(this.edit_view_error_ui_dic[i].removeClass("error-tip"),this.edit_view_error_ui_dic[i].attr("data-original-title","")),t&&this.edit_view_error_ui_dic[i].tooltip("dispose");this.edit_view_error_ui_dic={}}setLanguageSourceData(e,t,i){var o=this,a='select[name="'+e+'"]';this.$(a)&&this.$(a)[0]&&(this.$(a).empty(),t||(t=LocalCacheData.getLoginData().language_options,t=Global.removeSortPrefixFromArray(LocalCacheData.getLoginData().language_options)),0==_.size(t)&&(i=!0),!0===i&&this.$(a).append($("<option></option>").prop("value","0").text("-- "+$.i18n._("None")+" --")).attr("selected","selected"),_.size(t)>0&&$.each(t,(function(e,t){o.$(a).append($("<option></option>").attr("value",e).text(t)),LocalCacheData.getLoginData().language==e&&o.$(a).val(e)})))}onLanguageChange(e){Global.setLanguageCookie($(e.target).val()),LocalCacheData.setI18nDic(null);var t=n.d.generateUUID();ProgressBar.showProgressBar(t),ProgressBar.changeProgressBarMessage($.i18n._("Language changed, reloading")+"..."),setTimeout((function(){window.location.reload(!0)}),2e3)}}}}]);
//# sourceMappingURL=quick_punch-login-QuickPunchLoginViewController.bundle.js.map?v=f9c9f620d6a9b48def20