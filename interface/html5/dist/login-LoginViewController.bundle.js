(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["login-LoginViewController"],{458:(e,a,o)=>{"use strict";o.r(a),o.d(a,{"LoginViewController":()=>t});class t extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#loginViewContainer",authentication_api:null,currentUser_api:null,currency_api:null,user_preference_api:null,user_locale:"en_US",is_login:!0,date_api:null,permission_api:null,doing_login:!1,lan_selector:null,default:{is_login:!1},events:{"click #quick_punch":"onQuickPunchClick","click #forgot_password":"forgotPasswordClick","click #appTypeLogo":"onAppTypeClick","click #companyLogo":"onAppTypeClick","click #powered_by":"onAppTypeClick"}}),super(e)}init(e){var a=this;Global.setVirtualDeviceViewport("mobile"),this.authentication_api=TTAPI.APIAuthentication,this.currentUser_api=TTAPI.APIAuthentication,this.currency_api=TTAPI.APICurrency,this.user_preference_api=TTAPI.APIUserPreference,this.date_api=TTAPI.APITTDate,this.permission_api=TTAPI.APIPermission,this.viewId="LoginView",Global.topContainer().css("display","none"),Global.bottomContainer().css("display","none"),Global.contentContainer().removeClass("content-container-after-login"),Global.topContainer().removeClass("top-container-after-login"),$(".hide-in-login").hide();LocalCacheData.getLoginData();LocalCacheData.cleanNecessaryCache();var o=getCookie(Global.getSessionIDKey());if(o&&o.length>=40&&LocalCacheData.getLoginData().is_logged_in){var t=0;if($(this.el).invisible(),LocalCacheData.loadViewRequiredJSReady)Debug.Text("Login Success (first try)",null,null,"initialize",10),a.autoLogin();else var n=setInterval((function(){if(100==t)return clearInterval(n),TAlertManager.showAlert($.i18n._("The network connection was lost. Please check your network connection then try again.")),void Debug.Text("Login Failure",null,null,"initialize",10);t+=1,LocalCacheData.loadViewRequiredJSReady&&(Debug.Text("Login Success after retry: "+t,null,null,"initialize",10),a.autoLogin(),clearInterval(n))}),600)}else $(this.el).visible(),this.render();LocalCacheData.notification_bar&&LocalCacheData.notification_bar.remove()}onAppTypeClick(){window.open("https://"+LocalCacheData.loginData.organization_url)}onQuickPunchClick(){window.open(ServiceCaller.root_url+LocalCacheData.loginData.base_url+"html5/quick_punch")}onLoginBtnClick(e){e.preventDefault();var a=$("#user_name").val(),o=$("#password").val(),t=this;if(!this.doing_login){if(this.doing_login=!0,""==a||""==o)return TAlertManager.showAlert($.i18n._("Please enter a user name and password.")),void(this.doing_login=!1);var n=$("#login_copy_right_info").text(),i=["onload","total","Copyright ","indexOf","organization_name","loginData","All Rights Reserved","ERROR: This installation of ","application_name"," is in violation of the license agreement!","showAlert","getResponseHeader","Content-Length","TimeTrex","#powered_by","naturalWidth","naturalHeight"];(!$(i[14])[0]||$(i[14])[0]&&($(i[14])[0][i[15]]>0&&145!=$(i[14])[0][i[15]]||$(i[14])[0][i[16]]>0&&40!=$(i[14])[0][i[16]])||0!==n[i[3]](i[2])||0!==LocalCacheData[i[5]][i[8]][i[3]](i[13])||17!==n[i[3]](i[13]))&&Global.sendErrorReport(i[7]+LocalCacheData[i[5]][i[8]]+i[9]+" iw: "+($(i[14])[0]?$(i[14])[0][i[15]]:0)+" ih: "+($(i[14])[0]?$(i[14])[0][i[16]]:0)+" c: "+n[i[3]](i[2])+" "+n[i[3]](LocalCacheData[i[5]][i[4]]),ServiceCaller.root_url,"","",""),this.authentication_api&&Global.refreshCSRFToken((function(e){t.authentication_api.login(a,o,{onResult:function(e){if(LocalCacheData.loadViewRequiredJSReady)Debug.Text("Login Success (first try)",null,null,"onLoginBtnClick",10),t.onLoginSuccess(e);else var a=0,o=setInterval((function(){if(100==a)return clearInterval(o),TAlertManager.showAlert($.i18n._("The network connection was lost. Please check your network connection then try again.")),void Debug.Text("Login Failure",null,null,"onLoginBtnClick",10);a+=1,LocalCacheData.loadViewRequiredJSReady&&(t.onLoginSuccess(e),Debug.Text("Login Success after retry: "+a,null,null,"onLoginBtnClick",10),clearInterval(o))}),600)},onError:function(e){Debug.Text("Login Error...",null,null,"onLoginBtnClick",10),t.doing_login=!1},delegate:this})}))}}onLoginSuccess(e,a){var o;o=a||e.getResult(),TAlertManager.closeBrowserBanner();var t=$("#user_name"),n=$("#password");if(e&&!e.isValid())LocalCacheData.setSessionID(""),Global.clearSessionCookie(),e.getDetails()[0]&&e.getDetails()[0].hasOwnProperty("password")?IndexViewController.openWizard("ResetPasswordWizard",{user_name:t.val(),message:e.getDetailsAsString()},(function(){TAlertManager.showAlert($.i18n._("Password has been changed successfully, you may now login."),"",(function(){n.focus()}))})):TAlertManager.showAlert(e.getDetailsAsString(),"Error",(function(){n.focus()})),this.doing_login=!1;else{if(ServiceCaller.cancel_all_error=!1,LocalCacheData.setSessionID(o),setCookie(Global.getSessionIDKey(),o),"undefined"==typeof is_login&&(this.is_login=!0),!this.currentUser_api||"function"!=typeof this.currentUser_api.getCurrentUserPreference)return;this.initializeLoginData()}}initializeLoginData(){var e=this;TTPromise.add("login","init"),TTPromise.add("login","getCurrentUser"),e.currentUser_api.getCurrentUser({onResult:e.onGetCurrentUser,delegate:e}),TTPromise.add("login","getCurrentUserPreference"),e.currentUser_api.getCurrentUserPreference({onResult:e.onGetCurrentUserPreference,delegate:e}),TTPromise.add("login","getCurrentUserLocale"),e.authentication_api.getLocale($(".language-selector").val(),{onResult:e.onGetCurrentUserLocale,delegate:e}),TTPromise.add("login","getPermission"),e.permission_api.getPermissions({onResult:function(e){var a=e.getResult();0!=a?(LocalCacheData.setPermissionData(a),TTPromise.resolve("login","getPermission")):(Debug.Text("User does not have any permissions!","LoginViewController.js","LoginViewController","initializeLoginData:next",10),TAlertManager.showAlert($.i18n._("Unable to login due to permissions, please try again and if the problem persists contact customer support."),"",(function(){Global.Logout(),window.location.reload()})))}}),TTPromise.add("login","getCurrentCompany"),e.authentication_api.getCurrentCompany({onResult:function(e){var a=e.getResult();0!=a?("1"===a.is_setup_complete||1===a.is_setup_complete?a.is_setup_complete=!0:a.is_setup_complete=!1,LocalCacheData.setCurrentCompany(a),Debug.Text("Version: Client: "+APIGlobal.pre_login_data.application_build+" Server: "+a.application_build,"LoginViewController.js","LoginViewController","onUserPreference:next",10),APIGlobal.pre_login_data.application_build==a.application_build||Global.UNIT_TEST_MODE||(Debug.Text("Version mismatch on login: Reloading...","LoginViewController.js","LoginViewController","initializeLoginData:next",10),window.location.reload(!0)),TTPromise.resolve("login","getCurrentCompany")):(Debug.Text("Unable to get company information!","LoginViewController.js","LoginViewController","onUserPreference:next",10),TAlertManager.showAlert($.i18n._("Unable to download required information, please check your network connection and try again. If the problem persists contact customer support."),"",(function(){Global.Logout(),window.location.reload()})))}}),TTPromise.add("login","getUniqueCountry"),e.permission_api.getUniqueCountry({onResult:function(e){LocalCacheData.setUniqueCountryArray(e.getResult()),TTPromise.resolve("login","getUniqueCountry")}}),TTPromise.wait("login",null,(function(){e.goToView()})),TTPromise.resolve("login","init")}onGetCurrentUser(e){LocalCacheData.setLoginUser(e.getResult());var a={filter_data:{}};a.filter_data.user_id=LocalCacheData.loginUser.id,a.filter_columns={},a.filter_columns.symbol=!0,e.get("delegate").currency_api.getCurrency(a,{onResult:function(e){var a=e.getResult();Global.isArrayAndHasItems(a)&&a[0].symbol?LocalCacheData.setCurrentCurrencySymbol(a[0].symbol):LocalCacheData.setCurrentCurrencySymbol("$")}}),TTPromise.resolve("login","getCurrentUser")}onGetCurrentUserPreference(e){var a=e.getResult(),o=e.get("delegate");function t(e){LocalCacheData.loginUserPreference=e,TTPromise.add("getCurrentUserPreference","getDateFormat"),o.user_preference_api.getOptions("moment_date_format",{onResult:function(e){var a=e.getResult();LocalCacheData.loginUserPreference.js_date_format=a;var o=LocalCacheData.loginUserPreference.date_format;o||(o="DD-MMM-YY"),LocalCacheData.loginUserPreference.date_format=LocalCacheData.loginUserPreference.js_date_format[o],LocalCacheData.loginUserPreference.date_format_1=Global.convertTojQueryFormat(o),LocalCacheData.loginUserPreference.time_format_1=Global.convertTojQueryFormat(LocalCacheData.loginUserPreference.time_format),TTPromise.resolve("getCurrentUserPreference","getDateFormat")}}),TTPromise.add("getCurrentUserPreference","getTimeFormat"),o.user_preference_api.getOptions("moment_time_format",{onResult:function(e){var a=e.getResult();LocalCacheData.loginUserPreference.js_time_format=a,TTPromise.resolve("getCurrentUserPreference","getTimeFormat")}}),TTPromise.wait("getCurrentUserPreference",null,(function(){LocalCacheData.setLoginUserPreference(LocalCacheData.loginUserPreference),TTPromise.resolve("login","getCurrentUserPreference")}))}a.date_format?t(a):o.user_preference_api.getUserPreferenceDefaultData({onResult:function(e){t(e.getResult())}})}onGetCurrentUserLocale(e){var a=e.get("delegate"),o=e.getResult();o&&(a.user_locale=o),TTPromise.resolve("login","getCurrentUserLocale")}goToView(){this.doing_login=!1,TopMenuManager.ribbon_view_controller=null,TopMenuManager.ribbon_menus=null,Global.topContainer().empty(),LocalCacheData.currentShownContextMenuName=null;var e=TTUUID.generateUUID();null!=LocalCacheData.getLoginData().locale&&this.user_locale!==LocalCacheData.getLoginData().locale&&(ProgressBar.showProgressBar(e),ProgressBar.changeProgressBarMessage($.i18n._("Language changed, reloading")+"..."),Global.setLanguageCookie(this.user_locale),LocalCacheData.setI18nDic(null),setTimeout((function(){window.location.reload(!0)}),5e3)),IndexViewController.instance.router.removeCurrentView();var a=getCookie("PreviousSessionType");if(a&&getCookie("PreviousSessionID"))TopMenuManager.goToView(a),deleteCookie("PreviousSessionType",LocalCacheData.cookie_path,Global.getHost());else if(0!=Global.getDeepLink()){var o=decodeURIComponent(getCookie("AlternateSessionData"));o&&(o=JSON.parse(o))&&void 0===o.previous_session_id&&setCookie("AlternateSessionData","{}",-1,APIGlobal.pre_login_data.cookie_base_url,Global.getHost()),TopMenuManager.goToView(Global.getDeepLink())}else LocalCacheData.getLoginUserPreference().default_login_screen?TopMenuManager.goToView(LocalCacheData.getLoginUserPreference().default_login_screen):TopMenuManager.goToView("Home");!LocalCacheData.getCurrentCompany().is_setup_complete&&PermissionManager.checkTopLevelPermission("QuickStartWizard")&&IndexViewController.openWizard("QuickStartWizard");var t=LocalCacheData.getCurrentCompany();LocalCacheData&&t&&LocalCacheData.getLoginUser()&&Global.setAnalyticDimensions(LocalCacheData.getLoginUser().first_name+" ("+LocalCacheData.getLoginUser().id+")",t.name)}forgotPasswordClick(){IndexViewController.openWizard("ForgotPasswordWizard",null,(function(){TAlertManager.showAlert($.i18n._("An email has been sent to you with instructions on how to change your password."))}))}autoLogin(){var e=getCookie(Global.getSessionIDKey());e&&e.length>=40?(this.doing_login=!0,this.onLoginSuccess(null,e)):($(this.el).visible(),this.render())}render(){var e=this,a=TTUUID.generateUUID();LocalCacheData.setSessionID(""),$("body").hasClass("mobile-device-mode")||this.renderAnimalsForBackground(),$("#login_copy_right_info").hide(),$("#powered_by").hide();var o=$("#password").TTextInput({width:151}),t=$("#user_name").TTextInput({width:151}),n=$(".error-info");LocalCacheData.login_error_string?(n.text(LocalCacheData.login_error_string),LocalCacheData.login_error_string=""):n.text(""),t.focus(),$("#login-form").on("submit",(function(a){a.preventDefault(),e.onLoginBtnClick(a)})),$("#versionNumber").html("v"+APIGlobal.pre_login_data.application_build),$("#appTypeLogo").css("opacity",0);var i="theme/"+Global.theme;Global.url_offset&&(i=Global.url_offset+i),LocalCacheData.productEditionId>10&&!0===LocalCacheData.appType?$("#appTypeLogo").attr("src",i+"/css/views/login/images/od.png?v="+APIGlobal.pre_login_data.application_build):15===LocalCacheData.productEditionId?$("#appTypeLogo").attr("src",i+"/css/views/login/images/beo.png?v="+APIGlobal.pre_login_data.application_build):20===LocalCacheData.productEditionId?$("#appTypeLogo").attr("src",i+"/css/views/login/images/peo.png?v="+APIGlobal.pre_login_data.application_build):25===LocalCacheData.productEditionId?$("#appTypeLogo").attr("src",i+"/css/views/login/images/eeo.png?v="+APIGlobal.pre_login_data.application_build):$("#appTypeLogo").attr("src",i+"/css/views/login/images/seo.png?v="+APIGlobal.pre_login_data.application_build);var r=$(this.el).find("#quick_punch");LocalCacheData.productEditionId>10?r.show():r.hide(),$("#appTypeLogo").on("load",(function(){$(this).animate({opacity:1},100)})),$("#companyLogo").hide(),$("#companyLogo").css("opacity",0),$("#companyLogo").attr("src",ServiceCaller.getURLByObjectType("primary_company_logo")),$("#companyLogo").on("load",(function(){$(this).height()>78&&($(this).css("height",78),$(this).width>286&&$(this).css("width",286)),$(this).width>286&&$(this).css("width",286),$("#companyLogo").show(),$(this).animate({opacity:1},100)}));var l=$("#powered_by");l.show(),l.attr("src",ServiceCaller.getURLByObjectType("copyright")),l.attr("alt",LocalCacheData.loginData.application_name+" Workforce Management Software");var s=$('<a target="_blank" href="https://'+LocalCacheData.getLoginData().organization_url+'"></a>');s.addClass("powered-by-img-seo"),l.wrap(s),$("#login_copy_right_info").html($("#copy_right_info_1").html()),$("#login_copy_right_info").show(),10===LocalCacheData.productEditionId?($("#social_div").show(),$("#social_div").find(".facebook-img").attr("src","theme/default/images/facebook_button.jpg"),$("#social_div").find(".twitter-img").attr("src","theme/default/images/twitter_button.jpg")):$("#social_div").hide();var c=LocalCacheData.getLoginData().footer_right_html,g=LocalCacheData.getLoginData().footer_left_html;c&&"string"===$.type(c)&&((c=$(c)).addClass("foot-right-html"),c.insertAfter($(e.el))),g&&"string"===$.type(g)&&((g=$(g)).addClass("foot-left-html"),g.insertAfter($(e.el))),this.lan_selector=$(".language-selector"),this.lan_selector.TComboBox();var u=Global.buildRecordArray(LocalCacheData.getLoginData().language_options);this.lan_selector.setSourceData(u),this.lan_selector.setValue(LocalCacheData.getLoginData().language);e=this;this.lan_selector.bind("formItemChange",(function(){Global.setLanguageCookie(e.lan_selector.getValue()),LocalCacheData.setI18nDic(null),ProgressBar.showProgressBar(a),ProgressBar.changeProgressBarMessage($.i18n._("Language changed, reloading")+"..."),setTimeout((function(){window.location.reload(!0)}),2e3)})),LocalCacheData.getAllURLArgs().user_name&&t.val(LocalCacheData.getAllURLArgs().user_name),LocalCacheData.getAllURLArgs().password&&o.val(LocalCacheData.getAllURLArgs().password),Global.moveCookiesToNewPath(),Global.setUIInitComplete()}cleanWhenUnloadView(e){$("#loginViewContainer").remove(),$("#login-bg_animal").css("background-image",""),Global.setVirtualDeviceViewport("desktop"),super.cleanWhenUnloadView(e)}renderAnimalsForBackground(){var e=Global.getStationID();if(e.length>0){var a=e.match(/\d{1,5}/g);$.isArray(a)&&(e=a.join(""))}var o,t={"all":7,"newyear":2,"valintine":4,"easter":3,"stpatrick":4,"halloween":4,"xmas":5},n=moment().month()+1,i=moment().date(),r=i;if("all"==(o=12==n&&i>=30||1==n&&i<=15?"newyear":2==n&&i>=10&&i<=15?"valintine":3==n&&i>=25||4==n&&i<=25?"easter":5==n&&i>=15&&i<=18?"stpatrick":10==n&&i>=25&&i<=31?"halloween":12==n&&i>=10&&i<=29?"xmas":"all")&&(r=moment().week()),1==Debug.getEnable()){o=Object.keys(t)[Math.floor(Math.random()*(Object.keys(t).length-1))];var l=parseInt(100*Math.random())}else l=parseInt(r+(o.charCodeAt(0)-97)+e);var s=t[o],c="theme/default/images/login_animals_"+o+"_"+(Math.floor(Math.abs(Math.sin(l))*l%s)+1)+".png";c=c.replace("all_",""),Debug.Text("Background Animal Image: "+c+" Season: "+o+" Seed: "+l+" Total: "+s,"LoginViewController.js","","renderAnimalsForBackground",10),$("#login-bg_animal").css("background-image","url('"+c+"')")}}}}]);
//# sourceMappingURL=login-LoginViewController.bundle.js.map?v=880a407db5bf52d69018