{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/switch_button/SwitchButton.js","webpack://timetrex/./interface/html5/views/attendance/schedule/ScheduleViewController.js"],"names":["$","fn","SwitchButton","options","Global","addCss","opts","extend","defaults","$this","this","btn","enabled","getEnabled","setEnable","val","removeClass","addClass","getValue","return_number","hasClass","setValue","setIcon","each","o","meta","data","append","tooltip","attr","icon","click","e","stopImmediatePropagation","stopPropagation","jQuery","SwitchButtonIcon","daily_total","weekly_total","all_employee","strict_range","wages","ScheduleViewController","BaseViewController","_","el","user_group_api","status_array","user_group_array","toggle_button","start_date_picker","start_date","end_date","full_schedule_data","schedule_columns","full_format","weekly_format","final_schedule_data_array","has_date_array","no_date_array","shift_key_name_array","select_cells_Array","select_all_shifts_array","select_shifts_array","select_recurring_shifts_array","all_employee_btn","daily_totals_btn","weekly_totals_btn","strict_range_btn","month_date_row_array","month_date_row_tr_ids","month_date_row_position","month_current_header_number","day_header_width","day_hour_width","select_drag_menu_id","is_override","scroll_position","selected_user_ids","prev_total_time","prev_status_id","is_mass_adding","calculate_cell_number","scroll_interval","scroll_unit","holiday_data_dic","absence_policy_api","year_mode_original_date","events","super","permission_id","script_name","viewId","table_name_key","context_menu_name","i18n","navigation_label","api","TTAPI","APISchedule","APIUserGroup","APIAbsencePolicy","company_api","APICompany","user_api","APIUser","currency_api","APICurrency","getProductEdition","job_api","APIJob","job_item_api","APIJobItem","api_absence_policy","initPermission","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","p_id","PermissionManager","validate","show_search_tab","jobUIValidate","show_job_ui","jobItemUIValidate","show_job_item_ui","branchUIValidate","show_branch_ui","departmentUIValidate","show_department_ui","removeViewTab","ProgressBar","showOverlay","initOptions","default_display_columns","push","date","Date","UNIT_TEST_MODE","LocalCacheData","last_schedule_selected_date","format","getLoginUserDateFormat","dateStr","setDatePickerValue","current_select_date","strToDate","setMoveOrDropMode","ContextMenuIconName","move","getAllColumns","initLayout","setToggleButtonUrl","mode","getMode","getDefaultFormatValue","edit_view","setURLToBrowser","getBaseURL","callBack","getOptions","onResult","columns_result","columns_result_data","getResult","all_columns","buildColumnArray","group_columns_result","group_columns_result_data","final_all_columns","all_len","length","group_len","i","group_column_id","j","column","value","column_selector","setUnselectedGridData","getAllLayouts","setSelectLayout","search","initDropDownOption","getUserGroup","res","buildTreeRecord","basic_search_field_ui_dic","setSourceData","adv_search_field_ui_dic","retval","result","len","item","id","TTUUID","zero_id","not_exist_id","selected_item","current_edit_record","clone","current_doing_context_action","isSet","find","css","setCurrentEditRecordData","setEditMenu","setTabStatus","is_changed","closeOverlay","filter","grid_selected_id_array","getGridSelectIdArray","select_shift","resetSomeFields","openEditView","initEditView","selectedId","filter_data","key_name","result_data","TAlertManager","showAlert","onCancelClick","sub_view_mode","parent_key","parent_value","record","noRefreshUI","setCurrentEditViewState","record_id","getViewSelectedRecordId","isFalseOrNull","setCurrentSelectedRecord","getAPIFilters","doViewAPICall","TTPromise","add","wait","baseRecord","index","key","onMassEditResult","unique_columns","result1","linked_columns","is_mass_editing","mass_edit_record_ids","shift","hasOwnProperty","user_id","getCommonFields","getEditSelectedRecordId","doEditAPICall","user_ids","is_viewing","remove_ids","callback","doNext","call","isValid","onDeleteDone","removeEditView","showErrorAlert","bind","recurring_delete_shifts_array","status_id","setSchedule","context_menu_model","groups","drag_and_drop","label","exclude","export_excel","save_and_next","delete_and_next","copy","include","group","Icons","permission_result","drag_copy","swap","override","edit_employee","employee","timesheet","find_available","import_icon","checkTopLevelPermission","sort_order","in_out","permission","request","print_icon","print","type","RibbonSubMenuType","NAVIGATION","items","onNavigationClick","onOverrideClick","onFindAvailableClick","addPunchesFromScheduledShifts","addRequestFromScheduledShifts","onImportClick","getUpgradeMessage","shift_array","first_shift","last_shift","getScheduleDefaultData","async","shift_status","type_id","mon","tue","wed","thu","fri","sat","sun","w","undefined","d","time_stamp_num","getDay","getLoginUser","full_name","date_stamp","start_time","end_time","branch_id","department_id","job_id","job_item_id","IndexViewController","schedules","users","schedule","recurring","recurring_schedule_id","UserGenericStatusWindowController","open","getAttributeInAPIDetails","args","selected","extra_filter_for_next_open_view","openWizard","employee_id","onFindAvailableClose","replaced_id","iconName","post_data","checkScheduleData","getSelectEmployee","base_date","addViewTab","window","location","href","goToView","convertLayoutFilterToAPIFilter","select_layout","time_period","schedule_dates","start_display_date","end_display_date","new_end_date","getTime","setDate","getDate","0","1","doFormIFrameCall","postData","APIFileDownload","ScheduleViewControllerMode","DAY","WEEK","MONTH","YEAR","setWeekModeDragAble","off","on","grid_div","grid_pos","offset","top","mouse_y","originalEvent","clientY","grid_height","height","setInterval","div","grid","parent","scrollTop","clearInterval","unbind","event","preventDefault","parents","console","log","cells","td","target","container","span","text","getAbsenceCellValue","remove","dataTransfer","setData","setDragImage","target_empty_row","delete_old_items","new_shifts_array","delete_shifts_array","target_cell","currentTarget","selected_shifts","select_cellls_and_shifts_array","first_target_row_index","first_target_cell_index","parentNode","rowIndex","cellIndex","first_selected_row_index","first_selected_cell_index","row_index_offset","cell_index_offset","colModel","getGridParam","cell","row_id","cell_index","branch","department","target_row_index","target_cell_index","target_data","getDataByCellIndex","target_row","schedule_source","ScheduleViewControllerRowType","DATE","related_date","getCellRelatedDate","name","schedule_policy_id","job","job_item","start_date_stamp","new_shift","overwrite","temp_selected_data","temp_target_data","deleteSchedule","user","n","login_user","getSelectDate","doing_save_and_new","_createParametersForAdd","temp_date","initEditViewUI","previous_absence_policy_id","did_clean_dic","edit_view_ui_dic","widget","tab_id","setEnabled","job_id_col_name","is","job_widget","setCheckBox","setDefaultArgs","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","getField","c_value","manual_id","setJobItemValueWhenJobChanged","onJobQuickSearch","onTypeChange","setAbsencePolicyWhenUserChanged","setJobValueWhenUserChanged","absence_policy_id","startTime","endTime","schedulePolicyId","getScheduleTotalTime","total_time","getTimeUnit","onAvailableBalanceChange","absence_widget","old_value","setAbsencePolicyFilter","getAbsencePolicy","task_result","commonRecord","start_dates","buildMassAddRecord","isChecked","checkFields","processAddRecord","getRecordsFromUserIDs","record_array","indexOf","parserDatesRange","validateResult","common_record","y","isObject","new_common_record","ignoreWarning","is_add","clearNavigationData","current_date_str","current_date","next_date","onSaveAndCopyResult","onSaveAndNewResult","massAddArgs","field","uniformVariable","onSaveAndContinueResult","buildSelectedCellsRecord","getChangedFields","refresh_id","isUUID","setErrorTips","setErrorMenu","context_btn","pId","saveAndContinueValidate","isMassEmployeeOrDate","start_date_stamps","saveAndNewValidate","saveAndCopyValidate","getRate","attachElement","detachElement","setEditViewData","form_item_input","widgetContainer","edit_view_close_icon","hide","onCloseIconClick","tab_model","setTabModel","tab_schedule_column1","edit_view_tab","loadWidgetByName","FormItemType","AWESOME_BOX","AComboBox","api_class","allow_multiple_selection","layout_name","show_search_inputs","set_empty","checkOpenPermission","set_open","default_args","addEditFieldToColumn","addition_source_function","source_data","onEmployeeSourceCreate","permission_section","COMBO_BOX","TComboBox","DATE_PICKER","TDatePicker","validation_field","TRangePicker","TIME_PICKER","TTimePicker","TEXT","TText","APISchedulePolicy","customSearchFilter","available_balance_info","getRealImagePath","APIBranch","onSourceDataCreate","added_items","default_item","APIDepartment","setRealValueCallBack","job_coder","TEXT_INPUT","TTextInput","disable_keyup_event","job_item_coder","TEXT_AREA","TTextArea","width","resolve","grid_selected_length","deletePermissionValidate","edit_only_mode","deleteOwnerOrChildPermissionValidate","getAvailableBalance","dates","split","resultArray","beginDate","endDate","nextDate","cells_array","date_dic","getDefaultUser","last_date_stamp","getProjectedAbsencePolicyBalance","getBalanceHandler","layout_div","search_panel","form_item","loadWidget","form_item_label","form_item_input_div","ADropDown","display_show_all","allow_drag_to_order","display_close_btn","display_column_settings","static_height","setColumns","sortable","save_search_as_input","save_btn","onSaveNewLayout","previous_saved_layout_div","previous_saved_layout_selector","update_btn","del_btn","onUpdateLayout","onDeleteLayout","user_array","getSelectUsersArray","date_array","getSelectDateArray","buildRecordArray","setEditViewDataDone","filter_columns","absence_policy","is_year_mode","copyPermissionValidate","addPermissionValidate","editPermissionValidate","copyAsNewPermissionValidate","selectContextMenu","context_menu_array","save","setEditMenuSaveIcon","cancel","setEditMenuAddIcon","edit","setEditMenuEditIcon","view","setEditMenuViewIcon","mass_edit","setEditMenuMassEditIcon","setEditMenuCopyIcon","delete_icon","setEditMenuDeleteIcon","setEditMenuDeleteAndNextIcon","save_and_continue","setEditMenuSaveAndContinueIcon","save_and_new","setEditMenuSaveAndAddIcon","setEditMenuSaveAndNextIcon","save_and_copy","setEditMenuSaveAndCopyIcon","copy_as_new","setEditMenuCopyAndAddIcon","setEditMenuImportIcon","setEditMenuFindAvailableIcon","setContextMenuGroupVisibility","doNotSetFocus","_getGridSelectedLength","setDefaultMenuAddIcon","setDefaultMenuEditIcon","setDefaultMenuViewIcon","setDefaultMenuMassEditIcon","setDefaultMenuCopyIcon","setDefaultMenuDeleteIcon","setDefaultMenuSaveIcon","setDefaultMenuSaveAndContinueIcon","setDefaultMenuSaveAndAddIcon","setDefaultMenuSaveAndCopyIcon","setDefaultMenuCopyAsNewIcon","movePermissionValidate","setDefaultMenuCancelIcon","setDefaultMenuEditEmployeeIcon","setDefaultMenuImportIcon","setDefaultMenuEditTimesheetIcon","setDefaultMenuFindAvailabletIcon","setAutoPunchIcon","setAddRequestIcon","first","Debug","Text","editChildPermissionValidate","selectId","children","selected_display_columns","getSearchPanelDisplayColumns","getValidSearchFilter","display_columns","upCaseFirstLetter","strictRange","weeklyTotals","dailyTotals","showAllEmp","user_generic_data_api","setUserGenericData","clearViewLayoutCache","need_select_layout_name","default_layout_name","script","is_default","do_update","getLayoutsArray","clearSearchPanel","temp_adv_filter_data","temp_basic_filter_data","setSelectGridData","default_layout_id","select_items","getSelectItems","content","getSearchPanelFilter","filter_sort","layout_data","buildDisplayColumns","setToggleButtonValue","toLowerCase","getAllURLArgs","layouts_array","empty","prop","default_filter_for_next_open_view","select_date","setSearchPanelFilter","setDefaultMenu","use_date_picker_date","clearSelection","setActionsButtonStatus","start_date_string","include_all_users","strict","getCombinedSchedule","buildCalendars","autoOpenEditViewIfNecessary","searchDone","row","getLoginUserPreference","start_week_day","override_icon","drag_copy_icon","move_icon","swap_icon","drag_invisible","move_invisible","holiday_data","standard_date","do_not_hide","setHolidayDataDic","buildScheduleColumns","buildScheduleSource","buildScheduleGrid","setGridColumnsWidth","setGridSize","setYearGroupHeader","showGridBorders","clearGridData","addGridData","interval","setScheduleGridRowSpan","highLightSelectDay","setMonthDateRowPosition","setScheduleGridDragAble","setScrollPosition","setMonthDateRowBackGround","setWeeklyTotalHeader","addRowData","include_user_ids","show_weekly_total","table","ui_id","size_tr","new_tr","new_th","current_trs","eq","createSizeColumns","createColumn","insertBefore","setGridHeight","end_index","pay_period_th","default_tr","prepend","datesTHs","th","default_th","first_tr","start","insertAfter","current_month","same_month_count","id_split_array","date_str","month","getMonth","month_header_text","isNaN","position","scroll","start_day","header_text","header_container","data_field","setHeaderText","headerNumber","date_row","header","full_date","html","scrollWidth","day_column_index","column_padding","grid_data","is_static_size","fixed","column_width","calculateTextWidth","new_col_width","calculateScheduleWidth","day_column_width","setGridWidth","columns_width","max_width","padding","buildNoDateArray","buildHasDateArray","sort_fields","buildSortFields","sort","m_sort_by","concat","buildWeeklySource","buildMonthSource","buildYearlySource","buildDailySource","field_name","column_name","replace","date_row_index","month_week_data_index","first_day_time","month_week_data_array","slice","current_week_array","is_last_row","splice","buildMonthWeekNoDateArray","end_date_time","getLastDateOfRow","buildMonthWeeklyData","source_array","buildEmptyRow","map","push_to_last","date_string","buildShiftKey","find_position","x","row_index","user_full_name","last_name","display_columns_len","add_last","getEmptyWeeklyRow","EMPTY","showDailyTotal","showWeeklyTotal","label_column","first_time","last_time","first_date_time","last_date_time","first_time_str","last_time_str","selected_date_str","start_time_stamp","end_time_stamp","current_date_time","strToDateTime","min","getMinutes","time_span","day_mode_start_date_time","time_offset","day_column","day","setHolidayHeader","time_columns","time_string","time_format_string","current_hour_text","buildTotalShiftDic","outerHTML","getStandardDateTimeStr","timeHeader","label_array","total_shifts_dic","shift_item","buildDailyHeaders","total","note","sort_by_fields","primer","parseFloat","reverse","has_date_user_map","ii","all_user_map","sort_item","records","sort_array","schedule_data","date_key","sort_key","date_item","item_key","replaceFalseToEmptyStringForSortFields","default_branch","default_department","title","m","toString","grid_id","jqGrid","TTGrid","draggble","altRows","datatype","scrollOffset","rowNum","hoverrows","multiselectPosition","ondblClickRow","onGridDblClickRow","onSelectRow","flag","onRightClickRow","iRow","checkIsSelectedCell","cell_val","closest","onCellSelect","colNames","viewrecords","winMultiSelect","onResizeGrid","scrollLeft","bindGridColumnEvents","t_grid_header_array","column_info","column_header","TGridHeader","onColumnHeaderClick","substring","getYear","cell_value","related_data","is_day_column","col_models","col_model","content_div","full_date_str","TOTAL","shifts","absences","total_time_wage","total_span","currency","getCurrentCurrencySymbol","MoneyRound","pos","get","static_width","innerWidth","total_div","shifts_array","a","b","compare","display_total_column","rowId","getDayShiftWidth","getDayShiftOffset","start_date_time","buildWeekCell","buildMonthCell","buildYearCell","buildDayCell","row_tr","info","start_date_num","orginal_row_index","orginal_cell_index","shift_id","date_row_1_index","date_row_2_index","date_row_3_index","date_row_4_index","cell_td","ctrlKey","metaKey","found","parseInt","shiftKey","start_row_index","start_cell_index","end_row_index","end_cell_index","r_index","c_index","target_row_tr","target_row_td","rowspan","last_row","last_td","last_row_id","last_cell_id","last_cell_value","select_day","highlight_header","resizable","formatter","onCellFormat","arguments","cellattr","tv","rawObject","cm","rdata","employee_column","row_num","z","current_day","buildAllModeCommonColumns","temp_start_date","full_data_field","buildWeeklyTotalColumns","buildMonthRows","getDayByDayNum","inLine","shifts_column","absences_column","buildWeekColumns","buildMonthColumns","buildYearColumns","buildDayColumns","startSet","count","last_val","last_cell","need_remove_cells","need_removed_cell","node","style","display","setRows","setAllURLArgs","buildArgDic","canSetURL","tab_name","getEditViewTabIndex","trackView","control_bar","date_chooser_div","action_chooser_div","date_chooser","date_left_arrow","date_right_arrow","new_date","layout_changed","triggerAnalyticsNavigationOther","onShowEmployeeClick","onDailyTotalsClick","onWeeklyTotalClick","onStrictRangeClick","data_provider","TToggleButton","total_wage","isArray","data_len","currentItem","start_time_min","end_time_min","setMinutes","Math","ceil","startDate","toFixed","getTimeOffset","Number","setHours","getHours","total_row","column_keys","over_all_total_row","column_keys_len","column_key","no_data_key","total_row_key_data","row_data","buildTotalShiftsValues","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","tree_mode","APIUserTitle","APIRecurringScheduleTemplateControl","getDisplayColumns","first_item","second_item","unshift","open_item","cleanWhenUnloadView","enableAddRequestButton"],"mappings":"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","file":"attendance-schedule-ScheduleViewController.bundle.js?v=9b205c2635aa9c3f999d","sourcesContent":["( function( $ ) {\n\n\t$.fn.SwitchButton = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/switch_button/SwitchButton.css' );\n\t\tvar opts = $.extend( {}, $.fn.SwitchButton.defaults, options );\n\n\t\tvar $this = this;\n\n\t\tvar btn = null;\n\n\t\tvar enabled = true;\n\n\t\tthis.getEnabled = function() {\n\t\t\treturn enabled;\n\t\t};\n\n\t\tthis.setEnable = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tif ( !val ) {\n\t\t\t\tthis.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tthis.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\t//Error: TypeError: btn is null in /interface/html5/global/widgets/switch_button/SwitchButton.js?v=9.0.0-20150822-212724 line 31\n\t\tthis.getValue = function( return_number ) {\n\t\t\tif ( return_number ) {\n\t\t\t\treturn ( btn && btn.hasClass( 'selected' ) ) ? 1 : 0;\n\t\t\t} else {\n\t\t\t\treturn ( btn && btn.hasClass( 'selected' ) ) ? true : false;\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\t//Error: TypeError: btn is null in /interface/html5/global/widgets/switch_button/SwitchButton.js?v=8.0.0-20141230-130626 line 35\n\t\t\tif ( !btn ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbtn.removeClass( 'selected' );\n\n\t\t\tif ( val ) {\n\t\t\t\tbtn.addClass( 'selected' );\n\t\t\t}\n\t\t};\n\n\t\tthis.setIcon = function( val ) {\n\t\t\tbtn.addClass( val );\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tbtn = $( '<div></div>' );\n\n\t\t\t$this.append( btn );\n\n\t\t\tif ( o.tooltip ) {\n\t\t\t\tbtn.attr( 'title', o.tooltip );\n\t\t\t}\n\n\t\t\t$this.setIcon( o.icon );\n\n\t\t\tbtn.click( function( e ) {\n\n\t\t\t\tif ( !enabled ) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$this.setValue( !$this.getValue() );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.SwitchButton.defaults = {};\n\n} )( jQuery );\n\nexport var SwitchButtonIcon = function() {\n\n};\n\nSwitchButtonIcon.daily_total = 'daily';\nSwitchButtonIcon.weekly_total = 'weekly';\nSwitchButtonIcon.all_employee = 'all-employee';\nSwitchButtonIcon.strict_range = 'strict-range';\nSwitchButtonIcon.wages = 'strict-range';","import { SwitchButtonIcon } from '@/global/widgets/switch_button/SwitchButton';\n\nexport class ScheduleViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#schedule_view_container', //Must set el here and can only set string, so events can work\n\n\n\n\t\t\tuser_group_api: null,\n\n\t\t\tstatus_array: null,\n\n\t\t\tuser_group_array: null,\n\n\t\t\ttoggle_button: null,\n\n\t\t\tstart_date_picker: null,\n\n\t\t\tstart_date: null,\n\n\t\t\tend_date: null,\n\n\t\t\tfull_schedule_data: null,\n\n\t\t\tschedule_columns: null,\n\n\t\t\tfull_format: 'ddd-MMM-DD-YYYY',\n\n\t\t\tweekly_format: 'ddd, MMM DD',\n\n\t\t\tfinal_schedule_data_array: [],\n\n\t\t\thas_date_array: [],\n\n\t\t\tno_date_array: [],\n\n\t\t\tshift_key_name_array: [],\n\n\t\t\tselect_cells_Array: [], //Timesheet grid\n\n\t\t\tselect_all_shifts_array: [], //Timesheet grid.\n\n\t\t\tselect_shifts_array: [], //Timesheet grid.\n\n\t\t\tselect_recurring_shifts_array: [], //Timesheet grid.\n\n\t\t\tall_employee_btn: null,\n\n\t\t\tdaily_totals_btn: null,\n\n\t\t\tweekly_totals_btn: null,\n\n\t\t\tstrict_range_btn: null,\n\n\t\t\tmonth_date_row_array: null,\n\n\t\t\tmonth_date_row_tr_ids: null, // month date tr id in grid table\n\n\t\t\tmonth_date_row_position: null, //month date tr position in table\n\n\t\t\tmonth_current_header_number: 0, //0 is default column header\n\n\t\t\tday_header_width: 0,\n\n\t\t\tday_hour_width: 40,\n\n\t\t\tselect_drag_menu_id: '', //Do drag move or copy\n\n\t\t\tis_override: false,\n\n\t\t\tscroll_position: 0,\n\n\t\t\tselected_user_ids: [],\n\n\t\t\tprev_total_time: 0,\n\n\t\t\tprev_status_id: null,\n\n\t\t\tis_mass_adding: false,\n\n\t\t\tcalculate_cell_number: 0,\n\n\t\t\tscroll_interval: null,\n\n\t\t\tscroll_unit: 0,\n\n\t\t\tholiday_data_dic: {},\n\n\t\t\tabsence_policy_api: null,\n\n\t\t\tyear_mode_original_date: null, //set this when search for yer mode with use_date_picker true, so Keep select date in ritict mode\n\t\t\tevents: {}\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.permission_id = 'schedule';\n\t\tthis.script_name = 'ScheduleView';\n\t\tthis.viewId = 'Schedule';\n\t\tthis.table_name_key = 'schedule';\n\t\tthis.context_menu_name = $.i18n._( 'Schedules' );\n\t\tthis.navigation_label = $.i18n._( 'Schedule' ) + ':';\n\t\tthis.api = TTAPI.APISchedule;\n\t\tthis.user_group_api = TTAPI.APIUserGroup;\n\t\tthis.absence_policy_api = TTAPI.APIAbsencePolicy;\n\t\tthis.company_api = TTAPI.APICompany;\n\t\tthis.user_api = TTAPI.APIUser;\n\t\tthis.currency_api = TTAPI.APICurrency;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\n\t\tthis.api_absence_policy = TTAPI.APIAbsencePolicy;\n\n\t\tthis.scroll_position = 0;\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) &&\n\t\t\t( Global.getProductEdition() >= 20 ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job_item', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t//Speical permission check for views, need override\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tthis.show_search_tab = true;\n\t\t//See buildSearchFields() for additional permission checks.\n\t\t// if ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t// \tthis.show_search_tab = true;\n\t\t// } else {\n\t\t// \tthis.show_search_tab = false;\n\t\t// }\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\t}\n\n\t//only be call once when open this view\n\tinitData() {\n\t\tvar $this = this;\n\n\t\t//Remove tab if any\n\t\tGlobal.removeViewTab( this.viewId );\n\t\tProgressBar.showOverlay();\n\t\tthis.initOptions();\n\n\t\t//For regular employees who currently can't see the \"Saved Search and Layout\" tab, try to be smarter about what columns they do see by default.\n\t\tthis.default_display_columns = [];\n\t\tif ( PermissionManager.validate( this.permission_id, 'edit_branch' ) ) {\n\t\t\tthis.default_display_columns.push( 'branch' );\n\t\t}\n\t\tif ( PermissionManager.validate( this.permission_id, 'edit_department' ) ) {\n\t\t\tthis.default_display_columns.push( 'department' );\n\t\t}\n\t\tif ( Global.getProductEdition() >= 20 ) {\n\t\t\tif ( PermissionManager.validate( this.permission_id, 'edit_job' ) ) {\n\t\t\t\tthis.default_display_columns.push( 'job' );\n\t\t\t}\n\t\t\tif ( PermissionManager.validate( this.permission_id, 'edit_job_item' ) ) {\n\t\t\t\tthis.default_display_columns.push( 'job_item' );\n\t\t\t}\n\t\t}\n\n\t\tvar date = new Date();\n\n\t\tif ( Global.UNIT_TEST_MODE == true ) {\n\t\t\tLocalCacheData.last_schedule_selected_date = '15-Feb-18';\n\t\t}\n\n\t\tvar format = Global.getLoginUserDateFormat();\n\t\tvar dateStr = date.format( format );\n\n\t\tif ( !LocalCacheData.last_schedule_selected_date ) {\n\t\t\tif ( LocalCacheData.current_select_date && Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ) ) { //Select date get from URL.\n\t\t\t\tthis.setDatePickerValue( Global.strToDate( LocalCacheData.current_select_date, 'YYYY-MM-DD' ).format() );\n\t\t\t\tLocalCacheData.current_select_date = '';\n\t\t\t} else {\n\t\t\t\tthis.setDatePickerValue( dateStr );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.setDatePickerValue( LocalCacheData.last_schedule_selected_date );\n\t\t}\n\n\t\tthis.setMoveOrDropMode( ContextMenuIconName.move );\n\t\tthis.getAllColumns( function() {\n\t\t\t$this.initLayout();\n\t\t} );\n\t}\n\n\tsetToggleButtonValue( val ) {\n\n\t\tif ( this.toggle_button ) {\n\t\t\tthis.toggle_button.setValue( val );\n\n\t\t\tthis.setToggleButtonUrl();\n\t\t}\n\t}\n\n\tsetToggleButtonUrl() {\n\n\t\tvar mode = this.getMode();\n\t\tvar default_date = this.start_date_picker.getDefaultFormatValue();\n\t\tif ( !this.edit_view ) {\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode );\n\t\t}\n\t}\n\n\tsetDatePickerValue( val ) {\n\n\t\tthis.start_date_picker.setValue( val );\n\n\t\t//this.setDateUrl();\n\n\t\tLocalCacheData.last_schedule_selected_date = val;\n\t}\n\n\tgetAllColumns( callBack ) {\n\n\t\tvar $this = this;\n\t\tthis.api.getOptions( 'columns', {\n\t\t\tonResult: function( columns_result ) {\n\t\t\t\tvar columns_result_data = columns_result.getResult();\n\t\t\t\t$this.all_columns = Global.buildColumnArray( columns_result_data );\n\n\t\t\t\t$this.api.getOptions( 'group_columns', {\n\t\t\t\t\tonResult: function( group_columns_result ) {\n\n\t\t\t\t\t\tvar all_columns = Global.buildColumnArray( columns_result_data );\n\t\t\t\t\t\tvar group_columns_result_data = group_columns_result.getResult();\n\n\t\t\t\t\t\tvar final_all_columns = [];\n\n\t\t\t\t\t\tvar all_len = all_columns.length;\n\t\t\t\t\t\tvar group_len = group_columns_result_data.length;\n\n\t\t\t\t\t\tfor ( var i = 0; i < group_len; i++ ) {\n\t\t\t\t\t\t\tvar group_column_id = group_columns_result_data[i];\n\t\t\t\t\t\t\tfor ( var j = 0; j < all_len; j++ ) {\n\t\t\t\t\t\t\t\tvar column = all_columns[j];\n\t\t\t\t\t\t\t\tif ( column.value === group_column_id ) {\n\t\t\t\t\t\t\t\t\tfinal_all_columns.push( column );\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.all_columns = final_all_columns;\n\n\t\t\t\t\t\t$this.column_selector.setUnselectedGridData( $this.all_columns );\n\t\t\t\t\t\tif ( callBack ) {\n\t\t\t\t\t\t\tcallBack();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tinitLayout() {\n\t\tvar $this = this;\n\t\t$this.getAllLayouts( function() {\n\t\t\t$this.setSelectLayout();\n\t\t\t$this.search( true, true ); //Make sure we setDefaultMenu is TRUE so autoOpenEditViewIfNecessary() is called.\n\t\t} );\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status', '', this.api );\n\n\t\tthis.user_group_api.getUserGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\t$this.user_group_array = res;\n\n\t\t\t\tif ( $this.basic_search_field_ui_dic['group_ids'] ) {\n\t\t\t\t\t$this.basic_search_field_ui_dic['group_ids'].setSourceData( res );\n\t\t\t\t}\n\t\t\t\tif ( $this.adv_search_field_ui_dic['group_ids'] ) {\n\t\t\t\t\t$this.adv_search_field_ui_dic['group_ids'].setSourceData( res );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectDate() {\n\t\tvar retval = this.start_date_picker.getValue();\n\n\t\tif ( retval == 'Invalid date' ) {\n\t\t\tretval = new Date();\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tgetGridSelectIdArray() {\n\n\t\tvar result = [];\n\t\tvar len = this.select_all_shifts_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.select_all_shifts_array[i];\n\t\t\tif ( item.id && item.id != TTUUID.zero_id && item.id != TTUUID.not_exist_id ) {\n\t\t\t\tresult.push( item.id );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetSelectedItem() {\n\n\t\tvar selected_item = null;\n\t\tif ( this.edit_view ) {\n\t\t\tselected_item = this.current_edit_record;\n\t\t} else {\n\n\t\t\tif ( this.select_all_shifts_array.length > 0 ) {\n\t\t\t\tselected_item = this.select_all_shifts_array[0];\n\t\t\t}\n\n\t\t}\n\n\t\tif ( selected_item ) {\n\t\t\treturn Global.clone( selected_item );\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t_continueDoCopyAsNew() {\n\t\tvar $this = this;\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\n\t\t\tthis.current_edit_record.id = '';\n\t\t\tvar navigation_div = this.edit_view.find( '.navigation-div' );\n\t\t\tnavigation_div.css( 'display', 'none' );\n\t\t\tthis.setCurrentEditRecordData(); // Reset data to widgets to reset all widgets stat\n\t\t\tthis.setEditMenu();\n\t\t\tthis.setTabStatus();\n\t\t\tthis.is_changed = false;\n\t\t\tProgressBar.closeOverlay();\n\n\t\t} else {\n\n\t\t\tvar filter = {};\n\t\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\t\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\t\tif ( grid_selected_length > 0 ) {\n\t\t\t\tvar selectedId = grid_selected_id_array[0];\n\t\t\t} else {\n\t\t\t\tvar select_shift = Global.clone( $this.select_all_shifts_array[0] );\n\t\t\t\tselect_shift = $this.resetSomeFields( select_shift );\n\t\t\t\t$this.current_edit_record = select_shift;\n\t\t\t\t$this.openEditView();\n\t\t\t\t$this.initEditView();\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tfilter.filter_data = {};\n\t\t\tfilter.filter_data.id = [selectedId];\n\n\t\t\tthis.api['get' + this.api.key_name]( filter, {\n\t\t\t\tonResult: function( result ) {\n\n\t\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\t\t//#2571 - result_data is undefined (when result_data === true there is no result[0])\n\t\t\t\t\tif ( !result_data || result_data === true ) {\n\t\t\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Record does not exist' ) );\n\t\t\t\t\t\t$this.onCancelClick();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.openEditView(); // Put it here is to avoid if the selected one is not existed in data or have deleted by other pragram. in this case, the edit view should not be opend.\n\n\t\t\t\t\tresult_data = result_data[0];\n\n\t\t\t\t\tresult_data.id = '';\n\n\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonViewClick( record, noRefreshUI ) {\n\t\tthis.setCurrentEditViewState( 'view' );\n\n\t\tvar record_id = this.getViewSelectedRecordId( record );\n\t\tif ( Global.isFalseOrNull( record_id ) ) {\n\t\t\tTTPromise.add( 'Schedule', 'init' );\n\t\t\tthis.openEditView();\n\t\t\tvar select_shift = Global.clone( this.select_all_shifts_array[0] );\n\t\t\tselect_shift = this.resetSomeFields( select_shift );\n\t\t\tthis.current_edit_record = select_shift;\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'Schedule', 'init', function() {\n\t\t\t\t$this.initEditView();\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentSelectedRecord( record_id );\n\n\t\tthis.openEditView();\n\n\t\tvar filter = this.getAPIFilters();\n\n\t\treturn this.doViewAPICall( filter );\n\t}\n\n\tgetCommonFields() {\n\t\tvar baseRecord;\n\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\tif ( !baseRecord ) {\n\t\t\t\tbaseRecord = Global.clone( value );\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tfor ( var key in value ) {\n\t\t\t\tbaseRecord[key] !== value[key] && delete baseRecord[key];\n\t\t\t}\n\t\t} );\n\n\t\treturn baseRecord;\n\t}\n\n\tonMassEditClick() {\n\t\tvar $this = this;\n\t\tvar filter = {};\n\t\tvar grid_selected_id_array = [];\n\t\tLocalCacheData.current_doing_context_action = 'mass_edit';\n\t\tthis.mass_edit_record_ids = [];\n\n\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t$this.openEditView();\n\n\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t$this.mass_edit_record_ids.push( value );\n\t\t} );\n\n\t\t$this.selected_user_ids = [];\n\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\tvar shift = value;\n\t\t\tif ( shift.hasOwnProperty( 'user_id' ) ) {\n\t\t\t\t$this.selected_user_ids.push( shift.user_id );\n\t\t\t}\n\n\t\t} );\n\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.id = this.mass_edit_record_ids;\n\n\t\tif ( this.mass_edit_record_ids.length !== this.select_all_shifts_array.length ) {\n\t\t\tonMassEditResult( this.getCommonFields() );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.api['getCommon' + this.api.key_name + 'Data']( filter, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tif ( !result_data ) {\n\t\t\t\t\tresult_data = [];\n\t\t\t\t}\n\t\t\t\tonMassEditResult( result_data );\n\n\t\t\t}\n\t\t} );\n\n\t\tfunction onMassEditResult( result_data ) {\n\t\t\t$this.api['getOptions']( 'unique_columns', {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t$this.unique_columns = result.getResult();\n\t\t\t\t\t$this.api['getOptions']( 'linked_columns', {\n\t\t\t\t\t\tonResult: function( result1 ) {\n\n\t\t\t\t\t\t\t$this.linked_columns = result1.getResult();\n\n\t\t\t\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$this.current_edit_record = result_data;\n\t\t\t\t\t\t\t$this.is_mass_editing = true;\n\t\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\tonEditClick( record_id, noRefreshUI ) {\n\t\t// #2644: Note: This code fixes a bug where the edit screen is not opened on first try, but is on second. Likely due to the TTPromise and potential race conditions. See commit history for details.\n\t\tTTPromise.add( 'Schedule', 'init' );\n\t\tthis.setCurrentEditViewState( 'edit' );\n\t\tthis.openEditView();\n\n\t\trecord_id = this.getEditSelectedRecordId( record_id );\n\t\tif ( Global.isFalseOrNull( record_id ) ) {\n\t\t\tthis.openEditView();\n\t\t\tvar select_shift = Global.clone( this.select_all_shifts_array[0] );\n\t\t\tselect_shift = this.resetSomeFields( select_shift );\n\t\t\tthis.current_edit_record = select_shift;\n\t\t\tthis.current_edit_record.user_ids = [this.current_edit_record.user_id]; //#2610 - ensure that edit record is properly formed in respect to user_ids\n\t\t\tthis.is_viewing = false;\n\n\t\t\tvar $this = this;\n\t\t\tTTPromise.wait( 'Schedule', 'init', function() {\n\t\t\t\t$this.initEditView();\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\t\tthis.setCurrentSelectedRecord( record_id );\n\n\t\tvar filter = this.getAPIFilters();\n\n\t\treturn this.doEditAPICall( filter );\n\t}\n\n\tdoDeleteAPICall( remove_ids, callback ) {\n\t\tif ( !callback ) {\n\t\t\tcallback = {\n\t\t\t\tonResult: function( result ) {\n\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\tdoNext.call( this, result );\n\t\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t\tthis.onDeleteDone( result );\n\t\t\t\t\t\tif ( this.edit_view ) {\n\t\t\t\t\t\t\tthis.removeEditView();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t\t}\n\t\t\t\t}.bind( this )\n\t\t\t};\n\t\t}\n\t\tif ( remove_ids && remove_ids.length > 0 ) {\n\t\t\treturn this.api['delete' + this.api.key_name]( remove_ids, callback );\n\t\t} else {\n\t\t\tdoNext.call( this, {\n\t\t\t\tisValid: function() {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tfunction doNext( result ) {\n\t\t\t//Since we can't delete recurring schedules, we need to override them as absent without a absence policy instead.\n\t\t\tvar recurring_delete_shifts_array = [];\n\t\t\tfor ( var i = 0; i < this.select_cells_Array.length; i++ ) {\n\t\t\t\tif ( this.select_cells_Array[i].shift ) {\n\t\t\t\t\tthis.select_cells_Array[i].shift.status_id = '20'; //Set shift to absent.\n\t\t\t\t\trecurring_delete_shifts_array.push( this.select_cells_Array[i].shift );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\tthis.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\tthis.search();\n\t\t\t\t\t}.bind( this )\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tthis.search();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\tgroups: {\n\t\t\t\tdrag_and_drop: {\n\t\t\t\t\tlabel: $.i18n._( 'Drag & Drop' ),\n\t\t\t\t\tid: this.viewId + 'drag_and_drop'\n\t\t\t\t}\n\t\t\t},\n\t\t\texclude: [\n\t\t\t\tContextMenuIconName.export_excel,\n\t\t\t\tContextMenuIconName.save_and_next,\n\t\t\t\tContextMenuIconName.delete_and_next,\n\t\t\t\tContextMenuIconName.copy\n\t\t\t],\n\t\t\tinclude: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Move' ),\n\t\t\t\t\tid: ContextMenuIconName.move,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.move,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Copy' ),\n\t\t\t\t\tid: ContextMenuIconName.drag_copy,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.copy,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Swap' ),\n\t\t\t\t\tid: ContextMenuIconName.swap,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.swap,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Overwrite' ),\n\t\t\t\t\tid: ContextMenuIconName.override,\n\t\t\t\t\tgroup: 'drag_and_drop',\n\t\t\t\t\ticon: Icons.override,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit<br>Employee' ),\n\t\t\t\t\tid: ContextMenuIconName.edit_employee,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.employee,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'TimeSheet' ),\n\t\t\t\t\tid: ContextMenuIconName.timesheet,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.timesheet,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Find<br>Available' ),\n\t\t\t\t\tid: ContextMenuIconName.find_available,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.find_available,\n\t\t\t\t\tpermission_result: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Import' ),\n\t\t\t\t\tid: ContextMenuIconName.import_icon,\n\t\t\t\t\tgroup: 'other',\n\t\t\t\t\ticon: Icons.import_icon,\n\t\t\t\t\tpermission_result: PermissionManager.checkTopLevelPermission( 'ImportCSVSchedule' ),\n\t\t\t\t\tsort_order: 8000\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tif ( ( PermissionManager.validate( 'punch', 'add' ) && ( PermissionManager.validate( 'punch', 'edit' ) || PermissionManager.validate( 'punch', 'edit_child' ) ) ) ) {\n\t\t\tcontext_menu_model.include.push( {\n\t\t\t\tlabel: $.i18n._( 'Auto<br>Punch' ),\n\t\t\t\tid: 'AutoPunch',\n\t\t\t\tgroup: 'other',\n\t\t\t\ticon: Icons.in_out,\n\t\t\t\tpermission_result: true,\n\t\t\t\tpermission: true\n\t\t\t} );\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'request', 'add' ) ) {\n\t\t\tcontext_menu_model.include.push( {\n\t\t\t\tlabel: $.i18n._( 'Add<br>Request' ),\n\t\t\t\tid: 'AddRequest',\n\t\t\t\tgroup: 'other',\n\t\t\t\ticon: Icons.request,\n\t\t\t\tpermission_result: true,\n\t\t\t\tpermission: true\n\t\t\t} );\n\t\t}\n\n\t\tvar print_icon = {\n\t\t\tlabel: $.i18n._( 'Print' ),\n\t\t\tid: ContextMenuIconName.print,\n\t\t\tgroup: 'other',\n\t\t\ticon: Icons.print,\n\t\t\ttype: RibbonSubMenuType.NAVIGATION,\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Individual Schedules' ),\n\t\t\t\t\tid: 'pdf_schedule'\n\t\t\t\t}\n\t\t\t],\n\t\t\tpermission_result: true,\n\t\t\tpermission: true\n\t\t};\n\n\t\tif ( PermissionManager.validate( 'schedule', 'view' ) || PermissionManager.validate( 'schedule', 'view_child' ) ) {\n\t\t\tprint_icon.items.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Combined' ),\n\t\t\t\t\tid: 'pdf_schedule_group_combined'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Separated' ),\n\t\t\t\t\tid: 'pdf_schedule_group'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Group - Separated (Page Breaks)' ),\n\t\t\t\t\tid: 'pdf_schedule_group_pagebreak'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tcontext_menu_model.include.push( print_icon );\n\n\t\treturn context_menu_model;\n\t}\n\n\tonReportMenuClick( id ) {\n\t\tthis.onNavigationClick( id );\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.move:\n\t\t\tcase ContextMenuIconName.drag_copy:\n\t\t\tcase ContextMenuIconName.swap:\n\t\t\t\tthis.setMoveOrDropMode( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.override:\n\t\t\t\tthis.onOverrideClick();\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.find_available:\n\t\t\t\tthis.onFindAvailableClick( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AutoPunch':\n\t\t\t\tthis.addPunchesFromScheduledShifts( id );\n\t\t\t\tbreak;\n\t\t\tcase 'AddRequest':\n\t\t\t\tthis.addRequestFromScheduledShifts( id );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.import_icon:\n\t\t\t\tthis.onImportClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\taddRequestFromScheduledShifts( id ) {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( shift_array && shift_array.length <= 0 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar shift_array = this.select_cells_Array;\n\t\tvar first_shift = ( shift_array[0] ) ? shift_array[0] : null;\n\t\tvar last_shift = ( shift_array[shift_array.length - 1] ) ? shift_array[shift_array.length - 1] : null;\n\t\tif ( !first_shift || !last_shift ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar request = this.api.getScheduleDefaultData( this.select_cells_Array, { async: false } ).getResult();\n\t\tvar shift_status = 10;\n\t\tvar type_id = 40;\n\n\t\tvar mon = false, tue = false, wed = false, thu = false, fri = false, sat = false, sun = false;\n\n\t\tfor ( var w in shift_array ) {\n\t\t\tif ( first_shift.shift == undefined && shift_array[w].shift ) {\n\t\t\t\t//Set the archetype to the first day with a shift.\n\t\t\t\tfirst_shift = shift_array[w];\n\t\t\t}\n\n\t\t\t//Set selected days of the week.\n\t\t\tvar d = new Date( shift_array[w].time_stamp_num );\n\t\t\tswitch ( d.getDay() ) {\n\t\t\t\tcase 0:\n\t\t\t\t\tsun = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tmon = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\ttue = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\twed = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tthu = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 5:\n\t\t\t\t\tfri = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 6:\n\t\t\t\t\tsat = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// delete ( d ); #2792 In the new ES6 conversion, delete is causing errors, but technically should never have worked anyway. Potentially never did anything. Could maybe delete. Try null first.\n\t\t\td = null;\n\t\t}\n\n\t\trequest.mon = mon;\n\t\trequest.tue = tue;\n\t\trequest.wed = wed;\n\t\trequest.thu = thu;\n\t\trequest.fri = fri;\n\t\trequest.sat = sat;\n\t\trequest.sun = sun;\n\n\t\tif ( first_shift && first_shift.date ) {\n\t\t\tvar start_date = first_shift.date;\n\t\t}\n\n\t\tif ( last_shift && last_shift.date ) {\n\t\t\tvar end_date = last_shift.date;\n\t\t}\n\n\t\tif ( first_shift ) {\n\t\t\tif ( first_shift.shift && first_shift.shift.status_id == 10 && first_shift.shift.user_id && first_shift.shift.user_id != TTUUID.zero_id ) {\n\t\t\t\tshift_status = 20;\n\t\t\t\ttype_id = 30;\n\t\t\t}\n\t\t}\n\n\t\trequest.status_id = shift_status;\n\t\trequest.type_id = type_id;\n\t\trequest.user_id = LocalCacheData.getLoginUser().id;\n\t\trequest.full_name = LocalCacheData.getLoginUser().full_name;\n\t\tif ( start_date ) {\n\t\t\trequest.date_stamp = start_date;\n\t\t\trequest.start_date = start_date;\n\t\t}\n\n\t\tif ( end_date ) {\n\t\t\trequest.end_date = end_date;\n\t\t}\n\n\t\tif ( first_shift.start_time ) {\n\t\t\trequest.start_time = first_shift.start_time;\n\t\t}\n\n\t\tif ( first_shift.end_time ) {\n\t\t\trequest.end_time = first_shift.end_time;\n\t\t}\n\n\t\tif ( first_shift.branch_id ) {\n\t\t\trequest.branch_id = first_shift.branch_id;\n\t\t}\n\n\t\tif ( first_shift.department_id ) {\n\t\t\trequest.department_id = first_shift.department_id;\n\t\t}\n\n\t\tif ( first_shift.job_id ) {\n\t\t\trequest.job_id = first_shift.job_id;\n\t\t}\n\n\t\tif ( first_shift.job_item_id ) {\n\t\t\trequest.job_item_id = first_shift.job_item_id;\n\t\t}\n\n\t\tIndexViewController.openEditView( this, 'Request', request, 'openAddView' );\n\t}\n\n\taddPunchesFromScheduledShifts( id ) {\n\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn false;\n\t\t}\n\t\tif ( this.select_cells_Array == undefined || this.select_cells_Array.length < 1 ) {\n\t\t\tTAlertManager.showAlert( 'No schedules selected. You can\\'t autopunch no schedules.' );\n\t\t\treturn false;\n\t\t}\n\n\t\tvar shift_array = this.select_cells_Array;\n\t\tvar schedules = {};\n\t\tvar users = [];\n\t\tschedules.schedule = [];\n\t\tschedules.recurring = [];\n\n\t\tfor ( var i = 0; i < shift_array.length; i++ ) {\n\t\t\tif ( shift_array[i].shift != undefined ) { //avoid when no user scheduled.\n\t\t\t\tif ( shift_array[i].shift.id\n\t\t\t\t\t&& shift_array[i].shift.id != TTUUID.zero_id\n\t\t\t\t\t&& shift_array[i].shift.id != TTUUID.not_exist_id\n\t\t\t\t) {\n\t\t\t\t\tschedules.schedule.push( shift_array[i].shift.id );\n\t\t\t\t} else if ( shift_array[i].shift.recurring_schedule_id\n\t\t\t\t\t&& shift_array[i].shift.recurring_schedule_id != TTUUID.not_exist_id\n\t\t\t\t) {\n\t\t\t\t\tschedules.recurring.push( shift_array[i].shift.recurring_schedule_id );\n\t\t\t\t}\n\t\t\t\tusers.push( shift_array[i].shift.user_id );\n\t\t\t}\n\t\t}\n\n\t\tthis.api.addPunchesFromScheduledShifts( schedules, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tUserGenericStatusWindowController.open( result.getAttributeInAPIDetails( 'user_generic_status_batch_id' ), [LocalCacheData.getLoginUser().id] );\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSelectEmployee() {\n\t\tvar shift = this.select_cells_Array[0];\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'user_id' of undefined in /interface/html5/#!m=Schedule&date=20141117&mode=week&a=new&tab=Schedule line 1116\n\t\tif ( !shift || shift.user_id == TTUUID.zero_id ) {\n\t\t\tshift = { user_id: LocalCacheData.getLoginUser().id };\n\t\t} else if ( shift.user_id && shift.user_id != TTUUID.zero_id ) {\n\t\t\tshift = { user_id: shift.user_id };\n\t\t}\n\n\t\tif ( this.edit_view && this.current_edit_record ) {\n\t\t\tshift.user_id = this.current_edit_record.user_id;\n\t\t}\n\n\t\treturn shift.user_id;\n\t}\n\n\tonFindAvailableClick() {\n\t\tif ( Global.getProductEdition() <= 10 ) {\n\t\t\tTAlertManager.showAlert( Global.getUpgradeMessage() );\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.selected = [];\n\t\tvar len = this.select_all_shifts_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.select_all_shifts_array[i];\n\t\t\targs.selected.push( item );\n\t\t}\n\n\t\tLocalCacheData.extra_filter_for_next_open_view = {};\n\t\tLocalCacheData.extra_filter_for_next_open_view.filter_data = args;\n\n\t\tIndexViewController.openWizard( 'FindAvailableWizard', null, function( employee_id ) {\n\t\t\t$this.onFindAvailableClose( employee_id, args.selected );\n\t\t} );\n\t}\n\n\tonFindAvailableClose( employee_id, shift_array ) {\n\t\tvar $this = this;\n\t\tvar len = shift_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = shift_array[i];\n\t\t\titem.user_id = employee_id;\n\t\t\titem.replaced_id = item.id;\n\t\t\tdelete item.id;\n\t\t}\n\n\t\tthis.api.setSchedule( shift_array, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( !result.isValid() ) {\n\t\t\t\t\tTAlertManager.showErrorAlert( result );\n\t\t\t\t}\n\t\t\t\t$this.search();\n\t\t\t}\n\t\t} );\n\t}\n\n\tonImportClick() {\n\t\tvar $this = this;\n\t\tIndexViewController.openWizard( 'ImportCSVWizard', 'Schedule', function() {\n\t\t\t$this.search();\n\t\t} );\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tif ( !this.checkScheduleData() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar post_data;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\tIndexViewController.openEditView( this, 'Employee', this.getSelectEmployee() );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\tvar filter = { filter_data: {} };\n\t\t\t\tfilter.user_id = this.getSelectEmployee();\n\n\t\t\t\tif ( this.edit_view ) {\n\t\t\t\t\tfilter.base_date = this.current_edit_record.date_stamp;\n\t\t\t\t} else {\n\t\t\t\t\tfilter.base_date = this.start_date_picker.getValue();\n\t\t\t\t}\n\t\t\t\tGlobal.addViewTab( this.viewId, $.i18n._( 'Schedules' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'TimeSheet', filter );\n\n\t\t\t\tbreak;\n\t\t\tcase 'pdf_schedule':\n\t\t\tcase 'pdf_schedule_group_combined':\n\t\t\tcase 'pdf_schedule_group':\n\t\t\tcase 'pdf_schedule_group_pagebreak':\n\t\t\t\tfilter = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\n\t\t\t\tif ( !filter ) {\n\t\t\t\t\tfilter = {};\n\t\t\t\t}\n\t\t\t\tfilter.time_period = {};\n\t\t\t\tfilter.time_period.time_period = 'custom_date';\n\t\t\t\tfilter.time_period.start_date = this.full_schedule_data.schedule_dates.start_display_date;\n\t\t\t\tfilter.time_period.end_date = this.full_schedule_data.schedule_dates.end_display_date;\n\n\t\t\t\tif ( filter.time_period.start_date == filter.time_period.end_date ) {\n\t\t\t\t\tvar new_end_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + 6 ) );\n\t\t\t\t\tfilter.time_period.end_date = new_end_date.format();\n\t\t\t\t}\n\n\t\t\t\tpost_data = { 0: filter, 1: iconName };\n\t\t\t\tthis.doFormIFrameCall( post_data );\n\t\t\t\tbreak;\n\n\t\t}\n\t}\n\n\tdoFormIFrameCall( postData ) {\n\t\tGlobal.APIFileDownload( 'APIScheduleSummaryReport', 'getScheduleSummaryReport', postData );\n\t}\n\n\tsetScheduleGridDragAble() {\n\t\tvar mode = this.getMode();\n\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.setWeekModeDragAble();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar $this = this;\n\t\t//set bottom drag to scroll area\n\t\t$( '.schedule-grid-div' ).off( 'dragover' ).on( 'dragover', function( e ) {\n\n\t\t\tvar grid_div = $( '.schedule-grid-div' );\n\t\t\tvar grid_pos = grid_div.offset().top;\n\n\t\t\tvar mouse_y = e.originalEvent.clientY;\n\t\t\tvar grid_height = grid_div.height();\n\n\t\t\tif ( mouse_y > ( grid_pos + grid_height ) ) {\n\t\t\t\t$this.scroll_unit = mouse_y - ( grid_pos + grid_height );\n\t\t\t\tif ( !$this.scroll_interval ) {\n\t\t\t\t\t$this.scroll_interval = setInterval( function() {\n\t\t\t\t\t\tvar div = $this.grid.grid.parent().parent();\n\t\t\t\t\t\tdiv.scrollTop( div.scrollTop() + $this.scroll_unit );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} else if ( mouse_y < ( grid_pos + 15 ) && mouse_y > ( grid_pos - 50 ) ) {\n\t\t\t\t$this.scroll_unit = ( grid_pos + 15 ) - mouse_y;\n\t\t\t\tif ( !$this.scroll_interval ) {\n\t\t\t\t\t$this.scroll_interval = setInterval( function() {\n\t\t\t\t\t\tvar div = $this.grid.grid.parent().parent();\n\t\t\t\t\t\tdiv.scrollTop( div.scrollTop() - $this.scroll_unit );\n\t\t\t\t\t}, 50 );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tclearInterval( $this.scroll_interval );\n\t\t\t\t$this.scroll_interval = null;\n\t\t\t}\n\n\t\t} );\n\n\t\t$( '.schedule-grid-div' ).off( 'dragend' ).on( 'dragend', function( e ) {\n\n\t\t\tif ( $this.scroll_interval ) {\n\t\t\t\tclearInterval( $this.scroll_interval );\n\t\t\t\t$this.scroll_interval = null;\n\t\t\t}\n\n\t\t} );\n\n\t\t$( '.schedule-grid-div td' ).unbind( 'dragenter' ).bind( 'dragenter', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t\t$( '.schedule-drag-over' ).removeClass( 'schedule-drag-over' );\n\n\t\t\tif ( $( this ).attr( 'draggable' ) || $( this ).parents( 'td' ).attr( 'draggable' ) ) {\n\t\t\t\t$( this ).addClass( 'schedule-drag-over' );\n\t\t\t}\n\t\t\tconsole.log( 'enter' );\n\t\t} );\n\t}\n\n\tsetWeekModeDragAble() {\n\t\tvar $this = this;\n\t\tvar position = 0;\n\n\t\tvar cells = this.grid.grid.find( '.date-column' ).parents( 'td' );\n\n\t\tcells.attr( 'draggable', true );\n\n\t\tcells.unbind( 'dragstart' ).bind( 'dragstart', function( event ) {\n\t\t\tvar td = event.target;\n\t\t\tif ( $this.select_all_shifts_array.length < 1 || !$( td ).hasClass( 'ui-state-highlight' ) || !$this.select_drag_menu_id ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar container = $( '<div class=\\'drag-holder-div\\'></div>' );\n\n\t\t\tvar len = $this.select_all_shifts_array.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar shift = $this.select_all_shifts_array[i];\n\t\t\t\tvar span = $( '<span class=\\'drag-span\\'></span>' );\n\n\t\t\t\tif ( shift.status_id == 20 ) {\n\t\t\t\t\tspan.text( $this.getAbsenceCellValue( shift ) );\n\t\t\t\t} else {\n\t\t\t\t\tspan.text( shift.start_time + ' - ' + shift.end_time );\n\t\t\t\t}\n\n\t\t\t\tcontainer.append( span );\n\t\t\t}\n\n\t\t\t$( 'body' ).find( '.drag-holder-div' ).remove();\n\n\t\t\t$( 'body' ).append( container );\n\n\t\t\tevent.originalEvent.dataTransfer.setData( 'Text', 'schedule' );//JUST ELEMENT references is ok here NO ID\n\n\t\t\tif ( event.originalEvent.dataTransfer.setDragImage ) {\n\t\t\t\tevent.originalEvent.dataTransfer.setDragImage( container[0], 0, 0 );\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} );\n\n\t\tcells.unbind( 'drop' ).bind( 'drop', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t\tif ( event.stopPropagation ) {\n\t\t\t\tevent.stopPropagation(); // stops the browser from redirecting.\n\t\t\t}\n\n\t\t\t$( '.drag-holder-div' ).remove();\n\n\t\t\tvar target_empty_row = false;\n\t\t\tvar delete_old_items = false;\n\n\t\t\tvar new_shifts_array = [];\n\t\t\tvar delete_shifts_array = [];\n\t\t\tvar recurring_delete_shifts_array = [];\n\n\t\t\tvar target_cell = event.currentTarget;\n\n\t\t\tvar selected_shifts = $this.select_cellls_and_shifts_array;\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in interface/html5/#!m=Schedule&date=20151213&mode=week line 1420\n\t\t\tif ( !selected_shifts ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar first_target_row_index;\n\t\t\tvar first_target_cell_index;\n\n\t\t\tfirst_target_row_index = target_cell.parentNode.rowIndex - 1;\n\t\t\tfirst_target_cell_index = target_cell.cellIndex;\n\n\t\t\tvar row_index_offset = 0;\n\t\t\tvar cell_index_offset = 0;\n\n\t\t\tvar first_selected_row_index;\n\t\t\tvar first_selected_cell_index;\n\n\t\t\tvar colModel = $this.grid.grid.getGridParam( 'colModel' );\n\n\t\t\tif ( $this.select_drag_menu_id === ContextMenuIconName.move ) {\n\t\t\t\tdelete_old_items = true;\n\t\t\t} else {\n\t\t\t\tdelete_old_items = false;\n\t\t\t}\n\n\t\t\tvar len = selected_shifts.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar cell = selected_shifts[i];\n\t\t\t\tvar shift;\n\n\t\t\t\tif ( i === 0 ) {\n\t\t\t\t\tfirst_selected_row_index = cell.row_id;\n\t\t\t\t\tfirst_selected_cell_index = cell.cell_index;\n\t\t\t\t} else {\n\t\t\t\t\tif ( !target_empty_row ) {\n\t\t\t\t\t\trow_index_offset = cell.row_id - first_selected_row_index;\n\t\t\t\t\t}\n\t\t\t\t\tcell_index_offset = cell.cell_index - first_selected_cell_index;\n\t\t\t\t}\n\n\t\t\t\tif ( cell.shift ) {\n\t\t\t\t\tshift = cell.shift;\n\t\t\t\t} else {\n\t\t\t\t\tvar target_row_index = first_target_row_index + row_index_offset;\n\t\t\t\t\tvar target_cell_index = first_target_cell_index + cell_index_offset;\n\t\t\t\t\tif ( target_cell_index > colModel.length - 1 ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar target_data = $this.getDataByCellIndex( target_row_index, target_cell_index );\n\t\t\t\t\tvar target_row = $this.schedule_source[target_row_index];\n\n\t\t\t\t\tif ( !target_row || !target_row.user_id ) {\n\t\t\t\t\t\ttarget_empty_row = true;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tshift.branch_id = shift.branch ? shift.branch_id : '';\n\t\t\t\tshift.department_id = shift.department ? shift.department_id : '';\n\t\t\t\tshift.job_id = shift.job_id ? shift.job_id : '';\n\t\t\t\tshift.job_item_id = shift.job_item_id ? shift.job_item_id : '';\n\n\t\t\t\ttarget_row_index = first_target_row_index + row_index_offset;\n\t\t\t\ttarget_cell_index = first_target_cell_index + cell_index_offset;\n\n\t\t\t\tif ( target_cell_index > colModel.length - 1 ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttarget_data = $this.getDataByCellIndex( target_row_index, target_cell_index );\n\t\t\t\ttarget_row = $this.schedule_source[target_row_index];\n\n\t\t\t\tif ( !target_row || !target_row.user_id ) {\n\t\t\t\t\ttarget_empty_row = true;\n\t\t\t\t}\n\n\t\t\t\tif ( target_row ) {\n\t\t\t\t\tif ( target_row.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !target_data || target_empty_row ) {\n\t\t\t\t\t\tvar date_stamp;\n\n\t\t\t\t\t\t//Error: TypeError: colModel[target_cell_index] is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141230-153210 line 2 > eval line 1443\n\t\t\t\t\t\tif ( colModel ) {\n\t\t\t\t\t\t\tif ( $this.getMode() === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\t\t\t\t//Error: \"TypeError: Cannot read property 'format' of null\"\n\t\t\t\t\t\t\t\t// when user drags a scedule to a non-date grid element we need to quietly fail\n\t\t\t\t\t\t\t\tvar related_date = $this.getCellRelatedDate( target_row_index, colModel, target_cell_index, colModel[target_cell_index].name );\n\t\t\t\t\t\t\t\tif ( related_date ) {\n\t\t\t\t\t\t\t\t\tdate_stamp = related_date.format();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdate_stamp = Global.strToDate( colModel[target_cell_index].name, $this.full_format ).format();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !date_stamp || date_stamp == 'Invalid date' ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttarget_data = {};\n\n\t\t\t\t\t\tif ( !target_row.user_id ) { //Only happens in month mode;\n\t\t\t\t\t\t\ttarget_data = shift;\n\t\t\t\t\t\t\ttarget_data.date_stamp = date_stamp;\n\t\t\t\t\t\t\ttarget_data.start_date_stamp = date_stamp;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget_data.user_id = target_row.user_id;\n\t\t\t\t\t\t\ttarget_data.branch = target_row.branch;\n\t\t\t\t\t\t\ttarget_data.branch_id = target_row.branch ? target_row.branch_id : '';\n\t\t\t\t\t\t\ttarget_data.schedule_policy_id = target_row.schedule_policy_id;\n\t\t\t\t\t\t\ttarget_data.department_id = target_row.department ? target_row.department_id : '';\n\t\t\t\t\t\t\ttarget_data.department = target_row.department;\n\t\t\t\t\t\t\ttarget_data.job_id = target_row.job_id ? target_row.job_id : '';\n\t\t\t\t\t\t\ttarget_data.job = target_row.job;\n\t\t\t\t\t\t\ttarget_data.job_item_id = target_row.job_item_id ? target_row.job_item_id : '';\n\t\t\t\t\t\t\ttarget_data.job_item = target_row.job_item;\n\t\t\t\t\t\t\ttarget_data.date_stamp = date_stamp;\n\t\t\t\t\t\t\ttarget_data.start_date_stamp = date_stamp;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tvar new_shift = Global.clone( shift );\n\n\t\t\t\tif ( $this.select_drag_menu_id !== ContextMenuIconName.swap ) {\n\t\t\t\t\tnew_shift.id = '';\n\t\t\t\t\tnew_shift.date_stamp = target_data.date_stamp;\n\t\t\t\t\tnew_shift.start_date_stamp = target_data.start_date_stamp;\n\t\t\t\t\tnew_shift.user_id = target_data.user_id;\n\t\t\t\t\t// When dragging an open shift to an empty cell in a user row with no branch column visible, the branch id value now defaults to user default branch id\n\t\t\t\t\tnew_shift.branch_id = target_data.branch ? target_data.branch_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.department_id = target_data.department ? target_data.department_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.job_id = target_data.job_id ? target_data.job_id : TTUUID.not_exist_id;\n\t\t\t\t\tnew_shift.job_item_id = target_data.job_item_id ? target_data.job_item_id : TTUUID.not_exist_id;\n\n\t\t\t\t\tif ( $this.is_override ) {\n\t\t\t\t\t\tnew_shift.overwrite = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tnew_shifts_array.push( new_shift );\n\t\t\t\t\tif ( shift.id && shift.id != TTUUID.zero_id ) {\n\t\t\t\t\t\tdelete_shifts_array.push( shift.id );\n\t\t\t\t\t} else if ( shift.user_id != TTUUID.zero_id && shift.user_id != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t//If dragging (move) a recurring shift assigned to a user and dropping on another user, switch the source shift to Absent in the process, otherwise both shifts will exist as being worked.\n\t\t\t\t\t\t//  However when dragging from a OPEN shift as the source, that isn't required, as the OPEN shift will automatically be filled.\n\t\t\t\t\t\tshift.status_id = '20';\n\t\t\t\t\t\trecurring_delete_shifts_array.push( shift );\n\t\t\t\t\t} else if ( shift.user_id == TTUUID.zero_id ) {\n\t\t\t\t\t\tdelete_old_items = false; //Never delete old items when the source is a OPEN shift.\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tvar temp_selected_data = Global.clone( new_shift );\n\t\t\t\t\tvar temp_target_data = Global.clone( target_data );\n\n\t\t\t\t\tif ( !temp_target_data.start_date ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var key in target_data ) {\n\t\t\t\t\t\tif ( key !== 'id' &&\n\t\t\t\t\t\t\tkey !== 'user_id' &&\n\t\t\t\t\t\t\tkey !== 'date_stamp' &&\n\t\t\t\t\t\t\tkey !== 'start_date_stamp' &&\n\t\t\t\t\t\t\tkey !== 'branch_id' &&\n\t\t\t\t\t\t\tkey !== 'department_id' &&\n\t\t\t\t\t\t\tkey !== 'job_id' &&\n\t\t\t\t\t\t\tkey !== 'job_item_id' &&\n\t\t\t\t\t\t\tkey !== 'branch' &&\n\t\t\t\t\t\t\tkey !== 'department' &&\n\t\t\t\t\t\t\tkey !== 'job' &&\n\t\t\t\t\t\t\tkey !== 'job_item' &&\n\t\t\t\t\t\t\tkey !== 'schedule_policy_id' ) {\n\n\t\t\t\t\t\t\ttarget_data[key] = temp_selected_data[key];\n\t\t\t\t\t\t\tnew_shift[key] = temp_target_data[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// When dragging an open shift to an empty cell in a user row with no branch column visible, the branch id value now defaults to user default branch id\n\t\t\t\t\ttarget_data.branch_id = target_data.branch ? target_data.branch_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.department_id = target_data.department ? target_data.department_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.job_id = target_data.job_id ? target_data.job_id : TTUUID.not_exist_id;\n\t\t\t\t\ttarget_data.job_item_id = target_data.job_item_id ? target_data.job_item_id : TTUUID.not_exist_id;\n\n\t\t\t\t\tnew_shifts_array.push( target_data );\n\t\t\t\t\tnew_shifts_array.push( new_shift );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( new_shifts_array.length > 0 ) {\n\t\t\t\t$this.api.setSchedule( new_shifts_array, {\n\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t\t\tif ( delete_old_items ) {\n\t\t\t\t\t\t\t\tif ( delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t$this.api.deleteSchedule( delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\tif ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} else if ( recurring_delete_shifts_array.length > 0 ) {\n\t\t\t\t\t\t\t\t\t$this.api.setSchedule( recurring_delete_shifts_array, {\n\t\t\t\t\t\t\t\t\t\tonResult: function() {\n\t\t\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$this.search();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\n\t\t} );\n\n\t\tcells.unbind( 'dragenter' ).bind( 'dragenter', function( event ) {\n\t\t\tevent.preventDefault();\n\t\t} );\n\n\t\tcells.unbind( 'dragover' ).bind( 'dragover', function( event ) {\n\t\t\tevent.preventDefault(); //Must prevent tihs\n\n\t\t} );\n\t\tcells.unbind( 'dragend' ).bind( 'dragend', function( event ) {\n\n\t\t\t$( '.drag-holder-div' ).remove();\n\t\t\t$( '.schedule-drag-over' ).removeClass( 'schedule-drag-over' );\n\n\t\t} );\n\t}\n\n\tresetSomeFields( item ) {\n\t\titem.branch_id = item.branch ? item.branch_id : '';\n\t\titem.department_id = item.department ? item.department_id : '';\n\t\titem.job_id = item.job ? item.job_id : '';\n\t\titem.job_item_id = item.job_item ? item.job_item_id : '';\n\n\t\treturn item;\n\t}\n\n\t_createParametersForAdd() {\n\t\tvar result = [], user;\n\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\tfor ( var i = 0, n = this.select_cells_Array.length; i < n; i++ ) {\n\t\t\t\tvar item = this.select_cells_Array[i];\n\t\t\t\tuser = {};\n\t\t\t\tuser.user_id = item.user_id;\n\t\t\t\tuser.branch_id = item.branch_id;\n\t\t\t\tuser.department_id = item.department_id;\n\t\t\t\tuser.job_id = item.job_id;\n\t\t\t\tuser.job_item_id = item.job_item_id;\n\t\t\t\tuser.date = item.date;\n\t\t\t\tresult.push( user );\n\t\t\t}\n\t\t}\n\n\t\tif ( result.length < 1 ) {\n\t\t\tvar login_user = LocalCacheData.getLoginUser();\n\t\t\tuser = {};\n\t\t\tuser.user_id = login_user.id;\n\t\t\tuser.branch_id = login_user.branch_id;\n\t\t\tuser.department_id = login_user.department_id;\n\t\t\tuser.job_id = login_user.job_id;\n\t\t\tuser.job_item_id = login_user.job_item_id;\n\t\t\tuser.date = this.getSelectDate();\n\t\t\tresult.push( user );\n\t\t}\n\t\treturn result;\n\t}\n\n\tonAddClick( doing_save_and_new ) {\n\n\t\tvar $this = this;\n\t\tthis.setCurrentEditViewState( 'new' );\n\n\t\tif ( this.select_cells_Array.length > 1 ) {\n\t\t\tthis.is_mass_adding = true;\n\t\t}\n\n\t\t$this.openEditView();\n\n\t\tvar args;\n\t\tif ( !doing_save_and_new ) {\n\t\t\targs = this._createParametersForAdd();\n\t\t} else {\n\t\t\targs = [\n\t\t\t\t{\n\t\t\t\t\tuser_id: this.current_edit_record.user_id,\n\t\t\t\t\tbranch_id: this.current_edit_record.branch_id,\n\t\t\t\t\tdepartment_id: this.current_edit_record.department_id,\n\t\t\t\t\tjob_id: this.current_edit_record.job_id,\n\t\t\t\t\tjob_item_id: this.current_edit_record.job_item_id,\n\t\t\t\t\tdate: this.current_edit_record.date_stamp\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tthis.api['get' + this.api.key_name + 'DefaultData']( args, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tvar select_shift;\n\t\t\t\tvar result_data = result.getResult();\n\n\t\t\t\tselect_shift = result_data;\n\t\t\t\tif ( $this.select_cells_Array.length >= 1 ) {\n\t\t\t\t\tfor ( var i = 0, n = args.length; i < n; i++ ) {\n\t\t\t\t\t\tvar item = args[i];\n\t\t\t\t\t\tif ( i == 0 ) {\n\t\t\t\t\t\t\tselect_shift.branch_id = item.branch_id;\n\t\t\t\t\t\t\tselect_shift.department_id = item.department_id;\n\t\t\t\t\t\t\tselect_shift.job_id = item.job_id;\n\t\t\t\t\t\t\tselect_shift.job_item_id = item.job_item_id;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t( select_shift.branch_id !== item.branch_id && select_shift.branch_id !== '-2' ) ? select_shift.branch_id = '-2' : item.branch_id;\n\t\t\t\t\t\t\t( select_shift.department_id !== item.department_id && select_shift.department_id !== '-2' ) ? select_shift.department_id = '-2' : item.department_id;\n\t\t\t\t\t\t\t( select_shift.job_id !== item.job_id && select_shift.job_id !== '-2' ) ? select_shift.job_id = '-2' : item.job_id;\n\t\t\t\t\t\t\t( select_shift.job_item_id !== item.job_item_id && select_shift.job_item_id !== '-2' ) ? select_shift.job_item_id = '-2' : item.job_item_id;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !doing_save_and_new ) {\n\t\t\t\t\tselect_shift.date_stamp = $this.getSelectDate();\n\n\t\t\t\t} else {\n\t\t\t\t\tvar temp_date = Global.strToDate( $this.current_edit_record.date_stamp );\n\t\t\t\t\tselect_shift.date_stamp = new Date( new Date( temp_date.getTime() ).setDate( temp_date.getDate() + 1 ) ).format();\n\n\t\t\t\t}\n\n\t\t\t\tif ( !select_shift.start_date_stamp ) {\n\t\t\t\t\tselect_shift.start_date_stamp = select_shift.date_stamp;\n\t\t\t\t}\n\n\t\t\t\tselect_shift.id = '';\n\n\t\t\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t\t\t}\n\n\t\t\t\t$this.current_edit_record = select_shift;\n\t\t\t\t$this.initEditView();\n\n\t\t\t}\n\t\t} );\n\t}\n\n\topenEditView() {\n\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.initEditViewUI( 'Schedule', 'ScheduleEditView.html' );\n\t\t}\n\t\tthis.previous_absence_policy_id = false;\n\t}\n\n\t//set widget disablebility if view mode or edit mode\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean_dic = {};\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\twidget.css( 'opacity', 1 );\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tvar tab_id = column.parent().attr( 'id' );\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean_dic[tab_id] ) {\n\t\t\t\t\tdid_clean_dic[tab_id] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetJobValueWhenUserChanged( job, job_id_col_name, filter_data ) {\n\t\tvar $this = this;\n\n\t\t//Error: Uncaught TypeError: Cannot set property 'job_item_id' of null in /interface/html5/#!m=TimeSheet&date=20150126&user_id=54286 line 6785\n\t\tif ( !$this.current_edit_record ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.edit_view_ui_dic['user_ids'] && this.edit_view_ui_dic['user_ids'].is( ':visible' ) ) {\n\t\t\tfilter_data['user_id'] = this.edit_view_ui_dic['user_ids'].getValue();\n\n\t\t\t//If more than one user is selected, don't filter by user_id at all, show all jobs and let the validation system handle it.\n\t\t\tif ( filter_data['user_id'].length == 1 ) {\n\t\t\t\tfilter_data['user_id'] = filter_data['user_id'][0];\n\t\t\t} else {\n\t\t\t\tfilter_data['user_id'] = false;\n\t\t\t}\n\t\t} else {\n\t\t\tfilter_data['user_id'] = this.current_edit_record['user_id'];\n\t\t}\n\n\t\tvar job_widget = $this.edit_view_ui_dic[job_id_col_name];\n\t\tvar current_job_id = job_widget.getValue();\n\t\tjob_widget.setSourceData( null ); //Clear out source data so its reloaded when the Job dropdown is expanded again.\n\t\tjob_widget.setCheckBox( true );\n\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\n\t\tvar args = {};\n\t\targs.filter_data = filter_data;\n\t\t$this.edit_view_ui_dic[job_id_col_name].setDefaultArgs( args );\n\n\t\treturn;\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'status_id':\n\t\t\t\tthis.onTypeChange( true );\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\tcase 'user_ids':\n\t\t\t\tthis.setEditMenu();\n\n\t\t\t\tthis.setAbsencePolicyWhenUserChanged();\n\n\t\t\t\tif ( Global.getProductEdition() >= 20 && this.edit_view_ui_dic['job_id'] ) {\n\t\t\t\t\tthis.setJobValueWhenUserChanged( this.edit_view_ui_dic['job_id'].getValue( true ), 'job_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tuser_id: this.edit_view_ui_dic[key].getValue(),\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\tcase 'start_date_stamps':\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tthis.current_edit_record['start_date_stamp'] = c_value;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( key == 'absence_policy_id' ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.absence_policy_id;\n\t\t}\n\n\t\tif ( key === 'date_stamp' ||\n\t\t\tkey === 'start_date_stamps' ||\n\t\t\tkey === 'start_date_stamp' ||\n\t\t\tkey === 'start_time' ||\n\t\t\tkey === 'end_time' ||\n\t\t\tkey === 'schedule_policy_id' ||\n\t\t\tkey === 'absence_policy_id' ) {\n\n\t\t\tif ( this.current_edit_record['date_stamp'] !== '' &&\n\t\t\t\tthis.current_edit_record['start_time'] !== '' &&\n\t\t\t\tthis.current_edit_record['end_time'] !== '' ) {\n\n\t\t\t\tvar startTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['start_time'];\n\t\t\t\tvar endTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['end_time'];\n\t\t\t\tvar schedulePolicyId = this.current_edit_record['schedule_policy_id'];\n\t\t\t\tvar user_id = this.current_edit_record.user_id;\n\n\t\t\t\tthis.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, {\n\t\t\t\t\tonResult: function( total_time ) {\n\n\t\t\t\t\t\t//Uncaught TypeError: Cannot set property 'total_time' of null\n\t\t\t\t\t\t//Error: Uncaught TypeError: Cannot read property 'setValue' of undefined in interface/html5/#!m=Schedule&date=20160202&mode=week&a=new&tab=Schedule line 1799\n\t\t\t\t\t\tif ( !$this.edit_view || !$this.current_edit_record || !$this.edit_view_ui_dic['total_time'] ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//Fixed exception that total_time is null\n\t\t\t\t\t\tif ( total_time ) {\n\t\t\t\t\t\t\ttotal_time = total_time.getResult();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttotal_time = $this.current_edit_record.total_time ? $this.current_edit_record.total_time : 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$this.current_edit_record.total_time = total_time;\n\t\t\t\t\t\ttotal_time = Global.getTimeUnit( total_time );\n\t\t\t\t\t\t$this.edit_view_ui_dic['total_time'].setValue( total_time );\n\n\t\t\t\t\t\t$this.onAvailableBalanceChange();\n\n\t\t\t\t\t}\n\t\t\t\t} );\n//\n\n\t\t\t} else {\n\t\t\t\tthis.onAvailableBalanceChange();\n\t\t\t}\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetAbsencePolicyWhenUserChanged() {\n\n\t\tvar $this = this;\n\t\tvar absence_widget = $this.edit_view_ui_dic['absence_policy_id'];\n\t\tabsence_widget.setSourceData( null );\n\t\tvar old_value = absence_widget.getValue();\n\n\t\tvar args = {};\n\t\targs.filter_data = { id: old_value };\n\n\t\targs = this.setAbsencePolicyFilter( args );\n\n\t\tif ( old_value ) {\n\n\t\t\t$this.absence_policy_api.getAbsencePolicy( args, {\n\t\t\t\tonResult: function( task_result ) {\n\n\t\t\t\t\t// Returning early to help mitigate #2889 - \"Error: Uncaught TypeError: Cannot set property 'absence_policy_id' of null\"\n\t\t\t\t\t// This can happen when the user saves or leaves the page before the API call is completed.\n\t\t\t\t\tif ( $this.current_edit_record === null || $this.current_edit_record === undefined ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar data = task_result.getResult();\n\n\t\t\t\t\tif ( data.length > 0 ) {\n\t\t\t\t\t\tabsence_widget.setValue( old_value );\n\t\t\t\t\t\t$this.current_edit_record.absence_policy_id = old_value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tabsence_widget.setValue( false );\n\t\t\t\t\t\t$this.current_edit_record.absence_policy_id = false;\n\t\t\t\t\t}\n\t\t\t\t\t$this.onAvailableBalanceChange();\n\t\t\t\t\t$this.validate();\n\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\tthis.onAvailableBalanceChange();\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = {};\n\t\tif ( this.is_mass_adding ) {\n\t\t\trecord = [];\n\t\t\t$.each( this.select_cells_Array, function( index, value ) {\n\t\t\t\tif ( value.hasOwnProperty( 'user_id' ) && value.hasOwnProperty( 'date' ) && value.date ) {\n\t\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\t\tdelete commonRecord.user_ids;\n\t\t\t\t\tdelete commonRecord.start_dates;\n\t\t\t\t\tcommonRecord.id = '';\n\t\t\t\t\tcommonRecord.user_id = value.user_id;\n\t\t\t\t\tcommonRecord.start_date_stamp = value.date;\n\t\t\t\t\tcommonRecord = $this.buildMassAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else if ( this.is_mass_editing ) {\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\trecord[key] = widget.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( this.mass_edit_record_ids.length > 0 ) {\n\t\t\t\tvar checkFields = record;\n\t\t\t\trecord = [];\n\t\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\t\tvar commonRecord = Global.clone( checkFields );\n\t\t\t\t\tcommonRecord.id = value;\n\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t} );\n\t\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\t\tfor ( var key in checkFields ) {\n\t\t\t\t\t\t\tcommonRecord[key] = checkFields[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t} else {\n\t\t\t\tvar record_array = [];\n\t\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\t\tfor ( var key in record ) {\n\t\t\t\t\t\t\tcommonRecord[key] = record[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\t\trecord_array.push( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\tif ( record_array.length < 1 ) {\n\t\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t\t$this.processAddRecord( record );\n\t\t\t\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trecord = record_array;\n\t\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'indexOf' of undefined in interface/html5/#!m=Schedule&date=20151204&mode=day line 1954\n\t\t\tif ( this.current_edit_record && this.current_edit_record.start_date_stamp &&\n\t\t\t\t( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) ) {\n\t\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t\t}\n\t\t\t\trecord = [];\n\t\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t\t$this.processAddRecord( commonRecord );\n\t\t\t\t\t}\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\t\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t\t} else {\n\t\t\t\trecord = Global.clone( this.current_edit_record );\n\t\t\t\tif ( this.select_cells_Array.length > 0 ) {\n\t\t\t\t\t$this.processAddRecord( record );\n\t\t\t\t}\n\t\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t\t}\n\n\t\t}\n\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetRecordsFromUserIDs( record ) {\n\t\tvar result = [];\n\n\t\tfor ( var j = 0; j < record.length; j++ ) {\n\t\t\tvar common_record = record[j];\n\n\t\t\tif ( common_record.user_ids && common_record.user_ids.length > 0 ) {\n\t\t\t\tfor ( var y = 0; y < common_record.user_ids.length; y++ ) {\n\t\t\t\t\tvar user_id = common_record.user_ids[y];\n\t\t\t\t\tif ( Global.isObject( user_id ) && user_id.id ) {\n\t\t\t\t\t\tuser_id = user_id.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar new_common_record = Global.clone( common_record );\n\t\t\t\t\tnew_common_record.user_id = user_id;\n\t\t\t\t\tresult.push( new_common_record );\n\n\t\t\t\t}\n\t\t\t} else {\n\n\t\t\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing ) {\n\t\t\t\t\tcommon_record.user_id = TTUUID.zero_id;\n\t\t\t\t}\n\n\t\t\t\tresult.push( common_record );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tonSaveAndCopy( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_add = true;\n\t\tthis.is_changed = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_copy';\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t}\n\n\t\tthis.clearNavigationData();\n\t\tthis.api['set' + this.api.key_name]( record, false, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( $this.current_edit_record ) {\n\t\t\t\t\tvar current_date_str = $this.current_edit_record.start_date_stamp;\n\n\t\t\t\t\tif ( $.type( current_date_str ) === 'array' ) {\n\t\t\t\t\t\tcurrent_date_str = current_date_str[current_date_str.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar current_date = Global.strToDate( current_date_str );\n\t\t\t\t\tvar next_date = new Date( new Date( current_date.getTime() ).setDate( current_date.getDate() + 1 ) );\n\n\t\t\t\t\t$this.current_edit_record.start_date_stamp = next_date.format();\n\n\t\t\t\t\t$this.onSaveAndCopyResult( result );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveAndNewClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.onSaveAndNewResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildSelectedCellsRecord() {\n\t\tvar $this = this;\n\t\tvar retval = [];\n\t\t$.each( this.select_cells_Array, function( index, value ) {\n\t\t\tif ( value.hasOwnProperty( 'user_id' ) && value.hasOwnProperty( 'date' ) && value.date ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tdelete commonRecord.user_ids;\n\t\t\t\tdelete commonRecord.start_dates;\n\t\t\t\tcommonRecord.id = '';\n\t\t\t\tcommonRecord.user_id = value.user_id;\n\t\t\t\tcommonRecord.start_date_stamp = value.date;\n\t\t\t\tcommonRecord = $this.buildMassAddRecord( commonRecord );\n\n\t\t\t\tretval.push( commonRecord );\n\t\t\t}\n\n\t\t} );\n\n\t\treturn retval;\n\t}\n\n\tbuildMassAddRecord( record ) {\n\t\tvar massAddArgs = this._createParametersForAdd();\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\tif ( record.user_id === item.user_id ) {\n\t\t\t\trecord.branch_id == '-2' ? ( record.branch_id = item.branch_id ) : record.branch_id;\n\t\t\t\trecord.department_id == '-2' ? ( record.department_id = item.department_id ) : record.department_id;\n\t\t\t\trecord.job_id == '-2' ? ( record.job_id = item.job_id ) : record.job_id;\n\t\t\t\trecord.job_item_id == '-2' ? ( record.job_item_id = item.job_item_id ) : record.job_item_id;\n\t\t\t}\n\t\t}\n\t\treturn record;\n\t}\n\n\tprocessAddRecord( record ) {\n\t\tvar massAddArgs = this._createParametersForAdd();\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\trecord.branch_id == '-2' ? ( record.branch_id = item.branch_id ) : record.branch_id;\n\t\t\trecord.department_id == '-2' ? ( record.department_id = item.department_id ) : record.department_id;\n\t\t\trecord.job_id == '-2' ? ( record.job_id = item.job_id ) : record.job_id;\n\t\t\trecord.job_item_id == '-2' ? ( record.job_item_id = item.job_item_id ) : record.job_item_id;\n\t\t\tbreak;\n\t\t}\n\t\treturn record;\n\t}\n\n\tgetSelectedId( record, field, massAddArgs ) {\n\t\tfor ( var i = 0, n = massAddArgs.length; i < n; i++ ) {\n\t\t\tvar item = massAddArgs[i];\n\t\t\tif ( record.user_id === item.user_id ) {\n\t\t\t\trecord[field] = item[field];\n\t\t\t}\n\t\t}\n\t}\n\n\tonSaveAndContinue( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.is_changed = false;\n\t\tthis.is_add = false;\n\t\tLocalCacheData.current_doing_context_action = 'save_and_continue';\n\t\tvar record = this.current_edit_record;\n\t\trecord = this.processAddRecord( record );\n\t\trecord = this.uniformVariable( record );\n\n\t\tif ( this.current_edit_record.start_date_stamp && ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 || $.type( this.current_edit_record.start_date_stamp ) === 'array' ) ) {\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\t\t} else {\n\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.previous_absence_policy_id = false;\n\t\t\t\t$this.onSaveAndContinueResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\tvar $this = this;\n\t\tvar record;\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\n\t\tif ( this.is_mass_adding ) {\n\t\t\trecord = this.buildSelectedCellsRecord();\n\t\t} else if ( this.is_mass_editing ) {\n\n\t\t\tvar checkFields = this.getChangedFields();\n\n\t\t\trecord = [];\n\n\t\t\t$.each( this.mass_edit_record_ids, function( index, value ) {\n\t\t\t\tvar commonRecord = Global.clone( checkFields );\n\t\t\t\tcommonRecord.id = value;\n\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\n\t\t\t} );\n\n\t\t\t$.each( this.select_all_shifts_array, function( index, value ) {\n\t\t\t\tif ( !value.id || value.id == TTUUID.zero_id ) {\n\t\t\t\t\tvar commonRecord = Global.clone( value );\n\t\t\t\t\tfor ( var key in checkFields ) {\n\t\t\t\t\t\tcommonRecord[key] = checkFields[key];\n\t\t\t\t\t}\n\t\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\t\trecord.push( commonRecord );\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else if ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamp ) === 'array' ) {\n\n\t\t\tif ( this.current_edit_record.start_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\tthis.current_edit_record.start_date_stamp = this.parserDatesRange( this.current_edit_record.start_date_stamp );\n\t\t\t}\n\n\t\t\trecord = [];\n\t\t\tfor ( var i = 0; i < this.current_edit_record.start_date_stamp.length; i++ ) {\n\t\t\t\tvar commonRecord = Global.clone( $this.current_edit_record );\n\t\t\t\tcommonRecord.start_date_stamp = this.current_edit_record.start_date_stamp[i];\n\t\t\t\tcommonRecord = $this.processAddRecord( commonRecord );\n\t\t\t\trecord.push( commonRecord );\n\t\t\t}\n\n\t\t\trecord = this.getRecordsFromUserIDs( record );\n\n\t\t} else {\n\n\t\t\trecord = this.current_edit_record;\n\t\t\trecord = $this.processAddRecord( record );\n\t\t\trecord = this.getRecordsFromUserIDs( [record] );\n\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\tvar result_data = result.getResult();\n\t\t\t\t\t//#2571 - Cannot read property 'id' of null\n\t\t\t\t\tif ( result_data === true && $this.current_edit_record ) {\n\t\t\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t\t$this.refresh_id = result_data;\n\t\t\t\t\t}\n\t\t\t\t\t$this.search();\n\t\t\t\t\t$this.previous_absence_policy_id = false;\n\n\t\t\t\t\t$this.removeEditView();\n\n\t\t\t\t} else {\n\t\t\t\t\t//BUG#2073 - Pulled out the error message box that was showing the result array as its \"toString\" representation. ([object][object]);\n\t\t\t\t\t$this.setErrorTips( result );\n\t\t\t\t\t$this.setErrorMenu();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tremoveEditView() {\n\t\tsuper.removeEditView();\n\n\t\tthis.selected_user_ids = [];\n\t\tthis.is_mass_adding = false;\n\t}\n\n\tsetEditMenuSaveAndContinueIcon( context_btn, pId ) {\n\t\tthis.saveAndContinueValidate( context_btn );\n\n\t\tif ( this.is_mass_editing || this.is_viewing || this.is_mass_adding || this.isMassEmployeeOrDate() ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tisMassEmployeeOrDate() {\n\n\t\tif ( this.current_edit_record && this.current_edit_record.start_date_stamps && ( this.current_edit_record.start_date_stamps.indexOf( ' - ' ) > 0 ||\n\t\t\t$.type( this.current_edit_record.start_date_stamps ) === 'array' && this.current_edit_record.start_date_stamps.length > 1\n\t\t) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif ( this.current_edit_record && this.current_edit_record.user_ids && this.current_edit_record.user_ids.length > 1 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tsetEditMenuSaveAndAddIcon( context_btn, pId ) {\n\t\tthis.saveAndNewValidate( context_btn );\n\n\t\tif ( this.is_viewing || this.is_mass_editing || this.is_mass_adding ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuSaveAndCopyIcon( context_btn, pId ) {\n\t\tthis.saveAndCopyValidate( context_btn );\n\n\t\tif ( this.is_viewing || this.is_mass_editing || this.is_mass_adding ) {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonTypeChange( getRate ) {\n\t\tif ( this.current_edit_record.status_id == 20 ) {\n\t\t\tthis.attachElement( 'absence_policy_id' );\n\t\t} else {\n\t\t\tthis.detachElement( 'absence_policy_id' );\n\t\t}\n\t}\n\n\tsetEditViewData() {\n\n\t\tvar $this = this;\n\t\tsuper.setEditViewData(); //Set Navigation\n\t\t$this.onTypeChange( false );\n\t}\n\n\tcheckOpenPermission() {\n\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( 'schedule', 'view_open' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetOtherFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tvar $this = this;\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tthis.edit_view_close_icon = this.edit_view.find( '.close-icon' );\n\t\tthis.edit_view_close_icon.hide();\n\t\tthis.edit_view_close_icon.click( function() {\n\t\t\t$this.onCloseIconClick();\n\t\t} );\n\n\t\tvar tab_model = {\n\t\t\t'tab_schedule': { 'label': $.i18n._( 'Schedule' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_schedule = this.edit_view_tab.find( '#tab_schedule' );\n\n\t\tvar tab_schedule_column1 = tab_schedule.find( '.first-column' );\n\n\t\t//Employee\n\n\t\tvar production_edition_id = Global.getProductEdition();\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_open: this.checkOpenPermission(),\n\t\t\tfield: 'user_id'\n\t\t} );\n\n\t\tvar default_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Mass Add Employees\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_open: this.checkOpenPermission(),\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t} ),\n\t\t\tfield: 'user_ids'\n\t\t} );\n\n\t\tdefault_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Status\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'start_date_stamp', validation_field: 'date_stamp' } );\n\n\t\t//widgetContainer = $( \"<div class='widget-h-box'></div>\" );\n\t\t//var label = $( \"<span class='widget-right-label'>\" + $.i18n._( 'ie' ) + ': ' + LocalCacheData.loginUserPreference.date_format_display + \"</span>\" );\n\t\t//\n\t\t//widgetContainer.append( form_item_input );\n\t\t//widgetContainer.append( label );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Dates\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TRangePicker( { field: 'start_date_stamps' } );\n\n\t\t//widgetContainer = $( \"<div class='widget-h-box'></div>\" );\n\t\t//label = $( \"<span class='widget-right-label'>\" + $.i18n._( 'ie' ) + ': ' + LocalCacheData.loginUserPreference.date_format_display + \"</span>\" );\n\t\t//\n\t\t//widgetContainer.append( form_item_input );\n\t\t//widgetContainer.append( label );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_option_column',\n\t\t\tshow_search_inputs: false,\n\t\t\tset_empty: true,\n\t\t\tfield: 'start_dates'\n\t\t} );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Start Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'start_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//End Time\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\t\tform_item_input.TTimePicker( { field: 'end_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Out' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Total\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'total_time' } );\n\t\tform_item_input.css( 'cursor', 'pointer' );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Total' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Schedule Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'schedule_policy_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Schedule Policy' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Absence Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Absence Policy' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t//Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\tthis.available_balance_info = $( '<img class=\"available-balance-info\" src=\"' + Global.getRealImagePath( 'images/infox16x16.png' ) + '\">' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( this.available_balance_info );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), form_item_input, tab_schedule_column1, '', widgetContainer, true );\n\n\t\tif ( !this.current_edit_record || ( this.current_edit_record.user_ids && this.current_edit_record.user_ids.length > 1 ) ) {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\n\t\t//Default Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\t//FIXME: Follow -2 to the API do not switch to UUID unless absolutely necessary?\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\n\t\t}\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t//Job Item\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t\t{ value: '-2', label: Global.selected_item }\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_schedule_column1, '', null, null, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tTTPromise.resolve( 'Schedule', 'init' );\n\t}\n\n\tsetDefaultMenuDeleteIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( !this.deletePermissionValidate( pId ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length > 0 && this.deleteOwnerOrChildPermissionValidate( pId ) ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonAvailableBalanceChange() {\n\t\tif ( this.current_edit_record.status_id == 20\n\t\t\t&& this.current_edit_record.hasOwnProperty( 'absence_policy_id' )\n\t\t\t&& this.current_edit_record.absence_policy_id && !this.is_mass_editing ) {\n\t\t\tthis.getAvailableBalance();\n\t\t} else {\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\n\t\tresultArray.push( dates[1] );\n\n\t\treturn resultArray;\n\t}\n\n\tgetSelectUsersArray() {\n\t\tvar result = [];\n\t\tvar cells_array = this.select_cells_Array;\n\t\tvar len = cells_array.length;\n\t\tvar date_dic = {};\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\n\t\t\t// If select empty cell with no user inside, set user_id to 0 as OPEN\n\t\t\tif ( !item.user_id ) {\n\t\t\t\titem.user_id = TTUUID.zero_id;\n\t\t\t}\n\n\t\t\tdate_dic[item.user_id] = true;\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\tif ( result.length === 0 ) {\n\t\t\tresult.push( this.getDefaultUser() );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetSelectDateArray() {\n\t\tvar result = [];\n\n\t\tvar cells_array = this.select_cells_Array;\n\n\t\tvar len = cells_array.length;\n\n\t\tvar date_dic = {};\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = cells_array[i];\n\n\t\t\tif ( item.date ) {\n\t\t\t\tdate_dic[item.date] = true;\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var key in date_dic ) {\n\t\t\tresult.push( key );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetAvailableBalance() {\n\t\tvar $this = this;\n\t\tvar user_id = this.current_edit_record.user_id;\n\t\tvar total_time = this.current_edit_record.total_time;\n\t\tvar last_date_stamp = this.current_edit_record.start_date_stamp;\n\n\t\t//On first run, set previous_absence_policy_id.\n\t\tif ( this.previous_absence_policy_id == false ) {\n\t\t\tthis.previous_absence_policy_id = this.current_edit_record.absence_policy_id;\n\t\t}\n\n\t\t//For mass adding case, select multiple cells and click new\n\t\tif ( this.is_mass_adding ) {\n\t\t\tif ( this.current_edit_record.user_ids.length > 1 ) {\n\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tuser_id = this.current_edit_record.user_ids[0];\n\t\t\t\tif ( !user_id ) {\n\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttotal_time = total_time * this.current_edit_record.start_dates.length;\n\t\t\tlast_date_stamp = this.current_edit_record.start_dates[this.current_edit_record.start_dates.length - 1];\n\t\t} else {\n\t\t\t//get dates from date ranger\n\t\t\tif ( last_date_stamp.indexOf( ' - ' ) > 0 || $.type( last_date_stamp ) === 'array' ) {\n\t\t\t\tif ( last_date_stamp.indexOf( ' - ' ) > 0 ) {\n\t\t\t\t\tlast_date_stamp = this.parserDatesRange( last_date_stamp );\n\t\t\t\t}\n\n\t\t\t\tif ( last_date_stamp.length > 0 ) {\n\t\t\t\t\ttotal_time = total_time * last_date_stamp.length;\n\t\t\t\t\tlast_date_stamp = last_date_stamp[last_date_stamp.length - 1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing ) {\n\t\t\t\tif ( this.current_edit_record.user_ids.length < 1 || this.current_edit_record.user_ids.length > 1 ) {\n\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\tuser_id = this.current_edit_record.user_ids[0];\n\t\t\t\t\tif ( !user_id ) {\n\t\t\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//Check if the user is editing a existing record that was originally Status=Working, and changing it to Status=Absent, in that case we can't adjust for the existing total time and must clear it out.\n\t\tif ( this.current_edit_record && this.current_edit_record.id && this.prev_status_id == 10 && this.edit_view_ui_dic['status_id'].getValue() == 20 ) {\n\t\t\tthis.prev_total_time = 0;\n\t\t}\n\n\t\tif ( this.current_edit_record.absence_policy_id != TTUUID.zero_id ) {\n\t\t\tthis.api_absence_policy.getProjectedAbsencePolicyBalance(\n\t\t\t\tthis.current_edit_record.absence_policy_id,\n\t\t\t\tuser_id,\n\t\t\t\tlast_date_stamp,\n\t\t\t\ttotal_time,\n\t\t\t\tthis.prev_total_time,\n\t\t\t\tthis.previous_absence_policy_id, {\n\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t$this.getBalanceHandler( result, last_date_stamp );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tthis.getBalanceHandler( false, last_date_stamp );\n\t\t}\n\t}\n\n\tbuildSearchAndLayoutUI() {\n\t\tvar layout_div = this.search_panel.find( 'div #saved_layout_content_div' );\n\n\t\t//Display Columns\n\n\t\tvar form_item = $( Global.loadWidget( 'global/widgets/search_panel/FormItem.html' ) );\n\t\tvar form_item_label = form_item.find( '.form-item-label' );\n\t\tvar form_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tvar column_selector = Global.loadWidget( 'global/widgets/awesomebox/ADropDown.html' );\n\t\tthis.column_selector = $( column_selector );\n\n\t\tthis.column_selector = this.column_selector.ADropDown( {\n\t\t\tdisplay_show_all: false,\n\t\t\tid: 'column_selector',\n\t\t\tkey: 'value',\n\t\t\tallow_drag_to_order: true,\n\t\t\tdisplay_close_btn: false,\n\t\t\tdisplay_column_settings: false,\n\t\t\tstatic_height: 150\n\t\t} );\n\n\t\tform_item_label.text( $.i18n._( 'Display Columns' ) + ':' );\n\t\tform_item_input_div.append( this.column_selector );\n\n\t\tlayout_div.append( form_item );\n\n\t\tlayout_div.append( '<div class=\\'clear-both-div\\'></div>' );\n\n\t\tthis.column_selector.setColumns( [\n\t\t\t{ name: 'label', index: 'label', label: $.i18n._( 'Column Name' ), width: 100, sortable: false }\n\t\t] );\n\n\t\t//Save and update layout\n\n\t\tform_item = $( Global.loadWidget( 'global/widgets/search_panel/FormItem.html' ) );\n\t\tform_item_label = form_item.find( '.form-item-label' );\n\t\tform_item_input_div = form_item.find( '.form-item-input-div' );\n\n\t\tform_item_label.text( $.i18n._( 'Save Search As' ) + ': ' );\n\n\t\tthis.save_search_as_input = Global.loadWidget( 'global/widgets/text_input/TTextInput.html' );\n\t\tthis.save_search_as_input = $( this.save_search_as_input );\n\t\tthis.save_search_as_input.TTextInput();\n\n\t\tvar save_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Save' ) + '\\'></input>' );\n\n\t\tform_item_input_div.append( this.save_search_as_input );\n\t\tform_item_input_div.append( save_btn );\n\n\t\tvar $this = this;\n\t\tsave_btn.click( function() {\n\t\t\t$this.onSaveNewLayout();\n\t\t} );\n\n\t\t//Previous Saved Layout\n\n\t\tthis.previous_saved_layout_div = $( '<div class=\\'previous-saved-layout-div\\'></div>' );\n\n\t\tform_item_input_div.append( this.previous_saved_layout_div );\n\n\t\tform_item_label = $( '<span style=\\'margin-left: 5px\\' >' + $.i18n._( 'Previous Saved Searches' ) + ':</span>' );\n\t\tthis.previous_saved_layout_div.append( form_item_label );\n\n\t\tthis.previous_saved_layout_selector = $( '<select style=\\'margin-left: 5px\\' class=\\'t-select\\'>' );\n\t\tvar update_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Update' ) + '\\'></input>' );\n\t\tvar del_btn = $( '<input class=\\'t-button\\' style=\\'margin-left: 5px\\' type=\\'button\\' value=\\'' + $.i18n._( 'Delete' ) + '\\'></input>' );\n\n\t\tupdate_btn.click( function() {\n\t\t\t$this.onUpdateLayout();\n\t\t} );\n\n\t\tdel_btn.click( function() {\n\t\t\t$this.onDeleteLayout();\n\t\t} );\n\n\t\tthis.previous_saved_layout_div.append( this.previous_saved_layout_selector );\n\t\tthis.previous_saved_layout_div.append( update_btn );\n\t\tthis.previous_saved_layout_div.append( del_btn );\n\n\t\tlayout_div.append( form_item );\n\n\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t}\n\n\tsetCurrentEditRecordData() {\n\n\t\tif ( this.is_mass_adding ) {\n\t\t\tthis.attachElement( 'start_dates' );\n\t\t\tthis.detachElement( 'start_date_stamp' );\n\t\t\tthis.detachElement( 'start_date_stamps' );\n\n\t\t\tthis.attachElement( 'user_ids' );\n\t\t\tthis.detachElement( 'user_id' );\n\n\t\t\tthis.edit_view_ui_dic.start_dates.setEnabled( false );\n\t\t\tthis.edit_view_ui_dic.user_ids.setEnabled( false );\n\n\t\t} else {\n\t\t\tthis.detachElement( 'start_dates' );\n\n\t\t\tif ( ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) || this.is_mass_editing ) {\n\t\t\t\tthis.attachElement( 'start_date_stamp' );\n\t\t\t\tthis.detachElement( 'start_date_stamps' );\n\t\t\t\tthis.detachElement( 'user_ids' );\n\t\t\t\tthis.attachElement( 'user_id' );\n\n\t\t\t} else {\n\t\t\t\tthis.attachElement( 'start_date_stamps' );\n\t\t\t\tthis.detachElement( 'start_date_stamp' );\n\t\t\t\tthis.current_edit_record.start_date_stamps = this.current_edit_record.start_date_stamp;\n\n\t\t\t\tthis.attachElement( 'user_ids' );\n\t\t\t\tthis.detachElement( 'user_id' );\n\t\t\t}\n\n\t\t}\n\n\t\tthis.prev_total_time = 0;\n\n\t\t//When editing an existing record, store the original status_id so we can later use it when calculating available balance.\n\t\tif ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\tthis.prev_status_id = this.current_edit_record['status_id'];\n\t\t}\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_ids':\n\t\t\t\t\t\tif ( widget.is( ':visible' ) ) {\n\t\t\t\t\t\t\tvar user_array = this.getSelectUsersArray();\n\t\t\t\t\t\t\tthis.current_edit_record[key] = user_array;\n\t\t\t\t\t\t\twidget.setValue( user_array );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'start_dates':\n\t\t\t\t\t\tvar date_array = this.getSelectDateArray();\n\t\t\t\t\t\tthis.current_edit_record[key] = date_array;\n\t\t\t\t\t\tdate_array = Global.buildRecordArray( date_array );\n\n\t\t\t\t\t\twidget.setSourceData( date_array );\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\t//Don't set when copy as new\n\t\t\t\t\t\tif ( this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\t\t\t\t\tthis.prev_total_time = this.current_edit_record[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar startTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['start_time'];\n\t\t\t\t\t\tvar endTime = this.current_edit_record['date_stamp'] + ' ' + this.current_edit_record['end_time'];\n\t\t\t\t\t\tvar schedulePolicyId = this.current_edit_record['schedule_policy_id'];\n\t\t\t\t\t\tvar user_id = this.current_edit_record.user_id;\n\t\t\t\t\t\tvar total_time = this.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, { async: false } );\n\t\t\t\t\t\t// Error: Uncaught TypeError: Cannot read property 'getResult' of undefined in interface/html5/#!m=Schedule&date=20160201&mode=week&a=new&tab=Schedule\n\t\t\t\t\t\ttotal_time ? ( total_time = total_time.getResult() ) : total_time = false;\n\t\t\t\t\t\tthis.current_edit_record.total_time = total_time;\n\t\t\t\t\t\twidget.setValue( Global.getTimeUnit( total_time ) );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar user_id = false;\n\t\t\t\t\t\t\tif ( this.edit_view_ui_dic['user_ids'] && this.edit_view_ui_dic['user_ids'].is( ':visible' ) ) {\n\t\t\t\t\t\t\t\tuser_id = this.getSelectUsersArray();\n\n\t\t\t\t\t\t\t\t//If more than one user is selected, don't filter by user_id at all, show all jobs and let the validation system handle it.\n\t\t\t\t\t\t\t\tif ( user_id.length == 1 ) {\n\t\t\t\t\t\t\t\t\tuser_id = user_id[0];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tuser_id = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tuser_id = this.current_edit_record['user_id'];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, user_id: user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.onAvailableBalanceChange();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tif ( !this.is_mass_editing ) {\n\n\t\t\tif ( !this.current_edit_record || !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record.user_ids;\n\t\t\t} else {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( this.edit_view_ui_dic.user_id.isChecked() ) {\n\t\t\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\t\t} else {\n\t\t\t\tfilter.filter_data.user_id = this.selected_user_ids;\n\t\t\t}\n\n\t\t}\n\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tsetDefaultMenuCopyIcon( context_btn, grid_selected_length, is_year_mode ) {\n\t\tif ( !this.copyPermissionValidate() || is_year_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuSaveAndAddIcon( context_btn, grid_selected_length, is_year_mode ) {\n\t\tif ( ( !this.addPermissionValidate() && !this.editPermissionValidate() ) || is_year_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuSaveAndCopyIcon( context_btn, grid_selected_length, is_year_mode ) {\n\t\tif ( ( !this.addPermissionValidate() && !this.editPermissionValidate() ) || is_year_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length, is_year_mode ) {\n\t\tif ( ( !this.copyAsNewPermissionValidate() ) || is_year_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenu() {\n\t\tthis.selectContextMenu();\n\t\tvar len = this.context_menu_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tif ( this.is_mass_editing || this.is_mass_adding ) {\n\t\t\t\tswitch ( id ) {\n\t\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setEditMenuAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setEditMenuEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setEditMenuViewIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setEditMenuMassEditIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setEditMenuCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setEditMenuDeleteIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setEditMenuDeleteAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setEditMenuSaveIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setEditMenuSaveAndContinueIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setEditMenuSaveAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setEditMenuSaveAndNextIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setEditMenuSaveAndCopyIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setEditMenuCopyAndAddIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.import_icon:\n\t\t\t\t\tthis.setEditMenuImportIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.find_available:\n\t\t\t\t\tthis.setEditMenuFindAvailableIcon( context_btn );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\t_getGridSelectedLength() {\n\t\tvar result = 0;\n\t\tresult = this.select_all_shifts_array.length;\n\n\t\treturn result;\n\t}\n\n\tsetDefaultMenu( doNotSetFocus ) {\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t\tthis.selectContextMenu();\n\t\t}\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Client line 308\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_length = this._getGridSelectedLength();\n\n\t\tvar is_year_mode = false;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.add:\n\t\t\t\t\tthis.setDefaultMenuAddIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.view:\n\t\t\t\t\tthis.setDefaultMenuViewIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.mass_edit:\n\t\t\t\t\tthis.setDefaultMenuMassEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setDefaultMenuCopyIcon( context_btn, grid_selected_length, is_year_mode );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setDefaultMenuDeleteIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setDefaultMenuSaveAndContinueIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_new:\n\t\t\t\t\tthis.setDefaultMenuSaveAndAddIcon( context_btn, grid_selected_length, is_year_mode );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_copy:\n\t\t\t\t\tthis.setDefaultMenuSaveAndCopyIcon( context_btn, grid_selected_length, is_year_mode );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy_as_new:\n\t\t\t\t\tthis.setDefaultMenuCopyAsNewIcon( context_btn, grid_selected_length, is_year_mode );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.move:\n\t\t\t\t\tif ( !this.movePermissionValidate() ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.drag_copy:\n\t\t\t\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.swap:\n\t\t\t\t\tif ( !this.editPermissionValidate() ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.override:\n\t\t\t\t\tif ( ( !this.editPermissionValidate() && !this.movePermissionValidate() && !this.copyPermissionValidate() ) ) {\n\t\t\t\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_employee:\n\t\t\t\t\tthis.setDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.import_icon:\n\t\t\t\t\tthis.setDefaultMenuImportIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.timesheet:\n\t\t\t\t\tthis.setDefaultMenuEditTimesheetIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.find_available:\n\t\t\t\t\tthis.setDefaultMenuFindAvailabletIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AutoPunch':\n\t\t\t\t\tthis.setAutoPunchIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'AddRequest':\n\t\t\t\t\tthis.setAddRequestIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tenableAddRequestButton() {\n\t\tvar schedules = [];\n\t\t//var grid_selected_id_array = this.getGridSelectIdArray();\n\t\tif ( !this.select_cellls_and_shifts_array ) {\n\t\t\treturn false;\n\t\t}\n\t\tvar grid_selected_id_array = this.select_cellls_and_shifts_array;\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tif ( grid_selected_length == 1 ) {\n\t\t\treturn true;\n\t\t}\n\t\tif ( grid_selected_length == 0 ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar schedules = this.select_cells_Array;\n\t\tvar first = schedules[0];\n\n\t\tfor ( var n = 1; n < schedules.length; n++ ) {\n\t\t\tif ( schedules[n].user_id && first.user_id != schedules[n].user_id ) {\n\t\t\t\tDebug.Text( 'mismatch on user_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t//do not test blank cells beyond user_id\n\t\t\tif ( schedules[n].shift == undefined ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( ( first.shift && schedules[n].shift ) ) {\n\t\t\t\tif ( first.shift.start_time != schedules[n].shift.start_time ) {\n\t\t\t\t\tDebug.Text( 'mismatch on start_time', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.end_time != schedules[n].shift.end_time ) {\n\t\t\t\t\tDebug.Text( 'mismatch on end_time', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.branch_id != schedules[n].shift.branch_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on branch_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.department_id != schedules[n].shift.department_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on department_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.job_id != schedules[n].shift.job_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on job_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.job_item_id != schedules[n].shift.job_item_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on job_item_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( first.shift.schedule_policy_id != schedules[n].shift.schedule_policy_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on schedule_policy_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ( first.shift.status_id != schedules[n].shift.status_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on status_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif ( first.shift.status_id == 20 && first.shift.absence_policy_id != schedules[n].shift.absence_policy_id ) {\n\t\t\t\t\tDebug.Text( 'mismatch on absence_policy_id', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t//if the first one is a blank in a selection that includes shifts, we need to update the compared record to one with a shift.\n\t\t\t} else if ( first.shift == undefined && schedules[n].shift ) {\n\t\t\t\tfirst = schedules[n];\n\t\t\t}\n\t\t}\n\n\t\tDebug.Text( 'All Selected Schedules Match', 'ScheduleViewController.js', 'ScheduleViewController', 'enableAddRequestButton', 10 );\n\t\treturn true;\n\t}\n\n\tsetAutoPunchIcon( context_btn, grid_selected_length ) {\n\t\tif ( grid_selected_length > 0 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetEditMenuFindAvailableIcon( context_btn ) {\n\t\tcontext_btn.addClass( 'disable-image' );\n\t}\n\n\tsetDefaultMenuFindAvailabletIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !this.editChildPermissionValidate() ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( grid_selected_length >= 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditTimesheetIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( this.select_cells_Array.length === 1 && TTUUID.isUUID( this.select_cells_Array[0].user_id ) && this.select_cells_Array[0].user_id != TTUUID.zero_id ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tsetDefaultMenuEditEmployeeIcon( context_btn, grid_selected_length, pId ) {\n\n\t\tif ( !this.editChildPermissionValidate( 'user' ) ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.select_cells_Array.length === 1 && TTUUID.isUUID( this.select_cells_Array[0].user_id ) && this.select_cells_Array[0].user_id != TTUUID.zero_id ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonUpdateLayout() {\n\n\t\tvar selectId = $( this.previous_saved_layout_selector ).children( 'option:selected' ).attr( 'value' );\n\t\tvar layout_name = $( this.previous_saved_layout_selector ).children( 'option:selected' ).text();\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.id = selectId;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.strict_range_btn.getValue();\n\t\targs.data.weeklyTotals = this.weekly_totals_btn.getValue();\n\t\targs.data.dailyTotals = this.daily_totals_btn.getValue();\n\t\targs.data.showAllEmp = this.all_employee_btn.getValue();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonSaveNewLayout( default_layout_name ) {\n\n\t\tif ( Global.isSet( default_layout_name ) ) {\n\t\t\tvar layout_name = default_layout_name;\n\t\t} else {\n\t\t\tlayout_name = this.save_search_as_input.getValue();\n\t\t}\n\n\t\tif ( !layout_name || layout_name.length < 1 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.script = this.script_name;\n\t\targs.name = layout_name;\n\t\targs.is_default = false;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.strict_range_btn.getValue();\n\t\targs.data.weeklyTotals = this.weekly_totals_btn.getValue();\n\t\targs.data.dailyTotals = this.daily_totals_btn.getValue();\n\t\targs.data.showAllEmp = this.all_employee_btn.getValue();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t} else {\n\t\t\t\t\tTAlertManager.showErrorAlert( res );\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tonClearSearch() {\n\t\tvar do_update = false;\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tvar default_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\t\t\tdo_update = true;\n\n\t\t} else {\n\n\t\t\tthis.clearSearchPanel();\n\t\t\tthis.filter_data = null;\n\t\t\tthis.temp_adv_filter_data = null;\n\t\t\tthis.temp_basic_filter_data = null;\n\n\t\t\tthis.column_selector.setSelectGridData( this.default_display_columns );\n\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tif ( do_update ) {\n\t\t\tvar args = {};\n\t\t\targs.id = default_layout_id;\n\t\t\targs.data = {};\n\t\t\targs.data.display_columns = selected_display_columns;\n\t\t\targs.data.filter_data = filter_data;\n\t\t}\n\n\t\targs.data.mode = this.getMode();\n\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetSearchPanelDisplayColumns() {\n\t\tvar display_columns = [];\n\n\t\tvar select_items = this.column_selector.getSelectItems();\n\n\t\tif ( select_items && select_items.length > 0 ) {\n\t\t\t$.each( select_items, function( index, content ) {\n\t\t\t\tdisplay_columns.push( content.value );\n\t\t\t} );\n\t\t}\n\n\t\treturn display_columns;\n\t}\n\n\tonSearch() {\n\t\tthis.temp_adv_filter_data = null;\n\t\tthis.temp_basic_filter_data = null;\n\n\t\tthis.getSearchPanelFilter();\n\n\t\tif ( this.search_panel.getLayoutsArray() && this.search_panel.getLayoutsArray().length > 0 ) {\n\t\t\tvar default_layout_id = $( this.previous_saved_layout_selector ).children( 'option:contains(\\'' + BaseViewController.default_layout_name + '\\')' ).attr( 'value' );\n\n\t\t\tif ( !default_layout_id ) {\n\t\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar layout_name = BaseViewController.default_layout_name;\n\n\t\t} else {\n\t\t\tthis.onSaveNewLayout( BaseViewController.default_layout_name );\n\t\t\treturn;\n\t\t}\n\n\t\tvar selected_display_columns = this.getSearchPanelDisplayColumns();\n\t\tvar filter_data = this.getValidSearchFilter();\n\n\t\tvar args = {};\n\t\targs.id = default_layout_id;\n\t\targs.data = {};\n\t\targs.data.display_columns = selected_display_columns;\n\t\targs.data.filter_data = filter_data;\n\t\targs.data.mode = Global.upCaseFirstLetter( this.getMode() );\n\t\targs.data.strictRange = this.strict_range_btn.getValue();\n\t\targs.data.weeklyTotals = this.weekly_totals_btn.getValue();\n\t\targs.data.dailyTotals = this.daily_totals_btn.getValue();\n\t\targs.data.showAllEmp = this.all_employee_btn.getValue();\n\n\t\tProgressBar.showOverlay();\n\t\tvar $this = this;\n\t\tthis.user_generic_data_api.setUserGenericData( args, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tif ( res.isValid() ) {\n\t\t\t\t\t$this.clearViewLayoutCache();\n\t\t\t\t\t$this.need_select_layout_name = layout_name;\n\n\t\t\t\t\t$this.initLayout();\n\t\t\t\t}\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsetSelectLayout() {\n\n\t\tvar $this = this;\n\n\t\tif ( !this.select_layout ) { //Set to defalt layout if no layout at all\n\t\t\tthis.select_layout = { id: '' };\n\t\t\tthis.select_layout.data = { filter_data: {}, filter_sort: {} };\n\t\t\tthis.select_layout.data.display_columns = this.default_display_columns;\n\t\t}\n\n\t\tvar layout_data = this.select_layout.data;\n\n\t\tvar display_columns = this.buildDisplayColumns( layout_data.display_columns );\n\n\t\tif ( Global.isSet( layout_data.mode ) ) {\n\t\t\t$this.setToggleButtonValue( layout_data.mode.toLowerCase() );\n\t\t} else if ( LocalCacheData.getAllURLArgs() && LocalCacheData.getAllURLArgs().mode ) {\n\t\t\t$this.setToggleButtonValue( LocalCacheData.getAllURLArgs().mode );\n\t\t} else {\n\t\t\t$this.setToggleButtonValue( ScheduleViewControllerMode.WEEK );\n\t\t}\n\n\t\t// if ( Global.isSet( layout_data.strictRange ) ) {\n\t\t// \t$this.strict_range_btn.setValue( layout_data.strictRange );\n\t\t// }\n\t\t//\n\t\t// if ( Global.isSet( layout_data.weeklyTotals ) ) {\n\t\t// \t$this.weekly_totals_btn.setValue( layout_data.weeklyTotals );\n\t\t// }\n\t\t//\n\t\t// if ( Global.isSet( layout_data.dailyTotals ) ) {\n\t\t// \t$this.daily_totals_btn.setValue( layout_data.dailyTotals );\n\t\t// }\n\t\t//\n\t\t// if ( Global.isSet( layout_data.showAllEmp ) ) {\n\t\t// \t$this.all_employee_btn.setValue( layout_data.showAllEmp );\n\t\t// }\n\n\t\t//Set Display Column in layout panel\n\t\tthis.column_selector.setSelectGridData( display_columns );\n\n\t\t//Set Previoous Saved layout combobox in layout panel\n\t\tvar layouts_array = this.search_panel.getLayoutsArray();\n\n\t\tthis.previous_saved_layout_selector.empty();\n\t\tif ( layouts_array && layouts_array.length > 0 ) {\n\t\t\tthis.previous_saved_layout_div.css( 'display', 'inline' );\n\n\t\t\tvar len = layouts_array.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = layouts_array[i];\n\t\t\t\tthis.previous_saved_layout_selector.append( $( '<option value=\"' + item.id + '\"></option>' ).text( item.name ) );\n\t\t\t}\n\t\t\t$( this.previous_saved_layout_selector.find( 'option' ) ).filter( function() {\n\t\t\t\treturn $( this ).attr( 'value' ) === $this.select_layout.id;\n\t\t\t} ).prop( 'selected', true ).attr( 'selected', true );\n\n\t\t} else {\n\t\t\tthis.previous_saved_layout_div.css( 'display', 'none' );\n\t\t}\n\n\t\tif ( LocalCacheData.default_filter_for_next_open_view ) {\n\t\t\tthis.select_layout.data.filter_data = LocalCacheData.default_filter_for_next_open_view.filter_data;\n\n\t\t\tthis.setDatePickerValue( LocalCacheData.default_filter_for_next_open_view.select_date );\n\n\t\t\tthis.select_layout.data.mode = 'Week';\n\t\t\t$this.setToggleButtonValue( layout_data.mode.toLowerCase() );\n\n\t\t\tLocalCacheData.default_filter_for_next_open_view = null;\n\t\t}\n\n\t\tthis.filter_data = this.select_layout.data.filter_data;\n\n\t\tthis.setSearchPanelFilter( true );\n\t}\n\n\tgetMode() {\n\t\tif ( this.toggle_button ) {\n\t\t\treturn this.toggle_button.getValue();\n\t\t}\n\t}\n\n\tsearch( setDefaultMenu, use_date_picker_date ) {\n\t\tthis.clearSelection(); //Clear selection on search, as we aren't re-populating it anyways, and causes a problem if you select 2 cells, click top-right refresh icon, then click New icon, it thinks the selection still exists.\n\t\tthis.setActionsButtonStatus();\n\t\tthis.final_schedule_data_array = [];\n\n\t\tvar $this = this;\n\t\tvar filter_data = Global.convertLayoutFilterToAPIFilter( this.select_layout );\n\t\tvar start_date_string;\n\n\t\tvar mode = this.getMode();\n\n\t\tif ( this.all_employee_btn.getValue() ) {\n\t\t\tfilter_data.include_all_users = true;\n\t\t}\n\n\t\tvar strict = this.strict_range_btn.getValue();\n\n\t\tif ( use_date_picker_date || !this.end_date || ( setDefaultMenu === undefined && use_date_picker_date === undefined ) ) {\n\t\t\tstart_date_string = this.start_date_picker.getValue();\n\n\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\tthis.year_mode_original_date = start_date_string;\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( strict ) {\n\t\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\tstart_date_string = this.year_mode_original_date ? this.year_mode_original_date : this.start_date_picker.getValue();\n\t\t\t\t} else if ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\tstart_date_string = new Date( new Date( $this.end_date.getTime() ).setDate( $this.end_date.getDate() - 15 ) ).format();\n\t\t\t\t} else {\n\t\t\t\t\tstart_date_string = $this.end_date.format();\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tstart_date_string = $this.start_date.format();\n\t\t\t}\n\n\t\t}\n\n\t\tProgressBar.showOverlay();\n\t\tLocalCacheData.last_schedule_selected_date = start_date_string;\n\t\tthis.api.getCombinedSchedule( { filter_data: filter_data }, start_date_string, mode, strict, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.full_schedule_data = result.getResult();\n\n\t\t\t\t//Error: Unable to get property 'start_display_date' of undefined or null reference in /interface/html5/ line 3805\n\t\t\t\tif ( $this.full_schedule_data === true || !$this.full_schedule_data || !$this.full_schedule_data.schedule_dates ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$this.start_date = Global.strToDate( $this.full_schedule_data.schedule_dates.start_display_date );\n\t\t\t\t$this.end_date = Global.strToDate( $this.full_schedule_data.schedule_dates.end_display_date );\n\n\t\t\t\t$this.buildCalendars();\n\n\t\t\t\tif ( setDefaultMenu ) {\n\t\t\t\t\t$this.setDefaultMenu( true );\n\t\t\t\t\t$this.autoOpenEditViewIfNecessary();\n\t\t\t\t}\n\n\t\t\t\t$this.searchDone();\n\n\t\t\t\t$this.setWeekModeDragAble();\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tsearchDone() {\n\t\t// this.setGridColumnsWidth();\n\t\t// this.setGridSize();\n\t\t$( '.button-rotate' ).removeClass( 'button-rotate' );\n\t\tTTPromise.resolve( 'init', 'init' );\n\t}\n\n\tgetLastDateOfRow( row ) {\n\t\tvar start_day = LocalCacheData.getLoginUserPreference().start_week_day == 0 ? 7 : LocalCacheData.getLoginUserPreference().start_week_day;\n\t\treturn row[( start_day - 1 ) + '_time'];\n\t}\n\n\tsetActionsButtonStatus() {\n\t\tvar mode = this.getMode();\n\n\t\tthis.weekly_totals_btn.setEnable( true );\n\t\tthis.strict_range_btn.setEnable( true );\n\t\tthis.daily_totals_btn.setEnable( true );\n\t\tthis.all_employee_btn.setEnable( true );\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.weekly_totals_btn.setEnable( false );\n\t\t\t\tthis.strict_range_btn.setEnable( false );\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.weekly_totals_btn.setEnable( false );\n\t\t\t\tthis.daily_totals_btn.setEnable( false );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonOverrideClick() {\n\n\t\tvar override_icon = $( '#' + ContextMenuIconName.override );\n\n\t\tif ( override_icon.hasClass( 'selected-menu' ) ) {\n\t\t\toverride_icon.removeClass( 'selected-menu' );\n\t\t\tthis.is_override = false;\n\t\t} else {\n\t\t\toverride_icon.addClass( 'selected-menu' );\n\t\t\tthis.is_override = true;\n\t\t}\n\t}\n\n\tsetMoveOrDropMode( id ) {\n\n\t\tvar drag_copy_icon = $( '#' + ContextMenuIconName.drag_copy );\n\t\tvar move_icon = $( '#' + ContextMenuIconName.move );\n\t\tvar swap_icon = $( '#' + ContextMenuIconName.swap );\n\t\tvar override_icon = $( '#' + ContextMenuIconName.override );\n\n\t\tdrag_copy_icon.removeClass( 'selected-menu' );\n\t\tmove_icon.removeClass( 'selected-menu' );\n\t\tswap_icon.removeClass( 'selected-menu' );\n\n\t\tvar drag_invisible = false;\n\t\tvar move_invisible = false;\n\t\tvar swap_invisible = false;\n\n\t\tif ( !this.copyPermissionValidate() ) {\n\t\t\tdrag_invisible = true;\n\t\t}\n\n\t\tif ( !this.movePermissionValidate() ) {\n\t\t\tmove_invisible = true;\n\t\t}\n\n\t\tif ( !this.editPermissionValidate() ) {\n\t\t\tswap_invisible = true;\n\t\t}\n\n\t\tif ( move_invisible && id === ContextMenuIconName.move ) {\n\t\t\tdrag_copy_icon.addClass( 'selected-menu' );\n\t\t} else {\n\t\t\t$( '#' + id ).addClass( 'selected-menu' );\n\t\t}\n\n\t\tif ( drag_invisible && move_invisible ) {\n\t\t\tthis.select_drag_menu_id = null;\n\t\t} else {\n\t\t\tthis.select_drag_menu_id = id;\n\t\t}\n\t}\n\n\tsetHolidayDataDic() {\n\n\t\tif ( this.full_schedule_data.holiday_data ) {\n\t\t\tfor ( var i = 0; i < this.full_schedule_data.holiday_data.length; i++ ) {\n\t\t\t\tvar item = this.full_schedule_data.holiday_data[i];\n\t\t\t\tvar standard_date = Global.strToDate( item.date_stamp ).format( this.weekly_format );\n\t\t\t\tthis.holiday_data_dic[standard_date] = item;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildCalendars( do_not_hide ) {\n\t\tvar $this = this;\n\t\tthis.grid_div = $( this.el ).find( '.schedule-grid-div' );\n\t\tthis.setHolidayDataDic();\n\n\t\tthis.buildScheduleColumns();\n\t\tthis.buildScheduleSource();\n\t\tthis.buildScheduleGrid();\n\n\t\tthis.setGridColumnsWidth(); //There is no grid data populated when this runs, so it only sizes columns to the label length, not longest row data length.\n\t\tthis.setGridSize();\n\n\t\t//Only work when year mode\n\t\tthis.setYearGroupHeader();\n\t\tthis.showGridBorders();\n\n\t\tvar start = 0;\n\t\tvar page = 1;\n\t\tvar page_num = 10;\n\n\t\t//this.grid will be empty when first time int this function, so put this judge here instead at begin.\n\t\t//Error: Uncaught TypeError: Cannot call method 'clearGridData' of null in /interface/html5/index.php?desktop=1#!m=Schedule&date=20150118&mode=week line 6944\n\t\tif ( !this.grid ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.grid.clearGridData();\n\n\t\tvar j = 0;\n\n\t\tif ( !do_not_hide ) {\n\t\t\tthis.grid.grid.css( 'opacity', 0 );\n\t\t}\n\n\t\t//Error: TypeError: $this.schedule_source is undefined in interface/html5/framework/jquery.min.js?v=9.0.6-20151231-155042 line 2 > eval line 3904\n\t\tif ( !this.schedule_source ) {\n\t\t\treturn;\n\t\t}\n\t\tvar $this = this;\n\t\taddGridData();\n\n\t\t// Add 200 record a time so UI not block.\n\t\tvar interval = setInterval( function() {\n\t\t\tif ( j < $this.schedule_source.length ) {\n\t\t\t\taddGridData();\n\t\t\t} else {\n\t\t\t\tdoNext();\n\t\t\t}\n\t\t}, 10 );\n\n\t\tfunction addGridData() {\n\t\t\tfor ( var i = j; i < j + 200; i++ ) {\n\t\t\t\tif ( i < $this.schedule_source.length ) {\n\t\t\t\t\tvar item = $this.schedule_source[i];\n\t\t\t\t\t$this.grid.grid.addRowData( i + 1, item );\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tj = i;\n\t\t}\n\n\t\tfunction doNext() {\n\t\t\tif ( !do_not_hide ) {\n\t\t\t\t$this.grid.grid.css( 'opacity', 1 );\n\t\t\t}\n\t\t\tclearInterval( interval );\n\n\t\t\tif ( $this.getMode !== ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t$this.setScheduleGridRowSpan();\n\t\t\t}\n\n\t\t\t$this.highLightSelectDay();\n\n\t\t\t//Only work when month mode\n\t\t\t$this.setMonthDateRowPosition();\n\n\t\t\t$this.setScheduleGridDragAble();\n\n\t\t\t$this.setScrollPosition();\n\n\t\t\t//$this.autoOpenEditViewIfNecessary();\n\n\t\t\t$this.setMonthDateRowBackGround();\n\n\t\t\t$this.setWeeklyTotalHeader();\n\t\t}\n\t}\n\n\tgetDefaultUser() {\n\t\tvar default_user_id = false;\n\t\tif ( this.schedule_source && this.schedule_source.length === 1 && this.schedule_source[0].user_id != '' ) {\n\t\t\t//case where only one user has a schedule on the sheet\n\t\t\tdefault_user_id = this.schedule_source[0].user_id;\n\t\t} else if ( this.schedule_source\n\t\t\t&& this.schedule_source.length === 1\n\t\t\t&& typeof this.filter_data == 'object' // #2571 - Uncaught TypeError: This.filter_data.include_user_id is undefined\n\t\t\t&& typeof this.filter_data.include_user_ids == 'object' // #2571 - Uncaught TypeError: Cannot read property 'value' of undefined\n\t\t\t&& this.filter_data.include_user_ids.value\n\t\t\t&& this.filter_data.include_user_ids.value.length === 1 ) {\n\t\t\t//case where one user is selected in include_users but does not have a schedule attributed to them (new users for example)\n\t\t\tdefault_user_id = this.filter_data.include_user_ids.value[0];\n\t\t} else {\n\t\t\t// #2740 Before defaulting to logged in user, check to see if user_id is set on the current_edit_record, as Save&Copy clears grid selection, so we need to re-set it.\n\t\t\tif ( this.current_edit_record.user_id && this.current_edit_record.user_id != '' ) {\n\t\t\t\tdefault_user_id = this.current_edit_record.user_id;\n\t\t\t} else {\n\t\t\t\tdefault_user_id = LocalCacheData.getLoginUser().id;\n\t\t\t}\n\t\t}\n\n\t\treturn default_user_id;\n\t}\n\n\tsetWeeklyTotalHeader() {\n\t\tvar show_weekly_total = this.weekly_totals_btn.getValue();\n\t\t$( '.size-tr' ).remove();\n\t\t$( '.group-tr' ).remove();\n\t\tif ( !show_weekly_total || !this.weekly_totals_btn.getEnabled() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' ) );\n\n\t\tvar size_tr = $( '<tr class=\"size-tr\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_tr = $( '<tr class=\"group-column-tr group-tr\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\"  >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar current_trs = table.find( '.jqgfirstrow' );\n\t\tcreateSizeColumns();\n\n\t\tvar column_length = this.grid.grid.getGridParam( 'colModel' ).length;\n\t\tcreateColumn( column_length - 5, '' );\n\t\tcreateColumn( 5, $.i18n._( 'Total' ) );\n\n\t\tsize_tr.insertBefore( table.find( '.ui-jqgrid-labels' ) );\n\t\tnew_tr.insertBefore( table.find( '.ui-jqgrid-labels' ) );\n\n\t\tfunction createSizeColumns() {\n\t\t\tvar len = current_trs.children().length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar td = $( '<th class=\"\" style=\"border-right: 1px solid #dddddd\" >' + '</th>' );\n\t\t\t\tvar item = current_trs.children().eq( i );\n\n\t\t\t\t/**\n\t\t\t\t * #2353 - schedule sizing fix\n\t\t\t\t *\n\t\t\t\t * Due to firefox reporting th  incorrectly via the $.width() function, the sizes must come from the (tr.jqgfirstrow) of the data table\n\t\t\t\t * firefox also refuses to set the width of the first row of th's via the $.width() function, so we need to ship the css values directly into the inline css using the css function\n\t\t\t\t */\n\t\t\t\ttd.css( 'width', item.css( 'width' ) );\n\n\t\t\t\ttd.height( 0 );\n\t\t\t\tsize_tr.append( td );\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createColumn( end_index, text ) {\n\t\t\tvar pay_period_th = new_th.clone();\n\n\t\t\tpay_period_th.children( 0 ).text( text );\n\t\t\tpay_period_th.attr( 'colspan', end_index );\n\n\t\t\tnew_tr.append( pay_period_th );\n\t\t}\n\n\t\tthis.setGridHeight(); //Since we are changing the header height, resize the grid to fit.\n\t}\n\n\tsetMonthDateRowBackGround() {\n\t\tif ( this.getMode() === ScheduleViewControllerMode.MONTH ) {\n\t\t\t$( this.el ).find( '.month-date-cell' ).parent().css( 'background-color', '#375979' );\n\t\t}\n\t}\n\n\tsetScrollPosition() {\n\t\tif ( this.scroll_position > 0 ) {\n\t\t\tthis.grid.grid.parent().parent().scrollTop( this.scroll_position );\n\t\t}\n\t}\n\n\tsetYearGroupHeader() {\n\n\t\tif ( this.getMode() !== ScheduleViewControllerMode.YEAR ) {\n\t\t\treturn;\n\t\t}\n\n\t\t$( '.schedule-year-group-header' ).remove();\n\t\tvar table = $( $( this.el ).find( 'table[aria-labelledby=gbox_' + this.ui_id + '_grid]' )[0] );\n\t\tvar new_tr = $( '<tr class=\"group-column-tr schedule-year-group-header\" >' +\n\t\t\t'</tr>' );\n\n\t\tvar new_th = $( '<th class=\"group-column-th\"  >' +\n\t\t\t'<span class=\"group-column-label\"></span>' +\n\t\t\t'</th>' );\n\n\t\tvar default_tr = new_tr.clone();\n\n\t\t$( table.children()[0] ).prepend( default_tr );\n\n\t\t//Build first row to correct width for span columns which in second row, table width decided by first row\n\t\tvar datesTHs = table.find( 'th' );\n\t\tvar len = datesTHs.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar th = $( datesTHs[i] );\n\n\t\t\tvar default_th = th.clone();\n\t\t\tdefault_th.attr( 'id', '' );\n\t\t\tdefault_th.empty();\n\t\t\tdefault_th.attr( 'row', '' );\n\t\t\tdefault_th.height( 0 );\n\t\t\tdefault_tr.append( default_th );\n\n\t\t}\n\n\t\tvar first_tr = $( $( table.children()[0] ).children()[0] );\n\n\t\tvar start = this.select_layout.data.display_columns.length + 1;\n\t\t//Create group column header\n\t\tdefault_tr = new_tr.clone();\n\t\tdefault_th = new_th.clone();\n\t\tdefault_th.attr( 'colspan', start );\n\t\tdefault_tr.append( default_th );\n\t\tdefault_tr.insertAfter( first_tr );\n\n\t\tvar current_month = null;\n\t\tvar current_date = null;\n\t\tvar same_month_count = 0;\n\n\t\tfor ( var i = start; i < len; i++ ) {\n\t\t\tth = $( datesTHs[i] );\n\t\t\tvar id_split_array = th.attr( 'id' ).split( '_' );\n\t\t\tvar date_str = id_split_array[id_split_array.length - 1];\n\n\t\t\tif ( date_str === 'shifts' || date_str === 'absences' || date_str === 'total_time' || date_str === 'total_time_wage' ) {\n\t\t\t\tvar month = '-1';\n\t\t\t} else {\n\t\t\t\tmonth = Global.strToDate( date_str, this.full_format ).getMonth();\n\t\t\t}\n\n\t\t\tif ( !Global.isSet( current_month ) ) {\n\t\t\t\tcurrent_month = month;\n\t\t\t\tcurrent_date = date_str;\n\t\t\t\tsame_month_count = 1;\n\n\t\t\t} else {\n\t\t\t\tvar month_header_text = Global.strToDate( current_date, this.full_format ).format( 'MMM' );\n\t\t\t\tif ( month === current_month && i !== len - 1 ) {\n\t\t\t\t\tsame_month_count = same_month_count + 1;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( i === len - 1 ) {\n\t\t\t\t\t\tif ( month !== current_month && !isNaN( month ) ) {\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t\tcurrent_month = month;\n\t\t\t\t\t\t\tcurrent_date = date_str;\n\t\t\t\t\t\t\tsame_month_count = 1;\n\n\t\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsame_month_count = same_month_count + 1;\n\n\t\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\tdefault_th.children( 0 ).text( month_header_text );\n\t\t\t\t\t\tdefault_th.attr( 'colspan', same_month_count );\n\t\t\t\t\t\tdefault_tr.append( default_th );\n\n\t\t\t\t\t\tcurrent_month = month;\n\t\t\t\t\t\tcurrent_date = date_str;\n\t\t\t\t\t\tsame_month_count = 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( month === '-1' ) {\n\t\t\t\t\t\tdefault_th = new_th.clone();\n\t\t\t\t\t\tdefault_th.children( 0 ).text( '' );\n\t\t\t\t\t\tdefault_th.attr( 'colspan', len - i );\n\t\t\t\t\t\tdefault_tr.append( default_th );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tsetMonthDateRowPosition() {\n\n\t\tif ( this.getMode() !== ScheduleViewControllerMode.MONTH ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tthis.month_date_row_position = {};\n\t\tvar i = 0;\n\t\tfor ( var key in this.month_date_row_tr_ids ) {\n\t\t\tthis.month_date_row_position[i] = this.grid.grid.find( '#' + key ).position().top;\n\t\t\ti = i + 1;\n\t\t}\n\n\t\tthis.grid.grid.parent().parent().scroll( function() {\n\t\t\tvar top = $( this ).scrollTop();\n\n\t\t\tvar start_day = $this.start_date.getDay();\n\n\t\t\tif ( top < $this.month_date_row_position[0] && $this.month_current_header_number !== 0 ) {\n\n\t\t\t\t//Deal with header before first date row.\n\t\t\t\t$this.month_date_row_tr_ids = {};\n\t\t\t\t$this.month_current_header_number = 0;\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar current_date = new Date( new Date( $this.start_date.getTime() ).setDate( $this.start_date.getDate() + i ) );\n\t\t\t\t\tvar header_text = current_date.format( $this.weekly_format );\n\t\t\t\t\tvar header_container = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\tvar data_field = ( ( start_day + i ) % 7 );\n\t\t\t\t\tvar header = $( $this.el ).find( '#jqgh_' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\theader.text( header_text );\n\t\t\t\t\theader_container.removeClass( 'highlight-header' );\n\n\t\t\t\t}\n\n\t\t\t\t$this.highLightSelectDay();\n\n\t\t\t} else if ( top > $this.month_date_row_position[0] && top < $this.month_date_row_position[1] && $this.month_current_header_number !== 1 ) {\n\t\t\t\tsetHeaderText( 0, 1 );\n\n\t\t\t} else if ( top > $this.month_date_row_position[1] && top < $this.month_date_row_position[2] && $this.month_current_header_number !== 2 ) {\n\t\t\t\tsetHeaderText( 1, 2 );\n\t\t\t} else if ( top > $this.month_date_row_position[2] && top < $this.month_date_row_position[3] && $this.month_current_header_number !== 3 ) {\n\t\t\t\tsetHeaderText( 2, 3 );\n\t\t\t} else if ( top > $this.month_date_row_position[3] && $this.month_current_header_number !== 4 ) {\n\t\t\t\tsetHeaderText( 3, 4 );\n\t\t\t}\n\n\t\t\tfunction setHeaderText( index, headerNumber ) {\n\t\t\t\t$this.month_date_row_tr_ids = {};\n\t\t\t\t$this.month_current_header_number = headerNumber;\n\t\t\t\tvar date_row = $this.month_date_row_array[index];\n\t\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\t\tvar data_field = ( ( start_day + i ) % 7 );\n\t\t\t\t\tvar header = $( $this.el ).find( '#jqgh_' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\tvar header_container = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + data_field );\n\t\t\t\t\theader_container.removeClass( 'highlight-header' );\n\t\t\t\t\tvar full_date = date_row[data_field + '_full_date'];\n\t\t\t\t\tvar date_cell = $( $this.el ).find( '#' + $this.ui_id + '_grid_' + full_date );\n\n\t\t\t\t\tif ( date_cell.hasClass( 'highlight-header' ) ) {\n\t\t\t\t\t\theader_container.addClass( 'highlight-header' );\n\t\t\t\t\t}\n\t\t\t\t\theader.html( date_row[data_field] );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t} );\n\t}\n\n\tsetGridHeight() {\n\t\tvar height = $( 'body' ).height();//why do i need to do this?\n\n\t\theight -= $( '#topContainer' ).height();\n\n\t\theight -= $( '.search-panel' ).height();\n\t\theight -= $( '.control-bar' ).height();\n\t\theight -= this.grid.grid.parents( '.ui-jqgrid-jquery-ui' ).find( '.ui-jqgrid-htable' ).height();\n\t\theight -= 55; // footer height\n\n\t\tif ( this.getMode() != ScheduleViewControllerMode.DAY ) {\n\t\t\tvar grid_div = $( '.schedule-view .grid-div .ui-jqgrid-bdiv' );\n\t\t\tif ( grid_div && grid_div.length > 0 && grid_div[0].scrollWidth > ( $( '.view' ).width() + 2 ) ) { //this plus 2 is because sometimes the scroll width is larger than the view width with no scrollbar\n\t\t\t\theight -= 15; //scrollbar compensation\n\t\t\t}\n\t\t}\n\n\t\tthis.grid.setGridHeight( height );\n\t\treturn height;\n\t}\n\n\tsetGridColumnsWidth() {\n\t\tvar $this = this;\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tvar day_column_index;\n\n\t\t\t\t//Calculate the exact width of each column that isn't where the shift times are displayed.\n\t\t\t\t//Then any remaining width can be allocated to the shift times column.\n\t\t\t\tvar column_padding = 10;\n\t\t\t\t//var grid_data = this.grid.getData();\n\t\t\t\tvar grid_data = $this.schedule_source; //Must use the original source data, as the this.grid.getData() is not populated yet.\n\t\t\t\tfor ( var i in this.schedule_columns ) {\n\t\t\t\t\tif ( this.schedule_columns[i].is_static_size == true || this.schedule_columns[i].name == 'scrollbar_spacer' ) {\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t\tif ( this.schedule_columns[i].name != 'scrollbar_spacer' ) {\n\t\t\t\t\t\t\tday_column_index = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//size column based on text.\n\t\t\t\t\t\tvar column_width = Global.calculateTextWidth( this.schedule_columns[i].label ) + column_padding;\n\n\t\t\t\t\t\tif ( grid_data && grid_data.length > 0 ) {\n\t\t\t\t\t\t\tfor ( var row in grid_data ) {\n\t\t\t\t\t\t\t\tvar new_col_width = Global.calculateTextWidth( grid_data[row][this.schedule_columns[i].name] );\n\t\t\t\t\t\t\t\tif ( new_col_width > column_width ) {\n\t\t\t\t\t\t\t\t\tcolumn_width = new_col_width;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.schedule_columns[i].width = column_width;\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.calculateScheduleWidth();\n\t\t\t\t$( '.day_hour_div .day_hour_span' ).width( this.day_hour_width );\n\t\t\t\tvar day_column_width = ( this.day_hour_width * $( '.day_hour_div .day_hour_span' ).length ); // 60 is desired width of each day span\n\n\t\t\t\tthis.schedule_columns[day_column_index].width = day_column_width;\n\n\t\t\t\tthis.grid.setGridColumnsWidth( this.schedule_columns );\n\t\t\t\tthis.grid.setGridWidth( $( '.view' ).width() );\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tvar column_padding = 10;\n\t\t\t\tvar columns_width = 0;\n\n\t\t\t\t//Day columns must always be the same width, only make the employee name and other static columns variable width.\n\t\t\t\tvar max_width = $( '.view' ).width();\n\n\t\t\t\tvar grid_data = $this.schedule_source; //Must use the original source data, as the this.grid.getData() is not populated yet.\n\t\t\t\tfor ( var i in this.schedule_columns ) {\n\t\t\t\t\tif ( !this.schedule_columns[i].is_static_size || this.schedule_columns[i].is_static_size == false ) {\n\t\t\t\t\t\t//size column based on text.\n\t\t\t\t\t\tvar column_width = Global.calculateTextWidth( this.schedule_columns[i].label, { padding: column_padding } );\n\n\t\t\t\t\t\tif ( grid_data && grid_data.length > 0 ) {\n\t\t\t\t\t\t\tfor ( var row in grid_data ) {\n\t\t\t\t\t\t\t\tvar new_col_width = Global.calculateTextWidth( grid_data[row][this.schedule_columns[i].name], { padding: column_padding } );\n\t\t\t\t\t\t\t\tif ( new_col_width > column_width ) {\n\t\t\t\t\t\t\t\t\tcolumn_width = new_col_width;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.schedule_columns[i].width = column_width;\n\t\t\t\t\t\tthis.schedule_columns[i].fixed = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcolumns_width += this.schedule_columns[i].width;\n\t\t\t\t}\n\n\t\t\t\t//Resize first column to fill screen.\n\t\t\t\tif ( this.schedule_columns[0] && columns_width < max_width ) {\n\t\t\t\t\tthis.schedule_columns[0].width += ( max_width - columns_width );\n\t\t\t\t}\n\n\t\t\t\tthis.grid.setGridColumnsWidth( this.schedule_columns );\n\n\t\t\t\tif ( this.getMode() == ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\tthis.setYearGroupHeader(); //Must go after the column widths are changed.\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.setGridHeight();\n\t}\n\n\tbuildScheduleSource() {\n\t\tthis.no_date_array = [];\n\t\tthis.has_date_array = [];\n\t\tthis.final_schedule_data_array = [];\n\t\tvar mode = this.getMode();\n\n\t\tthis.no_date_array = this.buildNoDateArray();\n\t\tthis.has_date_array = this.buildHasDateArray();\n\t\tvar has_date_temp_array_length = this.has_date_array.length;\n\t\tvar sort_fields = this.buildSortFields();\n\t\tthis.has_date_array.sort( Global.m_sort_by( sort_fields ) );\n\t\tthis.no_date_array.sort( Global.m_sort_by( sort_fields ) );\n\n\t\tif ( mode !== ScheduleViewControllerMode.MONTH ) {\n\t\t\tthis.final_schedule_data_array = this.no_date_array.concat( this.has_date_array );\n\t\t}\n\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.buildWeeklySource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.buildMonthSource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.buildYearlySource();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.buildDailySource();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tbuildShiftKey( shift ) {\n\n\t\tvar key = '';\n\t\tfor ( var i = 0; i < this.shift_key_name_array.length; i++ ) {\n\t\t\tvar field_name = this.shift_key_name_array[i];\n\t\t\tvar column_name = this.shift_key_name_array[i].replace( '_id', '' ); //judge if shit has correct field value\n\t\t\tif ( column_name !== 'user' ) {\n\t\t\t\tif ( shift[column_name] ) {\n\t\t\t\t\tkey = shift[field_name] + '-' + key;\n\t\t\t\t} else {\n\t\t\t\t\tkey = 0 + '-' + key;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tkey = shift[field_name] + '-' + key;\n\t\t\t}\n\t\t}\n\t\treturn key;\n\t}\n\n\tbuildMonthSource() {\n\t\tvar $this = this;\n\t\tvar date_row_index = 0;\n\t\tvar month_week_data_index = 0;\n\t\tvar date_row = this.month_date_row_array[date_row_index];\n\t\tvar start_day = this.start_date.getDay(); //start from first date row, not include column\n\t\tvar first_day_time = date_row[start_day + '_time'];\n\t\tvar month_week_data_array = [];\n\t\tvar has_date_array = this.has_date_array.slice();\n\t\tfor ( var j = 0; j < 5; j++ ) {\n\t\t\tvar current_week_array = [];\n\t\t\tvar len = has_date_array.length;\n\t\t\tvar is_last_row = false;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\n\t\t\t\tvar shift = has_date_array[i];\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tvar time = date.getTime();\n\n\t\t\t\tif ( time < first_day_time ) {\n\n\t\t\t\t\thas_date_array.splice( i, 1 );\n\n\t\t\t\t\ti = i - 1;\n\t\t\t\t\tlen = len - 1;\n\n\t\t\t\t\tcurrent_week_array.push( shift );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( this.all_employee_btn.getValue() ) {\n\t\t\t\tif ( j === 0 ) {\n\t\t\t\t\tcurrent_week_array = this.no_date_array.slice().concat( current_week_array );\n\t\t\t\t} else {\n\t\t\t\t\t// only first week empty users are comming from API, calculate all other weeks data\n\t\t\t\t\tvar no_date_array = this.buildMonthWeekNoDateArray( current_week_array );\n\t\t\t\t\tcurrent_week_array = no_date_array.slice().concat( current_week_array );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tmonth_week_data_array[month_week_data_index] = current_week_array;\n\t\t\tif ( date_row_index > 2 ) {\n\t\t\t\tis_last_row = true;\n\t\t\t} else if ( date_row_index === 2 && !this.month_date_row_array[3].hasOwnProperty( 0 ) ) {\n\t\t\t\tis_last_row = true;\n\t\t\t}\n\t\t\tif ( !is_last_row ) {\n\t\t\t\tdate_row_index = date_row_index + 1;\n\t\t\t\tmonth_week_data_index = month_week_data_index + 1;\n\t\t\t\tdate_row = this.month_date_row_array[date_row_index];\n\t\t\t\tfirst_day_time = date_row[start_day + '_time'];\n\t\t\t} else {\n\t\t\t\tmonth_week_data_index = month_week_data_index + 1;\n\n\t\t\t\t//Don't use this.end_date because the end date may larger than the last day of this month. Use the last date in date row\n\t\t\t\tvar end_date_time = this.getLastDateOfRow( this.month_date_row_array[date_row_index] );\n\t\t\t\tvar end_date = new Date( end_date_time );\n\t\t\t\tfirst_day_time = new Date( end_date.setDate( end_date.getDate() + 1 ) ).getTime();\n\t\t\t}\n\t\t}\n\n\t\tbuildMonthWeeklyData( -1, month_week_data_array[0] );\n\t\tbuildMonthWeeklyData( 0, month_week_data_array[1] );\n\t\tbuildMonthWeeklyData( 1, month_week_data_array[2] );\n\t\tbuildMonthWeeklyData( 2, month_week_data_array[3] );\n\t\tbuildMonthWeeklyData( 3, month_week_data_array[4] );\n\n\t\tfunction buildMonthWeeklyData( rowIndex, source_array ) {\n\t\t\tif ( source_array.length < 1 ) {\n\t\t\t\tbuildEmptyRow( rowIndex );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar map = {};\n\t\t\tvar len = source_array.length;\n\t\t\tvar push_to_last = false;\n\n\t\t\tif ( rowIndex === $this.month_date_row_array.length - 1 ) {\n\t\t\t\tpush_to_last = true;\n\t\t\t} else {\n\t\t\t\tvar date_row = $this.month_date_row_array[rowIndex + 1];\n\t\t\t\tvar index = 0;\n\t\t\t}\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar shift = source_array[i];\n\t\t\t\tvar date_string;\n\t\t\t\tif ( shift.date_stamp ) {\n\t\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\n\t\t\t\t\tdate_string = date.getDay();\n\t\t\t\t}\n\n\t\t\t\tvar key = $this.buildShiftKey( shift );\n\n\t\t\t\t// each row of schedule data, start from first row\n\t\t\t\tif ( !map[key] ) {\n\t\t\t\t\tvar row = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\t\tvar display_columns = $this.select_layout.data.display_columns;\n\t\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !push_to_last ) {\n\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t\t\t\t\tmap[key] = [index];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.schedule_source.push( row );\n\t\t\t\t\t\tmap[key] = [$this.schedule_source.length - 1];\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\t\tvar find_position = false;\n\t\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\t\trow = $this.schedule_source[row_index];\n\t\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !find_position ) {\n\t\t\t\t\t\trow = {};\n\t\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\t\t\tdisplay_columns = $this.select_layout.data.display_columns;\n\t\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( date_string >= 0 ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !push_to_last ) {\n\t\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t\t\t\t\t\tmap[key].push( index );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$this.schedule_source.push( row );\n\t\t\t\t\t\t\tmap[key].push( $this.schedule_source.length - 1 );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif ( source_array.length > 0 ) {\n\t\t\t\tbuildEmptyRow( rowIndex, true );\n\t\t\t}\n\t\t}\n\n\t\tfunction buildEmptyRow( date_row_index, add_last ) {\n\t\t\tif ( add_last ) {\n\t\t\t\tdate_row_index = date_row_index + 1;\n\t\t\t}\n\t\t\tif ( date_row_index === -1 ) {\n\t\t\t\tvar index = 0;\n\t\t\t} else {\n\t\t\t\tvar date_row = $this.month_date_row_array[date_row_index];\n\t\t\t\tif ( add_last ) {\n\t\t\t\t\tif ( date_row ) {\n\t\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tindex = $this.schedule_source.length;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tindex = $this.schedule_source.indexOf( date_row ) + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.splice( index, 0, row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tbuildYearlySource() {\n\t\tvar $this = this;\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date.format( this.full_format );\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\trow[date_string] = shift.status_id == 10 ? 'S' : 'A';\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = {};\n\t\t\trow.user_full_name = '';\n\t\t\trow.last_name = '';\n\t\t\trow.user_id = '';\n\t\t\trow.branch_id = '';\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tbuildDailyHeaders() {\n\t\tvar $this = this;\n\t\tvar col_model = this.schedule_columns;\n\t\tvar label_column = col_model[this.select_layout.data.display_columns.length + 1];\n\t\tvar first_time = -1;\n\t\tvar last_time = -1;\n\t\tvar first_date_time = '';\n\t\tvar last_date_time = '';\n\t\tvar first_time_str = '';\n\t\tvar last_time_str = '';\n\t\tvar len = this.has_date_array.length;\n\t\tif ( len === 0 ) {\n\t\t\tvar res = this.api.getScheduleDefaultData( { async: false } );\n\t\t\tvar data = res.getResult();\n\t\t\tvar selected_date_str = $this.getSelectDate();\n\t\t\tfirst_date_time = selected_date_str + ' ' + data.start_time;\n\t\t\tlast_date_time = selected_date_str + ' ' + data.end_time;\n\t\t\tdoNext();\n\t\t\treturn;\n\t\t}\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar item = this.has_date_array[i];\n\n\t\t\tif ( first_time === -1 ) {\n\t\t\t\tfirst_time = item.start_time_stamp;\n\t\t\t\tfirst_date_time = item.start_date;\n\t\t\t\tfirst_time_str = item.start_time;\n\t\t\t} else if ( item.start_time_stamp < first_time ) {\n\t\t\t\tfirst_time = item.start_time_stamp;\n\t\t\t\tfirst_date_time = item.start_date;\n\t\t\t\tfirst_time_str = item.start_time;\n\t\t\t}\n\n\t\t\tif ( last_time === -1 ) {\n\t\t\t\tlast_time = item.end_time_stamp;\n\t\t\t\tlast_date_time = item.end_date;\n\t\t\t\tlast_time_str = item.end_time;\n\t\t\t} else if ( item.end_time_stamp > last_time ) {\n\t\t\t\tlast_time = item.end_time_stamp;\n\t\t\t\tlast_date_time = item.end_date;\n\t\t\t\tlast_time_str = item.end_time;\n\t\t\t}\n\t\t}\n\n\t\tfirst_date_time = Global.getStandardDateTimeStr( first_date_time, first_time_str );\n\t\tlast_date_time = Global.getStandardDateTimeStr( last_date_time, last_time_str );\n\n\t\tdoNext();\n\n\t\tfunction doNext() {\n\t\t\tvar current_date_time = new Date( Global.strToDateTime( first_date_time ).getTime() - 3600000 );\n\t\t\tlast_date_time = Global.strToDateTime( last_date_time );\n\t\t\tvar min = current_date_time.getMinutes() * 60000;\n\t\t\tvar time_span = $( '<div class=\\'day_hour_span\\'></div>' );\n\t\t\tif ( min > 0 ) {\n\t\t\t\tcurrent_date_time = new Date( current_date_time.getTime() - min );\n\t\t\t}\n\t\t\t$this.day_mode_start_date_time = current_date_time;\n\t\t\tvar time_offset = ( last_date_time.getTime() - current_date_time.getTime() ) / 3600000;\n\t\t\tvar header_container = $( '<div class=\\'day_hour_div\\'></div>' );\n\t\t\tvar day_column = $( '<div class=\\'day-column\\'></div>' );\n\t\t\tvar day = $this.start_date.format( $this.weekly_format );\n\t\t\tday = $this.setHolidayHeader( day, true );\n\t\t\tday_column.text( day );\n\t\t\tvar time_columns = $( '<div style=\"padding:0px !important\"></div>' );\n\t\t\tvar time_string = '';\n\n\t\t\t//var time_format_string = 'hh:mm A';\n\t\t\t// var time_format_string = 'h A';\n\t\t\tvar time_format_string = 'hA';\n\t\t\tfor ( var i = 0; i < time_offset; i++ ) {\n\t\t\t\tvar current_hour_text = time_span.clone();\n\t\t\t\tcurrent_hour_text = current_hour_text.text( current_date_time.format( time_format_string ) );\n\t\t\t\tif ( i < time_offset - 1 ) {\n\t\t\t\t\ttime_string = time_string + current_date_time.format( time_format_string ) + '|';\n\t\t\t\t} else {\n\t\t\t\t\ttime_string = time_string + current_date_time.format( time_format_string );\n\t\t\t\t}\n\t\t\t\ttime_columns.append( current_hour_text );\n\t\t\t\tcurrent_date_time = new Date( current_date_time.getTime() + 3600000 );\n\t\t\t}\n\t\t\theader_container.append( day_column );\n\t\t\theader_container.append( time_columns );\n\t\t\t$this.buildTotalShiftDic( time_string );\n\t\t\tlabel_column.label = header_container[0].outerHTML;\n\t\t\t// Include padding.\n\t\t\tlabel_column.width = $this.day_hour_width * time_offset + 40;\n\t\t\t$this.day_header_width = label_column.width;\n\n\t\t}\n\t}\n\n\t//Build dic that contains all daily hours\n\tbuildTotalShiftDic( timeHeader ) {\n\t\tvar label_array = timeHeader.split( '|' );\n\t\tthis.total_shifts_dic = {};\n\t\tfor ( var i = 0; i < label_array.length; i++ ) {\n\t\t\tvar shift_item = { sort_order: i, key: label_array[i], value: 0 };\n\t\t\tthis.total_shifts_dic[label_array[i]] = shift_item;\n\t\t}\n\t}\n\n\tbuildDailySource() {\n\n\t\tvar $this = this;\n\t\tthis.buildDailyHeaders();\n\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date.format( this.full_format );\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\trow.total = Global.getTimeUnit( shift.total_time );\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t}\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\t\t\t\t\trow.total = Global.getTimeUnit( shift.total_time );\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t}\n\n\tbuildWeeklySource() {\n\t\tvar $this = this;\n\t\tvar map = {};\n\t\tthis.schedule_source = [];\n\n\t\tvar len = this.final_schedule_data_array.length;\n\n\t\tif ( len < 1 ) {\n\t\t\tbuildEmptyRow();\n\t\t\treturn;\n\t\t}\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar shift = this.final_schedule_data_array[i];\n\t\t\tvar date_string = '';\n\t\t\tif ( shift.date_stamp ) {\n\t\t\t\tvar date = Global.strToDate( shift.date_stamp );\n\t\t\t\tdate_string = date ? date.format( this.full_format ) : null;\n\t\t\t}\n\n\t\t\tvar key = this.buildShiftKey( shift );\n\n\t\t\t// each row of schedule data, start from first row\n\t\t\tif ( !map[key] ) {\n\t\t\t\tvar row = {};\n\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\t\tvar display_columns_len = display_columns.length;\n\n\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\tvar field_name = display_columns[j];\n\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t}\n\n\t\t\t\tif ( date_string ) {\n\n\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t}\n\n\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t}\n\n\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\tmap[key] = [this.schedule_source.length - 1];\n\t\t\t} else {\n\t\t\t\t// if one row already created, go to here to create cells in this row\n\n\t\t\t\tvar find_position = false;\n\t\t\t\tfor ( var x = 0; x < map[key].length; x++ ) {\n\t\t\t\t\tvar row_index = map[key][x];\n\t\t\t\t\trow = this.schedule_source[row_index];\n\t\t\t\t\tif ( row[date_string] ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( date_string ) {\n\t\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfind_position = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( !find_position ) {\n\t\t\t\t\trow = {};\n\t\t\t\t\trow.user_full_name = shift.user_full_name;\n\t\t\t\t\trow.last_name = shift.last_name;\n\t\t\t\t\trow.user_id = shift.user_id;\n\t\t\t\t\trow.branch_id = shift.branch_id;\n\t\t\t\t\trow.department_id = shift.department_id;\n\t\t\t\t\trow.schedule_policy_id = shift.schedule_policy_id;\n\t\t\t\t\trow.job_id = shift.job_id;\n\t\t\t\t\trow.job_item_id = shift.job_item_id;\n\n\t\t\t\t\tdisplay_columns = this.select_layout.data.display_columns;\n\t\t\t\t\tdisplay_columns_len = display_columns.length;\n\n\t\t\t\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\t\t\t\tfield_name = display_columns[j];\n\t\t\t\t\t\trow[field_name] = shift[field_name] ? shift[field_name] : '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date_string ) {\n\n\t\t\t\t\t\tif ( shift.status_id == 20 ) {\n\n\t\t\t\t\t\t\trow[date_string] = $this.getAbsenceCellValue( shift );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow[date_string] = shift.start_time + ' - ' + shift.end_time;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trow[date_string + '_data'] = shift;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.schedule_source.push( row );\n\t\t\t\t\tmap[key].push( this.schedule_source.length - 1 );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildEmptyRow() {\n\n\t\t\tvar row = $this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.EMPTY;\n\t\t\t$this.schedule_source.push( row );\n\t\t}\n\n\t\tthis.showDailyTotal();\n\t\tthis.showWeeklyTotal();\n\t}\n\n\tgetAbsenceCellValue( shift ) {\n\n\t\tvar result;\n\t\tif ( shift.absence_policy ) {\n\t\t\tif ( shift.note ) {\n\t\t\t\tresult = '*' + shift.absence_policy;\n\t\t\t} else {\n\t\t\t\tresult = shift.absence_policy;\n\t\t\t}\n\t\t} else {\n\t\t\tif ( shift.note ) {\n\t\t\t\tresult = '*' + 'N/A';\n\t\t\t} else {\n\t\t\t\tresult = 'N/A';\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildSortFields() {\n\t\tvar sort_by_fields = [];\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'data' of null in /interface/html5/#!m=Schedule line 5169\n\t\tif ( this.select_layout && this.select_layout.data ) {\n\t\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\t\tvar display_columns_len = display_columns.length;\n\t\t\tif ( display_columns_len > 0 ) {\n\t\t\t\tsort_by_fields = display_columns.slice();\n\t\t\t}\n\t\t}\n\n\t\tsort_by_fields.push( 'user_full_name' );\n\n\t\tsort_by_fields.push( { name: 'start_time_stamp', primer: parseFloat, reverse: false } );\n\n\t\treturn sort_by_fields;\n\t}\n\n\tbuildMonthWeekNoDateArray( current_week_array ) {\n\t\tvar has_date_user_map = {};\n\t\tvar result = [];\n\n\t\tfor ( var i = 0, ii = current_week_array.length; i < ii; i++ ) {\n\t\t\tvar item = Global.clone( current_week_array[i] );\n\t\t\thas_date_user_map[item.user_id] = true;\n\t\t}\n\n\t\tfor ( var key in this.all_user_map ) {\n\t\t\tif ( !has_date_user_map[key] ) {\n\t\t\t\tvar item = Global.clone( this.all_user_map[key] );\n\t\t\t\titem.date_stamp = false;\n\t\t\t\tresult.push( item );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tbuildNoDateArray() {\n\t\tvar records = [];\n\t\tvar sort_array = [];\n\t\tvar sort_item;\n\t\tvar schedule_data = this.full_schedule_data.schedule_data;\n\t\tfor ( var date_key in schedule_data ) {\n\t\t\tsort_item = {};\n\t\t\tsort_item.value = schedule_data[date_key];\n\t\t\tsort_item.sort_key = date_key;\n\t\t\tsort_array.push( sort_item );\n\t\t}\n\n\t\tvar len = sort_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar date_item = sort_array[i];\n\t\t\tfor ( var item_key in date_item.value ) {\n\t\t\t\tvar item = date_item.value[item_key];\n\t\t\t\titem = this.replaceFalseToEmptyStringForSortFields( item );\n\t\t\t\tif ( !item.date_stamp ) {\n\t\t\t\t\trecords.push( date_item.value[item_key] );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\treturn records;\n\t}\n\n\tbuildHasDateArray() {\n\t\tvar records = [];\n\t\tthis.all_user_map = {};\n\t\tvar sort_array = [];\n\t\tvar sort_item;\n\t\tvar schedule_data = this.full_schedule_data.schedule_data;\n\n\t\tfor ( var date_key in schedule_data ) {\n\t\t\tsort_item = {};\n\t\t\tsort_item.value = schedule_data[date_key];\n\t\t\tsort_item.sort_key = date_key;\n\t\t\tsort_array.push( sort_item );\n\t\t}\n\t\tvar len = sort_array.length;\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar date_item = sort_array[i];\n\t\t\tfor ( var item_key in date_item.value ) {\n\t\t\t\tvar item = date_item.value[item_key];\n\t\t\t\titem = this.replaceFalseToEmptyStringForSortFields( item );\n\t\t\t\tthis.all_user_map[item.user_id] = Global.clone( item );\n\t\t\t\tif ( item.date_stamp ) {\n\t\t\t\t\trecords.push( date_item.value[item_key] );\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\treturn records;\n\t}\n\n\treplaceFalseToEmptyStringForSortFields( item ) {\n\t\tif ( !item.branch ) {\n\t\t\titem.branch = '';\n\t\t}\n\n\t\tif ( !item.department ) {\n\t\t\titem.department = '';\n\t\t}\n\n\t\tif ( !item.default_branch ) {\n\t\t\titem.default_branch = '';\n\t\t}\n\n\t\tif ( !item.default_department ) {\n\t\t\titem.default_department = '';\n\t\t}\n\n\t\tif ( !item.job ) {\n\t\t\titem.job = '';\n\t\t}\n\n\t\tif ( !item.job_item ) {\n\t\t\titem.job_item = '';\n\t\t}\n\n\t\tif ( !item.title ) {\n\t\t\titem.title = '';\n\t\t}\n\n\t\treturn item;\n\t}\n\n\tcheckIsSelectedCell( row_id, cell_index ) {\n\t\tfor ( var i = 0, m = this.select_cells_Array.length; i < m; i++ ) {\n\t\t\tvar cell = this.select_cells_Array[i];\n\t\t\tif ( cell.row_id.toString() === row_id.toString() && cell.cell_index.toString() === cell_index.toString() ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tbuildScheduleGrid() {\n\t\tvar $this = this;\n\t\tvar grid;\n\t\tvar grid_id = 'grid';\n\n\t\tif ( !this.grid ) {\n\t\t\tgrid = $( this.el ).find( '#grid' );\n\n\t\t\tgrid.attr( 'id', this.ui_id + '_grid' );  //Grid's id is ScriptName + _grid\n\n\t\t\tgrid_id = this.ui_id + '_grid';\n\t\t} else {\n\t\t\tthis.grid.grid.jqGrid( 'GridUnload', true );\n\t\t\tdelete this.grid;\n\t\t\tthis.grid = null;\n\t\t}\n\n\t\tgrid_id = this.ui_id + '_grid';\n\n\t\tif ( !this.schedule_columns || this.schedule_columns.length == 0 ) {\n\t\t\tthis.buildScheduleColumns();\n\t\t}\n\n\t\tthis.grid = new TTGrid( grid_id, {\n\t\t\tdraggble: true,\n\t\t\taltRows: true,\n\t\t\tdata: [],\n\t\t\tdatatype: 'local',\n\t\t\tsortable: false,\n\t\t\tscrollOffset: 0,\n\t\t\trowNum: 10000,\n\t\t\thoverrows: false,\n\t\t\tmultiselectPosition: 'none',\n\t\t\tondblClickRow: function() {\n\t\t\t\t$this.onGridDblClickRow();\n\t\t\t},\n\t\t\tonSelectRow: function( row_id, flag, e ) {\n\t\t\t\tvar row_tr = $( this ).find( '#' + row_id );\n\t\t\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tonRightClickRow: function( row_id, iRow, cell_index, e ) {\n\t\t\t\tif ( !$this.checkIsSelectedCell( row_id, cell_index ) ) {\n\t\t\t\t\tvar cell_val = $( e.target ).closest( 'td,th' ).html();\n\t\t\t\t\tvar row_tr = $( this ).find( '#' + row_id );\n\t\t\t\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCellSelect: function( row_id, cell_index, cell_val, e ) {\n\t\t\t\t$this.onCellSelect( 'timesheet_grid', row_id, cell_index, cell_val, this, e );\n\t\t\t},\n\t\t\tcolNames: [],\n\t\t\t//colModel: this.schedule_columns,\n\t\t\tviewrecords: true,\n\t\t\twinMultiSelect: false,\n\t\t\tsetGridSize: function() {\n\t\t\t\t$this.setGridHeight();\n\t\t\t},\n\t\t\tonResizeGrid: function() {\n\t\t\t\t$this.onResizeGrid(); //Because we have the daily/weekly totals and mode buttons, we need custom grid height logic.\n\t\t\t}\n\t\t}, this.schedule_columns );\n\n\t\tthis.grid.grid.parent().parent().scrollLeft( 1000 );\n\n\t\tthis.grid.grid.parent().parent().scroll( function( e ) {\n\t\t\t$this.scroll_position = $( e.target ).scrollTop();\n\t\t} );\n\n\t\tthis.bindGridColumnEvents();\n\t}\n\n\tonResizeGrid() {\n\t\tif ( this.getMode() == ScheduleViewControllerMode.DAY ) {\n\t\t\t//Rebuild the special shift sizes\n\t\t\tthis.buildCalendars();\n\t\t} else {\n\t\t\tthis.setGridColumnsWidth();\n\t\t}\n\n\t\tthis.setGridHeight();\n\t}\n\n\t//Bind column click event to change sort type and save columns to t_grid_header_array to use to set column style (asc or desc)\n\tbindGridColumnEvents() {\n\t\tvar display_columns = this.grid.getGridParam( 'colModel' );\n\n\t\t//Exception taht display column not existed, not sure when this will happen, but may there will be a second time load if this happen\n\t\tif ( !display_columns ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar len = display_columns.length;\n\n\t\tthis.t_grid_header_array = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column_info = display_columns[i];\n\t\t\tvar column_header = $( $( this.el ).find( '#gbox_' + this.ui_id + '_grid' ).find( 'div #jqgh_' + this.ui_id + '_grid_' + column_info.name ) );\n\n\t\t\tthis.t_grid_header_array.push( column_header.TGridHeader() );\n\t\t\tcolumn_header.bind( 'click', onColumnHeaderClick );\n\t\t}\n\n\t\tvar $this = this;\n\n\t\tfunction onColumnHeaderClick( e ) {\n\t\t\tvar field = $( this ).attr( 'id' );\n\t\t\tfield = field.substring( 10 + $this.ui_id.length + 1, field.length );\n\n\t\t\tif ( field === 'cb' || field === 'punch_info' ) { //first column, check box column.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date;\n\t\t\tvar mode = $this.getMode();\n\n\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\t\t\t\tdate = $this.getCellRelatedDate( 1, colModel, $( this ).parent().index(), field );\n\t\t\t} else {\n\t\t\t\tdate = Global.strToDate( field, $this.full_format );\n\t\t\t}\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\t$this.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\t$this.highLightSelectDay();\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuildMonthCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\' ></span>' );\n\t\tvar item = row[col_model.name + '_data'];\n\t\tvar full_date_str = row[col_model.name + '_full_date'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\tif ( this.select_layout.data.display_columns.indexOf( col_model.index ) === -1 && ['user_full_name', 'shifts', 'absences', 'total_time', 'total_time_wage'].indexOf( col_model.index ) === -1 ) {\n\t\t\t\t\tif ( !cell_value ) {\n\t\t\t\t\t\tvar cell_value = { shifts: 0, absences: 0, total_time: 0, total_time_wage: 0 };\n\t\t\t\t\t}\n\n\t\t\t\t\tvar total_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences );\n\t\t\t\t\ttotal_span.text( Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + Global.MoneyRound( cell_value.total_time_wage ) );\n\n\t\t\t\t\tcontent_div.prepend( total_span );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.DATE:\n\t\t\t\ttime_span.addClass( 'date' );\n\t\t\t\tcontent_div.addClass( 'month-date-cell' );\n\t\t\t\tif ( cell_value ) {\n\n\t\t\t\t\ttime_span.html( cell_value );\n\n\t\t\t\t\tcontent_div.attr( 'id', this.ui_id + '_grid_' + full_date_str );\n\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.addClass( 'empty-date' );\n\t\t\t\t\ttime_span.text( '.' );\n\t\t\t\t}\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( Global.isSet( item ) ) {\n\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || ( item.id && item.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.addClass( 'red' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t\ttime_span.text( cell_value );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tbuildYearCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\n\t\tif ( cell_value && cell_value.length == 1 && row.user_full_name == $.i18n._( 'OPEN' ) ) { //#2353 - only way to match open shifts.\n\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t}\n\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\n\t\tif ( !cell_value ) {\n\t\t\t//performance hack to speed up dom and rendering of year mode sheet\n\t\t\treturn content_div.get( 0 ).outerHTML;\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.name + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\t// if ( !Global.isSet( cell_value ) ) {\n\t\t\t\t// \ttime_span.text( $.i18n._( 'ZE' ) );\n\t\t\t\t// }\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\n\t\t\t\tif ( col_model.index >= 0 ) {\n\n\t\t\t\t\tif ( cell_value === 'A' ) {\n\t\t\t\t\t\ttime_span.addClass( 'absence-cell' );\n\t\t\t\t\t} else if ( item && ( !item.id || ( item.id && item.id == TTUUID.zero_id ) ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\t// if ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t// \tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t// }\n\n\t\t\t\t//\n\t\t\t\t// if ( item && row.full_user_name == $.i18n._('OPEN') ) {\n\t\t\t\t// \tcontent_div.removeClass('date-column')\n\t\t\t\t// \tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t// }\n\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div[0].outerHTML;\n\t}\n\n\tcalculateScheduleWidth() {\n\t\t//Calculate width of all static columns like employee name, departments, total, etc... So we know how much room is left for the hours.\n\t\tvar static_width = 0;\n\t\tfor ( var i in this.schedule_columns ) {\n\t\t\tif ( !this.schedule_columns[i].is_static_size || this.schedule_columns[i].name == 'total' || this.schedule_columns[i].name == 'scrollbar_spacer' ) {\n\t\t\t\tstatic_width += this.schedule_columns[i].width;\n\t\t\t}\n\t\t}\n\n\t\tthis.day_hour_width = ( $( '.view' ).innerWidth() - static_width ) / $( '.day_hour_div .day_hour_span' ).length;\n\t\tDebug.Text( 'Day Hour Width: ' + this.day_hour_width + ' Static Width: ' + static_width, 'ScheduleViewController.js', 'ScheduleViewController', 'calculateScheduleWidth', 10 );\n\n\t\tif ( this.day_hour_width < 40 ) {\n\t\t\tthis.day_hour_width = 40;\n\t\t}\n\t\treturn this.day_hour_width;\n\t}\n\n\tbuildDayCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar $this = this;\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.index + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\n\t\t\t\tif ( cell_value && Global.isSet( cell_value.total_time ) ) {\n\t\t\t\t\tvar total_div = $( '<div  style=\\'text-align: left\\'></div>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences + ' ' + Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + cell_value.total_time_wage );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( cell_value.total_shifts_dic ) {\n\t\t\t\t\t\tvar shifts_array = [];\n\t\t\t\t\t\tfor ( var key in cell_value.total_shifts_dic ) {\n\t\t\t\t\t\t\tshifts_array.push( cell_value.total_shifts_dic[key] );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshifts_array = shifts_array.sort( function( a, b ) {\n\n\t\t\t\t\t\t\treturn Global.compare( a, b, 'sort_order' );\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tfor ( var i = 0; i < shifts_array.length; i++ ) {\n\t\t\t\t\t\t\tvar item = shifts_array[i];\n\t\t\t\t\t\t\tvar span = $( '<span class=\"day_hour_span\"></span>' );\n\t\t\t\t\t\t\tspan.text( item.value );\n\t\t\t\t\t\t\tspan.width( this.day_hour_width );\n\t\t\t\t\t\t\ttotal_div.append( span );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontent_div.prepend( total_div );\n\t\t\t\t\t}\n\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\n\t\t\t\t} else if ( cell_value ) {\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t} else if ( col_model.display_total_column == true ) {\n\t\t\t\t\tcurrency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\ttime_span.text( 'S: 0 A: 0 00:00 = ' + currency + '0.00' );\n\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\n\t\t\t\tif ( Global.isSet( item ) ) {\n\t\t\t\t\tcontent_div.removeClass( 'schedule-content-div' ).addClass( 'schedule-content-day-div' );\n\n\t\t\t\t\tif ( related_data.rowId % 2 === 0 ) {\n\t\t\t\t\t\ttime_span.removeClass( 'schedule-time' ).addClass( 'schedule-day-time even' );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttime_span.removeClass( 'schedule-time' ).addClass( 'schedule-day-time' );\n\t\t\t\t\t}\n\n\t\t\t\t\tvar width = $this.getDayShiftWidth( item );\n\t\t\t\t\ttime_span.width( width );\n\t\t\t\t\ttime_span.css( 'left', $this.getDayShiftOffset( item ) );\n\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || item.id == TTUUID.zero_id ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-day-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.removeClass( 'even' );\n\t\t\t\t\t\ttime_span.addClass( 'red-bg' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tgetDayShiftOffset( shift ) {\n\n\t\tvar start_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.start_date, shift.start_time ) );\n\t\tvar offset = ( start_date_time.getTime() - this.day_mode_start_date_time.getTime() ) / 3600000;\n\n\t\treturn ( offset * this.day_hour_width );\n\t}\n\n\tgetDayShiftWidth( shift ) {\n\t\tvar start_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.start_date, shift.start_time ) );\n\t\tvar end_date_time = Global.strToDateTime( Global.getStandardDateTimeStr( shift.end_date, shift.end_time ) );\n\t\tvar offset = ( end_date_time.getTime() - start_date_time.getTime() ) / 3600000;\n\n\t\t//Debug.Text( 'Using Day Hour Width: '+ this.day_hour_width , 'ScheduleViewController.js', 'ScheduleViewController', 'getDayShiftWidth', 10 );\n\t\treturn ( offset * this.day_hour_width );\n\t}\n\n\tbuildWeekCell( cell_value, related_data, row, is_day_column ) {\n\t\tvar col_models = this.grid.getGridParam( 'colModel' );\n\n\t\tvar col_model = related_data.colModel;\n\t\tvar content_div = $( '<div class=\\'schedule-content-div\\'></div>' );\n\t\tif ( is_day_column ) {\n\t\t\tcontent_div.addClass( 'date-column' );\n\t\t}\n\t\tvar time_span = $( '<span class=\\'schedule-time\\'></span>' );\n\t\tvar item = row[col_model.index + '_data'];\n\n\t\tswitch ( row.type ) {\n\t\t\tcase ScheduleViewControllerRowType.TOTAL:\n\t\t\t\ttime_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\tif ( this.select_layout.data.display_columns.indexOf( col_model.index ) === -1 && ['user_full_name', 'shifts', 'absences', 'total_time', 'total_time_wage'].indexOf( col_model.index ) === -1 ) {\n\t\t\t\t\tif ( !cell_value ) {\n\t\t\t\t\t\tvar cell_value = { shifts: 0, absences: 0, total_time: 0, total_time_wage: 0 };\n\t\t\t\t\t}\n\n\t\t\t\t\tvar total_span = $( '<span class=\\'schedule-time total\\'></span>' );\n\t\t\t\t\tvar currency = LocalCacheData.getCurrentCurrencySymbol();\n\t\t\t\t\ttime_span.text( 'S: ' + cell_value.shifts + ' A: ' + cell_value.absences );\n\t\t\t\t\ttotal_span.text( Global.getTimeUnit( cell_value.total_time ) + ' = ' + currency + Global.MoneyRound( cell_value.total_time_wage ) );\n\n\t\t\t\t\tcontent_div.prepend( total_span );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\t\t\t\t\tcontent_div.css( 'height', 'auto' );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerRowType.EMPTY:\n\t\t\t\tif ( !Global.isSet( cell_value ) ) {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\ttime_span.addClass( 'empty' );\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif ( Global.isSet( item ) ) {\n\t\t\t\t\tif ( !Global.isSet( item.id ) || !item.id || ( item.id && item.id == TTUUID.zero_id ) ) {\n\t\t\t\t\t\ttime_span.addClass( 'no-id' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.status_id == 20 ) {\n\t\t\t\t\t\ttime_span.addClass( 'red' );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( item.user_id === TTUUID.zero_id ) {\n\t\t\t\t\t\tcontent_div.addClass( 'yellow-outline' );\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Global.isSet( cell_value ) ) {\n\n\t\t\t\t\tif ( Global.isSet( item ) && item.note && cell_value.indexOf( '*' ) == -1 ) {\n\t\t\t\t\t\tcell_value = '*' + cell_value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( related_data.pos === col_models.length - 1 ) {\n\t\t\t\t\t\tcontent_div.css( 'padding-right', '15px' );\n\t\t\t\t\t}\n\n\t\t\t\t\ttime_span.text( cell_value );\n\t\t\t\t} else {\n\t\t\t\t\ttime_span.text( '' );\n\t\t\t\t}\n\n\t\t\t\tcontent_div.prepend( time_span );\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn content_div.get( 0 ).outerHTML;\n\t}\n\n\tonCellFormat( cell_value, related_data, row ) {\n\t\t//cell_value = Global.decodeCellValue( cell_value );\n\t\t/**\n\t\t * FIXES BUG #1999: removed because it was double-encoding values in an attempt to avoid xss attacks.\n\t\t * the following functions handle the needed encoding using a pseudo div element and .outerHTML()\n\t\t * with this function in place, html encoded values come through to jqgrid double-encoded in the schedule view.\n\t\t **/\n\n\t\tvar retval = '';\n\t\tvar $this = this;\n\t\tvar is_day_column = true;\n\n\t\tif ( related_data.colModel.index == 'user_full_name' ) { //always part of grid.\n\t\t\tis_day_column = false;\n\t\t} else {\n\t\t\tfor ( var n in this.all_columns ) {\n\t\t\t\tif ( related_data.colModel.label == this.all_columns[n].label ) {\n\t\t\t\t\tis_day_column = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tswitch ( this.getMode() ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\treturn this.buildWeekCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\treturn this.buildMonthCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\treturn this.buildYearCell( cell_value, related_data, row, is_day_column );\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\treturn this.buildDayCell( cell_value, related_data, row, is_day_column );\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tonSelectRow( grid_id, row_id, target ) {\n\t\tvar $this = this;\n\t\tvar row_tr = $( target ).find( '#' + row_id );\n\t\trow_tr.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\n\t\tvar cells_array = $this.select_cells_Array;\n\t\tvar len = $this.select_cells_Array.length;\n\n\t\tthis.select_all_shifts_array = [];\n\t\tthis.select_shifts_array = [];\n\t\tthis.select_recurring_shifts_array = [];\n\t\tthis.select_cellls_and_shifts_array = [];\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\trow_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.addClass( 'ui-state-highlight' ).attr( 'aria-selected', true );\n\t\t\tinfo.row_id = info.row_id - 0;\n\t\t\tif ( info.shift ) {\n\t\t\t\tif ( Global.isSet( info.shift.start_date ) ) { //date + time number\n\t\t\t\t\tinfo.shift.start_date_num = Global.strToDateTime( info.shift.start_date ).getTime();\n\n\t\t\t\t} else {\n\t\t\t\t\tinfo.shift.start_date_num = info.time_stamp_num; //Uer time_stamp_num from cell select setting, a date number\n\t\t\t\t}\n\t\t\t\tinfo.shift.row_index = info.row_id - 1;\n\t\t\t\tinfo.shift.cell_index = info.cell_index - 1;\n\n\t\t\t\tinfo.shift.orginal_row_index = info.row_id;\n\t\t\t\tinfo.shift.orginal_cell_index = info.cell_index;\n\n\t\t\t\tthis.select_all_shifts_array.push( info.shift );\n\t\t\t\tthis.select_cellls_and_shifts_array.push( info );\n\n\t\t\t\tif ( info.shift.id && info.shift_id != TTUUID.zero_id ) {\n\t\t\t\t\tthis.select_shifts_array.push( info.shift );\n\t\t\t\t} else {\n\t\t\t\t\tthis.select_recurring_shifts_array.push( info.shift );\n\t\t\t\t}\n\n\t\t\t\tthis.select_all_shifts_array.sort( function( a, b ) {\n\t\t\t\t\tif ( a.cell_index < b.cell_index ) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tif ( a.cell_index > b.cell_index ) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( a.cell_index === b.cell_index ) {\n\t\t\t\t\t\tif ( a.row_index < b.row_index ) {\n\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( a.row_index > b.row_index ) {\n\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn 0;\n\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tthis.select_cellls_and_shifts_array.push( info );\n\t\t\t}\n\n\t\t\tthis.select_cellls_and_shifts_array.sort( function( a, b ) {\n\t\t\t\tif ( a.cell_index < b.cell_index ) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif ( a.cell_index > b.cell_index ) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\n\t\t\t\tif ( a.cell_index === b.cell_index ) {\n\t\t\t\t\tif ( a.row_id < b.row_id ) {\n\t\t\t\t\t\treturn -1;\n\t\t\t\t\t}\n\t\t\t\t\tif ( a.row_id > b.row_id ) {\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn 0;\n\n\t\t\t} );\n\n\t\t}\n\n\t\tthis.setDefaultMenu();\n\t}\n\n\tgetCellRelatedDate( row_index, col_model, cell_index, data_field ) {\n\t\tvar date;\n\t\tvar date_row_1_index = this.schedule_source.indexOf( this.month_date_row_array[0] );\n\t\tvar date_row_2_index = this.schedule_source.indexOf( this.month_date_row_array[1] );\n\t\tvar date_row_3_index = this.schedule_source.indexOf( this.month_date_row_array[2] );\n\t\tvar date_row_4_index = this.schedule_source.indexOf( this.month_date_row_array[3] );\n\n\t\tif ( row_index < date_row_1_index ) {\n\t\t\tdate = Global.strToDate( col_model[cell_index].index, this.full_format );\n\t\t} else if ( row_index >= date_row_1_index && row_index < date_row_2_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[0][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_2_index && row_index < date_row_3_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[1][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_3_index && row_index < date_row_4_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[2][data_field + '_full_date'], this.full_format );\n\t\t} else if ( row_index >= date_row_4_index ) {\n\t\t\tdate = Global.strToDate( this.month_date_row_array[3][data_field + '_full_date'], this.full_format );\n\t\t}\n\n\t\treturn date;\n\t}\n\n\tgetDataByCellIndex( row_index, cell_index ) {\n\t\tvar $this = this;\n\t\tvar row = $this.schedule_source[row_index];\n\t\tvar colModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t//Error: TypeError: row is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-134330 line 2 > eval line 5952\n\t\t//Error: TypeError: colModel[cell_index] is undefined in /interface/html5/framework/jquery.min.js?v=8.0.0-20141117-134330 line 2 > eval line 5951\n\t\tif ( !colModel || !colModel[cell_index] || !row ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar data_field = colModel[cell_index].name;\n\t\tvar data = row[data_field + '_data'];\n\n\t\treturn data;\n\t}\n\n\tonCellSelect( grid_id, row_id, cell_index, cell_val, target, e ) {\n\t\t$( '#ribbon_view_container .context-menu:visible a' ).click();\n\n\t\tif ( cell_index < 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar $this = this;\n\t\tvar len = 0;\n\t\tvar row;\n\t\tvar colModel;\n\t\tvar data_field;\n\t\tvar shift;\n\t\tvar cells_array = [];\n\t\tvar date;\n\t\tvar mode = this.getMode();\n\n\t\tcells_array = $this.select_cells_Array;\n\n\t\tlen = $this.select_cells_Array.length;\n\n\t\trow = $this.schedule_source[row_id - 1];\n\n\t\tvar row_index = $this.schedule_source.indexOf( row );\n\n\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\n\t\tdata_field = colModel[cell_index].name;\n\n\t\tshift = row[data_field + '_data'];\n\n\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\tdate = $this.getCellRelatedDate( row_index, colModel, cell_index, data_field );\n\t\t} else {\n\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t}\n\n\t\tif ( !date || date.getTime() < -1 ) {\n\t\t\tdate = new Date();\n\t\t}\n\n\t\t//Clean all select cells first\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar info = cells_array[i];\n\t\t\tvar row_tr = $( target ).find( '#' + info.row_id );\n\t\t\tvar cell_td = $( row_tr.find( 'td' )[info.cell_index] );\n\t\t\tcell_td.removeClass( 'ui-state-highlight' ).attr( 'aria-selected', false );\n\t\t}\n\n\t\tif ( date ) {\n\t\t\tvar date_str = date.format();\n\t\t\tvar time_stamp_num = Global.strToDate( date_str ).getTime();\n\t\t} else {\n\t\t\tdate_str = '';\n\t\t\ttime_stamp_num = 0;\n\t\t}\n\t\t// Add multiple selection if click cell and hold ctrl or command\n\t\tif ( e.ctrlKey || e.metaKey ) {\n\t\t\tvar found = false;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\t\t\t\t// row id should be number\n\t\t\t\tif ( parseInt( row_id ) === info.row_id && cell_index === info.cell_index ) {\n\t\t\t\t\tcells_array.splice( i, 1 );\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( !found ) {\n\n\t\t\t\tcells_array.push( {\n\t\t\t\t\trow_id: row_id,\n\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\tshift: shift,\n\t\t\t\t\tdate: date_str,\n\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\tjob_item_id: row.job_item_id\n\t\t\t\t} );\n\n\t\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\t\tthis.select_cells_Array.sort( function( a, b ) {\n\n\t\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} else if ( e.shiftKey ) {\n\t\t\tvar start_row_index = row_id;\n\t\t\tvar start_cell_index = cell_index;\n\n\t\t\tvar end_row_index = row_id;\n\t\t\tvar end_cell_index = cell_index;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tinfo = cells_array[i];\n\n\t\t\t\tif ( parseInt( info.row_id ) < parseInt( start_row_index ) ) {\n\t\t\t\t\tstart_row_index = info.row_id;\n\t\t\t\t} else if ( parseInt( info.row_id ) > parseInt( end_row_index ) ) {\n\t\t\t\t\tend_row_index = info.row_id;\n\t\t\t\t}\n\n\t\t\t\tif ( parseInt( info.cell_index ) < parseInt( start_cell_index ) ) {\n\t\t\t\t\tstart_cell_index = info.cell_index;\n\t\t\t\t} else if ( parseInt( info.cell_index ) > parseInt( end_cell_index ) ) {\n\t\t\t\t\tend_cell_index = info.cell_index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//If the click is inside the existing selection, truncate the existing selection to the click.\n\t\t\t//Check in TimeSheetViewController.js for related change\n\t\t\tif ( cells_array[cells_array.length - 1] && cells_array[0] && cells_array[cells_array.length - 1].cell_index >= cell_index && cells_array[0].cell_index <= cell_index && cells_array[cells_array.length - 1].row_id >= row_id && cells_array[0].row_id <= row_id ) {\n\t\t\t\tend_row_index = row_id;\n\t\t\t\tend_cell_index = cell_index;\n\t\t\t}\n\n\t\t\tstart_row_index = parseInt( start_row_index );\n\t\t\tend_row_index = parseInt( end_row_index );\n\t\t\tcells_array = [];\n\n\t\t\tfor ( var i = start_row_index; i <= end_row_index; i++ ) {\n\t\t\t\tvar r_index = i;\n\t\t\t\tfor ( var j = start_cell_index; j <= end_cell_index; j++ ) {\n\t\t\t\t\tvar c_index = j;\n\n\t\t\t\t\trow_tr = $( target ).find( '#' + r_index );\n\n\t\t\t\t\tcell_td = $( row_tr.find( 'td' )[c_index] );\n\n\t\t\t\t\tcell_val = cell_td[0].outerHTML;\n\n\t\t\t\t\trow = $this.schedule_source[r_index - 1];\n\n\t\t\t\t\trow_index = $this.schedule_source.indexOf( row );\n\n\t\t\t\t\tcolModel = $this.grid.getGridParam( 'colModel' );\n\n\t\t\t\t\tdata_field = colModel[c_index].name;\n\n\t\t\t\t\tshift = row[data_field + '_data'];\n\n\t\t\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\t\t\tdate = $this.getCellRelatedDate( row_index, colModel, c_index, data_field );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate = Global.strToDate( data_field, this.full_format );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( date && date.getTime() > 0 ) {\n\t\t\t\t\t\tdate_str = date.format();\n\t\t\t\t\t\ttime_stamp_num = Global.strToDate( date_str ).getTime();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdate_str = '';\n\t\t\t\t\t\ttime_stamp_num = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcells_array.push( {\n\t\t\t\t\t\trow_id: r_index.toString(),\n\t\t\t\t\t\tcell_index: c_index,\n\t\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\t\tshift: shift,\n\t\t\t\t\t\tdate: date_str,\n\t\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\t\tjob_item_id: row.job_item_id\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\tthis.select_cells_Array.sort( function( a, b ) {\n\n\t\t\t\treturn Global.compare( a, b, 'time_stamp_num' );\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tcells_array = [\n\t\t\t\t{\n\t\t\t\t\trow_id: row_id,\n\t\t\t\t\tcell_index: cell_index,\n\t\t\t\t\tcell_val: cell_val,\n\t\t\t\t\tshift: shift,\n\t\t\t\t\tdate: date_str,\n\t\t\t\t\ttime_stamp_num: time_stamp_num,\n\t\t\t\t\tuser_id: row.user_id,\n\t\t\t\t\tbranch_id: row.branch_id,\n\t\t\t\t\tdepartment_id: row.department_id,\n\t\t\t\t\tjob_id: row.job_id,\n\t\t\t\t\tjob_item_id: row.job_item_id\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t$this.select_cells_Array = cells_array;\n\n\t\t\tif ( date && date.getYear() > 0 ) {\n\t\t\t\tthis.setDatePickerValue( date.format( Global.getLoginUserDateFormat() ) );\n\t\t\t\tthis.highLightSelectDay();\n\t\t\t}\n\n\t\t}\n\n\t\t$this.onSelectRow( grid_id, row_id, target );\n\n\t\tvar target_row_tr = $( target ).find( '#' + row_id );\n\t\tvar target_row_td = $( target_row_tr.find( 'td' )[cell_index] );\n\n\t\tif ( target_row_td.attr( 'infor_column' ) ) {\n\t\t\tvar target_row_index = target_row_tr.index();\n\t\t\tvar rowspan = parseInt( target_row_td.attr( 'rowspan' ) );\n\n\t\t\tif ( isNaN( rowspan ) ) {\n\t\t\t\trowspan = 1;\n\t\t\t}\n\n\t\t\tvar last_row = target_row_tr.parent().children().eq( ( target_row_index + rowspan - 1 ) );\n\t\t\tvar last_td = last_row.children().eq( ( last_row.children().length - 1 ) );\n\n\t\t\tvar last_row_id = last_row.attr( 'id' );\n\t\t\tvar last_cell_id = ( last_row.children().length - 1 );\n\t\t\tvar last_cell_value = last_td.find( '.schedule-time' ).text();\n\n\t\t\t$this.onCellSelect( 'timesheet_grid', last_row_id,\n\t\t\t\tlast_cell_id,\n\t\t\t\tlast_cell_value,\n\t\t\t\tthis.grid.grid,\n\t\t\t\t{ shiftKey: true } );\n\n\t\t}\n\t}\n\n\thighLightSelectDay() {\n\n\t\tvar mode = this.getMode();\n\n\t\t$( '.highlight-header' ).removeClass( 'highlight-header' ); //Clean all hight light header or date row\n\n\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\tvar select_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\tvar select_day = select_date.getDay(); // column index is day number for month mode\n\t\t\tselect_date = select_date.format( this.full_format );\n\n\t\t\tvar header = $( '#' + this.ui_id + '_grid_' + select_day );\n\t\t\tvar header_text = $( header.children()[1] ).text();\t //get current column header value\n\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date ); //get date row\n\n\t\t\tif ( this.highlight_header.length !== 1 ) {\n\t\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_day ); //get header\n\t\t\t} else {\n\t\t\t\tif ( header_text === this.highlight_header.text() ) {\n\t\t\t\t\t$( '.highlight-header' ).removeClass( 'highlight-header' );\n\t\t\t\t\theader.addClass( 'highlight-header' );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\tselect_date = Global.strToDate( this.start_date_picker.getValue() );\n\t\t\t//Error: Uncaught TypeError: Cannot read property 'format' of null in interface/html5/#!m=Schedule&date=null&mode=week line 6295\n\t\t\tif ( !select_date ) {\n\t\t\t\tselect_date = new Date();\n\t\t\t\tthis.setDatePickerValue( select_date.format() );\n\t\t\t}\n\t\t\tselect_date = select_date.format( this.full_format );\n\t\t\tthis.highlight_header = $( '#' + this.ui_id + '_grid_' + select_date );\n\t\t}\n\n\t\tif ( mode !== ScheduleViewControllerMode.DAY ) {\n\n\t\t\tif ( mode === ScheduleViewControllerMode.MONTH ) {\n\t\t\t\tthis.highlight_header.parent().addClass( 'highlight-header' );\n\t\t\t}\n\n\t\t\tthis.highlight_header.addClass( 'highlight-header' );\n\n\t\t}\n\t}\n\n\tbuildAllModeCommonColumns() {\n\t\tvar $this = this;\n\t\tthis.shift_key_name_array = ['user_id'];\n\t\tvar display_columns = this.buildDisplayColumns( this.select_layout.data.display_columns );\n\n\t\tvar len = display_columns.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar column = display_columns[i];\n\t\t\tvar column_info = {\n\t\t\t\tname: column.value,\n\t\t\t\tindex: column.value,\n\t\t\t\tlabel: column.label,\n\t\t\t\twidth: 122,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tfixed: true,\n\t\t\t\tresizable: false,\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\t\tvar field_name = cm.index;\n\t\t\t\t\treturn 'class=\"' + field_name + '_cell\" infor_column=\"true\"';\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\t\t\tthis.shift_key_name_array.push( column.value + '_id' );\n\t\t}\n\n\t\tvar employee_column = {\n\t\t\tname: 'user_full_name',\n\t\t\tindex: 'user_full_name',\n\t\t\tlabel: $.i18n._( 'Employee' ),\n\t\t\twidth: 122,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t},\n\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\tvar field_name = cm.index;\n\t\t\t\treturn 'class=\"' + field_name + '_cell\" infor_column=\"true\"';\n\t\t\t}\n\t\t};\n\n\t\tthis.schedule_columns.push( employee_column );\n\t}\n\n\tbuildMonthRows() {\n\n\t\tvar month_days = ( this.end_date.getTime() - this.start_date.getTime() ) / 86400000 + 1;\n\t\tvar start_day = new Date( this.start_date.getTime() ).getDay();\n\t\tthis.schedule_source = [];\n\t\tvar start_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + 7 ) );\n\n\t\tthis.month_date_row_array = [];\n\n\t\tvar row_num = 1;\n\t\tvar z = 0; //day offset\n\n\t\twhile ( row_num < 5 ) {\n\t\t\tvar current_day = start_day;\n\t\t\tvar row = this.getEmptyWeeklyRow();\n\t\t\trow.type = ScheduleViewControllerRowType.DATE;\n\n\t\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\t\tvar current_date = new Date( new Date( start_date.getTime() ).setDate( start_date.getDate() + z ) );\n\n\t\t\t\tif ( current_date.getTime() > this.end_date.getTime() ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\trow[current_day] = current_date.format( this.weekly_format );\n\n\t\t\t\trow[current_day] = this.setHolidayHeader( row[current_day] );\n\t\t\t\trow[current_day + '_full_date'] = current_date.format( this.full_format );\n\t\t\t\trow[current_day + '_time'] = current_date.getTime();\n\n\t\t\t\tcurrent_day = current_day + 1;\n\n\t\t\t\tif ( current_day === 7 ) {\n\t\t\t\t\tcurrent_day = 0;\n\t\t\t\t}\n\n\t\t\t\tz = z + 1;\n\t\t\t}\n\n\t\t\tthis.month_date_row_array.push( row );\n\t\t\trow_num = row_num + 1;\n\n\t\t\tthis.schedule_source.push( row );\n\n\t\t}\n\t}\n\n\tgetEmptyWeeklyRow() {\n\t\tvar row = {};\n\t\trow.user_full_name = '';\n\t\trow.last_name = '';\n\t\trow.user_id = '';\n\t\trow.branch_id = '';\n\t\trow.department_id = '';\n\t\trow.schedule_policy_id = '';\n\t\trow.job_id = '';\n\t\trow.job_item_id = '';\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var j = 0; j < display_columns_len; j++ ) {\n\t\t\tvar field_name = display_columns[j];\n\t\t\trow[field_name] = '';\n\t\t}\n\n\t\treturn row;\n\t}\n\n\tbuildMonthColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\t\tthis.buildAllModeCommonColumns();\n\n//\t\tvar current_date = new Date( this.start_date.getTime() );\n\n\t\tthis.month_date_row_tr_ids = {};\n\t\tfor ( var i = 0; i < 7; i++ ) {\n\t\t\tvar temp_start_date = new Date( this.start_date.getTime() );\n\t\t\tvar current_date = new Date( temp_start_date.setDate( temp_start_date.getDate() + i ) );\n\t\t\tvar start_day = current_date.getDay();\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = start_day;\n\t\t\tif ( data_field === 7 ) {\n\t\t\t\tdata_field = 0;\n\t\t\t}\n\n\t\t\theader_text = this.setHolidayHeader( header_text );\n\n\t\t\tvar full_data_field = current_date.format( this.full_format );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field.toString(), //Needed for jqgrid otherwise it thinks its an index lookup.\n\t\t\t\tindex: full_data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 150,\n\t\t\t\tfixed: true,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tcellattr: function( rowId, tv, rawObject, cm, rdata ) {\n\t\t\t\t\tif ( rawObject.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\t\t\t$this.month_date_row_tr_ids[rowId] = true;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tis_static_size: true\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t}\n\n\t\tthis.buildWeeklyTotalColumns();\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: 15,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\tthis.buildMonthRows();\n\t}\n\n\tgetDayByDayNum( day ) {\n\n\t\tvar day;\n\t\tswitch ( day ) {\n\t\t\tcase 0:\n\t\t\t\tday = $.i18n._( 'S' );\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tday = $.i18n._( 'M' );\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tday = $.i18n._( 'T' );\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tday = $.i18n._( 'W' );\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tday = $.i18n._( 'T' );\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tday = $.i18n._( 'F' );\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\tday = $.i18n._( 'S' );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn day;\n\t}\n\n\tbuildYearColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar end_date = new Date( this.end_date.getTime() );\n\n\t\tvar i = 0;\n\t\twhile ( current_date.format( this.full_format ) !== end_date.format( this.full_format ) ) {\n\n\t\t\tcurrent_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\tvar day = this.getDayByDayNum( current_date.getDay() );\n\n\t\t\tvar column_info = {\n\t\t\t\tname: data_field,\n\t\t\t\tindex: i,\n\t\t\t\tlabel: day + '<br>' + current_date.getDate(),\n\t\t\t\twidth: 22,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tfixed: true,\n\t\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t\ti = i + 1;\n\t\t}\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: i,\n\t\t\tlabel: '',\n\t\t\twidth: 15,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\t//this.buildWeeklyTotalColumns();\n\t}\n\n\tbuildDayColumns() {\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar header_text = current_date.format( this.weekly_format );\n\t\tvar data_field = current_date.format( this.full_format );\n\n\t\tvar column_info = {\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\twidth: 500,\n\t\t\tname: data_field,\n\t\t\tindex: data_field,\n\t\t\tlabel: 'daily_header_replace',\n\t\t\tis_static_size: true,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tdisplay_total_column: true,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t}\n\t\t};\n\t\tthis.schedule_columns.push( column_info );\n\n\t\tcolumn_info = {\n\t\t\tfixed: true,\n\t\t\tresizable: false,\n\t\t\twidth: 122,\n\t\t\tname: 'total',\n\t\t\tindex: 'total',\n\t\t\tlabel: 'Total Time',\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tformatter: function() {\n\n\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t}\n\t\t};\n\t\tthis.schedule_columns.push( column_info );\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: 15,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\t//is_static_size: false, //Used to skip our own auto-sizing.\n\t\t} );\n\t}\n\n\tbuildWeekColumns() {\n\n\t\tvar $this = this;\n\t\tthis.schedule_columns = [];\n\n\t\tthis.buildAllModeCommonColumns();\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'getTime' of null in /interface/html5/#!m=Schedule&date=20141208&mode=week line 6580\n\t\tif ( !this.start_date ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar current_date = new Date( this.start_date.getTime() );\n\t\tvar end_date = new Date( this.end_date.getTime() );\n\n\t\tvar i = 0;\n\t\tvar set_fixed_width = false;\n//\t\tif ( this.schedule_columns.length === 1 ) {\n//\t\t\tset_fixed_width = false;\n//\t\t}\n\n\t\twhile ( current_date.format( this.full_format ) !== end_date.format( this.full_format ) ) {\n\n\t\t\tcurrent_date = new Date( new Date( this.start_date.getTime() ).setDate( this.start_date.getDate() + i ) );\n\n\t\t\tvar header_text = current_date.format( this.weekly_format );\n\t\t\tvar data_field = current_date.format( this.full_format );\n\n\t\t\theader_text = this.setHolidayHeader( header_text );\n\n\t\t\tvar column_info = {\n\t\t\t\tresizable: false,\n\t\t\t\tname: data_field.toString(), //Needed for jqgrid otherwise it thinks its an index lookup.\n\t\t\t\tindex: data_field,\n\t\t\t\tlabel: header_text,\n\t\t\t\twidth: 150,\n\t\t\t\tfixed: true,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tis_static_size: true\n\t\t\t};\n\n\t\t\tthis.schedule_columns.push( column_info );\n\n\t\t\ti = i + 1;\n\n\t\t}\n\n\t\tthis.buildWeeklyTotalColumns();\n\n\t\tthis.schedule_columns.push( {\n\t\t\tname: 'scrollbar_spacer',\n\t\t\tindex: 'scrollbar_spacer',\n\t\t\tlabel: '',\n\t\t\twidth: 15,\n\t\t\tsortable: false,\n\t\t\ttitle: false,\n\t\t\tfixed: true,\n\t\t\tis_static_size: true, //Used to skip our own auto-sizing.\n\t\t} );\n\n\t\treturn this.schedule_columns;\n\t}\n\n\tsetHolidayHeader( header_text, inLine ) {\n\n\t\tif ( this.holiday_data_dic ) {\n\t\t\tif ( this.holiday_data_dic[header_text] ) {\n\n\t\t\t\tif ( inLine ) {\n\t\t\t\t\theader_text = header_text + ' (' + this.holiday_data_dic[header_text].name + ')';\n\t\t\t\t} else {\n\t\t\t\t\theader_text = header_text + '<br>' + this.holiday_data_dic[header_text].name;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\treturn header_text;\n\t}\n\n\tbuildWeeklyTotalColumns() {\n\t\tvar $this = this;\n\t\tvar show_weekly_total = this.weekly_totals_btn.getValue();\n\n\t\tvar is_fixed = false;\n\n\t\tif ( show_weekly_total ) {\n\t\t\tvar shifts_column = {\n\t\t\t\tname: 'shifts',\n\t\t\t\tindex: 'shifts',\n\t\t\t\tlabel: $.i18n._( 'Shifts' ),\n\t\t\t\twidth: 50,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar absences_column = {\n\t\t\t\tname: 'absences',\n\t\t\t\tindex: 'absences',\n\t\t\t\tlabel: $.i18n._( 'Absences' ),\n\t\t\t\twidth: 70,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar total_time = {\n\t\t\t\tname: 'total_time',\n\t\t\t\tindex: 'total_time',\n\t\t\t\tlabel: $.i18n._( 'Total Time' ),\n\t\t\t\twidth: 70,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tvar total_time_wage = {\n\t\t\t\tname: 'total_time_wage',\n\t\t\t\tindex: 'total_time_wage',\n\t\t\t\tlabel: $.i18n._( 'Wages' ),\n\t\t\t\twidth: 90,\n\t\t\t\tsortable: false,\n\t\t\t\ttitle: false,\n\t\t\t\tformatter: function() {\n\t\t\t\t\treturn $this.onCellFormat( arguments[0], arguments[1], arguments[2], arguments[3] );\n\t\t\t\t},\n\t\t\t\tfixed: true\n\t\t\t};\n\n\t\t\tthis.schedule_columns.push( shifts_column );\n\t\t\tthis.schedule_columns.push( absences_column );\n\t\t\tthis.schedule_columns.push( total_time );\n\t\t\tthis.schedule_columns.push( total_time_wage );\n\t\t}\n\t}\n\n\tbuildScheduleColumns() {\n\t\tthis.shift_key_name_array = ['user_id'];\n\t\tthis.schedule_columns = [];\n\n\t\tvar mode = this.getMode();\n\n\t\tswitch ( mode ) {\n\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\tthis.buildWeekColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tthis.buildMonthColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\tthis.buildYearColumns();\n\t\t\t\tbreak;\n\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tthis.buildDayColumns();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tsetScheduleGridRowSpan() {\n\n\t\tvar $this = this;\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var i = 0; i < display_columns_len; i++ ) {\n\t\t\tvar column_name = display_columns[i];\n\n\t\t\tstartSet( column_name );\n\t\t}\n\n\t\tstartSet( 'user_full_name' );\n\n\t\tfunction startSet( key ) {\n\t\t\tvar cells = $this.grid.grid.find( '[aria-describedby=' + $this.ui_id + '_grid_' + key + ']' );\n\n\t\t\tvar len = cells.length;\n\n\t\t\tvar count = 0;\n\n\t\t\tvar last_val = null;\n\n\t\t\tvar last_cell = null;\n\n\t\t\tvar need_remove_cells = [];\n\n\t\t\tvar start = len - 1;\n\n\t\t\tsetRows();\n\n\t\t\tfunction setRows() {\n\t\t\t\tfor ( var i = start; i >= 0; i-- ) {\n\t\t\t\t\tvar cell = $( cells[i] );\n\t\t\t\t\tvar cell_val = $( cells[i] ).children().eq( 0 ).children().eq( 0 ).text();\n\n\t\t\t\t\tif ( i === len - 1 ) {\n\t\t\t\t\t\tlast_val = cell_val;\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tlast_cell = cell;\n\t\t\t\t\t} else if ( last_val !== cell_val ) {\n\t\t\t\t\t\tlast_val = cell_val;\n\t\t\t\t\t\tlast_cell.attr( 'rowspan', count );\n\n\t\t\t\t\t\tfor ( var j = 0; j < need_remove_cells.length; j++ ) {\n\t\t\t\t\t\t\tvar need_removed_cell = need_remove_cells[j];\n//\t\t\t\t\t\t\tneed_removed_cell.addClass( 'need-remove' );\n\t\t\t\t\t\t\tvar node = need_removed_cell[0];\n\t\t\t\t\t\t\tif ( node.parentNode ) {\n\t\t\t\t\t\t\t\tnode.style.display = 'none';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tneed_removed_cell = [];\n\t\t\t\t\t\tcount = 1;\n\t\t\t\t\t\tlast_cell = cell;\n\n\t\t\t\t\t} else if ( i === 0 ) {\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tneed_remove_cells.push( last_cell );\n\t\t\t\t\t\tif ( count > 1 ) {\n\t\t\t\t\t\t\tcell.attr( 'rowspan', count );\n\t\t\t\t\t\t\tfor ( var j = 0; j < need_remove_cells.length; j++ ) {\n\t\t\t\t\t\t\t\tneed_removed_cell = need_remove_cells[j];\n//\t\t\t\t\t\t\t\tneed_removed_cell.addClass( 'need-remove' );\n\t\t\t\t\t\t\t\tnode = need_removed_cell[0];\n\t\t\t\t\t\t\t\tif ( node.parentNode ) {\n\t\t\t\t\t\t\t\t\tnode.style.display = 'none';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcount = count + 1;\n\t\t\t\t\t\tneed_remove_cells.push( last_cell );\n\t\t\t\t\t\tlast_cell = cell;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonSetSearchFilterFinished() {\n\t}\n\n\tonBuildBasicUIFinished() {\n\t}\n\n\tonBuildAdvUIFinished() {\n\t}\n\n\t// setDateUrl() {\n\t// \tvar $this = this;\n\t// \tif ( !$this.edit_view ) {\n\t//\n\t// \t\tvar mode = this.getMode();\n\t// \t\tvar default_date = $this.start_date_picker.getDefaultFormatValue();\n\t//\n\t// \t\tif ( mode ) {\n\t// \t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date + '&mode=' + mode;\n\t// \t\t} else {\n\t// \t\t\tif ( LocalCacheData.getAllURLArgs() && LocalCacheData.getAllURLArgs().mode ) {\n\t// \t\t\t\t$this.setToggleButtonValue( LocalCacheData.getAllURLArgs().mode );\n\t// \t\t\t\tmode = this.getMode();\n\t// \t\t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date + '&mode=' + mode;\n\t// \t\t\t} else {\n\t// \t\t\t\twindow.location = Global.getBaseURL() + '#!m=' + $this.viewId + '&date=' + default_date;\n\t// \t\t\t}\n\t// \t\t}\n\t//\n\t// \t}\n\t// },\n\n\treSetURL() {\n\t\tvar mode = this.getMode();\n\t\tvar args;\n\t\tif ( mode ) {\n\t\t\t//args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode;\n\t\t\targs = '#!m=' + this.viewId + '&mode=' + mode;\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\t} else {\n\t\t\t//args = '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue();\n\t\t\targs = '#!m=' + this.viewId;\n\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + args );\n\t\t}\n\t\tLocalCacheData.setAllURLArgs( Global.buildArgDic( args.split( '&' ) ) );\n\t}\n\n\tsetURL() {\n\t\tvar a = '';\n\t\tswitch ( LocalCacheData.current_doing_context_action ) {\n\t\t\tcase 'new':\n\t\t\tcase 'edit':\n\t\t\tcase 'view':\n\t\t\t\ta = LocalCacheData.current_doing_context_action;\n\t\t\t\tbreak;\n\t\t\tcase 'copy_as_new':\n\t\t\t\ta = 'new';\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( this.canSetURL() ) {\n\t\t\tvar tab_name = this.edit_view_tab ? this.edit_view_tab.find( '.edit-view-tab-bar-label' ).children().eq( this.getEditViewTabIndex() ).text() : '';\n\t\t\ttab_name = tab_name.replace( /\\/|\\s+/g, '' );\n\n\t\t\tvar mode = this.getMode();\n\n\t\t\tif ( this.current_edit_record && this.current_edit_record.id && this.current_edit_record.id != TTUUID.zero_id ) {\n\t\t\t\tif ( a ) {\n\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + a + '&id=' + this.current_edit_record.id +\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + a + '&id=' + this.current_edit_record.id +\n\t\t\t\t\t\t'&tab=' + tab_name );\n\n\t\t\t\t} else {\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&id=' + this.current_edit_record.id );\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&id=' + this.current_edit_record.id );\n\n\t\t\t\t}\n\n\t\t\t\tGlobal.trackView( this.viewId, LocalCacheData.current_doing_context_action );\n\n\t\t\t} else {\n\t\t\t\tif ( a ) {\n\n\t\t\t\t\t//Edit a record which don't have id, schedule view Recurring Scedule\n\t\t\t\t\tif ( a === 'edit' ) {\n\t\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + 'new' +\n\t\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + 'new' +\n\t\t\t\t\t\t\t'&tab=' + tab_name );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode + '&a=' + a +\n\t\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode + '&a=' + a +\n\t\t\t\t\t\t\t'&tab=' + tab_name );\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\t//Global.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&date=' + this.start_date_picker.getDefaultFormatValue() + '&mode=' + mode );\n\t\t\t\t\tGlobal.setURLToBrowser( Global.getBaseURL() + '#!m=' + this.viewId + '&mode=' + mode );\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t}\n\n\tclearSelection() {\n\t\tif ( this.grid && this.grid.grid ) {\n\t\t\tthis.grid.grid.jqGrid( 'resetSelection' );\n\t\t}\n\n\t\tthis.select_cells_Array = [];\n\t\tthis.select_cellls_and_shifts_array = [];\n\t\tthis.select_all_shifts_array = [];\n\t\tthis.setDefaultMenu();\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tsuper.render();\n\n\t\tvar control_bar = $( this.el ).find( '.control-bar' );\n\t\tvar date_chooser_div = control_bar.find( '.date-chooser-div' );\n\t\tvar action_chooser_div = control_bar.find( '.action-chooser-div' );\n\n\t\t//Create Start Date Picker\n\t\tthis.start_date_picker = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tthis.start_date_picker.TDatePicker( { field: 'start_date' } );\n\t\tvar date_chooser = $( '<span class=\\'label\\'>' + $.i18n._( 'Date' ) + ':</span>' +\n\t\t\t'<img class=\\'left-arrow arrow\\' src=' + Global.getRealImagePath( 'images/left_arrow.png' ) + '>' +\n\t\t\t'<div class=\\'date-picker-div\\'></div>' +\n\t\t\t'<img class=\\'right-arrow arrow\\' src=' + Global.getRealImagePath( 'images/right_arrow.png' ) + '>' );\n\n\t\tdate_chooser_div.append( date_chooser );\n\t\tdate_chooser_div.find( '.date-picker-div' ).append( this.start_date_picker );\n\n\t\tvar date_left_arrow = date_chooser_div.find( '.left-arrow' );\n\t\tvar date_right_arrow = date_chooser_div.find( '.right-arrow' );\n\n\t\tdate_left_arrow.bind( 'click', function() {\n\t\t\tvar mode = $this.getMode();\n\t\t\tvar new_date;\n\t\t\tvar select_date = $this.start_date;\n\n\t\t\t$this.clearSelection();\n\n\t\t\tif ( !select_date ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tswitch ( mode ) {\n\t\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 7 ) );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 56 ) ); //8 weeks.\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tdefault:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() - 1 ) );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t$this.setDatePickerValue( new_date.format() );\n\t\t\t//$this.setDateUrl();\n\n\t\t\t//$this.buildCalendars();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\tdate_right_arrow.bind( 'click', function() {\n\t\t\tvar mode = $this.getMode();\n\t\t\tvar select_date = $this.end_date;\n\t\t\tvar new_date;\n\t\t\tif ( !select_date ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$this.clearSelection();\n\n\t\t\tswitch ( mode ) {\n\t\t\t\tcase ScheduleViewControllerMode.WEEK:\n\t\t\t\t\tvar select_date = Global.strToDate( ( ( $this.getSelectDate() ) ? $this.getSelectDate() : new Date().format() ) );\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 7 ) );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.YEAR:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 56 ) ); //8 weeks\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScheduleViewControllerMode.DAY:\n\t\t\t\tcase ScheduleViewControllerMode.MONTH:\n\t\t\t\tdefault:\n\t\t\t\t\tnew_date = new Date( new Date( select_date.getTime() ).setDate( select_date.getDate() + 1 ) );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t$this.setDatePickerValue( new_date.format() );\n\t\t\t//$this.setDateUrl();\n\n\t\t\t//$this.buildCalendars();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\tthis.start_date_picker.bind( 'formItemChange', function() {\n\t\t\t//$this.setDateUrl();\n\t\t\t$this.clearSelection();\n\t\t\t$this.search( false, true );\n\t\t} );\n\n\t\t//Overwrite event listener on layout selector to prevent wrong start date issues by passing true on user_date_picker_date in search().\n\t\t$( this.search_panel.find( '#layout_selector' ) ).off( 'change' ).on( 'change', function() {\n\t\t\t$this.layout_changed = true;\n\n\t\t\tvar selectId = $this.search_panel.find( '#layout_selector' ).find( 'option:selected' ).attr( 'value' );\n\t\t\tvar layouts_array = $this.search_panel.getLayoutsArray();\n\t\t\tvar len = layouts_array.length;\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar item = layouts_array[i];\n\n\t\t\t\tif ( item.id == selectId ) {\n\t\t\t\t\t$this.select_layout = item;\n\t\t\t\t\t$this.setSelectLayout();\n\t\t\t\t\t$this.search( false, true );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tGlobal.triggerAnalyticsNavigationOther( 'searchpanel:layout_change', 'click', $this.viewId );\n\t\t} );\n\n\t\t//Create action switch buttons\n\t\tthis.all_employee_btn = action_chooser_div.find( '#all_employee' );\n\t\tthis.daily_totals_btn = action_chooser_div.find( '#daily_totals' );\n\t\tthis.weekly_totals_btn = action_chooser_div.find( '#weekly_totals' );\n\t\tthis.strict_range_btn = action_chooser_div.find( '#strict_range' );\n\n\t\tthis.all_employee_btn = this.all_employee_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.all_employee,\n\t\t\ttooltip: $.i18n._( 'Show Unscheduled Employees' )\n\t\t} );\n\t\tthis.daily_totals_btn = this.daily_totals_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.daily_total,\n\t\t\ttooltip: $.i18n._( 'Daily Totals' )\n\t\t} );\n\t\tthis.weekly_totals_btn = this.weekly_totals_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.weekly_total,\n\t\t\ttooltip: $.i18n._( 'Weekly Totals' )\n\t\t} );\n\t\tthis.strict_range_btn = this.strict_range_btn.SwitchButton( {\n\t\t\ticon: SwitchButtonIcon.strict_range,\n\t\t\ttooltip: $.i18n._( 'Strict Range' )\n\t\t} );\n\n\t\tthis.all_employee_btn.click( function() {\n\t\t\t$this.onShowEmployeeClick();\n\t\t} );\n\n\t\tthis.daily_totals_btn.click( function() {\n\t\t\t$this.onDailyTotalsClick();\n\t\t} );\n\n\t\tthis.weekly_totals_btn.click( function() {\n\t\t\t$this.onWeeklyTotalClick();\n\t\t} );\n\n\t\tthis.strict_range_btn.setValue( true );\n\n\t\tthis.strict_range_btn.click( function() {\n\t\t\t$this.onStrictRangeClick();\n\t\t} );\n\n\t\t//Create weekly toggle buttons\n\n\t\tthis.toggle_button = $( this.el ).find( '.toggle-button-div' );\n\t\tvar data_provider = [\n\t\t\t{ label: $.i18n._( 'Day' ), value: 'day' },\n\t\t\t{ label: $.i18n._( 'Week' ), value: 'week' },\n\t\t\t{ label: $.i18n._( 'Month' ), value: 'month' },\n\t\t\t{ label: $.i18n._( 'Year' ), value: 'year' }\n\t\t];\n\n\t\tthis.toggle_button = this.toggle_button.TToggleButton( { data_provider: data_provider } );\n\n\t\tthis.toggle_button.bind( 'change', function( e, result ) {\n\t\t\t$this.scroll_position = 0;\n\t\t\t$this.select_all_shifts_array = [];\n\t\t\t$this.select_shifts_array = [];\n\t\t\t$this.select_recurring_shifts_array = [];\n\n\t\t\t$this.setToggleButtonUrl();\n\t\t\t$this.search( true, true );\n\n\t\t} );\n\t}\n\n\tonShowEmployeeClick() {\n\t\tthis.search();\n\t}\n\n\tonStrictRangeClick() {\n\t\tthis.search( false, true );\n\t}\n\n\tonWeeklyTotalClick() {\n\t\tif ( !this.checkScheduleData() ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buildCalendars();\n\t\tthis.onResizeGrid();\n\t}\n\n\tonDailyTotalsClick() {\n\t\tvar mode = this.getMode();\n\n\t\t//Error: Uncaught TypeError: Cannot call method 'clearGridData' of null in /interface/html5/index.php?desktop=1#!m=Schedule&date=20150118&mode=week line 6944\n\t\tif ( !this.checkScheduleData() || !this.grid || !this.grid.grid ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buildCalendars( true );\n\t\tthis.onResizeGrid();\n\t\tthis.setScheduleGridRowSpan();\n\t\tthis.setMonthDateRowPosition();\n\t\tthis.setGridColumnsWidth();\n\t}\n\n\tcheckScheduleData() {\n\t\tif ( this.full_schedule_data === true ) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tshowWeeklyTotal() {\n\t\tvar show_weekly_total = this.weekly_totals_btn.getValue();\n\n\t\tif ( !show_weekly_total ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar shifts = 0;\n\t\tvar absences = 0;\n\t\tvar total_time = 0;\n\t\tvar total_wage = 0;\n//\t\t  var is_date_row = false;\n//\t\t  var current_key = [];\n\n\t\tvar mode = this.getMode();\n\n\t\tvar len = this.schedule_source.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.schedule_source[i];\n\n\t\t\tif ( row.type === ScheduleViewControllerRowType.DATE ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor ( var key in row ) {\n\n\t\t\t\t//As data comes from the grid, we can't be sure of the types of any data within it. (Same goes for item below)\n\t\t\t\tvar data = Global.isSet( row[key] ) ? row[key] : '';\n\n\t\t\t\tif ( Global.isSet( data.user_id ) || ( Global.isArray( data ) && mode === ScheduleViewControllerMode.YEAR ) ) {\n\n\t\t\t\t\tif ( mode === ScheduleViewControllerMode.YEAR ) {\n\t\t\t\t\t\tvar data_len = data.length;\n\t\t\t\t\t\tfor ( var j = 0; j < data_len; j++ ) {\n\t\t\t\t\t\t\tvar item = data[j];\n\t\t\t\t\t\t\titem.total_time_wage = parseFloat( item.total_time_wage );\n\t\t\t\t\t\t\titem.total_time = parseFloat( item.total_time );\n\n\t\t\t\t\t\t\tif ( Global.isSet( item.user_id ) ) {\n\t\t\t\t\t\t\t\ttotal_wage = ( item.total_time_wage + total_wage );\n\t\t\t\t\t\t\t\tif ( item.status_id == 10 ) {\n\t\t\t\t\t\t\t\t\ttotal_time = ( item.total_time + total_time );\n\t\t\t\t\t\t\t\t\tshifts = shifts + 1;\n\t\t\t\t\t\t\t\t} else if ( data.status_id == 20 && data.absence_policy_id != TTUUID.zero_id && data.absence_policy_id != TTUUID.not_exist_id ) { //&& data.total_time_wage != 0\n\t\t\t\t\t\t\t\t\ttotal_time = ( item.total_time + total_time );\n\t\t\t\t\t\t\t\t\tabsences = absences + 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.total_time_wage = parseFloat( data.total_time_wage );\n\t\t\t\t\t\tdata.total_time = parseFloat( data.total_time );\n\t\t\t\t\t\ttotal_wage = ( data.total_time_wage + total_wage );\n\t\t\t\t\t\tif ( data.status_id == 10 ) {\n\t\t\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\t\t\tshifts = shifts + 1;\n\t\t\t\t\t\t} else if ( data.status_id == 20 && data.absence_policy_id != TTUUID.zero_id && data.absence_policy_id != TTUUID.not_exist_id ) { //&& data.total_time_wage != 0\n\t\t\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\t\t\tabsences = absences + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( Global.isSet( data.shifts ) ) {\n\t\t\t\t\tdata.total_time_wage = parseFloat( data.total_time_wage );\n\t\t\t\t\tdata.total_time = parseFloat( data.total_time );\n\n\t\t\t\t\ttotal_time = ( data.total_time + total_time );\n\t\t\t\t\ttotal_wage = ( data.total_time_wage + total_wage );\n\n\t\t\t\t\tshifts = shifts + data.shifts;\n\t\t\t\t\tabsences = absences + data.absences;\n\t\t\t\t} else if ( row.type !== ScheduleViewControllerRowType.DATE ) {\n\n\t\t\t\t} else {\n//\t\t\t\t\t  current_key[key] = row[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trow.total_time = Global.getTimeUnit( total_time );\n\t\t\trow.total_time_wage = LocalCacheData.getCurrentCurrencySymbol() + Global.MoneyRound( total_wage );\n\t\t\t//ViewManagerUtil.getTimeUnit(totalTime);\n\t\t\trow.shifts = shifts;\n\t\t\trow.absences = absences;\n\n\t\t\ttotal_time = 0;\n\t\t\ttotal_wage = 0;\n\t\t\tshifts = 0;\n\t\t\tabsences = 0;\n\t\t}\n\t}\n\n\tbuildTotalShiftsValues( total_shifts_dic, currentItem ) {\n\t\tvar start_date = Global.strToDateTime( currentItem.start_date );\n\t\tvar end_date = Global.strToDateTime( currentItem.end_date );\n\t\tvar start_time_min = start_date.getMinutes();\n\t\tvar end_time_min = end_date.getMinutes();\n\n\t\tstart_date.setMinutes( 0 );\n\t\tend_date.setMinutes( 0 );\n\n\t\tvar start_time = start_date.format( 'hA' );\n\t\tvar end_time = end_date.format( 'hA' );\n\n\t\tvar time_offset = Math.ceil( getTimeOffset( start_date, end_date ) / 60 / 60 );\n\n\t\tvar rest_time;\n\t\tif ( time_offset < 1 ) {\n\n\t\t\ttotal_shifts_dic[end_time].value = total_shifts_dic[end_time].value + Number( ( end_time_min / 60 ).toFixed( 0 ) );\n\t\t} else {\n\t\t\tif ( start_time_min == 0 ) {\n\n\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t} else {\n\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + Number( ( ( 60 - start_time_min ) /\n\t\t\t\t\t60 ).toFixed( 2 ) );\n\t\t\t}\n\n\t\t\tfor ( var i = 1; i < time_offset; i++ ) {\n\t\t\t\tstart_date.setHours( start_date.getHours() + 1 );\n\t\t\t\t//start_time = start_date.format( 'hh:mm A' );\n\t\t\t\tstart_time = start_date.format( 'hA' );\n\n\t\t\t\tif ( !total_shifts_dic.hasOwnProperty( start_time ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( i == time_offset - 1 ) {\n\t\t\t\t\tif ( end_time_min > 0 ) {\n\t\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + Number( ( end_time_min /\n\t\t\t\t\t\t\t60 ).toFixed( 2 ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\ttotal_shifts_dic[start_time].value = total_shifts_dic[start_time].value + 1;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getTimeOffset( startDate, endDate ) {\n\t\t\tif ( !startDate ) {\n\t\t\t\tstartDate = new Date();\n\t\t\t}\n\t\t\tvar sec = ( endDate.getTime() - startDate.getTime() ) / 1000;\n\t\t\treturn sec.toFixed( 0 );\n\t\t}\n\t}\n\n\tshowDailyTotal() {\n\t\tvar show_daily_total = this.daily_totals_btn.getValue();\n\n\t\tif ( !show_daily_total ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar start = true;\n\t\tvar total_row = null;\n\t\tvar column_keys = [];\n\t\tvar over_all_total_row = {};\n\n\t\tvar display_columns = this.select_layout.data.display_columns;\n\t\tvar display_columns_len = display_columns.length;\n\n\t\tfor ( var i = 0; i < display_columns_len; i++ ) {\n\t\t\tvar column_name = display_columns[i];\n\n\t\t\tcolumn_keys.push( { key: column_name, row: null, value: null } );\n\n\t\t}\n\n\t\tvar column_keys_len = column_keys.length;\n\n\t\tfor ( var i = 0; i < this.schedule_source.length; i++ ) {\n\t\t\tvar row = this.schedule_source[i];\n\t\t\tif ( start ) {\n\n\t\t\t\tfor ( var j = 0; j < column_keys_len; j++ ) {\n\t\t\t\t\tvar column_key = column_keys[j];\n\t\t\t\t\ttotal_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\t\ttotal_row[column_key.key] = $.i18n._( 'Totals' );\n\t\t\t\t\tcolumn_key.row = total_row;\n\t\t\t\t\tcolumn_key.value = row[column_key.key];\n\n\t\t\t\t}\n\n\t\t\t\tover_all_total_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\tover_all_total_row.user_full_name = $.i18n._( 'Overall Totals' );\n\t\t\t}\n\n\t\t\tfor ( var y = column_keys_len - 1; y >= 0; y-- ) {\n\n\t\t\t\tcolumn_key = column_keys[y];\n\n\t\t\t\tif ( ( row[column_key.key] !== column_key.value && i > 0 ) && !start && i !== 0 ) {\n\n\t\t\t\t\tthis.schedule_source.splice( i, 0, column_key.row );\n\t\t\t\t\ti = i + 1;\n\t\t\t\t\ttotal_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\t\ttotal_row[column_key.key] = $.i18n._( 'Totals' );\n\t\t\t\t\tcolumn_key.row = total_row;\n\t\t\t\t\tcolumn_key.value = row[column_key.key];\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( start ) {\n\t\t\t\tstart = false;\n\t\t\t}\n\t\t\tif ( row.type === ScheduleViewControllerRowType.DATE ) { //do not calculate date row\n\t\t\t\tthis.schedule_source.splice( i, 0, over_all_total_row );\n\t\t\t\tover_all_total_row = { type: ScheduleViewControllerRowType.TOTAL };\n\t\t\t\tover_all_total_row.user_full_name = $.i18n._( 'Overall Totals' );\n\t\t\t\ti = i + 1;\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor ( var key in row ) {\n\n\t\t\t\tvar data = Global.isSet( row[key] ) ? row[key] : '';\n\t\t\t\tfor ( var x = 0; x < column_keys_len; x++ ) {\n\n\t\t\t\t\tcolumn_key = column_keys[x];\n\t\t\t\t\ttotal_row = column_key.row;\n\n\t\t\t\t\t//Total rows for each columns\n\t\t\t\t\tif ( data && Global.isSet( data.user_id ) ) {\n\n\t\t\t\t\t\tvar no_data_key = key.replace( '_data', '' );\n\n\t\t\t\t\t\tvar total_row_key_data = total_row[no_data_key];\n\n\t\t\t\t\t\tif ( !total_row_key_data || !Global.isSet( total_row_key_data.total_time ) ) {\n\t\t\t\t\t\t\ttotal_row[no_data_key] = {};\n\t\t\t\t\t\t\ttotal_row_key_data = total_row[no_data_key];\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = 0;\n\t\t\t\t\t\t\ttotal_row_key_data.total_shifts_dic = Global.clone( this.total_shifts_dic );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//#2381 - total_time can be a string from the API\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseInt( total_row_key_data.total_time );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.shifts ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.shifts = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.absences ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.absences = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !Global.isSet( total_row_key_data.total_time_wage ) ) {\n\t\t\t\t\t\t\ttotal_row_key_data.total_time_wage = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar row_data = row[no_data_key + '_data'];\n\t\t\t\t\t\t//#2381 - total_time can be a string from the API\n\t\t\t\t\t\trow_data.total_time = parseInt( row_data.total_time );\n\n\t\t\t\t\t\ttotal_row_key_data.total_time_wage = Global.MoneyRound( parseFloat( parseFloat( row_data.total_time_wage ) + parseFloat( total_row_key_data.total_time_wage ) ) );\n\t\t\t\t\t\tif ( row_data.status_id == 10 ) {\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\t\ttotal_row_key_data.shifts = total_row_key_data.shifts + 1;\n\t\t\t\t\t\t\tif ( this.getMode() === ScheduleViewControllerMode.DAY ) {\n\t\t\t\t\t\t\t\tthis.buildTotalShiftsValues( total_row_key_data.total_shifts_dic, row[key] );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if ( row_data.status_id == 20 && row_data.absence_policy_id != TTUUID.zero_id && row_data.absence_policy_id != TTUUID.not_exist_id ) { //&& row_data.total_time_wage != 0\n\t\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\t\ttotal_row_key_data.absences = total_row_key_data.absences + 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t//Total rows for all employees\n\n\t\t\t\tif ( data && Global.isSet( data.user_id ) ) {\n\n\t\t\t\t\tno_data_key = key.replace( '_data', '' );\n\n\t\t\t\t\ttotal_row_key_data = over_all_total_row[no_data_key];\n\n\t\t\t\t\tif ( !total_row_key_data || !Global.isSet( total_row_key_data.total_time ) ) {\n\t\t\t\t\t\tover_all_total_row[no_data_key] = {};\n\t\t\t\t\t\ttotal_row_key_data = over_all_total_row[no_data_key];\n\t\t\t\t\t\ttotal_row_key_data.total_time = 0;\n\t\t\t\t\t\ttotal_row_key_data['total_shifts_dic'] = Global.clone( this.total_shifts_dic );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.shifts ) ) {\n\t\t\t\t\t\ttotal_row_key_data.shifts = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.absences ) ) {\n\t\t\t\t\t\ttotal_row_key_data.absences = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !Global.isSet( total_row_key_data.total_time_wage ) ) {\n\t\t\t\t\t\ttotal_row_key_data.total_time_wage = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\trow_data = row[no_data_key + '_data'];\n\n\t\t\t\t\ttotal_row_key_data.total_time_wage = Global.MoneyRound( parseFloat( parseFloat( row_data.total_time_wage ) + parseFloat( total_row_key_data.total_time_wage ) ) );\n\t\t\t\t\tif ( row_data.status_id == 10 ) {\n\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\ttotal_row_key_data.shifts = total_row_key_data.shifts + 1;\n\t\t\t\t\t\tif ( this.getMode() === ScheduleViewControllerMode.DAY ) {\n\t\t\t\t\t\t\tthis.buildTotalShiftsValues( total_row_key_data.total_shifts_dic, row[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if ( row_data.status_id == 20 && row_data.absence_policy_id != TTUUID.zero_id && row_data.absence_policy_id != TTUUID.not_exist_id ) { //&& row_data.total_time_wage != 0\n\t\t\t\t\t\ttotal_row_key_data.total_time = parseFloat( row_data.total_time ) + parseFloat( total_row_key_data.total_time );\n\t\t\t\t\t\ttotal_row_key_data.absences = total_row_key_data.absences + 1;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( i === this.schedule_source.length - 1 ) {\n\t\t\t\tfor ( var j = column_keys.length - 1; j >= 0; j-- ) {\n\t\t\t\t\tthis.schedule_source.push( column_keys[j].row );\n\t\t\t\t}\n\t\t\t\tthis.schedule_source.push( over_all_total_row );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tbuildSearchFields() {\n\t\tsuper.buildSearchFields();\n\t\tvar $this = this;\n\n\t\tvar default_args = { permission_section: 'schedule' };\n\n\t\tif ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t\tthis.search_fields = [\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'status_id',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'schedule_branch_ids',\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'department_ids',\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Default Branch' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'default_branch_ids',\n\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Default Department' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'default_department_ids',\n\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tfield: 'group_ids',\n\t\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\t\ttree_mode: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Title' ),\n\t\t\t\t\tfield: 'title_id',\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tlayout_name: 'global_job_title',\n\t\t\t\t\tapi_class: TTAPI.APIUserTitle,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tfield: 'job_id',\n\t\t\t\t\tlayout_name: 'global_job',\n\t\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: ( this.show_job_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tfield: 'job_item_id',\n\t\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Recurring Template' ),\n\t\t\t\t\tfield: 'recurring_schedule_template_control_id',\n\t\t\t\t\tin_column: 2,\n\t\t\t\t\tlayout_name: 'global_recurring_schedule_control',\n\t\t\t\t\tapi_class: TTAPI.APIRecurringScheduleTemplateControl,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Absence Policy' ),\n\t\t\t\t\tfield: 'absence_policy_id',\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tlayout_name: 'global_absences',\n\t\t\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Include Employees' ),\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tfield: 'include_user_ids',\n\t\t\t\t\tlayout_name: 'global_user',\n\t\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tdefault_args: default_args,\n\t\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t\t} ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ),\n\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Exclude Employees' ),\n\t\t\t\t\tin_column: 3,\n\t\t\t\t\tfield: 'exclude_user_ids',\n\t\t\t\t\tlayout_name: 'global_user',\n\t\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: false,\n\t\t\t\t\tadv_search: true,\n\t\t\t\t\tdefault_args: default_args,\n\t\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t\t} ),\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} )\n\t\t\t];\n\t\t} else {\n\t\t\t//Allow regular employees to add job/task columns if needed, and do some other basic searches.\n\t\t\tthis.search_fields = [];\n\n\t\t\tthis.search_fields.push(\n\t\t\t\tnew SearchField( {\n\t\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\t\tin_column: 1,\n\t\t\t\t\tfield: 'status_id',\n\t\t\t\t\tmultiple: true,\n\t\t\t\t\tbasic_search: true,\n\t\t\t\t\tadv_search: false,\n\t\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t} ) );\n\n\t\t\t//Check punch permissions rather than schedule, since this is a regular employee who likely wouldn't have\n\t\t\tif ( PermissionManager.validate( 'punch', 'edit_branch' ) || PermissionManager.validate( this.permission_id, 'edit_branch' ) ) {\n\t\t\t\tthis.search_fields.push(\n\t\t\t\t\tnew SearchField( {\n\t\t\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\t\t\tin_column: 1,\n\t\t\t\t\t\tfield: 'schedule_branch_ids',\n\t\t\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\t\t\tmultiple: true,\n\t\t\t\t\t\tbasic_search: true,\n\t\t\t\t\t\tadv_search: false,\n\t\t\t\t\t\tscript_name: 'BranchView',\n\t\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t\t} ) );\n\t\t\t}\n\n\t\t\tif ( PermissionManager.validate( 'punch', 'edit_department' ) || PermissionManager.validate( this.permission_id, 'edit_department' ) ) {\n\t\t\t\tthis.search_fields.push(\n\t\t\t\t\tnew SearchField( {\n\t\t\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\t\t\tin_column: 1,\n\t\t\t\t\t\tfield: 'department_ids',\n\t\t\t\t\t\tlayout_name: 'global_department',\n\t\t\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\t\t\tmultiple: true,\n\t\t\t\t\t\tbasic_search: true,\n\t\t\t\t\t\tadv_search: false,\n\t\t\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t\t\t} ) );\n\t\t\t}\n\n\t\t\t//Could be permission issues with this, so disable for now.\n\t\t\t// if ( Global.getProductEdition() >= 20 && ( PermissionManager.validate( 'punch', 'edit_job' ) || PermissionManager.validate( this.permission_id, 'edit_job' ) ) ) {\n\t\t\t// \tthis.search_fields.push(\n\t\t\t// \t\tnew SearchField( {\n\t\t\t// \t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t// \t\t\tin_column: 2,\n\t\t\t// \t\t\tfield: 'job_id',\n\t\t\t// \t\t\tlayout_name: 'global_job',\n\t\t\t// \t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t// \t\t\tmultiple: true,\n\t\t\t// \t\t\tbasic_search: true,\n\t\t\t// \t\t\tadv_search: false,\n\t\t\t// \t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t// \t\t} ) );\n\t\t\t// }\n\t\t\t//\n\t\t\t// if ( Global.getProductEdition() >= 20 && ( PermissionManager.validate( 'punch', 'edit_job_item' ) || PermissionManager.validate( this.permission_id, 'edit_job_item' ) ) ) {\n\t\t\t// \tthis.search_fields.push(\n\t\t\t// \t\tnew SearchField( {\n\t\t\t// \t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t// \t\t\tin_column: 2,\n\t\t\t// \t\t\tfield: 'job_item_id',\n\t\t\t// \t\t\tlayout_name: 'global_job_item',\n\t\t\t// \t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t// \t\t\tmultiple: true,\n\t\t\t// \t\t\tbasic_search: true,\n\t\t\t// \t\t\tadv_search: false,\n\t\t\t// \t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t// \t\t} ) );\n\t\t\t// }\n\n\t\t}\n\t}\n\n\tonSourceDataCreate( target, source_data ) {\n\n\t\t//if ( !this.is_mass_adding ) {\n\t\t//\treturn source_data;\n\t\t//}\n\t\tvar $this = this;\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\t\tvar second_item = {};\n\n\t\t//FIXME: what should we do about -2?\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\t\t\tif ( $this.select_cells_Array.length > 0 && !$this.is_mass_editing ) {\n\t\t\t\tsecond_item.id = '-2';\n\t\t\t\tsecond_item[content.name] = Global.selected_item;\n\t\t\t}\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tif ( this.select_cells_Array.length > 0 && !$this.is_mass_editing ) {\n\t\t\tsource_data.unshift( second_item );\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tonEmployeeSourceCreate( target, source_data ) {\n\n\t\tif ( !this.checkOpenPermission() ) {\n\t\t\treturn source_data;\n\t\t}\n\n\t\tvar display_columns = target.getDisplayColumns();\n\n\t\tvar first_item = {};\n\t\t$.each( display_columns, function( index, content ) {\n\n\t\t\tfirst_item.id = TTUUID.zero_id;\n\t\t\tfirst_item[content.name] = Global.open_item;\n\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\taddOPenField( target, source_data ) {\n\t\tvar open_field = {};\n\t}\n\n\tcleanWhenUnloadView( callBack ) {\n\n\t\t$( '#schedule_view_container' ).remove();\n\t\tsuper.cleanWhenUnloadView( callBack );\n\t}\n\n\tsetAddRequestIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( Global.getProductEdition() <= 10 || !this.addPermissionValidate( 'request' ) || this.edit_only_mode ) {\n\t\t\tcontext_btn.addClass( 'invisible-image' );\n\t\t}\n\n\t\tif ( this.enableAddRequestButton() === true ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n}\n\nvar ScheduleViewControllerRowType = function() {\n\n};\n\nScheduleViewControllerRowType.TOTAL = 1;\nScheduleViewControllerRowType.DATE = 2;\nScheduleViewControllerRowType.EMPTY = 3;\n\nvar ScheduleViewControllerMode = function() {\n\n};\n\nScheduleViewControllerMode.DAY = 'day';\nScheduleViewControllerMode.WEEK = 'week';\nScheduleViewControllerMode.MONTH = 'month';\nScheduleViewControllerMode.YEAR = 'year';\n\n"],"sourceRoot":""}