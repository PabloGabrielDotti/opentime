(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["my_account-request_authorization-RequestAuthorizationViewController"],{5396:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"RequestAuthorizationViewController":()=>a});class a extends RequestViewCommonController{constructor(e={}){_.defaults(e,{el:"#request_authorization_view_container",type_array:null,hierarchy_level_array:null,messages:null,authorization_api:null,api_request:null,api_absence_policy:null,message_control_api:null,authorization_history_columns:[],authorization_history_default_display_columns:[],authorization_history_grid:null,pre_request_schedule:!0}),super(e)}init(e){this.edit_view_tpl="RequestAuthorizationEditView.html",this.permission_id="request",this.viewId="RequestAuthorization",this.script_name="RequestAuthorizationView",this.table_name_key="request",this.context_menu_name=$.i18n._("Request (Authorizations)"),this.navigation_label=$.i18n._("Requests")+":",this.api=TTAPI.APIRequest,this.authorization_api=TTAPI.APIAuthorization,this.api_request=TTAPI.APIRequest,this.api_absence_policy=TTAPI.APIAbsencePolicy,this.message_control_api=TTAPI.APIMessageControl,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem),this.message_control_api=TTAPI.APIMessageControl,this.initPermission(),this.render(),this.buildContextMenu(!0),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){var e=this;this.initDropDownOption("type");var t=this.api.getHierarchyLevelOptions([-1],{async:!1}).getResult();e.hierarchy_level_array=Global.buildRecordArray(t),Global.isSet(e.basic_search_field_ui_dic.hierarchy_level)&&e.basic_search_field_ui_dic.hierarchy_level.setSourceData(Global.buildRecordArray(t))}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1;var e=TTAPI.APICompany;if(e&&_.isFunction(e.isBranchAndDepartmentAndJobAndJobItemEnabled))var t=e.isBranchAndDepartmentAndJobAndJobItemEnabled({async:!1}).getResult();t?(t.branch||(this.show_branch_ui=!1),t.department||(this.show_department_ui=!1),t.job||(this.show_job_ui=!1),t.job_item||(this.show_job_item_ui=!1)):(this.show_branch_ui=!1,this.show_department_ui=!1,this.show_job_ui=!1,this.show_job_item_ui=!1)}getCustomContextMenuModel(){return{groups:{action:{label:$.i18n._("Action"),id:this.script_name+"action"},authorization:{label:$.i18n._("Authorization"),id:this.script_name+"authorization"},objects:{label:$.i18n._("Objects"),id:this.script_name+"objects"}},exclude:["default"],include:[{label:$.i18n._("View"),id:ContextMenuIconName.view,group:"action",icon:Icons.view,sort_order:1011},{label:$.i18n._("Reply"),id:ContextMenuIconName.edit,group:"action",icon:Icons.edit,sort_order:1021},{label:$.i18n._("Send"),id:ContextMenuIconName.send,group:"action",icon:Icons.send,sort_order:1031},{label:$.i18n._("Cancel"),id:ContextMenuIconName.cancel,group:"action",icon:Icons.cancel,sort_order:1131},{label:$.i18n._("Authorize"),id:ContextMenuIconName.authorization,group:"authorization",icon:Icons.authorization},{label:$.i18n._("Pass"),id:ContextMenuIconName.pass,group:"authorization",icon:Icons.pass},{label:$.i18n._("Decline"),id:ContextMenuIconName.decline,group:"authorization",icon:Icons.decline},{label:$.i18n._("Request<br>Authorizations"),id:ContextMenuIconName.authorization_request,group:"objects",icon:Icons.authorization_request,selected:!0,permission_result:PermissionManager.checkTopLevelPermission("RequestAuthorization")},{label:$.i18n._("TimeSheet<br>Authorizations"),id:ContextMenuIconName.authorization_timesheet,group:"objects",icon:Icons.authorization_timesheet,permission_result:PermissionManager.checkTopLevelPermission("TimeSheetAuthorization")},{label:$.i18n._("Expense<br>Authorizations"),id:ContextMenuIconName.authorization_expense,group:"objects",icon:Icons.authorization_expense,selected:!1,permission_result:PermissionManager.checkTopLevelPermission("ExpenseAuthorization")},{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Schedule"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Export"),id:ContextMenuIconName.export_excel,group:"other",icon:Icons.export_excel,sort_order:9e3}]}}setDefaultMenu(e){if(0==LocalCacheData.isLocalCacheExists("current_company"))return!1;if(Global.isSet(e)&&e||this.selectContextMenu(),this.context_menu_array){this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var s=$(this.context_menu_array[a]),n=$(s.find(".ribbon-sub-menu-icon")).attr("id");switch(s.removeClass("invisible-image"),s.removeClass("disable-image"),n){case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(s,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(s,i);break;case ContextMenuIconName.send:this.setDefaultMenuSaveIcon(s,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(s,i);break;case ContextMenuIconName.authorization:this.setDefaultMenuAuthorizationIcon(s,i);break;case ContextMenuIconName.pass:this.setDefaultMenuPassIcon(s,i);break;case ContextMenuIconName.decline:this.setDefaultMenuDeclineIcon(s,i);break;case ContextMenuIconName.authorization_request:this.setDefaultMenuAuthorizationRequestIcon(s,i);break;case ContextMenuIconName.authorization_timesheet:this.setDefaultMenuAuthorizationTimesheetIcon(s,i);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(s,i,"punch");break;case ContextMenuIconName.schedule:this.setDefaultMenuViewIcon(s,i,"schedule");break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditEmployeeIcon(s,i);break;case ContextMenuIconName.authorization_expense:this.setDefaultMenuAuthorizationExpenseIcon(s,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(s)}}this.setContextMenuGroupVisibility()}}setDefaultMenuAuthorizationExpenseIcon(e,t,i){Global.getProductEdition()>=25||e.addClass("invisible-image"),e.removeClass("disable-image")}setEditMenu(){for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");switch(i.removeClass("disable-image"),a){case ContextMenuIconName.edit:this.setEditMenuEditIcon(i,"request");break;case ContextMenuIconName.view:this.setEditMenuViewIcon(i);break;case ContextMenuIconName.send:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.authorization:this.setEditMenuAuthorizationIcon(i);break;case ContextMenuIconName.pass:this.setEditMenuPassIcon(i);break;case ContextMenuIconName.decline:this.setEditMenuDeclineIcon(i);break;case ContextMenuIconName.authorization_request:this.setEditMenuAuthorizationRequestIcon(i);break;case ContextMenuIconName.authorization_timesheet:this.setEditMenuAuthorizationTimesheetIcon(i);break;case ContextMenuIconName.timesheet:this.setEditMenuNavViewIcon(i,"punch");break;case ContextMenuIconName.schedule:this.setEditMenuNavViewIcon(i,"schedule");break;case ContextMenuIconName.edit_employee:this.setEditMenuNavEditIcon(i,"user");break;case ContextMenuIconName.authorization_expense:this.setEditMenuAuthorizationExpenseIcon(i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}setEditMenuAuthorizationExpenseIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.send:this.onSaveClick();break;case ContextMenuIconName.authorization:this.onAuthorizationClick();break;case ContextMenuIconName.pass:this.onPassClick();break;case ContextMenuIconName.decline:this.onDeclineClick();break;case ContextMenuIconName.authorization_request:this.onAuthorizationRequestClick();break;case ContextMenuIconName.authorization_timesheet:this.onAuthorizationTimesheetClick();break;case ContextMenuIconName.authorization_expense:this.onAuthorizationExpenseClick();break;case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.edit_employee:this.onNavigationClick(e)}}onViewclick(){super.onViewclick(),AuthorizationHistory.init(this)}onAuthorizationExpenseClick(){IndexViewController.goToView("ExpenseAuthorization")}onSaveClick(e){if(Global.isSet(e)||(e=!1),this.is_edit){var t,i=this;this.is_add=!1,t=this.current_edit_record,t=this.uniformVariable(t),EmbeddedMessage.reply(t,e,(function(e){if(e.isValid()){var t=i.current_edit_record.id;i.removeEditView(),i.onViewClick(t)}else i.setErrorTips(e),i.setErrorMenu()}))}}onAuthorizationClick(){var e,t=this;t.current_edit_record&&(e=Global.getProductEdition()>=15&&(30==this.current_edit_record.type_id||40==this.current_edit_record.type_id)?t.buildDataForAPI(this.current_edit_record):this.getSelectedItem(),1==this.enable_edit_view_ui?t.api_request.setRequest(e,{onResult:function(e){0!=e.getResult()?i():(t.setErrorMenu(),t.setErrorTips(e,!0))}}):i());function i(){if(t.current_edit_record){var e={authorized:!0};e.object_id=t.current_edit_record.id,e.object_type_id=t.current_edit_record.hierarchy_type_id,t.authorization_api.setAuthorization([e],{onResult:function(e){0!=e.getResult()?(t.is_changed=!1,t.onRightArrowClick((function(){t.search(),$().TFeedback({source:"Authorize"})}))):(t.setErrorMenu(),t.setErrorTips(e,!0))}})}}}onPassClick(){var e=this;function t(){e.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Pass"})}))}this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(e){!0===e&&t()})):t()}onAuthorizationRequestClick(){this.search(!1)}onDeclineClick(){var e=this;function t(){var t={authorized:!1};t.object_id=e.current_edit_record.id,t.object_type_id=e.current_edit_record.hierarchy_type_id,e.authorization_api.setAuthorization([t],{onResult:function(t){e.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Decline"})}))}})}this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(e){!0===e&&t()})):t()}onAuthorizationTimesheetClick(){IndexViewController.goToView("TimeSheetAuthorization")}uniformVariable(e){return this.is_edit?this.uniformMessageVariable(e):e}onGridDblClickRow(){ProgressBar.showOverlay(),this.onViewClick()}setEditMenuViewIcon(e,t){e.addClass("disable-image")}onSaveResult(e){var t=this;if(e.isValid()){t.is_add=!1;var i=e.getResult();this.edit_only_mode||(!0===i?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.search()),t.onSaveDone(e),t.is_edit?t.onViewClick(t.current_edit_record.id):t.removeEditView()}else t.setErrorMenu(),t.setErrorTips(e)}setEditMenuAuthorizationIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuPassIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuDeclineIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuAuthorizationRequestIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuAuthorizationTimesheetIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuSaveIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuEditIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuEditEmployeeIcon(e,t){this.editPermissionValidate("user")||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuAuthorizationIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuPassIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuDeclineIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuAuthorizationRequestIcon(e,t,i){e.removeClass("disable-image")}setDefaultMenuAuthorizationTimesheetIcon(e,t,i){e.removeClass("disable-image")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Type"),in_column:1,multiple:!0,field:"type_id",basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Start Date"),in_column:1,field:"start_date",basic_search:!0,adv_search:!1,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:$.i18n._("End Date"),in_column:1,field:"end_date",basic_search:!0,adv_search:!1,form_item_type:FormItemType.DATE_PICKER}),new SearchField({label:$.i18n._("Hierarchy Level"),in_column:2,multiple:!1,field:"hierarchy_level",basic_search:!0,adv_search:!1,set_any:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),s=e.getValue();switch(this.current_edit_record[a]=s,a){case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id"),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&this.onJobQuickSearch(a,s,"job_id","job_item_id");break;case"type_id":this.onTypeChanged();break;case"date_stamp":this.onDateStampChanged();break;case"request_schedule_status_id":this.onWorkingStatusChanged();break;case"start_date":i.getScheduleTotalTime(),i.onStartDateChanged(),i.current_edit_record.start_date=i.edit_view_ui_dic.start_date.getValue(),i.current_edit_record.date_stamp=i.edit_view_ui_dic.start_date.getValue(),i.edit_view_ui_dic.date_stamp&&i.edit_view_ui_dic.date_stamp.setValue(i.edit_view_ui_dic.start_date.getValue());break;case"end_date":i.getScheduleTotalTime(),i.current_edit_record.end_date=i.edit_view_ui_dic.end_date.getValue();break;case"sun":case"tue":case"wed":case"thu":case"fri":case"sat":case"start_time":case"end_time":case"schedule_policy_id":i.getScheduleTotalTime();break;case"absence_policy_id":this.selected_absence_policy_record=this.edit_view_ui_dic.absence_policy_id.getValue(),this.getAvailableBalance()}if("date_stamp"===a||"start_date_stamps"===a||"start_date_stamp"===a||"start_time"===a||"end_time"===a||"schedule_policy_id"===a||"absence_policy_id"===a)if(""!==this.current_edit_record.date_stamp&&""!==this.current_edit_record.start_time&&""!==this.current_edit_record.end_time){this.current_edit_record.date_stamp,this.current_edit_record.start_time,this.current_edit_record.date_stamp,this.current_edit_record.end_time,this.current_edit_record.schedule_policy_id,this.current_edit_record.user_id;this.getScheduleTotalTime()}else this.onAvailableBalanceChange();t||this.validate()}setEditViewWidgetsMode(){var e={};for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var i=this.edit_view_ui_dic[t];i.css("opacity",1);var a=i.parent().parent().parent(),s=a.parent().attr("id");a.hasClass("v-box")||e[s]||(e[s]=!0),Global.isSet(i.setEnabled)&&i.setEnabled(this.enable_edit_view_ui)}}onAvailableBalanceChange(){this.getAvailableBalance()}setURL(){"edit"!==LocalCacheData.current_doing_context_action?super.setURL():LocalCacheData.current_doing_context_action=""}getSubViewFilter(e){return 0===e.length&&(e={}),Global.isSet(e.type_id)||(e.type_id=[-1]),Global.isSet(e.hierarchy_level)||(e.hierarchy_level=1,this.filter_data.hierarchy_level={field:"hierarchy_level",id:"",value:this.basic_search_field_ui_dic.hierarchy_level.getValue(!0)}),e}buildEditViewUI(){super.buildEditViewUI();var e={"tab_request":{"label":$.i18n._("Message")},"tab_audit":!0};this.setTabModel(e),this.edit_view.find("a[ref=tab_audit]").css("display","none");var t=this.edit_view_tab.find("#tab_request"),i=t.find(".first-column"),a=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var s=Global.loadWidgetByName(FormItemType.TEXT_INPUT);s.TTextInput({field:"subject",width:359}),this.addEditFieldToColumn($.i18n._("Subject"),s,i,""),(s=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"body",width:600,height:400}),this.addEditFieldToColumn($.i18n._("Body"),s,i,"",null,null,!0),a.css("display","none")}search(e,t,i,a){this.refresh_id=null,super.search(e,t,i,a)}setCurrentEditRecordData(){for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"full_name":t.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;case"subject":t.setValue(this.current_edit_record[e]),this.is_edit&&t.setValue("Re: "+this.messages[0].subject);break;default:t.setValue(this.current_edit_record[e])}}this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.is_viewing||Global.isSet(this.messages)&&(this.messages=null)}validate(){var e=this,t={};if(this.is_edit){for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var a=this.edit_view_ui_dic[i];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(t[i]=a.getValue())}}else t=this.buildDataForAPI(this.current_edit_record);t=this.uniformVariable(t),this.is_edit?this.message_control_api["validate"+this.message_control_api.key_name](t,{onResult:function(t){e.validateResult(t)}}):this.is_viewing&&this.api_request["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}openAuthorizationView(){this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl)}}}}]);
//# sourceMappingURL=my_account-request_authorization-RequestAuthorizationViewController.bundle.js.map?v=26c5419df9d5ee01e5cb