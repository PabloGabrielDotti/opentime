(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["attendance-recurring_schedule_control-RecurringScheduleControlViewController"],{869:(e,t,a)=>{"use strict";a.r(t),a.d(t,{"RecurringScheduleControlViewController":()=>i});class i extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#recurring_schedule_control_view_container",user_status_array:null,user_group_array:null,user_api:null,user_group_api:null}),super(e)}init(e){this.edit_view_tpl="RecurringScheduleControlEditView.html",this.permission_id="recurring_schedule",this.viewId="RecurringScheduleControl",this.script_name="RecurringScheduleControlView",this.table_name_key="recurring_schedule_control",this.context_menu_name=$.i18n._("Recurring Schedules"),this.navigation_label=$.i18n._("Recurring Schedule")+":",this.api=TTAPI.APIRecurringScheduleControl,this.user_api=TTAPI.APIUser,this.user_group_api=TTAPI.APIUserGroup,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(){var e=this;this.initDropDownOption("status","user_status_id",this.user_api,(function(t){t=t.getResult(),e.user_status_array=Global.buildRecordArray(t)})),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),e.user_group_array=t,!e.sub_view_mode&&e.basic_search_field_ui_dic.group_id&&(e.basic_search_field_ui_dic.group_id.setSourceData(t),e.adv_search_field_ui_dic.group_id.setSourceData(t))}})}buildEditViewUI(){super.buildEditViewUI();var e,t,a={"tab_recurring_schedule":{"label":$.i18n._("Recurring Schedule")},"tab_audit":!0};this.setTabModel(a),this.navigation.AComboBox({api_class:TTAPI.APIRecurringScheduleControl,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_recurring_schedule_control",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i=this.edit_view_tab.find("#tab_recurring_schedule").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIRecurringScheduleTemplateControl,allow_multiple_selection:!1,layout_name:"global_recurring_template_control",show_search_inputs:!0,set_empty:!0,field:"recurring_schedule_template_control_id"}),this.addEditFieldToColumn($.i18n._("Template"),e,i,""),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"start_week",width:40}),this.addEditFieldToColumn($.i18n._("Template Start Week"),e,i),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"start_date"}),this.addEditFieldToColumn($.i18n._("Start Date"),e,i,"",null),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"end_date"}),t=$("<div class='widget-h-box'></div>");var n=$("<span class='widget-right-label'>"+$.i18n._("(Leave blank for no end date)")+"</span>");t.append(e),t.append(n),this.addEditFieldToColumn($.i18n._("End Date"),e,i,"",t),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"display_weeks",width:20}),this.addEditFieldToColumn($.i18n._("Display Weeks"),e,i,"",null),Global.getProductEdition()>=15&&((e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"auto_fill"}),t=$("<div class='widget-h-box'></div>"),n=$("<span class='widget-right-label t-checkbox-padding-left'> ("+$.i18n._("Punches employees in/out automatically")+")</span>"),t.append(e),t.append(n),this.addEditFieldToColumn($.i18n._("Auto-Punch"),e,i,"",t)),e=Global.loadWidgetByName(FormItemType.AWESOME_BOX);var s={};Global.getProductEdition()>=15?(e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_any:!0,field:"user",custom_first_label:Global.empty_item,addition_source_function:function(t,a){if(!a)return a;var i=e.createItem(TTUUID.zero_id,Global.open_item);return a.unshift(i),a},added_items:[{value:TTUUID.zero_id,label:Global.open_item}]}),s.permission_section="recurring_schedule",e.setDefaultArgs(s)):(e.AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!0,layout_name:"global_user",show_search_inputs:!0,set_any:!0,custom_first_label:Global.empty_item,field:"user"}),s.permission_section="recurring_schedule",e.setDefaultArgs(s)),this.addEditFieldToColumn($.i18n._("Employees"),e,i,"",null,!0)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Template"),in_column:1,field:"recurring_schedule_template_control_id",layout_name:"global_recurring_template_control",api_class:TTAPI.APIRecurringScheduleTemplateControl,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,addition_source_function:this.onEmployeeSourceCreate,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Title"),field:"title_id",in_column:1,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,script_name:"BranchView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),in_column:2,field:"default_department_id",layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,script_name:"DepartmentView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}onEmployeeSourceCreate(e,t){if(Global.getProductEdition()<=10)return t;var a=e.getDisplayColumns(),i={};return $.each(a,(function(e,t){return i.id=TTUUID.zero_id,i[t.name]=Global.open_item,!1})),t&&"array"===$.type(t)||(t=[]),t.unshift(i),t}getCustomContextMenuModel(){return{exclude:[],include:[{label:$.i18n._("Recurring<br>Templates"),id:ContextMenuIconName.recurring_template,group:"navigation",icon:Icons.recurring_template},{label:$.i18n._("Schedules"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule}]}}onCustomContextClick(e){switch(e){case ContextMenuIconName.recurring_template:case ContextMenuIconName.schedule:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}setEditViewDataDone(){super.setEditViewDataDone(),this.is_mass_editing?this.detachElement("user"):this.attachElement("user")}parseToUserId(e){return!!e&&((e=e.toString()).indexOf("_")>0?e.split("_")[1]:e)}parseToRecordId(e){return!!e&&((e=e.toString()).indexOf("_")>0?e.split("_")[0]:e)}uniformVariable(e){return e.id=this.parseToRecordId(e.id),e}processAPICallbackResult(e){var t=this.getCurrentSelectedRecord(),a=this.parseToUserId(t);e||(e=[]);for(var i=0,n=0;n<e.length;n++)e[n].user_id==a&&(i=n);return e[i].id=t,[e[i]]}getAPIFilters(){var e=this.getCurrentSelectedRecord(),t=this.parseToRecordId(e),a={filter_data:{}};return a.filter_data.id=[t],a}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit";var t={},a=this.getGridSelectIdArray();a.length;this.mass_edit_record_ids=[],$.each(a,(function(t,a){e.mass_edit_record_ids.push(a)})),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(t){var a=t.getResult();a.id?e.onEditClick(a.id):(e.openEditView(),a||(a=[]),e.api.getOptions("unique_columns",{onResult:function(t){e.unique_columns=t.getResult(),e.api.getOptions("linked_columns",{onResult:function(t){e.linked_columns=t.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),e.current_edit_record=a,e.initEditView()}})}}))}})}getCopyAsNewFilter(e){var t=e.filter_data.id[0];return e.filter_data.id=[this.parseToRecordId(t)],e}onCopyClick(){var e=this,t=[];if(e.is_add=!1,e.edit_view)t.push(e.current_edit_record.id),this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(a){!0===a&&(e.is_changed=!1,e._continueDoCopy(t)),ProgressBar.closeOverlay()})):e._continueDoCopy(t);else{for(var a=e.getGridSelectIdArray().slice(),i=0;i<a.length;i++){var n=a[i].split("_")[0];t.push(n)}e._continueDoCopy(t)}}getDeleteSelectedRecordId(){var e={};if(this.edit_view)e[this.parseToRecordId(this.current_edit_record.id)]=[this.parseToUserId(this.current_edit_record.id)];else for(var t=this.getGridSelectIdArray().slice(),a=0;a<t.length;a++){var i=this.parseToRecordId(t[a]),n=this.parseToUserId(t[a]);e[i]?e[i].push(n):e[i]=[n]}return e}onNavigationClick(e){var t=this;switch(e){case ContextMenuIconName.schedule:var a={filter_data:{}},i=this.getSelectedItem(),n=null,s=new Date;if(Global.isSet(i.user_id))n=[i.user_id],a.filter_data.include_user_ids={value:n},a.select_date=s.format(),Global.addViewTab(this.viewId,$.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("Schedule",a);else{var r={filter_data:{}};r.filter_data.id=[i.id],r.filter_columns={user_id:!0},this.api["get"+this.api.key_name](r,{onResult:function(e){var i=e.getResult();i||(i=[]),i=i[0],n=[i.user_id],a.filter_data.include_user_ids={value:n},a.select_date=s.format(),Global.addViewTab(t.viewId,$.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("Schedule",a)}})}break;case ContextMenuIconName.recurring_template:a={filter_data:{}},i=this.getSelectedItem(),Global.isSet(i.recurring_schedule_template_control_id)?(a.filter_data.id=[i.recurring_schedule_template_control_id],Global.addViewTab(this.viewId,$.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("RecurringScheduleTemplateControl",a)):((r={}).filter_data={},r.filter_data.id=[this.parseToRecordId(i.id)],this.api["get"+this.api.key_name](r,{onResult:function(e){var i=e.getResult();i||(i=[]),i=i[0],a.filter_data.id=[i.recurring_schedule_template_control_id],Global.addViewTab(t.viewId,$.i18n._("Recurring Schedules"),window.location.href),IndexViewController.goToView("RecurringScheduleTemplateControl",a)}}));break;case ContextMenuIconName.export_excel:this.onExportClick("exportRecurringScheduleControl")}}getRightArrowClickSelectedIndex(e){if(0==e){for(var t=this.navigation.getSourceData(),a=window.location.hash.split("&"),i="0_0",n=0;n<a.length;n++)-1!=a[n].indexOf("id=")&&(i=a[n].substring(3));if(-1!=i.indexOf("_"))for(n=0;n<t.length;n++)if(i==t[n].id){e=n;break}}return e}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,a=this.getGridSelectIdArray().length,i=0;i<t;i++){var n=$(this.context_menu_array[i]),s=$(n.find(".ribbon-sub-menu-icon")).attr("id");switch(n.removeClass("invisible-image"),n.removeClass("disable-image"),s){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(n,a);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(n,a);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(n,a);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(n,a);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(n,a);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(n,a);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(n,a);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(n,a);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(n,a);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(n,a);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(n,a);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(n,a);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(n,a);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(n,a);break;case ContextMenuIconName.recurring_template:this.setDefaultMenuRecurringTemplateIcon(n,a);break;case ContextMenuIconName.schedule:this.setDefaultMenuScheduleIcon(n,a);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(n,a)}}this.setContextMenuGroupVisibility()}}setDefaultMenuRecurringTemplateIcon(e,t,a){this.viewPermissionValidate(a)&&!this.edit_only_mode||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuScheduleIcon(e,t,a){PermissionManager.checkTopLevelPermission("Schedule")&&!this.edit_only_mode||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}search(e,t,a,i){Global.isSet(e)||(e=!0);var n=this,s={filter_data:{},filter_sort:{}};if(s.filter_columns=this.getFilterColumnsFromDisplayColumns(),s.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)s.filter_page="next"===t?this.pager_data.next_page:1;else switch(t){case"next":s.filter_page=this.pager_data.next_page;break;case"last":s.filter_page=this.pager_data.previous_page;break;case"start":s.filter_page=1;break;case"end":s.filter_page=this.pager_data.last_page_number;break;case"go_to":s.filter_page=a;break;default:s.filter_page=this.pager_data.current_page}else s.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),s.filter_sort=this.select_layout.data.filter_sort,this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](s,{onResult:function(a){var s=a.getResult();(Global.isArray(s)?(n.removeNoResultCover(),Global.isSet(n.__createRowId)&&(s=n.__createRowId(s)),s=Global.formatGridData(s,n.api.key_name)):n.showNoResultCover(),n.pager_data=a.getPagerData(),0!==LocalCacheData.paging_type&&(n.paging_widget.setPagerData(n.pager_data),n.paging_widget_2.setPagerData(n.pager_data)),0===LocalCacheData.paging_type&&"next"===t)&&(s=n.grid.getGridParam("data").concat(s));for(var r=s.length,l=0;l<r;l++){var o=s[l];o.id=o.id+"_"+o.user_id}n.grid&&(n.grid.setData(s),n.reSelectLastSelectItems()),n.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&n.setDefaultMenu(!0),0===LocalCacheData.paging_type&&(!n.pager_data||n.pager_data.is_last_page?n.paging_widget.css("display","none"):n.paging_widget.css("display","block")),i&&i(a),e&&n.autoOpenEditViewIfNecessary(),n.searchDone()}})}getFilterColumnsFromDisplayColumns(){var e={user_id:!0};return this._getFilterColumnsFromDisplayColumns(e,!0)}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var a=$(this.context_menu_array[t]),i=$(a.find(".ribbon-sub-menu-icon")).attr("id");if(a.removeClass("disable-image"),this.is_mass_editing)switch(i){case ContextMenuIconName.save:this.setEditMenuSaveIcon(a);break;case ContextMenuIconName.cancel:break;default:a.addClass("disable-image")}else switch(i){case ContextMenuIconName.add:this.setEditMenuAddIcon(a);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(a);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(a);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(a);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(a);break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(a);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(a);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(a);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(a);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(a);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(a);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(a);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(a);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.recurring_template:this.setEditMenuRecurringTemplateIcon(a);break;case ContextMenuIconName.schedule:this.setEditMenuScheduleIcon(a);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(a)}}this.setContextMenuGroupVisibility()}setEditMenuRecurringTemplateIcon(e,t){this.viewPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}setEditMenuScheduleIcon(e,t){this.viewPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}}}}]);
//# sourceMappingURL=attendance-recurring_schedule_control-RecurringScheduleControlViewController.bundle.js.map?v=699904b46c5d6cf080a2