{"version":3,"sources":["webpack://timetrex/./interface/html5/views/attendance/schedule/ScheduleShiftViewController.js"],"names":["ScheduleShiftViewController","BaseViewController","options","_","defaults","el","schedule_status_array","user_status_array","user_group_array","user_api","user_group_api","date_api","absence_policy_api","total_time","pre_total_time","is_mass_adding","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APISchedule","APIAbsencePolicy","APIUser","APIUserGroup","Global","getProductEdition","job_api","APIJob","job_item_api","APIJobItem","APITTDate","initPermission","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","exclude","ContextMenuIconName","copy","include","ignoreWarning","record","$this","is_mass_editing","mass_record_shared","key","edit_view_ui_dic","hasOwnProperty","widget","isSet","isChecked","getEnabled","getValue","i","mass_edit_record_ids","length","mass_record_single","clone","push","collectUIDataToCurrentEditRecord","uniformVariable","current_edit_record","key_name","onResult","result","onSaveResult","mass_record","validateResult","p_id","PermissionManager","validate","show_search_tab","jobUIValidate","show_job_ui","jobItemUIValidate","show_job_item_ui","branchUIValidate","show_branch_ui","departmentUIValidate","show_department_ui","initDropDownOption","res","getResult","buildRecordArray","getUserGroup","buildTreeRecord","adv_search_field_ui_dic","setSourceData","buildEditViewUI","form_item_input","widgetContainer","tab_model","setTabModel","navigation","AComboBox","api_class","id","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_schedule_column1","edit_view_tab","find","edit_view_tabs","loadWidgetByName","FormItemType","AWESOME_BOX","set_empty","checkOpenPermission","set_special_empty","field","addition_source_function","target","source_data","onEmployeeSourceCreate","default_args","setDefaultArgs","addEditFieldToColumn","COMBO_BOX","TComboBox","DATE_PICKER","TDatePicker","validation_field","TRangePicker","TIME_PICKER","TTimePicker","TEXT","TText","APISchedulePolicy","customSearchFilter","filter","setAbsencePolicyFilter","setClassStyle","float","icon","bind","exchangeBalance","balance_content","append","APIBranch","onSourceDataCreate","added_items","value","TTUUID","not_exist_id","label","default_item","detachElement","APIDepartment","setRealValueCallBack","val","job_coder","setValue","manual_id","TEXT_INPUT","TTextInput","disable_keyup_event","addClass","job_item_coder","TEXT_AREA","TTextArea","width","parent","attachElement","display_columns","getDisplayColumns","first_item","each","index","content","name","type","unshift","did_clean_dic","column","edit_view_form_item_dic","tab_id","attr","hasClass","zero_id","is_edit","parents","hide","show","css","is_viewing","setEnabled","b_div","next","result_data","company","LocalCacheData","current_company","sub_view_mode","parent_key","parent_value","user_id","initEditView","filter_data","filter_columns","absence_policy","open_item","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","APIPayPeriod","tree_mode","APIUserTitle","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","getField","c_value","setJobItemValueWhenJobChanged","status_id","job_id","setCheckBox","onJobQuickSearch","onStatusChange","getAbsencePolicy","isArray","setEditMenu","getScheduleTotalTime","getProjectedAbsencePolicyBalance","date_stamp","async","available_balance","current_time","remaining_balance","projected_balance","projected_remaining_balance","getTimeUnit","container","p_str","html","user_ids","args","records","new_records","tmp_records","start_date_stamps","edit_record","ur","dates","uniformDates","d","Array","parserDatesRange","new_record","er","start_date_stamp","date","split","resultArray","beginDate","strToDate","endDate","nextDate","getTime","format","Date","setDate","getDate","date_range","indexOf","setDefaultData","setAllowMultipleSelection","date_array","setEditViewDataDone","startTime","endTime","schedulePolicyId","setEditViewWidgetsMode","editFieldResize"],"mappings":"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","file":"attendance-schedule-ScheduleShiftViewController.bundle.js?v=e787ff5846cc0b9cf3aa","sourcesContent":["export class ScheduleShiftViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#schedule_shift_view_container',\n\n\n\t\t\tschedule_status_array: null,\n\n\t\t\tuser_status_array: null,\n\n\t\t\tuser_group_array: null,\n\n\t\t\tuser_api: null,\n\t\t\tuser_group_api: null,\n\t\t\tdate_api: null,\n\t\t\tabsence_policy_api: null,\n\n\t\t\ttotal_time: null,\n\t\t\tpre_total_time: 0,\n\n\t\t\tis_mass_adding: false\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'ScheduleShiftEditView.html';\n\t\tthis.permission_id = 'schedule';\n\t\tthis.viewId = 'ScheduleShift';\n\t\tthis.script_name = 'ScheduleShiftView';\n\t\tthis.table_name_key = 'schedule';\n\t\tthis.context_menu_name = $.i18n._( 'Schedule Shift' );\n\t\tthis.navigation_label = $.i18n._( 'Schedule' ) + ':';\n\t\tthis.api = TTAPI.APISchedule;\n\t\tthis.absence_policy_api = TTAPI.APIAbsencePolicy;\n\t\tthis.user_api = TTAPI.APIUser;\n\t\tthis.user_group_api = TTAPI.APIUserGroup;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\n\t\t}\n\n\t\tthis.date_api = TTAPI.APITTDate;\n\n\t\tthis.initPermission();\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.copy],\n\t\t\tinclude: []\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\t// this function will shortly be deprecated and replaced by BaseViewController.onViewClick(), but this intermediatiary step of reorganizing the code\n\t\t// is to help debug in future by seeing how the current function was updated to match baseview.\n\t\t// initially, the code looped over all the mass edit records, and then for each record, it would loop over the changed fields and set them on that record.\n\t\t// instead, we will now just loop over the changed fields once, and then loop over the mass edit records, cloning this changed set of fields.\n\t\t// The clone itself is probably yet another loop internally, but this at least makes it easier to read and also allows the merge to use the common base view controller function.\n\n\t\tvar $this = this;\n\t\tvar record;\n\t\tif ( this.is_mass_editing ) {\n\t\t\trecord = [];\n\n\t\t\t// loop over all fields on the form, and track the ones that have changed\n\t\t\tvar mass_record_shared = {};\n\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\tmass_record_shared[key] = widget.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// loop over all the selected id's for the mass edit, and apply a copy of the changed fields to each\n\n\t\t\tfor ( var i = 0; i < this.mass_edit_record_ids.length; i++ ) {\n\t\t\t\t//create new copy of the fields that have changed.\n\t\t\t\tvar mass_record_single = Global.clone( mass_record_shared );\n\t\t\t\tmass_record_single['id'] = $this.mass_edit_record_ids[i];\n\n\t\t\t\t// push the single record into the array of mass edit records to be saved\n\t\t\t\trecord.push( mass_record_single );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.collectUIDataToCurrentEditRecord();\n\t\t\trecord = this.uniformVariable( this.current_edit_record );\n\t\t}\n\n\t\tthis.api['set' + this.api.key_name]( record, false, ignoreWarning, {\n\t\t\tonResult: function( result ) {\n\n\t\t\t\t$this.onSaveResult( result );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\t//Make sure this.current_edit_record is updated before validate\n\tvalidate() {\n\t\tvar $this = this;\n\t\tvar record = {};\n\t\tif ( this.is_mass_editing ) {\n\t\t\tvar record = [];\n\t\t\tfor ( var i = 0; i < this.mass_edit_record_ids.length; i++ ) {\n\t\t\t\tvar mass_record = {};\n\t\t\t\tmass_record['id'] = $this.mass_edit_record_ids[i];\n\t\t\t\tfor ( var key in this.edit_view_ui_dic ) {\n\n\t\t\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\t\t\tif ( Global.isSet( widget.isChecked ) ) {\n\t\t\t\t\t\tif ( widget.isChecked() && widget.getEnabled() ) {\n\t\t\t\t\t\t\tmass_record[key] = widget.getValue();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\trecord.push( mass_record );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.collectUIDataToCurrentEditRecord();\n\t\t\trecord = this.uniformVariable( this.current_edit_record );\n\t\t}\n\n\t\tthis.api['validate' + this.api.key_name]( record, {\n\t\t\tonResult: function( result ) {\n\t\t\t\t$this.validateResult( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tjobUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = this.permission_id;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job' ) &&\n\t\t\t( Global.getProductEdition() >= 20 ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tjobItemUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'job_item', 'enabled' ) &&\n\t\t\tPermissionManager.validate( p_id, 'edit_job_item' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbranchUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_branch' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tdepartmentUIValidate( p_id ) {\n\n\t\tif ( !p_id ) {\n\t\t\tp_id = 'schedule';\n\t\t}\n\n\t\tif ( PermissionManager.validate( p_id, 'edit_department' ) ) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( PermissionManager.validate( this.permission_id, 'view' ) || PermissionManager.validate( this.permission_id, 'view_child' ) ) {\n\t\t\tthis.show_search_tab = true;\n\t\t} else {\n\t\t\tthis.show_search_tab = false;\n\t\t}\n\n\t\tif ( this.jobUIValidate() ) {\n\t\t\tthis.show_job_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_ui = false;\n\t\t}\n\n\t\tif ( this.jobItemUIValidate() ) {\n\t\t\tthis.show_job_item_ui = true;\n\t\t} else {\n\t\t\tthis.show_job_item_ui = false;\n\t\t}\n\n\t\tif ( this.branchUIValidate() ) {\n\t\t\tthis.show_branch_ui = true;\n\t\t} else {\n\t\t\tthis.show_branch_ui = false;\n\t\t}\n\n\t\tif ( this.departmentUIValidate() ) {\n\t\t\tthis.show_department_ui = true;\n\t\t} else {\n\t\t\tthis.show_department_ui = false;\n\t\t}\n\t}\n\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'status', 'status_id', this.api, function( res ) {\n\t\t\tres = res.getResult();\n\n\t\t\t$this.schedule_status_array = Global.buildRecordArray( res );\n\n\t\t} );\n\n\t\tthis.initDropDownOption( 'status', 'user_status_id', this.user_api, function( res ) {\n\t\t\tres = res.getResult();\n\n\t\t\t$this.user_status_array = Global.buildRecordArray( res );\n\t\t} );\n\n\t\tthis.user_group_api.getUserGroup( '', false, false, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tres = Global.buildTreeRecord( res );\n\t\t\t\t$this.user_group_array = res;\n\n\t\t\t\t$this.adv_search_field_ui_dic['group_ids'].setSourceData( res );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tcheckOpenPermission() {\n\t\tif ( Global.getProductEdition() >= 15 && PermissionManager.validate( 'schedule', 'view_open' ) ) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetOtherFieldReferenceField() {\n\t\treturn 'note';\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_schedule': { 'label': $.i18n._( 'Schedule' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedule,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule_schedule',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_schedule = this.edit_view_tab.find( '#tab_schedule' );\n\n\t\tvar tab_schedule_column1 = tab_schedule.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_schedule_column1 );\n\n\t\t// Employee\n\t\t// Employees\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUser,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_user',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: !this.checkOpenPermission(),\n\t\t\tset_special_empty: true,\n\t\t\tfield: 'user_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t} )\n\n\t\t} );\n\t\tvar default_args = {};\n\t\tdefault_args.permission_section = 'schedule';\n\t\tform_item_input.setDefaultArgs( default_args );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Employee' ), form_item_input, tab_schedule_column1, '' );\n\n\t\t// Status\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.schedule_status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_schedule_column1 );\n\n\t\t// Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TDatePicker( { field: 'start_date_stamp', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t//Mass Add Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\t\tform_item_input.TRangePicker( { field: 'start_date_stamps', validation_field: 'date_stamp' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t// In\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'start_time' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'In' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t// Out\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TIME_PICKER );\n\n\t\tform_item_input.TTimePicker( { field: 'end_time' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Out' ), form_item_input, tab_schedule_column1, '', null );\n\n\t\t// Total\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'total_time' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Total' ), form_item_input, tab_schedule_column1 );\n\n\t\t// Schedule Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_schedule',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'schedule_policy_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Schedule Policy' ), form_item_input, tab_schedule_column1 );\n\n\t\t//Absence Policy\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIAbsencePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_absences',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'absence_policy_id'\n\t\t} );\n\n\t\tform_item_input.customSearchFilter = function( filter ) {\n\t\t\treturn $this.setAbsencePolicyFilter( filter );\n\t\t};\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Absence Policy' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\t// Available Balance\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'available_balance' } );\n\t\tform_item_input.setClassStyle( { float: 'left', 'margin-right': '5px' } );\n\n\t\twidgetContainer = $( '<div style=\\'position: relative\\' class=\\'widget-h-box\\'></div>' );\n\t\tvar icon = $( '<img class=\\'balance_icon\\' src=\\'theme/default/images/infox16x16.png\\'></img>' );\n\t\ticon.bind( 'click', this.exchangeBalance );\n\t\tvar balance_content = $( '<div  class=\\'schedule-view-balance-info\\'></div>' );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( icon );\n\t\twidgetContainer.append( balance_content );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Available Balance' ), form_item_input, tab_schedule_column1, '', widgetContainer, true );\n\n\t\t// Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_branch_ui ) {\n\t\t\tthis.detachElement( 'branch_id' );\n\n\t\t}\n\n\t\t// Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id',\n\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t} ),\n\t\t\tadded_items: [\n\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t]\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_schedule_column1, '', null, true );\n\n\t\tif ( !this.show_department_ui ) {\n\t\t\tthis.detachElement( 'department_id' );\n\t\t}\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_ui ) {\n\t\t\t\tthis.detachElement( 'job_id' );\n\t\t\t}\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onSourceDataCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadded_items: [\n\t\t\t\t\t{ value: TTUUID.not_exist_id, label: Global.default_item },\n\t\t\t\t]\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_schedule_column1, '', widgetContainer, true );\n\n\t\t\tif ( !this.show_job_item_ui ) {\n\t\t\t\tthis.detachElement( 'job_item_id' );\n\t\t\t}\n\t\t}\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_schedule_column1, '', null, null, true );\n\t\tform_item_input.parent().width( '45%' );\n\n\t\tif ( this.is_mass_editing ) {\n\t\t\tthis.detachElement( 'total_time' );\n\t\t} else {\n\t\t\tthis.attachElement( 'total_time' );\n\t\t}\n\t}\n\n\tonSourceDataCreate( target, source_data ) {\n\t\tvar display_columns = target.getDisplayColumns();\n\t\tvar first_item = {};\n\n\t\t$.each( display_columns, function( index, content ) {\n\t\t\tfirst_item.id = TTUUID.not_exist_id;\n\t\t\tfirst_item[content.name] = Global.default_item;\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tsetEditViewWidgetsMode() {\n\t\tvar did_clean_dic = {};\n\t\tfor ( var key in this.edit_view_ui_dic ) {\n\t\t\tif ( !this.edit_view_ui_dic.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tvar widgetContainer = this.edit_view_form_item_dic[key];\n\t\t\tvar column = widget.parent().parent().parent();\n\t\t\tvar tab_id = column.parent().attr( 'id' );\n\t\t\tif ( !column.hasClass( 'v-box' ) ) {\n\t\t\t\tif ( !did_clean_dic[tab_id] ) {\n\t\t\t\t\tdid_clean_dic[tab_id] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch ( key ) {\n\t\t\t\tcase 'start_date_stamps':\n\t\t\t\t\tif ( ( !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing && !this.is_edit ) {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).show();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'start_date_stamp':\n\t\t\t\t\tif ( ( !this.current_edit_record.id || this.current_edit_record.id == TTUUID.zero_id ) && !this.is_mass_editing && !this.is_edit ) {\n\t\t\t\t\t\tthis.detachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.attachElement( key );\n\t\t\t\t\t\twidget.parents( '.edit-view-form-item-div' ).show();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\twidget.css( 'opacity', 1 );\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// #2831 Must check is_viewing, otherwise all fields are editable in View mode. Bug originated in 886a33c71174c10c0699cbf869a3cf2ebd200591\n\t\t\tif ( this.is_viewing ) {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( false );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif ( Global.isSet( widget.setEnabled ) ) {\n\t\t\t\t\twidget.setEnabled( true );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\texchangeBalance() {\n\n\t\tvar b_div = $( $( this ).next() );\n\t\tif ( b_div.css( 'display' ) === 'block' ) {\n\t\t\tb_div.css( 'display', 'none' );\n\t\t} else if ( b_div.css( 'display' ) === 'none' ) {\n\t\t\tb_div.css( 'display', 'block' );\n\n\t\t}\n\t}\n\n\tonAddResult( result ) {\n\t\tvar $this = this;\n\t\tvar result_data = result.getResult();\n\t\tif ( !result_data ) {\n\t\t\tresult_data = [];\n\t\t}\n\t\tresult_data.company = LocalCacheData.current_company.name;\n\t\tif ( $this.sub_view_mode && $this.parent_key ) {\n\t\t\tresult_data[$this.parent_key] = $this.parent_value;\n\t\t}\n\t\t// Default to Open\n\t\tresult_data === true && ( result_data = { user_id: TTUUID.zero_id } );\n\t\t!result_data.user_id && ( result_data.user_id = TTUUID.zero_id );\n\t\t$this.current_edit_record = result_data;\n\t\t$this.initEditView();\n\t}\n\n\tsetAbsencePolicyFilter( filter ) {\n\t\tif ( !filter.filter_data ) {\n\t\t\tfilter.filter_data = {};\n\t\t}\n\n\t\tfilter.filter_data.user_id = this.current_edit_record.user_id;\n\t\tif ( filter.filter_columns ) {\n\t\t\tfilter.filter_columns.absence_policy = true;\n\t\t}\n\n\t\treturn filter;\n\t}\n\n\tonEmployeeSourceCreate( target, source_data ) {\n\n\t\tif ( !this.checkOpenPermission() ) {\n\t\t\treturn source_data;\n\t\t}\n\n\t\tvar display_columns = target.getDisplayColumns();\n\n\t\tvar first_item = {};\n\t\t$.each( display_columns, function( index, content ) {\n\n\t\t\tfirst_item.id = TTUUID.zero_id;\n\t\t\tfirst_item[content.name] = Global.open_item;\n\n\t\t\treturn false;\n\t\t} );\n\n\t\t//Error: Object doesn't support property or method 'unshift' in /interface/html5/line 6953\n\t\tif ( !source_data || $.type( source_data ) !== 'array' ) {\n\t\t\tsource_data = [];\n\t\t}\n\t\tsource_data.unshift( first_item );\n\n\t\treturn source_data;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tvar $this = this;\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_id',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\taddition_source_function: ( function( target, source_data ) {\n\t\t\t\t\treturn $this.onEmployeeSourceCreate( target, source_data );\n\t\t\t\t} ),\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Pay Period' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'pay_period_id',\n\t\t\t\tlayout_name: 'global_Pay_period',\n\t\t\t\tapi_class: TTAPI.APIPayPeriod,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Start Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'start_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'End Date' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'end_date',\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.DATE_PICKER\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Employee Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'user_status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Branch' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'BranchView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Default Department' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'default_department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Group' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tmultiple: true,\n\t\t\t\tfield: 'group_ids',\n\t\t\t\tlayout_name: 'global_tree_column',\n\t\t\t\ttree_mode: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Title' ),\n\t\t\t\tfield: 'title_id',\n\t\t\t\tin_column: 2,\n\t\t\t\tlayout_name: 'global_job_title',\n\t\t\t\tapi_class: TTAPI.APIUserTitle,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Job' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_id',\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJob : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Task' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'job_item_id',\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tapi_class: ( Global.getProductEdition() >= 20 ) ? TTAPI.APIJobItem : null,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: false,\n\t\t\t\tadv_search: ( this.show_job_item_ui && ( Global.getProductEdition() >= 20 ) ),\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Branch' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'branch_id',\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'BranchView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Department' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'department_id',\n\t\t\t\tlayout_name: 'global_department',\n\t\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tscript_name: 'DepartmentView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Schedule Policy' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'schedule_policy_id',\n\t\t\t\tlayout_name: 'global_schedule',\n\t\t\t\tapi_class: TTAPI.APISchedulePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: true,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', {\n\t\t\t\t\t\tstatus_id: 10,\n\t\t\t\t\t\tjob_id: this.current_edit_record.job_id\n\t\t\t\t\t} );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'absence_policy_id':\n\t\t\tcase 'status_id':\n\t\t\t\tthis.onStatusChange();\n\t\t\t\tbreak;\n\t\t\tcase 'user_id':\n\t\t\t\tthis.edit_view_ui_dic['absence_policy_id'].setSourceData( null );\n\t\t\t\tthis.edit_view_ui_dic['absence_policy_id'].setValue( false );\n\t\t\t\tthis.current_edit_record['absence_policy_id'] = false;\n\t\t\t\tthis.getAbsencePolicy( this.current_edit_record[key] );\n\n\t\t\t\tif ( $.isArray( this.current_edit_record[key] ) && this.current_edit_record[key].length > 1 ) {\n\t\t\t\t\tthis.is_mass_adding = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.is_mass_adding = false;\n\t\t\t\t}\n\t\t\t\tthis.setEditMenu();\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.getScheduleTotalTime();\n\t\tthis.getProjectedAbsencePolicyBalance();\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tgetProjectedAbsencePolicyBalance() {\n\t\t$( this.edit_view_form_item_dic['available_balance'].find( '.schedule-view-balance-info' ) ).css( 'display', 'none' );\n\n\t\tif ( this.current_edit_record['absence_policy_id'] && this.edit_view_form_item_dic['absence_policy_id'].css( 'display' ) === 'block' && !this.is_mass_editing ) {\n\t\t\tvar user_id;\n\t\t\tif ( Global.isArray( this.current_edit_record['user_id'] ) && this.current_edit_record['user_id'].length === 1 ) {\n\t\t\t\tuser_id = this.current_edit_record['user_id'][0];\n\t\t\t} else if ( this.current_edit_record['user_id'] ) {\n\t\t\t\tuser_id = this.current_edit_record['user_id'];\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar date_stamp = this.current_edit_record['date_stamp'];\n\t\t\tvar result_data = this.absence_policy_api.getProjectedAbsencePolicyBalance( this.current_edit_record['absence_policy_id'], user_id, date_stamp, this.total_time, this.pre_total_time, { async: false } ).getResult();\n\n\t\t\tresult_data = result_data ? result_data : {\n\t\t\t\tavailable_balance: 0,\n\t\t\t\tcurrent_time: 0,\n\t\t\t\tremaining_balance: 0,\n\t\t\t\tprojected_balance: 0,\n\t\t\t\tprojected_remaining_balance: 0\n\t\t\t};\n\n\t\t\tthis.edit_view_ui_dic['available_balance'].setValue( Global.getTimeUnit( result_data.remaining_balance ) );\n\n\t\t\tvar container = $( this.edit_view_form_item_dic['available_balance'].find( '.schedule-view-balance-info' ) );\n\n\t\t\tvar p_str = '<table>';\n\t\t\tfor ( var key in result_data ) {\n\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'available_balance':\n\t\t\t\t\t\tp_str += '<tr>';\n\t\t\t\t\t\tp_str += '<td>' + $.i18n._( 'Available Balance' ) + ':' + '</td>';\n\t\t\t\t\t\tp_str += '<td>' + Global.getTimeUnit( result_data[key] ) + '</td>';\n\t\t\t\t\t\tp_str += '</tr>';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'current_time':\n\t\t\t\t\t\tp_str += '<tr>';\n\t\t\t\t\t\tp_str += '<td>' + $.i18n._( 'Current Time' ) + ':' + '</td>';\n\t\t\t\t\t\tp_str += '<td>' + Global.getTimeUnit( result_data[key] ) + '</td>';\n\t\t\t\t\t\tp_str += '</tr>';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'remaining_balance':\n\t\t\t\t\t\tp_str += '<tr>';\n\t\t\t\t\t\tp_str += '<td>' + $.i18n._( 'Remaining Balance' ) + ':' + '</td>';\n\t\t\t\t\t\tp_str += '<td>' + Global.getTimeUnit( result_data[key] ) + '</td>';\n\t\t\t\t\t\tp_str += '</tr>';\n\t\t\t\t\t\tp_str += '<tr><td colspan=\\'2\\'>&nbsp;</td></tr>';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'projected_balance':\n\t\t\t\t\t\tp_str += '<tr>';\n\t\t\t\t\t\tp_str += '<td>' + $.i18n._( 'Projected Balance by false' ) + ':' + '</td>';\n\t\t\t\t\t\tp_str += '<td>' + Global.getTimeUnit( result_data[key] ) + '</td>';\n\t\t\t\t\t\tp_str += '</tr>';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'projected_remaining_balance':\n\t\t\t\t\t\tp_str += '<tr>';\n\t\t\t\t\t\tp_str += '<td>' + $.i18n._( 'Projected Remaining Balance' ) + ':' + '</td>';\n\t\t\t\t\t\tp_str += '<td>' + Global.getTimeUnit( result_data[key] ) + '</td>';\n\t\t\t\t\t\tp_str += '</tr>';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tp_str += '</table>';\n\n\t\t\tcontainer.html( p_str );\n\t\t}\n\t\tthis.onStatusChange();\n\t}\n\n\tgetAbsencePolicy( user_ids ) {\n\t\tvar args = { filter_data: {} };\n\t\targs.filter_data.user_id = user_ids;\n\t\tthis.edit_view_ui_dic['absence_policy_id'].setDefaultArgs( args );\n\t}\n\n\tuniformVariable( records ) {\n\t\tvar new_records = [];\n\t\tif ( Global.isArray( records.user_id ) && records.user_id.length > 0 ) {\n\t\t\tvar user_ids = records.user_id;\n\t\t\tfor ( var key in user_ids ) {\n\t\t\t\tvar tmp_records = Global.clone( records );\n\t\t\t\ttmp_records.user_id = user_ids[key];\n\t\t\t\tnew_records.push( tmp_records );\n\t\t\t}\n\t\t} else {\n\t\t\tnew_records.push( this.current_edit_record );\n\t\t}\n\n\t\tif ( this.current_edit_record.start_date_stamps && new_records.length > 0 ) {\n\t\t\t//Allowing multiple dates\n\t\t\tvar edit_record = [];\n\t\t\tfor ( var ur in new_records ) {\n\t\t\t\tvar dates = this.uniformDates( new_records[ur].start_date_stamps, new_records[ur] );\n\n\t\t\t\tif ( Array.isArray( new_records[ur].start_date_stamps ) ) {\n\t\t\t\t\tdates = new_records[ur].start_date_stamps;\n\t\t\t\t} else {\n\t\t\t\t\tdates = this.parserDatesRange( new_records[ur].start_date_stamps );\n\t\t\t\t}\n\n\t\t\t\tfor ( var d in dates ) {\n\t\t\t\t\tvar new_record = {};\n\t\t\t\t\tfor ( var er in new_records[ur] ) {\n\t\t\t\t\t\tif ( er == 'start_date_stamps' ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnew_record[er] = new_records[ur][er];\n\t\t\t\t\t}\n\t\t\t\t\tnew_record.start_date_stamp = dates[d];\n\t\t\t\t\tnew_record.date_stamp = dates[d];\n\t\t\t\t\tedit_record.push( new_record );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tedit_record = this.current_edit_record;\n\t\t\tif ( $.isArray( edit_record.start_date_stamp ) && edit_record.start_date_stamp.length == 1 ) {\n\t\t\t\tedit_record.start_date_stamp = edit_record.start_date_stamp[0];\n\t\t\t}\n\t\t}\n\n\t\treturn edit_record;\n\t}\n\n\tparserDatesRange( date ) {\n\t\tvar dates = date.split( ' - ' );\n\t\tvar resultArray = [];\n\t\tvar beginDate = Global.strToDate( dates[0] );\n\t\tvar endDate = Global.strToDate( dates[1] );\n\n\t\tvar nextDate = beginDate;\n\n\t\twhile ( nextDate.getTime() < endDate.getTime() ) {\n\t\t\tresultArray.push( nextDate.format() );\n\t\t\tnextDate = new Date( new Date( nextDate.getTime() ).setDate( nextDate.getDate() + 1 ) );\n\t\t}\n\t\treturn dates;\n\t}\n\n\tuniformDates( date_range, record ) {\n\t\tvar dates = [];\n\t\tif ( !Array.isArray( date_range ) && date_range.indexOf( ' - ' ) == -1 ) {\n\t\t\tdates = [date_range];\n\t\t} else if ( Array.isArray( date_range ) ) {\n\t\t\tdates = date_range;\n\t\t} else {\n\t\t\tdates = this.parserDatesRange( date_range );\n\t\t}\n\n\t\treturn dates;\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t// When mass editing, these fields may not be the common data, so their value will be undefined, so this will cause their change event cannot work properly.\n\t\tthis.setDefaultData( {\n\t\t\t'status_id': 10\n\t\t} );\n\n\t\tif ( this.current_edit_record.id || this.is_mass_editing ) {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( false );\n\t\t} else {\n\t\t\tthis.edit_view_ui_dic.user_id.setAllowMultipleSelection( true );\n\t\t}\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) || key === 'date_stamp' ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'start_date_stamp':\n\t\t\t\t\tcase 'start_date_stamps':\n\t\t\t\t\t\tif ( !this.current_edit_record[key] ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar date_array;\n\t\t\t\t\t\tif ( !this.current_edit_record.id ) {\n\t\t\t\t\t\t\tdate_array = this.current_edit_record.start_date_stamps;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif ( Array.isArray( this.current_edit_record.start_date_stamp ) == false ) {\n\t\t\t\t\t\t\t\tdate_array = [this.current_edit_record.start_date_stamp];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.current_edit_record.start_date_stamp = date_array;\n\t\t\t\t\t\twidget.setValue( date_array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'total_time':\n\t\t\t\t\t\tthis.pre_total_time = ( this.is_add ) ? 0 : this.current_edit_record[key];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, user_id: this.current_edit_record.user_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { status_id: 10, job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'user_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tthis.getAbsencePolicy( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'date_stamp':\n\t\t\t\t\t\tthis.current_edit_record['start_date_stamp'] = this.current_edit_record[key];\n\t\t\t\t\t\tthis.current_edit_record['start_date_stamps'] = this.current_edit_record[key];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tgetScheduleTotalTime() {\n\t\tif ( this.is_mass_editing ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar startTime, endTime, date_stamp;\n\t\tif ( this.current_edit_record['start_date_stamps'] ) {\n\t\t\tdate_stamp = this.uniformDates( this.current_edit_record['start_date_stamps'], this.current_edit_record )[0];\n\t\t} else {\n\t\t\tdate_stamp = this.current_edit_record['date_stamp'];\n\t\t}\n\n\t\tvar startTime = date_stamp + ' ' + this.current_edit_record['start_time'];\n\t\tvar endTime = date_stamp + ' ' + this.current_edit_record['end_time'];\n\t\tvar schedulePolicyId = ( this.current_edit_record['schedule_policy_id'] ) ? this.current_edit_record['schedule_policy_id'] : '';\n\n\t\tif ( !schedulePolicyId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar user_id = this.current_edit_record.user_id;\n\n\t\tvar result = this.api.getScheduleTotalTime( startTime, endTime, schedulePolicyId, user_id, { async: false } );\n\t\tif ( result ) {\n\t\t\tthis.total_time = result.getResult();\n\n\t\t\tvar total_time = Global.getTimeUnit( this.total_time );\n\n\t\t\tthis.edit_view_ui_dic['total_time'].setValue( total_time );\n\n\t\t\tthis.current_edit_record['total_time'] = total_time;\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tthis.onStatusChange();\n\t\tthis.getScheduleTotalTime();\n\t\tthis.setEditViewWidgetsMode();\n\t\tthis.getProjectedAbsencePolicyBalance();\n\t}\n\n\tonStatusChange() {\n\t\tif ( this.current_edit_record['status_id'] == 20 ) {\n\t\t\tthis.attachElement( 'absence_policy_id' );\n\t\t\tif ( this.current_edit_record['absence_policy_id'] && this.current_edit_record['absence_policy_id'] != TTUUID.zero_id ) {\n\t\t\t\tthis.attachElement( 'available_balance' );\n\t\t\t} else {\n\t\t\t\tthis.detachElement( 'available_balance' );\n\t\t\t}\n\t\t} else {\n\t\t\tthis.detachElement( 'absence_policy_id' );\n\t\t\tthis.detachElement( 'available_balance' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\n\t}\n\n}\n"],"sourceRoot":""}