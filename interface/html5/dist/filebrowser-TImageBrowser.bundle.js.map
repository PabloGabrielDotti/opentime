{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImageBrowser.js"],"names":["$","jQuery","fn","TImageBrowser","options","Global","addCss","field","browser","opts","extend","defaults","$this","this","name","accept_filter","default_width","default_height","setEnabled","val","btn","find","removeAttr","removeClass","attr","addClass","clearErrorStyle","getFileName","getField","setEnableDelete","image","getValue","FormData","getImageSrc","setImage","hide","d","Date","getTime","css","setValue","each","o","meta","data","isSet","on","image_height","height","naturalHeight","image_width","width","naturalWidth","trigger","show","onImageLoad","changeHandler","bind","deleteImageHandler","FileReader","files","length","window","reader","readAsDataURL","onloadend","url","result"],"mappings":"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","file":"filebrowser-TImageBrowser.bundle.js?v=ce485b74040214272b62","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageBrowser = function( options ) {\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar id = 'file_browser';\n\t\tvar name = 'filedata';\n\t\tvar browser;\n\n\t\tvar accept_filter = '';\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\t\tvar enabled = true;\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.find( '.browser-form input' );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getFileName = function() {\n\n\t\t\treturn browser.val();\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\tvar form_data;\n\t\t\tif ( browser && browser.val() ) {\n\n\t\t\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\t\t\tform_data = $this.find( '.browser-form' );\n\t\t\t\t} else {\n\t\t\t\t\tform_data = new FormData( $( $this.find( '.browser-form' ) )[0] );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tform_data = null;\n\t\t\t}\n\n\t\t\treturn form_data;\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t$this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.each( function() {\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\t// var $this = this;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tbrowser = $( this ).find( '.browser' );\n\t\t\tvar image = $( this ).find( '.image' );\n\t\t\timage.hide();\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tif ( accept_filter ) {\n\t\t\t\tbrowser.attr( 'accept', accept_filter );\n\t\t\t} else {\n\t\t\t\taccept_filter = 'image/*';\n\t\t\t\tbrowser.attr( 'accept', 'image/*' );\n\t\t\t}\n\n\t\t\tbrowser.attr( 'id', id );\n\t\t\tbrowser.attr( 'name', name );\n\n\t\t\tif ( Global.isSet( o.changeHandler ) ) {\n\n\t\t\t\t$this.bind( 'imageChange', o.changeHandler );\n\t\t\t}\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\tthis.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tbrowser.bind( 'change', function() {\n\t\t\t\timage.hide();\n\n\t\t\t\tif ( typeof FileReader != 'undefined' ) {\n\n\t\t\t\t\tvar files = !!this.files ? this.files : [];\n\n\t\t\t\t\t// If no files were selected, or no FileReader support, return\n\t\t\t\t\tif ( !files.length || !window.FileReader ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( accept_filter === 'image/*' ) {\n\t\t\t\t\t\t// Create a new instance of the FileReader\n\t\t\t\t\t\tvar reader = new FileReader();\n\n\t\t\t\t\t\t// Read the local file as a DataURL\n\t\t\t\t\t\treader.readAsDataURL( files[0] );\n\n\t\t\t\t\t\t// When loaded, set image data as background of div\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = this.result;\n\t\t\t\t\t\t\timage.attr( 'src', url );\n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'imageChange', [$this] );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageBrowser.defaults = {};\n\n} )( jQuery );"],"sourceRoot":""}