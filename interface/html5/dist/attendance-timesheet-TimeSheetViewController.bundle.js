(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["attendance-timesheet-TimeSheetViewController","filebrowser-TImage","switch_button-SwitchButton"],{1469:()=>{!function(e){e.fn.TImage=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a=e.extend({},e.fn.TImage.defaults,t);return this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return null},this.setValue=function(e){if(e){var t=new Date;this.attr("src",e+"&t="+t.getTime())}else this.attr("src","")},this.each((function(){var t=e.meta?e.extend({},a,e(this).data()):a;i=t.field})),this},e.fn.TImage.defaults={},e(document).on("mouseover",".file-browser img",(function(t){var i=e(t.target).parents(".file-browser");if(!e(".file_browser_overlay")[0]&&1==e(t.target).attr("enable-delete")){var a=e(t.target).height(),s=(a-32)/2,r=e('<div class="file_browser_overlay"><img src="theme/default/images/delete-512.png" style="position:absolute;width:32px;height:32px;top:'+s+"px;left:"+s+'px;"></div>');r.css("position","absolute"),r.css("top","0px"),r.css("left","0"),r.css("cursor","pointer"),r.css("height",a+"px"),r.css("width","100%"),r.css("background","rgba(255,255,255,0.85)"),e(t.target).parents(".file-browser").append(r),e(document).on("click",".file_browser_overlay",(function(t){e(t.target).parent().find("img").attr("src");TAlertManager.showConfirmAlert(e.i18n._("This will permanently delete the image. Are you sure?"),"",(function(e){if(e){var t={type:"deleteClick",message:"Delete image clicked.",time:new Date};i.trigger(t)}}))})),e(document).on("mouseleave",".file-browser",(function(){(e(document).off("click",".file_browser_overlay"),e(".file_browser_overlay")[0])&&e(this).find(".file_browser_overlay").off().remove()}))}}))}(jQuery)},6618:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"SwitchButtonIcon":()=>a}),function(e){e.fn.SwitchButton=function(t){Global.addCss("global/widgets/switch_button/SwitchButton.css");var i=e.extend({},e.fn.SwitchButton.defaults,t),a=this,s=null,r=!0;return this.getEnabled=function(){return r},this.setEnable=function(e){r=e,e?this.removeClass("disable-element"):this.removeClass("disable-element").addClass("disable-element")},this.getValue=function(e){return e?s&&s.hasClass("selected")?1:0:!(!s||!s.hasClass("selected"))},this.setValue=function(e){s&&(s.removeClass("selected"),e&&s.addClass("selected"))},this.setIcon=function(e){s.addClass(e)},this.each((function(){var t=e.meta?e.extend({},i,e(this).data()):i;s=e("<div></div>"),a.append(s),t.tooltip&&s.attr("title",t.tooltip),a.setIcon(t.icon),s.click((function(e){if(!r)return e.stopImmediatePropagation(),void e.stopPropagation();a.setValue(!a.getValue())}))})),this},e.fn.SwitchButton.defaults={}}(jQuery);var a=function(){};a.daily_total="daily",a.weekly_total="weekly",a.all_employee="all-employee",a.strict_range="strict-range",a.wages="strict-range"},7193:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"TimeSheetViewController":()=>s});i(1469);var a=i(6618);class s extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#timesheet_view_container",status_array:null,type_array:null,employee_nav:null,start_date_picker:null,full_timesheet_data:null,full_format:"ddd-MMM-DD-YYYY",weekly_format:"ddd, MMM DD",day_format:"ddd",date_format:"MMM DD",start_date:null,end_date:null,select_cells_Array:[],select_punches_array:[],absence_select_cells_Array:[],accumulated_time_cells_array:[],premium_cells_array:[],timesheet_data_source:null,accumulated_time_source:null,accumulated_time_grid:null,accumulated_time_source_map:null,branch_grid:null,branch_source_map:null,branch_source:null,department_grid:null,department_source_map:null,department_source:null,job_grid:null,job_source_map:null,job_source:null,job_item_grid:null,job_item_source_map:null,job_item_source:null,premium_grid:null,premium_source_map:null,premium_source:null,absence_grid:null,absence_source:null,absence_original_source:null,accumulated_total_grid:null,accumulated_total_grid_source_map:null,accumulated_total_grid_source:null,punch_note_grid:null,punch_note_grid_source:null,verification_grid:null,verification_grid_source:null,grid_dic:null,pay_period_map:null,pay_period_data:null,timesheet_verify_data:null,api_timesheet:null,api_user_date_total:null,api_date:null,api_station:null,api_punch:null,absence_model:!1,select_drag_menu_id:"",is_mass_adding:!1,department_cell_count:0,branch_cell_count:0,premium_cell_count:0,job_cell_count:0,task_cell_count:0,absence_cell_count:0,punch_note_account:0,show_navigation_box:!0,station:null,scroll_position:0,job_api:null,job_item_api:null,api_absence_policy:null,pre_total_time:null,absence_available_balance_dataList:{},available_balance_info:null,show_job_ui:!1,show_job_item_ui:!1,show_branch_ui:!1,show_department_ui:!1,show_good_quantity_ui:!1,show_bad_quantity_ui:!1,show_note_ui:!1,show_station_ui:!1,show_absence_job_ui:!1,show_absence_job_item_ui:!1,show_absence_branch_ui:!1,show_absence_department_ui:!1,holiday_data_dic:{},grid_div:null,actual_time_label:null,column_maps:null,accmulated_order_map:{},url_args_before_set_date_url:{},allow_auto_switch:!0,previous_absence_policy_id:!1,events:{}}),super(e)}init(e){this.permission_id="punch",this.viewId="TimeSheet",this.script_name="TimeSheetView",this.context_menu_name=$.i18n._("TimeSheet"),this.navigation_label=$.i18n._("TimeSheet")+":",this.api=TTAPI.APIPunch,this.api_timesheet=TTAPI.APITimeSheet,this.api_user_date_total=TTAPI.APIUserDateTotal,this.api_date=TTAPI.APITTDate,this.api_station=TTAPI.APIStation,this.api_punch=TTAPI.APIPunch,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem),this.api_absence_policy=TTAPI.APIAbsencePolicy,this.scroll_position=0,this.grid_dic={},this.initPermission(),this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initEditView(){TTPromise.resolve("TimeSheetViewController","addclick"),super.initEditView()}onSubViewRemoved(e){e||this.search(),this.edit_view?this.setEditMenu():this.setDefaultMenu()}setScrollPosition(){this.scroll_position>0&&this.grid_div.scrollTop(this.scroll_position)}punchModeValidate(e){return e||(e="punch"),!(!PermissionManager.validate(e,"punch_timesheet")||!PermissionManager.validate(e,"manual_timesheet"))}jobUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate("job","enabled")||!PermissionManager.validate(e,"edit_job"))}jobItemUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_job_item")}updateSelectUserAndRefresh(e){this.employee_nav.updateSelectItem(e),this.search()}branchUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_department")}goodQuantityUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_quantity")}badQuantityUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate(e,"edit_quantity")||!PermissionManager.validate(e,"edit_bad_quantity"))}locationUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_location")}noteUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_note")}stationValidate(){return!!PermissionManager.validate("station","enabled")}initPermission(){super.initPermission(),PermissionManager.validate("punch","view")||PermissionManager.validate("punch","view_child")?(this.show_navigation_box=!0,this.show_search_tab=!0):(this.show_navigation_box=!1,this.show_search_tab=!1),this.punchModeValidate()?this.show_punch_mode_ui=!0:this.show_punch_mode_ui=!1,this.allow_auto_switch&&this.show_punch_mode_ui&&(this.is_auto_switch=!0),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1,this.locationUIValidate()?this.show_location_ui=!0:this.show_location_ui=!1,this.stationValidate()?this.show_station_ui=!0:this.show_station_ui=!1,this.jobUIValidate("absence")?this.show_absence_job_ui=!0:this.show_absence_job_ui=!1,this.jobItemUIValidate("absence")?this.show_absence_job_item_ui=!0:this.show_absence_job_item_ui=!1,this.branchUIValidate("absence")?this.show_absence_branch_ui=!0:this.show_absence_branch_ui=!1,this.departmentUIValidate("absence")?this.show_absence_department_ui=!0:this.show_absence_department_ui=!1}ownerOrChildPermissionValidate(e,t,i){var a;a=t&&t.indexOf("child")>-1?"is_child":"is_owner";var s=this.getSelectEmployee(!0);return!(!PermissionManager.validate(e,t)||s&&Global.isSet(s[a])&&(!s||!s[a]))}initOptions(){this.initDropDownOption("type"),this.initDropDownOption("status")}getCustomContextMenuModel(){var e={groups:{drag_and_drop:{label:$.i18n._("Drag & Drop"),id:this.viewId+"drag_and_drop"}},exclude:[ContextMenuIconName.export_excel,ContextMenuIconName.add,ContextMenuIconName.copy,ContextMenuIconName.copy_as_new],include:[{label:$.i18n._("New<br>Punch"),id:ContextMenuIconName.add_punch,group:"editor",icon:Icons.new_add,sort_order:910},{label:$.i18n._("New<br>Absence"),id:ContextMenuIconName.add_absence,group:"editor",icon:Icons.new_add,sort_order:920},{label:$.i18n._("Move"),id:ContextMenuIconName.move,group:"drag_and_drop",icon:Icons.move},{label:$.i18n._("Copy"),id:ContextMenuIconName.drag_copy,group:"drag_and_drop",icon:Icons.copy},{label:$.i18n._("In/Out"),id:ContextMenuIconName.in_out,group:"navigation",icon:Icons.in_out,permission_result:PermissionManager.checkTopLevelPermission("InOut"),permission:null},{label:$.i18n._("Schedules"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Pay<br>Stubs"),id:ContextMenuIconName.pay_stub,group:"navigation",icon:Icons.pay_stubs},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Edit Pay<br>Period"),id:ContextMenuIconName.edit_pay_period,group:"navigation",icon:Icons.pay_period},{label:$.i18n._("Accumulated<br>Time"),id:ContextMenuIconName.accumulated_time,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("ReCalculate<br>TimeSheet"),id:ContextMenuIconName.re_calculate_timesheet,group:"other",icon:Icons.re_cal_timesheet},{label:$.i18n._("Generate<br>Pay Stub"),id:ContextMenuIconName.generate_pay_stub,group:"other",icon:Icons.re_cal_pay_stub},{label:$.i18n._("Print"),id:ContextMenuIconName.print,group:"other",icon:Icons.print,type:RibbonSubMenuType.NAVIGATION,items:[{label:$.i18n._("Summary"),id:"print_summary"},{label:$.i18n._("Detailed"),id:"print_detailed"}],permission_result:!0,permission:!0}]};return Global.getProductEdition()>=15&&e.include.push({label:$.i18n._("Map"),id:ContextMenuIconName.map,group:"navigation",icon:Icons.map}),PermissionManager.validate("request","add")&&e.include.push({label:$.i18n._("Add<br>Request"),id:"AddRequest",group:"navigation",icon:Icons.request,permission_result:!0,permission:!0}),e}openEditView(){this.previous_absence_policy_id=!1,Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait(),this.edit_view||(this.is_edit=!0,this.initEditViewUI("TimeSheet","TimeSheetEditView.html"))}setEditViewWidgetsMode(){var e=!1;for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var i=this.edit_view_ui_dic[t];this.edit_view_form_item_dic[t];if(i.parent().parent().parent().hasClass("v-box")||e||(e=!0),this.absence_model)switch(t){case"punch_date":case"punch_time":case"status_id":case"type_id":case"quantity":case"station_id":case"has_image":case"latitude":case"split_punch_control":this.detachElement(t),i.css("opacity",0);break;case"punch_dates":this.is_mass_adding?(this.attachElement(t),i.css("opacity",1)):(this.detachElement(t),i.css("opacity",0));break;case"date_stamp":this.is_mass_adding?(this.detachElement(t),i.css("opacity",0)):(this.attachElement(t),i.css("opacity",1));break;case"total_time":case"src_object_id":case"override":this.attachElement(t),i.css("opacity",1);break;default:i.css("opacity",1)}else switch(t){case"punch_dates":this.is_mass_adding?(this.attachElement(t),i.css("opacity",1)):(this.detachElement(t),i.css("opacity",0));break;case"punch_date":this.is_mass_adding?(this.detachElement(t),i.css("opacity",0)):(this.attachElement(t),i.css("opacity",1));break;case"quantity":this.show_good_quantity_ui&&this.show_bad_quantity_ui&&(this.attachElement(t),i.css("opacity",1));break;case"station":this.attachElement(t),i.css("opacity",1);break;case"punch_time":case"status_id":case"type_id":case"has_image":case"latitude":this.attachElement(t),i.css("opacity",1);break;case"date_stamp":case"total_time":case"src_object_id":case"override":this.detachElement(t),i.css("opacity",0);break;default:i.css("opacity",1)}this.is_viewing?Global.isSet(i.setEnabled)&&i.setEnabled(!1):Global.isSet(i.setEnabled)&&i.setEnabled(!0)}}buildEditViewUI(){super.buildEditViewUI();var e,t,i=this,a={"tab_punch":{"label":this.absence_model?$.i18n._("Absence"):$.i18n._("Punch")},"tab_audit":!0};this.setTabModel(a);var s=this.edit_view_tab.find("#tab_punch").find(".first-column");(e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"first_last_name"}),this.addEditFieldToColumn($.i18n._("Employee"),e,s,""),(e=Global.loadWidgetByName(FormItemType.TIME_PICKER)).TTimePicker({field:"punch_time",validation_field:"time_stamp"}),t=$("<div class='widget-h-box'></div>"),this.actual_time_label=$("<span class='widget-right-label'></span>"),t.append(e),t.append(this.actual_time_label),this.addEditFieldToColumn($.i18n._("Time"),e,s,"",t,!0),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"punch_date",validation_field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TRangePicker({field:"punch_dates",validation_field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"total_time",mode:"time_unit"}),this.addEditFieldToColumn($.i18n._("Time"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"src_object_id",validation_field:"absence_policy_id"}),e.customSearchFilter=function(e){return i.setAbsencePolicyFilter(e)},this.addEditFieldToColumn($.i18n._("Type"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"available_balance"}),t=$("<div class='widget-h-box'></div>"),this.available_balance_info=$('<img class="available-balance-info" src="'+Global.getRealImagePath("images/infox16x16.png")+'">'),t.append(e),t.append(this.available_balance_info),this.addEditFieldToColumn($.i18n._("Available Balance"),[e],s,"",t,!0),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),e.setSourceData(i.type_array),t=$("<div class='widget-h-box'></div>");var r=Global.loadWidgetByName(FormItemType.CHECKBOX);r.TCheckbox({field:"disable_rounding"});var l=$("<span class='widget-right-label'>"+$.i18n._("Disable Rounding")+"</span>");if(t.append(e),this.is_viewing?this.addEditFieldToColumn($.i18n._("Punch Type"),e,s,"",t,!0):(t.append(l),t.append(r),this.addEditFieldToColumn($.i18n._("Punch Type"),[e,r],s,"",t,!0)),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),e.setSourceData(i.status_array),this.addEditFieldToColumn($.i18n._("In/Out"),e,s,"",null,!0),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn($.i18n._("Branch"),e,s,"",null,!0),this.absence_model?this.show_absence_branch_ui||this.detachElement("branch_id"):this.show_branch_ui||this.detachElement("branch_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn($.i18n._("Department"),e,s,"",null,!0),this.absence_model?this.show_absence_department_ui||this.detachElement("department_id"):this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&n.setValue(e.manual_id)},field:"job_id"}),t=$("<div class='widget-h-box'></div>");var n=Global.loadWidgetByName(FormItemType.TEXT_INPUT);n.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),n.addClass("job-coder"),t.append(n),t.append(e),this.addEditFieldToColumn($.i18n._("Job"),[e,n],s,"",t,!0),this.absence_model?this.show_absence_job_ui||this.detachElement("job_id"):this.show_job_ui||this.detachElement("job_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&d.setValue(e.manual_id)},field:"job_item_id"}),t=$("<div class='widget-h-box'></div>");var d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),t.append(d),t.append(e),this.addEditFieldToColumn($.i18n._("Task"),[e,d],s,"",t,!0),this.absence_model?this.show_absence_job_item_ui||this.detachElement("job_item_id"):this.show_job_item_ui||this.detachElement("job_item_id")}if(Global.getProductEdition()>=20){var o=Global.loadWidgetByName(FormItemType.TEXT_INPUT);o.TTextInput({field:"quantity"}),o.addClass("quantity-input");var _=$("<span class='widget-right-label'>"+$.i18n._("Good")+": </span>"),c=Global.loadWidgetByName(FormItemType.TEXT_INPUT);c.TTextInput({field:"bad_quantity"}),c.addClass("quantity-input");var u=$("<span class='widget-right-label'>/ "+$.i18n._("Bad")+": </span>");(t=$("<div class='widget-h-box'></div>")).append(_),t.append(o),t.append(u),t.append(c),this.addEditFieldToColumn($.i18n._("Quantity"),[o,c],s,"",t,!0),this.show_bad_quantity_ui||this.show_good_quantity_ui?(this.show_bad_quantity_ui||(u.hide(),c.hide()),this.show_good_quantity_ui||(_.hide(),o.hide())):this.detachElement("quantity")}if((e=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),e,s,"",null,!0,!0),e.parent().width("45%"),this.show_note_ui||this.detachElement("note"),(e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"override"}),this.addEditFieldToColumn($.i18n._("Override"),e,s,"",null,!0,!0),Global.getProductEdition()>=15){var h=Global.loadWidgetByName(FormItemType.TEXT);h.TText({field:"latitude"});var m=Global.loadWidgetByName(FormItemType.TEXT);m.TText({field:"longitude"}),t=$("<div class='widget-h-box link-widget-box'></div>");var p=Global.loadWidgetByName(FormItemType.TEXT);p.TText({field:"position_accuracy"}),l=$("<span class='widget-right-label'>"+$.i18n._("Accuracy")+":</span>");var g=$('<img class="widget-h-box-mapIcon" src="framework/leaflet/images/marker-icon-red.png" >');this.location_wrapper=$('<div class="widget-h-box-mapLocationWrapper"></div>'),t.append(g),t.append(this.location_wrapper),this.location_wrapper.append(h),this.location_wrapper.append($("<span>, </span>")),this.location_wrapper.append(m),this.location_wrapper.append(l),this.location_wrapper.append(p),this.location_wrapper.append($("<span>m</span>")),this.addEditFieldToColumn($.i18n._("Location"),[h,m,p],s,"",t,!0),t.click((function(){i.onMapClick()})),(this.is_edit||this.is_viewing)&&this.show_location_ui||t.parents(".edit-view-form-item-div").hide()}(e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"station_id"}),this.addEditFieldToColumn($.i18n._("Station"),e,s,"",null,!0,!0),e.click((function(){i.current_edit_record.station_id&&i.show_station_ui&&IndexViewController.openEditView(i,"Station",i.current_edit_record.station_id)})),(e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"split_punch_control"}),this.addEditFieldToColumn($.i18n._("Split Existing Punches"),e,s,"",null,!0,!0),0==this.is_mass_adding&&this.detachElement("split_punch_control"),(e=Global.loadWidgetByName(FormItemType.IMAGE)).TImage({field:"punch_image"}),this.addEditFieldToColumn($.i18n._("Image"),e,s,"",null,!0,!0)}onEditStationDone(){this.setStation()}setAbsencePolicyFilter(e){return e.filter_data||(e.filter_data={}),e.filter_data.user_id=this.current_edit_record.user_id,e.filter_columns&&(e.filter_columns.absence_policy=!0),e}onSetSearchFilterFinished(){}onBuildBasicUIFinished(){}onBuildAdvUIFinished(){}parserDatesRange(e){for(var t=e.split(" - "),i=[],a=Global.strToDate(t[0]),s=Global.strToDate(t[1]),r=a;r.getTime()<s.getTime();)i.push(r.format()),r=new Date(new Date(r.getTime()).setDate(r.getDate()+1));return i.push(t[1]),i}validate(){var e=this,t=this.current_edit_record;if(this.is_mass_editing){t=[];for(var i=this.mass_edit_record_ids.length,a=0;a<i;a++){var s=Global.clone(this.current_edit_record);s.id=this.mass_edit_record_ids[a],t.push(s)}}if(this.is_mass_adding){t=[];var r=this.current_edit_record.punch_dates;r&&r.indexOf(" - ")>0&&(r=this.parserDatesRange(r));for(a=0;a<r.length;a++){var l=Global.clone(this.current_edit_record);delete l.punch_dates,this.absence_model?l.date_stamp=r[a]:l.punch_date=r[a],t.push(l)}}this.absence_model?this.api_user_date_total["validate"+this.api_user_date_total.key_name](t,{onResult:function(t){e.clearErrorTips(),t.isValid()?e.setEditMenu():(e.setErrorMenu(),e.setErrorTips(t))}}):this.api["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();if(this.current_edit_record){switch(this.current_edit_record[i]=a,i){case"job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"job_item_id",{status_id:10,job_id:this.current_edit_record.job_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0));break;case"job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(i,a),t=!0);break;case"punch_dates":this.setEditMenu()}this.absence_model?("total_time"===i?this.current_edit_record&&(this.current_edit_record[i]=Global.parseTimeUnit(a),this.current_edit_record.start_time_stamp=!1,this.current_edit_record.end_time_stamp=!1):this.current_edit_record[i]=a,"override"!==i&&this.edit_view_ui_dic.override&&(this.edit_view_ui_dic.override.setValue(!0),this.current_edit_record.override=!0)):this.current_edit_record[i]=a,t||(this.absence_model&&("total_time"!==i&&"date_stamp"!==i&&"punch_dates"!==i&&"src_object_id"!==i||this.onAvailableBalanceChange()),this.validate())}}buildSearchAndLayoutUI(){var e=this.search_panel.find("div #saved_layout_content_div"),t=$(Global.loadWidget("global/widgets/search_panel/FormItem.html")),i=t.find(".form-item-label"),a=t.find(".form-item-input-div");i.text($.i18n._("Save Search As")+": "),this.save_search_as_input=Global.loadWidget("global/widgets/text_input/TTextInput.html"),this.save_search_as_input=$(this.save_search_as_input),this.save_search_as_input.TTextInput();var s=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Save")+"'></input>");a.append(this.save_search_as_input),a.append(s);var r=this;s.click((function(){r.onSaveNewLayout()})),this.previous_saved_layout_div=$("<div class='previous-saved-layout-div'></div>"),a.append(this.previous_saved_layout_div),i=$("<span style='margin-left: 5px' >"+$.i18n._("Previous Saved Searches")+":</span>"),this.previous_saved_layout_div.append(i),this.previous_saved_layout_selector=$("<select style='margin-left: 5px' class='t-select'>");var l=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Update")+"'></input>"),n=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Delete")+"'></input>");l.click((function(){r.onUpdateLayout()})),n.click((function(){r.onDeleteLayout()})),this.previous_saved_layout_div.append(this.previous_saved_layout_selector),this.previous_saved_layout_div.append(l),this.previous_saved_layout_div.append(n),e.append(t),this.previous_saved_layout_div.css("display","none")}checkTimesheetData(){return!0!==this.full_timesheet_data}render(){var e=this;super.render();var t=$(this.el).find(".control-bar"),i=t.find(".date-chooser-div"),s=t.find(".employee-nav-div"),r=t.find(".action-chooser-div");this.show_navigation_box?s.css("display","block"):s.css("display","none"),this.wage_btn=r.find("#wages"),this.wage_btn=this.wage_btn.SwitchButton({icon:a.SwitchButtonIcon.wages,tooltip:$.i18n._("Show Wages")}),this.wage_btn.click((function(){e.onWageOrModeChange("wage")})),PermissionManager.checkTopLevelPermission("Wage")?this.wage_btn.show():this.wage_btn.hide(),this.timezone_btn=r.find("#timezone"),this.timezone_btn=this.timezone_btn.SwitchButton({icon:a.SwitchButtonIcon.all_employee,tooltip:$.i18n._("Use Employees Timezone")}),this.timezone_btn.click((function(){e.onWageOrModeChange("timezone")})),PermissionManager.validate("punch","view")||PermissionManager.validate("punch","view_child")?this.timezone_btn.show():this.timezone_btn.hide(),this.start_date_picker=Global.loadWidgetByName(FormItemType.DATE_PICKER),this.start_date_picker.TDatePicker({field:"start_date"});var l=$("<span class='label'>"+$.i18n._("Date")+":</span><img class='left-arrow arrow' src="+Global.getRealImagePath("images/left_arrow.png")+"><div class='date-picker-div'></div><img class='right-arrow arrow' src="+Global.getRealImagePath("images/right_arrow.png")+">");i.append(l),i.find(".date-picker-div").append(this.start_date_picker);var n=i.find(".left-arrow"),d=i.find(".right-arrow");function o(t){e.doNextIfNoValueChangeInManualGrid((function(){e.setDatePickerValue(t),e.search()}),(function(){e.setDatePickerValue(LocalCacheData.last_timesheet_selected_date)}))}n.bind("click",(function(){if(e.checkTimesheetData()&&e.timesheet_columns){var t=Global.strToDate(e.getSelectDate()?e.getSelectDate():(new Date).format()),i=new Date(new Date(t.getTime()).setDate(t.getDate()-7)).format();e.first_build=!0,o(i),e.setDefaultMenu()}})),d.bind("click",(function(){if(e.checkTimesheetData()&&e.timesheet_columns){var t=Global.strToDate(e.getSelectDate()?e.getSelectDate():(new Date).format()),i=new Date(new Date(t.getTime()).setDate(t.getDate()+7)).format();e.first_build=!0,o(i),e.setDefaultMenu()}})),this.start_date_picker.bind("formItemChange",(function(){var t=e.getSelectDate()?e.getSelectDate():(new Date).format();e.first_build=!0,o(t)}));var _=s.find(".navigation-label"),c=s.find(".left-click"),u=s.find(".right-click"),h=s.find(".navigation-widget-div");this.employee_nav=Global.loadWidgetByName(FormItemType.AWESOME_BOX);this.employee_nav=this.employee_nav.AComboBox({id:"employee_navigation",api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",init_data_immediately:!0,default_args:{permission_section:"punch"},show_search_inputs:!0,always_include_columns:["default_branch_id","default_department_id","default_job_id","default_job_item_id"],width:200,is_static_width:!0,setRealValueCallBack:function(t){e.userValueSet(t)}}),h.append(this.employee_nav),this.employee_nav.bind("formItemChange",(function(){e.doNextIfNoValueChangeInManualGrid((function(){var t=e.getSelectEmployee();e.edit_view||e.reSetURL();e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,LocalCacheData.last_timesheet_selected_user!=t&&e.search();e.setEmployeeNavArrowsStatus(),e.absence_model=!1,e.setDefaultMenu()}),(function(){e.employee_nav.setValue(LocalCacheData.last_timesheet_selected_user)})),Global.triggerAnalyticsEditViewNavigation("navigation",e.viewId)})),this.employee_nav.bind("initSourceComplete",(function(){e.setEmployeeNavArrowsStatus()})),c.attr("src",Global.getRealImagePath("images/left_arrow.png")),u.attr("src",Global.getRealImagePath("images/right_arrow.png")),u.click((function(){function t(){e.edit_view||e.reSetURL(),e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,e.search(),e.setEmployeeNavArrowsStatus()}u.hasClass("disabled")||(e.doNextIfNoValueChangeInManualGrid((function(){var i,a=e.employee_nav.getSelectIndex(),s=e.employee_nav.getSourceData(),r=e.employee_nav.getCurrentOpenPage();s&&a<s.length-1?(i=e.employee_nav.getItemByIndex(a+1),e.employee_nav.setValue(i),t()):s&&a===s.length-1?e.employee_nav.onADropDownSearch("unselect_grid",r+1,"first",t,!1):(i=e.employee_nav.getItemByIndex(0),e.employee_nav.setValue(i),t())})),Global.triggerAnalyticsEditViewNavigation("right-arrow",e.viewId))})),c.click((function(){c.hasClass("disabled")||(e.doNextIfNoValueChangeInManualGrid((function(){var t,i=e.employee_nav.getSelectIndex(),a=e.employee_nav.getCurrentOpenPage();i>0?(t=e.employee_nav.getItemByIndex(i-1),e.employee_nav.setValue(t),s()):a>1?e.employee_nav.onADropDownSearch("unselect_grid",a-1,"last",s,!1):(t=e.employee_nav.getItemByIndex(0),e.employee_nav.setValue(t),s());function s(){e.edit_view||e.reSetURL(),e.allow_auto_switch&&(e.is_auto_switch=!0),e.first_build=!0,e.search(),e.setEmployeeNavArrowsStatus()}})),Global.triggerAnalyticsEditViewNavigation("left-arrow",e.viewId))})),_.text($.i18n._("Employee")+":"),this.toggle_button=$(this.el).find(".toggle-button-div");var m=[{label:$.i18n._("Punch"),value:"punch"},{label:$.i18n._("Manual"),value:"manual"}];this.toggle_button=this.toggle_button.TToggleButton({data_provider:m}),this.show_punch_mode_ui?this.toggle_button.bind("change",(function(t,i){e.onWageOrModeChange("manual")})):this.toggle_button.remove()}doNextIfNoValueChangeInManualGrid(e,t,i){!i&&(i="manual");var a=this;this.getPunchMode()===i&&this.editor?this.editor.getValue().length>0?TAlertManager.showConfirmAlert(Global.modify_alert_message,"",(function(i){i?(a.wait_auto_save&&clearTimeout(a.wait_auto_save),e()):t&&t()})):e():e()}getPunchMode(){return this.toggle_button?this.toggle_button.getValue():"punch"}handleOverrideUserPreferenceCookie(e){1==this.timezone_btn.getValue()?setCookie("OverrideUserPreference",'{ "user_id": "'+e+'"}'):deleteCookie("OverrideUserPreference")}onWageOrModeChange(e){this.first_build=!0;var t=this;function i(){t.edit_view||t.reSetURL(),t.search(),t.setDefaultMenu()}"wage"===e?this.doNextIfNoValueChangeInManualGrid(i,(function(){t.wage_btn.setValue(!t.wage_btn.getValue(!0))})):"timezone"===e?(this.handleOverrideUserPreferenceCookie(this.getSelectEmployee()),this.doNextIfNoValueChangeInManualGrid(i,(function(){t.timezone_btn.setValue(!t.timezone_btn.getValue(!0))}))):"manual"===e&&this.doNextIfNoValueChangeInManualGrid(i,(function(){t.toggle_button.setValue("manual")}),"punch")}setEmployeeNavArrowsStatus(){var e=this,t=$(this.el).find(".employee-nav-div"),i=t.find(".left-click"),a=t.find(".right-click"),s=e.employee_nav.getSelectIndex(),r=e.employee_nav.getSourceData();a.removeClass("disabled"),i.removeClass("disabled");var l=e.employee_nav.getPagerData(),n=e.employee_nav.getCurrentOpenPage();(!r||s===r.length-1&&n===l.last_page_number)&&a.addClass("disabled"),(!r||0===s&&1===n)&&i.addClass("disabled")}onClearSearch(){var e,t=!1;if(!(this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0))return this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.column_selector&&this.column_selector.setSelectGridData(this.default_display_columns),this.sort_by_selector&&this.sort_by_selector.setValue(null),void this.onSaveNewLayout(BaseViewController.default_layout_name);e=$(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value");var i=BaseViewController.default_layout_name;this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,t=!0;var a,s=this.getValidSearchFilter();t&&((a={}).id=e,a.data={},a.data.filter_data=s);var r=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(e){e.isValid()&&(r.clearViewLayoutCache(),r.need_select_layout_name=i,r.initLayout())}})}onUpdateLayout(){var e=$(this.previous_saved_layout_selector).children("option:selected").attr("value"),t=$(this.previous_saved_layout_selector).children("option:selected").text(),i=this.getValidSearchFilter(),a={};a.id=e,a.data={},a.data.filter_data=i;var s=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(e){e.isValid()&&(s.clearViewLayoutCache(),s.need_select_layout_name=t,s.initLayout())}})}onSaveNewLayout(e){var t;if((t=Global.isSet(e)?e:this.save_search_as_input.getValue())&&!(t.length<1)){var i=this.getValidSearchFilter(),a={};a.script=this.script_name,a.name=t,a.is_default=!1,a.data={},a.data.filter_data=i;var s=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(e){e.isValid()?(s.clearViewLayoutCache(),s.need_select_layout_name=t,s.initLayout()):TAlertManager.showErrorAlert(e)}})}}onSearch(){var e,t;if(Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait(),this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.getSearchPanelFilter(),this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0)if(e=$(this.previous_saved_layout_selector).children("option:contains('"+BaseViewController.default_layout_name+"')").attr("value"),t=BaseViewController.default_layout_name,e){var i=this.getValidSearchFilter(),a={};a.id=e,a.data={},a.data.filter_data=i,ProgressBar.showOverlay();var s=this;this.user_generic_data_api.setUserGenericData(a,{onResult:function(e){e.isValid()&&(s.clearViewLayoutCache(),s.need_select_layout_name=t,s.initLayout())}})}else this.onSaveNewLayout(BaseViewController.default_layout_name);else this.onSaveNewLayout(BaseViewController.default_layout_name)}updateManualGrid(){var e=this,t=this.start_date_picker.getValue(),i=this.getSelectEmployee();ProgressBar.noProgressForNextCall(),e.handleOverrideUserPreferenceCookie(i),e.api_timesheet.getTimeSheetData(i,t,{onResult:function(t){ProgressBar.removeNanobar(),e.full_timesheet_data=t.getResult(),!0!==e.full_timesheet_data&&e.full_timesheet_data.hasOwnProperty("timesheet_dates")&&(e.start_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.start_display_date),e.end_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.end_display_date),e.setDefaultMenu(),e.initInsideEditorData(!0),e.accumulated_time_source_map={},e.branch_source_map={},e.department_source_map={},e.job_source_map={},e.job_item_source_map={},e.premium_source_map={},e.accumulated_total_grid_source_map={},e.accumulated_time_source=[],e.branch_source=[],e.department_source=[],e.job_source=[],e.job_item_source=[],e.premium_source=[],e.accumulated_total_grid_source=[],e.verification_grid_source=[],e.onReloadSubGridResult(t))}})}search(e,t){this.accumulated_time_cells_array=[],this.premium_cells_array=[],this.accumulated_time_source_map={},this.branch_source_map={},this.department_source_map={},this.job_source_map={},this.job_item_source_map={},this.premium_source_map={},this.accumulated_total_grid_source_map={},this.accumulated_time_source=[],this.branch_source=[],this.department_source=[],this.job_source=[],this.job_item_source=[],this.premium_source=[],this.absence_source=[],this.accumulated_total_grid_source=[],this.punch_note_grid_source=[],this.verification_grid_source=[],this.select_cells_Array=[],this.select_punches_array=[],this.branch_cell_count=0,this.department_cell_count=0,this.premium_cell_count=0,this.job_cell_count=0,this.task_cell_count=0,this.absence_cell_count=0,this.punch_note_account=0,this.select_punches_array=[];var i=this,a=Global.convertLayoutFilterToAPIFilter(this.select_layout),s=this.start_date_picker?this.start_date_picker.getValue():"",r=this.getSelectEmployee();function l(){if(LocalCacheData.last_timesheet_selected_date=s,LocalCacheData.last_timesheet_selected_user=i.getSelectEmployee(),LocalCacheData.last_timesheet_selected_user){LocalCacheData.last_timesheet_selected_show_wage=!!i.wage_btn&&i.wage_btn.getValue(!0),LocalCacheData.last_timesheet_selected_timezone=!!i.timezone_btn&&i.timezone_btn.getValue(!0),i.toggle_button&&(LocalCacheData.last_timesheet_selected_punch_mode=i.toggle_button.getValue());var t={filter_data:a};if(ProgressBar.showOverlay(),!i.api_timesheet||!i.api_timesheet||"function"!=typeof i.api_timesheet.getTimeSheetData)return;r&&(i.handleOverrideUserPreferenceCookie(r),i.api_timesheet.getTimeSheetData(r,s,t,{onResult:function(t){i.full_timesheet_data=t.getResult(),!0!==i.full_timesheet_data&&i.full_timesheet_data.hasOwnProperty("timesheet_dates")&&(i.start_date=Global.strToDate(i.full_timesheet_data.timesheet_dates.start_display_date),i.end_date=Global.strToDate(i.full_timesheet_data.timesheet_dates.end_display_date),i.buildCalendars(),e&&i.setDefaultMenu(!0),i.searchDone())}}))}}t?l():this.doNextIfNoValueChangeInManualGrid(l,(function(){$(".button-rotate").removeClass("button-rotate")}))}buildVerificationGrid(){var e=[];Global.isSet(this.verification_grid)||$(this.el).find("#verification_grid").attr("id",this.ui_id+"_verification_grid");var t=this.ui_id+"_verification_grid",i={name:"pay_period",index:"pay_period",label:$.i18n._("Pay Period"),width:100,sortable:!1,title:!1};e.push(i),i={name:"verification",index:"verification",label:$.i18n._("Window"),width:100,sortable:!1,title:!1},e.push(i),this.verification_grid&&(this.verification_grid.unload(),this.verification_grid=null,this.grid_dic.verification_grid=null),this.verification_grid=this.grid_dic.verification_grid=new TTGrid(t,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,onResizeGrid:!1},e)}buildPunchNoteGrid(){var e=this,t=[];Global.isSet(this.punch_note_grid)||$(this.el).find("#punch_note_grid").attr("id",this.ui_id+"_punch_note_grid");t.push({name:"invisible_column",index:"invisible_column",label:" ",width:1,sortable:!1,title:!1,hidden:!0});t.push({name:"note",index:"note",label:" ",width:100,sortable:!1,title:!1,cellattr:function(e,t){return'title="'+t+'"'}});var i=this.ui_id+"_punch_note_grid";this.punch_note_grid&&(this.punch_note_grid.unload(),this.punch_note_grid=null,this.grid_dic.punch_note_grid=null),this.punch_note_grid=this.grid_dic.punch_note_grid=new TTGrid(i,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,onResizeGrid:function(){e.setPunchNoteGridSize()}},t),this.setGridHeaderBar("punch_note_grid","Punch Notes"),$(this.grid_dic.punch_note_grid.grid).parents(".ui-jqgrid-view").find(".ui-jqgrid-hbox table").css("width","100%")}getAccumulatedTotalGridPayperiodHeader(){this.pay_period_header=$.i18n._("No Pay Period");var e=this.timesheet_verify_data.pay_period_id;if(e&&this.pay_period_data)for(var t in this.pay_period_data){var i=this.pay_period_data[t];if(i.id===e){var a=Global.strToDate(i.start_date).format(),s=Global.strToDate(i.end_date).format();this.pay_period_header=a+" "+$.i18n._("to")+" "+s;break}}}buildAccumulatedTotalGrid(){var e=[];if(!Global.isSet(this.accumulated_total_grid)){var t=$(this.el).find("#accumulated_total_grid");t.attr("id",this.ui_id+"_accumulated_total_grid"),t=$(this.el).find("#"+this.ui_id+"_accumulated_total_grid")}var i=100;this.wage_btn.getValue(!0)&&(i=null);var a={name:"punch_info",index:"punch_info",label:" ",width:i,sortable:!1,title:!1,formatter:this.onCellFormat};e.push(a);var s=this.start_date.format(Global.getLoginUserDateFormat()),r=this.end_date.format(Global.getLoginUserDateFormat());this.getAccumulatedTotalGridPayperiodHeader();var l=100;this.wage_btn.getValue(!0)&&(l=150);var n={name:"week",index:"week",label:s+" "+$.i18n._("to")+" "+r,width:l,sortable:!1,title:!1,formatter:this.onCellFormat},d={name:"pay_period",index:"pay_period",label:this.pay_period_header,width:l,sortable:!1,title:!1,formatter:this.onCellFormat};e.push(n),e.push(d);var o=this.ui_id+"_accumulated_total_grid";1==Global.isSet(this.accumulated_total_grid)&&(this.accumulated_total_grid.unload(),this.accumulated_total_grid=null,this.grid_dic.accumulated_total_grid=null),this.accumulated_total_grid=this.grid_dic.accumulated_total_grid=new TTGrid(o,{hoverrows:!1,multiselectPosition:"none",verticalResize:!1,onResizeGrid:!1},e),$(this.el).find(".accumulated-total-grid-title").css("display","block"),this.setAccumulatedTotalGridPayPeriodHeaders()}bindGridColumnEvents(){}bindTimeSheetGridColumnEvents(){var e=this.grid.getGridParam("colModel");if(e){var t=e.length;this.t_grid_header_array=[];for(var i=0;i<t;i++){var a=e[i],s=$($(this.el).find("#gbox_"+this.ui_id+"_grid").find("div #jqgh_"+this.ui_id+"_grid_"+a.name));this.t_grid_header_array.push(s.TGridHeader()),s.bind("click",l)}var r=this}function l(e){var t=$(this).attr("id");if("cb"!==(t=t.substring(10+r.ui_id.length+1,t.length))&&"punch_info"!==t){var i=Global.strToDate(t,r.full_format);i&&i.getYear()>0&&(r.setDatePickerValue(i.format(Global.getLoginUserDateFormat())),r.highLightSelectDay(),r.reLoadSubGridsSource(),$($(".timesheet-grid tr#1 td")[$("th.highlight-header").index()]).click())}}}checkIsSelectedAbsenceCell(e,t){for(var i=0,a=this.absence_select_cells_Array.length;i<a;i++){var s=this.absence_select_cells_Array[i];if(s.row_id==e&&s.cell_index===t)return!0}return!1}buildAbsenceGrid(){var e=this,t="absence_grid",i=$.i18n._("Absence");if(this[t])this[t].unload(),this[t]=null,this.grid_dic[t]=null;else{var a=$(this.el).find("#absence_grid");a.attr("id",this.ui_id+"_absence_grid"),a=$(this.el).find("#"+this.ui_id+"_absence_grid")}this[t]=this.grid_dic[t]=new TTGrid(this.ui_id+"_absence_grid",{sortable:!1,hoverrows:!1,ondblClickRow:function(){e.onGridDblClickRow("absence")},onRightClickRow:function(t,i,a,s){if(!e.checkIsSelectedAbsenceCell(t,a)){var r=$(s.target).closest("td,th").html();e.onCellSelect("absence_grid",t,a,r,this,s),e.onSelectRow("absence_grid",t,this),0==$(".edit-view:visible").length?e.setDefaultMenu():e.setEditMenu()}},onCellSelect:function(t,i,a,s){0==$(".edit-view:visible").length?e.setDefaultMenu():e.setEditMenu()},onResizeGrid:function(){e.absence_grid&&e.absence_grid.getGridWidth()!=$("body").width()&&e.absence_grid.setGridWidth($("body").width())},beforeSelectRow:function(t,i){i.preventDefault();var a=0;a="gridcell"==$(i.target).attr("role")?$(i.target).index():$(i.target).parents("td").index();var s=$(i.target).text();return e.onCellSelect("absence_grid",t,a,s,this,i),e.onSelectRow("absence_grid",t,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1},this.timesheet_columns,$.i18n._("Absence")),this.bindTimeSheetGridColumnEvents(),this.setGridHeaderBar(t,i),this.grid_dic[t]&&this.grid_dic[t].grid&&this.grid_dic.absence_grid.grid.setGridWidth($("body").width())}checkIsSelectedPunchCell(e,t){for(var i=0,a=this.select_cells_Array.length;i<a;i++){var s=this.select_cells_Array[i];if(s.row_id==e&&s.cell_index==t)return!0}return!1}colorTimeSheetRows(){for(var e=$(".timesheet-grid-div .timesheet-grid tr"),t=0,i=0,a=1;a<e.length-1;a++)2==t&&i<2?($(e[a]).addClass("ui-priority-secondary"),i++):2==i?(t=1,i=0):t++}buildTimeSheetGrid(){var e=this.ui_id+"_grid",t=this;if(this.timesheet_grid&&!this.first_build)$.jgrid.guid=1;else{this.timesheet_grid&&(this.timesheet_grid.unload(),this.timesheet_grid=null,$.jgrid.guid=1),$(this.el).find("#timesheet_grid").attr("id",e);var i={altRows:!1,sortable:!1,hoverrows:!1,ondblClickRow:function(e,i,a,r){t.getRowData("timesheet_grid",e).type!==s.REQUEST_ROW&&t.onGridDblClickRow()},onRightClickRow:function(e,i,a,s){if(!t.checkIsSelectedPunchCell(e,a)){var r=$(s.target).closest("td,th").html();t.onCellSelect("timesheet_grid",e,a,r,this,s),t.onSelectRow("timesheet_grid",e,this),0==$(".edit-view:visible").length?t.setDefaultMenu():t.setEditMenu()}},onCellSelect:function(e,i,a,s){0==$(".edit-view:visible").length?t.setDefaultMenu():t.setEditMenu()},onResizeGrid:function(){"manual"===t.getPunchMode()&&t.editor&&t.setManualTimeSheetGridSize(),t.setGridSize(),t.setTimeSheetGridPayPeriodHeaders(),t.setTimeSheetGridHolidayHeaders()},gridComplete:function(){t.colorTimeSheetRows()},beforeSelectRow:function(e,i){i.preventDefault();var a=0;a="gridcell"==$(i.target).attr("role")?$(i.target).index():$(i.target).parents("td").index();var s=$(i.target).text();return t.onCellSelect("timesheet_grid",e,a,s,this,i),t.onSelectRow("timesheet_grid",e,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1};this.timesheet_grid=this.grid_dic.timesheet_grid=this.grid=new TTGrid(e,i,this.timesheet_columns),this.grid_dic.timesheet_grid.grid.setGridWidth($("body").width())}this.grid_div.scroll((function(e){t.scroll_position=t.grid_div.scrollTop()}))}onGridDblClickRow(e){for(var t=this.context_menu_array.length,i=!1,a=0;a<t&&!i;a++){var s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).attr("id");switch(r){case ContextMenuIconName.edit:if(s.is(":visible")&&!s.hasClass("disable-image"))return ProgressBar.showOverlay(),void this.onEditClick()}}for(a=0;a<t&&!i;a++)switch(s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).attr("id")){case ContextMenuIconName.view:if(i=!0,s.is(":visible")&&!s.hasClass("disable-image"))return ProgressBar.showOverlay(),void this.onViewClick()}for(a=0;a<t;a++)switch(s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).attr("id")){case"addAbsenceIcon":case ContextMenuIconName.add:case ContextMenuIconName.add_punch:if("absence"==e&&"addAbsenceIcon"!=r)continue;if(s.is(":visible")&&!s.hasClass("disable-image"))return void(this.isPunchCells()&&(ProgressBar.showOverlay(),this.onAddClick()))}}isPunchCells(){var e=!1,t=this.select_cells_Array&&this.select_cells_Array.length>0&&this.select_cells_Array[0],i=t&&this.timesheet_data_source[parseInt(t.row_id)-1];return(i&&i.type===s.PUNCH_ROW||this.absence_select_cells_Array&&this.absence_select_cells_Array.length>0)&&(e=!0),e}buildAccumulatedGrid(){var e=this,t="accumulated_time_grid",i=$.i18n._("Accumulated Time");this[t]&&(this[t].unload(),this[t]=null,this.grid_dic[t]=null),this[t]=this.grid_dic[t]=new TTGrid("accumulated_time_grid",{sortable:!1,hoverrows:!1,ondblClickRow:function(){e.onAccumulatedTimeClick()},onRightClickRow:function(t,i,a,s){var r=$(s.target).closest("td,th").html();e.onCellSelect("accumulated_grid",t,a,r,this,s),e.onSelectRow("accumulated_grid",t,this)},onCellSelect:function(t,i,a,s){e.setDefaultMenu()},onResizeGrid:function(){e.grid_dic.accumulated_time_grid&&e.grid_dic.accumulated_time_grid.grid.setGridWidth($("body").width())},beforeSelectRow:function(t,i){i.preventDefault();var a=0;a="gridcell"==$(i.target).attr("role")?$(i.target).index():$(i.target).parents("td").index();var s=$(i.target).text();return e.onCellSelect("accumulated_grid",t,a,s,this,i),e.onSelectRow("accumulated_grid",t,this),!1},multiselectPosition:"none",winMultiSelect:!1,verticalResize:!1},this.timesheet_columns),this.setGridHeaderBar(t,i),this.grid_dic[t]&&this.grid_dic[t].grid&&this.grid_dic[t].grid.setGridWidth($("body").width())}buildSubGrid(e,t){var i=this,a=this.ui_id+"_"+e;Global.isSet(this[e])||$(this.el).find("#"+e).attr("id",a);this[e]&&(this[e].unload(),this[e]=null,this.grid_dic[e]=null),"premium_grid"===e?(this[e]=this.grid_dic[e]=new TTGrid(a,{hoverrows:!1,multiselectPosition:"none",winMultiSelect:!1,onSelectRow:function(e,t,a){i.onSelectRow("premium_grid",e,this)},onRightClickRow:function(e,t,a,s){var r=$(s.target).closest("td,th").html();i.onCellSelect("premium_grid",e,a,r,this,s),i.onSelectRow("premium_grid",e,this)},onCellSelect:function(e,t,a,s){i.unsetSelectedCells("timesheet_grid"),i.unsetSelectedCells("absence_grid"),i.onCellSelect("premium_grid",e,t,a,this,s),i.select_punches_array=[],i.setDefaultMenu()},ondblClickRow:function(){"premium_grid"===e&&i.onAccumulatedTimeClick()},onResizeGrid:function(){i.grid_dic[e]&&i.grid_dic[e].grid.setGridWidth($("body").width())},verticalResize:!1},this.timesheet_columns),this[e]&&this[e].grid&&this[e].grid.addClass("premium-grid")):this[e]=this.grid_dic[e]=new TTGrid(a,{hoverrows:!1,multiselectPosition:"none",winMultiSelect:!1,onCellSelect:function(t,a,s,r){i.unsetSelectedCells("timesheet_grid"),i.unsetSelectedCells("absence_grid"),i.onCellSelect(e,t,a,s,this,r),i.select_punches_array=[],i.setDefaultMenu()},onResizeGrid:function(){i.grid_dic[e]&&i.grid_dic[e].grid.setGridWidth($("body").width())},verticalResize:!1},this.timesheet_columns),this.setGridHeaderBar(e,t),this.grid_dic[e]&&this.grid_dic[e].grid&&this.grid_dic[e].grid.setGridWidth($("body").width())}setGridSExpendOrCollapseStatus(e,t){if(this.grid_dic[e]){var i=this.grid_dic[e].grid;$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]).find(".title-bar");this.setGridHeight(e),!0!==LocalCacheData.timesheet_sub_grid_expended_dic[e]&&i.setGridHeight(0),this.updateGridHeaderBar(e,t)}}setGridExpendButton(e,t){var i=this,a=$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]).find(".title-bar");if(0===a.find(".grid-expend-btn").length){var s=$("<img>");s.addClass("grid-expend-btn"),Global.isSet(LocalCacheData.timesheet_sub_grid_expended_dic[e])&&!0!==LocalCacheData.timesheet_sub_grid_expended_dic[e]?(s.attr("src",Global.getRealImagePath("images/big_expand.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!1):(s.attr("src",Global.getRealImagePath("images/big_collapse.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!0),a.append(s),this.setGridSExpendOrCollapseStatus(e,t),s.click((function(a){!0===LocalCacheData.timesheet_sub_grid_expended_dic[e]?($(this).attr("src",Global.getRealImagePath("images/big_expand.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!1,i.setGridSExpendOrCollapseStatus(e,t)):($(this).attr("src",Global.getRealImagePath("images/big_collapse.png")),LocalCacheData.timesheet_sub_grid_expended_dic[e]=!0,i.setGridSExpendOrCollapseStatus(e,t))}))}}updateGridHeaderBar(e,t){var i=t,a=$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_"+e+"]")[0]).find(".title-span");if(!0!==LocalCacheData.timesheet_sub_grid_expended_dic[e])switch(e){case"branch_grid":i=i+" ("+this.branch_cell_count+")";break;case"department_grid":i=i+" ("+this.department_cell_count+")";break;case"job_item_grid":i=i+" ("+this.task_cell_count+")";break;case"job_grid":i=i+" ("+this.job_cell_count+")";break;case"premium_grid":i=i+" ("+this.premium_cell_count+")";break;case"absence_grid":i=i+" ("+this.absence_cell_count+")";break;case"punch_note_grid":i=i+" ("+this.punch_note_account+")"}a.text(i)}setGridHeaderBar(e,t){var i=$(this.grid_dic[e].grid).parents(".ui-jqgrid-view").find(".ui-jqgrid-hbox table");i.css("width","100vw");t=$.i18n._(t);i.find("tr:first").hide();var a=$("<div class='title-bar'><span class='title-span'>"+t+"</span></div>");i.append(a)}buildManualTimeSheetsColumns(){this.day_dic={};for(var e=0;e<7;e++){var t=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+e)),i=t.format(this.day_format),a=t.format(this.date_format);this.day_dic["day_"+e]={value:i+"<br>"+a,field:t.format()}}}getManualTimeSheetData(e){var t=this,i=this.getSelectEmployee();if(i){var a={};a.filter_data={user_id:i,object_type_id:10,start_date:this.start_date.format(),end_date:this.end_date.format()},a.filter_columns={"id":!0,"date_stamp":!0,"total_time":!0,"object_type":!0,"name":!0,"branch_id":!0,"department_id":!0,"branch":!0,"department":!0,"job":!0,"job_item":!0,"job_id":!0,"job_item_id":!0,"note":!0,"override":!0},this.api_user_date_total.getUserDateTotal(a,!0,{onResult:function(i){t.manual_timesheet_data=i.getResult(),e()}})}}buildManualTimeSheetData(){this.time_sheet_data_overrode_true_map={},this.time_sheet_data_overrode_false_map={};var e,t,i;function a(e,t){!e&&(e=[]);for(var i=0,a=e.length;i<a;i++){var s=e[i],r=s.branch_id+"-"+s.department_id+"-"+s.job_id+"-"+s.job_item_id;if(t[r])if(t[r][s.date_stamp])for(var l=1;;){if(!t[r+"-"+l]){t[r+"-"+l]={},t[r+"-"+l].branch_id=s.branch_id,t[r+"-"+l].department_id=s.department_id,t[r+"-"+l].job_id=s.job_id,t[r+"-"+l].job_item_id=s.job_item_id,t[r+"-"+l].branch=s.branch,t[r+"-"+l].department=s.department,t[r+"-"+l].job=s.job,t[r+"-"+l].job_item=s.job_item,t[r+"-"+l].override=s.override,t[r+"-"+l][s.date_stamp]=s;break}if(!t[r+"-"+l][s.date_stamp]){t[r+"-"+l][s.date_stamp]=s;break}l+=1}else t[r][s.date_stamp]=s;else t[r]={},t[r].branch_id=s.branch_id,t[r].department_id=s.department_id,t[r].job_id=s.job_id,t[r].job_item_id=s.job_item_id,t[r].branch=s.branch,t[r].department=s.department,t[r].job=s.job,t[r].job_item=s.job_item,t[r].override=s.override,t[r][s.date_stamp]=s}}this.manual_timesheet_data.sort(Global.m_sort_by(["branch_id","department_id","job_id","job_item_id"])),t=(e=_.groupBy(this.manual_timesheet_data,"override"))[!0],i=e[!1],a(t,this.time_sheet_data_overrode_true_map),a(i,this.time_sheet_data_overrode_false_map)}initInsideEditorData(e){var t=this;for(var i in this.day_dic)this.$("#"+i+"_date").html(this.day_dic[i].value),this.$("#"+i+"_date").addClass("manual_grid_day_"+Global.strToDate(this.day_dic[i].field).format(this.full_format)),this.$("#"+i+"_date").attr("current_date","manual_grid_day_"+Global.strToDate(this.day_dic[i].field).format(this.full_format)),this.$("#"+i+"_date").unbind("click").bind("click",(function(e){var i=e.currentTarget,a=$(i).attr("current_date");a=a.substring(16,a.length);var s=Global.strToDate(a,t.full_format);s&&s.getYear()>0&&(t.setDatePickerValue(s.format(Global.getLoginUserDateFormat())),t.highLightSelectDay(),t.reLoadSubGridsSource())})),this.$(".is-saving-manual-grid").removeClass("is-saving-manual-grid");function a(){if(t.is_saving_manual_grid=!1,t.setDefaultMenu(),e){if(t.manual_timesheet_data.length>0)for(var i in t.buildManualTimeSheetData(),t.time_sheet_data_overrode_true_map){var a=t.time_sheet_data_overrode_true_map[i];for(var s in a){var r=a[s];if(_.isObject(r)){var l=t.generateManualTimeSheetRecordKey(r),n=r.id+"-"+l;t.manual_grid_records_map[n]?t.manual_grid_records_map[n][r.date_stamp].setValue(r.total_time):t.manual_grid_records_map[l]&&(t.manual_grid_records_map[l].current_edit_item[r.date_stamp]=r,t.manual_grid_records_map[l][r.date_stamp].setValue(r.total_time))}}}}else t.editor.removeAllRows(),t.manual_timesheet_data.length>0?(t.buildManualTimeSheetData(),_.map(t.time_sheet_data_overrode_false_map,(function(e){t.editor.addRow(e)})),_.map(t.time_sheet_data_overrode_true_map,(function(e){t.editor.addRow(e)})),_.isEmpty(t.time_sheet_data_overrode_true_map)&&t.editor.addRow()):t.editor.addRow();if(t.save_manual_grid_after_save)return t.autoSaveManualPunch(),void(t.save_manual_grid_after_save=!1)}this.is_auto_switch?(this.is_auto_switch=!1,a()):this.getManualTimeSheetData((function(){a()}))}insideEditorAddRow(e,t){var i,a=this;if(Global.getProductEdition()>=20)var s=TTAPI.APIJobItem,r=TTAPI.APIJob;if(!e&&(e={},t>=0)){var l=this.rows_widgets_array[t-3];this.parent_controller.show_branch_ui&&(l.branch_id?e.branch_id=l.branch_id.getValue():l.current_edit_item&&l.current_edit_item.branch_id?e.branch_id=l.current_edit_item.branch_id:e.branch_id=!1),this.parent_controller.show_department_ui&&(l.department_id?e.department_id=l.department_id.getValue():l.current_edit_item&&l.current_edit_item.department_id?e.department_id=l.current_edit_item.department_id:e.department_id=!1),this.parent_controller.show_job_ui&&Global.getProductEdition()>=20&&(l.job_id?e.job_id=l.job_id.getValue():l.current_edit_item&&l.current_edit_item.job_id?e.job_id=l.current_edit_item.job_id:e.job_id=!1),this.parent_controller.show_job_item_ui&&Global.getProductEdition()>=20&&(l.job_item_id?e.job_item_id=l.job_item_id.getValue():l.current_edit_item&&l.current_edit_item.job_item_id?e.job_item_id=l.current_edit_item.job_item_id:e.job_item_id=!1)}var n,d=this.getRowRender(),o=this.getRender(),_={};if(this.parent_controller.show_branch_ui?e.hasOwnProperty("override")&&!e.override?((n=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"branch"}),n.setValue(e.branch),d.children().eq(2).append(n)):((n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,width:90,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id",is_static_width:!0}),_[n.getField()]=n,n.setValue(e.hasOwnProperty("branch_id")?e.branch_id:this.parent_controller.getSelectEmployee(!0).default_branch_id),d.children().eq(2).append(n)):d.children().eq(2).hide(),this.parent_controller.show_department_ui?e.hasOwnProperty("override")&&!e.override?((n=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"department"}),n.setValue(e.department),d.children().eq(3).append(n)):((n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,width:90,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id",is_static_width:!0}),_[n.getField()]=n,n.setValue(e.hasOwnProperty("department_id")?e.department_id:this.parent_controller.getSelectEmployee(!0).default_department_id),d.children().eq(3).append(n)):d.children().eq(3).hide(),this.parent_controller.show_job_ui&&Global.getProductEdition()>=20)if(e.hasOwnProperty("override")&&!e.override)(n=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"job"}),n.setValue(e.job),d.children().eq(4).append(n);else{var c=Global.loadWidgetByName(FormItemType.AWESOME_BOX);c.AComboBox({api_class:TTAPI.APIJob,width:90,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,field:"job_id",is_static_width:!0,setRealValueCallBack:function(e){e&&h.setValue(e.manual_id)}}),_[c.getField()]=c,(i={}).filter_data={status_id:10,user_id:this.parent_controller.getSelectEmployee()},c.setDefaultArgs(i);var u=e.hasOwnProperty("job_id")?e.job_id:this.parent_controller.getSelectEmployee(!0).default_job_id;c.setValue(u);var h=Global.loadWidgetByName(FormItemType.TEXT_INPUT);h.TTextInput({field:"job_quick_search",disable_keyup_event:!0,width:30}),h.css("display","inline-block"),c.css("display","inline-block"),d.children().eq(4).append(h),d.children().eq(4).append(c),h.unbind("formItemChange").bind("formItemChange",(function(e,t){T(t.getField(),t.getValue())}))}else d.children().eq(4).hide();if(this.parent_controller.show_job_item_ui&&Global.getProductEdition()>=20)if(e.hasOwnProperty("override")&&!e.override)(n=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"job_item"}),n.setValue(e.job_item),d.children().eq(5).append(n);else{(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,width:90,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,field:"job_item_id",is_static_width:!0,setRealValueCallBack:function(e){e&&m.setValue(e.manual_id)}}),(i={}).filter_data={status_id:10,job_id:u},n.setDefaultArgs(i),n.setValue(e.hasOwnProperty("job_item_id")?e.job_item_id:this.parent_controller.getSelectEmployee(!0).default_job_item_id);var m=Global.loadWidgetByName(FormItemType.TEXT_INPUT);m.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0,width:30}),_[n.getField()]=n,m.css("display","inline-block"),n.css("display","inline-block"),d.children().eq(5).append(m),d.children().eq(5).append(n),m.unbind("formItemChange").bind("formItemChange",(function(e,t){T(t.getField(),t.getValue())}))}else d.children().eq(5).hide();(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_0.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(6).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_1.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(7).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_2.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(8).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_3.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(9).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_4.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(10).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_5.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(11).append(n),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:this.parent_controller.day_dic.day_6.field,width:55,mode:"time_unit",display_na:!1,need_parser_sec:!0,do_validate:!1}),n.setValue(e[n.getField()]?e[n.getField()].total_time:0),_[n.getField()]=n,d.children().eq(12).append(n),e.hasOwnProperty("override")&&!e.override&&d.children().eq(1).children().hide();var p=!1,g=!1,b=!1;for(var v in _){var f=_[v],y=0;for(var w in this.parent_controller.full_timesheet_data.pay_period_data)10!=this.parent_controller.full_timesheet_data.pay_period_data[w].status_id&&30!=this.parent_controller.full_timesheet_data.pay_period_data[w].status_id&&y++;if(y>0&&y==Object.keys(this.parent_controller.full_timesheet_data.pay_period_data).length&&0!=this.parent_controller.full_timesheet_data.punch_data.length&&(p=!0,g=!0,0==Object.keys(e).length))return;if(this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[f.getField()]]){var C=parseInt(this.parent_controller.full_timesheet_data.pay_period_data[this.parent_controller.full_timesheet_data.timesheet_dates.pay_period_date_map[f.getField()]].status_id);10!=C&&30!=C&&(f.setEnabled&&f.setEnabled(!1),"branch_id"!=f.getField()&&"department_id"!=f.getField()&&"job_id"!=f.getField()&&"job_item_id"!=f.getField()&&void 0!==e[f.getField()]&&(b=!0,g=!0))}e.hasOwnProperty("override")&&!e.override&&(f.setEnabled&&f.setEnabled(!1),f.getValue()>0&&f.hasClass("t-text-input")>=0&&f.css("color","red")),f.unbind("formItemChange").bind("formItemChange",(function(e,t){t.is_changed=!0,"job_id"===t.getField()?(_.is_changed=!0,h.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:""),I(t.getValue(!0))):"job_item_id"===t.getField()?(_.is_changed=!0,m.setValue(t.getValue(!0)&&t.getValue(!0).manual_id?t.getValue(!0).manual_id:"")):"branch_id"!==t.getField()&&"department_id"!==t.getField()||(_.is_changed=!0),a.parent_controller.autoSaveManualPunch()}))}if(b)for(var v in _){"branch_id"!=(f=_[v]).getField()&&"department_id"!=f.getField()&&"job_id"!=f.getField()&&"job_item_id"!=f.getField()||("job_id"!=f.getField()&&"job_item_id"!=f.getField()||f.parents("td").find('input[type="text"]').hide(),f.setEnabled&&f.setEnabled(!1))}function T(e,t){var i={};"job_quick_search"===e?(i.filter_data={manual_id:t,user_id:a.parent_controller.getSelectEmployee(),status_id:"10"},r.getJob(i,{onResult:function(e){var t=e.getResult();_.is_changed=!0,a.parent_controller.autoSaveManualPunch(),t.length>0?(_.job_id.setValue(t[0].id),I(t[0])):(_.job_id.setValue(""),I(!1))}})):"job_item_quick_search"===e&&(i.filter_data={manual_id:t,job_id:_.job_id.getValue(),status_id:"10"},s.getJobItem(i,{onResult:function(e){var t=e.getResult();_.is_changed=!0,a.parent_controller.autoSaveManualPunch(),t.length>0?_.job_item_id.setValue(t[0].id):_.job_item_id.setValue("")}}))}function I(e){var t=_.job_item_id;if(t){var i=t.getValue();t.setSourceData(null);var a={};if(a.filter_data={status_id:10,job_id:_.job_id.getValue()},t.setDefaultArgs(a),i){var r=Global.clone(a);r.filter_data.id=i,r.filter_columns=t.getColumnFilter(),s.getJobItem(r,{onResult:function(e){e.getResult().length>0?t.setValue(i):l()}})}else l()}function l(){_.job_id.getValue()?(t.setValue(e.default_item_id),!1!==e.default_item_id&&0!==e.default_item_id||m.setValue("")):(t.setValue(""),m.setValue(""))}}1==p&&d.find(".plus-icon").hide(),1==g&&d.find(".minus-icon").hide(),void 0!==t?(d.insertAfter($(o).find("tr").eq(t)),this.rows_widgets_array.splice(t,0,_)):($(o).append(d),this.rows_widgets_array.push(_)),_.current_edit_item=e,this.addIconsEvent(d)}autoSaveManualPunch(){var e=this;this.is_saving_manual_grid?this.save_manual_grid_after_save=!0:(this.wait_auto_save&&clearTimeout(this.wait_auto_save),this.wait_auto_save=setTimeout((function(){"manual"===e.getPunchMode()&&(ProgressBar.showOverlay(),e.onSaveClick())}),2e3))}insideEditorGetValue(e){for(var t=this.rows_widgets_array.length,i=[],a=0;a<t;a++){for(var s=this.rows_widgets_array[a],r=0;r<7;r++){var l=new Date(new Date(this.parent_controller.start_date.getTime()).setDate(this.parent_controller.start_date.getDate()+r)).format(),n={};s[l]&&(n.total_time=s[l].getValue(),(s[l].is_changed||s.is_changed&&s.current_edit_item[l])&&(s.branch_id&&(n.branch_id=s.branch_id.getValue()),s.department_id&&(n.department_id=s.department_id.getValue()),s.job_id&&(n.job_id=s.job_id.getValue()),s.job_item_id&&(n.job_item_id=s.job_item_id.getValue()),n.date_stamp=l,n.user_id=this.parent_controller.getSelectEmployee(),n.object_type_id=10,n.override=!0,n.row=s,s.current_edit_item[l]&&(n.id=s.current_edit_item[l].id),i.push(n),e&&(s[l].is_changed=!1,s[l].addClass("is-saving-manual-grid"))))}e&&(s.is_changed=!1)}return i}insideEditorRemoveRow(e){for(var t=this,i=e[0].rowIndex-3,a=this.rows_widgets_array[i],s=!1,r=0;r<7;r++){var l=new Date(new Date(this.parent_controller.start_date.getTime()).setDate(this.parent_controller.start_date.getDate()+r)).format();if(a[l].getValue()>0||a.current_edit_item[l]){s=!0,TAlertManager.showConfirmAlert($.i18n._("You are about to delete the entire week worth of time for this row. Are you sure you wish to continue?"),"",n);break}}function n(s){if(s){for(var r=[],l=0;l<7;l++){var n=new Date(new Date(t.parent_controller.start_date.getTime()).setDate(t.parent_controller.start_date.getDate()+l)).format();a.current_edit_item[n]&&r.push(a.current_edit_item[n].id)}r.length>0&&(ProgressBar.noProgressForNextCall(),ProgressBar.showNanobar(),t.is_saving_manual_grid=!0,t.parent_controller.setDefaultMenu(),t.api.deleteUserDateTotal(r,{onResult:function(){t.parent_controller.reLoadSubGridsSource(!0),ProgressBar.removeNanobar(),t.parent_controller.setDefaultMenu()}})),e.remove(),t.rows_widgets_array.splice(i,1),0===t.rows_widgets_array.length&&t.addRow()}}!s&&n(!0)}buildManualTimeSheetGrid(){var e={branch:$.i18n._("Branch"),department:$.i18n._("Department"),job:$.i18n._("Job"),task:$.i18n._("Task")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({title:"",addRow:this.insideEditorAddRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,removeRow:this.insideEditorRemoveRow,parent_controller:this,render:"views/attendance/timesheet/ManualTimeSheetInsideEditorRender.html",render_args:e,api:this.api_user_date_total,row_render:"views/attendance/timesheet/ManualTimeSheetInsideEditorRow.html"}),this.$(".manual-timesheet-inside-editor-div").append(this.editor)}buildCalendars(){var e=this;function t(){if(e.pay_period_data=e.full_timesheet_data.pay_period_data,e.pay_period_map=e.full_timesheet_data.timesheet_dates.pay_period_date_map,e.timesheet_verify_data=e.full_timesheet_data.timesheet_verify_data,e.grid_div=$(e.el).find(".timesheet-grid-div"),e.buildTimeSheetsColumns(),e.buildTimeSheetGrid(),"manual"===e.getPunchMode()?(e.$(".timesheet-punch-grid-wrapper").hide(),e.$(".manual-timesheet-inside-editor-div").show(),e.editor?(e.buildManualTimeSheetsColumns(),e.initInsideEditorData()):(e.buildManualTimeSheetsColumns(),e.buildManualTimeSheetGrid(),e.initInsideEditorData()),(!e.show_job_ui||Global.getProductEdition()<20)&&e.$(".job-header").hide(),(!e.show_job_item_ui||Global.getProductEdition()<20)&&e.$(".job-item-header").hide(),e.show_branch_ui||e.$(".branch-header").hide(),e.show_department_ui||e.$(".department-header").hide()):(e.$(".timesheet-punch-grid-wrapper").show(),e.$(".manual-timesheet-inside-editor-div").hide()),e.buildAccumulatedGrid(),e.buildSubGrid("branch_grid","Branch"),e.buildSubGrid("department_grid","Department"),e.buildSubGrid("job_grid","Job"),e.buildSubGrid("job_item_grid","Task"),e.buildSubGrid("premium_grid","Premium"),e.buildAbsenceGrid(),e.showGridBorders(),e.buildAccumulatedTotalGrid(),e.buildPunchNoteGrid(),e.buildVerificationGrid(),e.buildTimeSheetSource(),e.buildTimeSheetRequests(),e.buildSubGridsSource(),e.buildTimeSheetExceptions(),e.buildAbsenceSource(),e.buildPunchNoteGridSource(),e.buildVerificationGridSource(),e.setGridExpendButton("accumulated_time_grid",$.i18n._("Accumulated Time")),e.setGridExpendButton("branch_grid",$.i18n._("Branch")),e.setGridExpendButton("department_grid",$.i18n._("Department")),e.setGridExpendButton("job_grid",$.i18n._("Job")),e.setGridExpendButton("job_item_grid",$.i18n._("Task")),e.setGridExpendButton("premium_grid",$.i18n._("Premium")),e.setGridExpendButton("absence_grid",$.i18n._("Absence")),e.setGridExpendButton("punch_note_grid",$.i18n._("Punch Notes")),"punch"===e.getPunchMode()&&e.grid.setData(e.timesheet_data_source,!0),"function"==typeof e.accumulated_time_grid.setData&&e.accumulated_time_grid.setData(e.accumulated_time_source,!1),"function"==typeof e.branch_grid.setData&&e.branch_grid.setData(e.branch_source,!1),"function"==typeof e.department_grid.setData&&e.department_grid.setData(e.department_source,!1),"function"==typeof e.job_grid.setData&&e.job_grid.setData(e.job_source,!1),"function"==typeof e.job_item_grid.setData&&e.job_item_grid.setData(e.job_item_source,!1),"function"==typeof e.premium_grid.setData&&e.premium_grid.setData(e.premium_source,!1),e.absence_grid&&e.absence_grid.setData(e.absence_source,!1),0===e.accumulated_total_grid_source.length&&e.accumulated_total_grid_source.push(),e.accumulated_total_grid.setData(e.accumulated_total_grid_source,!1),e.punch_note_grid.setData(e.punch_note_grid_source,!1),e.verification_grid.setData(e.verification_grid_source,!1),e.setGridSize(),e.setTimeSheetGridPayPeriodHeaders(),e.setTimeSheetGridHolidayHeaders(),e.highLightSelectDay(),e.autoOpenEditViewIfNecessary(),e.setScrollPosition(),e.initRightClickMenu(),e.initRightClickMenu(RightClickMenuType.ABSENCE_GRID),e.showWarningMessageIfAny(),e.setPunchModeClass(),"punch"!=e.getPunchMode())for(var t=e.getManualPayPeriodDefaultTrColspan(),i=1;i<t;i++)$(".sub-grid td:nth-child("+i+")").css("border-right","none")}this.is_auto_switch?this.getManualTimeSheetData((function(){if(e.manual_timesheet_data.length>0){e.buildManualTimeSheetData();var i=_.isEmpty(e.time_sheet_data_overrode_true_map),a=_.isEmpty(e.time_sheet_data_overrode_false_map);i&&!a?(e.toggle_button.setValue("punch"),e.is_auto_switch=!1):!i&&a&&e.toggle_button.setValue("manual"),e.reSetURL(),t()}else"punch"===e.getPunchMode()&&(e.is_auto_switch=!1),t()})):t()}searchDone(){$(".button-rotate").removeClass("button-rotate"),TTPromise.resolve("init","init"),TTPromise.wait()}showWarningMessageIfAny(){var e,t=this,i=$(this.el).find(".timesheet-warning-title-bar");i.length>0&&i.remove()&&(i=$(this.el).find(".timesheet-warning-title-bar")),e="punch"===this.getPunchMode()?$(this.el).find("#gbox_"+this.ui_id+"_grid"):$(this.el).find(".manual-timesheet-inside-editor-div");var a=this.getSelectEmployee(!0),s=function(e){if(t.start_date)for(var i=e.hire_date,a=e.termination_date,s=0;s<7;s++){var r=new Date(new Date(t.start_date.getTime()).setDate(t.start_date.getDate()+s)),l=r.format();if(r&&(r.getTime()<(new Date).getTime()&&!t.getPayPeriod(l)&&(!i||r.getTime()>=Global.strToDate(i).getTime())&&(!a||r.getTime()<=Global.strToDate(a).getTime())))return!1}return!0}(a);Global.isObject(a)&&Object.keys(a).length>1&&(a.hasOwnProperty("pay_period_schedule_id")&&""==a.pay_period_schedule_id||a.hasOwnProperty("policy_group_id")&&""==a.policy_group_id||0==s)?((i=$("<div class='timesheet-warning-title-bar'><span class='p-message'></span><span class='g-message'></span><span class='pp-message'></span></div>")).insertBefore(e),a.hasOwnProperty("pay_period_schedule_id")&&""==a.pay_period_schedule_id?i.children().eq(0).html($.i18n._("WARNING: Employee is not assigned to a pay period schedule.")):i.children().eq(0).html(""),a.hasOwnProperty("policy_group_id")&&""==a.policy_group_id?i.children().eq(1).html($.i18n._("WARNING: Employee is not assigned to a policy group.")):i.children().eq(1).html(""),0==s?i.children().eq(2).html($.i18n._("WARNING: Employee has day(s) not assigned to a pay period. Please perform a pay period import to correct.")):i.children().eq(2).html("")):i.length>0&&i.remove()}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"edit":LocalCacheData.edit_id_for_next_open_view&&(this.onEditClick(LocalCacheData.edit_id_for_next_open_view,LocalCacheData.getAllURLArgs().t),LocalCacheData.edit_id_for_next_open_view=null);break;case"view":LocalCacheData.edit_id_for_next_open_view&&(this.onViewClick(LocalCacheData.edit_id_for_next_open_view,LocalCacheData.getAllURLArgs().t),LocalCacheData.edit_id_for_next_open_view=null);break;case"new":this.edit_view||("absence"===LocalCacheData.getAllURLArgs().t?this.absence_model=!0:this.absence_model=!1,this.onAddClick())}this.autoOpenEditOnlyViewIfNecessary()}getWeekDayIndexFromADate(e){for(var t=this.timesheet_columns.length,i=1;i<t;i++){var a=this.timesheet_columns[i];if(e===Global.strToDate(a.index,this.full_format).format())return i}return 7}setAccumulatedTotalGridPayPeriodHeaders(){var e=$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_accumulated_total_grid]")[0]),t=$('<tr class="group-column-tr"  role="rowheader"  ></tr>'),i=$('<th class="group-column-th" ><span class="group-column-label"></span></th>'),a=i.clone(),s=i.clone(),r=i.clone();s.children(0).text($.i18n._("Week")),r.children(0).text($.i18n._("Pay Period")),t.append(a),t.append(s),t.append(r);for(var l=e.children(0).find("th"),n=1;n<l.length;n++){var d=$(l[n]).width();t.width(d)}e.find(".rowheader").remove(),e.find("thead").prepend(t)}setTimeSheetGridHolidayHeaders(){var e={};if(this.full_timesheet_data&&this.full_timesheet_data.holiday_data)for(var t=0;t<this.full_timesheet_data.holiday_data.length;t++){var i=this.full_timesheet_data.holiday_data[t],a=Global.strToDate(i.date_stamp).format(this.full_format),s=$("<div></div>");(s="manual"===this.getPunchMode()?$(".manual_grid_day_"+a):$('div[id="jqgh_'+this.ui_id+"_grid_"+a+'"]'))&&-1==s.text().indexOf(i.name)&&!e[i.name]&&(s.html(s.html()+"<br>"+i.name),e[i.name]=!0)}}getManualPayPeriodDefaultTrColspan(){var e=2;return this.show_branch_ui&&e++,this.show_department_ui&&e++,this.show_job_ui&&e++,this.show_job_item_ui&&e++,e}setTimeSheetGridPayPeriodHeaders(){var e,t,i=this;"punch"===this.getPunchMode()?(e=$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")[0]),t=$('<tr class="size-tr" role="row" style="height: 0;" ></tr>')):((e=this.$(".grid-inside-editor-render")).find(".group-column-tr").remove(),t=$(this.$(".grid-inside-editor-render").find("tr")[0])),e.find(".group-column-tr").remove();var a,s=$('<tr class="group-column-tr pay_period_header_row"></tr>'),r=$('<th class="group-column-th"><span class="group-column-label"></span></th>'),l=e.find(".ui-jqgrid-labels");if("punch"===this.getPunchMode()&&(!function(){for(var e=l.children().length,i=0;i<e;i++){var a=$('<td class=""  role="gridcell"></td>'),s=l.children().eq(i);a.height(0),a.css("width",s.css("width")),t.append(a)}}(),t.insertBefore(e.find("thead .ui-jqgrid-labels"))),0===Object.keys(this.pay_period_data).length)return a=r.clone(),s.append(a),"manual"===this.getPunchMode()&&a.attr("colspan",this.getManualPayPeriodDefaultTrColspan()),b(7),void s.insertAfter(t);for(var n,d,o=0,_=[],c=0;c<this.column_maps.length;c++){var u=this.column_maps[c],h=this.pay_period_map[u];h||(h=-1),_.push({date:u,time_stamp:Global.strToDate(u).getTime(),id:h})}a=r.clone(),s.append(a),"manual"===this.getPunchMode()&&a.attr("colspan",this.getManualPayPeriodDefaultTrColspan());for(var m=0;m<_.length;m++)n?n!==_[m].id?(d?p():b(o),n=_[m].id,d=g(_[m].id),o=1):o+=1:(n=_[m].id,d=g(_[m].id),o+=1),m===_.length-1&&o>0&&(d?p():b(o));function p(){var e=Global.strToDate(d.start_date).format(),t=Global.strToDate(d.end_date).format(),i=o,a=r.clone();a.children(0).text(e+" "+$.i18n._("to")+" "+t),a.attr("colspan",i),12==d.status_id||20==d.status_id?a.css("background","#EC0000"):30==d.status_id&&a.css("background","#EED614"),s.append(a)}function g(e){for(var t in i.pay_period_data){var a=i.pay_period_data[t];if(a.id===e)return a}}function b(e){var t=r.clone();t.addClass("no_pay_period_header"),t.children(0).text($.i18n._("No Pay Period")),t.attr("colspan",e),s.append(t)}$(".pay_period_header_row").remove(),s.insertAfter(t)}setPayPeriodHeaderSize(){var e=$($(this.el).find("table[aria-labelledby=gbox_"+this.ui_id+"_grid]")),t=e.find(".size-tr");if(0!==t.length)for(var i=e.find(".jqgfirstrow"),a=i.children().length,s=0;s<a;s++){var r=i.children().eq(s);t.children().eq(s).css("width",r.css("width"))}}highLightSelectDay(e){this.highlight_header&&this.highlight_header.removeClass("highlight-header");var t=Global.strToDate(this.start_date_picker.getValue());!t&&(t=new Date),"punch"===this.getPunchMode()?(t=t.format(this.full_format),this.highlight_header=$("#"+this.ui_id+"_grid_"+t)):(t=t.format(this.full_format),this.highlight_header=$(".manual_grid_day_"+t)),this.highlight_header.addClass("highlight-header"),0!=$(".timesheet-grid tr td.ui-state-highlight").length||e||($($(".timesheet-grid tr#1 td")[this.highlight_header.index()]).addClass("ui-state-highlight"),$($(".timesheet-grid tr#1 td")[this.highlight_header.index()]).click())}setGridHeight(e){var t=this.grid_dic[e];if(!t.grid)return!1;t=t.grid;var i=0;switch(e){case"timesheet_grid":i=this.timesheet_data_source.length;break;case"accumulated_time_grid":i=this.accumulated_time_source.length;break;case"branch_grid":i=this.branch_source.length;break;case"department_grid":i=this.department_source.length;break;case"job_grid":i=this.job_source.length;break;case"job_item_grid":i=this.job_item_source.length;break;case"premium_grid":i=this.premium_source.length;break;case"absence_grid":i=this.absence_source.length;break;case"accumulated_total_grid":i=this.accumulated_total_grid_source.length,this.wage_btn.getValue(!0)?t.setGridWidth(600):t.setGridWidth(500);break;case"punch_note_grid":i=this.punch_note_grid_source.length,this.setPunchNoteGridSize(t);break;case"verification_grid":i=this.verification_grid_source.length,t.setGridWidth(400)}!0===LocalCacheData.timesheet_sub_grid_expended_dic[e]||"timesheet_grid"===e||"accumulated_total_grid"===e||"punch_note_grid"===e||"verification_grid"===e?t.setGridHeight(22*i):t.setGridHeight(0),t.parent().parent().css("overflow","hidden"),0===i&&"accumulated_time_grid"!==e&&"verification_grid"!==e?t.parent().parent().parent().parent().hide():t.parent().parent().parent().parent().show()}setGridSize(){var e=this.grid;if(!e.grid)return!1;if((e=e.grid)&&$(e).is(":visible")||this.editor&&this.editor.is(":visible")){for(var t in this.grid_dic)if("punch_note_grid"!=t){if(!this.grid_dic[t].grid)continue;this.grid_dic[t].grid.setGridWidth($("body").width()),this.setGridHeight(t)}this.setGridHeight("punch_note_grid"),this.search_panel.is(":visible")?this.grid_div.height($(this.el).height()-this.search_panel.height()-72):this.grid_div.height($(this.el).height()-72),this.setPayPeriodHeaderSize(),"manual"===this.getPunchMode()&&this.setManualTimeSheetGridSize()}}setPunchNoteGridSize(e){if(!e){if(!this.punch_note_grid||!this.punch_note_grid.grid)return!1;e=this.punch_note_grid.grid}var t=e.width(),i=this.accumulated_total_grid&&this.accumulated_total_grid.grid?this.accumulated_total_grid.getWidth():0,a=this.verification_grid&&this.verification_grid.grid?this.verification_grid.getWidth():0;t=0!==this.verification_grid_source.length?Math.floor(Global.bodyWidth()-(i+a+25)):Math.floor(Global.bodyWidth()-(25+i)),(t=Math.abs(t))!=e.width()&&(e.setGridWidth(t),$("td.notes_grid_td_container").css("width","100%"))}setManualTimeSheetGridSize(){for(var e=$(this.accumulated_time_grid.grid.find("tr:first-child")[0]),t=$(this.editor.find("table").find("tr:first-child")[0]),i=0,a=0,s=t.children().length;a<s;a++){var r=$(t.children()[a]);r.is(":visible")&&($(r).css("width",$(e.children()[i]).css("width")),i++)}this.editor.width(this.accumulated_time_grid.getGridWidth())}onCellFormat(e,t,i){var a,r,l,n,d,o,_,c,u,h,m=t.colModel,p=(t.rowid,$("<div class='punch-content-div'></div>")),g=LocalCacheData.getCurrentCurrencySymbol();if(e=Global.decodeCellValue(e),0===t.pos)return i.type===s.TOTAL_ROW?(a=$("<span class='total' style='font-size: 11px'></span>"),Global.isSet(e)?a.text(e):a.text(""),a.get(0).outerHTML):i.type===s.REGULAR_ROW?(a=$("<span class='top-line-span' style='font-size: 11px'></span>"),Global.isSet(e)?a.text(e):a.text(""),a.get(0).outerHTML):e;if(i.type===s.PUNCH_ROW){if(n=i[m.name+"_data"],o=i[m.name+"_related_data"],l=$("<span class='punch-time'></span>"),d=$("<span class='punch-break'></span>"),n){_=n.exception,20==n.type_id?d.text("L"):30==n.type_id&&d.text("B"),n.note&&(e="*"+e);var b="";n.latitude&&0!=n.latitude&&n.longitude&&0!=n.longitude&&(b="G"),n.has_image&&(b+="F"),b&&(e=e+" "+b),n.tainted&&l.css("color","#ff0000"),p.append(d)}else o&&(_=o.exception);if(Global.isSet(e)?l.text(e):l.text(""),p.prepend(l),_){c=_.length,"";for(var v=0;v<c;v++)u=_[v],(r=$("<span class='punch-exceptions'></span>")).css("color",u.exception_color),r.text(u.exception_policy_type_id),r.attr("title",u.exception_policy_type_id+": "+u.exception_policy_type),p.prepend(r)}else(r=$("<span class='punch-exceptions'></span>")).text(" "),p.prepend(r)}else if(i.type===s.EXCEPTION_ROW){if(_=i[m.name+"_exceptions"],Global.isSet(_)){c=_.length,"";for(v=0;v<c;v++)u=_[v],(r=$("<span class='punch-exceptions-center'></span>")).css("color",u.exception_color),r.text(u.exception_policy_type_id),r.attr("title",u.exception_policy_type_id+": "+u.exception_policy_type),p.append(r)}}else if(i.type===s.REQUEST_ROW)l=$("<span class='request'></span>"),Global.isSet(e)?(l.text(e),l.attr("title",function(e){var t;Global.isArray(e)?t=i(e):Global.isObject(e)&&e.status&&(t=e.status);function i(e){for(var t=e.length,i=0,a=0,s=0,r="",l=0;l<t;l++){var n=e[l];50==n.status_id?i+=1:55==n.status_id?a+=1:30==n.status_id&&(s+=1)}return i>0&&(r+=" "+$.i18n._("Authorized")+": "+i),s>0&&(r+=" "+$.i18n._("Pending")+": "+s),a>0&&(r+=" "+$.i18n._("Declined")+": "+a),r}return t}(i[m.name+"_request"]))):l.text(""),p.prepend(l);else if(i.type===s.TOTAL_ROW)h=i[m.name+"_data"],l=$("<span class='total'></span>"),Global.isSet(e)?(h&&(h.hasOwnProperty("note")&&h.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&h.hasOwnProperty("total_time_amount")&&h.total_time_amount&&h.hasOwnProperty("hourly_rate")&&h.hourly_rate&&(l=$("<div class='total--bold time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+g+Global.MoneyRound(h.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+g+Global.MoneyRound(h.total_time_amount)+"</span>"),"punch"===time_sheet_view_controller.getPunchMode()?h.hasOwnProperty("override")&&!0===h.override&&l.addClass("absence-override"):h.override||"worked_time"!==i.key||l.addClass("absence-override")),l.html(e)):l.text(""),p.prepend(l);else if(i.type===s.REGULAR_ROW)p.addClass("top-line"),h=i[m.name+"_data"],l=$("<span></span>"),Global.isSet(e)?(h&&(h.hasOwnProperty("note")&&h.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&h.hasOwnProperty("total_time_amount")&&h.total_time_amount&&h.hasOwnProperty("hourly_rate")&&h.hourly_rate&&(l=$("<div class='time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+g+Global.MoneyRound(h.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+g+Global.MoneyRound(h.total_time_amount)+"</span>"),h.hasOwnProperty("override")&&!0===h.override&&l.addClass("absence-override")),l.html(e)):l.text(""),p.prepend(l);else if(i.type===s.ABSENCE_ROW){var f=i[m.name+"_data"];l=$("<span></span>"),Global.isSet(e)?(f&&(!0===f.override&&l.addClass("absence-override"),f.note&&(e="*"+e)),l.text(e)):l.text(""),p.prepend(l)}else i.type===s.ACCUMULATED_TIME_ROW||i.type===s.PREMIUM_ROW?(h=i[m.name+"_data"],l=$("<span  style='width: 100%'></span>"),Global.isSet(e)?(h&&(h.hasOwnProperty("note")&&h.note&&(e="*"+e),time_sheet_view_controller.wage_btn&&time_sheet_view_controller.wage_btn.getValue(!0)&&h.hasOwnProperty("total_time_amount")&&h.total_time_amount&&h.hasOwnProperty("hourly_rate")&&h.hourly_rate&&(l=$("<div class='time-sheet-view-wage-container'></div>"),e='<span class="time-sheet-view-wage-hour-rate">'+g+Global.MoneyRound(h.hourly_rate)+'/hr @</span><span class="time-sheet-view-wage-value">'+e+'</span ><span class="time-sheet-view-wage-amount" >= '+g+Global.MoneyRound(h.total_time_amount)+"</span>"),h.hasOwnProperty("override")&&!0===h.override&&l.addClass("absence-override")),l.html(e)):l.text(""),p.prepend(l)):(l=$("<span class='punch-time'></span>"),Global.isSet(e)?l.text(e):l.text(""),p.prepend(l));return p.addClass("date-column"),p.get(0).outerHTML}onSelectRow(e,t,i){var a=this,s=$(i).find("tr#"+t);a.timesheet_grid.grid.find("td.ui-state-highlight").removeClass("ui-state-highlight");var r=[],l=0;"timesheet_grid"===e?(r=a.select_cells_Array,l=a.select_cells_Array.length,a.absence_select_cells_Array=[]):"absence_grid"===e?(r=a.absence_select_cells_Array,l=a.absence_select_cells_Array.length,a.select_cells_Array=[]):"accumulated_grid"===e?(r=a.accumulated_time_cells_array,l=a.accumulated_time_cells_array.length):"premium_grid"===e&&(r=a.premium_cells_array,l=a.premium_cells_array.length),this.select_punches_array=[];for(var n=0;n<l;n++){var d=r[n];if(s=$(i).find("#"+d.row_id),$(s.find("td")[d.cell_index]).addClass("ui-state-highlight").attr("aria-selected",!0),d.punch&&d.punch.id){if(Global.isSet(d.punch.time_stamp)){var o=Global.strToDate(d.punch.punch_date).format("MM-DD-YYYY")+" "+d.punch.punch_time;d.punch.time_stamp_num=Global.strToDateTime(o).getTime()}else d.punch.time_stamp_num=d.time_stamp_num;this.select_punches_array.push(d.punch),this.select_punches_array.sort((function(e,t){return Global.compare(e,t,"time_stamp_num")}))}}}unsetSelectedCells(e){"accumulated_grid"==e&&(e="accumulated_time_grid"),this.last_clicked_grid_id&&e!=this.last_clicked_grid_id&&window.setTimeout((function(e,t){e.grid_dic[t].grid.trigger("reloadGrid")}),0,this,this.last_clicked_grid_id),this.last_clicked_grid_id=e}getRowData(e,t){var i=this,a=null;a="absence_grid"===e?i.absence_grid.getGridParam("data"):"accumulated_grid"===e?i.accumulated_time_grid.getGridParam("data"):"premium_grid"===e?i.premium_grid.getGridParam("data"):i.grid.getGridParam("data");var s=!1;for(var r in a)if(a[r].id==t){s=a[r];break}return s}onCellSelect(e,t,i,a,r,l){if($("#ribbon_view_container .context-menu:visible a").click(),i<0)return this.unsetSelectedCells(e),this.setDefaultMenu(),!0;i=parseInt(i);var n,d,o,_,c,u,h,m,p,g,b=this,v=[];if(b.absence_model=!1,n=b.getRowData(e,t),"timesheet_grid"===e){if(v=b.select_cells_Array,d=b.grid.getGridParam("colModel"),o=d[i].name,n.type===s.REQUEST_ROW){var f={filter_data:{}};f.filter_data.user_id=this.getSelectEmployee(),f.filter_data.start_date=b.full_timesheet_data.timesheet_dates.start_display_date,f.filter_data.end_date=b.full_timesheet_data.timesheet_dates.end_display_date,f.filter_data.id=[],b.unsetSelectedCells(e);var y=0,w=0;if(Global.isArray(n[o+"_request"]))for(var C in n[o+"_request"]){var T=n[o+"_request"][C];f.filter_data.id.push(T.id),T.status==$.i18n._("PENDING")&&(y+=1),w+=1}else{if(!n[o+"_request"])return;f.filter_data.id.push(n[o+"_request"].id),n[o+"_request"].status==$.i18n._("PENDING")&&(y=1),w=1}return Global.addViewTab(this.viewId,$.i18n._("TimeSheet"),window.location.href),void(w>0&&(this.getSelectEmployee()!=LocalCacheData.getLoginUser().id&&y>0&&this.ownerOrChildPermissionValidate("request","view_child",f.filter_data.id)?IndexViewController.goToView("RequestAuthorization",f):this.viewPermissionValidate("request",f.filter_data.id)&&IndexViewController.goToView("Request",f)))}_=n&&n[o+"_data"]?n[o+"_data"]:null,c=n[o+"_related_data"],u=Global.strToDate(o,this.full_format)}else"absence_grid"===e?(v=b.absence_select_cells_Array,d=b.absence_grid.getGridParam("colModel"),o=d[i].name,_=n?n[o+"_data"]:null,u=Global.strToDate(o,this.full_format),b.absence_model=!0):"accumulated_grid"===e?(v=b.accumulated_time_cells_array,d=b.accumulated_time_grid.getGridParam("colModel"),o=d[i].name,_=n?n[o+"_data"]:null,u=Global.strToDate(o,this.full_format)):"premium_grid"===e&&(v=b.premium_cells_array,d=b.premium_grid.getGridParam("colModel"),o=d[i].name,_=n?n[o+"_data"]:null,u=Global.strToDate(o,this.full_format));if(0==Global.isValidDate(u))return b.unsetSelectedCells(e),!1;for(var I=0;I<v.length;I++)h=v[I],m=$(r).find("#"+h.row_id),$(r).find("tr").removeClass("ui-state-highlight"),$(m.find("td")[h.cell_index]).removeClass("ui-state-highlight").attr("aria-selected",!1);if(l.ctrlKey||l.metaKey){var D=!1;for(I=0;I<v.length;I++)if(t==(h=v[I]).row_id&&i==h.cell_index){v.splice(I,1),D=!0;break}p=u.format(),g=u.getTime(),D||("timesheet_grid"===e?(_=U(t,i),c=F(t,i),v.push({row_id:t,cell_index:i,cell_val:a,punch:_,related_punch:c,date:p,time_stamp_num:g}),b.select_cells_Array=v,b.select_cells_Array.sort(Global.m_sort_by(["time_stamp_num","row_id"]))):"absence_grid"===e?(v.push({row_id:t,cell_index:i,cell_val:a,punch:_,date:p,time_stamp_num:g,src_object_id:n.punch_info_id?n.punch_info_id:null}),b.absence_select_cells_Array=v,b.absence_select_cells_Array.sort(Global.m_sort_by(["time_stamp_num","row_id"]))):"premium_grid"===e&&(v=[{row_id:t,cell_index:i,cell_val:a,date:p,time_stamp_num:g}],b.premium_cells_array=v))}else if(l.shiftKey&&v.length>0){var P=v[0].status_id,S=parseInt(v[0].row_id),M=parseInt(v[0].cell_index),G=t,x=i;if(S>G){var E=S;S=G,G=E}if(M>x){var A=M;M=x,x=A}for(I=0;I<v.length;I++){h=v[I];var V=parseInt(h.row_id);V<S&&(S=V),V>G&&(G=V),h.cell_index<M&&(M=h.cell_index),h.cell_index>x&&(x=h.cell_index)}var k=parseInt(v[0].row_id),R=parseInt(v[v.length-1].row_id),j=parseInt(v[0].cell_index),N=parseInt(v[v.length-1].cell_index);v&&v.length>0&&v[v.length-1].cell_index&&v[0].cell_index&&N>=i&&j<=i&&R>=t&&k<=t&&(G=t,x=i),v=[];for(I=S;I<=G;I++)for(var O=I,L=M;L<=x;L++){var B=L;m=$(r).find("tr#"+O),a=$(m.find("td")[B])[0].outerHTML,"timesheet_grid"===e?(_=U(I,L),c=F(I,L),p=(u=Global.strToDate(o,this.full_format)).format(),g=u.getTime(),v.push({row_id:O,cell_index:B,cell_val:a,punch:_,status_id:P,related_punch:c,date:p,time_stamp_num:g})):"absence_grid"===e?(d=b.absence_grid.getGridParam("colModel"),o=d[B].name,_=n[o+"_data"],p=(u=Global.strToDate(o,this.full_format)).format(),g=u.getTime(),v.push({row_id:O,cell_index:B,cell_val:a,punch:_,date:p,time_stamp_num:g,src_object_id:n.punch_info_id?n.punch_info_id:null})):"accumulated_grid"===e?(v=[{row_id:t,cell_index:i,cell_val:a,date:p,time_stamp_num:g}],b.accumulated_time_cells_array=v):"premium_grid"===e&&(v=[{row_id:t,cell_index:i,cell_val:a,date:p,time_stamp_num:g}],b.premium_cells_array=v)}"timesheet_grid"===e?(b.select_cells_Array=v,b.select_cells_Array.sort(Global.m_sort_by(["time_stamp_num","row_id"]))):"absence_grid"===e?(b.absence_select_cells_Array=v,b.absence_select_cells_Array.sort(Global.m_sort_by(["time_stamp_num","row_id"]))):"accumulated_grid"===e?(b.accumulated_time_cells_array=v,b.accumulated_time_cells_array.sort(Global.m_sort_by(["time_stamp_num","row_id"]))):"premium_grid"===e&&(b.premium_cells_array=v,b.premium_cells_array.sort(Global.m_sort_by(["time_stamp_num","row_id"])))}else p=u?u.format():"",g=u?u.getTime():0,"timesheet_grid"===e?(_=U(t,i),c=F(t,i),v=[{row_id:t,cell_index:i,cell_val:a,punch:_,status_id:n&&n.status_id?n.status_id:null,related_punch:c,date:p,time_stamp_num:g}],b.select_cells_Array=v):"absence_grid"===e?(v=[{row_id:t,cell_index:i,cell_val:a,punch:_,date:p,time_stamp_num:g,src_object_id:n.punch_info_id?n.punch_info_id:null}],b.absence_select_cells_Array=v):"accumulated_grid"===e?(v=[{row_id:t,cell_index:i,cell_val:a,date:p,time_stamp_num:g}],b.accumulated_time_cells_array=v):"premium_grid"===e&&(v=[{row_id:t,cell_index:i,cell_val:a,date:p,time_stamp_num:g}],b.premium_cells_array=v),u&&u.getYear()>0&&(this.setDatePickerValue(u.format(Global.getLoginUserDateFormat())),this.highLightSelectDay(l),this.reLoadSubGridsSource()),this.unsetSelectedCells(e);for(var C in this.select_punches_array=[],v)v[C].punch&&this.select_punches_array.push(v[C].punch);function U(e,t){var i=null;for(var a in n=null,b.timesheet_data_source)if(b.timesheet_data_source[a].id==e){n=b.timesheet_data_source[a];break}return n&&(d=b.grid.getGridParam("colModel"),o=d[t].name,i=n[o+"_data"]?n[o+"_data"]:null),i}function F(e,t){var i=null;for(var a in n=null,b.timesheet_data_source)if(b.timesheet_data_source[a].id==e){n=b.timesheet_data_source[a];break}return n&&(d=b.grid.getGridParam("colModel"),o=d[t].name,i=n[o+"_related_data"]?n[o+"_related_data"]:null),i}return this.setTimesheetGridDragAble(),!0}get_selected_punch_array(){}buildTimeSheetRequests(){for(var e=this.full_timesheet_data.request_data,t=e.length,i=null,a=0;a<t;a++){var r,l=e[a],n=Global.strToDate(l.date_stamp).format(this.full_format);i?(r=this.timesheet_data_source[i],Global.isSet(r[n+"_request"])?("array"===$.type(r[n+"_request"])||(r[n+"_request"]=[r[n+"_request"]]),r[n+"_request"].push(l),r[n]=d(r[n+"_request"])):(r[n]=l.status,r[n+"_request"]=l)):((r={}).punch_info=$.i18n._("Requests"),r.user_id=l.user_id,r[n]=l.status,r[n+"_request"]=l,r.type=s.REQUEST_ROW,this.timesheet_data_source.push(r),i=this.timesheet_data_source.length-1)}function d(e){for(var t=e.length,i=0,a=0,s=0,r="",l=0;l<t;l++){var n=e[l];50==n.status_id?i+=1:55==n.status_id?a+=1:30==n.status_id&&(s+=1)}return i>0&&(r+=" A: "+i),s>0&&(r+=" P: "+s),a>0&&(r+=" D: "+a),r}}buildTimeSheetExceptions(){for(var e=this.full_timesheet_data.exception_data,t=e.length,i=this.timesheet_data_source.length,a=null,r=0;r<t;r++){var l,n,d=e[r],o=Global.strToDate(d.date_stamp).format(this.full_format);if(a?(l=this.timesheet_data_source[a],Global.isSet(l[o+"_exceptions"])?l[o+"_exceptions"].push(d):l[o+"_exceptions"]=[d]):((l={}).punch_info=$.i18n._("Exceptions"),l.user_id=d.user_id,l[o]="",l[o+"_exceptions"]=[d],l.type=s.EXCEPTION_ROW,this.timesheet_data_source.push(l),a=this.timesheet_data_source.length-1),Global.isFalseOrNull(d.punch_id)){if(!Global.isFalseOrNull(d.punch_control_id))for(_=0;_<i;_++)(l=this.timesheet_data_source[_])[o]&&(l[o+"_data"]?n=l[o+"_data"]:l[o+"_related__data"]&&(n=l[o+"_related_data"]),n&&n.punch_control_id===d.punch_control_id&&!n.exception&&(n.exception=[d]))}else for(var _=0;_<i;_++)(l=this.timesheet_data_source[_])[o]&&(l[o+"_data"]?n=l[o+"_data"]:l[o+"_related__data"]&&(n=l[o+"_related_data"]),n&&n.id===d.punch_id&&!n.exception&&(n.exception=[d]))}}sortAccumulatedTotalData(){this.accumulated_total_grid_source.sort(Global.m_sort_by(["order","punch_info"]))}sortAccumulatedTimeData(){this.accumulated_time_source.sort(Global.m_sort_by(["order","punch_info"]))}reLoadSubGridsSource(e){if(this.full_timesheet_data&&this.full_timesheet_data.timesheet_verify_data&&(e||this.full_timesheet_data.timesheet_verify_data.pay_period_id!==this.pay_period_map[this.getSelectDate()]&&(Global.isSet(this.full_timesheet_data.timesheet_verify_data.pay_period_id)||this.pay_period_map[this.getSelectDate()]))){this.accumulated_time_source_map={},this.branch_source_map={},this.department_source_map={},this.job_source_map={},this.job_item_source_map={},this.premium_source_map={},this.accumulated_total_grid_source_map={},this.accumulated_time_source=[],this.branch_source=[],this.department_source=[],this.job_source=[],this.job_item_source=[],this.premium_source=[],this.accumulated_total_grid_source=[],this.verification_grid_source=[];var t=this,i=this.start_date_picker.getValue(),a=this.getSelectEmployee();this.api_timesheet.getTimeSheetTotalData(a,i,{onResult:function(e){t.onReloadSubGridResult(e)}})}}onReloadSubGridResult(e){var t=this;e=e.getResult(),t.full_timesheet_data.accumulated_user_date_total_data=e.accumulated_user_date_total_data,t.full_timesheet_data.meal_and_break_total_data=e.meal_and_break_total_data,t.full_timesheet_data.pay_period_accumulated_user_date_total_data=e.pay_period_accumulated_user_date_total_data,t.full_timesheet_data.timesheet_verify_data=e.timesheet_verify_data,t.full_timesheet_data.pay_period_data=e.pay_period_data,t.timesheet_verify_data=t.full_timesheet_data.timesheet_verify_data,t.buildSubGridsSource(),t.buildAccumulatedTotalGrid(),t.buildVerificationGridSource(),t.accumulated_time_grid.setData(t.accumulated_time_source,!1),t.branch_grid.setData(t.branch_source,!1),t.department_grid.setData(t.department_source,!1),t.job_grid.setData(t.job_source,!1),t.job_item_grid.setData(t.job_item_source,!1),t.premium_grid.setData(t.premium_source,!1),0===t.accumulated_total_grid_source.length&&t.accumulated_total_grid_source.push(),t.accumulated_total_grid.setData(t.accumulated_total_grid_source,!1),t.punch_note_grid.setData(t.punch_note_grid_source,!1),t.verification_grid.setData(t.verification_grid_source,!1),t.setGridSize()}setDefaultMenuEditIcon(e,t,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),1!==t||!this.editOwnerOrChildPermissionValidate(i)||"punch"!==this.getPunchMode()&&"absence"!==i?e.addClass("disable-image"):e.removeClass("disable-image")}setDefaultMenuDeleteIcon(e,t,i){this.deletePermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),t>=1&&this.deleteOwnerOrChildPermissionValidate(i)&&("punch"===this.getPunchMode()||"absence"===i)?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuViewIcon(e,t,i){this.viewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),1!==t||!this.viewOwnerOrChildPermissionValidate()||"punch"!==this.getPunchMode()&&"absence"!==i?e.addClass("disable-image"):e.removeClass("disable-image")}setDefaultMenuAddIcon(e,t,i){this.addPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),"manual"===this.getPunchMode()&&"absence"!==i&&e.addClass("disable-image")}setDefaultMenuSaveIcon(e,t,i){this.addPermissionValidate(i)||this.editPermissionValidate(i)||e.addClass("invisible-image"),"manual"===this.getPunchMode()?(this.addPermissionValidate(i)||this.editPermissionValidate(i)||e.addClass("invisible-image"),this.is_saving_manual_grid&&e.addClass("disable-image")):e.addClass("disable-image")}buildAccmulatedOrderMap(e){if(e)for(var t in e)for(var i in e[t])this.accmulated_order_map[i]=e[t][i].order}buildSubGridsSource(){var e=this.full_timesheet_data.accumulated_user_date_total_data,t=this.full_timesheet_data.meal_and_break_total_data,i=this.full_timesheet_data.pay_period_accumulated_user_date_total_data;this.accmulated_order_map={},e.total&&this.buildAccmulatedOrderMap(e.total),i&&this.buildAccmulatedOrderMap(i);var a=i.accumulated_time,s=i.premium_time,r=i.absence_time_taken;Global.isSet(a)||(a={total:{label:$.i18n._("Total Time"),total_time:"0"}}),this.buildSubGridsData(a,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),Global.isSet(s)&&this.buildSubGridsData(s,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(r)&&this.buildSubGridsData(r,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time");var l,n,d=this.timesheet_columns.length;a={total:{label:$.i18n._("Total Time"),total_time:"0"}};var o=1;if("punch"!=this.getPunchMode())o=this.getManualPayPeriodDefaultTrColspan();for(var _=o;_<d;_++)(l=this.timesheet_columns[_].name).indexOf("empty_cell")>=0||this.buildSubGridsData(a,l,this.accumulated_time_source_map,this.accumulated_time_source,"accumulated_time");for(var c in this.buildSubGridsData(a,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),e)if("total"!==c){if(n=Global.strToDate(c)){if(l=n.format(this.full_format),void 0!==e[c]){a=e[c].accumulated_time;var u=e[c].branch_time,h=e[c].department_time,m=e[c].job_time,p=e[c].job_item_time;s=e[c].premium_time}else Debug.Text("ERROR: accumulated_user_date_total_data[key] is null or undefined!","TimesheetViewController.js","TimesheetViewController","buildSubGridsSource",1);Global.isSet(a)&&this.buildSubGridsData(a,l,this.accumulated_time_source_map,this.accumulated_time_source,"accumulated_time"),Global.isSet(u)&&this.buildSubGridsData(u,l,this.branch_source_map,this.branch_source,"branch_time"),Global.isSet(h)&&this.buildSubGridsData(h,l,this.department_source_map,this.department_source,"department_time"),Global.isSet(m)&&this.buildSubGridsData(m,l,this.job_source_map,this.job_source,"job_time"),Global.isSet(p)&&this.buildSubGridsData(p,l,this.job_item_source_map,this.job_item_source,"job_item_time"),Global.isSet(s)&&this.buildSubGridsData(s,l,this.premium_source_map,this.premium_source,"premium_time")}}else{var g=e.total;a=g.accumulated_time,s=g.premium_time,r=g.absence_time_taken,Global.isSet(a)&&this.buildSubGridsData(a,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),Global.isSet(s)&&this.buildSubGridsData(s,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(r)&&this.buildSubGridsData(r,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time")}if(this.sortAccumulatedTotalData(),this.sortAccumulatedTimeData(),Global.isSet(t))for(var c in t)(n=Global.strToDate(c))&&(l=n.format(this.full_format),this.buildBreakAndLunchData(t[c],l))}buildBreakAndLunchData(e,t){var i;for(var a in e)this.accumulated_time_source_map[a]?(i=this.accumulated_time_source_map[a])[t]||(e[a].key=a,i[t]=Global.getTimeUnit(e[a].total_time)+" ("+e[a].total_breaks+")",i[t+"_data"]=e[a]):((i={}).punch_info=e[a].break_name,e[a].key=a,i[t]=Global.getTimeUnit(e[a].total_time)+" ("+e[a].total_breaks+")",i[t+"_data"]=e[a],this.timesheet_data_source.push(i),this.accumulated_time_source_map[a]=i)}addCellCount(e){switch(e){case"branch_time":this.branch_cell_count=this.branch_cell_count+1;break;case"department_time":this.department_cell_count=this.department_cell_count+1;break;case"premium_time":this.premium_cell_count=this.premium_cell_count+1;break;case"job_time":this.job_cell_count=this.job_cell_count+1;break;case"job_item_time":this.task_cell_count=this.task_cell_count+1}}buildSubGridsData(e,t,i,a,r){var l,n=!1;for(var d in e){if(i[d])(l=i[d])[t],e[d].key=d,l[t]=Global.getTimeUnit(e[d].total_time),l[t+"_data"]=e[d],"accumulated_time"===l.parent_key&&e[d].override&&(l.is_override_row=!0);else{(l={}).parent_key=r,l.key=d,"accumulated_time"===r?("total"===d||"worked_time"===d?l.type=s.TOTAL_ROW:0==n&&0===d.indexOf("regular_time")?(l.type=s.REGULAR_ROW,n=!0):l.type=s.ACCUMULATED_TIME_ROW,e[d].override&&(l.is_override_row=!0)):"premium_time"===r&&(l.type=s.PREMIUM_ROW),this.accmulated_order_map[d]&&(l.order=this.accmulated_order_map[d]),l.punch_info=e[d].label;var o=d.split("_"),_=!1;o.length>1&&"0"==o[1]&&(_=!0),e[d].key=d,l[t]=Global.getTimeUnit(e[d].total_time),l[t+"_data"]=e[d],_?a.unshift(l):a.push(l),i[d]=l}this.addCellCount(r)}}timeSheetVerifyPermissionValidate(){return!(!PermissionManager.validate("punch","verify_time_sheet")||!this.timesheet_verify_data.hasOwnProperty("pay_period_verify_type_id")||10==this.timesheet_verify_data.pay_period_verify_type_id)}buildVerificationGridSource(){this.verification_grid_source=[];var e=this,t=$(this.el).find(".verification-action-bar"),i=$(this.el).find(".verification-grid-div"),a=$(this.el).find(".verify-button"),s=$(this.el).find(".verification-grid-title"),r=$(this.el).find(".verify-description");if(!(this.timeSheetVerifyPermissionValidate()&&Global.isSet(this.timesheet_verify_data.pay_period_id)&&Global.isSet(this.timesheet_verify_data.pay_period_verify_type_id)&&"10"!==this.timesheet_verify_data.pay_period_verify_type_id))return a.css("display","none"),void i.css("display","none");this.timesheet_verify_data.display_verify_button?(a.css("display","inline-block"),s.css("display","block")):(a.css("display","none"),s.css("display","none")),i.css("display","block"),r.text(this.timesheet_verify_data.verification_status_display),this.timesheet_verify_data.verification_box_color?t.css("background",this.timesheet_verify_data.verification_box_color):t.css("background","#ffffff"),a.unbind("click").bind("click",(function(){TAlertManager.showConfirmAlert(e.timesheet_verify_data.verification_confirmation_message,"",(function(t){t&&e.api_timesheet.verifyTimeSheet(e.getSelectEmployee(),e.timesheet_verify_data.pay_period_id,{onResult:function(t){t.isValid()?e.search():TAlertManager.showErrorAlert(t)}})}))}));var l=this.timesheet_verify_data.verification_window_dates.start+" "+$.i18n._("to")+" "+this.timesheet_verify_data.verification_window_dates.end,n=this.pay_period_header;this.verification_grid_source.push({pay_period:n,verification:l}),e.setGridHeight("verification_grid")}buildPunchNoteGridSource(){this.punch_note_grid_source=[];for(var e,t=this.full_timesheet_data.punch_data,i=this.full_timesheet_data.user_date_total_data,a=t.length,s=i.length,r="",l=0;l<a;l++){var n=t[l];e=Global.strToDate(n.date_stamp).format(),n.note&&n.punch_control_id!==r&&(this.punch_note_account=this.punch_note_account+1,this.punch_note_grid_source.push({note:e+" @ "+n.punch_time+": "+n.note.replace(/\n/g," ")}),r=n.punch_control_id)}for(var d=0;d<s;d++){var o=i[d];e=Global.strToDate(o.date_stamp).format(),o.note&&(this.punch_note_account=this.punch_note_account+1,this.punch_note_grid_source.push({note:e+" @ "+Global.getTimeUnit(o.total_time)+": "+o.note.replace(/\n/g," ")}))}}buildAbsenceSource(){var e={};this.absence_source=[],this.absence_original_source=[];for(var t,i=this.full_timesheet_data.user_date_total_data,a=i.length,r=1,l=0;l<a;l++){var n=i[l];if(50==n.object_type_id){this.absence_original_source.push(n);var d=Global.strToDate(n.date_stamp),o=d.format(this.full_format),_=n.src_object_id+"-"+n.pay_code_id;e[_]?(t=e[_])[o]?((t={}).id=r,t.type=s.ABSENCE_ROW,t.punch_info=n.name,t.punch_info_id=n.src_object_id,t.user_id=n.user_id,t[o]=Global.getTimeUnit(n.total_time),t[o+"_data"]=n,this.absence_source.push(t),e[_]=t):(this.lastDayIsOverride(d,t,n),t[o]=Global.getTimeUnit(n.total_time),t[o+"_data"]=n):((t={}).id=r,t.type=s.ABSENCE_ROW,t.punch_info=n.name,t.punch_info_id=n.src_object_id,t.user_id=n.user_id,t[o]=Global.getTimeUnit(n.total_time),t[o+"_data"]=n,this.absence_source.push(t),e[_]=t),r++,this.absence_cell_count=this.absence_cell_count+1}}0===this.absence_source.length&&((t={}).id=1,t.punch_info="",t.user_id=this.getSelectEmployee(),this.absence_source.push(t))}lastDayIsOverride(e,t,i){var a=t[new Date(new Date(e.getTime()).setDate(e.getDate()-1)).format(this.full_format)+"_data"];return!(!a||!a.override||i.src_object_id!==a.src_object_id)}buildTimeSheetSource(){this.select_punches_array=[],this.timesheet_data_source=[];for(var e,t,i=this.full_timesheet_data.punch_data,a=i.length,r=1,l=0;l<a;l++){var n=i[l];if(n.date_stamp){var d=Global.strToDate(n.date_stamp).format(this.full_format),o=n.status_id;if(0===l)if((e={}).id=r,r++,e.punch_info=n.status,e.status_id=o,e.user_id=n.user_id,e[d]=n.punch_time,e[d+"_data"]=n,e[d+"_related_data"]=null,e.status_id=o,e.type=s.PUNCH_ROW,this.timesheet_data_source.push(e),10==o){var _={};_.punch_info=$.i18n._("Out"),_.user_id=n.user_id,_[d]="",_[d+"_data"]=null,_[d+"_related_data"]=n,_.status_id=20,_.type=s.PUNCH_ROW,_.id=r,r++,this.timesheet_data_source.push(_)}else(t={}).punch_info=$.i18n._("In"),t.user_id=n.user_id,t[d]="",t[d+"_data"]=null,t[d+"_related_data"]=n,t.status_id=10,t.type=s.PUNCH_ROW,t.id=r,r++,this.timesheet_data_source.splice(this.timesheet_data_source.length-1,0,t);else{for(var c=!1,u=this.timesheet_data_source.length,h=0;h<u;h++){if(!(e=this.timesheet_data_source[h])[d])if(!e[d]&&e[d+"_related_data"]){if(e[d+"_related_data"].punch_control_id===n.punch_control_id){e[d]=n.punch_time,e[d+"_data"]=n,c=!0;break}}else if(!e[d]&&!e[d+"_related_data"]&&n.status_id==e.status_id){e[d]=n.punch_time,e[d+"_data"]=n,e[d+"_related_data"]=null,c=!0,10==n.status_id?((t=this.timesheet_data_source[h+1])[d]="",t[d+"_data"]=null,t[d+"_related_data"]=n):((t=this.timesheet_data_source[h-1])[d]="",t[d+"_data"]=null,t[d+"_related_data"]=n);break}}c||((e={}).punch_info=n.status,e.user_id=n.user_id,e[d]=n.punch_time,e[d+"_data"]=n,e[d+"_related_data"]=null,e.status_id=o,e.type=s.PUNCH_ROW,e.id=r,r++,this.timesheet_data_source.push(e),10==o?((t={}).punch_info=$.i18n._("Out"),t.user_id=n.user_id,t[d]="",t[d+"_data"]=null,t[d+"_related_data"]=n,t.status_id=20,t.type=s.PUNCH_ROW,t.id=r,r++,this.timesheet_data_source.push(t)):((t={}).punch_info=$.i18n._("In"),t.user_id=n.user_id,t[d]="",t[d+"_data"]=null,t[d+"_related_data"]=n,t.status_id=10,t.type=s.PUNCH_ROW,t.id=r,r++,this.timesheet_data_source.splice(this.timesheet_data_source.length-1,0,t)))}}}(e={}).punch_info=$.i18n._("In"),e.user_id=this.getSelectEmployee(),e.status_id=10,e.type=s.PUNCH_ROW,e.id=r,r++,this.timesheet_data_source.push(e),(e={}).punch_info=$.i18n._("Out"),e.user_id=this.getSelectEmployee(),e.status_id=20,e.type=s.PUNCH_ROW,e.id=r,r++,this.timesheet_data_source.push(e)}buildTimeSheetsColumns(){if(this.timesheet_columns=[],"manual"===this.getPunchMode())for(var e=0;e<5;e++){var t=e>1?123:25;if(4===e&&(t=160),(0!==e||this.show_branch_ui)&&(1!==e||this.show_department_ui)&&(2!==e||this.show_job_ui&&!(Global.getProductEdition()<=15))&&(3!==e||this.show_job_item_ui&&!(Global.getProductEdition()<=15))){var i={name:"empty_cell_"+e,index:"empty_cell_"+e,label:" ",width:t,sortable:!1,title:!1,fixed:!0};this.timesheet_columns.push(i)}}var a={name:"punch_info",index:"punch_info",label:" ",width:"manual"===this.getPunchMode()?160:100,sortable:!1,title:!1,formatter:this.onCellFormat,fixed:"manual"===this.getPunchMode()};this.timesheet_columns.push(a),this.column_maps=[];for(e=0;e<7;e++){var s=new Date(new Date(this.start_date.getTime()).setDate(this.start_date.getDate()+e)),r=s.format(this.weekly_format);if("en"!=LocalCacheData.getLoginData().language&&Global.isString(r)){var l=r.split(","),n=l[1].split(" ");r=$.i18n._(l[0])+", "+$.i18n._(n[1])+" "+n[2]}var d=s.format(this.full_format);this.column_maps.push(s.format());var o={resizable:!1,name:d,index:d,label:r,width:100,sortable:!1,title:!1,formatter:this.onCellFormat};this.timesheet_columns.push(o)}return this.timesheet_columns}getDefaultDisplayColumns(e){e()}setSelectLayout(){var e=this;if(!Global.isSet(this.grid)){var t=$(this.el).find("#grid");t.attr("id",this.ui_id+"_grid"),t=$(this.el).find("#"+this.ui_id+"_grid")}if(this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}}),this.search_panel){var i=this.search_panel.getLayoutsArray();if(this.previous_saved_layout_selector&&this.previous_saved_layout_selector.empty(),i&&i.length>0){this.previous_saved_layout_div.css("display","inline");for(var a=i.length,s=0;s<a;s++){var r=i[s];this.previous_saved_layout_selector.append($('<option value="'+r.id+'"></option>').text(r.name))}$(this.previous_saved_layout_selector.find("option")).filter((function(){return $(this).attr("value")===e.select_layout.id})).prop("selected",!0).attr("selected",!0)}else this.previous_saved_layout_div&&this.previous_saved_layout_div.css("display","none");LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.setSearchPanelFilter(!0)}}setTimesheetGridDragAble(){var e=this,t=0,i=this.grid.grid.find(".date-column").parents("td");i.attr("draggable",!0),i.off("dragstart").on("dragstart",(function(t){var i=t.target;if(e.select_punches_array.length<1||!$(i).hasClass("ui-state-highlight")||!e.select_drag_menu_id)return!1;for(var a=$("<div class='drag-holder-div'></div>"),s=e.select_punches_array.length,r=0;r<s;r++){var l=e.select_punches_array[r],n=$("<span class='drag-span'></span>");n.text(l.status+": "+l.time_stamp),a.append(n)}return $("body").find(".drag-holder-div").remove(),$("body").append(a),t.originalEvent.dataTransfer.setData("Text","timesheet"),t.originalEvent.dataTransfer.setDragImage&&t.originalEvent.dataTransfer.setDragImage(a[0],0,0),!0})),i.off("dragover").on("dragover",(function(e){var i=e.originalEvent;i.preventDefault();var a=$(this);$(".timesheet-drag-over").removeClass("timesheet-drag-over"),$(".drag-over-top").removeClass("drag-over-top"),$(".drag-over-center").removeClass("drag-over-center"),$(".drag-over-bottom").removeClass(" drag-over-bottom"),$(this).addClass("timesheet-drag-over"),i.pageY-a.offset().top<=8?(t=-1,a.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-top")):i.pageY-a.offset().top>=a.height()-5?(t=1,a.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-bottom")):(t=0,a.removeClass("drag-over-top drag-over-center drag-over-bottom").addClass("drag-over-center"))})),i.off("dragend").on("dragend",(function(e){$(".timesheet-drag-over").removeClass("timesheet-drag-over"),$(".drag-over-top").removeClass("drag-over-top"),$(".drag-over-center").removeClass("drag-over-center"),$(".drag-over-bottom").removeClass(" drag-over-bottom"),$("body").find(".drag-holder-div").remove()})),i.off("drop").on("drop",(function(i){i.preventDefault(),i.stopPropagation&&i.stopPropagation(),$(this).removeClass("drag-over-top drag-over-center drag-over-bottom timesheet-drag-over");var a=i.currentTarget,s=0;if(0!==$(a).index()&&e.select_punches_array&&e.select_punches_array[s]){var r=e.select_punches_array[s],l=Global.strToDate(r.punch_date),n=e.timesheet_data_source[a.parentNode.rowIndex-1];if(n){var d=e.grid.getGridParam("colModel"),o=d[a.cellIndex].name,_=n[o+"_data"],c=n[o+"_related_data"],u=Global.strToDate(o,e.full_format),h=l,m=u.getTime()-l.getTime(),p=u.format();!function i(){if(!e.select_punches_array)return;var g=r.id,b=!1,v=n.status_id,f=e.select_drag_menu_id===ContextMenuIconName.move?1:0;_&&20==r.status_id?(b=_.id,v=!1):c&&(b=c.id,t=10==c.status_id?1:-1,v=!1);TTAPI.APIPunchControl.dragNdropPunch(g,b,v,t,f,p,{onResult:function(g){var b=g.getResult();if(g.isValid()&&e.select_punches_array&&e.select_punches_array.length>0){if((s+=1)>e.select_cells_Array.length-1)return void e.search(!0);if(!e.select_punches_array[s])return void e.search(!0);for(;!e.select_punches_array[s].date_stamp;)if((s+=1)>e.select_cells_Array.length-1)return void e.search(!0);t=1;var v=p;r=e.select_punches_array[s],l=Global.strToDate(r.punch_date),n=e.timesheet_data_source[a.parentNode.rowIndex-1],d=e.grid.getGridParam("colModel"),o=d[a.cellIndex].name,m=l.getTime()-h.getTime(),u=Global.strToDate(o,e.full_format),p=new Date(u.getTime()+m).format(),_={id:b},c=null,p!==v&&(t=0,_=null),i()}else TAlertManager.showAlert($.i18n._("Unable to drag and drop punch to the specified location")),s>0&&e.search(!0)}})}()}}}))}setPunchModeClass(){this.$el.removeClass("timesheet-punch-mode"),this.$el.removeClass("timesheet-manual-mode"),"punch"===this.getPunchMode()?this.$el.addClass("timesheet-punch-mode"):this.$el.addClass("timesheet-manual-mode")}initData(){Global.removeViewTab(this.viewId);var e=LocalCacheData.getLoginUser();if(this.initOptions(),ProgressBar.showOverlay(),LocalCacheData.last_timesheet_selected_show_wage?this.wage_btn.setValue(LocalCacheData.last_timesheet_selected_show_wage):this.wage_btn.setValue(!1),Global.isSet(LocalCacheData.getAllURLArgs())&&LocalCacheData.getAllURLArgs().show_wage&&this.wage_btn.setValue("1"===LocalCacheData.getAllURLArgs().show_wage),LocalCacheData.last_timesheet_selected_timezone?this.timezone_btn.setValue(LocalCacheData.last_timesheet_selected_timezone):this.timezone_btn.setValue(!1),Global.isSet(LocalCacheData.getAllURLArgs())&&LocalCacheData.getAllURLArgs().timezone&&this.timezone_btn.setValue("1"===LocalCacheData.getAllURLArgs().timezone),this.show_punch_mode_ui?(LocalCacheData.last_timesheet_selected_punch_mode?this.toggle_button.setValue(LocalCacheData.last_timesheet_selected_punch_mode):this.toggle_button.setValue("punch"),LocalCacheData.getAllURLArgs().mode&&this.toggle_button.setValue("manual"===LocalCacheData.getAllURLArgs().mode?"manual":"punch")):PermissionManager.validate(this.permission_id,"punch_timesheet")||PermissionManager.validate(this.permission_id,"manual_timesheet")?(PermissionManager.validate(this.permission_id,"punch_timesheet")&&this.toggle_button.setValue("punch"),Global.getProductEdition()>=15&&PermissionManager.validate(this.permission_id,"manual_timesheet")&&this.toggle_button.setValue("manual")):this.toggle_button.setValue("punch"),1==Global.UNIT_TEST_MODE&&(LocalCacheData.last_timesheet_selected_date="15-Feb-18"),LocalCacheData.default_filter_for_next_open_view)this.employee_nav.setValue(LocalCacheData.default_filter_for_next_open_view.user_id),this.setDatePickerValue(LocalCacheData.default_filter_for_next_open_view.base_date);else if(LocalCacheData.getAllURLArgs().user_id?this.employee_nav.setValue(LocalCacheData.getAllURLArgs().user_id):LocalCacheData.last_timesheet_selected_user?this.employee_nav.setValue(LocalCacheData.last_timesheet_selected_user):this.employee_nav.setValue(e),LocalCacheData.last_timesheet_selected_date)this.setDatePickerValue(LocalCacheData.last_timesheet_selected_date);else if(LocalCacheData.current_select_date&&Global.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD"))this.setDatePickerValue(Global.strToDate(LocalCacheData.current_select_date,"YYYY-MM-DD").format()),LocalCacheData.current_select_date="";else{var t=new Date,i=Global.getLoginUserDateFormat(),a=t.format(i);this.setDatePickerValue(a)}this.initLayout(),this.setMoveOrDropMode(ContextMenuIconName.move)}setDatePickerValue(e){this.start_date_picker.setValue(e);this.start_date_picker.getDefaultFormatValue();var t=this.getSelectEmployee();if(t&&!this.edit_view&&-1===window.location.href.indexOf("user_id="+t)){var i=Global.getBaseURL()+"#!m="+this.viewId+"&user_id="+t+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue();if(LocalCacheData.getAllURLArgs())for(var a in LocalCacheData.getAllURLArgs())"m"!==a&&"user_id"!==a&&"show_wage"!==a&&"timezone"!==a&&"mode"!==a&&(i=i+"&"+a+"="+LocalCacheData.getAllURLArgs()[a]);Global.setURLToBrowser(i)}LocalCacheData.last_timesheet_selected_date=e}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Punch Branch"),in_column:1,field:"branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Punch Department"),field:"department_id",in_column:1,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Job"),in_column:2,field:"job_id",layout_name:"global_job",api_class:Global.getProductEdition()>=20?TTAPI.APIJob:null,multiple:!0,basic_search:this.show_job_item_ui&&Global.getProductEdition()>=20,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Task"),in_column:2,field:"job_item_id",layout_name:"global_job_item",api_class:Global.getProductEdition()>=20?TTAPI.APIJobItem:null,multiple:!0,basic_search:this.show_job_item_ui&&Global.getProductEdition()>=20,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}getSelectEmployee(e){var t=!1;if((this.show_navigation_box&&this.employee_nav&&"function"==typeof this.employee_nav.getValue&&(t=this.employee_nav.getValue(!0)),0==Global.isObject(t)&&(t={id:t}),0==Global.isObject(t)||1==Global.isObject(t)&&(0==t.hasOwnProperty("id")||0==TTUUID.isUUID(t.id)))&&(t=LocalCacheData.getLoginUser(),0==Global.isObject(t)||1==Global.isObject(t)&&(0==t.hasOwnProperty("id")||0==TTUUID.isUUID(t.id))))return(new RibbonViewController).doLogout(),!1;return 1!=e&&1==Global.isObject(t)&&1==t.hasOwnProperty("id")&&1==TTUUID.isUUID(t.id)&&(t=t.id),t}getSelectDate(){if(this.start_date_picker){var e=this.start_date_picker.getValue();return"Invalid date"==e&&(e=new Date),e}return null}onDeleteResult(e){var t=this;t.timesheet_grid.grid.find("td.ui-state-highlight").removeClass("ui-state-highlight"),ProgressBar.closeOverlay(),e.isValid()?(t.edit_view&&"delete"===LocalCacheData.current_doing_context_action&&t.removeEditView(),t.edit_view&&"delete_and_next"===LocalCacheData.current_doing_context_action&&t.onRightArrowClick()):TAlertManager.showErrorAlert(e),t.first_build=!0,t.search(),t.setDefaultMenu()}getDeleteSelectedRecordId(){var e=[];if(this.edit_view)e.push(this.current_edit_record.id);else for(var t in this.select_punches_array){var i=this.select_punches_array[t];e.push(i.id)}return e}reSetURL(){var e="#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&timezone="+this.timezone_btn.getValue(!0)+"&mode="+this.toggle_button.getValue();Global.setURLToBrowser(Global.getBaseURL()+e),LocalCacheData.setAllURLArgs(Global.buildArgDic(e.split("&")))}onSaveAndContinue(e){var t=this;Global.isSet(e)||(e=!1),this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_continue";var i=this.getCurrentAPI();this.is_mass_adding&&this.current_edit_record.punch_dates&&1===this.current_edit_record.punch_dates.length&&(this.current_edit_record.punch_date=this.current_edit_record.punch_dates[0]),i.setIsIdempotent(!0),i["set"+i.key_name](this.current_edit_record,!1,e,{onResult:function(e){if(e.isValid()){var i,a=e.getResult();!0===a?i=t.current_edit_record.id:TTUUID.isUUID(a)&&a!=TTUUID.zero_id&&a!=TTUUID.not_exist_id&&(i=a),t.search(),t.onEditClick(i),t.previous_absence_policy_id=!1,t.onSaveAndContinueDone(e)}else t.setErrorMenu(),t.setErrorTips(e)}})}getSelectedRecordId(e){var t=!1;return Global.isSet(e)?Global.isObject(e)&&e.id?t=e.id:Global.isString(e)&&TTUUID.isUUID(e)&&(t=e):t=this.select_punches_array.length>0?this.select_punches_array[0].id:null,t}getViewSelectedRecordId(e){return this.getSelectedRecordId(e)}doViewAPICall(e,t){var i=this.getCurrentAPI(),a={onResult:this.handleViewAPICallbackResult.bind(this)};return t?(t.push(a),i["get"+i.key_name].apply(i,t)):i["get"+i.key_name](e,a)}onViewClick(e,t){t&&(this.absence_model="absence"===t),super.onViewClick(e)}buildOtherFieldUI(e,t){if(this.edit_view_tab){var i,a=this,s=this.edit_view_tab.find("#tab_punch").find(".first-column");if(a.edit_view_ui_dic[e])(i=a.edit_view_ui_dic[e]).setValue(a.current_edit_record[e]);else(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:e}),a.addEditFieldToColumn(t,i,s).insertBefore(this.edit_view_form_item_dic.note),i.setValue(a.current_edit_record[e]);i.css("opacity",1),i.css("minWidth",300),a.is_viewing?i.setEnabled(!1):i.setEnabled(!0)}}onMassEditClick(){var e=this;LocalCacheData.current_doing_context_action="mass_edit",e.openEditView(),this.is_mass_adding=!1,this.is_viewing=!1;var t=this.getCurrentAPI(),i={};this.mass_edit_record_ids=[],$.each(this.select_punches_array,(function(t,i){e.mass_edit_record_ids.push(i.id)})),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,t["getCommon"+t.key_name+"Data"](i,{onResult:function(i){var a=i.getResult();t.getOptions("unique_columns",{onResult:function(i){e.unique_columns=i.getResult(),t.getOptions("linked_columns",{onResult:function(t){e.linked_columns=t.getResult(),e.sub_view_mode&&e.parent_key&&(a[e.parent_key]=e.parent_value),Global.isSet(a.time_stamp)||(a.time_stamp=!1),e.current_edit_record=a,e.is_mass_editing=!0,e.initEditView()}})}})}})}setSubLogViewFilter(){return!!this.sub_log_view_controller&&(this.sub_log_view_controller.getSubViewFilter=function(e){return this.parent_view_controller.absence_model?(e.table_name="user_date_total",e.object_id=this.parent_edit_record.id):e.table_name_object_id={"punch":[this.parent_edit_record.id],"punch_control":[this.parent_edit_record.punch_control_id]},e},!0)}getEditSelectedRecordId(e){return this.getSelectedRecordId(e)}doEditAPICall(e,t){var i=this.getCurrentAPI(),a={onResult:this.handleEditAPICallbackResult.bind(this)};return t?(t.push(a),i["get"+i.key_name].apply(i,t)):i["get"+i.key_name](e,a)}onEditClick(e,t){t&&(this.absence_model="absence"===t),super.onEditClick(e)}setURL(){var e=this.absence_model?"absence":"punch",t="";switch(LocalCacheData.current_doing_context_action){case"new":case"edit":case"view":t=LocalCacheData.current_doing_context_action;break;case"copy_as_new":t="new"}var i=this.edit_view_tab?this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text():"";i=i.replace(/\/|\s+/g,""),this.current_edit_record&&this.current_edit_record.id?(t?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&a="+t+"&id="+this.current_edit_record.id+"&t="+e+"&tab="+i):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&id="+this.current_edit_record.id+"&t="+e),Global.trackView()):t?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&a="+t+"&t="+e+"&tab="+i):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&user_id="+this.getSelectEmployee()+"&show_wage="+this.wage_btn.getValue(!0)+"&mode="+this.toggle_button.getValue()+"&t="+e)}onCustomContextClick(e){switch(e){case ContextMenuIconName.add:case ContextMenuIconName.add_punch:this.absence_model=!1,this.onAddClick();break;case ContextMenuIconName.add_absence:this.absence_model=!0,this.onAddClick();break;case ContextMenuIconName.move:case ContextMenuIconName.drag_copy:this.setMoveOrDropMode(e);break;case ContextMenuIconName.in_out:case ContextMenuIconName.schedule:case ContextMenuIconName.pay_stub:case ContextMenuIconName.edit_employee:case ContextMenuIconName.edit_pay_period:this.onNavigationClick(e);break;case ContextMenuIconName.re_calculate_timesheet:case ContextMenuIconName.generate_pay_stub:this.onWizardClick(e);break;case ContextMenuIconName.map:this.onMapClick(e);break;case ContextMenuIconName.accumulated_time:this.onAccumulatedTimeClick(e);break;case"AddRequest":this.select_cells_Array.length>0&&this.addRequestFromTimesheetCell(e)}}addRequestFromTimesheetCell(e){if(Global.getProductEdition()<=10)return TAlertManager.showAlert(Global.getUpgradeMessage()),!1;var t=Global.strToDate(this.select_cells_Array[0].date?this.select_cells_Array[0].date:this.start_date_picker.getValue()).format(this.full_format);if(this.select_cells_Array[0].punch)var i=this.select_cells_Array[0].punch.punch_control_id,a=this.select_cells_Array[0].punch.id,s=this.select_cells_Array[0].punch.status_id,r=this.select_cells_Array[0].punch.type_id,l=this.select_cells_Array[0].punch.user_id;else l=this.getSelectEmployee(),i=null,a=null,s=10,r=10;var n=null;a||(this.select_cells_Array[0].row_id>1&&this.timesheet_data_source[this.select_cells_Array[0].row_id-2]&&this.timesheet_data_source[this.select_cells_Array[0].row_id-2][t+"_data"]&&(n=this.timesheet_data_source[this.select_cells_Array[0].row_id-2][t+"_data"].id,r=this.timesheet_data_source[this.select_cells_Array[0].row_id-2][t+"_data"].type_id),this.timesheet_data_source[this.select_cells_Array[0].row_id-1]&&(s=this.timesheet_data_source[this.select_cells_Array[0].row_id-1].status_id));var d=this.select_cells_Array[0].time_stamp_num/1e3,o=this;this.api_punch.getRequestDefaultData(l,d,i,n,s,r,a,{onResult:function(e){var t=e.getResult();IndexViewController.openEditView(o,"Request",t,null,"openAddView")}})}getPayPeriod(e){var t=this.getSelectDate();return e&&(t=e),this.pay_period_map&&this.pay_period_map[t]&&this.pay_period_map[t]!=TTUUID.zero_id&&1==TTUUID.isUUID(this.pay_period_map[t])?this.pay_period_map[t]:null}onNavigationClick(e){var t;if(this.checkTimesheetData())switch(e){case ContextMenuIconName.in_out:IndexViewController.openEditView(LocalCacheData.current_open_primary_controller,"InOut");break;case ContextMenuIconName.edit_employee:IndexViewController.openEditView(this,"Employee",this.getSelectEmployee());break;case ContextMenuIconName.edit_pay_period:var i=this.getPayPeriod();i&&IndexViewController.openEditView(this,"PayPeriods",i);break;case ContextMenuIconName.schedule:var a={filter_data:{}},s={value:[this.getSelectEmployee()]};a.filter_data.include_user_ids=s,a.select_date=this.getSelectDate(),Global.addViewTab(this.viewId,$.i18n._("TimeSheet"),window.location.href),IndexViewController.goToView("Schedule",a);break;case ContextMenuIconName.pay_stub:a={filter_data:{}};var r={value:[this.getSelectEmployee()]};a.filter_data.user_id=r,Global.addViewTab(this.viewId,$.i18n._("TimeSheet"),window.location.href),IndexViewController.goToView("PayStub",a);break;case"print_summary":(a={time_period:{}}).time_period.time_period="custom_pay_period",a.time_period.pay_period_id=this.timesheet_verify_data.pay_period_id,a.include_user_id=[this.getSelectEmployee()],t={0:a,1:"pdf_timesheet"},this.doFormIFrameCall(t);break;case"print_detailed":(a={time_period:{}}).time_period.time_period="custom_pay_period",a.time_period.pay_period_id=this.timesheet_verify_data.pay_period_id,a.include_user_id=[this.getSelectEmployee()],t={0:a,1:"pdf_timesheet_detail"},this.doFormIFrameCall(t)}}doFormIFrameCall(e){Global.APIFileDownload("APITimesheetDetailReport","getTimesheetDetailReport",e)}onAccumulatedTimeClick(){if(PermissionManager.checkTopLevelPermission("AccumulatedTime")){var e=Global.strToDate(this.getSelectDate()).format("YYYY-MM-DD");IndexViewController.openEditView(this,"UserDateTotalParent",e)}}onMapClick(){if(Global.getProductEdition()>=15){var e={filter_columns:{id:!0,latitude:!0,longitude:!0,punch_date:!0,punch_time:!0,position_accuracy:!0,user_id:!0}},t=[],a={};if(this.edit_view)t.push(this.current_edit_record),this.is_viewing||(a.single_marker_draggable=!0);else if(this.select_punches_array&&this.select_punches_array.length>0){var s=[];this.select_punches_array.map((function(e){e.id&&s.push(e.id)})),e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),e.filter_data&&s.length>0&&(e.filter_data.id=s),e.filter_columns.first_name=!0,e.filter_columns.last_name=!0,e.filter_columns.user_id=!0,e.filter_columns.date_stamp=!0,e.filter_columns.punch_date=!0,e.filter_columns.punch_time=!0,e.filter_columns.time_stamp=!0,e.filter_columns.status=!0,e.filter_columns.punch_control_id=!0,e.filter_columns.branch=!0,e.filter_columns.branch_id=!0,e.filter_columns.department=!0,e.filter_columns.department_id=!0,e.filter_columns.job_manual_id=!0,e.filter_columns.job=!0,e.filter_columns.job_id=!0,e.filter_columns.job_item_manual_id=!0,e.filter_columns.job_item=!0,e.filter_columns.job_item_id=!0,e.filter_columns.total_time=!0,e.filter_columns.latitude=!0,e.filter_columns.longitude=!0,e.filter_columns.position_accuracy=!0,t=this.api.getPunch(e,{async:!1}).getResult()}this.is_mass_editing||(Global.isArray(t)?Promise.all([i.e("vendors-node_modules_leaflet-draw_dist_leaflet_draw_js-node_modules_leaflet_dist_leaflet-src_js"),i.e("vendors-node_modules_leaflet_dist_images_marker-icon-2x_png-node_modules_leaflet_dist_images_-e2a419"),i.e("interface_html5_framework_leaflet_leaflet-timetrex_js"),i.e("leaflet-timetrex")]).then(i.bind(i,6889)).then((e=>{var i=e.TTConvertMapData.processPunchesFromViewController(t,a);IndexViewController.openEditView(this,"Map",i)})).catch(Global.importErrorHandler):(Debug.Text("ERROR: Either punches is not an array, or data is empty","TimeSheetViewController.js","TimeSheetViewController","onMapClick",1),TAlertManager.showAlert($.i18n._("Selected punches no longer exist, unable to map."))))}}onWizardClick(e){var t=this;switch(e){case ContextMenuIconName.re_calculate_timesheet:var i={};i.user_id=this.getSelectEmployee();var a=this.getPayPeriod();a&&(i.pay_period_id=a),IndexViewController.openWizard("ReCalculateTimeSheetWizard",i,(function(){t.onReCalTimeSheetDone()}));break;case ContextMenuIconName.generate_pay_stub:(i={}).user_id=this.getSelectEmployee(),a=this.getPayPeriod(),i.pay_period_id=a?[a]:[],IndexViewController.openWizard("GeneratePayStubWizard",i,(function(){t.search()}))}}onReCalTimeSheetDone(){TopMenuManager.isCurrentView("TimeSheet")&&TopMenuManager.goToView("TimeSheet",!0)}setMoveOrDropMode(e){var t=$("#"+ContextMenuIconName.drag_copy),i=$("#"+ContextMenuIconName.move);t.removeClass("selected-menu"),i.removeClass("selected-menu");var a=!1,s=!1;this.copyPermissionValidate()||(a=!0),this.movePermissionValidate()||(s=!0),s&&e===ContextMenuIconName.move?t.addClass("selected-menu"):$("#"+e).addClass("selected-menu"),this.select_drag_menu_id=a&&s?null:e}getSelectDateArray(){for(var e=[],t=this.absence_model?this.absence_select_cells_Array:this.select_cells_Array,i=t.length,a={},s=0;s<i;s++){a[t[s].date]=!0}for(var r in a)e.push(r);return 0===e.length&&(e=[this.getSelectDate()]),e}onAddClick(e){TTPromise.add("TimeSheetViewController","addclick"),TTPromise.wait();var t=this;this.is_viewing=!1,this.is_mass_adding=!0,LocalCacheData.current_doing_context_action="new";var i,a=null,s=null,r=null,l=this.getSelectDate(),n=10,d=10;if(this.absence_model)e&&(l=this.current_edit_record.date_stamp),t.setDefaultMenu(),t.openEditView(),this.api_user_date_total["get"+this.api_user_date_total.key_name+"DefaultData"](this.getSelectEmployee(),l,{onResult:function(e){var i=e.getResult();Global.isSet(i.time_stamp)||(i.time_stamp=!1),Global.isSet(t.absence_select_cells_Array[0])&&(i.src_object_id=t.absence_select_cells_Array[0].src_object_id),i.object_type_id=50,i.date_stamp=t.getSelectDate(),t.current_edit_record=i,t.initEditView()}});else{if(1===this.select_cells_Array.length){var o=this.select_cells_Array[0];if(o.related_punch)r=o.related_punch,a=o.related_punch.punch_control_id,s=o.related_punch.id;else{var _=Global.strToDate(o.date?o.date:this.start_date_picker.getValue()).format(this.full_format);if(this.timesheet_data_source&&this.timesheet_data_source[o.row_id-2])var c=this.timesheet_data_source[o.row_id-2][_+"_data"];c&&(s=c.id)}}if(this.setDefaultMenu(),t.openEditView(),e&&(l=this.current_edit_record.punch_date,r=null,a=10==this.current_edit_record.status_id?this.current_edit_record.punch_control_id:null),1===this.select_cells_Array.length){n=(i=this.select_cells_Array[0]).status_id;var u=Global.strToDate(this.start_date_picker.getValue()),h=new Date(new Date(u.getTime()).setDate(u.getDate()-1));if(h.getTime()<this.start_date.getTime())d=10;else{var m=this.timesheet_data_source[i.row_id-1],p=m&&m[h.format(this.full_format)+"_data"];d=p?p.type_id:10}}else n=(i=this.select_cells_Array[0])&&i.status_id?i.status_id:10;this.api["get"+this.api.key_name+"DefaultData"](this.getSelectEmployee(),l,a,s,n,d,{onResult:function(i){var a=i.getResult();Global.isSet(a.time_stamp)||(a.time_stamp=!1),!t.is_mass_adding&&r?(a.punch_date=r.punch_date,a.punch_time=r.punch_time,10==r.status_id?a.status_id=20:a.status_id=10):a.punch_date=t.getSelectDate(),e&&(a.punch_date=t.current_edit_record.punch_date,10==t.current_edit_record.status_id?a.status_id=20:a.status_id=10),t.current_edit_record=a,t.initEditView()}})}}removeEditView(){super.removeEditView(),this.absence_select_cells_Array.length>0?this.absence_model=!0:this.absence_model=!1,this.setDefaultMenu()}isMassDate(){return!!(this.is_mass_adding&&this.current_edit_record&&this.current_edit_record.punch_dates&&this.current_edit_record.punch_dates.length>1)}setEditMenuSaveAndContinueIcon(e,t){this.saveAndContinueValidate(e,t),(this.is_mass_editing||this.is_viewing||this.isMassDate())&&e.addClass("disable-image")}onSaveAndNewClick(e){var t=this;Global.isSet(e)||(e=!1);var i=this.getCurrentAPI();LocalCacheData.current_doing_context_action="new";var a=this.current_edit_record;if(this.is_mass_adding){a=[];var s=this.current_edit_record.punch_dates;s&&s.indexOf(" - ")>0&&(s=this.parserDatesRange(s));for(var r=0;r<s.length;r++){var l=Global.clone(this.current_edit_record);delete l.punch_dates,this.absence_model?l.date_stamp=s[r]:l.punch_date=s[r],a.push(l)}}i.setIsIdempotent(!0),i["set"+i.key_name](a,!1,e,{onResult:function(e){e.isValid()?(t.search(!1),t.onAddClick(!0)):(t.setErrorMenu(),t.setErrorTips(e))}})}_continueDoCopyAsNew(){(LocalCacheData.current_doing_context_action="copy_as_new",this.is_mass_adding=!0,Global.isSet(this.edit_view))&&(this.current_edit_record.id="",this.absence_model||(this.current_edit_record.punch_control_id="",10==this.current_edit_record.status_id?this.current_edit_record.status_id=20:this.current_edit_record.status_id=10,this.edit_view_ui_dic.status_id.setValue(this.current_edit_record.status_id)),this.edit_view.find(".navigation-div").css("display","none"),this.openEditView(),this.initEditView(),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,ProgressBar.closeOverlay())}onSaveAndCopy(e){var t=this;Global.isSet(e)||(e=!1);var i=this.getCurrentAPI();this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var a=this.current_edit_record;if(this.is_mass_adding){a=[];var s=this.current_edit_record.punch_dates;s&&s.indexOf(" - ")>0&&(s=this.parserDatesRange(s));for(var r=0;r<s.length;r++){var l=Global.clone(this.current_edit_record);delete l.punch_dates,this.absence_model?l.date_stamp=s[r]:l.punch_date=s[r],a.push(l)}}this.clearNavigationData(),i.setIsIdempotent(!0),i["set"+i.key_name](a,!1,e,{onResult:function(e){if(e.isValid()){e.getResult();t.search(!1),t.onCopyAsNewClick()}else t.setErrorMenu(),t.setErrorTips(e)}})}getCurrentAPI(){var e=this.api;return this.absence_model&&(e=this.api_user_date_total),e}generateManualTimeSheetRecordKey(e){return e.date_stamp+"-"+(this.show_branch_ui&&e.branch_id?e.branch_id:TTUUID.zero_id)+"-"+(this.show_department_ui&&e.department_id?e.department_id:TTUUID.zero_id)+"-"+(this.show_job_ui&&e.job_id&&Global.getProductEdition()>=20?e.job_id:TTUUID.zero_id)+"-"+(this.show_job_item_ui&&e.job_item_id&&Global.getProductEdition()>=20?e.job_item_id:TTUUID.zero_id)+"-"+e.total_time}createCurrentManualGridRecordsMap(e){this.manual_grid_records_map={};for(var t=0,i=e.length;t<i;t++){var a=e[t],s=this.generateManualTimeSheetRecordKey(a);a.id&&(s=a.id+"-"+s),this.manual_grid_records_map[s]=a.row,delete a.row}}filterManualGridRecords(e){for(var t=Array(),i=0;i<e.length;i++){var a=e[i];(a.id||!a.id&&a.total_time&&0!=a.total_time)&&t.push(a)}return t}onSaveClick(e){var t,i=this;if("manual"!==this.getPunchMode()||this.edit_view){Global.isSet(e)||(e=!1),LocalCacheData.current_doing_context_action="save";var a=this.getCurrentAPI();if(this.is_mass_editing){var s={};for(var r in this.edit_view_ui_dic){var l=this.edit_view_ui_dic[r];Global.isSet(l.isChecked)&&l.isChecked()&&(s[r]=this.current_edit_record[r])}t=[],$.each(this.mass_edit_record_ids,(function(e,i){var a=Global.clone(s);a.id=i,t.push(a)}))}else t=this.current_edit_record;if(this.is_mass_adding&&this.current_edit_record){t=[];var n=this.current_edit_record.punch_dates;n&&n.indexOf(" - ")>0&&(n=this.parserDatesRange(n));for(var d=0;d<n.length;d++){var o=Global.clone(this.current_edit_record);delete o.punch_dates,this.absence_model?o.date_stamp=n[d]:o.punch_date=n[d],t.push(o)}}a.setIsIdempotent(!0),a["set"+a.key_name](t,!1,e,{onResult:function(e){e.isValid()?(i.first_build=!0,i.search(),i.removeEditView(),i.previous_absence_policy_id=!1):(i.setErrorMenu(),i.setErrorTips(e))}})}else{var _=this.editor.getValue(!0);_.length>0?(this.wait_auto_save&&clearTimeout(this.wait_auto_save),this.createCurrentManualGridRecordsMap(_),ProgressBar.noProgressForNextCall(),this.is_saving_manual_grid=!0,this.setDefaultMenu(),(_=this.filterManualGridRecords(_)).length>0?this.api_user_date_total["set"+this.api_user_date_total.key_name](_,{onResult:function(e){e.isValid()||TAlertManager.showErrorAlert(e),i.updateManualGrid()}}):i.updateManualGrid(),ProgressBar.showNanobar(),ProgressBar.closeOverlay()):ProgressBar.closeOverlay()}}onMapSaveClick(e,t){this.savePunchPosition(e,t)}savePunchPosition(e,t){return e&&1===e.length?(this.setLocationValue(e[0]),t(),this.is_changed=!0,!0):(Debug.Text("ERROR: Invalid params/data passed to function.","TimesheetViewConroller.js","TimesheetViewConroller","savePunchPosition",1),!1)}getOtherFieldTypeId(){var e=15;return this.absence_model&&(e=0),e}setEditViewData(){var e=this,t=this.edit_view.find(".navigation-div"),i=t.find(".navigation-widget-div");for(var a in this.is_changed=!1,Global.isSet(this.current_edit_record.id)&&this.current_edit_record.id?(t.css("display","block"),this.navigation=Global.loadWidgetByName(FormItemType.AWESOME_BOX),this.absence_model?(this.navigation.AComboBox({id:this.script_name+"_navigation",layout_name:"global_absence"}),this.absence_original_source&&(this.navigation.setSourceData(this.absence_original_source),this.navigation.is_punch_nav=!1)):(this.navigation.AComboBox({id:this.script_name+"_navigation",layout_name:"global_timesheet"}),this.full_timesheet_data&&(this.navigation.setSourceData(this.full_timesheet_data.punch_data),this.navigation.is_punch_nav=!0)),this.navigation.setValue(this.current_edit_record),i.html(this.navigation),this.setNavigation()):t.css("display","none"),this.edit_view_ui_dic)Global.isSet(e.current_edit_record[a])||this.is_mass_editing||(e.current_edit_record[a]=!1);if(this.is_mass_editing){for(var a in this.edit_view_ui_dic){var s=this.edit_view_ui_dic[a];Global.isSet(s.setMassEditMode)&&s.setMassEditMode(!0)}$.each(this.unique_columns,(function(t,i){Global.isSet(e.edit_view_ui_dic[i])&&Global.isSet(e.edit_view_ui_dic[i].setEnabled)&&e.edit_view_ui_dic[i].setEnabled(!1)}))}this.setNavigationArrowsStatus(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none"),this.initTabData(),this.switchToProperTab()}setCurrentEditRecordData(){var e,t=this.edit_view.find("a[ref=tab_punch]");for(var i in this.absence_model?t.text($.i18n._("Absence")):t.text($.i18n._("Punch")),this.current_edit_record.user_id=this.getSelectEmployee(),this.current_edit_record)if(this.current_edit_record.hasOwnProperty(i)){var a,s=this.edit_view_ui_dic[i];if(Global.isSet(s))switch(i){case"punch_dates":var r;this.current_edit_record.punch_dates?r=this.current_edit_record.punch_dates:(r=this.getSelectDateArray(),this.current_edit_record.punch_dates=r),s.setValue(r);break;case"first_last_name":var l=this.getSelectEmployee(!0);l&&s.setValue(l.first_name+" "+l.last_name);break;case"total_time":if(this.absence_model){var n=Global.getTimeUnit(this.current_edit_record[i]);s.setValue(n)}break;case"station_id":this.current_edit_record[i]?this.setStation():(s.setValue("N/A"),s.css("cursor","default"));break;case"punch_image":this.edit_view_form_item_dic.station_id;this.current_edit_record.has_image?(this.attachElement("punch_image"),s.setValue(ServiceCaller.getURLByObjectType("file_download")+"&object_type=punch_image&parent_id="+this.current_edit_record.user_id+"&object_id="+this.current_edit_record.id)):this.detachElement("punch_image");break;case"job_id":Global.getProductEdition()>=20&&((a={}).filter_data={status_id:10,user_id:this.current_edit_record.user_id},s.setDefaultArgs(a),s.setValue(this.current_edit_record[i]));break;case"job_item_id":Global.getProductEdition()>=20&&((a={}).filter_data={status_id:10,job_id:this.current_edit_record.job_id},s.setDefaultArgs(a),s.setValue(this.current_edit_record[i]));break;case"job_quick_search":case"job_item_quick_search":break;case"latitude":case"longitude":case"position_accuracy":break;default:s.setValue(this.current_edit_record[i])}}this.absence_model&&this.current_edit_record.id?this.pre_total_time=this.current_edit_record.total_time:this.pre_total_time=0,this.current_edit_record.id&&(e=this.current_edit_record.actual_time_stamp?$.i18n._("Actual Time")+": "+this.current_edit_record.actual_time_stamp:"N/A"),this.setLocationValue(this.current_edit_record),this.actual_time_label.text(e),this.onAvailableBalanceChange(),this.setEditMenu(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),1!=this.is_viewing||0!=this.current_edit_record.latitude&&0!=this.current_edit_record.longitude?this.show_location_ui&&$(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").show():$(".widget-h-box-mapLocationWrapper").parents(".edit-view-form-item-div").hide()}setLocationValue(e){Global.getProductEdition()>=15&&this.edit_view_ui_dic.latitude&&this.edit_view_ui_dic.longitude&&this.edit_view_ui_dic.position_accuracy&&(e&&(this.current_edit_record.latitude=e.latitude,this.current_edit_record.longitude=e.longitude,this.current_edit_record.position_accuracy=e.position_accuracy),this.edit_view_ui_dic.latitude.setValue(this.current_edit_record.latitude),this.edit_view_ui_dic.longitude.setValue(this.current_edit_record.longitude),this.edit_view_ui_dic.position_accuracy.setValue(this.current_edit_record.position_accuracy?this.current_edit_record.position_accuracy:0),this.current_edit_record.latitude||this.is_mass_editing?this.show_location_ui&&this.location_wrapper.show():this.location_wrapper.hide())}onAvailableBalanceChange(){this.current_edit_record.hasOwnProperty("src_object_id")&&this.current_edit_record.src_object_id&&!this.is_mass_editing?this.getAvailableBalance():this.detachElement("available_balance"),this.editFieldResize()}getAvailableBalance(){var e=this;if(0==this.previous_absence_policy_id&&(this.previous_absence_policy_id=this.current_edit_record.src_object_id),this.absence_model){var t=this.current_edit_record.date_stamp,i=this.current_edit_record.total_time;this.is_mass_adding&&((t=this.current_edit_record.punch_dates)&&t.indexOf(" - ")>0||"array"===$.type(t))&&(t.indexOf(" - ")>0&&(t=this.parserDatesRange(t)),t.length>0&&(i*=t.length,t=t[t.length-1])),this.api_absence_policy.getProjectedAbsencePolicyBalance(this.current_edit_record.src_object_id,this.getSelectEmployee(),t,i,this.pre_total_time,this.previous_absence_policy_id,{onResult:function(i){e.getBalanceHandler(i,t)}})}}setStation(){var e=this,t={filter_data:{id:this.current_edit_record.station_id}};this.api_station.getStation(t,{onResult:function(t){e.station=t.getResult()[0];var i=e.edit_view_ui_dic.station_id;e.station?(i&&i.setValue(e.station.type+"-"+e.station.description),PermissionManager.validate("station","view")||PermissionManager.validate("station","view_child")&&e.station.is_child||PermissionManager.validate("station","view_own")&&e.station.is_owner?e.show_station_ui=!0:e.show_station_ui=!1,e.show_station_ui&&i&&i.css("cursor","pointer")):i&&i.setValue("N/A")}})}getSelectedItems(){return this.edit_view?[this.current_edit_record]:this.select_punches_array.length>0?this.select_punches_array:[]}getSelectedItem(){var e=null;return e=this.edit_view?this.current_edit_record:this.select_punches_array.length>0?this.select_punches_array[0]:null,Global.clone(e)}addPermissionValidate(e){return Global.isSet(e)||(e=this.permission_id),"report"===e||!(!PermissionManager.validate(e,"add")||!this.editPermissionValidate(e))}setDefaultMenu(e){if(this.context_menu_array){if(0==LocalCacheData.isLocalCacheExists("current_company"))return!1;for(var t=this.context_menu_array.length,i=this.select_punches_array.length,a=this.absence_model?"absence":"punch",s=0;s<t;s++){var r=$(this.context_menu_array[s]),l=$(r.find(".ribbon-sub-menu-icon")).attr("id");switch(r.removeClass("disable-image"),r.removeClass("invisible-image"),l){case ContextMenuIconName.add:case ContextMenuIconName.add_punch:this.setDefaultMenuAddIcon(r,i);break;case ContextMenuIconName.add_absence:this.setDefaultMenuAddIcon(r,i,"absence");break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(r,i,a);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(r,i,a);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(r,i,a);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(r,i,a);break;case ContextMenuIconName.drag_copy:this.setDefaultMenuDragCopyIcon(r,i,a);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(r,i,a);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(r,i,a);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(r,i,a);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(r,i,a);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(r,i,a);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(r,i,a);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(r,i,a);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(r,i,a);break;case ContextMenuIconName.move:this.movePermissionValidate(a)||r.addClass("invisible-image"),"manual"==this.getPunchMode()?r.addClass("disable-image"):r.removeClass("disable-image");break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(r,i);break;case ContextMenuIconName.edit_pay_period:this.setDefaultMenuEditPayPeriodIcon(r,i,a);break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(r,i,a);break;case ContextMenuIconName.print:this.setDefaultMenuPrintIcon(r,i);break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditEmployeeIcon(r,i);break;case ContextMenuIconName.pay_stub:this.setDefaultMenuPayStubIcon(r,i);break;case ContextMenuIconName.re_calculate_timesheet:this.setDefaultMenuReCalculateTimesheet(r,i);break;case ContextMenuIconName.generate_pay_stub:this.setDefaultMenuGeneratePayStubIcon(r,i);break;case ContextMenuIconName.schedule:this.setDefaultMenuScheduleIcon(r,i);break;case ContextMenuIconName.accumulated_time:this.setDefaultMenuAccumulatedTimeIcon(r);break;case"AddRequest":this.setAddRequestIcon(r)}}this.setContextMenuGroupVisibility()}}setEditMenuDragCopyIcon(e,t,i){this.copyPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),"manual"==this.getPunchMode()?e.addClass("disable-image"):e.removeClass("disable-image")}setDefaultMenuDragCopyIcon(e,t,i){this.copyPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),"manual"==this.getPunchMode()?e.addClass("disable-image"):e.removeClass("disable-image")}setDefaultMenuScheduleIcon(e,t,i){PermissionManager.checkTopLevelPermission("Schedule")&&!this.edit_only_mode||e.addClass("invisible-image")}reCalculateEditPermissionValidate(){var e=this.permission_id;if(PermissionManager.validate(e,"edit")||this.ownerOrChildPermissionValidate(e,"edit_child"))return!0}setDefaultMenuReCalculateTimesheet(e,t,i){this.reCalculateEditPermissionValidate()||e.addClass("invisible-image")}setDefaultMenuGeneratePayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||e.addClass("invisible-image")}setDefaultMenuPayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("PayStub")||e.addClass("invisible-image")}setDefaultMenuEditPayPeriodIcon(e,t,i){this.editPermissionValidate("pay_period_schedule")||e.addClass("invisible-image");e.addClass("disable-image"),this.getPayPeriod()&&e.removeClass("disable-image")}setDefaultMenuAccumulatedTimeIcon(e,t){PermissionManager.checkTopLevelPermission("AccumulatedTime")&&!this.edit_only_mode||e.addClass("invisible-image")}setDefaultMenuEditEmployeeIcon(e,t,i){this.editChildPermissionValidate("user")||e.addClass("invisible-image")}editOwnerOrChildPermissionValidate(e,t){return e||(e=this.permission_id),t||(t=this.getSelectEmployee(!0)),"report"===e||!!(PermissionManager.validate(e,"edit")||t&&t.is_owner&&PermissionManager.validate(e,"edit_own")||t&&t.is_child&&PermissionManager.validate(e,"edit_child"))}viewOwnerOrChildPermissionValidate(e,t){return e||(e=this.permission_id),"report"===e||(t||(t=this.getSelectEmployee(!0)),!!(PermissionManager.validate(e,"view")||t&&t.is_owner&&PermissionManager.validate(e,"view_own")||t&&t.is_child&&PermissionManager.validate(e,"view_child")))}deleteOwnerOrChildPermissionValidate(e,t){return e||(e=this.permission_id),t||(t=this.getSelectEmployee(!0)),"report"===e||!!(PermissionManager.validate(e,"delete")||t&&t.is_owner&&PermissionManager.validate(e,"delete_own")||t&&t.is_child&&PermissionManager.validate(e,"delete_child"))}editChildPermissionValidate(e,t){return Global.isSet(e)||(e=this.permission_id),Global.isSet(t)||(t=this.getSelectEmployee(!0)),"report"===e||!!PermissionManager.validate(e,"enabled")&&!(!PermissionManager.validate(e,"edit")&&!this.ownerOrChildPermissionValidate(e,"edit_child",t))}onReportMenuClick(e){this.onNavigationClick(e)}setDefaultMenuPrintIcon(e,t,i){e.removeClass("disable-image")}setEditMenuMapIcon(e,t){super.setDefaultMenuMapIcon(e),0==e.hasClass("disable-image")&&(this.absence_model||"manual"==this.getPunchMode())&&e.addClass("disable-image")}setEditMenuSaveAndAddIcon(e,t){this.saveAndNewValidate(e,t),(this.is_viewing||this.is_mass_editing)&&e.addClass("disable-image")}setDefaultMenuMapIcon(e,t,i){super.setDefaultMenuMapIcon(e),0==e.hasClass("disable-image")&&(this.absence_model||"manual"==this.getPunchMode())&&e.addClass("disable-image")}setEditMenuSaveAndNextIcon(e,t){this.editPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&!this.is_viewing&&!this.is_mass_adding||e.addClass("disable-image")}setEditMenuSaveAndCopyIcon(e,t){this.saveAndNewValidate(e,t),(this.is_viewing||this.is_mass_editing)&&e.addClass("disable-image")}setEditMenuCopyAndAddIcon(e,t){this.addPermissionValidate(t)||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&!this.is_viewing&&!this.is_mass_adding||e.addClass("disable-image")}setEditMenu(){for(var e=this.context_menu_array.length,t=this.absence_model?"absence":"punch",i=0;i<e;i++){var a=$(this.context_menu_array[i]),s=$(a.find(".ribbon-sub-menu-icon")).attr("id");if(a.removeClass("disable-image"),this.is_mass_editing)switch(s){case ContextMenuIconName.save:this.setEditMenuSaveIcon(a);break;case ContextMenuIconName.cancel:break;default:a.addClass("disable-image")}else switch(s){case ContextMenuIconName.add:case ContextMenuIconName.add_punch:this.setEditMenuAddIcon(a);break;case ContextMenuIconName.add_absence:this.setEditMenuAddIcon(a,t);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(a,t);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(a,t);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(a,t);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(a,t);break;case ContextMenuIconName.drag_copy:this.setEditMenuDragCopyIcon(a,t);break;case ContextMenuIconName.move:this.movePermissionValidate(t)||a.addClass("invisible-image");break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(a,t);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(a,t);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(a,t);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(a,t);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(a,t);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(a,t);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(a,t);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(a,t);break;case ContextMenuIconName.map:this.setEditMenuMapIcon(a,t);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.accumulated_time:this.setDefaultMenuAccumulatedTimeIcon(a);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(a);break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditEmployeeIcon(a);break;case ContextMenuIconName.edit_pay_period:this.setDefaultMenuEditPayPeriodIcon(a);break;case ContextMenuIconName.re_calculate_timesheet:this.setDefaultMenuReCalculateTimesheet(a);break;case ContextMenuIconName.generate_pay_stub:this.setDefaultMenuGeneratePayStubIcon(a);break;case"AddRequest":this.setAddRequestIcon(a)}}this.setMoveOrDropMode(ContextMenuIconName.move),this.setContextMenuGroupVisibility()}enableAddRequestButton(){return 1==this.select_cells_Array.length}cleanWhenUnloadView(e){$("#timesheet_view_container").remove(),super.cleanWhenUnloadView(e)}setAddRequestIcon(e,t,i){(Global.getProductEdition()<=10||!this.addPermissionValidate("request")||this.edit_only_mode)&&e.addClass("invisible-image"),!0===this.enableAddRequestButton()?e.removeClass("disable-image"):e.addClass("disable-image")}userValueSet(e){void 0===e&&(this.employee_nav.setValue(LocalCacheData.getLoginUser()),Debug.Text("ERROR: Invalid User ID in URL. Switching to current User ID.","TimesheetViewConroller.js","TimesheetViewConroller","userValueSet",10))}}s.PUNCH_ROW=1,s.EXCEPTION_ROW=2,s.REQUEST_ROW=3,s.TOTAL_ROW=4,s.REGULAR_ROW=5,s.ABSENCE_ROW=6,s.ACCUMULATED_TIME_ROW=7,s.PREMIUM_ROW=8}}]);
//# sourceMappingURL=attendance-timesheet-TimeSheetViewController.bundle.js.map?v=22d6176f94c46996d366