(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["my_account-timesheet_authorization-TimeSheetAuthorizationViewController"],{8121:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"TimeSheetAuthorizationViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#timesheet_authorization_view_container",type_array:null,hierarchy_level_array:null,messages:null,message_control_api:null,authorization_api:null,request_api:null}),super(e)}init(e){this.edit_view_tpl="TimeSheetAuthorizationEditView.html",this.permission_id="punch",this.viewId="TimeSheetAuthorization",this.script_name="TimeSheetAuthorizationView",this.table_name_key="pay_period_time_sheet_verify",this.context_menu_name=$.i18n._("TimeSheet (Authorizations)"),this.navigation_label=$.i18n._("TimeSheet")+":",this.api=TTAPI.APIPayPeriodTimeSheetVerify,this.request_api=TTAPI.APIRequest,this.message_control_api=TTAPI.APIMessageControl,this.authorization_api=TTAPI.APIAuthorization,this.render(),this.buildContextMenu(!0),this.initData(),this.setSelectRibbonMenuIfNecessary(),this.hierarchy_type_id=90}initOptions(){var e=this,t=this.request_api.getHierarchyLevelOptions([-1],{async:!1}).getResult();e.hierarchy_level_array=Global.buildRecordArray(t),Global.isSet(e.basic_search_field_ui_dic.hierarchy_level)&&e.basic_search_field_ui_dic.hierarchy_level.setSourceData(Global.buildRecordArray(t))}search(e,t,i,a){this.refresh_id=null,super.search(e,t,i,a)}processResultData(e){for(var t=e.length,i=0;i<t;i++){var a=e[i];a.id==TTUUID.not_exist_id&&(a.id=a.user_id+"_"+a.pay_period_id)}return e}parseToRecordId(e,t){return!!e&&((e=e.toString()).indexOf("_")>0?t>=0?e.split("_")[t]:TTUUID.not_exist_id:e)}getCustomContextMenuModel(){return{groups:{action:{label:$.i18n._("Action"),id:this.script_name+"action"},authorization:{label:$.i18n._("Authorization"),id:this.script_name+"authorization"},objects:{label:$.i18n._("Objects"),id:this.script_name+"objects"}},exclude:["default"],include:[{label:$.i18n._("View"),id:ContextMenuIconName.view,group:"action",icon:Icons.view},{label:$.i18n._("Cancel"),id:ContextMenuIconName.cancel,group:"action",icon:Icons.cancel},{label:$.i18n._("Authorize"),id:ContextMenuIconName.authorization,group:"authorization",icon:Icons.authorization},{label:$.i18n._("Pass"),id:ContextMenuIconName.pass,group:"authorization",icon:Icons.pass},{label:$.i18n._("Decline"),id:ContextMenuIconName.decline,group:"authorization",icon:Icons.decline},{label:$.i18n._("Request<br>Authorizations"),id:ContextMenuIconName.authorization_request,group:"objects",icon:Icons.authorization_request,permission_result:PermissionManager.checkTopLevelPermission("RequestAuthorization")},{label:$.i18n._("TimeSheet<br>Authorizations"),id:ContextMenuIconName.authorization_timesheet,group:"objects",icon:Icons.authorization_timesheet,selected:!0,permission_result:PermissionManager.checkTopLevelPermission("TimeSheetAuthorization")},{label:$.i18n._("Expense<br>Authorizations"),id:ContextMenuIconName.authorization_expense,group:"objects",icon:Icons.authorization_expense,selected:!1,permission_result:PermissionManager.checkTopLevelPermission("ExpenseAuthorization")},{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Schedule"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Export"),id:ContextMenuIconName.export_excel,group:"other",icon:Icons.export_excel,sort_order:9e3}]}}setDefaultMenuViewIcon(e,t,i){this.viewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuEditIcon(e,t,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),1===t&&this.editOwnerOrChildPermissionValidate(i)&&this.parseToRecordId(this.getGridSelectIdArray()[0])!==TTUUID.not_exist_id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuEditIcon(e,t){this.editPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),this.is_viewing&&this.editOwnerOrChildPermissionValidate(t)&&this.parseToRecordId(this.current_edit_record.id)!==TTUUID.not_exist_id||e.addClass("disable-image")}getFilterColumnsFromDisplayColumns(){var e=[];this.grid&&(e=this.grid.getGridParam("colModel"));var t={is_owner:!0,id:!0,user_id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,start_date:!0,end_date:!0,pay_period_id:!0};if(e)for(var i=e.length,a=0;a<i;a++){t[e[a].name]=!0}return t}setDefaultMenuAuthorizationExpenseIcon(e,t,i){Global.getProductEdition()>=25||e.addClass("invisible-image"),e.removeClass("disable-image")}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var o=$(this.context_menu_array[a]),r=$(o.find(".ribbon-sub-menu-icon")).attr("id");switch(o.removeClass("invisible-image"),o.removeClass("disable-image"),r){case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(o,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(o,i);break;case ContextMenuIconName.send:this.setDefaultMenuSaveIcon(o,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(o,i);break;case ContextMenuIconName.authorization:this.setDefaultMenuAuthorizationIcon(o,i);break;case ContextMenuIconName.pass:this.setDefaultMenuPassIcon(o,i);break;case ContextMenuIconName.decline:this.setDefaultMenuDeclineIcon(o,i);break;case ContextMenuIconName.authorization_request:this.setDefaultMenuAuthorizationRequestIcon(o,i);break;case ContextMenuIconName.authorization_timesheet:this.setDefaultMenuAuthorizationTimesheetIcon(o,i);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(o,i,"punch");break;case ContextMenuIconName.schedule:this.setDefaultMenuViewIcon(o,i,"schedule");break;case ContextMenuIconName.edit_employee:this.setDefaultMenuViewIcon(o,i,"user");break;case ContextMenuIconName.authorization_expense:this.setDefaultMenuAuthorizationExpenseIcon(o,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(o,i)}}this.setContextMenuGroupVisibility()}}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");switch(i.removeClass("disable-image"),a){case ContextMenuIconName.edit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(i);break;case ContextMenuIconName.send:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.authorization:this.setEditMenuAuthorizationIcon(i);break;case ContextMenuIconName.pass:this.setEditMenuPassIcon(i);break;case ContextMenuIconName.decline:this.setEditMenuDeclineIcon(i);break;case ContextMenuIconName.authorization_request:this.setEditMenuAuthorizationRequestIcon(i);break;case ContextMenuIconName.authorization_timesheet:this.setEditMenuAuthorizationTimesheetIcon(i);break;case ContextMenuIconName.timesheet:this.setEditMenuNavViewIcon(i,"punch");break;case ContextMenuIconName.schedule:this.setEditMenuNavViewIcon(i,"schedule");break;case ContextMenuIconName.edit_employee:this.setEditMenuNavEditIcon(i,"user");break;case ContextMenuIconName.authorization_expense:this.setEditMenuAuthorizationExpenseIcon(i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}setEditMenuAuthorizationExpenseIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.send:this.onSaveClick();break;case ContextMenuIconName.authorization:this.onAuthorizationClick();break;case ContextMenuIconName.pass:this.onPassClick();break;case ContextMenuIconName.decline:this.onDeclineClick();break;case ContextMenuIconName.authorization_request:this.onAuthorizationRequestClick();break;case ContextMenuIconName.authorization_timesheet:break;case ContextMenuIconName.authorization_expense:this.onAuthorizationExpenseClick();break;case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.edit_employee:case ContextMenuIconName.export_excel:this.onNavigationClick(e)}}onAuthorizationExpenseClick(){IndexViewController.goToView("ExpenseAuthorization")}onNavigationClick(e){var t,i,a=this,o={},r=[],s=[];switch(a.edit_view&&a.current_edit_record.id?(r.push(a.current_edit_record.id),s.push(a.current_edit_record.user_id),i=a.current_edit_record.start_date):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var o=a.getRecordFromGridById(t);r.push(o.id),s.push(o.user_id),i=o.start_date}))),i=i?Global.strToDateTime(i).format():(new Date).format(),e){case ContextMenuIconName.edit_employee:s.length>0&&IndexViewController.openEditView(this,"Employee",s[0]);break;case ContextMenuIconName.timesheet:s.length>0&&(o.user_id=s[0],o.base_date=i,Global.addViewTab(a.viewId,$.i18n._("Authorization - TimeSheet"),window.location.href),IndexViewController.goToView("TimeSheet",o));break;case ContextMenuIconName.schedule:o.filter_data={};var n={value:s};o.filter_data.include_user_ids=n,o.select_date=i,Global.addViewTab(this.viewId,$.i18n._("Authorization - TimeSheet"),window.location.href),IndexViewController.goToView("Schedule",o);break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name)}}onSaveClick(e){if(Global.isSet(e)||(e=!1),this.is_edit){var t=this,i={};this.is_add=!1,i=this.uniformVariable(i),this.message_control_api.setMessageControl(i,!1,e,{onResult:function(e){t.onSaveResult(e)}})}}onSaveResult(e){var t,i=this;e.isValid()?(t=i.current_edit_record.id,i.onViewClick(t,!0)):(i.setErrorMenu(),i.setErrorTips(e))}validate(){var e=this,t=this.current_edit_record;t=this.uniformVariable(t),this.message_control_api["validate"+this.message_control_api.key_name](t,{onResult:function(t){e.validateResult(t)}})}onAuthorizationClick(){var e=this,t={authorized:!0};this.parseToRecordId(e.current_edit_record.id)==TTUUID.not_exist_id?(t.object_id=TTUUID.not_exist_id,t.user_id=e.current_edit_record.user_id,t.pay_period_id=e.current_edit_record.pay_period_id):t.object_id=e.current_edit_record.id,t.object_type_id=90,e.authorization_api.setAuthorization([t],{onResult:function(t){t.isValid()?e.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Authorize"})})):TAlertManager.showErrorAlert(t)}})}onPassClick(){var e=this;this.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Pass"})}))}onAuthorizationRequestClick(){IndexViewController.goToView("RequestAuthorization")}onCancelClick(e,t,i){var a=this;super.onCancelClick(e,t,(function(){i&&i(),a.search()}))}onDeclineClick(){var e=this,t={authorized:!1};this.parseToRecordId(e.current_edit_record.id)==TTUUID.not_exist_id?(t.object_id=TTUUID.not_exist_id,t.user_id=e.current_edit_record.user_id,t.pay_period_id=e.current_edit_record.pay_period_id):t.object_id=e.current_edit_record.id,t.object_type_id=90,e.authorization_api.setAuthorization([t],{onResult:function(t){t.isValid()?e.onRightArrowClick((function(){e.search(),$().TFeedback({source:"Decline"})})):TAlertManager.showErrorAlert(t)}})}onAuthorizationTimesheetClick(){this.search(!1)}uniformVariable(e){var t={};return this.is_edit&&null!=this.current_edit_record?(t.body=this.current_edit_record.body,t.from_user_id=this.current_edit_record.user_id,t.to_user_id=this.current_edit_record.user_id,t.object_id=this.current_edit_record.id,t.object_type_id=90,Global.isFalseOrNull(this.current_edit_record.subject)?t.subject=this.edit_view_ui_dic.subject.getValue():t.subject=this.current_edit_record.subject,t):(e.id=this.parseToRecordId(e.id),e)}getAPIFilters(){var e=this.getCurrentSelectedRecord(),t={filter_data:{}};return this.parseToRecordId(e)!=TTUUID.not_exist_id?t.filter_data.id=[e]:(t.filter_data.user_id=this.parseToRecordId(e,0),t.filter_data.pay_period_id=this.parseToRecordId(e,1)),t}handleViewAPICallbackResult(e){var t=e.getResult();this.getCurrentSelectedRecord();return(t=this.processResultData(t))||(t=[]),t=t[0],super.handleViewAPICallbackResult(t)}doViewClickResult(e){super.doViewClickResult(e),AuthorizationHistory.init(this)}onGridDblClickRow(){ProgressBar.showOverlay(),this.onViewClick()}setEditMenuViewIcon(e,t){e.addClass("disable-image")}setEditMenuAuthorizationIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuPassIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuDeclineIcon(e,t){this.is_edit?e.addClass("disable-image"):e.removeClass("disable-image")}setEditMenuAuthorizationRequestIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuAuthorizationTimesheetIcon(e,t){this.current_edit_record&&this.current_edit_record.id?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuSaveIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuAuthorizationIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuPassIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuDeclineIcon(e,t,i){e.addClass("disable-image")}setDefaultMenuAuthorizationRequestIcon(e,t,i){e.removeClass("disable-image")}setDefaultMenuAuthorizationTimesheetIcon(e,t,i){e.removeClass("disable-image")}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Hierarchy Level"),in_column:1,multiple:!1,set_any:!1,field:"hierarchy_level",basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}onEditClick(e,t){this.is_viewing=!1,this.is_edit=!0,this.is_add=!1,LocalCacheData.current_doing_context_action="edit",this.openEditView(),this.initEditView()}getSubViewFilter(e){return 0===e.length&&(e={}),Global.isSet(e.hierarchy_level)||(e.hierarchy_level=1,this.filter_data.hierarchy_level={field:"hierarchy_level",id:"",value:this.basic_search_field_ui_dic.hierarchy_level.getValue(!0)}),e}buildEditViewUI(){super.buildEditViewUI();var e={"tab_timesheet_verification":{"label":$.i18n._("Message")}};this.setTabModel(e),this.navigation=null;var t=this.edit_view_tab.find("#tab_timesheet_verification"),i=t.find(".first-column"),a=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(i);var o=Global.loadWidgetByName(FormItemType.TEXT_INPUT);o.TTextInput({field:"subject",width:359}),this.addEditFieldToColumn($.i18n._("Subject"),o,i,""),(o=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"body",width:600,height:400}),this.addEditFieldToColumn($.i18n._("Body"),o,i,"",null,null,!0),a.css("display","none")}needShowNavigation(){return!!(this.is_viewing&&this.current_edit_record&&Global.isSet(this.current_edit_record.id)&&this.current_edit_record.id)}buildViewUI(){var e=this.navigation&&this.navigation.getPagerData&&this.navigation.getPagerData(),t=this.navigation&&this.navigation.getSourceData&&this.navigation.getSourceData();super.buildEditViewUI();var i={"tab_timesheet_verification":{"label":$.i18n._("TimeSheet Verification")}};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIPayPeriodTimeSheetVerify,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_Pay_period",navigation_mode:!0,show_search_inputs:!0,extendDataProcessWhenSearch:this.processResultData}),this.setNavigation(),e&&t&&(this.navigation.setSourceData(t),this.navigation.setPagerData(e));var a=this.edit_view_tab.find("#tab_timesheet_verification"),o=a.find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(o);var r=Global.loadWidgetByName(FormItemType.TEXT);r.TText({field:"full_name",selected_able:!0}),this.addEditFieldToColumn($.i18n._("Employee"),r,o,""),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"status",selected_able:!0}),this.addEditFieldToColumn($.i18n._("Status"),r,o,""),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"pay_period",selected_able:!0}),this.addEditFieldToColumn($.i18n._("Pay Period"),r,o);var s=a.find(".separate");(r=Global.loadWidgetByName(FormItemType.SEPARATED_BOX)).SeparatedBox({label:$.i18n._("Messages")}),this.addEditFieldToColumn(null,r,s),s.css("display","none");var n=a.find(".second-column");this.edit_view_tabs[0].push(n),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"from",selected_able:!0}),this.addEditFieldToColumn($.i18n._("From"),r,n,""),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"subject",selected_able:!0}),this.addEditFieldToColumn($.i18n._("Subject"),r,n),(r=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"body",width:600,height:400,selected_able:!0}),this.addEditFieldToColumn($.i18n._("Body"),r,n,"",null,!0,!0),n.css("display","none")}initEditViewUI(e,t){Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var i=this;this.edit_view&&this.edit_view.remove(),this.edit_view=$(Global.loadViewSource(e,t,null,!0)),this.edit_view_tab=$(this.edit_view.find(".edit-view-tab-bar")),this.edit_view_tab.attr("id",this.ui_id+"_edit_view_tab"),this.setTabOVisibility(!1),this.edit_view_tab=this.edit_view_tab.tabs({activate:function(e,t){i.onTabShow(e,t)}}),this.edit_view_tab.bind("tabsselect",(function(e,t){i.onTabIndexChange(e,t)})),Global.contentContainer().append(this.edit_view),this.initRightClickMenu(RightClickMenuType.EDITVIEW),this.is_viewing?(LocalCacheData.current_doing_context_action="view",this.buildViewUI()):this.is_edit&&(LocalCacheData.current_doing_context_action="edit",this.buildEditViewUI()),i.setEditViewTabHeight()}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"full_name":this.is_viewing&&t.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;case"pay_period":t.setValue(this.current_edit_record.start_date+" "+this.current_edit_record.end_date);break;case"subject":this.is_edit?Global.isSet(this.messages)&&t.setValue("Re: "+this.messages[0].subject):this.is_viewing&&t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.is_viewing?(this.initTimeSheetSummary(),this.initExceptionSummary()):Global.isSet(this.messages)&&(this.messages=null)}buildExceptionDisplayColumns(e){for(var t=this.all_exception_columns.length,i=e?e.length:0,a=[],o=0;o<i;o++)for(var r=0;r<t;r++)e[o]===this.all_exception_columns[r].value&&a.push(this.all_exception_columns[r]);return a}initExceptionSummary(){var e=this;this.api_exception||(this.api_exception=TTAPI.APIException),e.buildExceptionGrid(),e.setExceptionGridSize(),this.api_exception.getOptions("columns",{onResult:function(t){var i=t.getResult();if(0==Global.isSet(e.current_edit_record))return!1;var a={filter_data:{user_id:e.current_edit_record.user_id,pay_period_id:e.current_edit_record.pay_period_id,type_id:[30,40,50,55,60]}};e.api_exception.getException(a,{onResult:function(t){e.all_exception_columns=Global.buildColumnArray(i),Global.isSet(e.exception_grid)||$("#exception_grid");for(var a=["date_stamp","severity","exception_policy_type","exception_policy_type_id","exception_color","exception_background_color"],o=[],r=(a=e.buildExceptionDisplayColumns(a)).length,s=0;s<r;s++){var n=a[s],d={name:n.value,index:n.value,label:n.label,width:100,sortable:!1,title:!1};o.push(d)}e.buildExceptionGrid(o);var l=t.getResult();Global.isArray(l)||0!=TTUUID.isUUID(e.refresh_id)?(e.removeExceptionGridNoResultCover(),e.exception_grid.setData(Global.formatGridData(t.getResult()))):e.showExceptionGridNoResultCover(),e.setExceptionGridSize(),$(".exception-title").text($.i18n._("Exceptions")),$(".exception-title").css("width",e.exception_grid.grid.width()-1+"px !important"),e.setGridCellBackGround()}})}})}buildExceptionGrid(e){var t=this;void 0===e&&(e=[]),this.exception_grid&&(this.exception_grid.grid.jqGrid("GridUnload"),this.exception_grid=null),this.exception_grid=new TTGrid("exception_grid",{onResizeGrid:!1,multiselect:!1,winMultiSelect:!1,gridComplete:function(){$(this).jqGrid("getGridParam","data").length>0&&t.exception_grid.setGridColumnsWidth()},ondblClickRow:function(e){t.onExceptionGridDblClickRow(e)},sortable:!1,height:160},e)}showExceptionGridNoResultCover(){this.removeExceptionGridNoResultCover(),this.exception_grid_no_result_box=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.exception_grid_no_result_box.NoResultBox({related_view_controller:this,is_new:!1});var e=$(".exception-grid-div");e.css("position","relative"),this.exception_grid_no_result_box.attr("id","#exception_grid_no_result_box"),this.exception_grid_no_result_box.css("width",parseInt(e.width())+"px"),this.exception_grid_no_result_box.css("height",parseInt(e.height())+"px"),e.append(this.exception_grid_no_result_box)}removeExceptionGridNoResultCover(){this.exception_grid_no_result_box&&this.exception_grid_no_result_box.length>0&&this.exception_grid_no_result_box.remove(),this.exception_grid_no_result_box=null}setEditViewTabSize(){super.setEditViewTabSize(),this.setExceptionGridSize(),this.setTimeSheetSummaryGridSize()}setGridCellBackGround(){var e,t,i;if(this.exception_grid&&this.edit_view&&(e=this.exception_grid.getGridParam("data"))){t=e.length;for(var a=0;a<t;a++){if((i=e[a]).exception_background_color){var o=this.edit_view.find("tr[id='"+i.id+"']").find('td[aria-describedby="exception_grid_severity"]');o.css("background-color",i.exception_background_color),o.css("font-weight","bold")}if(i.exception_color){var r=this.edit_view.find("tr[id='"+i.id+"']").find('td[aria-describedby="exception_grid_exception_policy_type_id"]');r.css("color",i.exception_color),r.css("font-weight","bold")}}}}initTimeSheetSummary(){var e=this;if(0==Global.isSet(this.current_edit_record))return!1;this.accumulated_total_grid_source_map={},this.api_timesheet||(this.api_timesheet=TTAPI.APITimeSheet),e.buildAccumulatedTotalGrid(),this.api_timesheet.getTimeSheetData(this.current_edit_record.user_id,this.current_edit_record.start_date,{onResult:function(t){if(0==Global.isSet(e.current_edit_record))return!1;e.full_timesheet_data=t.getResult(),e.pay_period_data=e.full_timesheet_data.pay_period_data,e.timesheet_verify_data=e.full_timesheet_data.timesheet_verify_data,e.start_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.start_display_date),e.end_date=Global.strToDate(e.full_timesheet_data.timesheet_dates.end_display_date);var i=[],a={name:"punch_info",index:"punch_info",label:" ",width:200,fixed:!0,sortable:!1,title:!1,formatter:e.onCellFormat};i.push(a);var o=e.current_edit_record.start_date,r=e.current_edit_record.end_date;e.getAccumulatedTotalGridPayperiodHeader();$.i18n._("Week"),e.onCellFormat;var s={name:"pay_period",index:"pay_period",label:$.i18n._("Pay Period")+"<br>"+e.pay_period_header,width:100,sortable:!1,title:!1,formatter:e.onCellFormat};i.push(s),e.buildAccumulatedTotalGrid(i),e.buildAccumulatedTotalData(),$(".button-rotate").removeClass("button-rotate")}})}buildAccmulatedOrderMap(e){if(e)for(var t in e)for(var i in e[t])this.accmulated_order_map[i]=e[t][i].order}buildSubGridsData(e,t,i,o,r){var s,n=!1;for(var d in e)if(i[d])(s=i[d])[t],e[d].key=d,s[t]=Global.getTimeUnit(e[d].total_time),s[t+"_data"]=e[d],"accumulated_time"===s.parent_key&&e[d].override&&(s.is_override_row=!0);else{(s={}).parent_key=r,s.key=d,"accumulated_time"===r?("total"===d||"worked_time"===d?s.type=a.TOTAL_ROW:0==n&&0===d.indexOf("regular_time")?(s.type=a.REGULAR_ROW,n=!0):s.type=a.ACCUMULATED_TIME_ROW,e[d].override&&(s.is_override_row=!0)):"premium_time"===r&&(s.type=a.PREMIUM_ROW),this.accmulated_order_map[d]&&(s.order=this.accmulated_order_map[d]),s.punch_info=e[d].label;var l=d.split("_"),_=!1;l.length>1&&"0"==l[1]&&(_=!0),e[d].key=d,s[t]=Global.getTimeUnit(e[d].total_time),s[t+"_data"]=e[d],_?o.unshift(s):o.push(s),i[d]=s}}buildAccumulatedTotalData(){this.accmulated_order_map={},this.accumulated_total_grid_source=[];var e=this.full_timesheet_data.accumulated_user_date_total_data,t=this.full_timesheet_data.pay_period_accumulated_user_date_total_data,i=t.accumulated_time,a=t.premium_time,o=t.absence_time_taken;for(var r in e.total&&this.buildAccmulatedOrderMap(e.total),t&&this.buildAccmulatedOrderMap(t),Global.isSet(i)||(i={total:{label:"Total Time",total_time:"0"}}),this.buildSubGridsData(i,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),Global.isSet(a)&&this.buildSubGridsData(a,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(o)&&this.buildSubGridsData(o,"pay_period",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time"),i={total:{label:"Total Time",total_time:"0"}},this.buildSubGridsData(i,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),e)if("total"!==r);else{var s=e.total;i=s.accumulated_time,a=s.premium_time,o=s.absence_time_taken,Global.isSet(i)&&this.buildSubGridsData(i,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"accumulated_time"),Global.isSet(a)&&this.buildSubGridsData(a,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"premium_time"),Global.isSet(o)&&this.buildSubGridsData(o,"week",this.accumulated_total_grid_source_map,this.accumulated_total_grid_source,"absence_time")}this.sortAccumulatedTotalData(),this.timesheet_authorization_summary_grid.setData(this.accumulated_total_grid_source),$(".timesheet-authorization-summary-title").text($.i18n._("TimeSheet Summary"))}sortAccumulatedTotalData(){this.accumulated_total_grid_source.sort(Global.m_sort_by(["order","punch_info"]))}getAccumulatedTotalGridPayperiodHeader(){this.pay_period_header=$.i18n._("No Pay Period");var e=this.timesheet_verify_data.pay_period_id;if(e&&this.pay_period_data)for(var t in this.pay_period_data){var i=this.pay_period_data[t];if(i.id===e){var a=Global.strToDate(i.start_date).format(),o=Global.strToDate(i.end_date).format();this.pay_period_header=a+" to "+o;break}}}buildAccumulatedTotalGrid(e){void 0===e&&(e=[]),this.timesheet_authorization_summary_grid&&(this.timesheet_authorization_summary_grid.grid.jqGrid("GridUnload"),this.timesheet_authorization_summary_grid=null);var t=this;this.timesheet_authorization_summary_grid=new TTGrid("timesheet_authorization_summary_grid",{multiselect:!1,winMultiSelect:!1,sortable:!1,onResizeGrid:!1,gridComplete:function(){t.setTimeSheetSummaryGridSize()},ondblClickRow:function(){t.onTimeSheetGridDblClickRow()}},e),this.setTimeSheetSummaryGridSize()}onTimeSheetGridDblClickRow(){var e={filter_data:{}};e.user_id=this.current_edit_record.user_id,e.base_date=Global.strToDateTime(this.current_edit_record.start_date).format(),Global.addViewTab(this.viewId,$.i18n._("TimeSheet (Authorizations)"),window.location.href),IndexViewController.goToView("TimeSheet",e)}onExceptionGridDblClickRow(e){var t=this.exception_grid.grid.jqGrid("getCell",e,"date_stamp");t||(t=Global.strToDateTime(this.current_edit_record.start_date).format());var i={filter_data:{}};i.user_id=this.current_edit_record.user_id,i.base_date=t,Global.addViewTab(this.viewId,$.i18n._("TimeSheet (Authorizations)"),window.location.href),IndexViewController.goToView("TimeSheet",i)}onCellFormat(e,t,i){e=Global.decodeCellValue(e);var o,r,s,n=t.colModel,d=(t.rowid,$("<div class='punch-content-div'></div>"));return 0===t.pos?i.type===a.TOTAL_ROW?(o=$("<span class='total' style='font-size: 11px'></span>"),Global.isSet(e)?o.text(e):o.text(""),o.get(0).outerHTML):i.type===a.REGULAR_ROW?(o=$("<span class='top-line-span' style='font-size: 11px'></span>"),Global.isSet(e)?o.text(e):o.text(""),o.get(0).outerHTML):e:(i.type===a.TOTAL_ROW?(s=i[n.name+"_data"],r=$("<span class='total'></span>"),Global.isSet(e)?(s&&(s.hasOwnProperty("override")&&!0===s.override&&r.addClass("absence-override"),s.hasOwnProperty("note")&&s.note&&(e="*"+e)),r.text(e)):r.text(""),d.prepend(r)):i.type===a.REGULAR_ROW?(d.addClass("top-line"),s=i[n.name+"_data"],r=$("<span ></span>"),Global.isSet(e)?(s&&(s.hasOwnProperty("override")&&!0===s.override&&r.addClass("absence-override"),s.hasOwnProperty("note")&&s.note&&(e="*"+e)),r.text(e)):r.text(""),d.prepend(r)):i.type===a.ACCUMULATED_TIME_ROW?(s=i[n.name+"_data"],r=$("<span></span>"),Global.isSet(e)?(s&&(s.hasOwnProperty("override")&&!0===s.override&&r.addClass("absence-override"),s.hasOwnProperty("note")&&s.note&&(e="*"+e)),r.text(e)):r.text(""),d.prepend(r)):(r=$("<span class='punch-time'></span>"),Global.isSet(e)?r.text(e):r.text(""),d.prepend(r)),d.get(0).outerHTML)}setExceptionGridSize(){if(this.exception_grid){this.exception_grid.grid.setGridWidth($(".exception-grid-div").width()+1);var e=2,t=this.exception_grid.getData();Global.isArray(t)&&(e+=22*t.length),this.exception_grid.setGridHeight(e)}}setTimeSheetSummaryGridSize(){if(this.timesheet_authorization_summary_grid){this.timesheet_authorization_summary_grid.grid.setGridWidth($(".timesheet-authorization-grid-div").width());var e=2,t=this.timesheet_authorization_summary_grid.getData();Global.isArray(t)&&(e+=22*t.length),this.timesheet_authorization_summary_grid.setGridHeight(e)}}}a.TOTAL_ROW=4,a.REGULAR_ROW=5,a.ABSENCE_ROW=6,a.ACCUMULATED_TIME_ROW=7,a.PREMIUM_ROW=8}}]);
//# sourceMappingURL=my_account-timesheet_authorization-TimeSheetAuthorizationViewController.bundle.js.map?v=c6d3050621a5d0fb1932