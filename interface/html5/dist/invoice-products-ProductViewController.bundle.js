(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["invoice-products-ProductViewController"],{1744:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"ProductViewController":()=>d});class d extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#product_view_container",type_array:null,apply_frequency_array:null,month_of_year_array:null,day_of_month_array:null,day_of_week_array:null,length_of_service_unit_array:null,date_api:null,group_api:null,product_price_api:null}),super(e)}init(e){this.edit_view_tpl="ProductEditView.html",this.permission_id="product",this.viewId="Product",this.script_name="ProductView",this.table_name_key="product",this.context_menu_name=$.i18n._("Products"),this.navigation_label=$.i18n._("Product")+":",this.api=TTAPI.APIProduct,this.date_api=TTAPI.APITTDate,this.group_api=TTAPI.APIProductGroup,this.product_price_api=TTAPI.APIProductPrice,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(e){var i=this,t=[{option_name:"type",field_name:null,api:null},{option_name:"status",field_name:null,api:null},{option_name:"unit_price_type",field_name:null,api:null},{option_name:"weight_unit",field_name:null,api:null},{option_name:"dimension_unit",field_name:null,api:null},{option_name:"country",field_name:null,api:TTAPI.APICompany}];this.initDropDownOptions(t,(function(t){i.group_api.getProductGroup("",!1,!1,{onResult:function(d){d=d.getResult(),d=Global.buildTreeRecord(d),i.edit_only_mode||!i.sub_view_mode&&i.basic_search_field_ui_dic.group_id&&i.basic_search_field_ui_dic.group_id.setSourceData(d),i.group_array=d,e&&e(t)}})}))}buildEditViewUI(){super.buildEditViewUI();var e=this,i={"tab_product":{"label":$.i18n._("Product")},"tab_pricing":{"label":$.i18n._("Pricing")},"tab_shipping":{"label":$.i18n._("Shipping")},"tab_audit":!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIProduct,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_product",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var t=this.edit_view_tab.find("#tab_product").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t);var d=Global.loadWidgetByName(FormItemType.COMBO_BOX);d.TComboBox({field:"type_id",set_empty:!1}),d.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),d,t,""),(d=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id",set_empty:!1}),d.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),d,t,""),(d=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),d.setSourceData(e.group_array),this.addEditFieldToColumn($.i18n._("Group"),d,t),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"part_number"}),this.addEditFieldToColumn($.i18n._("Part Number"),d,t,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Name"),d,t,""),d.parent().width("45%"),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"description",width:"100%"}),this.addEditFieldToColumn($.i18n._("Description"),d,t,""),d.parent().width("45%"),(d=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"description_locked"}),this.addEditFieldToColumn($.i18n._("Lock Description"),d,t),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"upc"}),this.addEditFieldToColumn($.i18n._("UPC"),d,t,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"quantity"}),this.addEditFieldToColumn($.i18n._("Current Stock"),d,t,""),(d=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"include_tax_policy"}),this.addEditFieldToColumn($.i18n._("Include Tax Policy"),d,t,""),(d=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APITaxPolicy,allow_multiple_selection:!0,layout_name:"global_tax_policy",show_search_inputs:!0,set_empty:!0,field:"exclude_tax_policy"}),this.addEditFieldToColumn($.i18n._("Exclude Tax Policy"),d,t,""),(d=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:900}),this.addEditFieldToColumn($.i18n._("Tags"),d,t,"",null,null,!0);var o=this.edit_view_tab.find("#tab_pricing"),a=o.find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(a),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"unit_cost",width:80}),this.addEditFieldToColumn($.i18n._("Unit Cost"),d,a,""),(d=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,field:"currency_id"}),this.addEditFieldToColumn($.i18n._("Currency"),d,a),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"minimum_purchase_quantity",width:80}),this.addEditFieldToColumn($.i18n._("Minimum Quantity"),d,a,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"maximum_purchase_quantity",width:80}),this.addEditFieldToColumn($.i18n._("Maximum Quantity"),d,a,""),(d=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"price_locked"}),this.addEditFieldToColumn($.i18n._("Lock Price"),d,a),(d=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"unit_price_type_id"}),d.setSourceData(e.unit_price_type_array),this.addEditFieldToColumn($.i18n._("Price Type"),d,a,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"unit_price",width:80}),this.addEditFieldToColumn($.i18n._("Unit Price"),d,a,"",null,!0);var r=o.find(".inside-editor-div"),l={quantity:$.i18n._("Quantity"),unit_price:$.i18n._("Unit Price")};this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEditorAddRow,removeRow:this.insideEditorRemoveRow,getValue:this.insideEditorGetValue,setValue:this.insideEditorSetValue,render:"views/invoice/products/ProductInsideEditorRender.html",render_args:l,row_render:"views/invoice/products/ProductInsideEditorRow.html",parent_controller:this}),r.append(this.editor);var n=this.edit_view_tab.find("#tab_shipping").find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(n),(d=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"weight_unit_id"}),d.setSourceData(e.weight_unit_array),this.addEditFieldToColumn($.i18n._("Weight Unit"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"weight"}),this.addEditFieldToColumn($.i18n._("Weight"),d,n,""),(d=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"dimension_unit_id"}),d.setSourceData(e.dimension_unit_array),this.addEditFieldToColumn($.i18n._("Dimension Unit"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"dimension_length"}),this.addEditFieldToColumn($.i18n._("Length"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"dimension_width"}),this.addEditFieldToColumn($.i18n._("Width"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"dimension_height"}),this.addEditFieldToColumn($.i18n._("Height"),d,n,""),(d=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"origin_country",set_empty:!0}),d.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Origin Country"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"tariff_code"}),this.addEditFieldToColumn($.i18n._("Tariff Code"),d,n,""),(d=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"customs_unit_value"}),this.addEditFieldToColumn($.i18n._("Custom Unit Value"),d,n,"")}onTypeChange(){10!=this.current_edit_record.type_id&&62!=this.current_edit_record.type_id?($(this.edit_view_tab.find("ul li")[2]).hide(),2==this.getEditViewTabIndex()&&this.edit_view_tab.tabs("option","active",0)):$(this.edit_view_tab.find("ul li")[2]).show(),20!=this.current_edit_record.unit_price_type_id&&30!=this.current_edit_record.unit_price_type_id||this.is_mass_editing?(this.attachElement("unit_price"),this.editor.css("display","none")):(this.detachElement("unit_price"),this.editor.css("display","block")),this.editFieldResize()}onFormItemChange(e,i){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),d=e.getValue();this.current_edit_record[t]=d,"type_id"!==t&&"unit_price_type_id"!==t||this.onTypeChange(),i||this.validate()}insideEditorSetValue(e){e.length;this.removeAllRows();for(var i=0;i<e.length;i++)if(Global.isSet(e[i])){var t=e[i];t.accrual_rate=Global.getTimeUnit(t.accrual_rate),t.maximum_time=Global.getTimeUnit(t.maximum_time),t.rollover_time=Global.getTimeUnit(t.rollover_time),Global.isSet(this.parent_id)&&(t.id=""),this.addRow(t)}}insideEditorAddRow(e,i){e||(e={});var t,d,o,a=this.getRowRender(),r=this.getRender(),l={};(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"quantity",width:60}),t.setValue(e.quantity?e.quantity:0),d=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("or more")+"</span>"),d.append(t),d.append(o),l[t.getField()]=t,a.children().eq(0).append(d),this.setWidgetEnableBaseOnParentController(t),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"unit_price",width:60}),t.setValue(e.unit_price?e.unit_price:"0.00"),(d=$("<div class='widget-h-box'></div>")).append(t),l[t.getField()]=t,a.children().eq(1).append(d),this.setWidgetEnableBaseOnParentController(t),l.current_edit_item=e,this.parent_controller.current_edit_record.id||(l.current_edit_item.id=""),void 0!==i?(a.insertAfter($(r).find("tr").eq(i)),this.rows_widgets_array.splice(i,0,l)):($(r).append(a),this.rows_widgets_array.push(l)),this.parent_controller.is_viewing&&a.find(".control-icon").hide(),this.addIconsEvent(a),this.removeLastRowLine()}insideEditorRemoveRow(e){var i=e[0].rowIndex-1,t=this.rows_widgets_array[i].current_edit_item.id;TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&this.delete_ids.push(t),e.remove(),this.rows_widgets_array.splice(i,1),this.removeLastRowLine()}insideEditorGetValue(e){for(var i=this.rows_widgets_array.length,t=[],d=0;d<i;d++){var o=this.rows_widgets_array[d],a=o.current_edit_item;a.quantity=o.quantity.getValue(),a.unit_price=o.unit_price.getValue(),a.product_id=e,t.push(a)}return t}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.initInsideEditorData()}initInsideEditorData(){var e=this,i={filter_data:{}};this.current_edit_record&&this.current_edit_record.id||this.copied_record_id?(i.filter_data.product_id=this.current_edit_record.id?this.current_edit_record.id:this.copied_record_id,this.copied_record_id="",this.product_price_api.getProductPrice(i,!0,{onResult:function(i){if(e.edit_view){var t=i.getResult();!0===t?e.editor.addRow():t.length>0&&e.editor.setValue(t)}}})):(e.editor.removeAllRows(),e.editor.addRow())}saveInsideEditorData(e){if(20!=this.current_edit_record.unit_price_type_id&&30!=this.current_edit_record.unit_price_type_id||this.is_mass_editing)Global.isSet(e)&&e();else{var i=this,t=this.editor.getValue(this.refresh_id),d=i.editor.delete_ids;d.length>0&&i.product_price_api.deleteProductPrice(d,{onResult:function(e){e.isValid()&&(i.editor.delete_ids=[])}}),i.product_price_api.setProductPrice(t,{onResult:function(i){i.getResult();Global.isSet(e)&&e()}})}}onSaveResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(),i.onSaveDone(e),i.removeEditView()}))}else i.setErrorTips(e),i.setErrorMenu()}onSaveAndCopyResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(!1),i.onCopyAsNewClick()}))}else i.setErrorTips(e),i.setErrorMenu()}_continueDoCopyAsNew(){if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view))for(var e=0;e<this.editor.rows_widgets_array.length;e++)this.editor.rows_widgets_array[e].current_edit_item.id="";super._continueDoCopyAsNew()}onCopyAsNewResult(e){var i=this,t=e.getResult();if(!t)return TAlertManager.showAlert($.i18n._("Record does not exist")),void i.onCancelClick();i.openEditView(),t=t[0],this.copied_record_id=t.id,t.id="",i.sub_view_mode&&i.parent_key&&(t[i.parent_key]=i.parent_value),i.current_edit_record=t,i.initEditView()}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!1,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!1,in_column:1,object_type_id:900,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Part Number"),in_column:2,field:"part_number",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Description"),in_column:2,field:"description",multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!1,form_item_type:FormItemType.AWESOME_BOX})]}}}}]);
//# sourceMappingURL=invoice-products-ProductViewController.bundle.js.map?v=630fdd7d62b46f7db27b