(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["employees-employee-EmployeeViewController","filebrowser-TImage","filebrowser-TImageAdvBrowser"],{1469:()=>{!function(e){e.fn.TImage=function(i){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var t,a=e.extend({},e.fn.TImage.defaults,i);return this.clearErrorStyle=function(){},this.getField=function(){return t},this.getValue=function(){return null},this.setValue=function(e){if(e){var i=new Date;this.attr("src",e+"&t="+i.getTime())}else this.attr("src","")},this.each((function(){var i=e.meta?e.extend({},a,e(this).data()):a;t=i.field})),this},e.fn.TImage.defaults={},e(document).on("mouseover",".file-browser img",(function(i){var t=e(i.target).parents(".file-browser");if(!e(".file_browser_overlay")[0]&&1==e(i.target).attr("enable-delete")){var a=e(i.target).height(),o=(a-32)/2,r=e('<div class="file_browser_overlay"><img src="theme/default/images/delete-512.png" style="position:absolute;width:32px;height:32px;top:'+o+"px;left:"+o+'px;"></div>');r.css("position","absolute"),r.css("top","0px"),r.css("left","0"),r.css("cursor","pointer"),r.css("height",a+"px"),r.css("width","100%"),r.css("background","rgba(255,255,255,0.85)"),e(i.target).parents(".file-browser").append(r),e(document).on("click",".file_browser_overlay",(function(i){e(i.target).parent().find("img").attr("src");TAlertManager.showConfirmAlert(e.i18n._("This will permanently delete the image. Are you sure?"),"",(function(e){if(e){var i={type:"deleteClick",message:"Delete image clicked.",time:new Date};t.trigger(i)}}))})),e(document).on("mouseleave",".file-browser",(function(){(e(document).off("click",".file_browser_overlay"),e(".file_browser_overlay")[0])&&e(this).find(".file_browser_overlay").off().remove()}))}}))}(jQuery)},8243:()=>{!function(e){e.fn.TImageAdvBrowser=function(i){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var t,a,o,r=e.extend({},e.fn.TImageAdvBrowser.defaults,i),l=this,n="",_=177,s=42,d=null;return this.setEnable=function(e){e;var i=this.children().eq(1);e?i.show():i.hide()},this.clearErrorStyle=function(){},this.getField=function(){return t},this.getValue=function(){return o},this.setImage=function(e){if(!e)return a.attr("src",""),void a.hide();var i=new Date;a.hide(),a.attr("src",e+"&t="+i.getTime()+"&X-CSRF-Token="+getCookie("CSRF-Token")),a.css("height","auto"),a.css("width","auto")},this.onImageLoad=function(i){var t=e(i).height()>0?e(i).height():i.naturalHeight,a=e(i).width()>0?e(i).width():i.naturalWidth;t>s&&e(i).css("height",s),a>_&&(e(i).css("width",_),e(i).css("height","auto")),l.trigger("setSize"),t<5?e(i).hide():e(i).show()},this.setValue=function(e){e||(e="")},this.setEnableDelete=function(e){var i=l.find(".image");e?i.attr("enable-delete",1):i.removeAttr("enable-delete")},this.each((function(){var i=e.meta?e.extend({},r,e(this).data()):r;t=i.field;e(this).find("#upload_image").text(e.i18n._("Upload Image")),i.callBack&&(d=i.callBack),!1===i.show_browser&&e(this).children().eq(1).hide(),i.default_width>0&&(_=i.default_width),i.default_height>0&&(s=i.default_height),Global.isSet(i.name)&&i.name,Global.isSet(n)&&(n=i.accept_filter),Global.isSet(i.deleteImageHandler)&&l.find(".file-browser").on("deleteClick",(function(){i.deleteImageHandler()})),e(this).children().eq(1).bind("click",(function(){IndexViewController.openWizard("UserPhotoWizard",null,(function(e){d&&d(e),o=e}))})),(a=e(this).children().eq(0)).on("load",(function(){l.onImageLoad(this)})),a.hide()})),this},e.fn.TImageAdvBrowser.defaults={}}(jQuery)},1961:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"EmployeeViewController":()=>a});t(1469),t(8243);class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#employee_view_container",user_api:null,user_group_api:null,company_api:null,hierarchyControlAPI:null,status_array:null,sex_array:null,user_group_array:null,country_array:null,province_array:null,e_province_array:null,sub_wage_view_controller:null,sub_user_contact_view_controller:null,sub_accrual_policy_user_modifier_view_controller:null,sub_log_view_controller:null,sub_company_tax_view_controller:null,sub_job_application_view_controller:null,sub_user_skill_view_controller:null,sub_user_education_view_controller:null,sub_user_membership_view_controller:null,sub_user_license_view_controller:null,sub_user_language_view_controller:null,sub_user_review_control_view_controller:null,sub_payment_methods_view_controller:null,hierarchy_options_dic:null,hierarchy_ui_model:null,show_hierarchy:!1,select_company_id:null,sub_view_grid_autosize:!0,events:{}}),super(e)}init(e){this.edit_view_tpl="EmployeeEditView.html",this.permission_id="user",this.viewId="Employee",this.script_name="EmployeeView",this.table_name_key="users",this.document_object_type_id=100,this.context_menu_name=$.i18n._("Employees"),this.navigation_label=$.i18n._("Employee")+":",this.api=TTAPI.APIUser,this.select_company_id=LocalCacheData.getCurrentCompany().id,Global.getProductEdition()>=20&&(this.job_api=TTAPI.APIJob,this.job_item_api=TTAPI.APIJobItem),this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.hierarchyControlAPI=TTAPI.APIHierarchyControl,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}jobUIValidate(){return!(!PermissionManager.validate("job","enabled")||!(PermissionManager.validate("job","view")||PermissionManager.validate("job","view_child")||PermissionManager.validate("job","view_own")))}jobItemUIValidate(){return!(!PermissionManager.validate("job_item","enabled")||!(PermissionManager.validate("job_item","view")||PermissionManager.validate("job_item","view_child")||PermissionManager.validate("job_item","view_own")))}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1}getCustomContextMenuModel(){var e={"exclude":[ContextMenuIconName.copy],"include":[{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Schedule"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Pay<br>Stubs"),id:ContextMenuIconName.pay_stub,group:"navigation",icon:Icons.pay_stubs},{label:$.i18n._("Pay Stub<br>Amendments"),id:ContextMenuIconName.pay_stub_amendment,group:"navigation",icon:Icons.pay_stub_amendment},{label:$.i18n._("Map"),id:ContextMenuIconName.map,group:"other",icon:Icons.map},{label:$.i18n._("Import"),id:ContextMenuIconName.import_icon,group:"other",icon:Icons.import_icon,permission_result:PermissionManager.checkTopLevelPermission("ImportCSVEmployee"),sort_order:8e3}]};return this.edit_only_mode&&e.exclude.push(ContextMenuIconName.timesheet,ContextMenuIconName.schedule,ContextMenuIconName.pay_stub,ContextMenuIconName.pay_stub_amendment,ContextMenuIconName.map,ContextMenuIconName.import_icon,ContextMenuIconName.export_excel),e}openEditView(e){if(this.edit_only_mode){var i=this;this.initOptions((function(e){if(i.edit_view)t();else{i.initEditViewUI(i.viewId,i.edit_view_tpl);t()}}))}else this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl);function t(){i.getEmployeeData(e,(function(e){e?(i.current_edit_record=e,i.initEditView()):(TAlertManager.showAlert($.i18n._("Invalid employee id")),i.onCancelClick()),i.edit_only_mode&&$(".edit-view-tab-bar").css("opacity",1)}))}}setEditViewDataDone(){this.showCurrentPasswordField(),super.setEditViewDataDone()}showCurrentPasswordField(){(1==this.is_edit||this.edit_only_mode)&&LocalCacheData.loginUser&&LocalCacheData.loginUser.id&&this.current_edit_record&&this.current_edit_record.id&&LocalCacheData.loginUser.id==this.current_edit_record.id?this.attachElement("current_password"):this.detachElement("current_password")}getEmployeeData(e,i){if("object"==typeof e)e.id="",e.company=LocalCacheData.current_company.name,i(e);else{var t={filter_data:{}};t.filter_data.id=[e],this.api["get"+this.api.key_name](t,{onResult:function(e){var t=e.getResult();t||(t=[]),t=t[0],i(t)}})}}initOptions(e){var i=[{option_name:"status"},{option_name:"sex"},{option_name:"country",field_name:"country",api:this.company_api}];this.initDropDownOptions(i,(function(i){e&&e(i)}))}initDropDownOptions(e,i){var t=this,a=e.length+2,o=0,r=[];this.hierarchyPermissionValidate()?t.hierarchyControlAPI.getOptions("object_type",{onResult:function(e){var l=e.getResult();if(l){var n=[];for(var _ in l)n.push({id:Global.removeSortPrefix(_),value:l[_]});t.hierarchy_ui_model=n}(o+=1)===a&&i(r)}}):(this.show_hierarchy=!1,o+=1),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(e){e=e.getResult(),e=Global.buildTreeRecord(e),t.edit_only_mode||!t.sub_view_mode&&t.basic_search_field_ui_dic.group_id&&(t.basic_search_field_ui_dic.group_id.setSourceData(e),t.adv_search_field_ui_dic.group_id.setSourceData(e)),t.user_group_array=e,(o+=1)===a&&i(r)}});for(var l=0;l<a-2;l++){var n=e[l];this.initDropDownOption(n.option_name,n.field_name,n.api,_)}function _(e){r.push(e),(o+=1)===a&&i(r)}}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var i=this.context_menu_array.length,t=this.getGridSelectIdArray().length,a=0;a<i;a++){var o=$(this.context_menu_array[a]),r=$(o.find(".ribbon-sub-menu-icon")).attr("id");switch(o.removeClass("invisible-image"),o.removeClass("disable-image"),r){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(o,t);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(o,t);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(o,t);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(o,t);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(o,t);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(o,t);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(o,t);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(o,t);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(o,t);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(o,t);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(o,t);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(o,t);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(o,t);break;case ContextMenuIconName.login:this.setDefaultMenuLoginIcon(o,t);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(o,t);break;case ContextMenuIconName.import_icon:this.setDefaultMenuImportIcon(o,t);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(o,t,"punch");break;case ContextMenuIconName.schedule:this.setDefaultMenuViewIcon(o,t,"schedule");break;case ContextMenuIconName.pay_stub_amendment:this.setDefaultMenuViewIcon(o,t,"pay_stub_amendment");break;case ContextMenuIconName.pay_stub:this.setDefaultMenuPayStubIcon(o,t,"pay_stub");break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(o);break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(o)}}this.setContextMenuGroupVisibility()}}setDefaultMenuPayStubIcon(e,i,t){PermissionManager.checkTopLevelPermission("PayStub")||e.addClass("invisible-image"),1===i?e.removeClass("disable-image"):e.addClass("disable-image")}initSubQualificationView(){var e=this;function i(){}function t(i){$(i.el).find(".sub-view-title").text($.i18n._("Skills")),e.sub_user_skill_view_controller=i,e.sub_user_skill_view_controller.parent_key="user_id",e.sub_user_skill_view_controller.parent_value=e.current_edit_record.id,e.sub_user_skill_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_skill_view_controller.parent_view_controller=e,e.sub_user_skill_view_controller.postInit=function(){this.initData()}}function a(i){$(i.el).find(".sub-view-title").text($.i18n._("Licenses")),e.sub_user_license_view_controller=i,e.sub_user_license_view_controller.parent_key="user_id",e.sub_user_license_view_controller.parent_value=e.current_edit_record.id,e.sub_user_license_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_license_view_controller.parent_view_controller=e,e.sub_user_license_view_controller.postInit=function(){this.initData()}}function o(i){$(i.el).find(".sub-view-title").text($.i18n._("Languages")),e.sub_user_language_view_controller=i,e.sub_user_language_view_controller.parent_key="user_id",e.sub_user_language_view_controller.parent_value=e.current_edit_record.id,e.sub_user_language_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_language_view_controller.parent_view_controller=e,e.sub_user_language_view_controller.postInit=function(){this.initData()}}function r(i){$(i.el).find(".sub-view-title").text($.i18n._("Education")),e.sub_user_education_view_controller=i,e.sub_user_education_view_controller.parent_key="user_id",e.sub_user_education_view_controller.parent_value=e.current_edit_record.id,e.sub_user_education_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_education_view_controller.parent_view_controller=e,e.sub_user_education_view_controller.postInit=function(){this.initData()}}function l(i){$(i.el).find(".sub-view-title").text($.i18n._("Memberships")),e.sub_user_membership_view_controller=i,e.sub_user_membership_view_controller.parent_key="user_id",e.sub_user_membership_view_controller.parent_value=e.current_edit_record.id,e.sub_user_membership_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_membership_view_controller.parent_view_controller=e,e.sub_user_membership_view_controller.postInit=function(){this.initData()}}this.current_edit_record.id?($("#tab_qualifications .first-column-sub-view").css("opacity","0"),TTPromise.add("Employee_Qualifications_Tab","initSubQualificationView"),TTPromise.add("Employee_Qualifications_Tab","UserSkillViewController"),Global.loadScript("views/hr/qualification/UserSkillViewController.js",(function(){var a=e.edit_view_tab.find("#tab_qualifications").find(".first-column-sub-view").find(".first-sub-view");Global.trackView("SubUserSkillView"),UserSkillViewController.loadSubView(a,i,t)})),TTPromise.add("Employee_Qualifications_Tab","UserEducationViewController"),Global.loadScript("views/hr/qualification/UserEducationViewController.js",(function(){var t=e.edit_view_tab.find("#tab_qualifications").find(".first-column-sub-view").find(".second-sub-view");Global.trackView("SubUserEducationView"),UserEducationViewController.loadSubView(t,i,r)})),TTPromise.add("Employee_Qualifications_Tab","UserMembershipViewController"),Global.loadScript("views/hr/qualification/UserMembershipViewController.js",(function(){var t=e.edit_view_tab.find("#tab_qualifications").find(".first-column-sub-view").find(".third-sub-view");Global.trackView("SubUserMembershipView"),UserMembershipViewController.loadSubView(t,i,l)})),TTPromise.add("Employee_Qualifications_Tab","UserLicenseViewController"),Global.loadScript("views/hr/qualification/UserLicenseViewController.js",(function(){var t=e.edit_view_tab.find("#tab_qualifications").find(".first-column-sub-view").find(".forth-sub-view");Global.trackView("SubUserLicenseView"),UserLicenseViewController.loadSubView(t,i,a)})),TTPromise.add("Employee_Qualifications_Tab","UserLanguageViewController"),Global.loadScript("views/hr/qualification/UserLanguageViewController.js",(function(){var t=e.edit_view_tab.find("#tab_qualifications").find(".first-column-sub-view").find(".fifth-sub-view");Global.trackView("SubUserLanguageView"),UserLanguageViewController.loadSubView(t,i,o)})),TTPromise.wait("Employee_Qualifications_Tab",null,(function(){$("#contentContainer").trigger("resize"),$("#tab_qualifications .first-column-sub-view").css("opacity","1")})),TTPromise.resolve("Employee_Qualifications_Tab","initSubQualificationView")):TTPromise.resolve("BaseViewController","onTabShow")}initSubCompanyTaxView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("TaxView","init"),this.sub_company_tax_view_controller)return this.sub_company_tax_view_controller.buildContextMenu(!0),this.sub_company_tax_view_controller.setDefaultMenu(),e.sub_company_tax_view_controller.parent_value=e.current_edit_record.id,e.sub_company_tax_view_controller.parent_edit_record=e.current_edit_record,void e.sub_company_tax_view_controller.initData();Global.loadViewSource("CompanyTaxDeduction","CompanyTaxDeductionViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_tax").find(".first-column-sub-view");Global.trackView("SubUserContactView"),CompanyTaxDeductionViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_company_tax_view_controller=i,e.sub_company_tax_view_controller.parent_key="include_user_id",e.sub_company_tax_view_controller.parent_value=e.current_edit_record.id,e.sub_company_tax_view_controller.parent_edit_record=e.current_edit_record,e.sub_company_tax_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_company_tax_view_controller.initData()}))}}initSubUserReviewControlView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("ReviewView","init"),this.sub_user_review_control_view_controller)return this.sub_user_review_control_view_controller.buildContextMenu(!0),this.sub_user_review_control_view_controller.setDefaultMenu(),e.sub_user_review_control_view_controller.parent_key="user_id",e.sub_user_review_control_view_controller.parent_value=e.current_edit_record.id,e.sub_user_review_control_view_controller.parent_edit_record=e.current_edit_record,void e.sub_user_review_control_view_controller.initData();Global.loadScript("views/hr/kpi/UserReviewControlViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_reviews").find(".first-column-sub-view");Global.trackView("SubUserReviewControlView"),UserReviewControlViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_user_review_control_view_controller=i,e.sub_user_review_control_view_controller.parent_key="user_id",e.sub_user_review_control_view_controller.parent_value=e.current_edit_record.id,e.sub_user_review_control_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_review_control_view_controller.parent_view_controller=e,e.sub_user_review_control_view_controller.initData()}}initSubPaymentMethodsView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("PaymentMethodsView","init"),this.sub_payment_methods_view_controller)return this.sub_payment_methods_view_controller.buildContextMenu(!0),this.sub_payment_methods_view_controller.setDefaultMenu(),e.sub_payment_methods_view_controller.parent_key="user_id",e.sub_payment_methods_view_controller.parent_value=e.current_edit_record.id,e.sub_payment_methods_view_controller.parent_edit_record=e.current_edit_record,void e.sub_payment_methods_view_controller.initData();Global.loadScript("views/employees/remittance_destination_account/RemittanceDestinationAccountViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_payment_methods").find(".first-column-sub-view");Global.trackView("SubRemittanceDestinationAccountView"),RemittanceDestinationAccountViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_payment_methods_view_controller=i,e.sub_payment_methods_view_controller.is_subview=!0,e.sub_payment_methods_view_controller.parent_key="user_id",e.sub_payment_methods_view_controller.parent_value=e.current_edit_record.id,e.sub_payment_methods_view_controller.parent_edit_record=e.current_edit_record,e.sub_payment_methods_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_payment_methods_view_controller.initData()}))}}initSubJobApplicationView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("JobAppView","init"),this.sub_job_application_view_controller)return this.sub_job_application_view_controller.buildContextMenu(!0),this.sub_job_application_view_controller.setDefaultMenu(),e.sub_job_application_view_controller.parent_key="interviewer_user_id",e.sub_job_application_view_controller.parent_value=e.current_edit_record.id,e.sub_job_application_view_controller.parent_edit_record=e.current_edit_record,void e.sub_job_application_view_controller.initData();Global.loadScript("views/hr/recruitment/JobApplicationViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_applications").find(".first-column-sub-view");Global.trackView("SubJobApplicationView"),JobApplicationViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_job_application_view_controller=i,e.sub_job_application_view_controller.parent_key="interviewer_user_id",e.sub_job_application_view_controller.parent_value=e.current_edit_record.id,e.sub_job_application_view_controller.parent_edit_record=e.current_edit_record,e.sub_job_application_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_job_application_view_controller.initData()}))}}initSubUserContactView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("ContactView","init"),this.sub_user_contact_view_controller)return this.sub_user_contact_view_controller.buildContextMenu(!0),this.sub_user_contact_view_controller.setDefaultMenu(),e.sub_user_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_user_contact_view_controller.parent_edit_record=e.current_edit_record,void e.sub_user_contact_view_controller.initData();Global.loadScript("views/employees/user_contact/UserContactViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_contacts").find(".first-column-sub-view");Global.trackView("SubUserContactView"),UserContactViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_user_contact_view_controller=i,e.sub_user_contact_view_controller.parent_key="user_id",e.sub_user_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_user_contact_view_controller.parent_edit_record=e.current_edit_record,e.sub_user_contact_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_user_contact_view_controller.initData()}))}}initSubWageView(){var e=this;if(this.current_edit_record.id){if(TTPromise.add("WageView","init"),this.sub_wage_view_controller)return this.sub_wage_view_controller.buildContextMenu(!0),this.sub_wage_view_controller.setDefaultMenu(),e.sub_wage_view_controller.parent_value=e.current_edit_record.id,e.sub_wage_view_controller.parent_edit_record=e.current_edit_record,e.sub_wage_view_controller.initData(),void TTPromise.resolve("WageView","init");Global.loadScript("views/company/wage/WageViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_wage").find(".first-column-sub-view");Global.trackView("SubWageView"),WageViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i,t){e.sub_wage_view_controller=i,e.sub_wage_view_controller.parent_key="user_id",e.sub_wage_view_controller.parent_value=e.current_edit_record.id,e.sub_wage_view_controller.parent_edit_record=e.current_edit_record,e.sub_wage_view_controller.parent_view_controller=e,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_wage_view_controller&&e.sub_wage_view_controller.initData()}))}}initSubAccrualPolicyUserModifier(){var e=this;if(!this.current_edit_record.id)return TTPromise.resolve("BaseViewController","onTabShow"),void this.edit_view.find(".permission-defined-div").css("display","none");if(TTPromise.add("AccrualView","init"),this.sub_accrual_policy_user_modifier_view_controller)return this.sub_accrual_policy_user_modifier_view_controller.buildContextMenu(!0),this.sub_accrual_policy_user_modifier_view_controller.setDefaultMenu(),e.sub_accrual_policy_user_modifier_view_controller.parent_key="user_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,void e.sub_accrual_policy_user_modifier_view_controller.initData();function i(e){return{template:_.template(e),args:{parent_view:"employee"}}}function t(i){e.sub_accrual_policy_user_modifier_view_controller=i,e.sub_accrual_policy_user_modifier_view_controller.parent_key="user_id",e.sub_accrual_policy_user_modifier_view_controller.parent_value=e.current_edit_record.id,e.sub_accrual_policy_user_modifier_view_controller.parent_edit_record=e.current_edit_record,e.sub_accrual_policy_user_modifier_view_controller.parent_view_controller=e,e.sub_accrual_policy_user_modifier_view_controller.sub_view_mode=!0,TTPromise.wait("BaseViewController","initialize",(function(){e.sub_accrual_policy_user_modifier_view_controller.initData()}))}Global.getProductEdition()>=15?(this.edit_view.find(".permission-defined-div").css("display","none"),Global.loadScript("views/policy/accrual_policy/AccrualPolicyUserModifierViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_accruals").find(".first-column-sub-view");Global.trackView("SubAccrualPolicyUserModifierView"),AccrualPolicyUserModifierViewController.loadSubView(a,i,t)}}))):(this.edit_view_tab.find("#tab_accruals").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage()))}setDefaultUserName(){if(1==this.is_add){var e=this.edit_view_ui_dic.first_name,i=this.edit_view_ui_dic.last_name,t=this.edit_view_ui_dic.user_name;t.setValue(e.getValue().toLowerCase().replace(/[^a-zA-Z_]/gi,"")+"."+i.getValue().toLowerCase().replace(/[^a-zA-Z_]/gi,"")),this.current_edit_record.user_name=t.getValue()}}onFormItemChange(e,i){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField();if(this.current_edit_record){switch(parseInt(t)>0?(this.current_edit_record.hierarchy_control||(this.current_edit_record.hierarchy_control={}),this.current_edit_record.hierarchy_control[t]=e.getValue()):this.current_edit_record[t]=e.getValue(),t){case"first_name":var a=this.edit_view_ui_dic.first_name_1;a.setValue(e.getValue()),this.current_edit_record.first_name_1=e.getValue(),this.setDefaultUserName();break;case"last_name":(a=this.edit_view_ui_dic.last_name_1).setValue(e.getValue()),this.current_edit_record.last_name_1=e.getValue(),this.setDefaultUserName();break;case"first_name_1":(a=this.edit_view_ui_dic.first_name).setValue(e.getValue()),this.current_edit_record.first_name=e.getValue(),this.setDefaultUserName();break;case"last_name_1":(a=this.edit_view_ui_dic.last_name).setValue(e.getValue()),this.current_edit_record.last_name=e.getValue(),this.setDefaultUserName();break;case"country":(a=this.edit_view_ui_dic.province).setValue(null);break;case"default_job_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.setJobItemValueWhenJobChanged(e.getValue(!0),"default_job_item_id",{status_id:10,job_id:this.current_edit_record.default_job_id,company_id:this.select_company_id}),this.edit_view_ui_dic.job_quick_search.setCheckBox(!0));break;case"default_job_item_id":Global.getProductEdition()>=20&&(this.edit_view_ui_dic.job_item_quick_search.setValue(e.getValue(!0)&&e.getValue(!0).manual_id?e.getValue(!0).manual_id:""),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0));break;case"job_quick_search":case"job_item_quick_search":Global.getProductEdition()>=20&&(this.onJobQuickSearch(t,e.getValue(),"default_job_id","default_job_item_id",{status_id:10,company_id:this.select_company_id}),i=!0)}"country"!==t?i||this.validate():this.onCountryChange()}}hierarchyPermissionValidate(e,i){return!(!PermissionManager.validate("hierarchy","edit")&&!PermissionManager.validate("user","edit_hierarchy"))}checkTabPermissions(e){var i=!1;switch(e){case"tab_hierarchy":this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_wage":PermissionManager.checkTopLevelPermission("Wage")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_tax":PermissionManager.checkTopLevelPermission("UserTaxDeduction")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_payment_methods":PermissionManager.checkTopLevelPermission("RemittanceDestinationAccount")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_contacts":PermissionManager.checkTopLevelPermission("UserContact")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_applications":PermissionManager.subJobApplicationValidate("JobApplication")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_accruals":PermissionManager.checkTopLevelPermission("AccrualPolicy")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_qualifications":PermissionManager.checkTopLevelPermission("Qualification")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;case"tab_reviews":PermissionManager.checkTopLevelPermission("UserReviewControl")&&this.select_company_id===LocalCacheData.getCurrentCompany().id&&(i=!0);break;default:i=super.checkTabPermissions(e)}return i}setCurrentEditRecordData(){var e={};for(var i in this.current_edit_record){var t=this.edit_view_ui_dic[i];if(Global.isSet(t)||"hierarchy_control"===i)switch(i){case"first_name":case"last_name":e[i+"_1"]=!0,this.edit_view_ui_dic[i+"_1"].setValue(this.current_edit_record[i]),t.setValue(this.current_edit_record[i]);break;case"country":this.setCountryValue(t,i);break;case"hierarchy_control":if(this.show_hierarchy)for(var a in this.current_edit_record.hierarchy_control){var o=this.current_edit_record.hierarchy_control[a];this.edit_view_ui_dic[a]&&(t=this.edit_view_ui_dic[a],e[a]=!0,t.setValue(o))}break;case"default_job_id":var r={};r.filter_data={status_id:10,user_id:this.current_edit_record.id},t.setDefaultArgs(r),t.setValue(this.current_edit_record[i]);break;case"default_job_item_id":(r={}).filter_data={status_id:10,job_id:this.current_edit_record.default_job_id},t.setDefaultArgs(r),t.setValue(this.current_edit_record[i]);break;case"job_quick_search":case"job_item_quick_search":break;default:if(!e[i]){t.setValue(this.current_edit_record[i]);break}}}if(this.current_edit_record.id)this.file_browser&&(this.file_browser.show(),this.file_browser.setImage(ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+this.current_edit_record.id),this.is_viewing?this.file_browser.setEnable(!1):this.file_browser.setEnable(!0),$(".upload-image-alert").remove());else if(this.file_browser){this.file_browser.hide();var l=$('<span class="upload-image-alert">');l.text($.i18n._("Please save this record before uploading a photo")),this.file_browser.parent().append(l)}this.edit_view_ui_dic.company_id&&this.edit_view_ui_dic.company_id.setEnabled(!1),this.collectUIDataToCurrentEditRecord(),this.setEmailIcon(),this.setEditViewDataDone()}setEmailIcon(){var e=this;$(".employee-email-icon").remove();var i=$('<img title="'+$.i18n._("ReValidate Email Address")+'" class="employee-email-icon work-email" src="theme/default/images/email16x16.png">'),t=$('<img title="'+$.i18n._("ReValidate Email Address")+'" class="employee-email-icon home-email" src="theme/default/images/email16x16.png">');function a(){e.api.sendValidationEmail(e.current_edit_record.id,{onResult:function(e){e.isValid()?TAlertManager.showAlert($.i18n._("Validation email sent...")):TAlertManager.showAlert($.i18n._("No validation email sent..."))}})}this.current_edit_record.hasOwnProperty("work_email_is_valid")&&!this.current_edit_record.work_email_is_valid&&(this.edit_view_form_item_dic.work_email.children().eq(1).append(i),i.on("click",(function(){a()}))),this.current_edit_record.hasOwnProperty("home_email_is_valid")&&!this.current_edit_record.home_email_is_valid&&(this.edit_view_form_item_dic.home_email.children().eq(1).append(t),t.on("click",(function(){a()})))}onSaveDone(e){this.edit_only_mode&&"TimeSheet"===LocalCacheData.current_open_primary_controller.viewId&&LocalCacheData.current_open_primary_controller.updateSelectUserAndRefresh(this.current_edit_record)}getCopyAsNewFilter(e){return e.filter_data.company_id=this.select_company_id,e}onAddClick(){var e=this;this.setCurrentEditViewState("new"),e.openEditView(),e.api["get"+e.api.key_name+"DefaultData"](this.select_company_id,{onResult:function(i){e.onAddResult(i)}})}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var i={},t=this.getGridSelectIdArray();t.length;this.mass_edit_record_ids=[],$.each(t,(function(i,t){e.mass_edit_record_ids.push(t)})),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,i.filter_data.company_id=this.select_company_id,this.api["getCommon"+this.api.key_name+"Data"](i,{onResult:function(i){var t=i.getResult();t||(t=[]),e.api.getOptions("unique_columns",{onResult:function(i){e.unique_columns=i.getResult(),e.api.getOptions("linked_columns",{onResult:function(i){e.linked_columns=i.getResult(),e.sub_view_mode&&e.parent_key&&(t[e.parent_key]=e.parent_value),e.current_edit_record=t,e.initEditView()}})}})}})}getAPIFilters(){var e=super.getAPIFilters();return e.filter_data.company_id=this.select_company_id,e}search(e,i,t,a){Global.isSet(e)||(e=!0);var o=this,r={filter_data:{},filter_sort:{}};if(r.filter_columns=this.getFilterColumnsFromDisplayColumns(),r.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)r.filter_page="next"===i?this.pager_data.next_page:1;else switch(i){case"next":r.filter_page=this.pager_data.next_page;break;case"last":r.filter_page=this.pager_data.previous_page;break;case"start":r.filter_page=1;break;case"end":r.filter_page=this.pager_data.last_page_number;break;case"go_to":r.filter_page=t;break;default:r.filter_page=this.pager_data.current_page}else r.filter_page=1;if(this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),r.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),this.select_layout&&this.select_layout.data&&(r.filter_sort=this.select_layout.data.filter_sort),TTUUID.isUUID(this.refresh_id))r.filter_data={},r.filter_data.id=[this.refresh_id],this.last_select_ids=r.filter_data.id;else{this.last_select_ids=[];for(var l=this.getGridSelectIdArray(),n=0;n<l.length;n++)this.last_select_ids.push(l[n])}this.api["get"+this.api.key_name](r,{onResult:function(t){var r=t.getResult();if(Global.isArray(r)?(o.removeNoResultCover(),Global.isSet(o.__createRowId)&&(r=o.__createRowId(r)),r=Global.formatGridData(r,o.api.key_name)):o.showNoResultCover(),TTUUID.isUUID(o.refresh_id)){o.refresh_id=null;var l=o.grid.getData(),n=l.length;"array"!==$.type(l)&&(l=[]);var _=!1,s=r[0];if(s){for(var d=0;d<n;d++){if(l[d].id==s.id){o.grid.grid.setRowData(s.id,s),_=!0;break}}_||(o.grid.setData(l.concat(s)),o.highLightGridRowById(s.id))}}else{if(o.pager_data=t.getPagerData(),0!==LocalCacheData.paging_type&&(o.paging_widget.setPagerData(o.pager_data),o.paging_widget_2.setPagerData(o.pager_data)),0===LocalCacheData.paging_type&&"next"===i)r=o.grid.getData().concat(r);o.grid&&(o.grid.setData(r),o.reSelectLastSelectItems())}o.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&o.setDefaultMenu(!0),0===LocalCacheData.paging_type&&(!o.pager_data||o.pager_data.is_last_page?o.paging_widget.css("display","none"):o.paging_widget.css("display","block")),a&&a(t),e&&o.autoOpenEditViewIfNecessary(),o.searchDone()}}),r&&r.filter_data&&r.filter_data.company_id?(this.select_company_id=r.filter_data.company_id,this.user_group_api.getUserGroup({filter_data:{company_id:this.select_company_id}},!1,!1,{onResult:function(e){e=e.getResult(),e=Global.buildTreeRecord(e),o.edit_only_mode||!o.sub_view_mode&&o.basic_search_field_ui_dic.group_id&&(o.basic_search_field_ui_dic.group_id.setSourceData(e),o.adv_search_field_ui_dic.group_id.setSourceData(e)),o.user_group_array=e}})):this.select_company_id=LocalCacheData.getCurrentCompany().id}onCustomContextClick(e){switch(e){case ContextMenuIconName.import_icon:this.onImportClick();break;case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.pay_stub:case ContextMenuIconName.pay_stub_amendment:this.onNavigationClick(e)}}onMapClick(){if(Global.getProductEdition()>=15){this.is_viewing=!1,ProgressBar.showProgressBar();var e={filter_columns:{id:!0,first_name:!0,last_name:!0,address1:!0,address2:!0,city:!0,province:!0,country:!0,postal_code:!0,latitude:!0,longitude:!0}},i=[];if(this.is_edit)i.push(this.current_edit_record);else{var a=this.getGridSelectIdArray();e.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),a.length>0&&(e.filter_data.id=a),i=this.api.getUser(e,{async:!1}).getResult()}this.is_mass_editing||Promise.all([t.e("vendors-node_modules_leaflet-draw_dist_leaflet_draw_js-node_modules_leaflet_dist_leaflet-src_js"),t.e("vendors-node_modules_leaflet_dist_images_marker-icon-2x_png-node_modules_leaflet_dist_images_-e2a419"),t.e("interface_html5_framework_leaflet_leaflet-timetrex_js"),t.e("leaflet-timetrex")]).then(t.bind(t,6889)).then((e=>{var t=e.TTConvertMapData.processBasicFromGenericViewController(i);IndexViewController.openEditView(this,"Map",t)})).catch(Global.importErrorHandler)}}onImportClick(){var e=this;IndexViewController.openWizard("ImportCSVWizard","User",(function(){e.search()}))}onNavigationClick(e){var i,t=this,a={},o=[],r=(new Date).format();switch(t.edit_view&&t.current_edit_record.id?o.push(t.current_edit_record.id):(i=this.getGridSelectIdArray(),$.each(i,(function(e,i){var a=t.getRecordFromGridById(i);o.push(a.id)}))),e){case ContextMenuIconName.timesheet:o.length>0&&(a.user_id=o[0],a.base_date=r,Global.addViewTab(t.viewId,$.i18n._("Employees"),window.location.href),IndexViewController.goToView("TimeSheet",a));break;case ContextMenuIconName.schedule:a.filter_data={};var l={value:o};a.filter_data.include_user_ids=l,a.select_date=r,Global.addViewTab(this.viewId,$.i18n._("Employees"),window.location.href),IndexViewController.goToView("Schedule",a);break;case ContextMenuIconName.pay_stub:o.length>0&&(a.filter_data={},a.filter_data.user_id=o[0],Global.addViewTab(t.viewId,$.i18n._("Employees"),window.location.href),IndexViewController.goToView("PayStub",a));break;case ContextMenuIconName.pay_stub_amendment:o.length>0&&(a.filter_data={},a.filter_data.user_id=o[0],Global.addViewTab(this.viewId,$.i18n._("Employees"),window.location.href),IndexViewController.goToView("PayStubAmendment",a))}}removeEditView(){super.removeEditView(),this.sub_user_contact_view_controller=null,this.sub_wage_view_controller=null,this.sub_company_tax_view_controller=null,this.sub_accrual_policy_user_modifier_view_controller=null,this.sub_user_review_control_view_controller=null,this.sub_job_application_view_controller=null,this.sub_user_skill_view_controller=null,this.sub_user_education_view_controller=null,this.sub_user_membership_view_controller=null,this.sub_user_license_view_controller=null,this.sub_user_language_view_controller=null,this.sub_payment_methods_view_controller=null}buildEditViewUI(){super.buildEditViewUI();var e=this,i={"tab_employee":{"label":$.i18n._("Employee")},"tab_contact_info":{"label":$.i18n._("Contact Info")},"tab_hierarchy":{"label":$.i18n._("Hierarchy"),"display_on_mass_edit":!1},"tab_login":{"label":$.i18n._("Login")},"tab_wage":{"label":$.i18n._("Wage"),"init_callback":"initSubWageView","display_on_mass_edit":!1},"tab_tax":{"label":$.i18n._("Tax"),"init_callback":"initSubCompanyTaxView","display_on_mass_edit":!1},"tab_payment_methods":{"label":$.i18n._("Pay Methods"),"init_callback":"initSubPaymentMethodsView","display_on_mass_edit":!1},"tab_contacts":{"label":$.i18n._("Contacts"),"init_callback":"initSubUserContactView","display_on_mass_edit":!1},"tab_applications":{"label":$.i18n._("Applications"),"init_callback":"initSubJobApplicationView","display_on_mass_edit":!1},"tab_accruals":{"label":$.i18n._("Accruals"),"init_callback":"initSubAccrualPolicyUserModifier","display_on_mass_edit":!1},"tab_qualifications":{"label":$.i18n._("Qualifications"),"init_callback":"initSubQualificationView","display_on_mass_edit":!1},"tab_reviews":{"label":$.i18n._("Reviews"),"init_callback":"initSubUserReviewControlView","display_on_mass_edit":!1},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(i),this.edit_only_mode||(this.navigation.AComboBox({id:this.script_name+"_navigation",api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var t=this.edit_view_tab.find("#tab_employee"),a=t.find(".first-column"),o=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a),this.edit_view_tabs[0].push(o);var r=Global.loadWidgetByName(FormItemType.AWESOME_BOX);if(r.AComboBox({api_class:TTAPI.APICompany,allow_multiple_selection:!1,layout_name:"global_company",show_search_inputs:!0,set_empty:!0,field:"company_id"}),this.addEditFieldToColumn($.i18n._("Company"),r,a),r.setEnabled(!1),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APILegalEntity,allow_multiple_selection:!1,layout_name:"global_legal_entity",show_search_inputs:!0,field:"legal_entity_id",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},set_empty:!0}),this.addEditFieldToColumn($.i18n._("Legal Entity"),r,a),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),r.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),r,a),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"first_name",width:200}),this.addEditFieldToColumn($.i18n._("First Name"),r,a,""),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"last_name",width:200}),this.addEditFieldToColumn($.i18n._("Last Name"),r,a),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"employee_number",width:90}),this.addEditFieldToColumn($.i18n._("Employee Number"),r,a),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPermissionControl,allow_multiple_selection:!1,layout_name:"global_permission_control",show_search_inputs:!0,field:"permission_control_id",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},set_empty:!0}),this.addEditFieldToColumn($.i18n._("Permission Group"),r,a),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPayPeriodSchedule,allow_multiple_selection:!1,layout_name:"global_pay_period_schedule",show_search_inputs:!0,customSearchFilter:function(i){return e.setCompanyIdFilter(i)},set_empty:!0,field:"pay_period_schedule_id"}),this.addEditFieldToColumn($.i18n._("Pay Period Schedule"),r,a),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPolicyGroup,allow_multiple_selection:!1,layout_name:"global_policy_group",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,set_empty:!0,field:"policy_group_id"}),this.addEditFieldToColumn($.i18n._("Policy Group"),r,a),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUserTitle,allow_multiple_selection:!1,layout_name:"global_job_title",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,set_empty:!0,field:"title_id"}),this.addEditFieldToColumn($.i18n._("Title"),r,a,""),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,field:"currency_id",set_empty:!0}),this.addEditFieldToColumn($.i18n._("Currency"),r,o),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,customSearchFilter:function(i){return e.setCompanyIdFilter(i)},layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"default_branch_id"}),this.addEditFieldToColumn($.i18n._("Default Branch"),r,o),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,set_empty:!0,field:"default_department_id"}),this.addEditFieldToColumn($.i18n._("Default Department"),r,o),this.initPermission(),Global.getProductEdition()>=20){(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&n.setValue(e.manual_id)},field:"default_job_id"});var l=$("<div class='widget-h-box'></div>"),n=Global.loadWidgetByName(FormItemType.TEXT_INPUT);n.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),n.addClass("job-coder"),l.append(n),l.append(r),this.addEditFieldToColumn($.i18n._("Default Job"),[r,n],o,"",l,!0),this.show_job_ui||this.detachElement("default_job_id"),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&d.setValue(e.manual_id)},field:"default_job_item_id"});var s=$("<div class='widget-h-box'></div>"),d=Global.loadWidgetByName(FormItemType.TEXT_INPUT);d.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),d.addClass("job-coder"),s.append(d),s.append(r),this.addEditFieldToColumn($.i18n._("Default Task"),[r,d],o,"",s,!0),this.show_job_item_ui||this.detachElement("default_job_item_id")}(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),r.setSourceData(e.user_group_array),this.addEditFieldToColumn($.i18n._("Group"),r,o),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIEthnicGroup,allow_multiple_selection:!1,layout_name:"global_ethnic_group",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},show_search_inputs:!0,field:"ethnic_group_id",set_empty:!0}),this.addEditFieldToColumn($.i18n._("Ethnicity"),r,o),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"sin",width:90}),this.addEditFieldToColumn($.i18n._("SIN / SSN"),r,o),(r=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"birth_date"}),this.addEditFieldToColumn($.i18n._("Birth Date"),r,o),(r=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"hire_date"}),this.addEditFieldToColumn($.i18n._("Hire Date"),r,o),(r=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"termination_date"}),this.addEditFieldToColumn($.i18n._("Termination Date"),r,o),(r=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:200}),this.addEditFieldToColumn($.i18n._("Tags"),r,o,"",null,null,!0);var c=this.edit_view_tab.find("#tab_contact_info"),u=c.find(".first-column"),m=c.find(".second-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(u),this.edit_view_tabs[1].push(m),"undefined"==typeof FormData?(r=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=r.TImageBrowser({field:"",default_width:128,default_height:128,enable_delete:!0}),this.file_browser.bind("imageChange",(function(i,t){(new ServiceCaller).uploadFile(t.getValue(),"object_type=user_photo&object_id="+e.current_edit_record.id,{onResult:function(i){"true"===i.toLowerCase()?e.file_browser.setImage(ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+e.current_edit_record.id):TAlertManager.showAlert(i,"Error")}})}))):(r=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=r.TImageAdvBrowser({field:"",default_width:128,default_height:128,enable_delete:!0,callBack:function(i){(new ServiceCaller).uploadFile(i,"object_type=user_photo&object_id="+e.current_edit_record.id,{onResult:function(i){"true"===i.toLowerCase()?e.file_browser.setImage(ServiceCaller.getURLByObjectType("user_photo")+"&object_id="+e.current_edit_record.id):TAlertManager.showAlert(i,"Error")}})},deleteImageHandler:function(i){e.onDeleteImage()}})),this.is_edit&&(this.file_browser.setEnableDelete(!0),this.file_browser.bind("deleteClick",(function(i,t){e.api.deleteImage(e.current_edit_record.id,{onResult:function(i){e.onDeleteImage()}})}))),this.addEditFieldToColumn($.i18n._("Photo"),this.file_browser,u,"",null,!1,!0),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"first_name_1",width:200}),this.addEditFieldToColumn($.i18n._("First Name"),r,u),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"middle_name",width:200}),this.addEditFieldToColumn($.i18n._("Middle Name"),r,u),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"last_name_1",width:200}),this.addEditFieldToColumn($.i18n._("Last Name"),r,u),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn($.i18n._("Home Address (Line 1)"),r,u),r.parent().width("45%"),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn($.i18n._("Home Address (Line 2)"),r,u),r.parent().width("45%"),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"city",width:200}),this.addEditFieldToColumn($.i18n._("City"),r,u),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"country",set_empty:!0}),r.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Country"),r,u),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"province"}),r.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province/State"),r,u),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"postal_code",width:200}),this.addEditFieldToColumn($.i18n._("Postal/ZIP Code"),r,u,""),(r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"sex_id"}),r.setSourceData(e.sex_array),this.addEditFieldToColumn($.i18n._("Gender"),r,m),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone",width:200}),this.addEditFieldToColumn($.i18n._("Work Phone"),r,m,""),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone_ext"}),r.css("width","50"),this.addEditFieldToColumn($.i18n._("Work Phone Ext"),r,m),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"home_phone",width:200}),this.addEditFieldToColumn($.i18n._("Home Phone"),r,m),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"mobile_phone",width:200}),this.addEditFieldToColumn($.i18n._("Mobile Phone"),r,m),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"fax_phone",width:200}),this.addEditFieldToColumn($.i18n._("Fax"),r,m),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_email",width:200}),this.addEditFieldToColumn($.i18n._("Work Email"),r,m,"",null,!0),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"home_email",width:200}),this.addEditFieldToColumn($.i18n._("Home Email"),r,m,"",null,!0),(r=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%",rows:4}),this.addEditFieldToColumn($.i18n._("Note"),r,m,"",null,null,!0),r.parent().width("45%");var h=this.edit_view_tab.find("#tab_hierarchy").find(".first-column");if(this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(h),this.hierarchyPermissionValidate()){var p=this.hierarchyControlAPI.getHierarchyControlOptions({async:!1});e.hierarchy_options_dic={};var b=p.getResult();for(var w in b)200===parseInt(w)&&25!=Global.getProductEdition()||(e.hierarchy_options_dic[w]=Global.buildRecordArray(b[w]));_.size(e.hierarchy_options_dic)>0?e.show_hierarchy=!0:e.show_hierarchy=!1}if(this.show_hierarchy&&this.hierarchy_ui_model){this.edit_view_tab.find("#tab_hierarchy").find(".first-column").css("display","block"),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").css("display","none");for(var f=this.hierarchy_ui_model.length,y=0;y<f;y++){var v=this.hierarchy_ui_model[y],g=this.hierarchy_options_dic[v.id];g&&((r=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:v.id}),r.setSourceData(g),this.addEditFieldToColumn(v.value,r,h))}}else this.edit_view_tab.find("#tab_hierarchy").find(".first-column").css("display","none"),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").NoHierarchyBox({related_view_controller:this}),this.edit_view_tab.find("#tab_hierarchy").find(".hierarchy-div").css("display","block");var T=this.edit_view_tab.find("#tab_login"),I=T.find(".first-column"),C=T.find(".second-column");this.edit_view_tabs[3]=[],this.edit_view_tabs[3].push(I),this.edit_view_tabs[3].push(C),(r=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT)).TPasswordInput({field:"current_password",width:200}),this.addEditFieldToColumn($.i18n._("Current Password"),r,I,"",null,!0),(r=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"enable_login"}),this.addEditFieldToColumn($.i18n._("Login Enabled"),r,I),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"user_name",width:200}),this.addEditFieldToColumn($.i18n._("User Name"),r,I),(r=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT)).TTextInput({field:"password",width:200}),this.addEditFieldToColumn($.i18n._("Change Password"),r,I),(r=Global.loadWidgetByName(FormItemType.PASSWORD_INPUT)).TTextInput({field:"password_confirm",width:200}),this.addEditFieldToColumn($.i18n._("Confirm Password"),r,I),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"phone_id",width:90});var P=$("<div class='widget-h-box'></div>");P.append(r),P.append($("<span class='widget-right-label'>( "+$.i18n._("Optional")+" )</span>")),this.addEditFieldToColumn($.i18n._("Quick Punch ID"),r,C,"",P),(r=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"phone_password",width:90}),this.addEditFieldToColumn($.i18n._("Quick Punch Password"),r,C),(r=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"login_expire_date"});var E=$("<div class='widget-h-box'></div>");E.append(r),E.append($("<span class='widget-right-label'>( "+$.i18n._("Leave blank to never expire")+" )</span>")),this.addEditFieldToColumn($.i18n._("Login Expire Date"),r,C,"",E),(r=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPermissionControl,allow_multiple_selection:!1,layout_name:"global_permission_control",show_search_inputs:!0,field:"terminated_permission_control_id",customSearchFilter:function(i){return e.setCompanyIdFilter(i)},set_empty:!0}),this.addEditFieldToColumn($.i18n._("Terminated Permission Group"),r,C),TTPromise.resolve("employeeEditView","openEditView")}setProvince(e,i){var t=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),t.province_array=Global.buildRecordArray(e),t.adv_search_field_ui_dic.province.setSourceData(t.province_array)}}):(t.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e,i){var t=this,a=t.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),t.e_province_array=Global.buildRecordArray(e),i&&t.e_province_array.length>0&&(t.current_edit_record.province=t.e_province_array[0].value,a.setValue(t.current_edit_record.province)),a.setSourceData(t.e_province_array)}}):(t.e_province_array=[],a.setSourceData([]))}onSetSearchFilterFinished(){if(1===this.search_panel.getSelectTabIndex()){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e)}}onBuildBasicUIFinished(){this.search_panel.find("div #basic_search")}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}buildSearchFields(){super.buildSearchFields();var e=this;this.search_fields=[new SearchField({label:$.i18n._("Company"),in_column:1,field:"company_id",layout_name:"global_company",api_class:TTAPI.APICompany,multiple:!1,custom_first_label:Global.default_item,basic_search:!!PermissionManager.checkTopLevelPermission("Companies"),adv_search:!!PermissionManager.checkTopLevelPermission("Companies"),form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Legal Entity"),in_column:1,field:"legal_entity_id",layout_name:"global_legal_entity",api_class:TTAPI.APILegalEntity,multiple:!0,custom_first_label:Global.any_item,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("First Name"),in_column:1,field:"first_name",basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Last Name"),field:"last_name",basic_search:!0,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Employee Number"),field:"employee_number",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Phone"),field:"any_phone",basic_search:!1,adv_search:!0,in_column:1,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Email"),field:"any_email",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:2,object_type_id:200,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Gender"),in_column:2,field:"sex_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,customSearchFilter:function(i){return e.setCompanyIdFilter(i)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,customSearchFilter:function(i){return e.setCompanyIdFilter(i)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Title"),field:"title_id",in_column:3,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,customSearchFilter:function(i){return e.setCompanyIdFilter(i)},form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Country"),in_column:3,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:3,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("SIN/SSN"),field:"sin",basic_search:!1,adv_search:!0,in_column:3,form_item_type:FormItemType.TEXT_INPUT})]}setCompanyIdFilter(e){return e?e.filter_data?e.filter_data.company_id=this.select_company_id:e.filter_data={company_id:this.select_company_id}:e={filter_data:{company_id:this.select_company_id}},e}cleanWhenUnloadView(e){$("#employee_view_container").remove(),super.cleanWhenUnloadView(e)}getFilterColumnsFromDisplayColumns(e,i){return null==e&&(e={}),e.company_id=!0,e.latitude=!0,e.longitude=!0,this._getFilterColumnsFromDisplayColumns(e,i)}}}}]);
//# sourceMappingURL=employees-employee-EmployeeViewController.bundle.js.map?v=96dc4f0a7d1caddd6a0c