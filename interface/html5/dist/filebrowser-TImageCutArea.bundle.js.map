{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImageCutArea.js"],"names":["$","jQuery","fn","TImageCutArea","options","Global","addCss","field","opts","extend","defaults","$this","this","clearErrorStyle","getField","getValue","setAfterImage","val","image","children","eq","Date","attr","setImage","setTimeout","imgAreaSelect","handles","x1","y1","x2","width","y2","height","onSelectEnd","img","selection","rate","naturalWidth","sx","sy","canvas","getContext","drawImage","toDataURL","getAfterImageSrc","clearSelect","remove","setValue","i","length","$item","o","meta","data","default_width","default_height","isSet","name","on"],"mappings":"yGAAA,IAAYA,KAoLPC,QAlLFC,GAAGC,cAAgB,SAAUC,GAE9BC,OAAOC,OAAQ,gDACf,IAGIC,EAHAC,EAAOR,EAAES,OAAQ,GAAIT,EAAEE,GAAGC,cAAcO,SAAUN,GAElDO,EAAQC,KAUZA,KAAKC,gBAAkB,aAIvBD,KAAKE,SAAW,WACf,OAAOP,GAGRK,KAAKG,SAAW,aAIhB,IAAIC,EAAgB,SAAUC,GAC7B,IAAIC,EAAQP,EAAMQ,WAAWC,GAAI,GAAID,WAAWC,GAAI,GAE9CH,GAIE,IAAII,KACZH,EAAMI,KAAM,MAAOL,IAJlBC,EAAMI,KAAM,MAAO,KAQrBV,KAAKW,SAAW,SAAUN,GACzB,IAAIC,EAAQP,EAAMQ,WAAWC,GAAI,GAAID,WAAWC,GAAI,GAE9CH,GAIE,IAAII,KACZH,EAAMI,KAAM,MAAOL,GAEnBD,EAAeC,GAEfO,YAAY,WACXxB,EAAGkB,GAAQO,cAAe,CACzBC,SAAS,EACTC,GAAI,EACJC,GAAI,EACJC,GAAI7B,EAAGkB,GAAQY,QACfC,GAAI/B,EAAGkB,GAAQc,SACfC,YAAa,SAAUC,EAAKC,GAE3B,IAAIC,EAAOlB,EAAM,GAAGmB,aAAenB,EAAMY,QACrCQ,EAAKH,EAAUR,GAAKS,EACpBG,EAAKJ,EAAUP,GAAKQ,EAGpBN,GAFKK,EAAUN,GACVM,EAAUJ,GACPI,EAAUL,MAAQM,GAC1BJ,EAASG,EAAUH,OAASI,EAE5BI,EAASxC,EAAG,sBAChBwC,EAASA,EAAO,IACTV,MAAQA,EACfU,EAAOR,OAASA,EACNQ,EAAOC,WAAY,MAEzBC,UAAWxB,EAAM,GAAIoB,EAAIC,EAAIT,EAAQ,EAAGE,EAAS,EAAG,EAAG,EAAGF,EAAOE,GACrEhB,EAAe,IACfA,EAAewB,EAAOG,kBAItB,MArCFzB,EAAMI,KAAM,MAAO,KAyCrBV,KAAKgC,iBAAmB,WAGvB,OAFYjC,EAAMQ,WAAWC,GAAI,GAAID,WAAWC,GAAI,GAEvCE,KAAM,QAGpBV,KAAKiC,YAAc,WAClB,IAAI3B,EAAQP,EAAMQ,WAAWC,GAAI,GAAID,WAAWC,GAAI,GAEpDpB,EAAGkB,GAAQO,cAAe,CAAEqB,QAAQ,KAsCrClC,KAAKmC,SAAW,SAAU9B,GAEnBA,IACLA,EAAM,KAKR,IAAM,IAAI+B,EAAI,EAAGA,EAAIpC,KAAKqC,OAAQD,IAAM,CACvC,IAAIE,EAAQtC,KAAKoC,GAEbG,EAAInD,EAAEoD,KAAOpD,EAAES,OAAQ,GAAID,EAAMR,EAAGkD,GAAQG,QAAW7C,EAE3DD,EAAQ4C,EAAE5C,MAEL4C,EAAEG,cAAgB,GACNH,EAAEG,cAGdH,EAAEI,eAAiB,GACNJ,EAAEI,eAGflD,OAAOmD,MAAOL,EAAEM,OACbN,EAAEM,KAGEzD,EAAGkD,GAAQ/B,WAAWC,GAAI,GAAID,WAAWC,GAAI,GACnDsC,GAAI,QAAQ,eAKA1D,EAAGkD,GAAQ/B,WAAWC,GAAI,GAAID,WAAWC,GAAI,GACnDsC,GAAI,QAAQ,eAOzB,OAAO9C,MAIRZ,EAAEE,GAAGC,cAAcO,SAAW","file":"filebrowser-TImageCutArea.bundle.js?v=09c340eb717a8bc8fe31","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageCutArea = function( options ) {\n\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageCutArea.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar name = 'filedata';\n\n\t\tvar default_width = 400;\n\t\tvar default_height = 300;\n\n\t\tvar default_after_width = 200;\n\t\tvar default_after_height = 150;\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\n\t\t};\n\n\t\tvar setAfterImage = function( val ) {\n\t\t\tvar image = $this.children().eq( 1 ).children().eq( 1 );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\timage.attr( 'src', val );\n\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.children().eq( 0 ).children().eq( 1 );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar d = new Date();\n\t\t\timage.attr( 'src', val );\n\n\t\t\tsetAfterImage( val );\n\n\t\t\tsetTimeout( function() {\n\t\t\t\t$( image ).imgAreaSelect( {\n\t\t\t\t\thandles: true,\n\t\t\t\t\tx1: 0,\n\t\t\t\t\ty1: 0,\n\t\t\t\t\tx2: $( image ).width(),\n\t\t\t\t\ty2: $( image ).height(),\n\t\t\t\t\tonSelectEnd: function( img, selection ) {\n\n\t\t\t\t\t\tvar rate = image[0].naturalWidth / image.width();\n\t\t\t\t\t\tvar sx = selection.x1 * rate;\n\t\t\t\t\t\tvar sy = selection.y1 * rate;\n\t\t\t\t\t\tvar tx = selection.x2 * rate;\n\t\t\t\t\t\tvar ty = selection.y2 * rate - 1;\n\t\t\t\t\t\tvar width = selection.width * rate;\n\t\t\t\t\t\tvar height = selection.height * rate;\n\n\t\t\t\t\t\tvar canvas = $( '<canvas></canvas>' );\n\t\t\t\t\t\tcanvas = canvas[0];\n\t\t\t\t\t\tcanvas.width = width;\n\t\t\t\t\t\tcanvas.height = height;\n\t\t\t\t\t\tvar ctx = canvas.getContext( '2d' );\n\n\t\t\t\t\t\tctx.drawImage( image[0], sx, sy, width - 1, height - 1, 0, 0, width, height );\n\t\t\t\t\t\tsetAfterImage( '' );\n\t\t\t\t\t\tsetAfterImage( canvas.toDataURL() );\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}, 100 );\n\n\t\t};\n\n\t\tthis.getAfterImageSrc = function() {\n\t\t\tvar image = $this.children().eq( 1 ).children().eq( 1 );\n\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.clearSelect = function() {\n\t\t\tvar image = $this.children().eq( 0 ).children().eq( 1 );\n\n\t\t\t$( image ).imgAreaSelect( { remove: true } );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n//\t\t\tif ( $( image ).height() > default_height ) {\n//\t\t\t\t$( image ).css( 'height', default_height );\n//\n//\t\t\t}\n//\n//\t\t\tif ( $( image ).width() > default_width ) {\n//\t\t\t\t$( image ).css( 'width', default_width );\n//\n//\t\t\t\t$( image ).css( 'height', 'auto' );\n//\t\t\t}\n\n//\t\t\t$( image ).show();\n\n\t\t};\n\n\t\tvar onAfterImageLoad = function( image ) {\n\n//\t\t\tif ( $( image ).height() > default_after_height ) {\n//\t\t\t\t$( image ).css( 'height', default_after_height );\n//\n//\t\t\t}\n//\n//\t\t\tif ( $( image ).width() > default_after_width ) {\n//\t\t\t\t$( image ).css( 'width', default_after_width );\n//\n//\t\t\t\t$( image ).css( 'height', 'auto' );\n//\t\t\t}\n\n//\t\t\t$( image ).show();\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tfor ( var i = 0; i < this.length; i++ ) {\n\t\t\tvar $item = this[i];\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( $item ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tvar image = $( $item ).children().eq( 0 ).children().eq( 1 );\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tvar after_image = $( $item ).children().eq( 1 ).children().eq( 1 );\n\t\t\tafter_image.on( 'load', function() {\n\t\t\t\tonAfterImageLoad( this );\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageCutArea.defaults = {};\n\n} )( jQuery );"],"sourceRoot":""}