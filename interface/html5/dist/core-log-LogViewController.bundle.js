(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["core-log-LogViewController"],{7590:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"LogViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#log_view_container",tables:{"product":["product","product_price"],"user_contact":["user_contact"],"users":["users","user_preference","user_wage","authentication"],"user_wage":["user_wage"],"user_title":["user_title"],"user_preference":["user_preference"],"bank_account":["bank_account"],"user_default":["user_default"],"user_group":["user_group"],"company":["company"],"pay_period_schedule":["pay_period_schedule","pay_period","pay_period_schedule_user"],"pay_period":["pay_period"],"branch":["branch"],"department":["department"],"hierarchy_control":["hierarchy_control","hierarchy_object_type","hierarchy_user","hierarchy_level"],"wage_group":["wage_group"],"ethnic_group":["ethnic_group"],"currency":["currency"],"currency_rate":["currency_rate"],"permission_control":["permission_control","permission_user"],"other_field":["other_field"],"station":["station","station_user_group","station_branch","station_department","station_include_user","station_exclude_user"],"pay_stub_amendment":["pay_stub_amendment"],"recurring_ps_amendment":["recurring_ps_amendment","recurring_ps_amendment_user"],"pay_stub_entry_account":["pay_stub_entry_account"],"company_deduction":["company_deduction","user_deduction","company_deduction_pay_stub_entry_account"],"user_expense":["user_expense"],"round_interval_policy":["round_interval_policy"],"meal_policy":["meal_policy"],"break_policy":["break_policy"],"over_time_policy":["over_time_policy"],"absence_policy":["absence_policy"],"recurring_holiday":["recurring_holiday"],"holiday_policy":["holiday_policy","holiday_policy_recurring_holiday"],"holidays":["holidays"],"premium_policy":["premium_policy"],"policy_group":["policy_group","policy_group_user"],"document":["document","document_revision"],"document_group":["document_group"],"document_revision":["document_revision"],"schedule_policy":["schedule_policy"],"accrual_policy":["accrual_policy","accrual_policy_milestone","accrual_policy_user_modifier"],"client":["client","client_contact","client_payment"],"report_custom_column":["report_custom_column"],"client_contact":["client_contact"],"client_payment":["client_payment"],"invoice_transaction":["invoice_transaction"],"invoice":["invoice"],"job":["job","job_exclude_job_item","job_exclude_user","job_include_job_item","job_include_user","job_job_item_group","job_user_branch","job_user_group","job_user_department"],"client_group":["client_group"],"product_group":["product_group"],"job_item":["job_item"],"job_group":["job_group"],"job_item_group":["job_item_group"],"report_schedule":["report_schedule"],"accrual_policy_account":["accrual_policy_account"],"accrual":["accrual"],"accrual_balance":["accrual_balance"],"schedule":["schedule"],"recurring_schedule_control":["recurring_schedule_control","recurring_schedule_user"],"recurring_schedule_template_control":["recurring_schedule_template_control","recurring_schedule_template"],"punch":["punch","punch_control"],"kpi":["kpi"],"kpi_group":["kpi_group"],"qualification":["qualification"],"qualification_group":["qualification_group"],"user_skill":["user_skill"],"user_education":["user_education"],"user_membership":["user_membership"],"user_license":["user_license"],"user_language":["user_language"],"job_vacancy":["job_vacancy"],"job_application":["job_application"],"job_applicant":["job_applicant"],"invoice_district":["invoice_district"],"job_applicant_employment":["job_applicant_employment"],"job_applicant_reference":["job_applicant_reference"],"job_applicant_location":["job_applicant_location"],"job_applicant_skill":["job_applicant_skill"],"job_applicant_education":["job_applicant_education"],"job_applicant_license":["job_applicant_license"],"job_applicant_membership":["job_applicant_membership"],"job_applicant_language":["job_applicant_language"],"tax_policy":["tax_policy"],"area_policy":["area_policy"],"shipping_policy":["shipping_policy"],"payment_gateway":["payment_gateway"],"request":["request"],"exception_policy_control":["exception_policy_control","exception_policy"],"user_review_control":["user_review_control","user_review"],"roe":["roe"],"expense_policy":["expense_policy"],"user_report_data":["user_report_data"],"regular_time_policy":["regular_time_policy"],"pay_code":["pay_code"],"pay_formula_policy":["pay_formula_policy"],"contributing_pay_code_policy":["contributing_pay_code_policy"],"contributing_shift_policy":["contributing_shift_policy"],"accrual_policy_user_modifier":["accrual_policy_user_modifier"],"job_item_amendment":["job_item_amendment"],"user_date_total":["user_date_total"],"pay_stub":["pay_stub","pay_stub_entry"],"legal_entity":["legal_entity"],"payroll_remittance_agency":["payroll_remittance_agency"],"payroll_remittance_agency_event":["payroll_remittance_agency_event"],"remittance_source_account":["remittance_source_account"],"remittance_destination_account":["remittance_destination_account"],"geo_fence":["geo_fence"]},log_detail_grid:null,log_detail_script_name:null}),super(e)}init(e){this.edit_view_tpl="LogEditView.html",this.context_menu_name=$.i18n._("Audit"),this.navigation_label=$.i18n._("Audit")+":",this.viewId="Log",this.script_name="LogView",this.log_detail_script_name="LogDetailView",this.api=TTAPI.APILog,this.noticeDiv=$(".audit-info"),this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu()}buildEditViewUI(){super.buildEditViewUI();var e={"tab_audit_details":{"label":$.i18n._("Audit Details")}};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APILog,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_log",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var t=this.edit_view_tab.find("#tab_audit_details").find(".first-row"),i=Global.loadWidgetByName(FormItemType.TEXT);i.TText({field:"date"}),this.addEditFieldToColumn($.i18n._("Date"),i,t,""),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"action"}),this.addEditFieldToColumn($.i18n._("Action"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"user_name"}),this.addEditFieldToColumn($.i18n._("Employee"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"description"}),this.addEditFieldToColumn($.i18n._("Description"),i,t,""),this.initLogDetailsView()}search(e,t,i,a){Global.isSet(e)||(e=!0);var r=this,o={filter_data:{},filter_sort:{}};if(o.filter_columns=this.getFilterColumnsFromDisplayColumns(),o.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)o.filter_page="next"===t?this.pager_data.next_page:1;else switch(t){case"next":o.filter_page=this.pager_data.next_page;break;case"last":o.filter_page=this.pager_data.previous_page;break;case"start":o.filter_page=1;break;case"end":o.filter_page=this.pager_data.last_page_number;break;case"go_to":o.filter_page=i;break;default:o.filter_page=this.pager_data.current_page}else o.filter_page=1;this.select_layout&&this.select_layout.data&&(this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),o.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),o.filter_sort=this.select_layout.data.filter_sort),TTUUID.isUUID(this.refresh_id)?(o.filter_data={},o.filter_data.id=[this.refresh_id],this.last_select_ids=o.filter_data.id):this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](o,{onResult:function(i){var o,_=i.getResult();if(Global.isArray(_)?(r.removeNoResultCover(),Global.isSet(r.__createRowId)&&(_=r.__createRowId(_)),o=(_=Global.formatGridData(_,r.api.key_name)).length):r.showNoResultCover(),r.setAuditInfo(),TTUUID.isUUID(r.refresh_id)){r.refresh_id=null;var l=r.grid.grid.getGridParam("data");o=l.length,"array"!==$.type(l)&&(l=[]);var n=!1,s=_[0];if(s){for(var c=0;c<o;c++){if(l[c].id==s.id){r.grid.grid.setRowData(s.id,s),n=!0;break}}n||(l.push(s),r.grid.setData(l))}}else{if(r.pager_data=i.getPagerData(),0!==LocalCacheData.paging_type&&(r.paging_widget.setPagerData(r.pager_data),r.paging_widget_2.setPagerData(r.pager_data)),0===LocalCacheData.paging_type&&"next"===t)_=r.grid.getGridParam("data").concat(_);_=r.processResultData(_),r.grid&&(r.grid.setData(_),r.setGridColumnsWidth(),r.sub_view_mode&&Global.isSet(r.resizeSubGrid)&&r.resizeSubGrid(o),r.reSelectLastSelectItems())}r.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&r.setDefaultMenu(!0),0===LocalCacheData.paging_type&&(!r.pager_data||r.pager_data.is_last_page?r.paging_widget.css("display","none"):r.paging_widget.css("display","block")),a&&a(i),e&&r.autoOpenEditViewIfNecessary(),r.searchDone()}})}getGridSetup(){var e=this;return{container_selector:this.sub_view_mode?".edit-view-tab-bar":"body",sub_grid_mode:this.sub_view_mode,onResizeGrid:!0,multiselect:!1,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(t){e.onGridDblClickRow(t)},onRightClickRow:function(t){e.getGridSelectIdArray().indexOf(t)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(t),e.onGridSelectRow())},setGridSize:function(){e.baseViewSubTabGridResize("tab_audit")}}}_setGridSizeGridHeight(e){this.pager_data&&this.pager_data.last_page_number>1?this.grid.setGridHeight($(this.el).parent().parent().parent().height()-101-e):this.grid.setGridHeight($(this.el).parent().parent().parent().height()-78-e)}setAuditInfo(){var e=(this.parent_edit_record.updated_date||$.i18n._("N/A"))+" "+$.i18n._("by")+" "+(this.parent_edit_record.updated_by||$.i18n._("N/A"))+" ",t=(this.parent_edit_record.created_date||$.i18n._("N/A"))+" "+$.i18n._("by")+" "+(this.parent_edit_record.created_by||$.i18n._("N/A"))+" ";this.noticeDiv.find(".left > .info").text(e),this.noticeDiv.find(".right > .info").text(t)}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"view":LocalCacheData.edit_id_for_next_open_view&&(this.onViewClick(LocalCacheData.edit_id_for_next_open_view),LocalCacheData.edit_id_for_next_open_view=null)}this.autoOpenEditOnlyViewIfNecessary()}initLogDetailsView(e){var t=this.edit_view.find("#grid");t&&t.attr("id",this.log_detail_script_name+"_grid");var i=[],a=[{label:$.i18n._("Field"),value:"display_field"},{label:$.i18n._("Before"),value:"old_value"},{label:$.i18n._("After"),value:"new_value"}],r=a.length,o=0;Global.isSet(e)&&e>0&&(o=e);for(var _=o;_<r;_++){var l=a[_],n={name:l.value,index:l.value,label:l.label,width:100,sortable:!1,title:!1};i.push(n)}var s={container_selector:this.sub_view_mode?".edit-view-tab-bar":"body",sub_grid_mode:this.sub_view_mode,onResizeGrid:!0,multiselect:!1};this.log_detail_grid=new TTGrid(this.log_detail_script_name+"_grid",s,i)}initEditViewData(){super.initEditViewData(),Global.getProductEdition()>=15?(this.edit_view_tab.find("#tab_audit_details").find(".detail-grid-row").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none")):(this.edit_view_tab.find("#tab_audit_details").find(".detail-grid-row").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage())),this.log_detail_grid.setGridColumnsWidth()}onGridDblClickRow(){this.onViewDetailClick()}setCurrentEditRecordData(){for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"user_name":t.setValue(this.current_edit_record.first_name+" "+this.current_edit_record.last_name);break;default:t.setValue(this.current_edit_record[e])}else switch(e){case"details":this.setLogDetailsViewData(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setLogDetailsViewData(e){var t=this;Global.isArray(e)?t.removeNoResultCover():t.showDetailNoResultCover(),e=Global.formatGridData(e),t.log_detail_grid.setData(e),t.setLogDetailGridSize()}setLogDetailGridSize(){if(this.log_detail_grid&&$(this.log_detail_grid.grid).is(":visible")){var e=this.edit_view.find("#tab_audit_details_content_div"),t=this.edit_view.find(".first-row");this.log_detail_grid.grid.setGridWidth(e.width()),this.log_detail_grid.grid.setGridHeight(e.height()-t.height())}}showDetailNoResultCover(){this.removeNoResultCover(),this.no_result_box=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.no_result_box.NoResultBox({related_view_controller:this,is_new:!1}),this.edit_view.find(".grid-div").append(this.no_result_box)}showNoResultCover(){super.showNoResultCover(!1)}onEditClick(e,t){this.onViewDetailClick(e,t)}onViewDetailClick(e){var t=this;this.is_viewing=!1,LocalCacheData.current_doing_context_action="view_detail",t.openEditView();var i,a={},r=this.getGridSelectIdArray(),o=r.length;if(Global.isSet(e))i=e;else if(this.is_viewing)i=this.current_edit_record.id;else{if(!(o>0))return;i=r[0]}a.filter_data={},a.filter_data.id=[i],Global.isSet(this.getSubViewFilter)&&(a.filter_data=this.getSubViewFilter(a.filter_data)),a.filter_columns=this.getFilterColumnsForViewDetails(),this.api["get"+this.api.key_name](a,{onResult:function(e){var i=e.getResult();i||(i=[]),i=i[0],t.sub_view_mode&&t.parent_key&&(i[t.parent_key]=t.parent_value),t.current_edit_record=i,t.initEditView()}})}getFilterColumnsFromDisplayColumns(){var e={id:!0,table_name:!0},t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,a=0;a<i;a++){e[t[a].name]=!0}return e}getFilterColumnsForViewDetails(){for(var e=this.grid.getGridParam("colModel"),t={id:!0,table_name:!0,details:!0},i=e.length,a=0;a<i;a++){t[e[a].name]=!0}return t}setDefaultMenu(){if(this.context_menu_array){this.selectContextMenu(),this.setTotalDisplaySpan();for(var e=this.context_menu_array.length,t=this.getGridSelectIdArray().length,i=0;i<e;i++){var a=$(this.context_menu_array[i]),r=$(a.find(".ribbon-sub-menu-icon")).attr("id");switch(a.removeClass("invisible-image"),a.removeClass("disable-image"),r){case ContextMenuIconName.view_detail:1===t?a.removeClass("disable-image"):a.addClass("disable-image")}}}}onCustomContextClick(e){switch(e){case ContextMenuIconName.view_detail:this.onViewDetailClick()}}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");switch(i.removeClass("disable-image"),a){case ContextMenuIconName.view_detail:i.addClass("disable-image")}}}getCustomContextMenuModel(){return{exclude:["default"],include:[{label:$.i18n._("View Details"),id:ContextMenuIconName.view_detail,group:"editor",icon:Icons.view_detail},ContextMenuIconName.cancel]}}getSubViewFilter(e){return Global.isSet(this.table_name_key)&&(e.table_name=this.tables[this.table_name_key]),e}searchDone(){$("window").trigger("resize"),TTPromise.resolve("initSubAudit","init"),super.searchDone()}}a.loadSubView=function(e,t,i){Global.loadViewSource("Log","SubLogView.html",(function(a){var r={updated:$.i18n._("Updated"),created:$.i18n._("Created")},o=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(o(r)),Global.isSet(i)&&i(sub_log_view_controller))}))}}}]);
//# sourceMappingURL=core-log-LogViewController.bundle.js.map?v=0a01cf7824cf97dd9500