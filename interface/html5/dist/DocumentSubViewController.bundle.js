(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["DocumentSubViewController","portal-hr-my_profile-JobApplicantSubBaseViewController","JobApplicantSubBaseViewController"],{9495:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"DocumentSubViewController":()=>r});var a=i(3757),n=i(7526),o=i(4936),s=i(12);class r extends a.JobApplicantSubBaseViewController{constructor(e={}){_.defaults(e,{}),super(e)}init(e){this.document_api=n.y.APIDocumentPortal,this.attachment_data=null}render(){var e=this,t=Global.loadWidget("views/portal/hr/my_profile/MyProfileSubView.html"),i=this.sub_view_id+"-"+this.model.id;if(this.unique_id=i,this.sub_view=_.template(t)({}),0==this.table_container.find(".table-container").length&&this.table_container.html('<div class="table-responsive"><table class="table table-condensed table-bordered table-container"><thead></thead><tbody></tbody></table></div>'),0===this.table_container.find("#"+i).length){var a=$("<tr>").attr("id",i);$(this.table_container.find("tbody")[0]).append(a)}else this.table_container.find("#"+i).html("");var n=$("<tr>");for(var o in this.display_columns){var s;if(this.display_columns.hasOwnProperty(o))s=this.model.get(o)?this.model.get(o):"","name"===o?this.table_container.find("#"+i).append('<td><a class="download-attachment" href="javascript:void(0);">'+s+"</a></td>"):this.table_container.find("#"+i).append("<td>"+s+"</td>"),n.append("<th>"+this.display_columns[o]+"</th>")}n.append("<th>"+$.i18n._("Action")+"</th>"),""===this.table_container.find("thead").html()&&this.table_container.find("thead").html(n),this.table_container.find("#"+i).append(this.sub_view),this.table_container.find("#"+i).find(".download-attachment").unbind("click").bind("click",(function(t){var i={filter_data:{}};i.filter_data.id=e.model.id,e.document_api.getAttachment(i,{onResult:function(t){e.downloadFile(t)}})})),this.table_container.find("#"+i).find(".edit-icon").unbind("click").bind("click",(function(t){e["get"+e.sub_view_id]((function(){e.setEditView()}))})),this.table_container.find("#"+i).find(".delete-icon").unbind("click").bind("click",(function(t){e["get"+e.sub_view_id]((function(){e.onDeleteClick()}))}))}downloadFile(e){var t=e.getResult();if(t.length>0){var i=t[0].id,a=t[0].document_revision_id,n=s.n.getAPIURL("Class=APIDocumentPortal&Method=downloadAttachment&v=2");LocalCacheData.getAllURLArgs().company_id&&(n=n+"&company_id="+LocalCacheData.getAllURLArgs().company_id),n=n+"&parent_id="+i+"&object_id="+a,Global.APIFileDownload(null,null,null,n)}}initOptions(){}getDocument(e){var t=this,i={filter_data:{}};i.filter_data.id=this.model.id,this.api.getDocument(i,{onResult:function(i){if(i.isValid()){var a=i.getResult();a||(a=[]),a=a[0],t.model.set(a),e&&e()}else t.showErrorAlert(i),ProgressBar.closeOverlay()}})}setCurrentEditRecordData(){var e,t;for(var i in super.setCurrentEditRecordData(),this.model.attributes)if(this.model.has(i))switch(i){case"private":case"template":e='input[name="'+i+'"]',!0===this.model.get(i)?this.$(e).prop("checked","checked"):!1===this.model.get(i)&&this.$(e).removeAttr("checked");break;default:!1===this.model.get(i)&&this.model.set(i,""),e='.form-control[name="'+i+'"]',(t=this.$(e))&&t[0]&&this.$(e).val(this.model.get(i))}}onSaveClick(){var e=this;_.size(this.edit_view_error_ui_dic)>0||(this.model.get("name")||this.model.set("name","Resume - "+LocalCacheData.getPortalLoginUser().first_name+" "+LocalCacheData.getPortalLoginUser().last_name),this.api["set"+this.sub_view_id](this.model.toJSON(),{onResult:function(t){if(t.isValid()){var i=t.getResult();!0!==i&&o.d.isUUID(i)&&i!=o.d.zero_id&&i!=o.d.not_exist_id&&e.model.set("id",i),e.onSaveResult(t,(function(){e["get"+e.sub_view_id]((function(){ProgressBar.changeProgressBarMessage("Processing..."),e.closeEditView(),e._delegate.refreshProfile()}))}))}else e.setErrorTips(t)}}))}onSaveResult(e,t){var i=e.getResult(),a=this.$('input[name="filedata"]')[0].files[0],n=new FormData;if(!0===i&&(i=this.model.id),a){var o=this.model.get("name"),s=this.model.get("revision"),r=this.document_api.addAttachment(o,i,s,{async:!1}).getResult().document_revision_id;n.append("filedata",a),this.uploadFile(n,r,t)}else t()}uploadFile(e,t,i){var a=s.n.getAPIURL("Class="+this.document_api.className+"&Method=uploadAttachment&v=2");LocalCacheData.getAllURLArgs().company_id&&(a=a+"&company_id="+LocalCacheData.getAllURLArgs().company_id),a=a+"&object_id="+t;var n=o.d.generateUUID();ProgressBar.showProgressBar(n),ProgressBar.changeProgressBarMessage("File Uploading"),$.ajax({url:a,headers:{"X-Client-ID":"Browser-TimeTrex","X-CSRF-Token":getCookie("CSRF-Token")},type:"POST",data:e,success:function(e){ProgressBar.removeProgressBar(),e.error.length>0?IndexViewController.instance.router.showTipModal(e.error):i()},cache:!1,contentType:!1,processData:!1})}onFormItemChange(e,t){var i=e.currentTarget.name;switch(this.model.set(i,$(e.currentTarget).val()),i){case"private":case"template":$(e.currentTarget).is(":checked")?this.model.set(i,!0):this.model.set(i,!1)}t||this.validate()}}},3757:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"JobApplicantSubBaseViewController":()=>s});var a=i(97),n=i(7526),o=i(4936);class s extends a.PortalBaseViewController{constructor(e={}){_.defaults(e,{events:{'change input[type="text"]':"onFormItemChange",'change input[type="checkbox"]':"onFormItemChange","change select.form-control":"onFormItemChange","change textarea.form-control":"onFormItemChange"}}),super(e)}preInit(e){this.api=n.y.APIJobApplicantPortal,this.qualification_api=n.y.APIQualificationPortal,this.company_api=n.y.APICompanyPortal,this.sub_view_id=e.sub_view_id,this.display_columns=e.display_columns,this.table_container=e.table_container,this.available_fields=e.available_fields,this._delegate=e._delegate,this.edit_view_error_ui_dic={},this.enable_add_qualification=e.enable_add_qualification||!1}postInit(){this.model.id?this.render():this.setEditView()}render(){var e=this,t=Global.loadWidget("views/portal/hr/my_profile/MyProfileSubView.html"),i=this.sub_view_id+"-"+this.model.id;if(this.unique_id=i,this.sub_view=_.template(t)({}),0==this.table_container.find(".table-container").length&&this.table_container.html('<div class="table-responsive"><table class="table table-condensed table-bordered table-container"><thead></thead><tbody></tbody></table></div>'),0===this.table_container.find("#"+i).length){var a=$("<tr>").attr("id",i);$(this.table_container.find("tbody")[0]).append(a)}else this.table_container.find("#"+i).html("");var n=$("<tr>");for(var o in this.display_columns)if(this.display_columns.hasOwnProperty(o)){var s;switch(o){case"is_current_employer":case"is_contact_available":s=this.model.get(o)?$.i18n._("Yes"):$.i18n._("No");break;default:s=this.model.get(o)?this.model.get(o):""}n.append("<th>"+this.display_columns[o]+"</th>"),this.table_container.find("#"+i).append("<td>"+s+"</td>")}n.append("<th>"+$.i18n._("Action")+"</th>"),""===this.table_container.find("thead").html()&&this.table_container.find("thead").html(n),this.table_container.find("#"+i).append(this.sub_view),this.table_container.find("#"+i).find(".edit-icon").unbind("click").bind("click",(function(t){e["get"+e.sub_view_id]((function(){e.setEditView()}))})),this.table_container.find("#"+i).find(".delete-icon").unbind("click").bind("click",(function(t){e["get"+e.sub_view_id]((function(){e.onDeleteClick()}))}))}initOptions(){var e=this,t={},i={};i.type_id=[this.qualification_type_id],t.filter_data=i,t.filter_columns={"id":!0,"name":!0},this.qualification_api.getQualification(t,!0,{onResult:function(t){var i=t.getResult(),a={};for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];a[o.id]=$.i18n._(o.name)}e.setSourceData("qualification_id",a,!0)}})}onSelectClick(e){var t=$(e.currentTarget).parent().find("select");document.createEvent?((e=document.createEvent("MouseEvents")).initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t[0].dispatchEvent(e)):element.fireEvent&&t[0].fireEvent("onmousedown")}setEditView(){var e=Global.loadWidget("views/portal/hr/my_profile/"+this.sub_view_id+"SubEditView.html");this.setElement(_.template(e)({available_fields:this.available_fields,enable_add_qualification:this.enable_add_qualification})),this.initOptions(),this.registerDatePicker(),this.setCurrentEditRecordData(),this.openEditView()}onDeleteClick(){var e=this;IndexViewController.instance.router.showConfirmModal(Global.delete_confirm_message,{title:"",actions:[{label:"No",isClose:!0},{label:"Yes",callBack:function(t){e.closeConfirmModal(),ProgressBar.showOverlay(),e.api["delete"+e.sub_view_id](e.model.id,{onResult:function(t){ProgressBar.closeOverlay(),t.isValid()?e._delegate.setSubViews(e.sub_view_id,e.display_columns):e.showErrorAlert(t)}})}}]})}setSourceData(e,t,i){var a=this,n='select[name="'+e+'"]';if(this.$(n)&&this.$(n)[0])switch(this.$(n).empty(),Global.isSet(this.model.get(e))||this.model.set(e,""),0==_.size(t)&&(i=!0,this.model.set(e,"")),e){case"qualification_id":if(this.enable_add_qualification){var o;switch(this.sub_view_id){case"JobApplicantSkill":o=$.i18n._("Add New Skill");break;case"JobApplicantEducation":o=$.i18n._("Add New Course");break;case"JobApplicantLicense":o=$.i18n._("Add New Type");break;case"JobApplicantLanguage":o=$.i18n._("Add New Language");break;case"JobApplicantMembership":o=$.i18n._("Add New Membership")}i=!1,this.$(n).append($("<option></option>").prop("value","").text("-- "+o+" --"))}default:!0===i&&this.$(n).append($("<option></option>").prop("value","").text("-- "+$.i18n._("None")+" --")),_.size(t)>0&&$.each(t,(function(t,i){a.$(n).append($("<option></option>").prop("value",t).text(i)),a.model.get(e)==t&&a.$(n).val(t)})),a.$(n).selectpicker()}}registerDatePicker(){var e,t=!1,i=[$.i18n._("Sun"),$.i18n._("Mon"),$.i18n._("Tue"),$.i18n._("Wed"),$.i18n._("Thu"),$.i18n._("Fri"),$.i18n._("Sat")],a=[$.i18n._("Jan"),$.i18n._("Feb"),$.i18n._("Mar"),$.i18n._("Apr"),$.i18n._("May"),$.i18n._("Jun"),$.i18n._("Jul"),$.i18n._("Aug"),$.i18n._("Sep"),$.i18n._("Oct"),$.i18n._("Nov"),$.i18n._("Dec")],n={showTime:!1,dateFormat:"dd-M-y",showHour:!1,showMinute:!1,changeMonth:!0,changeYear:!0,showButtonPanel:!0,duration:"",showAnim:"",yearRange:"-100:+10",showOn:"",dayNamesMin:i,currentText:$.i18n._("Today"),monthNamesShort:a,closeText:$.i18n._("Close"),beforeShow:function(){},onSelect:function(e){$(this).change()},onClose:function(){e=setTimeout((function(){t=!1}),100)}};this.$('input[type="text"].datepicker').datepicker(n),this.$('input[type="text"].datepicker').attr("placeholder","dd-mmm-yy"),this.$('input[type="text"].datepicker').bind("mouseup",(function(){t?(t=!1,e&&(clearTimeout(e),e=null)):($(this).datepicker("show"),t=!0)})).next(".glyphicon").bind("mouseup",(function(){$(this).prev().trigger("mouseup")}))}setCurrentEditRecordData(){var e=this,t=this.$(".detail-form").serializeArray();$.map(t,(function(t,i){Global.isSet(e.model.get(t.name))||e.model.set(t.name,t.value)})),this.model.has("qualification_id")||this.model.set("qualification_id",!1)}addQualification(){var e=this,t={};t.type_id=this.qualification_type_id;var i=t.name=this.getQualificationWidget().val();this.qualification_api.setQualification(t,{onResult:function(t){if(t.isValid()){e.$("select[name='qualification_id']").selectpicker("destroy");var a=t.getResult();$("<option>").attr({selected:"selected",value:a}).text(i).appendTo(e.$("select[name='qualification_id']")),e.$("select[name='qualification_id']").selectpicker(),e.$("select[name='qualification_id']").trigger("change")}else e.setErrorTips(t)}})}getAddQualificationContainer(){return this.$(".add-qualification-container")}getQualificationWidget(){return this.getAddQualificationContainer().find('input[name="name"]')}showAddQualificationContainer(){var e=this,t=this.getAddQualificationContainer();t.css("display","table"),t.off("click").on("click",(function(){e.addQualification()}));var i=this.getQualificationWidget();return i.val(""),i.unbind("keydown").bind("keydown",(function(t){13===t.keyCode&&e.addQualification()})),t}hideAddQualificationContainer(){var e=this.getAddQualificationContainer();return e.css("display","none"),e}openEditView(){var e=this;IndexViewController.instance.router.showFormModal(this.$el,{title:"",actions:[{label:"Close",isClose:!0,callBack:function(t){e.clearErrorTips(!0)}},{label:"Save Changes",callBack:function(t){e.onSaveClick()}}]})}closeEditView(){IndexViewController.instance.router.hideFormModal()}closeConfirmModal(){IndexViewController.instance.router.hideConfirmModal()}onFormItemChange(e,t){var i=e.currentTarget.name;switch(this.model.set(i,$(e.currentTarget).val()),i){case"name":t=!0;break;case"qualification_id":""===this.model.get(i)&&this.enable_add_qualification?(this.showAddQualificationContainer(),t=!0):this.hideAddQualificationContainer()}t||this.validate()}validate(){var e=this;this.api["validate"+this.sub_view_id](this.model.toJSON(),{onResult:function(t){e.validateResult(t)}})}validateResult(e){this.setErrorTips(e)}clearErrorTips(e){for(var t in this.edit_view_error_ui_dic)(""!==this.edit_view_error_ui_dic[t].val()||e)&&(this.edit_view_error_ui_dic[t].removeClass("error-tip"),this.edit_view_error_ui_dic[t].tooltip().tooltip("dispose"))}setErrorTips(e){this.clearErrorTips(!0);var t=e.getDetails()?e.getDetails()[0]:{};for(var i in t&&t.hasOwnProperty("error")&&(t=t.error),t){var a,n;if(t.hasOwnProperty(i))if(this.$('input[name="'+i+'"]')[0]?a=this.$('input[name="'+i+'"]'):this.$('select[name="'+i+'"]')[0]?a=this.$('select[name="'+i+'"]').parents(".styled-select"):this.$('textarea[name="'+i+'"]')[0]&&(a=this.$('textarea[name="'+i+'"]')),a)a.addClass("error-tip"),n=_.isArray(t[i])?t[i][0]:t[i],a.tooltip({title:n,container:"body",trigger:"hover focus"}),a.tooltip("show"),this.edit_view_error_ui_dic[i]=a}}showErrorAlert(e){var t=e.getDetails();t.hasOwnProperty("error"),t||(t=e.getDescription());var i="";Global.isArray(t)||"object"==typeof t?$.each(t,(function(e,t){for(var a in t.hasOwnProperty("error")&&(t=t.error),t)i=i+t[a]+"<br>"})):i=t,this.showAlert(i)}onSaveClick(){var e=this;this.api["set"+this.sub_view_id](this.model.toJSON(),{onResult:function(t){if(t.isValid()){var i=t.getResult();!0!==i&&o.d.isUUID(i)&&i!=o.d.zero_id&&i!=o.d.not_exist_id&&e.model.set("id",i),e.edit_view_error_ui_dic={},e["get"+e.sub_view_id]((function(){e.render(),e.closeEditView()}))}else e.setErrorTips(t)}})}showAlert(e){IndexViewController.instance.router.showTipModal(e)}}}}]);
//# sourceMappingURL=DocumentSubViewController.bundle.js.map?v=b043377f1c37fdf836e1