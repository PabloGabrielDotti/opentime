(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["invoice-client-ClientViewController"],{1475:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"ClientViewController":()=>n});class n extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#client_view_container",status_array:null,client_group_array:null,client_group_api:null,sub_client_contact_view_controller:null,sub_client_payment_view_controller:null,sub_document_view_controller:null,sub_transaction_view_controller:null,sub_invoice_view_controller:null,document_object_type_id:null}),super(e)}init(e){this.edit_view_tpl="ClientEditView.html",this.permission_id="client",this.viewId="Client",this.script_name="ClientView",this.table_name_key="client",this.context_menu_name=$.i18n._("Clients"),this.navigation_label=$.i18n._("Client")+":",this.document_object_type_id=80,this.api=TTAPI.APIClient,this.client_group_api=TTAPI.APIClientGroup,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}removeEditView(){super.removeEditView(),this.sub_client_contact_view_controller=null,this.sub_invoice_view_controller=null,this.sub_client_payment_view_controller=null,this.sub_transaction_view_controller=null}initOptions(e){var t=this;this.initDropDownOption("status","status_id",this.api,(function(){t.client_group_api.getClientGroup("",!1,!1,{onResult:function(i){i=i.getResult(),i=Global.buildTreeRecord(i),t.edit_only_mode||!t.sub_view_mode&&t.basic_search_field_ui_dic.group_id&&(t.basic_search_field_ui_dic.group_id.setSourceData(i),t.adv_search_field_ui_dic.group_id.setSourceData(i)),t.client_group_array=i,e&&e()}})}))}getClientData(e,t){var i={filter_data:{}};i.filter_data.id=[e],this.api["get"+this.api.key_name](i,{onResult:function(e){var i=e.getResult();i||(i=[]),i=i[0],t(i)}})}openEditView(e){Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var t=this;t.edit_only_mode?t.initOptions((function(i){t.edit_view||t.initEditViewUI(t.viewId,t.edit_view_tpl),t.getClientData(e,(function(e){t.current_edit_record=e,t.initEditView()}))})):this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl)}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.copy],include:[{label:$.i18n._("Import"),id:ContextMenuIconName.import_icon,group:"other",icon:Icons.import_icon,sort_order:8e3},{label:$.i18n._("Client<br>Contacts"),id:ContextMenuIconName.client_contact,group:"navigation",icon:Icons.client_contact},{label:$.i18n._("Invoices"),id:ContextMenuIconName.invoice,group:"navigation",icon:Icons.invoice},{label:$.i18n._("Transactions"),id:ContextMenuIconName.transaction,group:"navigation",icon:Icons.transaction},{label:$.i18n._("Payment<br>Methods"),id:ContextMenuIconName.payment_method,group:"navigation",icon:Icons.payment_method},{label:$.i18n._("In/Out"),id:ContextMenuIconName.in_out,group:"navigation",icon:Icons.in_out,permission_result:PermissionManager.checkTopLevelPermission("InOut")},{label:$.i18n._("Login"),id:ContextMenuIconName.login,group:"navigation",icon:Icons.login}]}}onCustomContextClick(e){switch(e){case ContextMenuIconName.import_icon:IndexViewController.openWizard("ImportCSVWizard","Client",(function(){$this.search()}));break;case ContextMenuIconName.client_contact:case ContextMenuIconName.invoice:case ContextMenuIconName.transaction:case ContextMenuIconName.payment_method:case ContextMenuIconName.in_out:this.onNavigationClick(e);break;case ContextMenuIconName.login:this.onLoginClick()}}onLoginClick(){var e=this,t={};t.client_id=this.getGridSelectIdArray()[0],LocalCacheData.extra_filter_for_next_open_view={},LocalCacheData.extra_filter_for_next_open_view.filter_data=t,IndexViewController.openWizard("LoginUserWizard",e.viewId,(function(t){Global.NewSession(t,e.getGridSelectIdArray()[0])}))}onNavigationClick(e){var t=this,i={filter_data:{}};if(i.filter_data.client_id=[],t.edit_view&&t.current_edit_record.id)i.filter_data.client_id.push(t.current_edit_record.id);else{var n=this.getGridSelectIdArray();$.each(n,(function(e,t){i.filter_data.client_id.push(t)}))}switch(e!=ContextMenuIconName.in_out&&Global.addViewTab(t.viewId,$.i18n._("Clients"),window.location.href),e){case ContextMenuIconName.in_out:IndexViewController.openEditView(LocalCacheData.current_open_primary_controller,"InOut");break;case ContextMenuIconName.client_contact:IndexViewController.goToView("ClientContact",i);break;case ContextMenuIconName.invoice:IndexViewController.goToView("Invoice",i);break;case ContextMenuIconName.transaction:IndexViewController.goToView("InvoiceTransaction",i);break;case ContextMenuIconName.payment_method:IndexViewController.goToView("ClientPayment",i)}}buildEditViewUI(){super.buildEditViewUI();var e={"tab_client":{"label":$.i18n._("Client")},"tab_client_contacts":{"label":$.i18n._("Client Contacts"),"init_callback":"initSubClientContactView","display_on_mass_edit":!1},"tab_payment_methods":{"label":$.i18n._("Payment Methods"),"init_callback":"initSubClientPaymentView","display_on_mass_edit":!1},"tab_invoices":{"label":$.i18n._("Invoices"),"init_callback":"initSubInvoiceView","display_on_mass_edit":!1},"tab_transactions":{"label":$.i18n._("Transactions"),"init_callback":"initSubTransactionView","display_on_mass_edit":!1},"tab_attachment":!0,"tab_audit":!0};this.setTabModel(e),this.edit_only_mode||(this.navigation.AComboBox({api_class:TTAPI.APIClient,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_client",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var t=this.edit_view_tab.find("#tab_client").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t);var i=Global.loadWidgetByName(FormItemType.AWESOME_BOX);i.AComboBox({api_class:TTAPI.APIClient,allow_multiple_selection:!1,layout_name:"global_client",show_search_inputs:!0,set_empty:!0,field:"parent_id"}),this.addEditFieldToColumn($.i18n._("Parent"),i,t,""),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),i.setSourceData(this.status_array),this.addEditFieldToColumn($.i18n._("Status"),i,t),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({tree_mode:!0,allow_multiple_selection:!1,layout_name:"global_tree_column",set_empty:!0,field:"group_id"}),i.setSourceData(this.client_group_array),this.addEditFieldToColumn($.i18n._("Group"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"company_name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Client Name"),i,t),i.parent().width("45%"),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"company_dba_name",width:430}),this.addEditFieldToColumn($.i18n._("Doing Business As"),i,t),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"sales_contact_id"}),this.addEditFieldToColumn($.i18n._("Sales Contact"),i,t),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"support_contact_id"}),this.addEditFieldToColumn($.i18n._("Support Contact"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"website",width:360}),this.addEditFieldToColumn($.i18n._("Website"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),i,t,"",null,null,!0),i.parent().width("45%"),(i=Global.loadWidgetByName(FormItemType.TAG_INPUT)).TTagInput({field:"tag",object_type_id:800}),this.addEditFieldToColumn($.i18n._("Tags"),i,t,"last",null,null,!0)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:1,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Company Name"),in_column:1,field:"company_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Website"),in_column:1,field:"website",multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Note"),in_column:1,field:"note",multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Tags"),field:"tag",basic_search:!0,adv_search:!0,in_column:2,object_type_id:800,form_item_type:FormItemType.TAG_INPUT}),new SearchField({label:$.i18n._("Sales Contact"),in_column:2,field:"sales_contact_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Support Contact"),in_column:2,field:"support_contact_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}setEditMenu(){super.setEditMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]);switch($(i.find(".ribbon-sub-menu-icon")).attr("id")){case ContextMenuIconName.login:this.setEditMenuLoginIcon(i);break;case ContextMenuIconName.import_icon:case ContextMenuIconName.client_contact:case ContextMenuIconName.invoice:case ContextMenuIconName.transaction:case ContextMenuIconName.payment_method:this.setNavigationMenuIcons(i)}}this.setContextMenuGroupVisibility()}setNavigationMenuIcons(e){this.edit_only_mode&&e.addClass("invisible-image")}setEditMenuLoginIcon(e){PermissionManager.validate("company","login_other_user")?e.addClass("disable-image"):e.addClass("invisible-image")}initSubClientContactView(){var e=this;if(this.current_edit_record.id){if(this.sub_client_contact_view_controller)return this.sub_client_contact_view_controller.buildContextMenu(!0),this.sub_client_contact_view_controller.setDefaultMenu(),e.sub_client_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_client_contact_view_controller.parent_edit_record=e.current_edit_record,void e.sub_client_contact_view_controller.initData();Global.loadScript("views/invoice/client_contact/ClientContactViewController.js",(function(){var n=e.edit_view_tab.find("#tab_client_contacts").find(".first-column-sub-view");Global.trackView("SubClientContactView"),ClientContactViewController.loadSubView(n,t,i)}))}else TTPromise.resolve("BaseViewController","onTabShow");function t(){}function i(t){e.sub_client_contact_view_controller=t,e.sub_client_contact_view_controller.parent_key="client_id",e.sub_client_contact_view_controller.parent_value=e.current_edit_record.id,e.sub_client_contact_view_controller.parent_edit_record=e.current_edit_record,e.sub_client_contact_view_controller.parent_view_controller=e,e.sub_client_contact_view_controller.postInit=function(){this.initData()}}}initSubClientPaymentView(){var e=this;if(this.current_edit_record.id){if(this.sub_client_payment_view_controller)return this.sub_client_payment_view_controller.buildContextMenu(!0),this.sub_client_payment_view_controller.setDefaultMenu(),e.sub_client_payment_view_controller.parent_value=e.current_edit_record.id,e.sub_client_payment_view_controller.parent_edit_record=e.current_edit_record,void e.sub_client_payment_view_controller.initData();Global.loadScript("views/invoice/client_payment/ClientPaymentViewController.js",(function(){var n=e.edit_view_tab.find("#tab_payment_methods").find(".first-column-sub-view");Global.trackView("SubClientPaymentView"),ClientPaymentViewController.loadSubView(n,t,i)}))}else TTPromise.resolve("BaseViewController","onTabShow");function t(){}function i(t){e.sub_client_payment_view_controller=t,e.sub_client_payment_view_controller.parent_key="client_id",e.sub_client_payment_view_controller.parent_value=e.current_edit_record.id,e.sub_client_payment_view_controller.parent_edit_record=e.current_edit_record,e.sub_client_payment_view_controller.parent_view_controller=e,e.sub_client_payment_view_controller.postInit=function(){this.initData()}}}initSubInvoiceView(){var e=this;if(this.current_edit_record.id){if(this.sub_invoice_view_controller)return e.sub_invoice_view_controller.buildContextMenu(!0),e.sub_invoice_view_controller.setDefaultMenu(),e.sub_invoice_view_controller.parent_key="client_id",e.sub_invoice_view_controller.parent_value=e.current_edit_record.id,e.sub_invoice_view_controller.parent_edit_record=e.current_edit_record,void e.sub_invoice_view_controller.initData();Global.loadScript("views/invoice/invoice/InvoiceViewController.js",(function(){var n=e.edit_view_tab.find("#tab_invoices").find(".first-column-sub-view");Global.trackView("SubInvoiceView"),InvoiceViewController.loadSubView(n,t,i)}))}else TTPromise.resolve("BaseViewController","onTabShow");function t(){}function i(t){e.sub_invoice_view_controller=t,e.sub_invoice_view_controller.parent_key="client_id",e.sub_invoice_view_controller.parent_value=e.current_edit_record.id,e.sub_invoice_view_controller.parent_edit_record=e.current_edit_record,e.sub_invoice_view_controller.parent_view_controller=e,e.sub_invoice_view_controller.postInit=function(){this.initData()}}}initSubTransactionView(){var e=this;if(this.current_edit_record.id){if(this.sub_transaction_view_controller)return this.sub_transaction_view_controller.buildContextMenu(!0),this.sub_transaction_view_controller.setDefaultMenu(),e.sub_transaction_view_controller.parent_value=e.current_edit_record.id,e.sub_transaction_view_controller.parent_edit_record=e.current_edit_record,e.sub_transaction_view_controller.getSubViewFilter=function(e){return n(e,this)},void e.sub_transaction_view_controller.initData();Global.loadScript("views/invoice/invoice_transaction/InvoiceTransactionViewController.js",(function(){var n=e.edit_view_tab.find("#tab_transactions").find(".first-column-sub-view");Global.trackView("SubInvoiceTransactionView"),InvoiceTransactionViewController.loadSubView(n,t,i)}))}else TTPromise.resolve("BaseViewController","onTabShow");function t(){}function i(t){e.sub_transaction_view_controller=t,e.sub_transaction_view_controller.parent_key="client_id",e.sub_transaction_view_controller.parent_value=e.current_edit_record.id,e.sub_transaction_view_controller.parent_edit_record=e.current_edit_record,e.sub_transaction_view_controller.getSubViewFilter=function(e){return n(e,this)},e.sub_transaction_view_controller.parent_view_controller=e,e.sub_transaction_view_controller.postInit=function(){this.initData()}}function n(t,i){return t.client_id=e.current_edit_record.id,t.invoice_status_id=[10,20,30,35,40,50,55,70,80,90,95,97,98,100],t}}}}}]);
//# sourceMappingURL=invoice-client-ClientViewController.bundle.js.map?v=916bfa98e644ecd0fb7e