(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["awesomebox-AComboBox"],{2897:()=>{var e;(e=jQuery).fn.AComboBox=function(t){var i,l,a=e.extend({},e.fn.AComboBox.defaults,t),o=null,n=null,r="",s=null,u=null,c=null,d=!1,h=!1,f=!1,m=!1,g=!1,p=!1,b=!1,y=!1,v=null,D=null,C="",G=null,S=null,T=null,I=null,x=null,w=null,U=null,A="",k=!1,F=!1,P=null,L=!1,R=0,B=!1;Global.addCss("global/widgets/awesomebox/AComboBox.css");var E,V=!1,j=!1,q=!1,z="id",N="";l=this;var O,W,M,H,Q=null,K=!0,J=!1,X=!1,Y=null,Z=null,$=null,ee=null,te=null,ie=null,le=null,ae=!1,oe=null,ne=null,re=null,se=null,ue=null,ce="columns",de=!1,he=!1,fe=!1,_e={},me="",ge=1,pe=!1;this.customSearchFilter=null,this.getCurrentOpenPage=function(){return ge},this.getPagerData=function(){return s},this.getHeaderWidth=function(){return O},this.setKey=function(e){z=e},this.getDisplayColumns=function(){return S},this.getLayout=function(){return ALayoutCache.layout_dic[r]},this.getAPI=function(){return c},this.getScriptName=function(){return Global.getScriptNameByAPI(u)},this.setCachedSortFilter=function(e){te=e},this.setCachedSelectedGridSortFilter=function(e){ie=e},this.setCachedSearchInputsFilter=function(e){$=e},this.setCachedSelectGridSearchInputsFilter=function(e){ee=e},this.setAllowMultipleSelection=function(e){d=e,1==e?v&&(D=[v]):D&&D.length>0&&(v=D[0])},this.getEnabled=function(){return K},this.setEnabled=function(t){K=t,!1===t||""===t?(l.addClass("a-combobox-readonly"),Q&&Q.hide(),this.children().eq(1).text()||this.children().eq(1).text(e.i18n._("N/A"))):(l.removeClass("a-combobox-readonly"),Q&&Q.show(),!this.children().eq(1).text()===e.i18n._("N/A")&&this.children().eq(1).text(""))},this.setCheckBox=function(e){Q&&(Q.children().eq(0)[0].checked=e)},this.isChecked=function(){return!(!Q||!0!==Q.children().eq(0)[0].checked)},this.setMassEditMode=function(t){t?((Q=e(' <div class="mass-edit-checkbox-wrapper"><input type="checkbox" class="mass-edit-checkbox"></input><label for="checkbox-input-1" class="input-helper input-helper--checkbox"></label></div>')).insertBefore(e(this)),Q.change((function(){l.trigger("formItemChange",[l])}))):Q&&(Q.remove(),Q=null)},this.getItemByIndex=function(e){var t;return X&&!U?t=le:(t=U,W&&W.length>0&&(t=W)),t?t[e]:null},this.getSelectIndex=function(){var e;if(X&&!U?e=le:(e=U,W&&W.length>0&&(e=W)),!v||!e)return 0;for(var t=e.length,i=0;i<t;i++){var l=e[i];if(v[z]===l[z])return i}return 0},this.getNextSelectItemId=function(){var e=this.getSelectIndex()+1,t=this.getSourceData();return t&&e<t.length?this.getItemByIndex(e):null},this.setErrorStyle=function(t,i,l){l?e(this).addClass("a-warning-tip"):e(this).addClass("a-error-tip"),N=t,i&&this.showErrorTip()},this.showErrorTip=function(t){Global.isSet(t)||(t=2),E||(E=(E=Global.loadWidgetByName(WidgetNamesDic.ERROR_TOOLTIP)).ErrorTipBox()),e(this).hasClass("a-warning-tip")?E.show(this,N,t,!0):E.show(this,N,t)},this.hideErrorTip=function(){Global.isSet(E)&&E.remove()},this.clearErrorStyle=function(){e(this).removeClass("a-error-tip"),e(this).removeClass("a-warning-tip"),N="",this.hideErrorTip()},this.setField=function(e){C=e},this.getField=function(){return C},this.getValidationField=function(){return i},this.getValue=function(t){var i=null;if(d)t?i=D:(i=[],Global.isArray(D)?(e.each(D,(function(t,l){l&&(Global.isString(l)||"number"===e.type(l)?i.push(l):i.push(l[z]))})),0===D.length&&f&&i.push(TTUUID.not_exist_id)):f&&i.push(TTUUID.not_exist_id),0===i.length&&(f?i=TTUUID.not_exist_id:m?i=TTUUID.zero_id:g?i=TTUUID.not_exist_id:(p||b)&&(i=TTUUID.zero_id)));else if(t)i=v;else if(v)i=Global.isSet(v[z])?v[z]:v;else{if(f)return TTUUID.not_exist_id;if(m)return TTUUID.zero_id;if(g)return TTUUID.not_exist_id;if(p)return TTUUID.zero_id;if(b)return TTUUID.zero_id}return i},this.setSourceData=function(e){U=e,d?e&&e.length>0&&y&&l.createFirstItem():e&&e.length>0&&(m||f||b||p||y||g?l.createFirstItem():v||this.setValue(e[0])),F&&U&&(d?this.setValue(D):this.setValue(v))},this.getSourceData=function(){return X&&le?le:W||U},this.getStaticSourceData=function(){return U},this.getRowPerPage=function(){return R},this.setAllColumns=function(e){w=e},this.setDisplayColumnsForEditor=function(e){x=e},this.getAllColumns=function(){return T||w},this.getDisplayColumnsForEditor=function(){return x},this.setEmptyValueAndShowLoading=function(){var e=l.find(".a-combobox-label").width();this.setValue(null),o.text(Global.loading_label),l.find(".a-combobox-label").width(e+"px")},this.setValue=function(t){_.isArray(t)&&1===t.length&&null===t[0]&&(t=null),d?t&&"array"!==e.type(t)?"string"!==e.type(t)&&"number"!==e.type(t)||this.setSelectItems([t]):this.setSelectItems(t):("array"===e.type(t)&&t.length>0&&(t=t[0]),t&&t!=TTUUID.zero_id?this.setSelectItem(t):!(m||f||b||p||y||g)&&U&&U.length>0?this.setValue(U[0]):this.setSelectItem(null))},this.getAllowMultipleSelection=function(){return d},this.getRealData=function(t){if(Global.isSet(u)){if(!TTUUID.isUUID(t)&&parseInt(t)<=0||t==TTUUID.zero_id||t==TTUUID.not_exist_id)return void(d?l.setValue([this.getLocalSelectItem(t)]):l.setValue(this.getLocalSelectItem(t)));var i={};i.filter_data={"id":t},Z&&Global.isSet(Z.permission_section)&&(i.permission_section=Z.permission_section),this.customSearchFilter&&(i=this.customSearchFilter(i)),o.text(Global.loading_label),c["get"+ne](i,{onResult:function(e){var t,i=e.getResult();i&&i.length>0&&(d?(t=i,l.setValue(i)):(t=i[0],l.setValue(i[0]))),re&&re(t)}})}else U&&U.length>0?e.each(U,(function(e,i){if(i[z]==t)return l.setValue(i),!1})):F=!0},this.getColumnFilter=function(){if(fe)return{};var t={is_owner:!0,id:!0,is_child:!0,user_id:!0,first_name:!0,last_name:!0,object_type_id:!0,manual_id:!0,default_item_id:!0,accrual_policy_id:!0,pay_code_id:!0,start_date:!0,end_date:!0,pay_period_id:!0};return c&&"APIUser"===c.className&&(t.pay_period_schedule_id=!0,t.policy_group_id=!0,t.hire_date=!0,t.termination_date=!0),e.each(S,(function(e,i){t[i.name]=!0})),pe&&pe.length>0&&e.each(pe,(function(e,i){t[i]=!0})),t},this.cleanDropDownValues=function(){n&&n.setSelectGridData([])},this.setSelectItem=function(t){if(D=null,v=t,!1===t||""===t)return this.setLabel(t),void(re&&re(!1));"string"===e.type(t)||"number"===e.type(t)?this.getRealData(t):this.setLabel()},this.setSelectItems=function(t){if(v=null,!t||t.length<1)return this.setEmptyLabel(),D=null,re&&re(!1),void this.cleanDropDownValues();if(t==TTUUID.not_exist_id&&f)return D=t,this.setEmptyLabel(),re&&re(!1),void this.cleanDropDownValues();D=t;var i=t.length;if(i>1){var l=t[0];"string"!==e.type(l)&&"number"!==e.type(l)||h||(k=!0),this.setLabel()}else for(var a=0;a<i;a++)if(l=t[a],"string"===e.type(l)||"number"===e.type(l))if(h){if(!U)return void(F=!0);this.setSelectItems(this.getRealSelectItemsFromSourceData())}else this.getRealData(l);else{for(var o in l)if("asc"===l[o]||"desc"===l[o]){if(U)break;return void(F=!0)}this.setLabel()}},this.getRealSelectItemsFromSourceData=function(){for(var e=U.length,t=D?D.length:0,i=[],l=0;l<t;l++)for(var a=D[l],o=0;o<e;o++){var n=U[o];if(a==n[z]){i.push(n);break}}return i},this.setLabel=function(){var t=Array();if(d){if(!D)return void this.setEmptyLabel();var i=D.length;if(1===i){var a=S.length;for(f=0;f<a;f++)if(!0!==S[f].hidden){if("global_sort_columns"===r&&void 0===D[0][S[f].name]){var n=D[0];for(var s in n)var u=s+" | "+n[s];if(U)for(var c=0;c<U.length;c++){var h=U[c];h.value===s&&(u=h.label+" | "+n[s])}u&&""!=u||(u="--"),t.push(u);break}""==(u=D[0][S[f].name])&&(u="--"),u&&t.push(u)}t.length>0?o.text(t.join(" | ")):this.setEmptyLabel()}else o.text(i+" "+e.i18n._("items selected"))}else{if(!v||!S)return void this.setEmptyLabel();a=S.length;for(var f=0;f<a;f++)!0!==S[f].hidden&&(""==(u=v[S[f].name])&&(u="--"),u&&t.push(u));t.length>0?o.text(t.join(" | ")):this.setEmptyLabel()}l.find(".a-combobox-label").width("auto")},this.setEmptyLabel=function(){if(f)o.text(Global.any_item);else if(m||g)"global_tree_column"===r?o.text(Global.root_item):o.text(Global.empty_item);else if(b)o.text(Global.default_item);else if(p)o.text(Global.open_item);else if(U&&U.length>0){var e=U[0];e.hasOwnProperty("label")&&o.text(e.label)}se&&o.text(se)},this.onColumnSettingSaveFromLayout=function(e){var t={script:"global_awesomebox_columns"};t.name=r,t.is_default="false",t.data=e.data,t.data.type=10,t.data.layout_id=e.id,ALayoutCache.layout_dic[r]&&(t.id=ALayoutCache.layout_dic[r].id),G.setUserGenericData(t,{onResult:function(e){ALayoutCache.layout_dic[r]=null,l.initColumns(),U=null}})},this.onColumnSettingSave=function(t,i,a,o){var n={script:"global_awesomebox_columns"};n.name=r,n.is_default="false",n.type=1,ALayoutCache.layout_dic[r]&&(n.id=ALayoutCache.layout_dic[r].id);for(var s=[],u=t.length,c=0;c<u;c++){var d={label:t[c].label,value:t[c].value,orderValue:t[c].orderValue};s.push(d)}n.data={display_columns:s,row_per_page:i,layout_id:a,filter_data:o},G||(G=TTAPI.APIUserGenericData),G.setUserGenericData(n,{onResult:function(t){ALayoutCache.layout_dic[r]=null,l.initColumns(),U=null,"array"===e.type(D)&&(D=D.map((function(e){if(e.hasOwnProperty("id"))return e.id}))),D&&l.getRealData(D)}})},this.initColumns=function(){if((G=TTAPI.APIUserGenericData)&&G.getUserGenericData&&"function"==typeof G.getUserGenericData)if(Global.isSet(ALayoutCache.layout_dic[r])){if(Global.isSet(ALayoutCache.layout_dic[r].data)){var e=ALayoutCache.layout_dic[r].data;Global.isSet(e.type)&&10===e.type?((S=e.display_columns).length>0?(T&&(S=be(S)),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))):I&&(S=be(S=I),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))),(Y={}).filter_data=e.filter_data,Y.filter_sort=e.filter_sort):((S=e.display_columns).length>0?(T&&(S=be(S)),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))):T&&(S=T),R=e.row_per_page,X||ae||(Z=null))}else I&&(S=be(S=I),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))),R=0;he&&l.initSourceData()}else{var t={};t.filter_data={script:"global_awesomebox_columns",name:r},G.getUserGenericData(t,{onResult:function(e){var t=e.getResult();if(t&&t.length>0){var i=t[0].data;if(10===i.type){var a=c.getOptions(ce,{async:!1}).getResult();w=Global.buildColumnArray(a);var o=G.getUserGenericData({filter_data:{id:i.layout_id,deleted:!1}},{async:!1}).getResult();if(o&&o.length>0){var n=o.slice()[0],s=n.data;s.display_columns=l.buildDisplayColumns(s.display_columns),s.filter_data=Global.convertLayoutFilterToAPIFilter(n),t[0].data.display_columns=s.display_columns,t[0].data.filter_data=s.filter_data,i=t[0].data}else i.filter_data=[]}ALayoutCache.layout_dic[r]=t[0],ALayoutCache.layout_dic[l.getScriptName()]=r,Global.isSet(i.type)&&10===i.type?((S=i.display_columns).length>0?(T&&(S=be(S)),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))):I&&(S=be(S=I),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))),(Y={}).filter_data=i.filter_data,Y.filter_sort=i.filter_sort):((S=i.display_columns).length>0?(T&&(S=be(S)),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))):I&&(S=be(S=I),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))),R=i.row_per_page,Y=null)}else I&&(S=be(S=I),S=Global.convertColumnsTojGridFormat(S,r,(function(e){O=e}))),ALayoutCache.layout_dic[r]=!1,R=0;he&&l.initSourceData()}})}};var be=function(e){if(!T)return e;for(var t=T.length,i=[],l=0;l<e.length;l++){for(var a=e[l],o=!1,n=0;n<t;n++)if(T[n].value===a.value){o=!0;break}o&&i.push(a)}return 0===i.length&&(i=T),i};return this.getId=function(){return A},this.updateSelectItem=function(e){if(v=e,U)for(var t=0;t<U.length;t++)if(U[t].id===e.id)return void(U[t]=e)},this.getADropDown=function(){return P},this.onClose=function(e,t){if(null==n&&Debug.Text("ERROR: Unable to close AComboBox check to make sure it wasn't instantiated twice.","ACombobox.js","ACombobox","onClose",10),0==TTPromise.isPendingPromises("AComboBox","init"))if(d){var i=n.getSelectItems();l.setValue(i)}else{var a=n.getSelectItem();a&&(j?a._id_&&l.setValue(a._id_):l.setValue(a))}else Debug.Text("WARNING: AComboBox::Init promise still pending, cant call setValue()...","ACombobox.js","ACombobox","onClose",10);P.remove(),L=!1,LocalCacheData.openAwesomeBox=null,(n.isChanged()||"global_sort_columns"===r)&&(Q&&l.setCheckBox(!0),l.trigger("formItemChange",[l])),de=!0,setTimeout((function(){de=!1}),200),l.find(".focus-input").focus()},this.selectNextItem=function(t){var i,l,a=this.getSelectIndex();if(40===t.keyCode)t.preventDefault(),d||(i=0===a?1:a+1,(h=this.getItemByIndex(i))||(i-=1,h=this.getItemByIndex(i)),v=h,n.setSelectItem(h),n.setIsChanged(!0));else if(38===t.keyCode)t.preventDefault(),d||(i=0===a?0:a-1,h=this.getItemByIndex(i),v=h,n.setSelectItem(h),n.setIsChanged(!0));else if(39===t.keyCode)d&&!e(t.target).hasClass("search-input")&&(t.preventDefault(),n.onUnSelectGridDoubleClick(),n.setIsChanged(!0));else if(37===t.keyCode)d&&!e(t.target).hasClass("search-input")&&(t.preventDefault(),n.onSelectGridDoubleClick(),n.setIsChanged(!0));else{M&&clearTimeout(M);var o=e(":focus");if(o.length>0&&e(o[0]).hasClass("search-input"))return;M=setTimeout((function(){me=""}),750),t.preventDefault(),me+=String.fromCharCode(t.which).toLowerCase(),Debug.Text("Quick search typed keys: "+me,"AComboBox.js","AComboBox","selectNextItem",10);var r=me.trim();if(d||j){if(r){l=n.getFocusInSeletGrid()?n.getSelectGrid():n.getUnSelectGrid();var s,u=_e[r]?_e[r]:0,c=e(l.grid.find("tr").find("td:eq(1)").filter((function(){return 0==e.text([this]).toLowerCase().indexOf(r)})));u>0&&u<c.length||(u=0),s=e(c[u]),n.unSelectAll(l.grid,!0);for(var h=!1,f=l.getData(),_=0;_<f.length;_++)if(f[_].id==s.parents("tr").attr("id")){h=f[_];break}v=h,n.setSelectItem(h,l),n.setIsChanged(!0),(_e={})[r]=u+1}}else r&&(u=_e[r]?_e[r]:0,c=e(n.getUnSelectGrid().grid.find("tr").find("td:first").filter((function(){return 0==e.text([this]).toLowerCase().indexOf(r)}))),u>0&&u<c.length||(u=0),i=(s=e(c[u])).parent().index()-1,h=this.getItemByIndex(i),v=h,n.setSelectItem(h),(_e={})[r]=u+1)}},this.gridScrollTop=function(){n&&n.gridScrollTop()},this.gridScrollDown=function(){n&&n.gridScrollDown()},this.selectAll=function(){n&&!j&&d&&n.selectAll()},this.getIsMouseOver=function(){return L},this.onShowAll=function(e){B=e;var t=this.buildUnSelectGridFilter();c["get"+ne](t,{onResult:function(e){var t=e.getResult();if(t||(t=[]),s=e.getPagerData(),U=t,Global.isSet(c)&&(U=Global.formatGridData(U,c.key_name)),!B){var i=n.getSelectItems();for(var l in i)for(var a in U)if(i[l].id==U[a].id){U=U.slice(a);break}}n.setUnselectedGridData(U),n.setPagerData(s)}})},this.buildUnSelectGridFilter=function(){var e={filter_data:{}};if(e.filter_columns=l.getColumnFilter(),e.filter_items_per_page=R,n&&(e.filter_data=Global.clone(n.getUnSelectGridMap()),e.filter_sort=Global.clone(n.getUnSelectGridSortMap())),Y){if(Global.isSet(Y.filter_data))for(var t in Y.filter_data)e.filter_data.hasOwnProperty(t)||(e.filter_data[t]=Y.filter_data[t]);Y&&Global.isSet(Y.permission_section)&&(e.permission_section=Y.permission_section),Global.isSet(Y.filter_sort)&&!e.filter_sort&&(e.filter_sort=Y.filter_sort)}if(Z){if(Global.isSet(Z.filter_data))for(var t in Z.filter_data)e.filter_data.hasOwnProperty(t)||(e.filter_data[t]=Z.filter_data[t]);Z&&Global.isSet(Z.permission_section)&&(e.permission_section=Z.permission_section),Global.isSet(Z.filter_sort)&&!e.filter_sort&&(e.filter_sort=Z.filter_sort)}if(this.customSearchFilter&&(e=this.customSearchFilter(e)),B&&(e.second_parameter=!0),n){var i=D;if(i&&Global.isArray(i)&&i.length>0&&i[0]!=TTUUID.zero_id)for(var a in e.filter_data.exclude_id=[],i)e.filter_data.exclude_id.push(i[a])}return e},this.buildSelectGridFilter=function(){var e={};return e.filter_columns=l.getColumnFilter(),e.filter_items_per_page=R,e.filter_data=n.getSelectGridMap(),e.filter_sort=n.getSelectGridSortMap(),e.second_parameter=!0,e},this.searchIsEmpty=function(t){for(var i=t.find("input.search-input"),l=0;l<i.length;l++)if(e(i[l]).val()!=e.i18n._("click to search"))return!1;return!0},this.onADropDownSearch=function(t,i,a,o,r=!0){var u=this.getValue();if(!("select_grid"==t&&0==u.length||"select_grid"==t&&1==u.length&&u[0]==TTUUID.not_exist_id)){var h={};if(h.filter_columns=l.getColumnFilter(),h.filter_items_per_page=R,"unselect_grid"===t){if(h=this.buildUnSelectGridFilter(),n&&n.getPagerData())if(0===LocalCacheData.paging_type)h.filter_page="next"===i?n.getPagerData().next_page:1;else switch(i){case"next":h.filter_page=n.getPagerData().next_page;break;case"last":h.filter_page=n.getPagerData().previous_page;break;case"start":h.filter_page=1;break;case"end":h.filter_page=n.getPagerData().last_page_number;break;default:h.filter_page=n.getPagerData().current_page}parseInt(i)>=1&&(h.filter_page=i),c["get"+ne](h,{onResult:function(t){var u=e(":focus"),h=t.getResult();Global.isArray(h)||(h=[]),oe&&(h=oe(l,h)),0===LocalCacheData.paging_type&&"next"===i&&(h=n.getUnSelectGridData().concat(h)),X?(U=h,s=t.getPagerData()):(W=h,ge=t.getPagerData().current_page),"array"!=e.type(h)&&(h=[]),d||l.createFirstItem(h),h=Global.formatGridData(h,c.key_name),H&&(h=H(h)),n&&n.setUnselectedGridData(h),d?n&&n.setSelectGridData(n.getSelectItems(),!0):(n&&n.setSelectItem(n.getSelectItem()),"first"==a?(l.setValue(h[0]),1==r&&l.trigger("formItemChange",[l]),o&&o(h[0])):"last"==a&&(l.setValue(h[h.length-1]),1==r&&l.trigger("formItemChange",[l]),o&&o(h[h.length-1]))),n&&n.setPagerData(t.getPagerData()),h.length<1&&n.getSelectItems().length<1?n&&n.showNoResultCover("unselect_grid"):n&&n.removeNoResultCover("unselect_grid"),n&&n.getUnSelectGrid().grid.show(),u.length&&u.focus()}})}else(h=this.buildSelectGridFilter()).filter_data.id&&!1!==h.filter_data.id&&c["get"+ne](h,{onResult:function(t){var i=t.getResult(),l=e(":focus");"array"!=e.type(i)&&(i=[]),i=Global.formatGridData(i,c.key_name),n.setSelectGridSearchResult(i),i.length<1?(n.getSelectGrid().grid.clearGridData(),n.showNoResultCover("select_grid")):n.removeNoResultCover("select_grid"),n.setSelectGridDragAble(),n.getSelectGrid().grid.show(),l.length>0&&l.focus()}})}},this.buildDisplayColumns=function(e){for(var t=w.length,i=e.length,l=[],a=0;a<i;a++)for(var o=0;o<t;o++)e[a]===w[o].value&&l.push(w[o]);return l},this.buildDisplayColumnsForEditor=function(){for(var e=w.length,t=S.length,i=[],l=0;l<t;l++)for(var a=0;a<e;a++)if(S[l]){if(Global.isSet(S[l].name))var o=S[l].name;else Global.isSet(S[l].value)&&(o=S[l].value);o===w[a].value&&i.push(w[a])}return i},this.getLocalSelectItem=function(t){if(ue){for(var i=0;i<ue.length;i++)if(t==ue[i].value){var l={};return l[z]=t,e.each(S,(function(e,t){return l[t.name]=ue[i].label,!1})),l}return this.getFirstItem()}return this.getFirstItem()},this.getFirstItem=function(){var t={};return t[z]=TTUUID.zero_id,t[z]=f||y?TTUUID.not_exist_id:TTUUID.zero_id,e.each(S,(function(e,i){return"id"!==z&&(t.id=TTUUID.not_exist_id),y?t[i.name]=Global.all_item:f?t[i.name]=Global.any_item:m||g?t[i.name]=Global.empty_item:p?t[i.name]=Global.open_item:b&&(t[i.name]=Global.default_item),se&&(t[i.name]=se),!1})),t},this.createFirstItem=function(t){var i=!1;if(t||(t=U),t.hasOwnProperty(0))if(f||y){if(t[0][z]===TTUUID.not_exist_id)return}else if(t[0][z]===TTUUID.zero_id)return;var l={};l[z]=TTUUID.zero_id,l[z]=f||y||g?TTUUID.not_exist_id:TTUUID.zero_id,e.each(S,(function(e,t){return"id"!==z&&(l.id=TTUUID.not_exist_id),y?l[t.name]=Global.all_item:f?l[t.name]=Global.any_item:m||g?l[t.name]=Global.empty_item:p?l[t.name]=Global.open_item:b?l[t.name]=Global.default_item:i=!0,se&&(l[t.name]=se),!1})),i||t.unshift(l)},this.checkIfLayoutChanged=function(e){if(!S)return!0;if(!e)return!0;if(S.length!==e.length)return!0;for(var t=S.length,i=0;i<t;i++){for(var l=S[i],a=!1,o=0;o<t;o++)if(e[o].name===l.name){a=!0;break}if(!a)return!0}return!1},this.setDefaultArgs=function(e){l.default_args=e,ae=!0,Z=e},this.setDisPlayColumns=function(e){S=Global.convertColumnsTojGridFormat(e,r)},this.setPossibleDisplayColumns=function(e,t){T=e,I=t||e,"global_option_column"!==r&&"global_tree_column"!==r&&"global_sort_columns"!==r&&"global_timesheet"!==r&&"global_absence"!==r&&this.initColumns()},this.setRowPerPage=function(e){R=e},this.setPagerData=function(e){s=e},this.shouldInitColumns=function(){return"global_option_column"!==r&&"global_tree_column"!==r&&"global_sort_columns"!==r&&"global_timesheet"!==r&&"global_absence"!==r&&"global_simple_name"!==r&&"global_simple_name_navigation"!==r},this.createItem=function(t,i){var l={};return l[z]=t,e.each(S,(function(e,t){return"id"!==z&&(l.id=2e4),l[t.name]=i,!1})),l},this.initSourceData=function(){var e=l.buildUnSelectGridFilter();c["get"+ne](e,{onResult:function(e){var t=e.getResult();Global.isArray(t)||(t=[]),U=t,s=e.getPagerData(),l.trigger("initSourceComplete",[l])}}),he=!1},this.addHideIdColumn=function(e){return e.push({name:"id",index:"id",label:"",width:0,hidden:!0}),e},this.each((function(){var t=e.meta?e.extend({},a,e(this).data()):a;o=e(this).find(".a-combobox-label");var _=e(this).find(".focus-input");t.always_include_columns&&(pe=t.always_include_columns),t.extendDataProcessWhenSearch&&(H=t.extendDataProcessWhenSearch),t.always_search_full_columns&&(fe=t.always_search_full_columns),t.added_items&&(ue=t.added_items),t.init_data_immediately&&(he=t.init_data_immediately),t.custom_first_label&&(se=t.custom_first_label),t.script_name&&t.script_name,t.setRealValueCallBack&&(re=t.setRealValueCallBack),t.navigation_mode&&(X=t.navigation_mode,e(this).children().eq(1).css("max-width",132),e(this).children().eq(1).css("min-width",132)),t.search_panel_model&&(e(this).children().eq(1).css("max-width",132),e(this).children().eq(1).css("min-width",132)),t.width?(e(this).children().eq(1).css("max-width",t.width),t.is_static_width&&e(this).children().eq(1).css("min-width",t.width)):e(this).children().eq(1).css("min-width",132),t.api_class&&(u=t.api_class,c=t.api_class),t.custom_key_name?ne=t.custom_key_name:c&&(ne=c.key_name),t.allow_multiple_selection&&(d=t.allow_multiple_selection),t.set_any&&(f=t.set_any),t.set_empty&&(m=t.set_empty),t.set_special_empty&&(g=t.set_special_empty),t.set_open&&(p=t.set_open),t.set_default&&(b=t.set_default),t.set_all&&(y=t.set_all),t.addition_source_function&&(oe=t.addition_source_function),t.column_option_key&&(ce=t.column_option_key),C=t.field,t.validation_field&&(i=t.validation_field),t.layout_name&&(r=X?t.layout_name+"_navigation":t.layout_name),t.show_search_inputs&&(V=t.show_search_inputs),t.tree_mode&&(j=t.tree_mode),t.on_tree_grid_row_select&&(q=t.on_tree_grid_row_select),J=!0,t.key&&(z=t.key),t.args&&(l.args=t.args),t.customSearchFilter&&(l.customSearchFilter=t.customSearchFilter),t.default_args&&l.setDefaultArgs(t.default_args);var G=this;function x(e){f&&e==TTUUID.not_exist_id||n.setSelectGridData(e)}function w(){if(K){if(LocalCacheData.openAwesomeBox){if(LocalCacheData.openAwesomeBox.getId()===A)return void LocalCacheData.openAwesomeBox.onClose();LocalCacheData.openAwesomeBox.onClose()}LocalCacheData.openAwesomeBox=l,n=Global.loadWidget("global/widgets/awesomebox/ADropDown.html"),n=e(n);var t=!1;l.shouldInitColumns()&&!X&&(t=!0),X&&u&&u.filter_sort&&!te&&(te=u.filter_sort),n=n.ADropDown({display_show_all:t,allow_drag_to_order:J,allow_multiple_selection:d,show_all:B,key:z,id:A,comboBox:l,show_search_inputs:V,search_input_filter:$,select_grid_search_input_filter:ee,default_sort_filter:te,default_select_grid_sort_filter:ie,tree_mode:j,column_option_key:ce,api:c,display_column_settings:l.shouldInitColumns(),on_tree_grid_row_select:q}),(P=e("<div id='"+A+"a_dropdown_div' class='a-dropdown-div'></div>")).append(n),P.mouseenter((function(){L=!0})),P.mouseleave((function(){L=!1})),e("body").append(P),TTPromise.wait("AComboBox","init",(function(){if(n.setGridColumnsWidths(),d&&l.getValue().length>0&&c){var t={};t.filter_data={id:l.getValue()},t.filter_columns=l.getColumnFilter(),t.filter_items_per_page=1e4,c["get"+ne](t,{onResult:function(e){i(e)}})}else i();function i(t){t&&n.setRealSelectItems(t.getResult(),l.getValue()),P.css("opacity","1");var i=l.find(".ui-jqgrid").find("table");if(i.length>0)for(var a=0;a<i.length;a++){var o=e(i[0]).parents(".ui-jqgrid").find(".ui-jqgrid-bdiv").width()-11;e(i[0]).parents(".ui-jqgrid").find(".ui-jqgrid-view").width(o),e(i[a]).width(o)}n.setUnSelectGridDragAble(),n.setSelectGridDragAble()}})),n.bind("close",l.onClose);var i=ALayoutCache.layout_dic[r];if(r&&i&&Global.isSet(i.data)){var a=i.data.display_columns;a.length>0?T&&(a=be(a)):I&&(a=be(a=I)),a=Global.convertColumnsTojGridFormat(a,r);var o=i.data.row_per_page;if((l.checkIfLayoutChanged(a)||R!==o&&!X)&&(S=a,U=null),!X&&(R=o,!ae))if(Global.isSet(i.data.type)&&10===i.data.type){var u={};u.filter_data=i.data.filter_data,u.filter_sort=i.data.filter_sort}else u=null}n.setColumns(S);var h,_,C,G=n.getBoxWidth();if(d&&(G=2*G+30+15),G+e(l).offset().left+50>Global.bodyWidth()?P.css("left",Global.bodyWidth()-G-50):P.css("left",e(l).offset().left),e(l).offset().top+25+275<Global.bodyHeight()?P.css("top",e(l).offset().top+25):P.css("top",e(l).offset().top-275),U){if(Global.isSet(c)&&(U=Global.formatGridData(U,c.key_name)),d)if("global_sort_columns"===r&&(_=[],C=U,(h=D)&&e.each(h,(function(t,i){for(var l in i){if("label"===l||"value"===l||"fullValue"===l)return _=h,!1;e.each(C,(function(e,t){if(t.value===l)return t.sort=i[l],_.push(t),!1}))}})),D=_),k)if(k=!1,n.setUnselectedGridData(U),!D||D&&1==D.length&&(D[0]==TTUUID.zero_id||D[0]==TTUUID.not_exist_id))TTPromise.resolve("AComboBox","init");else{(F={}).filter_data={id:D},F.filter_columns=l.getColumnFilter(),F.filter_items_per_page=1e4;var w=!1;D&&D.length>0&&(D[0]==TTUUID.zero_id||D[0]==TTUUID.not_exist_id)&&(w=l.getLocalSelectItem(D[0])),c["get"+ne](F,{onResult:function(e){D=e.getResult(),w&&D.unshift(w),n.setUnselectedGridData(U),x(D),TTPromise.resolve("AComboBox","init")}})}else n.setUnselectedGridData(U),x(D),TTPromise.resolve("AComboBox","init");else n.setUnselectedGridData(U),n.setSelectItem(v),TTPromise.resolve("AComboBox","init");n.setPagerData(s),Global.isEmpty($)&&Global.isEmpty(te)?ge>1&&ge<=s.last_page_number&&(n.getUnSelectGrid().grid.hide(),l.onADropDownSearch("unselect_grid",ge)):(n.getUnSelectGrid().grid.hide(),l.onADropDownSearch("unselect_grid"),ge=1),Global.isEmpty(ee)&&Global.isEmpty(ie)||l.onADropDownSearch("select_grid")}else{var F=l.buildUnSelectGridFilter();if(!c)return void TTPromise.resolve("AComboBox","init");c["get"+ne](F,{onResult:function(e){var t=e.getResult();if(Global.isArray(t)||(t=[]),U=t,oe&&(U=oe(l,U)),le=null,Global.isSet(c)&&(U=Global.formatGridData(U,c.key_name)),d)if(y&&l.createFirstItem(),k)if(k=!1,n.setUnselectedGridData(U),!D||D&&1==D.length&&(D[0]==TTUUID.zero_id||D[0]==TTUUID.not_exist_id))TTPromise.resolve("AComboBox","init");else{var i={};i.filter_data={id:D},i.filter_columns=l.getColumnFilter(),i.filter_items_per_page=1e4;var a=!1;D&&D.length>0&&(D[0]==TTUUID.zero_id||D[0]==TTUUID.not_exist_id)&&(a=l.getLocalSelectItem(D[0])),c["get"+ne](i,{onResult:function(e){D=e.getResult(),a&&D.unshift(a),x(D),TTPromise.resolve("AComboBox","init")}})}else n.setUnselectedGridData(U),x(D),TTPromise.resolve("AComboBox","init");else(m||f||b||p||g)&&l.createFirstItem(),n.setUnselectedGridData(U),n.setSelectItem(v),TTPromise.resolve("AComboBox","init");s=e.getPagerData(),n.setPagerData(s),Global.isEmpty($)&&Global.isEmpty(te)||(n.getUnSelectGrid().grid.hide(),l.onADropDownSearch("unselect_grid")),Global.isEmpty(ee)&&Global.isEmpty(ie)||(n.getSelectGrid().grid.hide(),l.onADropDownSearch("select_grid"))}})}}}_.unbind("keydown").bind("keydown",(function(e){13!==e.keyCode&&32!==e.keyCode||(e.stopPropagation(),e.preventDefault(),TTPromise.add("AComboBox","init"),w())})),_.bind("focusin",(function(){e(G).addClass("focus")})),_.bind("focusout",(function(){e(G).removeClass("focus")})),e(this).click((function(e){if(e.stopPropagation(),K){if(!0===de)return;TTPromise.add("AComboBox","init"),w()}else(LocalCacheData.current_open_sub_controller&&LocalCacheData.current_open_sub_controller.edit_view&&LocalCacheData.current_open_sub_controller.is_viewing||LocalCacheData.current_open_primary_controller&&LocalCacheData.current_open_primary_controller.edit_view&&LocalCacheData.current_open_primary_controller.is_viewing)&&(N=Global.view_mode_message,l.showErrorTip(10))})),e(this).mouseover((function(){K&&N&&N.length>0&&l.showErrorTip(1e3)})),e(this).mouseout((function(){l.hideErrorTip()})),t.width?e(this).css("min-width",t.width+33+"px"):e(this).css("min-width","169px"),l.shouldInitColumns()||(h=!0),S=ALayoutCache.getDefaultColumn(r),S=Global.convertColumnsTojGridFormat(S,r),l.shouldInitColumns()&&!X&&l.initColumns(),t.id?(e(this).attr("id",t.id+"_AComboBox"),A=t.id):(e(this).attr("id",C+"_AComboBox"),A=t.field),l.setEmptyLabel()})),this},e.fn.AComboBox.defaults={}}}]);
//# sourceMappingURL=awesomebox-AComboBox.bundle.js.map?v=a9f3e16aa307a4a561a4