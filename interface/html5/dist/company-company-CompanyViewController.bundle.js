(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["company-company-CompanyViewController","filebrowser-TImageAdvBrowser","filebrowser-TImageBrowser"],{8243:()=>{!function(e){e.fn.TImageAdvBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a,o,n=e.extend({},e.fn.TImageAdvBrowser.defaults,t),d=this,l="",s=177,r=42,m=null;return this.setEnable=function(e){e;var t=this.children().eq(1);e?t.show():t.hide()},this.clearErrorStyle=function(){},this.getField=function(){return i},this.getValue=function(){return o},this.setImage=function(e){if(!e)return a.attr("src",""),void a.hide();var t=new Date;a.hide(),a.attr("src",e+"&t="+t.getTime()+"&X-CSRF-Token="+getCookie("CSRF-Token")),a.css("height","auto"),a.css("width","auto")},this.onImageLoad=function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,a=e(t).width()>0?e(t).width():t.naturalWidth;i>r&&e(t).css("height",r),a>s&&(e(t).css("width",s),e(t).css("height","auto")),d.trigger("setSize"),i<5?e(t).hide():e(t).show()},this.setValue=function(e){e||(e="")},this.setEnableDelete=function(e){var t=d.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.each((function(){var t=e.meta?e.extend({},n,e(this).data()):n;i=t.field;e(this).find("#upload_image").text(e.i18n._("Upload Image")),t.callBack&&(m=t.callBack),!1===t.show_browser&&e(this).children().eq(1).hide(),t.default_width>0&&(s=t.default_width),t.default_height>0&&(r=t.default_height),Global.isSet(t.name)&&t.name,Global.isSet(l)&&(l=t.accept_filter),Global.isSet(t.deleteImageHandler)&&d.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),e(this).children().eq(1).bind("click",(function(){IndexViewController.openWizard("UserPhotoWizard",null,(function(e){m&&m(e),o=e}))})),(a=e(this).children().eq(0)).on("load",(function(){d.onImageLoad(this)})),a.hide()})),this},e.fn.TImageAdvBrowser.defaults={}}(jQuery)},3536:()=>{!function(e){e.fn.TImageBrowser=function(t){Global.addCss("global/widgets/filebrowser/TImageBrowser.css");var i,a,o=e.extend({},e.fn.TImageBrowser.defaults,t),n=this,d="filedata",l="",s=177,r=42;this.setEnabled=function(e){e;var t=this.find(".browser-form input");e?(t.removeAttr("disabled"),t.removeClass("disable-element")):(t.attr("disabled",!0),t.removeClass("disable-element").addClass("disable-element"))},this.clearErrorStyle=function(){},this.getFileName=function(){return a.val()},this.getField=function(){return i},this.setEnableDelete=function(e){var t=n.find(".image");e?t.attr("enable-delete",1):t.removeAttr("enable-delete")},this.getValue=function(){return a&&a.val()?"undefined"==typeof FormData?n.find(".browser-form"):new FormData(e(n.find(".browser-form"))[0]):null},this.getImageSrc=function(){return n.find(".image").attr("src")},this.setImage=function(e){var t=n.find(".image");if(!e)return t.attr("src",""),void t.hide();var i=new Date;t.hide(),t.attr("src",e+"&t="+i.getTime()),t.css("height","auto"),t.css("width","auto")};return this.setValue=function(e){e||(e="")},this.each((function(){var t=e.meta?e.extend({},o,e(this).data()):o;i=t.field,t.default_width>0&&(s=t.default_width),t.default_height>0&&(r=t.default_height),Global.isSet(t.name)&&(d=t.name),Global.isSet(l)&&(l=t.accept_filter),a=e(this).find(".browser");var m=e(this).find(".image");m.hide(),m.on("load",(function(){!function(t){var i=e(t).height()>0?e(t).height():t.naturalHeight,a=e(t).width()>0?e(t).width():t.naturalWidth;i>r&&e(t).css("height",r),a>s&&(e(t).css("width",s),e(t).css("height","auto")),n.trigger("setSize"),i<5?e(t).hide():e(t).show()}(this)})),l?a.attr("accept",l):(l="image/*",a.attr("accept","image/*")),a.attr("id","file_browser"),a.attr("name",d),Global.isSet(t.changeHandler)&&n.bind("imageChange",t.changeHandler),Global.isSet(t.deleteImageHandler)&&this.find(".file-browser").on("deleteClick",(function(){t.deleteImageHandler()})),a.bind("change",(function(){if(m.hide(),"undefined"!=typeof FileReader){var e=this.files?this.files:[];if(!e.length||!window.FileReader)return;if("image/*"===l){var t=new FileReader;t.readAsDataURL(e[0]),t.onloadend=function(){var e=this.result;m.attr("src",e)}}}n.trigger("imageChange",[n])}))})),this},e.fn.TImageBrowser.defaults={}}(jQuery)},4164:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"CompanyViewController":()=>a});i(3536),i(8243);class a extends BaseViewController{constructor(e={}){_.defaults(e,{product_edition_array:null,industry_array:null,country_array:null,province_array:null,e_province_array:null,terminated_user_disable_login_type_array:null,password_policy_type_array:null,password_minimum_permission_level_array:null,password_minimum_strength_array:null,ldap_authentication_type_array:null,file_browser:null}),super(e)}init(e){this.permission_id="company",this.viewId="Company",this.script_name="CompanyView",this.table_name_key="company",this.context_menu_name=$.i18n._("Company Information"),this.api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData()}getCustomContextMenuModel(){return{exclude:["default"],include:[ContextMenuIconName.save,ContextMenuIconName.cancel]}}initOptions(e){this.initDropDownOptions([{option_name:"product_edition"},{option_name:"terminated_user_disable_login_type"},{option_name:"industry"},{option_name:"country"},{option_name:"password_policy_type"},{option_name:"password_minimum_permission_level",field_name:"password_minimum_permission_level"},{option_name:"password_minimum_strength",field_name:"password_minimum_strength"},{option_name:"ldap_authentication_type"}],(function(t){e&&e(t)}))}getCompanyData(e){var t={filter_data:{id:LocalCacheData.getLoginUser().company_id}};this.api["get"+this.api.key_name](t,{onResult:function(t){var i=t.getResult();Global.isSet(i[0])&&e(i[0])}})}openEditView(){var e=this;e.edit_only_mode?e.initOptions((function(t){e.edit_view||e.initEditViewUI("Company","CompanyEditView.html"),e.getCompanyData((function(t){e.current_edit_record=t,e.initEditView()}))})):this.edit_view||this.initEditViewUI("Company","CompanyEditView.html");var t=window.location.href;-1==t.indexOf("company_id")&&(t=t+"&company_id="+LocalCacheData.getLoginUser().company_id,Global.setURLToBrowser(t))}removeCompanyIdFromUrl(){var e=window.location.href;if(-1!=e.indexOf("company_id")){var t=e.split("&");e=t[0];for(var i=1;i<t.length-1;i++)e+="&"+t[i];Global.setURLToBrowser(e)}}removeEditView(){this.removeCompanyIdFromUrl(),super.removeEditView()}setCurrentEditRecordData(){for(var e in this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"country":this.setCountryValue(t,e);break;default:t.setValue(this.current_edit_record[e])}}this.file_browser.setImage(ServiceCaller.getURLByObjectType("company_logo")),this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}initSubPasswordPolicyView(){Global.getProductEdition()>=15?(this.edit_view_tab.find("#tab_password_policy").find(".first-column").css("display","block"),this.edit_view.find(".permission-defined-div").css("display","none"),this.buildContextMenu(!0),this.setEditMenu()):(this.edit_view_tab.find("#tab_password_policy").find(".first-column").css("display","none"),this.edit_view.find(".permission-defined-div").css("display","block"),this.edit_view.find(".permission-message").html(Global.getUpgradeMessage()))}setEditMenuSaveIcon(e,t){}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();switch(this.current_edit_record[i]=a,i){case"country":this.edit_view_ui_dic.province.setValue(null)}"ldap_authentication_type_id"===i&&this.onTypeChange(),"country"!==i?t||this.validate():this.onCountryChange()}onSaveDone(e){return!(!e.isValid()||!0!==e.getResult())&&(this.updateCurrentCompanyCache(),!0)}updateCurrentCompanyCache(){TTAPI.APIAuthentication.getCurrentCompany({onResult:this.onGetCurrentCompany})}onGetCurrentCompany(e){var t=e.getResult();"1"===t.is_setup_complete||1===t.is_setup_complete?t.is_setup_complete=!0:t.is_setup_complete=!1,LocalCacheData.setCurrentCompany(t)}updateCompanyLogo(){$("#rightLogo").css("opacity",0),$("#rightLogo").attr("src",ServiceCaller.getURLByObjectType("company_logo")),$("#rightLogo").on("load",(function(){$(this).height();$(this).height()>42&&($(this).css("height",42),$(this).width>177&&$(this).css("width",177)),$(this).width>177&&$(this).css("width",177),$(this).animate({opacity:1},100)}))}setErrorMenu(){for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");switch(i.removeClass("disable-image"),a){case ContextMenuIconName.cancel:break;default:i.addClass("disable-image")}}}setProvince(e,t){var i=this;e&&"-1"!==e&&"0"!==e?this.api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e)}}):i.province_array=[]}eSetProvince(e,t){var i=this,a=i.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.e_province_array=Global.buildRecordArray(e),t&&i.e_province_array.length>0&&(i.current_edit_record.province=i.e_province_array[0].value,a.setValue(i.current_edit_record.province)),a.setSourceData(i.e_province_array)}}):(i.e_province_array=[],a.setSourceData([]))}buildEditViewUI(){var e=this;super.buildEditViewUI();var t={"tab_company":{"label":$.i18n._("Company")},"tab_password_policy":{"label":$.i18n._("Password Policy"),"init_callback":"initSubPasswordPolicyView"},"tab_ldap":{"label":$.i18n._("LDAP Authentication")},"tab_audit":!0};this.setTabModel(t);var i,a,o,n=this.edit_view_tab.find("#tab_company"),d=n.find(".first-column"),l=n.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(d),this.edit_view_tabs[0].push(l),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"product_edition_id"}),i.setSourceData(e.product_edition_array),this.addEditFieldToColumn($.i18n._("Product Edition"),i,d,""),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Full Name"),i,d),i.parent().width("45%"),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"short_name",width:128}),this.addEditFieldToColumn($.i18n._("Short Name"),i,d),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"industry_id"}),i.setSourceData(e.industry_array),this.addEditFieldToColumn($.i18n._("Industry"),i,d),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 1)"),i,d),i.parent().width("45%"),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 2)"),i,d),i.parent().width("45%"),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"city",width:149}),this.addEditFieldToColumn($.i18n._("City"),i,d),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"country",set_empty:!0}),i.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Country"),i,d),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"province"}),i.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province/State"),i,d),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn($.i18n._("Postal/ZIP Code"),i,d,""),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone",width:149}),this.addEditFieldToColumn($.i18n._("Phone"),i,l,""),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"fax_phone",width:149}),this.addEditFieldToColumn($.i18n._("Fax"),i,l),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"admin_contact"}),this.addEditFieldToColumn($.i18n._("Administrative Contact"),i,l),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"billing_contact"}),this.addEditFieldToColumn($.i18n._("Billing Contact"),i,l),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"support_contact"}),this.addEditFieldToColumn($.i18n._("Primary Support Contact"),i,l),(i=Global.loadWidgetByName(FormItemType.SEPARATED_BOX)).SeparatedBox({label:$.i18n._("Company Settings")}),this.addEditFieldToColumn(null,i,l),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"terminated_user_disable_login_type_id"}),i.setSourceData(e.terminated_user_disable_login_type_array),this.addEditFieldToColumn($.i18n._("Disable Terminated Employees"),i,l,""),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"terminated_user_disable_login_after_days",width:25});var s=$("<div class='widget-h-box'></div>");s.append(i),s.append($("<span class='widget-right-label'>( "+$.i18n._("Days")+" )</span>")),this.addEditFieldToColumn($.i18n._("Disable Terminated Employees Login After"),i,l,"",s),"undefined"==typeof FormData?(i=Global.loadWidgetByName(FormItemType.IMAGE_BROWSER),this.file_browser=i.TImageBrowser({field:"",default_width:128,default_height:128}),this.file_browser.bind("imageChange",(function(t,i){(new ServiceCaller).uploadFile(i.getValue(),"object_type=company_logo",{onResult:function(t){"true"===t.toLowerCase()?(e.file_browser.setImage(ServiceCaller.getURLByObjectType("company_logo")),e.updateCompanyLogo()):TAlertManager.showAlert(t,"Error")}})}))):(i=Global.loadWidgetByName(FormItemType.IMAGE_AVD_BROWSER),this.file_browser=i.TImageAdvBrowser({field:"",callBack:function(t){(new ServiceCaller).uploadFile(t,"object_type=company_logo",{onResult:function(t){"true"===t.toLowerCase()?(e.file_browser.setImage(ServiceCaller.getURLByObjectType("company_logo")),e.updateCompanyLogo()):TAlertManager.showAlert(t,"Error")}})}})),(this.is_edit||this.edit_only_mode)&&(this.file_browser.setEnableDelete(!0),this.file_browser.bind("deleteClick",(function(t,i){e.api.deleteImage(e.current_edit_record.id,{onResult:function(t){e.initEditView(t)}})}))),this.addEditFieldToColumn($.i18n._("Logo"),this.file_browser,l,"",null,!1,!0);var r=this.edit_view_tab.find("#tab_password_policy").find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(r),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_policy_type_id"}),i.setSourceData(e.password_policy_type_array),this.addEditFieldToColumn($.i18n._("Password Policy"),i,r,""),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_minimum_permission_level"}),i.setSourceData(e.password_minimum_permission_level_array),this.addEditFieldToColumn($.i18n._("Minimum Permission Level"),i,r),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_minimum_strength"}),i.setSourceData(e.password_minimum_strength_array),this.addEditFieldToColumn($.i18n._("Minimum Strength"),i,r),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_minimum_length",width:30}),this.addEditFieldToColumn($.i18n._("Minimum Length"),i,r),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_minimum_age",width:30}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("in Days")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Minimum Age"),i,r,"",a),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_maximum_age",width:30}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("in Days")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Maximum Age"),i,r,"",a);var m=this.edit_view_tab.find("#tab_ldap").find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(m),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"ldap_authentication_type_id"}),i.setSourceData(e.ldap_authentication_type_array),this.addEditFieldToColumn($.i18n._("LDAP Authentication"),i,m),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_host",width:240}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: ldap.example.com or ldaps://ldap.example.com for SSL)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Server"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_port",width:50}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: 389 or 636 for SSL)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Port"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_user_name"}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("Used to search for the user, for anonymous binding enter: anonymous")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Bind User Name"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_password"}),this.addEditFieldToColumn($.i18n._("Bind Password"),i,m,"",null,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_base_dn",width:300}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: ou=People,dc=example,dc=com)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Base DN"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_attribute",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("For binding the LDAP user. (ie: AD/openLDAP: userPrincipalName, Mac OSX: uid)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Bind Attribute"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_user_filter",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("Additional filter parameters. (ie: is_timetrex_user=1)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("User Filter"),i,m,"",a,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_login_attribute",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("For searching the LDAP user. (ie: AD: sAMAccountName, openLDAP: dn, Mac OSX: dn)")+"</span>"),a.append(i),a.append(o),this.addEditFieldToColumn($.i18n._("Login Attribute"),i,m,"",a,!0)}onTypeChange(){0==this.current_edit_record.ldap_authentication_type_id?(this.detachElement("ldap_host"),this.detachElement("ldap_port"),this.detachElement("ldap_bind_user_name"),this.detachElement("ldap_bind_password"),this.detachElement("ldap_base_dn"),this.detachElement("ldap_bind_attribute"),this.detachElement("ldap_user_filter"),this.detachElement("ldap_login_attribute")):(this.attachElement("ldap_host"),this.attachElement("ldap_port"),this.attachElement("ldap_bind_user_name"),this.attachElement("ldap_bind_password"),this.attachElement("ldap_base_dn"),this.attachElement("ldap_bind_attribute"),this.attachElement("ldap_user_filter"),this.attachElement("ldap_login_attribute")),this.editFieldResize()}}}}]);
//# sourceMappingURL=company-company-CompanyViewController.bundle.js.map?v=1619cad1f38d4e0b6d62