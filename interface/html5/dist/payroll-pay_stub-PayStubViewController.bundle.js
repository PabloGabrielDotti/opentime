(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["payroll-pay_stub-PayStubViewController"],{3436:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"PayStubViewController":()=>n});var a=i(3776);class n extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#pay_stub_view_container",filtered_status_array:null,user_status_array:null,user_group_array:null,user_destination_account_array:null,currency_array:null,type_array:null,country_array:null,province_array:null,e_province_array:null,user_api:null,user_group_api:null,company_api:null,pay_stub_entry_api:null,include_pay_stub_accounts:!0,transaction_status_array:!1,net_pay_amount:!1,pseal_link:!1,original_status_id:10}),super(e)}init(e){this.edit_view_tpl="PayStubEditView.html",this.permission_id="pay_stub",this.viewId="PayStub",this.script_name="PayStubView",this.table_name_key="pay_stub",this.context_menu_name=$.i18n._("Pay Stub"),this.navigation_label=$.i18n._("Pay Stubs")+":",this.api=TTAPI.APIPayStub,this.user_api=TTAPI.APIUser,this.pay_stub_entry_api=TTAPI.APIPayStubEntry,this.pay_stub_entry_account_link_api=TTAPI.APIPayStubEntryAccountLink,this.user_group_api=TTAPI.APIUserGroup,this.company_api=TTAPI.APICompany,this.pay_period_api=TTAPI.APIPayPeriod,this.pay_stub_transaction_api=TTAPI.APIPayStubTransaction,this.remittance_destination_account_api=TTAPI.APIRemittanceDestinationAccount;var t=this;$.when(this.preloadTransactionOptions(new $.Deferred),this.preloadPayStubAccountLinks(new $.Deferred)).done((function(){t.completeInit()}))}isEditMode(){return!!(this.is_add||this.is_edit&&25==this.original_status_id)}preloadTransactionOptions(e){var t=this;return this.pay_stub_transaction_api.getOptions("status",!1,!1,{onResult:function(i){t.transaction_status_array=i.getResult(),e.resolve(!0)}}),e.promise()}preloadPayStubAccountLinks(e){var t=this;return this.pay_stub_entry_account_link_api.getPayStubEntryAccountLink("",!1,!1,{onResult:function(i){var a=i.getResult()[0];a&&(t.pseal_link={total_gross_entry_account_id:!1,total_deductions_entry_account_id:!1,net_pay_entry_account_id:!1,contributions_entry_account_id:!1},t.pseal_link.total_gross_entry_account_id=a.total_gross,t.pseal_link.total_deductions_entry_account_id=a.total_employee_deduction,t.pseal_link.net_pay_entry_account_id=a.total_net_pay,t.pseal_link.contributions_entry_account_id=a.total_employer_deduction),e.resolve(!0)}}),e.promise()}completeInit(){this.initPermission(),this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary("PayStub")}initPermission(){return super.initPermission(),PermissionManager.validate(this.permission_id,"view")||PermissionManager.validate(this.permission_id,"view_child")?this.show_search_tab=!0:this.show_search_tab=!1,{}}initOptions(){var e=this;this.initDropDownOption("filtered_status","status_id"),this.initDropDownOption("type","type_id"),this.initDropDownOption("status","user_status_id",this.user_api),this.initDropDownOption("country","country",this.company_api);for(var t={},i=1;i<=128;i++)t[i]=i;e.basic_search_field_ui_dic.run_id.setSourceData(Global.buildRecordArray(t)),e.adv_search_field_ui_dic.run_id.setSourceData(Global.buildRecordArray(t)),this.user_group_api.getUserGroup("",!1,!1,{onResult:function(t){t=t.getResult(),t=Global.buildTreeRecord(t),e.user_group_array=t,!e.sub_view_mode&&e.basic_search_field_ui_dic.group_id&&(e.basic_search_field_ui_dic.group_id.setSourceData(t),e.adv_search_field_ui_dic.group_id.setSourceData(t))}})}getCustomContextMenuModel(){return{groups:{pay_stubs:{label:$.i18n._("Pay Stubs"),id:this.script_name+"Pay Stubs"}},exclude:[ContextMenuIconName.copy,ContextMenuIconName.save_and_new,ContextMenuIconName.save_and_copy],include:[{label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:"navigation",icon:Icons.timesheet},{label:$.i18n._("Schedule"),id:ContextMenuIconName.schedule,group:"navigation",icon:Icons.schedule},{label:$.i18n._("Pay Stub<br>Amendments"),id:ContextMenuIconName.pay_stub_amendment,group:"navigation",icon:Icons.pay_stub_amendment},{label:$.i18n._("Pay Stub<br>Transactions"),id:ContextMenuIconName.pay_stub_transaction,group:"navigation",icon:Icons.pay_stub_transaction,items:[],permission_result:!0,permission:!0,sort_order:null},{label:$.i18n._("Edit<br>Employee"),id:ContextMenuIconName.edit_employee,group:"navigation",icon:Icons.employee},{label:$.i18n._("Edit Pay<br>Period"),id:ContextMenuIconName.edit_pay_period,group:"navigation",icon:Icons.pay_period},{label:$.i18n._("Employee Pay<br>Stubs"),id:ContextMenuIconName.employee_pay_stubs,group:"pay_stubs",icon:Icons.pay_stubs},{label:$.i18n._("Employer Pay<br>Stubs"),id:ContextMenuIconName.employer_pay_stubs,group:"pay_stubs",icon:Icons.pay_stubs},{label:$.i18n._("Generate<br>Pay Stub"),id:ContextMenuIconName.generate_pay_stub,group:"pay_stubs",icon:Icons.process_payroll},{label:$.i18n._("Process<br>Transactions"),id:ContextMenuIconName.direct_deposit,group:"pay_stubs",icon:"direct_deposit-35x35.png",items:[],permission_result:!0,permission:!0}]}}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var n=$(this.context_menu_array[a]),r=$(n.find(".ribbon-sub-menu-icon")).attr("id");switch(n.removeClass("invisible-image"),n.removeClass("disable-image"),r){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(n,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(n,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(n,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(n,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(n,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(n,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(n,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(n,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(n,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(n,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(n,i);break;case ContextMenuIconName.timesheet:this.setDefaultMenuViewIcon(n,i,"punch");break;case ContextMenuIconName.schedule:this.setDefaultMenuViewIcon(n,i,"schedule");break;case ContextMenuIconName.pay_stub_amendment:this.setDefaultMenuViewIcon(n,i,"pay_stub_amendment");break;case ContextMenuIconName.pay_stub_transaction:this.setDefaultMenuViewIcon(n,i,"pay_stub_transaction");break;case ContextMenuIconName.edit_employee:this.setDefaultMenuEditEmployeeIcon(n,i,"user");break;case ContextMenuIconName.edit_pay_period:this.setDefaultMenuEditPayPeriodIcon(n,i);break;case ContextMenuIconName.employee_pay_stubs:case ContextMenuIconName.employer_pay_stubs:case ContextMenuIconName.print_checks:case ContextMenuIconName.direct_deposit:this.setDefaultMenuReportRelatedIcons(n,i);break;case ContextMenuIconName.generate_pay_stub:this.setDefaultMenuGeneratePayStubIcon(n,i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(n,i)}}this.setContextMenuGroupVisibility()}}setDefaultMenuEditPayPeriodIcon(e,t,i){this.editPermissionValidate("pay_period_schedule")||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuEditEmployeeIcon(e,t){this.editChildPermissionValidate("user")||e.addClass("invisible-image"),1===t?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuViewIcon(e,t,i){"punch"===i||"schedule"===i||"pay_stub_amendment"===i?super.setDefaultMenuViewIcon(e,t,i):"pay_stub_transaction"===i?PermissionManager.validate("pay_stub","enabled")&&(PermissionManager.validate("pay_stub","view")||PermissionManager.validate("pay_stub","view_child"))?e.removeClass("invisible-image"):e.addClass("invisible-image"):(this.viewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),t>0&&this.viewOwnerOrChildPermissionValidate()?e.removeClass("disable-image"):e.addClass("disable-image"))}setEditMenu(){this.selectContextMenu();for(var e=this.context_menu_array.length,t=0;t<e;t++){var i=$(this.context_menu_array[t]),a=$(i.find(".ribbon-sub-menu-icon")).attr("id");if(i.removeClass("disable-image"),this.is_mass_editing)switch(a){case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.cancel:break;default:i.addClass("disable-image")}else switch(a){case ContextMenuIconName.add:this.setEditMenuAddIcon(i);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(i);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(i);break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(i);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(i);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(i);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(i);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(i);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(i);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(i);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(i);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.import_icon:this.setEditMenuImportIcon(i);break;case ContextMenuIconName.timesheet:this.setEditMenuViewIcon(i,"punch");break;case ContextMenuIconName.schedule:this.setEditMenuViewIcon(i,"schedule");break;case ContextMenuIconName.pay_stub_amendment:this.setEditMenuViewIcon(i,"pay_stub_amendment");break;case ContextMenuIconName.edit_employee:this.setEditMenuViewIcon(i,"user");break;case ContextMenuIconName.edit_pay_period:this.setEditMenuViewIcon(i,"pay_period_schedule");break;case ContextMenuIconName.view:case ContextMenuIconName.employer_pay_stubs:case ContextMenuIconName.employee_pay_stubs:case ContextMenuIconName.print_checks:case ContextMenuIconName.direct_deposit:this.setEditMenuEditIcon(i);break;case ContextMenuIconName.generate_pay_stub:this.setEditMenuGeneratePayStubIcon(i);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(i)}}this.setContextMenuGroupVisibility()}setEditMenuViewIcon(e,t){this.viewPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}payStubReportIconsValidate(){if(!PermissionManager.validate("pay_stub","enabled"))return!1;var e=this.getSelectedItem();return!(!PermissionManager.validate("pay_stub","view")&&!this.ownerOrChildPermissionValidate("pay_stub","view_child",e))}setDefaultMenuReportRelatedIcons(e,t,i){this.payStubReportIconsValidate()||e.addClass("invisible-image"),t>0&&this.viewOwnerOrChildPermissionValidate()?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuReportRelatedIcons(e,t,i){this.payStubReportIconsValidate()||e.addClass("invisible-image"),this.current_edit_record.id&&this.viewOwnerOrChildPermissionValidate()?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuGeneratePayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||e.addClass("invisible-image")}endOfPayValidate(){return!(!PermissionManager.validate("pay_period_schedule","enabled")||!PermissionManager.validate("pay_period_schedule","view"))}setDefaultMenuGeneratePayStubIcon(e,t,i){PermissionManager.checkTopLevelPermission("GeneratePayStubs")||e.addClass("invisible-image")}removeEntryInsideEditorCover(){this.cover&&this.cover.length>0&&this.cover.remove(),this.cover=null}setCurrentEditRecordData(){for(var e in this.include_pay_stub_accounts=!0,this.current_edit_record){var t=this.edit_view_ui_dic[e];if(Global.isSet(t))switch(e){case"country":this.setCountryValue(t,e);break;case"status_id":40!=this.current_edit_record[e]&&100!=this.current_edit_record[e]||(this.include_pay_stub_accounts=!1),t.setValue(this.current_edit_record[e]);break;default:t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.is_add?this.edit_view_ui_dic.user_id.setEnabled(!0):this.edit_view_ui_dic.user_id.setEnabled(!1),this.is_mass_editing||this.initInsideEntryEditorData()}getPayStubTransactionDefaultData(e,t){this.pay_stub_transaction_api["get"+this.pay_stub_transaction_api.key_name+"DefaultData"]({onResult:function(i){var a=[],n=i.getResult();n.id=!1,a.push(n),e(a,t)}})}getPayStubTransaction(e){var t=this,i={filter_data:{}};i.filter_data.pay_stub_id=TTUUID.isUUID(this.current_edit_record.id)?this.current_edit_record.id:TTUUID.isUUID(this.copied_record_id)?this.copied_record_id:"",this.pay_stub_transaction_api.getPayStubTransaction(i,!0,{onResult:function(i){if(t.edit_view){var a=i.getResult();0==_.size(a)&&(a=[]),e(a)}}})}initInsideTransactionEditorData(){var e=this;this.current_edit_record&&0!=TTUUID.isUUID(this.current_edit_record.id)||this.copied_record_id?this.getPayStubTransaction((function(t){(1==e.isEditMode()||t.length>0)&&e.editor.insideTransactionEditorSetValue(t)})):this.getPayStubTransactionDefaultData((function(t){(1==e.isEditMode()||t.length>0)&&e.editor.insideTransactionEditorSetValue(t)}))}initInsideEntryEditorData(){var e=this,t={filter_data:{}};if(this.copied_record_id||this.current_edit_record&&this.current_edit_record.id)t.filter_data.pay_stub_id=TTUUID.isUUID(this.current_edit_record.id)?this.current_edit_record.id:this.copied_record_id,this.pay_stub_entry_api["get"+this.pay_stub_entry_api.key_name](t,{onResult:function(t){if(e.edit_view){var i=e.handlePayStubEntryData(t.getResult());e.editor.setValue(i)}}});else{var i=e.handlePayStubEntryData();e.editor.setValue(i)}}handlePayStubEntryData(e){var t={},i={};if(e)for(var a in e){var n=e[a].type_id;if(40==n){if(e[a].pay_stub_entry_account_id){var r=e[a];r.total_row=!0,t[e[a].pay_stub_entry_account_id]=r[a]}}else void 0===i[n]&&(i[n]=[]),i[n].push(e[a])}for(var o=[10,20,30,50,80],s=0;s<o.length;s++)void 0!==i[o[s]]&&0!=i[o[s]].length||(i[o[s]]=[],i[o[s]].push({type_id:o[s]}));var d={};d=t[this.pseal_link.total_gross_entry_account_id]?t[this.pseal_link.total_gross_entry_account_id]:{total_row:!0,type_id:40,name:$.i18n._("Total Gross"),pay_stub_entry_account_id:this.pseal_link.total_gross_entry_account_id},i[10].push(d);var _={};_=t[this.pseal_link.total_deductions_entry_account_id]?t[this.pseal_link.total_deductions_entry_account_id]:{total_row:!0,type_id:40,name:$.i18n._("Total Deductions"),pay_stub_entry_account_id:this.pseal_link.total_deductions_entry_account_id},i[20].push(_);var l={};l=t[this.pseal_link.net_pay_entry_account_id]?t[this.pseal_link.net_pay_entry_account_id]:{type_id:40,name:$.i18n._("Net Pay"),pay_stub_entry_account_id:this.pseal_link.net_pay_entry_account_id},i[40]=l;var c={};return c=t[this.pseal_link.contributions_entry_account_id]?t[this.pseal_link.contributions_entry_account_id]:{total_row:!0,type_id:40,name:$.i18n._("Employer Total Contributions"),pay_stub_entry_account_id:this.pseal_link.contributions_entry_account_id},i[30].push(c),i}insideEntryEditorSetValue(e){var t,i,a=this;this.removeAllRows(!0),this.removeCover(),(1==this.parent_controller.isEditMode()||this.parent_controller.checkForNonHeaderData(e[10]))&&function(e){var t=a.getRender(),i=Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorFiveColumnHeader.html"),n={col1:$.i18n._("Earnings"),col2:$.i18n._("Note"),col3:$.i18n._("Rate"),col4:$.i18n._("Hrs/Units"),col5:$.i18n._("Amount"),col6:$.i18n._("YTD Amount")},r=_.template(i);$(t).append(r(n)),a.rows_widgets_array.push(!0);for(var o=0;o<_.size(e);o++)if(Global.isSet(e[o])){var s=e[o];s.type_id=10,a.addRow(s)}$(t).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0)}(e[10]),(1==this.parent_controller.isEditMode()||this.parent_controller.checkForNonHeaderData(e[20]))&&function(e){var t=a.getRender(),i=Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorThreeColumnHeader.html"),n={col1:$.i18n._("Deductions"),col2:$.i18n._("Note"),col3:$.i18n._("Amount"),col4:$.i18n._("YTD Amount")},r=_.template(i);$(t).append(r(n)),a.rows_widgets_array.push(!0);for(var o=0;o<_.size(e);o++)if(Global.isSet(e[o])){var s=e[o];s.type_id=20,a.addRow(s)}$(t).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0)}(e[20]),t=e[40],i=a.getRender(),t&&a.addRow(t),$(i).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0),(1==this.parent_controller.isEditMode()||this.parent_controller.checkForNonHeaderData(e[80]))&&function(e){var t=a.getRender(),i=Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorThreeColumnHeader.html"),n={col1:$.i18n._("Miscellaneous"),col2:$.i18n._("Note"),col3:$.i18n._("Amount"),col4:$.i18n._("YTD Amount")},r=_.template(i);for(var o in $(t).append(r(n)),a.rows_widgets_array.push(!0),e)a.addRow(e[o]);$(t).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0)}(e[80]),(1==this.parent_controller.isEditMode()||this.parent_controller.checkForNonHeaderData(e[30]))&&function(e){var t=a.getRender(),i=Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorThreeColumnHeader.html"),n={col1:$.i18n._("Employer Contributions"),col2:$.i18n._("Note"),col3:$.i18n._("Amount"),col4:$.i18n._("YTD Amount")},r=_.template(i);$(t).append(r(n)),a.rows_widgets_array.push(!0);for(var o=0;o<_.size(e);o++)if(Global.isSet(e[o])){var s=e[o];s.type_id=30,a.addRow(s)}$(t).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0)}(e[30]),(1==this.parent_controller.isEditMode()||this.parent_controller.checkForNonHeaderData(e[50]))&&function(e){var t=a.getRender(),i=Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorThreeColumnHeader.html"),n={col1:$.i18n._("Accrual"),col2:$.i18n._("Note"),col3:$.i18n._("Amount"),col4:$.i18n._("Balance")},r=_.template(i);$(t).append(r(n)),a.rows_widgets_array.push(!0);for(var o=0;o<_.size(e);o++)if(Global.isSet(e[o])){var s=e[o];s.type_id=50,a.addRow(s)}$(t).append('<tr><td colspan="8"><br></td></tr>'),a.rows_widgets_array.push(!0)}(e[50]);var n=this.parent_controller;TTPromise.wait(null,null,(function(){n.initInsideTransactionEditorData(),n.copied_record_id&&TTUUID.isUUID(n.copied_record_id)&&(n.copied_record_id="")})),this.calcTotal()}checkForNonHeaderData(e){for(var t in e)if(1==TTUUID.isUUID(e[t].id))return!0;return!1}insideEntryEditorAddRow(e,t){var i=this;if(e){function a(e,t,a){var n,r,o=i.getRender(),s={},d=$("<div class='widget-h-box'></div>"),l={filter_data:{}},c="",u="",p=i.parent_controller.current_edit_record.status_id,m=!1;(i.parent_controller.current_edit_record.id||i.parent_controller.copied_record_id)&&e.id||(m=!0),40!=p&&100!=p||(m=!1),TTUUID.isUUID(e.pay_stub_amendment_id)&&e.pay_stub_amendment_id!=TTUUID.zero_id&&(c=e.pay_stub_amendment_id),TTUUID.isUUID(e.user_expense_id)&&e.user_expense_id!=TTUUID.zero_id&&(u=e.user_expense_id),i.parent_controller.copied_record_id&&(c="",u="");var y=!0;TTUUID.isUUID(c)&&c!=TTUUID.zero_id?(r=$("<span class='widget-right-label'> ("+$.i18n._("Amendment")+")</span>"),y=!1):TTUUID.isUUID(u)&&u!=TTUUID.zero_id&&(r=$("<span class='widget-right-label'> ("+$.i18n._("Expense")+")</span>"),y=!1),n=10==t?$(Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorFiveColumnRow.html")):$(Global.loadWidget("views/payroll/pay_stub/PayStubEntryViewInsideEditorThreeColumnRow.html"));var h=Global.loadWidgetByName(FormItemType.AWESOME_BOX);h.AComboBox({api_class:TTAPI.APIPayStubEntryAccount,width:132,is_static_width:132,allow_multiple_selection:!1,layout_name:"global_PayStubAccount",show_search_inputs:!0,set_empty:!0,field:"pay_stub_entry_name_id"}),h.setValue(e.pay_stub_entry_name_id),h.setEnabled(y),h.unbind("formItemChange").bind("formItemChange",(function(e,t){i.onFormItemChange(t)}));var b=Global.loadWidgetByName(FormItemType.TEXT);b.TText({field:"name"}),b.setValue(e.name?40!=e.type_id?"  "+e.name:e.name:"");var g=Global.loadWidgetByName(FormItemType.TEXT_INPUT);g.TTextInput({field:"description",width:300,display_na:!1}),g.setValue(e.description),g.attr("editable",!0);var v=Global.loadWidgetByName(FormItemType.TEXT);v.TText({field:"description",display_na:!1}),v.setValue(e.description?e.description:" ");var I=Global.loadWidgetByName(FormItemType.TEXT_INPUT);I.TTextInput({field:"rate",width:60,hasKeyEvent:!0}),I.setValue(Global.removeTrailingZeros(e.rate)),I.attr("editable",!0),I.unbind("formItemKeyUp").bind("formItemKeyUp",(function(e,t){i.onFormItemKeyUp(t)})),I.unbind("formItemKeyDown").bind("formItemKeyDown",(function(e,t){i.onFormItemKeyDown(t)})),I.unbind("formItemChange").bind("formItemChange",(function(e,t){i.onFormItemChange(t)}));var w=Global.loadWidgetByName(FormItemType.TEXT);w.TText({field:"rate"}),w.setValue(Global.removeTrailingZeros(e.rate));var T=Global.loadWidgetByName(FormItemType.TEXT_INPUT);T.TTextInput({field:"units",width:60,hasKeyEvent:!0}),T.setValue(Global.removeTrailingZeros(e.units)),T.attr("editable",!0),T.unbind("formItemKeyUp").bind("formItemKeyUp",(function(e,t){i.onFormItemKeyUp(t)})),T.unbind("formItemKeyDown").bind("formItemKeyDown",(function(e,t){i.onFormItemKeyDown(t)})),T.unbind("formItemChange").bind("formItemChange",(function(e,t){i.onFormItemChange(t)}));var f=Global.loadWidgetByName(FormItemType.TEXT);f.TText({field:"units"}),f.setValue(Global.removeTrailingZeros(e.units));var E=Global.loadWidgetByName(FormItemType.TEXT_INPUT);E.TTextInput({field:"amount",width:60}),E.setValue(Global.removeTrailingZeros(e.amount)),E.unbind("formItemKeyUp").bind("formItemKeyUp",(function(e,t){i.onFormItemKeyUp(t)})),E.unbind("formItemKeyDown").bind("formItemKeyDown",(function(e,t){i.onFormItemKeyDown(t)})),E.unbind("formItemChange").bind("formItemChange",(function(e,t){i.onFormItemChange(t)}));var C=Global.loadWidgetByName(FormItemType.TEXT);C.TText({field:"amount"}),C.setValue(Global.removeTrailingZeros(e.amount));var D=Global.loadWidgetByName(FormItemType.TEXT);D.TText({field:"ytd_amount"}),D.setValue(Global.removeTrailingZeros(e.ytd_amount)),D.attr({"pay_stub_entry_id":e.id&&i.parent_controller.current_edit_record.id?e.id:"","type_id":e.type_id,"original_amount":e.amount?e.amount:"0.00","original_ytd_amount":e.ytd_amount?e.ytd_amount:"0.00","pay_stub_entry_name_id":e.pay_stub_entry_name_id?e.pay_stub_entry_name_id:null}),D.attr("pay_stub_amendment_id",c),D.attr("user_expense_id",u),0!=parseFloat(e.ytd_amount)||40!=p&&100!=p&&!0!==e.total_row||D.text("-"),e.rate&&0!=parseFloat(e.rate)&&!i.parent_controller.copied_record_id?E.setReadOnly(!0):40!=p&&100!=p&&!0!==e.total_row||w.text("-"),e.units&&0!=parseFloat(e.units)&&!i.parent_controller.copied_record_id?E.setReadOnly(!0):40!=p&&100!=p&&!0!==e.total_row||f.text("-"),40==t||!0===e.total_row?(40!=e.type_id&&!0!==e.total_row||b.css("font-weight","bold"),s[b.getField()]=b,d.append(b),d.append(r),n.children().eq(0).append(d)):1==i.parent_controller.isEditMode()||a?40==e.type_id||!0===e.total_row?(b.css("font-weight","bold"),s[b.getField()]=b,d.append(b),d.append(r),n.children().eq(0).append(d)):(l.filter_data.type_id=[t],h.setDefaultArgs(l),s[h.getField()]=h,d.append(h),d.append(r),n.children().eq(0).append(d)):(40!=e.type_id&&!0!==e.total_row||b.css("font-weight","bold"),s[b.getField()]=b,d.append(b),d.append(r),n.children().eq(0).append(d)),e.type_id!=t.toString()&&e.type_id!==t||40==t||e.total_row?Global.isSet(a)||m||1===_.size(e)&&1==i.parent_controller.isEditMode()?40==e.type_id||!0===e.total_row||(s[g.getField()]=g,n.children().eq(1).append(g)):20!=t&&30!=t&&50!=t&&80!=t||(s[v.getField()]=v,n.children().eq(1).append(v)):1==i.parent_controller.isEditMode()?((TTUUID.isUUID(c)&&c!=TTUUID.zero_id||TTUUID.isUUID(u)&&u!=TTUUID.zero_id)&&g.setReadOnly(!0),s[g.getField()]=g,n.children().eq(1).append(g)):(s[v.getField()]=v,n.children().eq(1).append(v)),e.type_id!==t.toString()&&e.type_id!==t||40==t||e.total_row?(Global.isSet(a)||m||1===_.size(e)&&1==i.parent_controller.isEditMode())&&40!=t&&!e.total_row?40==e.type_id?(C.css("font-weight","bold"),s[C.getField()]=C,10==t?n.children().eq(4).append(C):n.children().eq(2).append(C)):(s[E.getField()]=E,10==t?n.children().eq(4).append(E):n.children().eq(2).append(E)):(40!=e.type_id&&e.total_row,C.css("font-weight","bold"),s[C.getField()]=C,10==t?n.children().eq(4).append(C):n.children().eq(2).append(C)):1==i.parent_controller.isEditMode()?((TTUUID.isUUID(c)&&c!=TTUUID.zero_id||TTUUID.isUUID(u)&&u!=TTUUID.zero_id)&&E.setReadOnly(!0),s[E.getField()]=E,10==t?n.children().eq(4).append(E):n.children().eq(2).append(E)):(s[C.getField()]=C,10==t?n.children().eq(4).append(C):n.children().eq(2).append(C)),(40==e.type_id||e.total_row)&&D.css("font-weight","bold"),(Global.isSet(a)||m||1===_.size(e))&&40!=t&&D.text("-"),s[D.getField()]=D,10==t?n.children().eq(5).append(D):n.children().eq(3).append(D),10==t&&(10!=e.type_id||e.total_row?(Global.isSet(a)||m)&&(40==e.type_id||e.total_row||(s[I.getField()]=I,n.children().eq(2).append(I))):1==i.parent_controller.isEditMode()?((TTUUID.isUUID(c)&&c!=TTUUID.zero_id||TTUUID.isUUID(u)&&u!=TTUUID.zero_id)&&I.setReadOnly(!0),s[I.getField()]=I,n.children().eq(2).append(I)):(s[w.getField()]=w,n.children().eq(2).append(w)),10!=e.type_id||e.total_row?Global.isSet(a)||m?40==e.type_id||e.total_row?(f.css("font-weight","bold"),s[f.getField()]=f,n.children().eq(3).append(f)):(s[T.getField()]=T,n.children().eq(3).append(T)):(f.css("font-weight","bold"),s[f.getField()]=f,n.children().eq(3).append(f)):1==i.parent_controller.isEditMode()?((TTUUID.isUUID(c)&&c!=TTUUID.zero_id||TTUUID.isUUID(u)&&u!=TTUUID.zero_id)&&T.setReadOnly(!0),s[T.getField()]=T,n.children().eq(3).append(T)):(s[f.getField()]=f,n.children().eq(3).append(f))),(TTUUID.isUUID(c)&&c!=TTUUID.zero_id||TTUUID.isUUID(u)&&u!=TTUUID.zero_id)&&n.children().last().find(".minus-icon ").hide(),1==e.total_row&&(s.total_row=!0),void 0!==e.type_id&&(s.type_id=e.type_id),e.pay_stub_entry_account_id==i.parent_controller.pseal_link.net_pay_entry_account_id&&(s.pay_stub_entry_account_id=i.parent_controller.pseal_link.net_pay_entry_account_id),void 0!==a?(n.insertAfter($(o).find("tr").eq(a)),i.rows_widgets_array.splice(a+1,0,s)):($(o).append(n),i.rows_widgets_array.push(s)),1==i.parent_controller.isEditMode()?i.addIconsEvent(n):n.children().last().empty(),(e.total_row||40==e.type_id)&&(n.find(".plus-icon").remove(),n.find(".minus-icon").remove())}void 0===t||void 0===this.rows_widgets_array[t].ytd_amount||e.type_id||(e.type_id=this.rows_widgets_array[t].ytd_amount.attr("type_id")),10==e.type_id?a(e,10,t):20==e.type_id?a(e,20,t):30==e.type_id?a(e,30,t):40==e.type_id?a(e,40,t):50==e.type_id?a(e,50,t):80==e.type_id&&a(e,80,t)}else i.addRow({},t)}insideEntryEditorRemoveRow(e){var t=e[0].rowIndex;if(this.rows_widgets_array[t].ytd_amount){var i=this.rows_widgets_array[t].ytd_amount.attr("pay_stub_entry_id"),a=this.rows_widgets_array[t].ytd_amount.attr("type_id");TTUUID.isUUID(i)&&this.delete_ids.push(i),e.remove(),!0!==this.rows_widgets_array[t-1]||!0!==this.rows_widgets_array[t+1].total_row&&!0!==this.rows_widgets_array[t+1]?this.rows_widgets_array.splice(t,1):(this.addRow({id:"",type_id:a},t-1),this.rows_widgets_array.splice(t+1,1))}this.calcTotal()}savePayStub(e,t){if(this.include_pay_stub_accounts){var i=this.saveInsideEntryEditorData(),a=this.saveInsideTransactionEditorData();i.length>0&&(e.entries=i),a.length>0&&(e.transactions=a)}t()}onSaveClick(e){this.is_mass_editing&&(this.include_pay_stub_accounts=!1),super.onSaveClick(e)}doSaveAPICall(e,t,i){this.savePayStub(e,(()=>{super.doSaveAPICall(e,!0,i)}))}onSaveDone(e){return this.current_edit_record=null,!0}saveInsideTransactionEditorData(e){var t=this.editor.insideTransactionEditorGetValue(this.current_edit_record.id?this.current_edit_record.id:"");if(this.editor.delete_transaction_ids.length>0)for(var i=0;i<this.editor.delete_transaction_ids.length;i++)for(var a=0;a<t.length;a++)this.editor.delete_transaction_ids[i]==t[a].id&&(t[a].deleted=1);return t}onCopyAsNewClick(){var e=this;if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view)){this.copied_record_id=this.current_edit_record.id,this.current_edit_record.id="",this.edit_view_ui_dic.user_id.setEnabled(!0),25!=this.current_edit_record.status_id&&(this.current_edit_record.status_id=25,this.edit_view_ui_dic.status_id.setValue(25)),this.editor.show_cover=!1,this.edit_view.find(".navigation-div").css("display","none"),this.setEditMenu(),this.setTabStatus(),this.is_changed=!1,this.editor.removeAllRows(!0),this.initInsideEntryEditorData(),ProgressBar.closeOverlay()}else{var t,i={},a=this.getGridSelectIdArray();a.length>0?(t=a[0],i.filter_data={},i.filter_data.id=[t],this.api["get"+this.api.key_name](i,{onResult:function(t){e.onCopyAsNewResult(t)}})):TAlertManager.showAlert($.i18n._("No selected record"))}}initEditView(){this.original_status_id=this.current_edit_record.status_id,super.initEditView()}onSubViewRemoved(){this.search(),this.edit_view?this.setEditMenu():this.setDefaultMenu()}onCopyAsNewResult(e){var t=this,i=e.getResult();if(!i)return TAlertManager.showAlert($.i18n._("Record does not exist")),void t.onCancelClick();t.openEditView(),i=i[0],this.copied_record_id=i.id,i.id="",t.sub_view_mode&&t.parent_key&&(i[t.parent_key]=t.parent_value),25!=i.status_id&&(i.status_id=25),t.current_edit_record=i,t.editor.show_cover=!1,t.initEditView()}onSaveAndContinue(e){var t=this;Global.isSet(e)||(e=!1),this.is_changed=!1,this.is_add=!1,LocalCacheData.current_doing_context_action="save_and_continue";var i=this.current_edit_record;this.original_status_id=i.status_id,i=this.uniformVariable(i),this.savePayStub(i,(function(){t.api["set"+t.api.key_name](i,!1,e,{onResult:function(e){t.onSaveAndContinueResult(e)}})}))}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var t={},i=this.getGridSelectIdArray();i.length;this.mass_edit_record_ids=[],$.each(i,(function(t,i){e.mass_edit_record_ids.push(i)})),t.filter_data={},t.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](t,{onResult:function(t){var i=t.getResult();i||(i=[]),e.api.getOptions("unique_columns",{onResult:function(t){e.unique_columns=t.getResult(),e.api.getOptions("linked_columns",{onResult:function(t){e.linked_columns=t.getResult(),e.sub_view_mode&&e.parent_key&&(i[e.parent_key]=e.parent_value),e.current_edit_record=i,e.initEditView()}})}})}})}onSaveAndContinueResult(e){var t=this;if(e.isValid()){var i=e.getResult();!0===i?t.refresh_id=t.current_edit_record.id:TTUUID.isUUID(i)&&i!=TTUUID.zero_id&&i!=TTUUID.not_exist_id&&(t.refresh_id=i),t.search(!1),t.editor.show_cover=!1,t.onEditClick(t.refresh_id,!0),t.onSaveAndContinueDone(e)}else t.setErrorTips(e),t.setErrorMenu()}saveInsideEntryEditorData(e){var t=this.editor.getValue(this.current_edit_record.id?this.current_edit_record.id:"");if(this.editor.delete_ids.length>0)for(var i=0;i<this.editor.delete_ids.length;i++)for(var a=0;a<t.length;a++)this.editor.delete_ids[i]==t[a].id&&(t[a].deleted=1);return e&&"function"==typeof e&&e(),t}insideEntryEditorGetValue(e){var t=this.rows_widgets_array.length,i=[];if(this.cover&&this.cover.length>0)return i;for(var a=0;a<t;a++){var n=this.rows_widgets_array[a],r={};!0===n||_.isArray(n)||(r.id=n.ytd_amount.attr("pay_stub_entry_id"),n.ytd_amount.attr("type_id")&&(r.type=n.ytd_amount.attr("type_id")),r.rate=n.rate?n.rate.getValue():"",r.units=n.units?n.units.getValue():"",r.amount=n.amount?n.amount.getValue():"",Global.isSet(n.ytd_amount)&&(r.ytd_amount=n.ytd_amount.getValue()),r.description=n.description?n.description.getValue():"",Global.isSet(n.pay_stub_entry_name_id)?r.pay_stub_entry_name_id=n.pay_stub_entry_name_id.getValue():r.pay_stub_entry_name_id=n.ytd_amount.attr("pay_stub_entry_name_id"),r.pay_stub_amendment_id=n.ytd_amount.attr("pay_stub_amendment_id"),r.user_expense_id=n.ytd_amount.attr("user_expense_id"),r.pay_stub_id=e,1!=n.total_row&&TTUUID.isUUID(r.pay_stub_entry_name_id)&&(r.pay_stub_entry_name_id!=TTUUID.zero_id||null!=r.description&&r.description.length>0||null!=r.rate&&r.rate.length>0&&0!=parseFloat(r.rate)||null!=r.units&&r.units.length>0&&0!=parseFloat(r.units)||null!=r.amount&&r.amount.length>0&&0!=parseFloat(r.amount))&&i.push(r))}return i}getFilterColumnsFromDisplayColumns(){var e={is_owner:!0,id:!0,user_id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,start_date:!0,end_date:!0,pay_period_id:!0},t=[];if(this.grid&&(t=this.grid.getGridParam("colModel")),t)for(var i=t.length,a=0;a<i;a++){e[t[a].name]=!0}return e}onFormItemChange(e,t){var i=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),n=e.getValue();switch(this.current_edit_record[a]=n,a){case"user_id":if(this.is_add){var r=i.editor.rows_widgets_array[i.editor.rows_widgets_array.length-2],o=i.edit_view_ui_dic.user_id.getValue();for(var s in r)Global.isArray(r)&&r[s].remittance_destination_account_id&&(r[s].remittance_destination_account_id.setDefaultArgs({filter_data:{user_id:o}}),r[s].remittance_destination_account_id.setValue(TTUUID.zero_id))}break;case"country":this.edit_view_ui_dic.province.setValue(null);break;case"pay_period_id":var d={filter_data:{}};d.filter_data.id=n,this.pay_period_api["get"+this.pay_period_api.key_name](d,{onResult:function(e){if(e.isValid()&&e.getResult()[0]){var a=e.getResult()[0],n=Global.strToDate(a.start_date).format(),r=Global.strToDate(a.end_date).format(),o=Global.strToDate(a.transaction_date).format();i.current_edit_record.start_date=n,i.current_edit_record.end_date=r,i.current_edit_record.transaction_date=o,i.edit_view_ui_dic.start_date.setValue(n),i.edit_view_ui_dic.end_date.setValue(r),i.edit_view_ui_dic.transaction_date.setValue(o),t||i.validate()}}});break;default:t||i.validate()}"country"!==a&&"pay_period_id"!==a&&(t||this.validate())}onSetSearchFilterFinished(){if(1===this.search_panel.getSelectTabIndex()){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e)}}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}setProvince(e,t){var i=this;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.province_array=Global.buildRecordArray(e),i.adv_search_field_ui_dic.province.setSourceData(i.province_array)}}):(i.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e,t){var i=this,a=i.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.company_api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),i.e_province_array=Global.buildRecordArray(e),t&&i.e_province_array.length>0&&(i.current_edit_record.province=i.e_province_array[0].value,a.setValue(i.current_edit_record.province)),a.setSourceData(i.e_province_array)}}):(i.e_province_array=[],a.setSourceData([]))}validate(){var e=this,t={};if(this.is_mass_editing){for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var a=this.edit_view_ui_dic[i];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(t[i]=a.getValue())}}else t=this.current_edit_record;if(t=this.uniformVariable(t),this.include_pay_stub_accounts){var n=e.saveInsideEntryEditorData(),r=e.saveInsideTransactionEditorData();"object"==typeof n&&(t.entries=n),"object"==typeof r&&(t.transactions=r)}this.api["validate"+this.api.key_name](t,{onResult:function(t){e.validateResult(t)}})}buildEditViewUI(){super.buildEditViewUI();var e=this,t={"tab_pay_stub":{"label":$.i18n._("Pay Stub")},"tab_audit":!0};this.setTabModel(t),this.navigation.AComboBox({api_class:TTAPI.APIPayStub,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_pay_stub",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation();var i,n=this.edit_view_tab.find("#tab_pay_stub"),r=n.find(".first-column"),o=n.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(r),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!1,field:"user_id"}),this.addEditFieldToColumn($.i18n._("Employee"),i,r),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id",set_empty:!1}),i.setSourceData(e.filtered_status_array),this.addEditFieldToColumn($.i18n._("Status"),i,r),(i=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id",set_empty:!1}),i.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),i,r),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,set_empty:!0,field:"currency_id"}),this.addEditFieldToColumn($.i18n._("Currency"),i,r),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPayPeriod,allow_multiple_selection:!1,layout_name:"global_Pay_period",show_search_inputs:!0,set_empty:!0,field:"pay_period_id"}),this.addEditFieldToColumn($.i18n._("Pay Period"),i,o),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"run_id",width:20}),this.addEditFieldToColumn($.i18n._("Payroll Run"),i,o),(i=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"start_date"}),this.addEditFieldToColumn($.i18n._("Pay Start Date"),i,o),(i=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"end_date"}),this.addEditFieldToColumn($.i18n._("Pay End Date"),i,o),(i=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"transaction_date"}),this.addEditFieldToColumn($.i18n._("Payment Date"),i,o,"");var s=n.find(".inside-pay-stub-entry-editor-div");this.editor=Global.loadWidgetByName(FormItemType.INSIDE_EDITOR),this.editor.InsideEditor({addRow:this.insideEntryEditorAddRow,removeRow:this.insideEntryEditorRemoveRow,getValue:this.insideEntryEditorGetValue,setValue:this.insideEntryEditorSetValue,parent_controller:this,api:this.pay_stub_entry_api,render:"views/payroll/pay_stub/PayStubEntryViewInsideEditorRender.html",render_args:{},row_render:"views/payroll/pay_stub/PayStubEntryViewInsideEditorRow.html"}),this.editor.show_cover=!0,this.editor.delete_transaction_ids=[],this.editor.removeCover=this.removeEntryInsideEditorCover,this.editor.onEditClick=this.removeEntryInsideEditorCover,this.editor.onFormItemKeyUp=function(e){var t=e.parent().parent().index(),i=this,n=i.rows_widgets_array[t].rate,r=i.rows_widgets_array[t].units,o=i.rows_widgets_array[t].amount;if(0===e.getValue().length&&o.setReadOnly(!1),(n.getValue().length>0||r.getValue().length>0)&&o.setReadOnly(!0),n.getValue().length>0&&r.getValue().length>0){var s=Global.MoneyRound((0,a.Decimal)(parseFloat(n.getValue())).mul(parseFloat(r.getValue())).toFixed(4));"NaN"!=s&&0!=s&&""!=s||(s="0.00"),o.setValue(s),this.onFormItemChange(o,!0)}else o.setValue("0.00"),this.onFormItemChange(o,!0)},this.editor.onFormItemKeyDown=function(e){var t=e.parent().parent().index(),i=this,a=i.rows_widgets_array[t].amount,n=i.rows_widgets_array[t].rate,r=i.rows_widgets_array[t].units;n.getValue().length>0&&r.getValue().length>0||(a.setValue("0.00"),this.onFormItemChange(a,!0)),a.setReadOnly(!0)},this.editor.onFormItemChange=function(e,t){var i=e.getField(),n=parseFloat(e.getValue()?e.getValue():0),r=e.parent().parent().index();if("amount"===i){var o=parseFloat(this.rows_widgets_array[r].ytd_amount.attr("original_ytd_amount"));isNaN(o)&&(o=0);var s=parseFloat(this.rows_widgets_array[r].ytd_amount.attr("original_amount"));isNaN(s)&&(s=0);var d=Global.removeTrailingZeros((0,a.Decimal)(o).sub(s).add(n).toFixed(4));isNaN(d)&&(d=0),this.rows_widgets_array[r].ytd_amount.setValue(0!=d?d:"-"),this.rows_widgets_array[r].ytd_amount.attr("original_ytd_amount",d),this.rows_widgets_array[r].ytd_amount.attr("original_amount",n)}t||this.parent_controller.validate(),this.calcTotal()},this.editor.calcTotal=function(){for(var e=0,t=0,i=0,n=0,r=0,o=!0,s=0;s<this.rows_widgets_array.length;s++){var d=this.rows_widgets_array[s];if(!0===d||_.isArray(d))e=0,t=0,i=0;else if(!0!==d.total_row)if(d.pay_stub_entry_account_id&&d.pay_stub_entry_account_id==this.parent_controller.pseal_link.net_pay_entry_account_id)d.amount.setValue(Global.MoneyRound(n)),d.ytd_amount.setValue(Global.MoneyRound(r));else{var l=0;Global.isSet(d.units)&&Global.isNumeric(d.units.getValue())&&(l=Global.MoneyRound(parseFloat(d.units.getValue())),o=!1);var c=0;Global.isSet(d.amount)&&Global.isNumeric(d.amount.getValue())&&(c=parseFloat(d.amount.getValue()),o=!1);var u=0;Global.isSet(d.ytd_amount)&&Global.isNumeric(d.ytd_amount.getValue())&&(u=parseFloat(d.ytd_amount.getValue())),e=0==o?(0,a.Decimal)(parseFloat(e)).add(parseFloat(l)).toFixed(4):"",Global.isNumeric(c)&&(t=(0,a.Decimal)(t).add(c).toFixed(4)),Global.isNumeric(u)&&(i=(0,a.Decimal)(i).add(u).toFixed(4))}else Global.isNumeric(t)||(t=0),Global.isSet(d.units)&&(0==o?d.units.setValue(Global.MoneyRound(e)):o&&d.units.setValue("-")),d.amount.setValue(Global.MoneyRound(parseFloat(t))),d.ytd_amount.setValue(Global.MoneyRound(parseFloat(i))),10==d.type_id?(n=t,r=i):20==d.type_id&&(n=(0,a.Decimal)(n).sub(t).toFixed(4),r=(0,a.Decimal)(r).sub(i).toFixed(4)),this.parent_controller.net_pay_amount=n}this.calcTransactionTotals()},this.editor.insideTransactionEditorSetValue=function(t){if(e=this,!this.parent_controller.current_edit_record)return!1;var i=this.parent_controller.current_edit_record.status_id,a=!1;this.parent_controller.current_edit_record.id||this.parent_controller.copied_record_id||(a=!0),!a&&25==i&&this.show_cover&&(this.cover=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.cover.NoResultBox({related_view_controller:this,message:$.i18n._("Click the Edit icon below to override pay stub amounts"),is_edit:!0}));var n=this.getRender(),r=Global.loadWidget("views/payroll/pay_stub/PayStubTransactionViewInsideEditorColumnHeader.html"),o={col1:$.i18n._("Payment Method"),col2:$.i18n._("Note"),col3:$.i18n._("Status"),col4:$.i18n._("Payment Date"),col5:$.i18n._("Amount")};$(n).append('<tr class="tblSepHeader"><td colspan="8">'+$.i18n._("Transactions")+"</td></tr>");var s=_.template(r);if($(n).append(s(o)),this.rows_widgets_array.push(!0),_.size(t)>0){for(var d=0;d<_.size(t);d++)if(Global.isSet(t[d])){var l=t[d];this.insideTransactionEditorAddRow(l)}this.rows_widgets_array.push(!0),this.cover&&this.cover.length>0&&(this.cover.css({width:this.width(),height:this.height()+30}),this.parent().append(this.cover))}else this.parent_controller.getPayStubTransactionDefaultData((function(t){e.insideTransactionEditorAddRow(t),e.rows_widgets_array.push(!0),e.cover&&e.cover.length>0&&(e.cover.css({width:e.width(),height:e.height()}),e.parent().append(e.cover))}));this.calcTransactionTotals()},this.editor.insideTransactionEditorGetValue=function(e){var t=this.rows_widgets_array.length,i=[];if(this.cover&&this.cover.length>0)return i;for(var a=0;a<t;a++){var n={};if(_.isArray(this.rows_widgets_array[a])){var r=this.rows_widgets_array[a][0];if(!Global.isSet(r.remittance_destination_account_id)||!r.remittance_destination_account_id.getValue())continue;n.id=r.form_item_record.id,n.remittance_destination_account_id=r.remittance_destination_account_id?r.remittance_destination_account_id.getValue():TTUUID.zero_id,Global.isSet(r.status_id)&&(n.status_id=r.status_id.getValue()),n.transaction_date=r.transaction_date?r.transaction_date.getValue():"",Global.isSet(r.currency_id)&&(n.currency_id=r.currency_id.getValue()),n.note=r.note?r.note.getValue():"",n.amount=r.amount?r.amount.getValue():"",Global.isSet(r.deleted)&&1==r.deleted?n.deleted=1:n.deleted=0,n.pay_stub_id=e,1!=r.total_row&&TTUUID.isUUID(n.remittance_destination_account_id)&&(n.remittance_destination_account_id!=TTUUID.zero_id||null!=n.note&&n.note.length>0||null!=n.amount&&n.amount.length>0&&0!=parseFloat(n.amount))&&i.push(n)}}return i},this.editor.insideTransactionEditorRemoveRow=function(t){var i=t[0].rowIndex-1;if(this.rows_widgets_array[i][0]){this.rows_widgets_array[i][0].form_item_record.deleted=1;var a=this.rows_widgets_array[i][0].form_item_record.id}TTUUID.isUUID(a)?this.delete_transaction_ids.push(a):this.rows_widgets_array.splice(i,1),t.hide(),0==$(".paystub_transaction_row:visible").length&&this.insideTransactionEditorAddRow({},i),this.parent_controller.validate(),e.calcTransactionTotals()},this.editor.calcTransactionTotals=function(){for(var e=0,t=0;t<this.rows_widgets_array.length;t++){var i=this.rows_widgets_array[t];if(_.isObject(i)&&Global.isSet(i[0])&&Global.isSet(i[0].remittance_destination_account_id)&&0==Global.isSet(i[0].form_item_record.deleted)&&Global.isSet(i[0].status_id)&&(10==i[0].status_id.getValue()||20==i[0].status_id.getValue())){var n=parseFloat(i[0].amount.getValue());isNaN(n)&&(n=0),e+=n}}e=Global.MoneyRound(e);var r=this.getRender();if($(".transaction_total_rows").remove(),e>0){var o=Global.removeTrailingZeros((0,a.Decimal)(parseFloat(e)).sub(parseFloat(this.parent_controller.net_pay_amount)).toFixed(4));isNaN(o)&&(o=0);var s="green";0!=o&&(s="red"),0!=o?(o=Global.MoneyRound(o),$(r).append('<tr class="tblDataWhite transaction_total_rows"><td colspan="2" style="text-align:left"><b>Transaction Total</b></td><td colspan="3"><br></td><td style="text-align:right;"><span>Difference: <i  style="color:red;">'+o+'</i></b></td><td><b style="color:'+s+'">'+Global.MoneyRound(e)+"</b></td><td></td></td></tr>")):$(r).append('<tr class="tblDataWhite transaction_total_rows"><td colspan="2" style="text-align:left"><b>Transaction Total</b></td><td colspan="4"><br></td><td><b style="color:'+s+'">'+e+"</b></td><td></td></td></tr>"),this.rows_widgets_array.push(!0)}},this.editor.insideTransactionEditorAddRow=function(e,t){var a=this;if(0==_.size(e))this.parent_controller.getPayStubTransactionDefaultData((function(e){a.insideTransactionEditorAddRow(e,t)}),t);else{var n=a.getRender(),r=[],o={form_item_record:{}},s=$(Global.loadWidget("views/payroll/pay_stub/PayStubTransactionViewInsideEditorColumnRow.html"));e=_.isArray(e)?e[0]:e,o.form_item_record.id=e.id&&a.parent_controller.current_edit_record.id?e.id:"";a.parent_controller.current_edit_record.status_id;a.parent_controller.current_edit_record.id||a.parent_controller.copied_record_id||(!0,e.status_id=10);var d=[10];0==a.parent_controller.is_add&&d.push(20);var l=Global.loadWidgetByName(FormItemType.AWESOME_BOX);l.AComboBox({api_class:TTAPI.APIRemittanceDestinationAccount,allow_multiple_selection:!1,layout_name:"global_remittance_destination_account",show_search_inputs:!0,set_empty:!0,field:"remittance_destination_account_id",default_args:{filter_data:{user_id:a.parent_controller.current_edit_record.user_id,status_id:d}}}),l.setValue(e.remittance_destination_account_id?e.remittance_destination_account_id:""),l.unbind("formItemChange").bind("formItemChange",(function(e,t){a.parent_controller.validate()}));var c=Global.loadWidgetByName(FormItemType.TEXT);c.TText({field:"remittance_destination_account"}),c.setValue(e.remittance_destination_account?e.remittance_destination_account:"");var u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"note",width:300,display_na:!1}),u.setValue(e.note),u.attr("editable",!0);var p=Global.loadWidgetByName(FormItemType.TEXT);p.TText({field:"description",display_na:!1}),p.setValue(e.description);var m=Global.loadWidgetByName(FormItemType.COMBO_BOX);m.TComboBox({field:"status_id",set_empty:!1}),m.setSourceData(a.parent_controller.transaction_status_array),m.setValue(e.status_id?e.status_id:""),m.setEnabled("copy_as_new"==LocalCacheData.current_doing_context_action),m.unbind("formItemChange").bind("formItemChange",(function(e,t){a.parent_controller.validate()}));var y=Global.loadWidgetByName(FormItemType.TEXT);y.TText({field:"status"}),y.setValue(e.status?e.status:"");var h=Global.loadWidgetByName(FormItemType.DATE_PICKER);h.TDatePicker({field:"transaction_date"}),h.setValue(e.transaction_date?e.transaction_date:""),h.attr("editable",!0),e.transaction_date||h.setValue(a.parent_controller.edit_view_ui_dic.transaction_date.getValue()),h.unbind("formItemChange").bind("formItemChange",(function(e,t){a.parent_controller.validate()}));var b=Global.loadWidgetByName(FormItemType.TEXT);b.TText({field:"transaction_date"}),b.setValue(e.transaction_date?e.transaction_date:"");var g=Global.loadWidgetByName(FormItemType.TEXT_INPUT);g.TTextInput({field:"amount",width:60}),g.setValue(e.amount?Global.removeTrailingZeros(e.amount):""),g.unbind("formItemChange").bind("formItemChange",(function(e,t){a.parent_controller.validate(),a.calcTransactionTotals()})),g.attr("editable",!0);var v=Global.loadWidgetByName(FormItemType.TEXT);if(v.TText({field:"amount"}),v.setValue(e.amount?Global.removeTrailingZeros(e.amount):""),e.status_id||(e.status_id=10),a.parent_controller.isEditMode()?(l.setEnabled(10==e.status_id),h.setEnabled(10==e.status_id),g.setReadOnly(10!=e.status_id),u.setReadOnly(10!=e.status_id),m.setEnabled(!1)):(l.setEnabled(!1),h.setEnabled(!1),g.setEnabled(!1),u.setEnabled(!1),m.setEnabled(!1),i=p),o[l.getField()]=l,s.children().eq(0).append(l),o[u.getField()]=u,s.children().eq(1).append(u),o[m.getField()]=m,s.children().eq(2).append(m),o[h.getField()]=h,s.children().eq(3).append(h),o[g.getField()]=g,s.children().eq(4).append(g),r.push(o),void 0!==t?(s.insertAfter($(n).find("tr").eq(t)),a.rows_widgets_array.splice(t,0,r)):($(n).append(s),a.rows_widgets_array.push(r)),1==a.parent_controller.isEditMode()){var I=s.find(".minus-icon");10!=e.status_id?I.remove():I.click((function(){a.insideTransactionEditorRemoveRow(s)})),s.find(".plus-icon").click((function(){a.insideTransactionEditorAddRow({},$(this).parents("tr").index())}))}else s.children().last().find(".minus-icon").remove(),s.children().last().find(".plus-icon").remove()}},s.append(this.editor)}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Pay Stub Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Pay Stub Type"),in_column:1,field:"type_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Employee Status"),in_column:1,field:"user_status_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Pay Period"),in_column:1,field:"pay_period_id",layout_name:"global_Pay_period",api_class:TTAPI.APIPayPeriod,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Payroll Run"),in_column:1,field:"run_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Employee"),in_column:1,field:"user_id",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Title"),field:"title_id",in_column:1,layout_name:"global_job_title",api_class:TTAPI.APIUserTitle,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Currency"),field:"currency_id",in_column:1,layout_name:"global_currency",api_class:TTAPI.APICurrency,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Group"),in_column:2,multiple:!0,field:"group_id",layout_name:"global_tree_column",tree_mode:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Branch"),in_column:2,field:"default_branch_id",layout_name:"global_branch",api_class:TTAPI.APIBranch,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Default Department"),field:"default_department_id",in_column:2,layout_name:"global_department",api_class:TTAPI.APIDepartment,multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!1,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,form_item_type:FormItemType.AWESOME_BOX})]}onCustomContextClick(e){switch(e){case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.pay_stub_amendment:case ContextMenuIconName.edit_employee:case ContextMenuIconName.employee_pay_stubs:case ContextMenuIconName.employer_pay_stubs:case ContextMenuIconName.generate_pay_stub:case ContextMenuIconName.edit_pay_period:case ContextMenuIconName.export_excel:case ContextMenuIconName.pay_stub_transaction:default:this.onNavigationClick(e)}}onViewClick(e,t){this.onNavigationClick(ContextMenuIconName.view)}onReportPrintClick(e){var t,i=this,a=[],n=[],r=[];i.edit_view&&i.current_edit_record.id?(a.push(i.current_edit_record.id),n.push(i.current_edit_record.user_id),r.push(i.current_edit_record.pay_period_id),i.current_edit_record.start_date):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var o=i.getRecordFromGridById(t);a.push(o.id),n.push(o.user_id),r.push(o.pay_period_id),o.start_date})));var o={0:{filter_data:{id:a}},1:!0,2:e};this.doFormIFrameCall(o)}onNavigationClick(e){var t,i,a=this,n={},r=[],o=[],s=[];a.edit_view&&a.current_edit_record.id?(r.push(a.current_edit_record.id),o.push(a.current_edit_record.user_id),s.push(a.current_edit_record.pay_period_id),i=a.current_edit_record.start_date):(t=this.getGridSelectIdArray(),$.each(t,(function(e,t){var n=a.getRecordFromGridById(t);r.push(n.id),o.push(n.user_id),s.push(n.pay_period_id),i=n.start_date})));var d,_={filter_data:{id:r}};switch(e){case ContextMenuIconName.edit_employee:o.length>0&&IndexViewController.openEditView(this,"Employee",o[0]);break;case ContextMenuIconName.edit_pay_period:s.length>0&&IndexViewController.openEditView(this,"PayPeriods",s[0]);break;case ContextMenuIconName.timesheet:o.length>0&&(n.user_id=o[0],n.base_date=i,Global.addViewTab(a.viewId,$.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("TimeSheet",n));break;case ContextMenuIconName.schedule:n.filter_data={};var l={value:o};n.filter_data.include_user_ids=l,n.select_date=i,Global.addViewTab(this.viewId,$.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("Schedule",n);break;case ContextMenuIconName.pay_stub_amendment:n.filter_data={},n.filter_data.user_id=o[0],n.filter_data.pay_period_id=s[0],Global.addViewTab(this.viewId,$.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("PayStubAmendment",n);break;case ContextMenuIconName.generate_pay_stub:1===o.length?n.user_id=o[0]:o.length>1&&(n.user_id=o),1===s.length?n.pay_period_id=[s[0]]:s.length>1?n.pay_period_id=s:n.pay_period_id=[],IndexViewController.openWizard("GeneratePayStubWizard",n,(function(){a.search()}));break;case ContextMenuIconName.view:d={0:_,1:!1,2:"pdf",3:!0},this.doFormIFrameCall(d),$().TFeedback({source:"View",delay:5e3});break;case ContextMenuIconName.employee_pay_stubs:d={0:_,1:!1,2:"pdf",3:!0},this.doFormIFrameCall(d);break;case ContextMenuIconName.employer_pay_stubs:d={0:_,1:!1,2:"pdf",3:!1},this.doFormIFrameCall(d);break;case ContextMenuIconName.pay_stub_transaction:(n={}).filter_data={},n.filter_data.user_id={value:o},n.filter_data.pay_period_id={value:s},Global.addViewTab(this.viewId,$.i18n._("Pay Stubs"),window.location.href),IndexViewController.goToView("PayStubTransaction",n);break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name);break;case ContextMenuIconName.direct_deposit:var c={filter_data:{pay_stub_id:this.getGridSelectIdArray()}};IndexViewController.openWizardController("ProcessTransactionsWizardController",c)}}onReportMenuClick(e){this.onReportPrintClick(e)}doFormIFrameCall(e){Global.APIFileDownload(this.api.className,"get"+this.api.key_name,e)}}}}]);
//# sourceMappingURL=payroll-pay_stub-PayStubViewController.bundle.js.map?v=88d9028a0dee98590c98