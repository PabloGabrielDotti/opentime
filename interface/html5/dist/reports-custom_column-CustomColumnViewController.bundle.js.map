{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/formula_builder/FormulaBuilder.js","webpack://timetrex/./interface/html5/views/reports/custom_column/CustomColumnViewController.js"],"names":["$","fn","FormulaBuilder","options","field","error_tip_box","opts","extend","defaults","$this","this","error_string","check_box","enabled","text_input","getEnabled","setEnabled","val","children","attr","addClass","removeAttr","removeClass","setCheckBox","eq","checked","isChecked","setMassEditMode","insertBefore","change","trigger","remove","setValue","setErrorStyle","errStr","show","isWarning","showErrorTip","sec","Global","isSet","loadWidgetByName","WidgetNamesDic","ERROR_TOOLTIP","ErrorTipBox","hasClass","hideErrorTip","clearErrorStyle","setField","getField","getValue","each","o","meta","data","formula_btn","text","i18n","_","unbind","bind","onFormulaBtnClick","width","indexOf","css","height","rows","style","mouseover","length","mouseout","is","focusin","LocalCacheData","current_open_sub_controller","edit_view","is_viewing","current_open_primary_controller","view_mode_message","focusout","TTPromise","wait","parents","jQuery","CustomColumnViewController","BaseViewController","el","sub_report_schedule_view_controller","type_array","format_array","exclude_columns_array","include_columns_array","super","edit_view_tpl","permission_id","viewId","script_name","context_menu_name","navigation_label","table_name_key","api","TTAPI","APIReportCustomColumn","render","sub_view_mode","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","context_menu_model","exclude","ContextMenuIconName","mass_edit","include","push","view","buildEditViewUI","tab_model","setTabModel","edit_only_mode","navigation","AComboBox","api_class","APIUserReportData","id","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_custom_column_column1","edit_view_tab","find","edit_view_tabs","form_item_input","FormItemType","TEXT_INPUT","TTextInput","addEditFieldToColumn","parent","TEXT_AREA","COMBO_BOX","TComboBox","set_empty","setSourceData","AWESOME_BOX","key","FORMULA_BUILDER","report_api","current_open_report_controller","getOptions","onResult","fun_result","fun_res_data","getResult","onColumnsResult","col_result","col_res_data","default_args","functions","buildRecordArray","variables","formula","current_edit_record","clone","IndexViewController","openWizard","edit_view_ui_dic","type_id","detachElement","target","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","c_value","onTypeChange","validate","onAddClick","collectUIDataToCurrentEditRecord","attachElement","setEditViewDataDone","buildSearchFields","search_fields","SearchField","label","in_column","multiple","basic_search","adv_search","form_item_type","APIUser","grid_setup","container_selector","sub_grid_mode","onSelectRow","onGridSelectRow","onCellSelect","onSelectAll","onGridSelectAll","ondblClickRow","e","onGridDblClickRow","onRightClickRow","rowId","getGridSelectIdArray","grid","resetSelection","setSelection","setGridSize","baseViewSubTabGridResize","onResizeGrid","initEditViewUI","parent_view_controller","need_refresh_display_columns","callBack","initDropDownOption","result","result_data","removeDeletedRows","resolve","searchDone","loadSubView","container","beforeViewLoadedFun","afterViewLoadedFun","loadViewSource","template","html","sub_custom_column_controller"],"mappings":"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","file":"reports-custom_column-CustomColumnViewController.bundle.js?v=69f05bfe443996f09956","sourcesContent":["( function( $ ) {\n\n\t$.fn.FormulaBuilder = function( options ) {\n\t\tvar opts = $.extend( {}, $.fn.FormulaBuilder.defaults, options );\n\t\tvar $this = this;\n\t\tvar field;\n\n\t\tvar error_string = '';\n\t\tvar error_tip_box;\n\n\t\tvar mass_edit_mode = false;\n\t\tvar check_box = null;\n\n\t\tvar enabled = true;\n\n\t\tvar text_input = null;\n\n\t\tthis.getEnabled = function() {\n\t\t\treturn enabled;\n\t\t};\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\t\t\tif ( val === false || val === '' ) {\n\t\t\t\ttext_input.children().attr( 'disabled', 'true' );\n\t\t\t\ttext_input.addClass( 't-text-area-readonly' );\n\t\t\t} else {\n\t\t\t\ttext_input.children().removeAttr( 'disabled' );\n\t\t\t\ttext_input.removeClass( 't-text-area-readonly' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setCheckBox = function( val ) {\n\t\t\tif ( check_box ) {\n\t\t\t\tcheck_box.children().eq( 0 )[0].checked = val;\n\t\t\t}\n\t\t};\n\n\t\tthis.isChecked = function() {\n\t\t\tif ( check_box ) {\n\t\t\t\tif ( check_box.children().eq( 0 )[0].checked === true ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.setMassEditMode = function( val ) {\n\t\t\tmass_edit_mode = val;\n\n\t\t\tif ( mass_edit_mode ) {\n\t\t\t\tcheck_box = $( ' <div class=\"mass-edit-checkbox-wrapper\"><input type=\"checkbox\" class=\"mass-edit-checkbox\"></input>' +\n\t\t\t\t\t'<label for=\"checkbox-input-1\" class=\"input-helper input-helper--checkbox\"></label></div>' );\n\t\t\t\tcheck_box.insertBefore( text_input );\n\n\t\t\t\tcheck_box.change( function() {\n\t\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t\t} );\n\n\t\t\t} else {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\tcheck_box.remove();\n\t\t\t\t\tcheck_box = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\n\t\t};\n\n\t\tthis.setErrorStyle = function( errStr, show, isWarning ) {\n\t\t\tif ( isWarning ) {\n\t\t\t\ttext_input.addClass( 'warning-tip' );\n\t\t\t} else {\n\t\t\t\ttext_input.addClass( 'error-tip' );\n\t\t\t}\n\t\t\terror_string = errStr;\n\n\t\t\tif ( show ) {\n\t\t\t\tthis.showErrorTip();\n\t\t\t}\n\t\t};\n\n\t\tthis.showErrorTip = function( sec ) {\n\n\t\t\tif ( !Global.isSet( sec ) ) {\n\t\t\t\tsec = 2;\n\t\t\t}\n\n\t\t\tif ( !error_tip_box ) {\n\t\t\t\terror_tip_box = Global.loadWidgetByName( WidgetNamesDic.ERROR_TOOLTIP );\n\t\t\t\terror_tip_box = error_tip_box.ErrorTipBox();\n\t\t\t}\n\t\t\tif ( text_input.hasClass( 'warning-tip' ) ) {\n\t\t\t\terror_tip_box.show( this, error_string, sec, true );\n\t\t\t} else {\n\t\t\t\terror_tip_box.show( this, error_string, sec );\n\t\t\t}\n\t\t};\n\n\t\tthis.hideErrorTip = function() {\n\n\t\t\tif ( Global.isSet( error_tip_box ) ) {\n\t\t\t\terror_tip_box.remove();\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\t\t\ttext_input.removeClass( 'error-tip' );\n\t\t\ttext_input.removeClass( 'warning-tip' );\n\t\t\tthis.hideErrorTip();\n\t\t\terror_string = '';\n\t\t};\n\n\t\tthis.setField = function( val ) {\n\t\t\tfield = val;\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\treturn text_input.val();\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t\ttext_input.val( val );\n\t\t};\n\n\t\tthis.each( function() {\n\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\t\t\ttext_input = $( this ).children().eq( 0 );\n\n\t\t\tvar formula_btn = $( this ).children().eq( 1 );\n\n\t\t\tformula_btn.text( $.i18n._( 'Formula Builder' ) );\n\n\t\t\tformula_btn.unbind( 'click' ).bind( 'click', function() {\n\n\t\t\t\tif ( o.onFormulaBtnClick ) {\n\t\t\t\t\to.onFormulaBtnClick();\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tif ( o.width && ( o.width > 0 || o.width.indexOf( '%' ) > 0 ) ) {\n\t\t\t\tif ( o.width.indexOf( '%' ) > 0 ) {\n\t\t\t\t\t$this.width( o.width );\n\t\t\t\t\ttext_input.css( 'width', 'calc( 100% - 115px )' );\n\t\t\t\t} else {\n\t\t\t\t\ttext_input.width( o.width );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext_input.width( 300 );\n\t\t\t}\n\t\t\tif ( o.height > 0 ) {\n\t\t\t\ttext_input.height( o.height );\n\t\t\t}\n\n\t\t\tif ( o.rows > 0 ) {\n\t\t\t\ttext_input.attr( 'rows', o.rows );\n\t\t\t} else {\n\t\t\t\ttext_input.attr( 'rows', 5 );\n\t\t\t}\n\n\t\t\tif ( o.style ) {\n\t\t\t\t$this.css( o.style );\n\t\t\t}\n\n\t\t\ttext_input.change( function() {\n\t\t\t\tif ( check_box ) {\n\t\t\t\t\t$this.setCheckBox( true );\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'formItemChange', [$this] );\n\t\t\t} );\n\n\t\t\ttext_input.mouseover( function() {\n\n\t\t\t\tif ( enabled ) {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\ttext_input.mouseout( function() {\n\t\t\t\tif ( !$( $this ).is( ':focus' ) ) {\n\t\t\t\t\t$this.hideErrorTip();\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusin( function() {\n\t\t\t\tif ( !enabled ) {\n\t\t\t\t\tif ( !check_box ) {\n\t\t\t\t\t\tif ( LocalCacheData.current_open_sub_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_sub_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = Global.view_mode_message;\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t} else if ( LocalCacheData.current_open_primary_controller &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.edit_view &&\n\t\t\t\t\t\t\tLocalCacheData.current_open_primary_controller.is_viewing ) {\n\t\t\t\t\t\t\terror_string = Global.view_mode_message;\n\t\t\t\t\t\t\t$this.showErrorTip( 10 );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif ( error_string && error_string.length > 0 ) {\n\t\t\t\t\t\t$this.showErrorTip( 20 );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\ttext_input.focusout( function() {\n\t\t\t\t$this.hideErrorTip();\n\t\t\t} );\n\n\t\t\t//Prevent missing formula input box from appearing during first load.\n\t\t\tTTPromise.wait( null, null, function() {\n\t\t\t\ttext_input.parents( '.formula-builder' ).css( 'opacity', 1 );\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.FormulaBuilder.defaults = {};\n\n} )( jQuery );","import '@/global/widgets/formula_builder/FormulaBuilder.js'; // imported unnamed as it self executes on to the jQuery object as a jQuery plugin.\n\nexport class CustomColumnViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#custom_column_view_container',\n\n\t\t\tsub_report_schedule_view_controller: null,\n\n\t\t\ttype_array: null,\n\t\t\tformat_array: null,\n\t\t\texclude_columns_array: null,\n\t\t\tinclude_columns_array: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\tthis.edit_view_tpl = 'CustomColumnEditView.html';\n\t\tthis.permission_id = 'report';\n\t\tthis.viewId = 'CustomColumn';\n\t\tthis.script_name = 'CustomColumnView';\n\t\tthis.context_menu_name = $.i18n._( 'Custom Column' );\n\t\tthis.navigation_label = $.i18n._( 'Custom Column' ) + ':';\n\t\tthis.table_name_key = 'report_custom_column';\n\t\tthis.api = TTAPI.APIReportCustomColumn;\n\n\t\tthis.render();\n\t\tif ( this.sub_view_mode ) {\n\t\t\tthis.buildContextMenu( true );\n\n\t\t\t//call init data in parent view, don't call initData\n\t\t} else {\n\t\t\tthis.buildContextMenu();\n\t\t\tif ( !this.sub_view_mode ) {\n\t\t\t\tthis.initData();\n\t\t\t}\n\t\t\tthis.setSelectRibbonMenuIfNecessary();\n\t\t}\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.mass_edit],\n\t\t\tinclude: []\n\t\t};\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tcontext_menu_model.exclude.push( ContextMenuIconName.view );\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_custom_column': { 'label': $.i18n._( 'Custom Column' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tif ( !this.edit_only_mode ) {\n\t\t\tthis.navigation.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIUserReportData,\n\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_branch',\n\t\t\t\tnavigation_mode: true,\n\t\t\t\tshow_search_inputs: true\n\t\t\t} );\n\n\t\t\tthis.setNavigation();\n\t\t}\n\n\t\t//Tab 0 start\n\n\t\tvar tab_custom_column = this.edit_view_tab.find( '#tab_custom_column' );\n\n\t\tvar tab_custom_column_column1 = tab_custom_column.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_custom_column_column1 );\n\n\t\t// Name\n\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'name', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Name' ), form_item_input, tab_custom_column_column1, '' );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Description\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_custom_column_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Type\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id', set_empty: false } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_custom_column_column1 );\n\n\t\t//Format\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'format_id' } );\n\t\tform_item_input.setSourceData( $this.format_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Format' ), form_item_input, tab_custom_column_column1 );\n\n\t\t//Include Columns\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input = form_item_input.AComboBox( {\n\t\t\tfield: 'include_columns',\n\t\t\tset_empty: true,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_option_column',\n\t\t\tkey: 'value'\n\t\t} );\n\n\t\tform_item_input.setSourceData( $this.include_columns_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Include Columns' ), form_item_input, tab_custom_column_column1, '', null, true );\n\n\t\t//exclude Columns\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input = form_item_input.AComboBox( {\n\t\t\tfield: 'exclude_columns',\n\t\t\tset_empty: true,\n\t\t\tallow_multiple_selection: true,\n\t\t\tlayout_name: 'global_option_column',\n\t\t\tkey: 'value'\n\t\t} );\n\n\t\tform_item_input.setSourceData( $this.exclude_columns_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Exclude Columns' ), form_item_input, tab_custom_column_column1, '', null, true );\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.FORMULA_BUILDER );\n\t\tform_item_input.FormulaBuilder( {\n\t\t\tfield: 'formula', width: '100%', onFormulaBtnClick: function() {\n\t\t\t\tvar report_api = LocalCacheData.current_open_report_controller.api;\n\t\t\t\t$this.api.getOptions( 'formula_functions', {\n\t\t\t\t\tonResult: function( fun_result ) {\n\t\t\t\t\t\tvar fun_res_data = fun_result.getResult();\n\n\t\t\t\t\t\tif ( $this.current_edit_record.type_id == 30 || $this.current_edit_record.type_id == 31 ) {\n\t\t\t\t\t\t\treport_api.getOptions( 'filter_columns', { onResult: onColumnsResult } );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treport_api.getOptions( 'formula_columns', { onResult: onColumnsResult } );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfunction onColumnsResult( col_result ) {\n\t\t\t\t\t\t\tvar col_res_data = col_result.getResult();\n\n\t\t\t\t\t\t\tvar default_args = {};\n\t\t\t\t\t\t\tdefault_args.functions = Global.buildRecordArray( fun_res_data );\n\t\t\t\t\t\t\tdefault_args.variables = Global.buildRecordArray( col_res_data );\n\t\t\t\t\t\t\tdefault_args.formula = $this.current_edit_record.formula;\n\t\t\t\t\t\t\tdefault_args.current_edit_record = Global.clone( $this.current_edit_record );\n\t\t\t\t\t\t\tdefault_args.api = $this.api;\n\n\t\t\t\t\t\t\tIndexViewController.openWizard( 'FormulaBuilderWizard', default_args, function( val ) {\n\t\t\t\t\t\t\t\t$this.current_edit_record.formula = val;\n\t\t\t\t\t\t\t\t$this.edit_view_ui_dic.formula.setValue( val );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\t$this.addEditFieldToColumn( $.i18n._( 'Formula' ), form_item_input, tab_custom_column_column1, '', null, true, true );\n\t\tform_item_input.parent().width( '45%' );\n\t\t$this.detachElement( 'formula' );\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tswitch ( key ) {\n\t\t\tcase 'type_id':\n\t\t\t\tthis.onTypeChange();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tonAddClick() {\n\t\tsuper.onAddClick();\n\t\tvar $this = this;\n\t\tTTPromise.wait( null, null, function() {\n\t\t\t$this.collectUIDataToCurrentEditRecord();\n\t\t\t$this.onTypeChange();\n\t\t} );\n\t}\n\n\tonTypeChange() {\n\t\tif ( this.current_edit_record.type_id == 10 ) {\n\t\t\tthis.detachElement( 'formula' );\n\t\t\tthis.attachElement( 'exclude_columns' );\n\t\t\tthis.attachElement( 'include_columns' );\n\t\t} else {\n\t\t\tthis.attachElement( 'formula' );\n\t\t\tthis.detachElement( 'exclude_columns' );\n\t\t\tthis.detachElement( 'include_columns' );\n\t\t}\n\t}\n\n\tsetEditViewDataDone() {\n\t\tvar $this = this;\n\t\tsuper.setEditViewDataDone();\n\t\tthis.onTypeChange();\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Name' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'name',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Description' ),\n\t\t\t\tfield: 'description',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tin_column: 1,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Created By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'created_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Updated By' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'updated_by',\n\t\t\t\tlayout_name: 'global_user',\n\t\t\t\tapi_class: TTAPI.APIUser,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tscript_name: 'EmployeeView',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\n\t\t];\n\t}\n\n\tgetGridSetup() {\n\t\tvar $this = this;\n\n\t\tvar grid_setup = {\n\t\t\tcontainer_selector: this.sub_view_mode ? '#tab_custom_columns' : 'body',\n\t\t\tsub_grid_mode: this.sub_view_mode,\n\t\t\tonSelectRow: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonCellSelect: function() {\n\t\t\t\t$this.onGridSelectRow();\n\t\t\t},\n\t\t\tonSelectAll: function() {\n\t\t\t\t$this.onGridSelectAll();\n\t\t\t},\n\t\t\tondblClickRow: function( e ) {\n\t\t\t\t$this.onGridDblClickRow( e );\n\t\t\t},\n\t\t\tonRightClickRow: function( rowId ) {\n\t\t\t\tvar id_array = $this.getGridSelectIdArray();\n\t\t\t\tif ( id_array.indexOf( rowId ) < 0 ) {\n\t\t\t\t\t$this.grid.grid.resetSelection();\n\t\t\t\t\t$this.grid.grid.setSelection( rowId );\n\t\t\t\t\t$this.onGridSelectRow();\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\t//Only use custom grid sizing when in sub_view_mode, since we need to use the BaseViewController grid sizing otherwise.\n\t\tif ( this.sub_view_mode ) {\n\t\t\tgrid_setup.setGridSize = function() {\n\t\t\t\tif ( $this.sub_view_mode ) {\n\t\t\t\t\t$this.baseViewSubTabGridResize( '#tab_custom_columns' );\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tgrid_setup.onResizeGrid = function() {\n\t\t\t\tif ( $this.sub_view_mode ) {\n\t\t\t\t\t$this.baseViewSubTabGridResize( '#tab_custom_columns' );\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn grid_setup;\n\t}\n\n\topenEditView() {\n\t\tif ( !this.edit_view ) {\n\t\t\tthis.initEditViewUI( this.viewId, this.edit_view_tpl );\n\t\t}\n\n\t\tif ( this.sub_view_mode ) {\n\t\t\tthis.parent_view_controller.need_refresh_display_columns = true;\n\t\t}\n\t}\n\n\tinitOptions( callBack ) {\n\n\t\tvar $this = this;\n\n\t\tthis.initDropDownOption( 'type' );\n\t\tthis.initDropDownOption( 'format' );\n\t\tthis.initDropDownOption( 'dynamic_columns', 'dynamic_columns', this.parent_view_controller.api, function( result ) {\n\t\t\tvar result_data = result.getResult();\n\n\t\t\t$this.include_columns_array = Global.buildRecordArray( result_data );\n\t\t\t$this.exclude_columns_array = Global.buildRecordArray( result_data );\n\t\t} );\n\t}\n\n\tonDeleteDone( result ) {\n\t\tthis.parent_view_controller.need_refresh_display_columns = true;\n\t\tthis.removeDeletedRows();\n\t}\n\n\tonDeleteAndNextDone( result ) {\n\t\tthis.parent_view_controller.need_refresh_display_columns = true;\n\t}\n\n\tsearchDone() {\n\t\t$( 'window' ).trigger( 'resize' );\n\t\tif ( this.sub_view_mode ) {\n\t\t\tTTPromise.resolve( 'SubCustomColumnView', 'init' );\n\t\t}\n\t\tsuper.searchDone();\n\t}\n}\n\nCustomColumnViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'CustomColumn', 'SubCustomColumnView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) );\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tTTPromise.wait( 'BaseViewController', 'initialize', function() {\n\t\t\t\t\tafterViewLoadedFun( sub_custom_column_controller );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n};"],"sourceRoot":""}