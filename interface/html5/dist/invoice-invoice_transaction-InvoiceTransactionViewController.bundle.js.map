{"version":3,"sources":["webpack://timetrex/./interface/html5/views/invoice/invoice_transaction/InvoiceTransactionViewController.js"],"names":["InvoiceTransactionViewController","BaseViewController","options","_","defaults","el","status_array","type_array","payment_type_array","currency_array","currency_api","super","this","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","$","i18n","navigation_label","api","TTAPI","APITransaction","APICurrency","render","buildContextMenu","sub_view_mode","initData","setSelectRibbonMenuIfNecessary","callBack","$this","option_name","field_name","getCurrency","filter_columns","name","id","onResult","res","getResult","temp_currency_arr","each","key","item","Global","buildRecordArray","initDropDownOptions","result","context_menu_model","exclude","include","ContextMenuIconName","edit","delete_icon","delete_and_next","save","save_and_continue","save_and_next","cancel","edit_only_mode","push","label","edit_client","group","icon","Icons","client","client_contact","invoice","payment_method","export_excel","doNotSetFocus","context_menu_array","isSet","selectContextMenu","setTotalDisplaySpan","len","length","grid_selected_length","getGridSelectIdArray","i","context_btn","find","attr","removeClass","setDefaultMenuEditIcon","setDefaultMenuDeleteIcon","setDefaultMenuDeleteAndNextIcon","copy","setDefaultMenuCopyIcon","setDefaultMenuSaveIcon","setDefaultMenuSaveAndNextIcon","setDefaultMenuSaveAndContinueIcon","setDefaultMenuCancelIcon","setDefaultMenuEditClientIcon","setDefaultMenuExportIcon","setContextMenuGroupVisibility","pId","addClass","onNavigationClick","iconName","grid_selected_id_array","filter","filter_data","client_ids","edit_view","current_edit_record","client_id","index","value","grid_selected_row","getRecordFromGridById","IndexViewController","openEditView","addViewTab","window","location","href","goToView","onExportClick","key_name","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","tab_transaction_column1","edit_view_tab","edit_view_tabs","form_item_input","loadWidgetByName","FormItemType","COMBO_BOX","TComboBox","field","setSourceData","addEditFieldToColumn","AWESOME_BOX","APIProduct","set_empty","TEXT_INPUT","TTextInput","width","parent","type_id","APIClientPayment","setDefaultArgs","DATE_PICKER","TDatePicker","TEXT_AREA","TTextArea","TEXT","TText","args","invoice_id","result_data","currency_id","amount","owing_amount","effective_date","Date","format","initOptions","initEditViewUI","getTransactionDefaultData","initEditView","column_filter","display_columns","grid","getGridParam","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","APIClient","setSelectLayout","target","doNotValidate","getField","c_value","getValue","is_changed","onTypeChange","onPaymentTypeChange","validate","hasOwnProperty","payment_process_message","attachElement","detachElement","widget","edit_view_ui_dic","setValue","collectUIDataToCurrentEditRecord","setEditViewDataDone","isEditChange","editFieldResize","cleanValue","client_payment_id","payment_type_id","default_args","setEnabled","isValid","refresh_id","TTUUID","isUUID","zero_id","not_exist_id","search","onSaveDone","removeEditView","parent_view_controller","initInsideEditorData","setErrorMenu","setErrorTips","loadSubView","container","beforeViewLoadedFun","afterViewLoadedFun","loadViewSource","template","html","sub_invoice_transaction_view_controller"],"mappings":"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","file":"invoice-invoice_transaction-InvoiceTransactionViewController.bundle.js?v=d2a99d566aa0244b0a78","sourcesContent":["export class InvoiceTransactionViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#invoice_transaction_view_container',\n\n\t\t\tstatus_array: null,\n\t\t\ttype_array: null,\n\t\t\tpayment_type_array: null,\n\t\t\tcurrency_array: null,\n\t\t\tcurrency_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'InvoiceTransactionEditView.html';\n\t\tthis.permission_id = 'transaction';\n\t\tthis.viewId = 'InvoiceTransaction';\n\t\tthis.script_name = 'InvoiceTransactionView';\n\t\tthis.table_name_key = 'invoice_transaction';\n\t\tthis.context_menu_name = $.i18n._( 'Transactions' );\n\t\tthis.navigation_label = $.i18n._( 'Transaction' ) + ':';\n\t\tthis.api = TTAPI.APITransaction;\n\t\tthis.currency_api = TTAPI.APICurrency;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tif ( !this.sub_view_mode ) {\n\t\t\tthis.initData();\n\t\t}\n\t\tthis.setSelectRibbonMenuIfNecessary( 'InvoiceTransaction' );\n\t}\n\n\tinitOptions( callBack ) {\n\t\tvar $this = this;\n\t\tvar filter = { filter_columns: { name: true, id: true } };\n\n\t\tvar options = [\n\t\t\t{ option_name: 'status', field_name: null, api: null },\n\t\t\t{ option_name: 'type', field_name: null, api: null },\n\t\t\t{ option_name: 'payment_type', field_name: null, api: null }\n\t\t];\n\n\t\tthis.currency_api.getCurrency( filter, false, {\n\t\t\tonResult: function( res ) {\n\n\t\t\t\tres = res.getResult();\n\n\t\t\t\tvar temp_currency_arr = {};\n\n\t\t\t\t$.each( res, function( key, item ) {\n\t\t\t\t\ttemp_currency_arr[item.id] = item.name;\n\t\t\t\t} );\n\n\t\t\t\t$this.currency_array = Global.buildRecordArray( temp_currency_arr );\n\n\t\t\t\t$this.initDropDownOptions( options, function( result ) {\n\n\t\t\t\t\tif ( callBack ) {\n\t\t\t\t\t\tcallBack( result ); // First to initialize drop down options, and then to initialize edit view UI.\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\tContextMenuIconName.edit,\n\t\t\t\tContextMenuIconName.delete_icon,\n\t\t\t\tContextMenuIconName.delete_and_next,\n\t\t\t\tContextMenuIconName.save,\n\t\t\t\tContextMenuIconName.save_and_continue,\n\t\t\t\tContextMenuIconName.save_and_next,\n\t\t\t\tContextMenuIconName.cancel\n\t\t\t]\n\t\t};\n\n\t\tif ( !this.sub_view_mode && !this.edit_only_mode ) {\n\n\t\t\tcontext_menu_model.include.push(\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Edit<br>Client' ),\n\t\t\t\t\tid: ContextMenuIconName.edit_client,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.client\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Client<br>Contacts' ),\n\t\t\t\t\tid: ContextMenuIconName.client_contact,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.client_contact\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Invoices' ),\n\t\t\t\t\tid: ContextMenuIconName.invoice,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.invoice\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Payment<br>Methods' ),\n\t\t\t\t\tid: ContextMenuIconName.payment_method,\n\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\ticon: Icons.payment_method\n\t\t\t\t},\n\t\t\t\tContextMenuIconName.export_excel\n\t\t\t);\n\t\t}\n\n\t\treturn context_menu_model;\n\t}\n\n\t/* jshint ignore:start */\n\tsetDefaultMenu( doNotSetFocus ) {\n\n\t\t//Error: Uncaught TypeError: Cannot read property 'length' of undefined in /interface/html5/#!m=Employee&a=edit&id=42411&tab=Wage line 282\n\t\tif ( !this.context_menu_array ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( !Global.isSet( doNotSetFocus ) || !doNotSetFocus ) {\n\t\t\tthis.selectContextMenu();\n\t\t}\n\n\t\tthis.setTotalDisplaySpan();\n\n\t\tvar len = this.context_menu_array.length;\n\n\t\tvar grid_selected_id_array = this.getGridSelectIdArray();\n\n\t\tvar grid_selected_length = grid_selected_id_array.length;\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar context_btn = $( this.context_menu_array[i] );\n\t\t\tvar id = $( context_btn.find( '.ribbon-sub-menu-icon' ) ).attr( 'id' );\n\n\t\t\tcontext_btn.removeClass( 'invisible-image' );\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\n\t\t\tswitch ( id ) {\n\t\t\t\tcase ContextMenuIconName.edit:\n\t\t\t\t\tthis.setDefaultMenuEditIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_icon:\n\t\t\t\t\tthis.setDefaultMenuDeleteIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.delete_and_next:\n\t\t\t\t\tthis.setDefaultMenuDeleteAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.copy:\n\t\t\t\t\tthis.setDefaultMenuCopyIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save:\n\t\t\t\t\tthis.setDefaultMenuSaveIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_next:\n\t\t\t\t\tthis.setDefaultMenuSaveAndNextIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.save_and_continue:\n\t\t\t\t\tthis.setDefaultMenuSaveAndContinueIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.cancel:\n\t\t\t\t\tthis.setDefaultMenuCancelIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\t\t\tthis.setDefaultMenuEditClientIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\t\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\t\tthis.setDefaultMenuExportIcon( context_btn, grid_selected_length );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.setContextMenuGroupVisibility();\n\t}\n\n\tsetDefaultMenuEditClientIcon( context_btn, grid_selected_length, pId ) {\n\t\tif ( grid_selected_length === 1 ) {\n\t\t\tcontext_btn.removeClass( 'disable-image' );\n\t\t} else {\n\t\t\tcontext_btn.addClass( 'disable-image' );\n\t\t}\n\t}\n\n\tonCustomContextClick( id ) {\n\t\tswitch ( id ) {\n\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\tcase ContextMenuIconName.client_contact:\n\t\t\tcase ContextMenuIconName.invoice:\n\t\t\tcase ContextMenuIconName.payment_method:\n\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\tthis.onNavigationClick( id );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonNavigationClick( iconName ) {\n\n\t\tvar $this = this;\n\n\t\tvar grid_selected_id_array;\n\n\t\tvar filter = { filter_data: {} };\n\n\t\tvar client_ids = [];\n\n\t\tif ( $this.edit_view && $this.current_edit_record.id ) {\n\t\t\tclient_ids.push( $this.current_edit_record.client_id );\n\t\t} else {\n\t\t\tgrid_selected_id_array = this.getGridSelectIdArray();\n\t\t\t$.each( grid_selected_id_array, function( index, value ) {\n\t\t\t\tvar grid_selected_row = $this.getRecordFromGridById( value );\n\t\t\t\tclient_ids.push( grid_selected_row.client_id );\n\t\t\t} );\n\t\t}\n\n\t\tfilter.filter_data.client_id = client_ids;\n\n\t\tswitch ( iconName ) {\n\t\t\tcase ContextMenuIconName.edit_client:\n\t\t\t\tif ( client_ids.length > 0 ) {\n\t\t\t\t\tIndexViewController.openEditView( this, 'Client', client_ids[0] );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.client_contact:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Transactions' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientContact', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.invoice:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Transactions' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'Invoice', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.payment_method:\n\t\t\t\tGlobal.addViewTab( $this.viewId, $.i18n._( 'Transactions' ), window.location.href );\n\t\t\t\tIndexViewController.goToView( 'ClientPayment', filter );\n\t\t\t\tbreak;\n\t\t\tcase ContextMenuIconName.export_excel:\n\t\t\t\tthis.onExportClick( 'export' + this.api.key_name );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_transaction': { 'label': $.i18n._( 'Transaction' ) },\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tif ( !this.edit_only_mode ) {\n\t\t\tthis.navigation.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APITransaction,\n\t\t\t\tid: this.script_name + '_navigation',\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_transaction',\n\t\t\t\tnavigation_mode: true,\n\t\t\t\tshow_search_inputs: true\n\t\t\t} );\n\n\t\t\tthis.setNavigation();\n\n\t\t}\n\n\t\t//Tab 0 start\n\n\t\tvar tab_transaction = this.edit_view_tab.find( '#tab_transaction' );\n\n\t\tvar tab_transaction_column1 = tab_transaction.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_transaction_column1 );\n\n\t\t// Status\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'status_id' } );\n\t\tform_item_input.setSourceData( $this.status_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Status' ), form_item_input, tab_transaction_column1, '' );\n\n\t\t//Currency\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'currency_id' } );\n\t\tform_item_input.setSourceData( $this.currency_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_transaction_column1 );\n\n\t\t// Type\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'type_id' } );\n\t\tform_item_input.setSourceData( $this.type_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_transaction_column1 );\n\n\t\tif ( !this.edit_only_mode ) {\n\t\t\t//Product\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIProduct,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_product',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tfield: 'product_id'\n\t\t\t} );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Product' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t\t//Description\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\t\tform_item_input.TTextInput( { field: 'description', width: '100%' } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t\tform_item_input.parent().width( '45%' );\n\n\t\t\t//Quantity\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\t\tform_item_input.TTextInput( { field: 'quantity', width: 80 } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Quantity' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t\t//Unit Cost\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\t\tform_item_input.TTextInput( { field: 'unit_cost', width: 80 } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Unit Cost' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t}\n\n\t\t// Payment Type\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\t\tform_item_input.TComboBox( { field: 'payment_type_id' } );\n\t\tform_item_input.setSourceData( $this.payment_type_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Type' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t// Payment Method\n\t\tvar filter = {};\n\t\tfilter.filter_data = {};\n\t\tfilter.filter_data.client_id = -1;\n\t\tfilter.filter_data.type_id = [];\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIClientPayment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_client_payment',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'client_payment_id'\n\t\t} );\n\t\tform_item_input.setDefaultArgs( filter );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Method' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\tif ( !this.edit_only_mode ) {\n\t\t\t//Unit Price\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\t\tform_item_input.TTextInput( { field: 'unit_price', width: 80 } );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Unit Price' ), form_item_input, tab_transaction_column1, '', null, true );\n\t\t}\n\n\t\t//Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'amount', width: 80 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), form_item_input, tab_transaction_column1 );\n\n\t\t//Effective Date\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'effective_date' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Effective Date' ), form_item_input, tab_transaction_column1 );\n\n\t\t// Confirmation Number\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\n\t\tform_item_input.TTextInput( { field: 'confirm_number', width: 120 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Confirmation Number' ), form_item_input, tab_transaction_column1, '', null, true );\n\n\t\t//Note\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\n\t\tform_item_input.TTextArea( { field: 'note', width: '100%' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Note' ), form_item_input, tab_transaction_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t//Process Invoice\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\n\t\tform_item_input.TText( { field: 'payment_process_message' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Process Message' ), form_item_input, tab_transaction_column1, '', null, true );\n\t}\n\n\tgetTransactionDefaultData( args, callBack ) {\n\t\tthis.api['get' + this.api.key_name + 'DefaultData']( args.type_id, args.invoice_id, {\n\t\t\tonResult: function( res ) {\n\t\t\t\tvar result_data = res.getResult();\n\n\t\t\t\tif ( !result_data ) {\n\t\t\t\t\tresult_data = {};\n\t\t\t\t}\n\n\t\t\t\tresult_data.invoice_id = args.invoice_id;\n\t\t\t\tresult_data.client_id = args.client_id;\n\t\t\t\tresult_data.type_id = args.type_id;\n\t\t\t\tresult_data.currency_id = args.currency_id;\n\t\t\t\tresult_data.amount = args.owing_amount;\n\t\t\t\tresult_data.effective_date = new Date().format();\n\n\t\t\t\tcallBack( result_data );\n\n\t\t\t}\n\t\t} );\n\t}\n\n\topenEditView( args ) {\n\n\t\tvar $this = this;\n\n\t\tif ( $this.edit_only_mode ) {\n\n\t\t\t$this.initOptions(\n\t\t\t\tfunction( result ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\t$this.initEditViewUI( $this.viewId, $this.edit_view_tpl );\n\t\t\t\t\t}\n\n\t\t\t\t\t$this.getTransactionDefaultData( args, function( result ) {\n\n\t\t\t\t\t\t$this.current_edit_record = result;\n\n\t\t\t\t\t\t$this.initEditView();\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\t\t\t);\n\n\t\t} else {\n\n\t\t\tif ( !this.edit_view ) {\n\t\t\t\tthis.initEditViewUI( this.viewId, this.edit_view_tpl );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tgetFilterColumnsFromDisplayColumns() {\n\n\t\tvar column_filter = {};\n\t\tcolumn_filter.is_owner = true;\n\t\tcolumn_filter.id = true;\n\t\tcolumn_filter.is_child = true;\n\t\tcolumn_filter.in_use = true;\n\t\tcolumn_filter.first_name = true;\n\t\tcolumn_filter.last_name = true;\n\t\tcolumn_filter.client_id = true;\n\n\t\t// Error: Unable to get property 'getGridParam' of undefined or null reference\n\t\tvar display_columns = [];\n\t\tif ( this.grid ) {\n\t\t\tdisplay_columns = this.grid.getGridParam( 'colModel' );\n\t\t}\n\n\t\tif ( display_columns ) {\n\t\t\tvar len = display_columns.length;\n\n\t\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\t\tvar column_info = display_columns[i];\n\t\t\t\tcolumn_filter[column_info.name] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn column_filter;\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'type_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Product' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'product_id',\n\t\t\t\tlayout_name: 'global_product',\n\t\t\t\tapi_class: TTAPI.APIProduct,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Invoice Number' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'invoice_number',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.TEXT_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Client' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'client_id',\n\t\t\t\tlayout_name: 'global_client',\n\t\t\t\tapi_class: TTAPI.APIClient,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tsetSelectLayout() {\n\t\tif ( this.sub_view_mode ) {\n\t\t\tsuper.setSelectLayout( ['client'] );\n\t\t} else {\n\t\t\tsuper.setSelectLayout();\n\t\t}\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\t//#2121 added to trigger confirmation dialog on changed and navigation arrow click\n\t\tthis.is_changed = true;\n\n\t\tif ( key === 'type_id' ) {\n\t\t\tthis.onTypeChange();\n\t\t}\n\n\t\tif ( key === 'payment_type_id' ) {\n\t\t\tthis.onPaymentTypeChange( true );\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tsetCurrentEditRecordData() {\n\n\t\tif ( this.current_edit_record.hasOwnProperty( 'payment_process_message' ) && this.current_edit_record.payment_process_message ) {\n\t\t\tthis.attachElement( 'payment_process_message' );\n\t\t} else {\n\t\t\tthis.detachElement( 'payment_process_message' );\n\t\t}\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'type_id':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\tsetEditViewDataDone() {\n\n\t\tsuper.setEditViewDataDone();\n\t\tthis.onTypeChange();\n\t\tthis.onPaymentTypeChange();\n\t\tthis.isEditChange();\n\t}\n\n\tonTypeChange() {\n\t\tif ( this.current_edit_record.type_id == 10 ) { //Debit\n\t\t\tthis.detachElement( 'product_id' );\n\t\t\tthis.detachElement( 'description' );\n\t\t\tthis.detachElement( 'quantity' );\n\t\t\tthis.detachElement( 'unit_cost' );\n\t\t\tthis.detachElement( 'payment_type_id' );\n\t\t\tthis.detachElement( 'client_payment_id' );\n\t\t\tthis.detachElement( 'unit_price' );\n\t\t\tthis.detachElement( 'confirm_number' );\n\n\t\t} else {\n\t\t\tif ( !this.edit_only_mode ) {\n\t\t\t\tthis.detachElement( 'product_id' );\n\t\t\t\tthis.detachElement( 'description' );\n\t\t\t\tthis.detachElement( 'quantity' );\n\t\t\t\tthis.detachElement( 'unit_cost' );\n\t\t\t\tthis.detachElement( 'unit_price' );\n\t\t\t}\n\n\t\t\tthis.attachElement( 'payment_type_id' );\n\t\t\tthis.detachElement( 'client_payment_id' );\n\t\t\tthis.detachElement( 'confirm_number' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\t}\n\n\tonPaymentTypeChange( cleanValue ) {\n\t\tif ( cleanValue ) {\n\t\t\tthis.edit_view_ui_dic['client_payment_id'].setValue( false );\n\t\t\tthis.current_edit_record.client_payment_id = false;\n\t\t}\n\t\tif ( this.current_edit_record.payment_type_id == 10 ) {\n\t\t\tthis.detachElement( 'client_payment_id' );\n\t\t\tthis.detachElement( 'confirm_number' );\n\n\t\t} else if ( this.current_edit_record.payment_type_id == 30 || this.current_edit_record.payment_type_id == 35 || this.current_edit_record.payment_type_id == 40 ) {\n\t\t\tthis.edit_view_ui_dic['client_payment_id'].setSourceData( null );\n\t\t\tif ( this.current_edit_record.payment_type_id == 40 ) {\n\t\t\t\tthis.edit_view_ui_dic['client_payment_id'].default_args.filter_data.client_id = this.current_edit_record['client_id'];\n\t\t\t\tthis.edit_view_ui_dic['client_payment_id'].default_args.filter_data.type_id = [40];\n\t\t\t} else {\n\t\t\t\tthis.edit_view_ui_dic['client_payment_id'].default_args.filter_data.client_id = this.current_edit_record['client_id'];\n\t\t\t\tthis.edit_view_ui_dic['client_payment_id'].default_args.filter_data.type_id = [30];\n\t\t\t}\n\t\t\tthis.attachElement( 'client_payment_id' );\n\t\t\tthis.detachElement( 'confirm_number' );\n\n\t\t} else {\n\t\t\tthis.attachElement( 'confirm_number' );\n\t\t\tthis.detachElement( 'client_payment_id' );\n\t\t}\n\n\t\tthis.editFieldResize();\n\t}\n\n\tisEditChange() {\n\n\t\tif ( this.current_edit_record.id ) {\n\t\t\tthis.edit_view_ui_dic['status_id'].setEnabled( false );\n\t\t\tthis.edit_view_ui_dic['type_id'].setEnabled( false );\n\t\t\tthis.edit_view_ui_dic['product_id'].setEnabled( false );\n\t\t\tthis.edit_view_ui_dic['quantity'].setEnabled( false );\n\t\t\tthis.edit_view_ui_dic['unit_cost'].setEnabled( false );\n\t\t\tthis.edit_view_ui_dic['unit_price'].setEnabled( false );\n\t\t} else {\n\n\t\t\tif ( this.edit_only_mode ) {\n\t\t\t\tthis.edit_view_ui_dic['status_id'].setEnabled( false );\n\t\t\t\tthis.edit_view_ui_dic['currency_id'].setEnabled( false );\n\t\t\t\tthis.edit_view_ui_dic['type_id'].setEnabled( false );\n\t\t\t} else {\n\t\t\t\tthis.edit_view_ui_dic['status_id'].setEnabled( true );\n\t\t\t\tthis.edit_view_ui_dic['type_id'].setEnabled( true );\n\t\t\t\tthis.edit_view_ui_dic['product_id'].setEnabled( true );\n\t\t\t\tthis.edit_view_ui_dic['quantity'].setEnabled( true );\n\t\t\t\tthis.edit_view_ui_dic['unit_cost'].setEnabled( true );\n\t\t\t\tthis.edit_view_ui_dic['unit_price'].setEnabled( true );\n\t\t\t}\n\n\t\t}\n\t}\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( !this.edit_only_mode ) {\n\t\t\t\tif ( result_data === true ) {\n\t\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t\t$this.refresh_id = result_data;\n\t\t\t\t}\n\n\t\t\t\t$this.search();\n\t\t\t}\n\n\t\t\t$this.onSaveDone( result );\n\n\t\t\t$this.removeEditView();\n\n\t\t\tif ( this.edit_only_mode ) {\n\t\t\t\t$this.parent_view_controller.initInsideEditorData( true );\n\t\t\t}\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n}\n\nInvoiceTransactionViewController.loadSubView = function( container, beforeViewLoadedFun, afterViewLoadedFun ) {\n\n\tGlobal.loadViewSource( 'InvoiceTransaction', 'SubInvoiceTransactionView.html', function( result ) {\n\t\tvar args = {};\n\t\tvar template = _.template( result );\n\n\t\tif ( Global.isSet( beforeViewLoadedFun ) ) {\n\t\t\tbeforeViewLoadedFun();\n\t\t}\n\n\t\tif ( Global.isSet( container ) ) {\n\t\t\tcontainer.html( template( args ) );\n\t\t\tif ( Global.isSet( afterViewLoadedFun ) ) {\n\t\t\t\tafterViewLoadedFun( sub_invoice_transaction_view_controller );\n\t\t\t}\n\t\t}\n\t} );\n};\n"],"sourceRoot":""}