(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["company-payroll_remittance_agency-PayrollRemittanceAgencyViewController"],{3665:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"PayrollRemittanceAgencyViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#payroll_remittance_agency_view_container",status_array:null,type_array:null,agency_array:null,country_array:null,province_array:null,district_array:null,remittance_source_account_array:null,sub_event_view_controller:null,e_province_array:null,company_api:null,remittance_source_account_api:null,always_week_day_array:null,date_api:null}),super(e)}init(){this.edit_view_tpl="PayrollRemittanceAgencyEditView.html",this.permission_id="payroll_remittance_agency",this.viewId="PayrollRemittanceAgency",this.script_name="PayrollRemittanceAgencyView",this.table_name_key="payroll_remittance_agency",this.context_menu_name=$.i18n._("Remittance Agencies"),this.navigation_label=$.i18n._("Remittance Agency")+":",this.api=TTAPI.APIPayrollRemittanceAgency,this.company_api=TTAPI.APICompany,this.date_api=TTAPI.APITTDate,this.remittance_source_account_api=TTAPI.APIRemittanceSourceAccount,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(e){var i=this;this.initDropDownOption("status"),this.initDropDownOption("type"),this.initDropDownOption("country","country",this.company_api),this.api.getOptions("always_week_day",{onResult:function(t){t=t.getResult(),i.always_week_day_array=Global.buildRecordArray(t),"function"==typeof e&&e(t)}})}openEditView(e){var i=this;this.edit_only_mode?this.initOptions((function(t){i.edit_view||i.initEditViewUI(i.viewId,i.edit_view_tpl);var a={};a.filter_data={id:e},i.api.getPayrollRemittanceAgency(a,{onResult:function(e){(e=e.getResult()[0])?(i.current_edit_record=e,i.initEditView()):(TAlertManager.showAlert($.i18n._("Invalid agency id")),i.onCancelClick())}})})):super.openEditView()}getFilterColumnsFromDisplayColumns(){var e={is_owner:!0,id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,type_id:!0,country:!0,province:!0,district:!0},i=[];if(this.grid&&(i=this.grid.getGridParam("colModel")),i)for(var t=i.length,a=0;a<t;a++){e[i[a].name]=!0}return e}onSetSearchFilterFinished(){var e;0===this.search_panel.getSelectTabIndex()?(e=this.basic_search_field_ui_dic.country.getValue(),this.setProvince(e)):1===this.search_panel.getSelectTabIndex()&&(e=this.adv_search_field_ui_dic.country.getValue(),this.setProvince(e))}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.export_excel],include:[]}}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change($.proxy((function(){var e=this.basic_search_field_ui_dic.country.getValue();this.setProvince(e),this.basic_search_field_ui_dic.province.setValue(null)}),this))}onFormItemChange(e,i){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),a=e.getValue();switch(t){case"country":case"province":if(a.toString()===this.current_edit_record[t].toString())return;break;case"type_id":if(a.toString()===this.current_edit_record[t].toString())return;this.onTypeChange(a);break;case"agency_id":this.onAgencyIdChange()}this.current_edit_record[t]=a,"country"!==t&&"type_id"!==t&&"province"!==t&&"district"!==t||("province"!=t&&(this.detachElement("province"),this.eSetProvince(this.current_edit_record.country)),"district"!=t&&(this.detachElement("district"),this.setDistrict(this.current_edit_record.country,this.current_edit_record.province)),this.current_edit_record.type_id=this.edit_view_ui_dic.type_id.getValue(),this.current_edit_record.country=this.edit_view_ui_dic.country.getValue(),this.current_edit_record.province=this.edit_view_ui_dic.province.getValue()?this.edit_view_ui_dic.province.getValue():"00",this.current_edit_record.district=this.edit_view_ui_dic.district.getValue()?this.edit_view_ui_dic.district.getValue():"00",this.getAgencyOptions()),"legal_entity_id"===t&&this.getRemittanceSourceAccount(),i||this.validate()}onAgencyIdChange(){var e={"agency_id":this.edit_view_ui_dic.agency_id.getValue()},i=this.api.getOptions("agency_id_field_labels",e,{async:!1}).getResult();for(var t in this.detachElement("primary_identification"),this.detachElement("secondary_identification"),this.detachElement("tertiary_identification"),i)this.attachElement(t),this.edit_view_form_item_dic[t].find(".edit-view-form-item-label").text(i[t]+": ");this.editFieldResize()}getAgencyOptions(){var e={"type_id":this.current_edit_record.type_id,"country":this.current_edit_record.country,"province":this.current_edit_record.province,"district":this.current_edit_record.district},i=this;this.api.getOptions("agency",e,{async:!1,onResult:function(e){var t=e.getResult();t||(t=[]),i.agency_array=Global.buildRecordArray(t),Global.isSet(i.basic_search_field_ui_dic.agency_id)&&i.basic_search_field_ui_dic.agency_id.setSourceData(Global.buildRecordArray(t)),Global.isSet(i.adv_search_field_ui_dic.agency_id)&&i.adv_search_field_ui_dic.agency_id.setSourceData(Global.buildRecordArray(t)),i.edit_view_ui_dic.agency_id.setSourceData(i.agency_array),i.current_edit_record.agency_id&&e[i.current_edit_record.agency_id]?i.edit_view_ui_dic.agency_id.setValue(i.current_edit_record.agency_id):i.current_edit_record.agency_id=i.edit_view_ui_dic.agency_id.getValue(),i.onAgencyIdChange()}})}getRemittanceSourceAccount(){var e=this,i=this.edit_view_ui_dic.legal_entity_id.getValue();if(Global.isSet(i)&&!Global.isFalseOrNull(i)||(i=this.current_edit_record.legal_entity_id),TTUUID.isUUID(i)){var t={filter_data:{}};t.filter_data.legal_entity_id=i,t.filter_columns={},t.filter_columns.id=!0,t.filter_columns.name=!0,e.remittance_source_account_api.getRemittanceSourceAccount(t,{onResult:function(i){i=i.getResult(),e.remittance_source_account_array=i,e.edit_view_ui_dic.remittance_source_account_id.setSourceData(i)}})}}onTypeChange(e){Global.isSet(e)&&!Global.isFalseOrNull(e)||Global.isSet(this.current_edit_record.type_id)&&!Global.isFalseOrNull(this.current_edit_record.type_id)||(this.current_edit_record.type_id=10),this.editFieldResize()}setDistrict(e,i){var t=this;30==this.edit_view_ui_dic.type_id.getValue()?this.api.getDistrictOptions(e,i,{async:!1,onResult:function(e){if(e=e.getResult(),0==Object.keys(e).length||1==Object.keys(e).length&&e["00"])t.current_edit_record.district="00";else{e||(e=[]),t.attachElement("district");var i=null;if(e.length<=1&&(i={label:"-- "+$.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.district_array=Global.buildRecordArray(e,i),t.edit_view_ui_dic.district.setSourceData(t.district_array),t.current_edit_record.district&&e[t.current_edit_record.district])t.edit_view_ui_dic.district.setValue(t.current_edit_record.district);else{var a=t.edit_view_ui_dic.district.getValue();a!=TTUUID.not_exist_id&&a!=TTUUID.zero_id&&0!=a&&null!=a||(a="00",t.edit_view_ui_dic.district.setValue(a)),t.current_edit_record.district=a}}}}):(t.current_edit_record.district="00",t.edit_view_ui_dic.district.setValue("00"))}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];Global.isSet(i)&&i.setValue(this.current_edit_record[e])}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}eSetProvince(e,i){var t=this;this.edit_view_ui_dic.type_id.getValue()>10?this.api.getProvinceOptions(e,{async:!1,onResult:function(e){if((e=e.getResult())||(e=[]),t.edit_view_ui_dic.type_id.getValue()<20||0==Object.keys(e).length||1==Object.keys(e).length&&e["00"])t.current_edit_record.province="00";else{t.attachElement("province");var i=null;if(e.length<=1&&(i={label:"-- "+$.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.province_array=Global.buildRecordArray(e,i),t.edit_view_ui_dic.province.setSourceData(t.province_array),t.current_edit_record.province&&Global.isSet(e[t.current_edit_record.province]))t.edit_view_ui_dic.province.setValue(t.current_edit_record.province);else{var a=t.edit_view_ui_dic.province.getValue();a!=TTUUID.not_exist_id&&a!=TTUUID.zero_id&&0!=a&&null!=a||(a="00"),t.current_edit_record.province=a}}}}):(t.current_edit_record.province="00",t.edit_view_ui_dic.province.setValue("00 "))}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange(),this.detachElement("province"),this.detachElement("district"),this.eSetProvince(this.current_edit_record.country),this.setDistrict(this.current_edit_record.country,this.current_edit_record.province),this.getAgencyOptions()}buildEditViewUI(){super.buildEditViewUI();var e=this,i={"tab_payroll_remittance_agency":{"label":$.i18n._("Remittance Agency")},"tab_payroll_remittance_agency_event":{"label":$.i18n._("Events"),"init_callback":"initSubEventView","display_on_mass_edit":!1},"tab_audit":!0};this.setTabModel(i),this.navigation&&(this.navigation.AComboBox({api_class:TTAPI.APIPayrollRemittanceAgency,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_payroll_remittance_agency",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation());var t=this.edit_view_tab.find("#tab_payroll_remittance_agency"),a=t.find(".first-column"),r=t.find(".second-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(a),this.edit_view_tabs[0].push(r);var n=Global.loadWidgetByName(FormItemType.AWESOME_BOX);n.AComboBox({api_class:TTAPI.APILegalEntity,allow_multiple_selection:!1,layout_name:"global_legal_entity",field:"legal_entity_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn($.i18n._("Legal Entity"),n,a,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),n.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),n,a),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Name"),n,a),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"description",width:"100%"}),this.addEditFieldToColumn($.i18n._("Description"),n,a),n.parent().width("45%"),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"type_id"}),n.setSourceData(e.type_array),this.addEditFieldToColumn($.i18n._("Type"),n,a),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({set_empty:!1,field:"country"}),n.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Country"),n,a),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({set_empty:!1,field:"province"}),n.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province/State"),n,a,"",null,!0),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({set_empty:!1,field:"district"}),n.setSourceData([]),this.addEditFieldToColumn($.i18n._("District"),n,a,"",null,!0),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({set_empty:!1,field:"agency_id"}),n.setSourceData([]),this.addEditFieldToColumn($.i18n._("Agency"),n,a),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"primary_identification",width:200}),this.addEditFieldToColumn($.i18n._("Primary Identification"),n,a,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"secondary_identification",width:200}),this.addEditFieldToColumn($.i18n._("Secondary Identification"),n,a,"",null,!0),(n=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"tertiary_identification",width:200}),this.addEditFieldToColumn($.i18n._("Tertiary Identification"),n,a,"",null,!0),this.detachElement("primary_identification"),this.detachElement("secondary_identification"),this.detachElement("tertiary_identification"),(n=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"start_date"}),this.addEditFieldToColumn($.i18n._("Start Date"),n,r),(n=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"end_date"}),this.addEditFieldToColumn($.i18n._("End Date"),n,r),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",field:"contact_user_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn($.i18n._("Contact"),n,r,""),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIRemittanceSourceAccount,allow_multiple_selection:!1,layout_name:"global_remittance_source_account",field:"remittance_source_account_id",set_empty:!0,show_search_inputs:!0}),this.addEditFieldToColumn($.i18n._("Remittance Source Account"),n,r,""),(n=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"always_week_day_id"}),n.setSourceData(this.always_week_day_array),this.addEditFieldToColumn($.i18n._("Events Always On Business Day"),n,r),(n=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIRecurringHoliday,allow_multiple_selection:!0,layout_name:"global_recurring_holiday",show_search_inputs:!0,set_empty:!0,field:"recurring_holiday_policy_id"}),this.addEditFieldToColumn($.i18n._("Recurring Holidays"),n,r),this.detachElement("province"),this.detachElement("district")}setProvince(e,i){var t=this;e&&e!==TTUUID.not_exist_id&&e!==TTUUID.zero_id?this.company_api.getOptions("province",e,{async:!1,onResult:function(e){(e=e.getResult())||(e=[]),t.province_array=Global.buildRecordArray(e,{label:"-- "+$.i18n._("Other")+" --",value:"00",fullValue:"00",orderValue:-1,id:"00"}),t.adv_search_field_ui_dic.province.setSourceData(t.province_array),t.basic_search_field_ui_dic.province.setSourceData(t.province_array)}}):(t.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([]))}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Legal Entity"),in_column:1,field:"legal_entity_id",layout_name:"global_legal_entity",api_class:TTAPI.APILegalEntity,multiple:!0,basic_search:!0,adv_search:!0,script_name:"LegalEntityView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Created By"),in_column:3,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:3,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}initSubEventView(){var e=this;if(this.current_edit_record.id){if(this.sub_event_view_controller)return this.sub_event_view_controller.buildContextMenu(!0),this.sub_event_view_controller.setDefaultMenu(),e.sub_event_view_controller.parent_value=e.current_edit_record.id,e.sub_event_view_controller.parent_edit_record=e.current_edit_record,void e.sub_event_view_controller.initData();Global.loadScript("views/company/payroll_remittance_agency/PayrollRemittanceAgencyEventViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_payroll_remittance_agency_event").find(".first-column-sub-view");Global.trackView("SubPayrollRemittanceEventView"),PayrollRemittanceAgencyEventViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_event_view_controller=i,e.sub_event_view_controller.parent_key="payroll_remittance_agency_id",e.sub_event_view_controller.parent_value=e.current_edit_record.id,e.sub_event_view_controller.parent_edit_record=e.current_edit_record,e.sub_event_view_controller.parent_view_controller=e,e.sub_event_view_controller.postInit=function(){this.initData()}}}onCancelClick(){super.onCancelClick(),this.sub_event_view_controller=null}uniformVariable(e){if(e&&(super.collectUIDataToCurrentEditRecord(),this.is_add&&(e.id=!1),1!=this.is_mass_editing)){e.payroll_remittance_agency_id=this.parent_value,30==e.type_id&&e.district!=TTUUID.not_exist_id&&e.district!=TTUUID.zero_id&&0!=e.district&&null!=e.district||(e.district="00"),(e.type_id<=10||e.province==TTUUID.not_exist_id||e.province==TTUUID.zero_id||0==e.province||null==e.province)&&(e.province="00");var i="0000";e.agency_id&&(i=e.agency_id.slice(-4)),e.agency_id=e.type_id+":"+e.country+":"+e.province+":"+e.district+":"+i}return e}}}}]);
//# sourceMappingURL=company-payroll_remittance_agency-PayrollRemittanceAgencyViewController.bundle.js.map?v=d45d0019858c10772212