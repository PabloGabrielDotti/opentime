(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["company-companies-CompaniesViewController"],{8653:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"CompaniesViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#companies_view_container",status_array:null,country_array:null,province_array:null,e_province_array:null}),super(e)}init(e){this.edit_view_tpl="CompaniesEditView.html",this.permission_id="company",this.viewId="Companies",this.script_name="CompanyView",this.table_name_key="company",this.context_menu_name=$.i18n._("Companies"),this.navigation_label=$.i18n._("Companies")+":",this.api=TTAPI.APICompany,this.render(),this.buildContextMenu(),this.initData(),this.setSelectRibbonMenuIfNecessary()}initOptions(e){this.initDropDownOptions([{option_name:"status"},{option_name:"product_edition"},{option_name:"industry"},{option_name:"country",field_name:"country"},{option_name:"password_policy_type"},{option_name:"password_minimum_permission_level",field_name:"password_minimum_permission_level"},{option_name:"password_minimum_strength",field_name:"password_minimum_strength"},{option_name:"ldap_authentication_type"}],(function(i){e&&e(i)}))}onSetSearchFilterFinished(){var e;0===this.search_panel.getSelectTabIndex()?(e=this.basic_search_field_ui_dic.country.getValue(),this.setProvince(e)):1===this.search_panel.getSelectTabIndex()&&(e=this.adv_search_field_ui_dic.country.getValue(),this.setProvince(e))}onBuildAdvUIFinished(){this.adv_search_field_ui_dic.country.change($.proxy((function(){var e=this.adv_search_field_ui_dic.country.getValue();this.setProvince(e),this.adv_search_field_ui_dic.province.setValue(null)}),this))}onBuildBasicUIFinished(){this.basic_search_field_ui_dic.country.change($.proxy((function(){var e=this.basic_search_field_ui_dic.country.getValue();this.setProvince(e),this.basic_search_field_ui_dic.province.setValue(null)}),this))}onFormItemChange(e,i){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField(),a=e.getValue();switch(this.current_edit_record[t]=a,t){case"country":this.edit_view_ui_dic.province.setValue(null)}"ldap_authentication_type_id"===t&&this.onTypeChange(),"country"!==t?i||this.validate():this.onCountryChange()}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.mass_edit,ContextMenuIconName.copy],include:[{label:$.i18n._("Login"),id:ContextMenuIconName.login,group:"navigation",icon:Icons.login},{label:$.i18n._("Employees"),id:ContextMenuIconName.employee,group:"navigation",icon:Icons.employee}]}}setDefaultMenu(e){if(this.context_menu_array){super.setDefaultMenu(e);for(var i=this.context_menu_array.length,t=this.getGridSelectIdArray().length,a=0;a<i;a++){var o=$(this.context_menu_array[a]);switch($(o.find(".ribbon-sub-menu-icon")).attr("id")){case ContextMenuIconName.employee:this.setDefaultMenuEmployeeIcon(o,t)}}}}setEditMenu(e){super.setEditMenu(e);for(var i=this.context_menu_array.length,t=this.getGridSelectIdArray().length,a=0;a<i;a++){var o=$(this.context_menu_array[a]);switch($(o.find(".ribbon-sub-menu-icon")).attr("id")){case ContextMenuIconName.employee:this.setEditMenuEmployeeIcon(o,t)}}}setEditMenuEmployeeIcon(e,i){this.viewPermissionValidate("user")||e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuEmployeeIcon(e,i){this.viewPermissionValidate("user")||e.addClass("invisible-image"),1===i?e.removeClass("disable-image"):e.addClass("disable-image")}onCustomContextClick(e){switch(e){case ContextMenuIconName.login:this.onLoginClick();break;case ContextMenuIconName.employee:this.onEmployeeClick()}}onEmployeeClick(){var e={filter_data:{}},i={value:this.getGridSelectIdArray()[0]};e.filter_data.company_id=i,Global.addViewTab(this.viewId,$.i18n._("Companies"),window.location.href),IndexViewController.goToView("Employee",e)}onLoginClick(){var e={};e.company_id=this.getGridSelectIdArray()[0],LocalCacheData.extra_filter_for_next_open_view={},LocalCacheData.extra_filter_for_next_open_view.filter_data=e,IndexViewController.openWizard("LoginUserWizard",null,(function(e){Global.NewSession(e)}))}buildEditViewUI(){var e=this;super.buildEditViewUI();var i={"tab_company":{"label":$.i18n._("Company")},"tab_password_policy":{"label":$.i18n._("Password Policy")},"tab_ldap":{"label":$.i18n._("LDAP Authentication")},"tab_audit":!0};this.setTabModel(i);var t,a,o,n=this.edit_view_tab.find("#tab_company"),d=n.find(".first-column"),l=n.find(".second-column");this.navigation.AComboBox({api_class:TTAPI.APICompany,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_company",navigation_mode:!0,show_search_inputs:!0}),this.setNavigation(),this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(d),this.edit_view_tabs[0].push(l),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"status_id"}),t.setSourceData(e.status_array),this.addEditFieldToColumn($.i18n._("Status"),t,d,""),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"product_edition_id"}),t.setSourceData(e.product_edition_array),this.addEditFieldToColumn($.i18n._("Product Edition"),t,d),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"name",width:"100%"}),this.addEditFieldToColumn($.i18n._("Full Name"),t,d),t.parent().width("45%"),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"short_name",width:128}),this.addEditFieldToColumn($.i18n._("Short Name"),t,d),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"industry_id"}),t.setSourceData(e.industry_array),this.addEditFieldToColumn($.i18n._("Industry"),t,d),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address1",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 1)"),t,d),t.parent().width("45%"),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"address2",width:"100%"}),this.addEditFieldToColumn($.i18n._("Address (Line 2)"),t,d),t.parent().width("45%"),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"city",width:149}),this.addEditFieldToColumn($.i18n._("City"),t,d),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"country",set_empty:!0}),t.setSourceData(e.country_array),this.addEditFieldToColumn($.i18n._("Country"),t,d),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"province"}),t.setSourceData([]),this.addEditFieldToColumn($.i18n._("Province/State"),t,d),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"postal_code",width:149}),this.addEditFieldToColumn($.i18n._("Postal/ZIP Code"),t,d,""),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"work_phone",width:149}),this.addEditFieldToColumn($.i18n._("Phone"),t,l,""),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"fax_phone",width:149}),this.addEditFieldToColumn($.i18n._("Fax"),t,l),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"admin_contact",customSearchFilter:function(i){return e.setCompanyIdFilter(i)}}),this.addEditFieldToColumn($.i18n._("Administrative Contact"),t,l),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"billing_contact",customSearchFilter:function(i){return e.setCompanyIdFilter(i)}}),this.addEditFieldToColumn($.i18n._("Billing Contact"),t,l),(t=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"support_contact",customSearchFilter:function(i){return e.setCompanyIdFilter(i)}}),this.addEditFieldToColumn($.i18n._("Primary Support Contact"),t,l);var s=this.edit_view_tab.find("#tab_password_policy").find(".first-column");this.edit_view_tabs[1]=[],this.edit_view_tabs[1].push(s),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_policy_type_id"}),t.setSourceData(e.password_policy_type_array),this.addEditFieldToColumn($.i18n._("Password Policy"),t,s,""),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_minimum_permission_level"}),t.setSourceData(e.password_minimum_permission_level_array),this.addEditFieldToColumn($.i18n._("Minimum Permission Level"),t,s),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"password_minimum_strength"}),t.setSourceData(e.password_minimum_strength_array),this.addEditFieldToColumn($.i18n._("Minimum Strength"),t,s),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_minimum_length",width:30}),this.addEditFieldToColumn($.i18n._("Minimum Length"),t,s),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_minimum_age",width:30}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("in Days")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Minimum Age"),t,s,"",a),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"password_maximum_age",width:30}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("in Days")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Maximum Age"),t,s,"",a);var r=this.edit_view_tab.find("#tab_ldap").find(".first-column");this.edit_view_tabs[2]=[],this.edit_view_tabs[2].push(r),(t=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"ldap_authentication_type_id"}),t.setSourceData(e.ldap_authentication_type_array),this.addEditFieldToColumn($.i18n._("LDAP Authentication"),t,r),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_host",width:240}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: ldap.example.com or ldaps://ldap.example.com for SSL)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Server"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_port",width:50}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: 389 or 636 for SSL)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Port"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_user_name"}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("Used to search for the user, for anonymous binding enter: anonymous")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Bind User Name"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_password"}),this.addEditFieldToColumn($.i18n._("Bind Password"),t,r,"",null,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_base_dn",width:300}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("(ie: ou=People,dc=example,dc=com)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Base DN"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_bind_attribute",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("For binding the LDAP user. (ie: AD/openLDAP: userPrincipalName, Mac OSX: uid)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Bind Attribute"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_user_filter",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("Additional filter parameters. (ie: is_timetrex_user=1)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("User Filter"),t,r,"",a,!0),(t=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"ldap_login_attribute",width:150}),a=$("<div class='widget-h-box'></div>"),o=$("<span class='widget-right-label'> "+$.i18n._("For searching the LDAP user. (ie: AD: sAMAccountName, openLDAP: dn, Mac OSX: dn)")+"</span>"),a.append(t),a.append(o),this.addEditFieldToColumn($.i18n._("Login Attribute"),t,r,"",a,!0)}setCompanyIdFilter(e){var i=this.current_edit_record.id;return i||(i=-1),e?e.filter_data?e.filter_data.company_id=i:e.filter_data={company_id:i}:e={filter_data:{company_id:i}},e}setCurrentEditRecordData(){for(var e in this.current_edit_record){var i=this.edit_view_ui_dic[e];if(Global.isSet(i))switch(e){case"country":this.setCountryValue(i,e);break;default:i.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(){0==this.current_edit_record.ldap_authentication_type_id?(this.detachElement("ldap_host"),this.detachElement("ldap_port"),this.detachElement("ldap_bind_user_name"),this.detachElement("ldap_bind_password"),this.detachElement("ldap_base_dn"),this.detachElement("ldap_bind_attribute"),this.detachElement("ldap_user_filter"),this.detachElement("ldap_login_attribute")):(this.attachElement("ldap_host"),this.attachElement("ldap_port"),this.attachElement("ldap_bind_user_name"),this.attachElement("ldap_bind_password"),this.attachElement("ldap_base_dn"),this.attachElement("ldap_bind_attribute"),this.attachElement("ldap_user_filter"),this.attachElement("ldap_login_attribute")),this.editFieldResize()}setProvince(e,i){var t=this;e&&"-1"!==e&&"0"!==e?this.api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),t.province_array=Global.buildRecordArray(e),t.adv_search_field_ui_dic.province.setSourceData(t.province_array),t.basic_search_field_ui_dic.province.setSourceData(t.province_array)}}):(t.province_array=[],this.adv_search_field_ui_dic.province.setSourceData([]),this.basic_search_field_ui_dic.province.setSourceData([]))}eSetProvince(e,i){var t=this,a=t.edit_view_ui_dic.province;e&&"-1"!==e&&"0"!==e?this.api.getOptions("province",e,{onResult:function(e){(e=e.getResult())||(e=[]),t.e_province_array=Global.buildRecordArray(e),i&&t.e_province_array.length>0&&(t.current_edit_record.province=t.e_province_array[0].value,a.setValue(t.current_edit_record.province)),a.setSourceData(t.e_province_array)}}):(t.e_province_array=[],a.setSourceData([]))}buildSearchFields(){super.buildSearchFields(),this.search_fields=[new SearchField({label:$.i18n._("Name"),in_column:1,field:"name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Short Name"),in_column:1,field:"short_name",multiple:!0,basic_search:!0,adv_search:!0,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Status"),in_column:1,field:"status_id",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Product Edition"),in_column:1,field:"product_edition_id",multiple:!0,basic_search:!1,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Country"),in_column:2,field:"country",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.COMBO_BOX}),new SearchField({label:$.i18n._("Province/State"),in_column:2,field:"province",multiple:!0,basic_search:!0,adv_search:!0,layout_name:"global_option_column",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("City"),field:"city",basic_search:!0,adv_search:!0,in_column:2,form_item_type:FormItemType.TEXT_INPUT}),new SearchField({label:$.i18n._("Created By"),in_column:2,field:"created_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX}),new SearchField({label:$.i18n._("Updated By"),in_column:2,field:"updated_by",layout_name:"global_user",api_class:TTAPI.APIUser,multiple:!0,basic_search:!1,adv_search:!0,script_name:"EmployeeView",form_item_type:FormItemType.AWESOME_BOX})]}}}}]);
//# sourceMappingURL=company-companies-CompaniesViewController.bundle.js.map?v=bc0a07cd8459b572efa7