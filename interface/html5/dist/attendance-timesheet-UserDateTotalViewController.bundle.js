(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["attendance-timesheet-UserDateTotalViewController"],{827:(e,t,i)=>{"use strict";i.r(t),i.d(t,{"UserDateTotalViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#user_date_total_view_container"}),super(e)}init(e){this.edit_view_tpl="UserDateTotalEditView.html",this.permission_id="user_date_total",this.script_name="UserDateTotalView",this.viewId="UserDateTotal",this.table_name_key="user_date_total",this.context_menu_name=$.i18n._("Accumulated Time"),this.navigation_label=$.i18n._("Accumulated Time")+":",this.api=TTAPI.APIUserDateTotal,this.currency_api=TTAPI.APICurrency,PermissionManager.validate(this.permission_id,"add")||PermissionManager.validate(this.permission_id,"edit")?$(this.el).find(".warning-message").text($.i18n._("WARNING: Manually modifying Accumulated Time records may prevent policies from being calculated properly and should only be done as a last resort when instructed to do so by a support representative.")):$(this.el).find(".warning-message").hide(),this.initPermission(),this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary()}setGridSize(){var e=2*$(this.el).find(".warning-message").outerHeight()+27;this.grid.grid.setGridHeight($(this.el).parents("#tab_user_date_total_parent").height()-e)}setGridCellBackGround(){var e=this.grid.getGridParam("data");if(e)for(var t=e.length,i=0;i<t;i++){var a=e[i];!0===a.is_override&&$("tr[id='"+a.id+"']").addClass("user-data-total-override")}}initOptions(){this.initDropDownOption("object_type")}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.copy,ContextMenuIconName.export_excel],include:["default"]}}onFormItemChange(e,t){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var i=e.getField(),a=e.getValue();switch(this.current_edit_record[i]=a,i){case"object_type_id":this.onTypeChange(!0);break;case"regular_policy_id":case"absence_policy_id":case"overtime_policy_id":case"premium_policy_id":case"break_policy_id":case"meal_policy_id":this.current_edit_record.src_object_id=a,delete this.current_edit_record[i],this.onSrcObjectChange(i);break;case"total_time":0==this.current_edit_record.total_time&&(this.edit_view_ui_dic.start_time_stamp.setValue(""),this.edit_view_ui_dic.end_time_stamp.setValue(""),this.current_edit_record.start_time_stamp="",this.current_edit_record.end_time_stamp="",this.edit_view_form_item_dic.start_time_stamp.find("input").trigger("change",""),this.edit_view_form_item_dic.end_time_stamp.find("input").trigger("change","")),this.calculateAmount();break;case"hourly_rate":this.calculateAmount()}"override"!==i&&(this.edit_view_ui_dic.override.setValue(!0),this.current_edit_record.override=!0,this.edit_view_form_item_dic.override.find("input").trigger("change","1")),t||this.validate()}calculateAmount(){this.current_edit_record.total_time_amount=this.current_edit_record.total_time/3600*parseFloat(this.current_edit_record.hourly_rate),this.edit_view_ui_dic.total_time_amount.setValue(this.current_edit_record.total_time_amount.toFixed(4))}onAddClick(){var e=this;this.setCurrentEditViewState("new"),e.openEditView(),e.api&&e.api["get"+e.api.key_name+"DefaultData"](this.parent_edit_record.user_id,this.parent_edit_record.date_stamp,{onResult:function(t){e.onAddResult(t)}})}onAddResult(e){var t=this,i=e.getResult();i||(i=[]),i.company=LocalCacheData.current_company.name,t.sub_view_mode&&t.parent_key&&(i[t.parent_key]=t.parent_value),i.date_stamp||(i.date_stamp=this.parent_edit_record.date_stamp),t.current_edit_record=i,t.initEditView()}setDefaultMenu(e){if(this.context_menu_array){Global.isSet(e)&&e||this.selectContextMenu(),this.setTotalDisplaySpan();for(var t=this.context_menu_array.length,i=this.getGridSelectIdArray().length,a=0;a<t;a++){var o=$(this.context_menu_array[a]),d=$(o.find(".ribbon-sub-menu-icon")).attr("id");switch(o.removeClass("invisible-image"),o.removeClass("disable-image"),d){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(o,i);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(o,i);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(o,i);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(o,i);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(o,i);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(o,i);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(o,i);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(o,i);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(o,i);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(o,i);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(o,i);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(o,i);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(o,i);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(o,i)}}this.setContextMenuGroupVisibility()}}initPermission(){super.initPermission(),this.jobUIValidate()?this.show_job_ui=!0:this.show_job_ui=!1,this.jobItemUIValidate()?this.show_job_item_ui=!0:this.show_job_item_ui=!1,this.branchUIValidate()?this.show_branch_ui=!0:this.show_branch_ui=!1,this.departmentUIValidate()?this.show_department_ui=!0:this.show_department_ui=!1,this.goodQuantityUIValidate()?this.show_good_quantity_ui=!0:this.show_good_quantity_ui=!1,this.badQuantityUIValidate()?this.show_bad_quantity_ui=!0:this.show_bad_quantity_ui=!1,this.noteUIValidate()?this.show_note_ui=!0:this.show_note_ui=!1}noteUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_note")}branchUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_branch")}departmentUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_department")}jobUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate("job","enabled")||!PermissionManager.validate(e,"edit_job"))}jobItemUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_job_item")}goodQuantityUIValidate(e){return e||(e="punch"),!!PermissionManager.validate(e,"edit_quantity")}badQuantityUIValidate(e){return e||(e="punch"),!(!PermissionManager.validate(e,"edit_quantity")||!PermissionManager.validate(e,"edit_bad_quantity"))}setCurrency(){if(Global.isSet(this.current_edit_record.user_id)){var e={};e.filter_data={user_id:this.current_edit_record.user_id},this.currency_api.getCurrency(e,!1,!1,{onResult:function(e){e=e.getResult(),Global.isArray(e)?($(".userDateTotal-currency").text(e[0].symbol),$(".userDateTotal-code").text(e[0].iso_code)):($(".userDateTotal-currency").text(""),$(".userDateTotal-code").text(""))}})}}setCurrentEditRecordData(){for(var e in this.setCurrency(),this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var t=this.edit_view_ui_dic[e];switch(e){case"user_id":var i=this.edit_view_ui_dic.first_last_name;TTAPI.APIUser.getUser({filter_data:{id:this.current_edit_record[e]}},{onResult:function(e){if(e.isValid())var t=e.getResult()[0];t&&t.first_name?i.setValue(t.first_name+" "+t.last_name):i.setValue("")}});break;case"date_stamp":t.setEnabled(!1),t.setValue(this.current_edit_record[e]);break;default:t&&t.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setEditViewDataDone(){super.setEditViewDataDone(),this.onTypeChange()}onTypeChange(e){this.detachElement("regular_policy_id"),this.detachElement("absence_policy_id"),this.detachElement("overtime_policy_id"),this.detachElement("premium_policy_id"),this.detachElement("meal_policy_id"),this.detachElement("break_policy_id");var t="";20==this.current_edit_record.object_type_id?t="regular_policy_id":25==this.current_edit_record.object_type_id||50==this.current_edit_record.object_type_id?t="absence_policy_id":30==this.current_edit_record.object_type_id?t="overtime_policy_id":40==this.current_edit_record.object_type_id?t="premium_policy_id":100==this.current_edit_record.object_type_id||101==this.current_edit_record.object_type_id?t="meal_policy_id":110!=this.current_edit_record.object_type_id&&111!=this.current_edit_record.object_type_id||(t="break_policy_id"),t?(this.attachElement(t),e?(this.edit_view_ui_dic[t].setValue(""),this.edit_view_ui_dic.pay_code_id.setValue(""),this.current_edit_record.src_object_id=!1,this.current_edit_record.pay_code_id=!1,this.edit_view_ui_dic.pay_code_id.setEnabled(!0)):this.current_edit_record.src_object_id&&(this.edit_view_ui_dic[t].setValue(this.current_edit_record.src_object_id),this.edit_view_ui_dic.pay_code_id.setEnabled(!1))):(this.edit_view_ui_dic.pay_code_id.setEnabled(!0),this.current_edit_record.src_object_id=!1),this.editFieldResize()}onSrcObjectChange(e){var t=this.edit_view_ui_dic[e].getValue(!0);t&&t.pay_code_id?(this.edit_view_ui_dic.pay_code_id.setEnabled(!1),this.edit_view_ui_dic.pay_code_id.setValue(t.pay_code_id),this.current_edit_record.pay_code_id=t.pay_code_id):(this.edit_view_ui_dic.pay_code_id.setEnabled(!0),this.edit_view_ui_dic.pay_code_id.setValue(""),this.current_edit_record.pay_code_id=!1)}search(e,t,i,a){this.refresh_id=null,super.search(e,t,i,a)}getProperObjectType(){for(var e=[],t=0;t<this.object_type_array.length;t++){var i=this.object_type_array[t];20!=i.value&&25!=i.value&&30!=i.value&&40!=i.value&&100!=i.value&&110!=i.value||e.push(i)}return e}buildEditViewUI(){super.buildEditViewUI();var e,t,i={"tab_user_date_total":{"label":$.i18n._("Accumulated Time")},"tab_audit":!0};this.setTabModel(i),this.navigation.AComboBox({api_class:TTAPI.APIUserDateTotal,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var a=this.edit_view_tab.find("#tab_user_date_total"),o=a.find(".first-column"),d=a.find(".second-column");if((e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"first_last_name"}),this.addEditFieldToColumn($.i18n._("Employee"),e,o,""),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"date_stamp"}),this.addEditFieldToColumn($.i18n._("Date"),e,o),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"total_time",mode:"time_unit",need_parser_sec:!0}),this.addEditFieldToColumn($.i18n._("Time"),e,o,"",null,!0),(e=Global.loadWidgetByName(FormItemType.COMBO_BOX)).TComboBox({field:"object_type_id"}),e.setSourceData(this.getProperObjectType()),this.addEditFieldToColumn($.i18n._("Type"),e,o),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIRegularTimePolicy,allow_multiple_selection:!1,layout_name:"global_regular_time",show_search_inputs:!0,set_empty:!0,field:"regular_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("regular_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIAbsencePolicy,allow_multiple_selection:!1,layout_name:"global_absences",show_search_inputs:!0,set_empty:!0,field:"absence_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("absence_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIOverTimePolicy,allow_multiple_selection:!1,layout_name:"global_over_time",show_search_inputs:!0,set_empty:!0,field:"overtime_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("overtime_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPremiumPolicy,allow_multiple_selection:!1,layout_name:"global_premium",show_search_inputs:!0,set_empty:!0,field:"premium_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("premium_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIMealPolicy,allow_multiple_selection:!1,layout_name:"global_meal",show_search_inputs:!0,set_empty:!0,field:"meal_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("meal_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBreakPolicy,allow_multiple_selection:!1,layout_name:"global_break",show_search_inputs:!0,set_empty:!0,field:"break_policy_id"}),this.addEditFieldToColumn($.i18n._("Policy"),e,o,null,null,!0),this.detachElement("break_policy_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIPayCode,allow_multiple_selection:!1,layout_name:"global_pay_code",show_search_inputs:!0,set_empty:!0,field:"pay_code_id"}),this.addEditFieldToColumn($.i18n._("Pay Code"),e,o),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIBranch,allow_multiple_selection:!1,layout_name:"global_branch",show_search_inputs:!0,set_empty:!0,field:"branch_id"}),this.addEditFieldToColumn($.i18n._("Branch"),e,o,"",null,!0),this.show_branch_ui||this.detachElement("branch_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIDepartment,allow_multiple_selection:!1,layout_name:"global_department",show_search_inputs:!0,set_empty:!0,field:"department_id"}),this.addEditFieldToColumn($.i18n._("Department"),e,o,"",null,!0),this.show_department_ui||this.detachElement("department_id"),Global.getProductEdition()>=20){(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJob,allow_multiple_selection:!1,layout_name:"global_job",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&l.setValue(e.manual_id)},field:"job_id"}),t=$("<div class='widget-h-box'></div>");var l=Global.loadWidgetByName(FormItemType.TEXT_INPUT);l.TTextInput({field:"job_quick_search",disable_keyup_event:!0}),l.addClass("job-coder"),t.append(l),t.append(e),this.addEditFieldToColumn($.i18n._("Job"),[e,l],o,"",t,!0),this.show_job_ui||this.detachElement("job_id"),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIJobItem,allow_multiple_selection:!1,layout_name:"global_job_item",show_search_inputs:!0,set_empty:!0,setRealValueCallBack:function(e){e&&s.setValue(e.manual_id)},field:"job_item_id"}),t=$("<div class='widget-h-box'></div>");var s=Global.loadWidgetByName(FormItemType.TEXT_INPUT);s.TTextInput({field:"job_item_quick_search",disable_keyup_event:!0}),s.addClass("job-coder"),t.append(s),t.append(e),this.addEditFieldToColumn($.i18n._("Task"),[e,s],o,"",t,!0),this.show_job_item_ui||this.detachElement("job_item_id")}(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"start_time_stamp",mode:"date_time"}),this.addEditFieldToColumn($.i18n._("Start Date/Time"),e,d,"",null,!0,!0),(e=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"end_time_stamp",mode:"date_time"}),this.addEditFieldToColumn($.i18n._("End Date/Time"),e,d,"",null,!0,!0),(e=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APICurrency,allow_multiple_selection:!1,layout_name:"global_currency",show_search_inputs:!0,field:"currency_id",set_empty:!0}),this.addEditFieldToColumn($.i18n._("Currency"),e,d),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"base_hourly_rate",width:90}),t=$("<div class='widget-h-box'></div>");var _=$("<span class='userDateTotal-currency widget-left-label'></span>"),n=$("<span class='userDateTotal-code widget-right-label'></span>");if(t.append(_),t.append(e),t.append(n),this.addEditFieldToColumn($.i18n._("Base Hourly Rate"),e,d,"",t,!0),(e=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"hourly_rate",width:90}),t=$("<div class='widget-h-box'></div>"),_=$("<span class='userDateTotal-currency widget-left-label'></span>"),n=$("<span class='userDateTotal-code widget-right-label'></span>"),t.append(_),t.append(e),t.append(n),this.addEditFieldToColumn($.i18n._("Hourly Rate"),e,d,"",t,!0),(e=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"total_time_amount"}),t=$("<div class='widget-h-box'></div>"),_=$("<span class='userDateTotal-currency widget-left-label'></span>"),n=$("<span class='userDateTotal-code widget-right-label'></span>"),t.append(_),t.append(e),t.append(n),this.addEditFieldToColumn($.i18n._("Total Amount"),e,d,"",t,!0),Global.getProductEdition()>=20){var r=Global.loadWidgetByName(FormItemType.TEXT_INPUT);r.TTextInput({field:"quantity",width:50}),r.addClass("quantity-input");var c=$("<span class='widget-right-label'>"+$.i18n._("Good")+": </span>"),u=Global.loadWidgetByName(FormItemType.TEXT_INPUT);u.TTextInput({field:"bad_quantity",width:50}),u.addClass("quantity-input");var m=$("<span class='widget-right-label'>/ "+$.i18n._("Bad")+": </span>");(t=$("<div class='widget-h-box'></div>")).append(c),t.append(r),t.append(m),t.append(u),this.addEditFieldToColumn($.i18n._("Quantity"),[r,u],d,"",t,!0),this.show_bad_quantity_ui||this.show_good_quantity_ui?(this.show_bad_quantity_ui||(m.hide(),u.hide()),this.show_good_quantity_ui||(c.hide(),r.hide())):this.detachElement("quantity")}(e=Global.loadWidgetByName(FormItemType.TEXT_AREA)).TTextArea({field:"note",width:"100%"}),this.addEditFieldToColumn($.i18n._("Note"),e,d,"",null,!0,!0),e.parent().width("45%"),this.show_note_ui||this.detachElement("note"),(e=Global.loadWidgetByName(FormItemType.CHECKBOX)).TCheckbox({field:"override"}),this.addEditFieldToColumn($.i18n._("Override"),e,d,"",null,!0,!0)}cleanWhenUnloadView(e){$("#user_date_total_view_container").remove(),super.cleanWhenUnloadView(e)}}a.loadView=function(e){Global.loadViewSource("UserDateTotal","UserDateTotalView.html",(function(t){var i={},a=_.template(t);Global.isSet(e)?e.html(a(i)):Global.contentContainer().html(a(i))}))},a.loadSubView=function(e,t,i){Global.loadViewSource("UserDateTotal","SubUserDateTotalView.html",(function(a){var o=_.template(a);Global.isSet(t)&&t(),Global.isSet(e)&&(e.html(o({})),Global.isSet(i)&&TTPromise.wait("BaseViewController","initialize",(function(){i(sub_user_date_total_view_controller)})))}))}}}]);
//# sourceMappingURL=attendance-timesheet-UserDateTotalViewController.bundle.js.map?v=c54408014652067f8d51