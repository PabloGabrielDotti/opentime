(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["ttgrid-TTGrid"],{2185:()=>{TTGrid=function(i,t,e){if(this.getGridId=function(){return this.ui_id},this.setTableIDElement=function(){return this.table_id_element=$("#"+this.ui_id),!0},this.getTableIDElement=function(){return this.table_id_element},i&&t&&e){if(this.ui_id=i,!t.container_selector)for(var r=LocalCacheData.resizeable_grids.length-1;r>=0;r--)null!=LocalCacheData.resizeable_grids[r]&&null!=LocalCacheData.resizeable_grids[r].grid&&LocalCacheData.resizeable_grids[r].ui_id==this.ui_id?(LocalCacheData.resizeable_grids[r].grid.jqGrid("GridUnload"),LocalCacheData.resizeable_grids.splice(r,1)):null!=LocalCacheData.resizeable_grids[r]&&null!=LocalCacheData.resizeable_grids[r].grid||LocalCacheData.resizeable_grids.splice(r,1);this.setTableIDElement();var d=this.getTableIDElement();if(this.grid=null,0!=d[0]){var s={container_selector:"body",sub_grid_mode:!1,altRows:!0,data:[],datatype:"local",sortable:!1,height:d.parents(".view").height(),width:d.parent().width(),rowNum:1e4,colNames:[],colModel:e,multiselect:!0,multiselectWidth:22,multiboxonly:!0,viewrecords:!0,autoencode:!0,scrollOffset:0,verticalResize:!0,resizeGrid:!0,winMultiSelect:!0};!0===t.max_height&&(t.max_height=null),t=t?$.extend({},s,t):s,this.setup=t,d.empty(),this.grid=d.jqGrid(t),LocalCacheData.resizeable_grids.push(this),!0===t.winMultiSelect&&this.grid.winMultiSelect(),this.noResize=function(){this.setup.onResizeGrid=!1},this.setData=function(i,t){if(!this.grid)throw"ERROR: Grid is not ready yet.";1==(t=null==t||t)&&this.grid.clearGridData(),this.grid.setGridParam({"data":i}).trigger("reloadGrid")},this.getData=function(){return this.getGridParam("data")},this.getSetup=function(){return this.getGridParam("data")},this.getHeight=function(){return $(this.grid).height()},this.getWidth=function(){return $(this.grid).width()},this.deleteRow=function(i){this.grid.jqGrid("delRowData",i)},this.resetSelection=function(){this.grid.resetSelection()},this.setSelection=function(i,t,e,r,d){this.grid.setSelection(i,t,e,r,d)},this.getGridParam=function(i){return this.grid.getGridParam(i)},this.setGridParam=function(i,t){return this.grid.setGridParam(i,t)},this.unload=function(){return this.grid&&(this.grid.jqGrid("GridUnload"),this.grid=null),!0},this.clearGridData=function(){this.grid.jqGrid("clearGridData",!0)},this.reloadGrid=function(){this.grid.trigger("reloadGrid")},this.getRecordFromGridById=function(i){var t=this.grid.getGridParam("data"),e=null;return $.each(t,(function(t,r){if(r._id_==i)return e=Global.clone(r),!1})),e&&(e.id=e._id_),e},this.getGridWidth=function(){return this.grid?this.grid.width():0},this.setGridWidth=function(i,t){this.grid&&(t>i&&(i=t),this.grid.setGridWidth(i))},this.getGridHeight=function(){return this.grid?this.grid.height():0},this.setGridHeight=function(i){this.setup.static_height&&(i=this.setup.static_height),this.grid&&this.grid.setGridHeight(i)},this.setRowData=function(i,t){this.grid.setRowData(i,t)},this.getRowData=function(i){var t=!1,e=this.getData();for(var r in e)if(e[r].id==i){t=e[r];break}return t},this.getColumnModel=function(){return this.getGridParam("colModel")},this.setColumnModel=function(i){this.getGridParam("colModel",i)},this.grid2csv=function(i){let t=[],e=1,r=[];for(let n of document.querySelectorAll("#"+this.getGridId()+" tr")){let i=[];for(let t of n.querySelectorAll("td"))if(i.push('"'+t.textContent.trim()+'"'),2===e){let i=document.createElement("div");i.innerHTML=document.getElementById(t.getAttribute("aria-describedby")).innerHTML.replace("<br>"," "),r.push('"'+i.textContent.trim()+'"')}t.push(i.join(",")),e++}t[0]=r.join(",");let d=t.join("\r\n");Global.JSFileDownload(i+".csv",d,"text/csv;encoding:utf-8")},this.getRecordCount=function(){return!!this.grid&&this.grid.getGridParam("reccount")},this.getSelectedRow=function(){if(!this.grid)return!1;var i=this.grid.getGridParam("selrow");return i||(i=!1),i},this.getSelectedRows=function(){if(!this.grid)return[];var i=this.grid.getGridParam("selarrrow");return i||(i=[]),i},this.getSelection=function(){for(var i=this.grid.find("td.ui-state-highlight"),t=[],e=0;e<i.length;e++)t.push({tr:$(i[e]).parent("tr").index(),td:$(i[e]).index()});return t},this.setTimesheetSelection=function(i){for(var t=this.grid.find("tr"),e=0;e<i.length;e++)for(var r=0;r<t.length;r++)if($(t[r]).index()==i[e].tr){for(var d=$(t[r]).find("td"),n=0;n<d.length;n++)if($(d[n]).index()==i[e].td){$(d[n]).addClass("ui-state-highlight");break}break}},this.setGridColumnsWidth=function(i,t){if(this.setup.treeGrid||this.setup.tree_mode)this.setGridWidth($(this.setup.container_selector).width()-12);else{if(void 0===t&&(t={}),this.setup.container_selector&&(!t.min_grid_width||0==t.min_grid_width)){var e=this.grid.parents(this.setup.container_selector).find(".edit-view-tab");if(e.length>0){if(!0!==e.is(":visible"))return void Debug.Text("  Parent container of grid is not visible, skip setting column widths...","TTGrid.js","TTGrid","setGridColumnsWidth",10);t.min_grid_width=e.innerWidth()}else t.min_grid_width=this.grid.parents(this.setup.container_selector).innerWidth()}0!=t.min_grid_width&&"undefined"!=t.min_grid_width||(t.min_grid_width=$("body").innerWidth());var r=this.grid.parents(".ui-jqgrid-bdiv").length>0&&Math.ceil(this.grid.parents(".ui-jqgrid-bdiv").height())<Math.ceil(this.grid.parents(".ui-jqgrid-bdiv")[0].scrollHeight)?15:0;if(t.min_grid_width=t.min_grid_width-r,t.max_grid_width||(t.max_grid_width=null),t.max_grid_width&&t.max_grid_width<t.min_grid_width&&(t.min_grid_width=t.max_grid_width),Debug.Text("Target Grid: "+this.setup.container_selector+" Target Div: "+this.grid.parents(this.setup.container_selector).id+" Width: Min: "+t.min_grid_width+" Max: "+t.max_grid_width+" Scrollbar Offset: "+r+" Parent Width: "+$(this.grid.parents(".edit-view-tab, body")[0]).width(),"TTGrid.js","TTGrid","setGridColumnsWidth",10),i){for(var d=0,s=0;s<i.length;s++){var a=i[s].name;d+=p=i[s].width?i[s].width:i.widthOrg,this.grid.getColProp(a).width!=p&&this.grid.setColWidth(a,p)}return d}if(i=this.getColumnModel()){var h=this.getData();this.grid_total_width=0;var o,l=0,g=0,u=0,c={};for(s=0;s<i.length;s++){var _=i[s];_;a=_.name;var m=(o=_.label)?o.split(" ").reduce(y):"",G=!0;if("cb"==a)g=1,p=l=22;else if(t.column_width_override&&t.column_width_override[a])p=t.column_width_override[a];else{for(var f=0;f<h.length;f++){var T=h[f];if(!T.hasOwnProperty(a))break;var w=T[a];w||(w=""),m?w&&w.toString().length>m.length&&(m=w.toString(),G=!1):(m=w.toString(),G=!1)}var b;b=m==a?{fontSize:"11px",fontWeight:"bolder"}:{fontSize:"11px",fontWeight:"normal"};var p=Global.calculateTextWidth(m,b);p+=!0===G?40:12}p>u&&(u=p),c[a]=p,this.grid_total_width+=p}if(u*i.length<=t.min_grid_width){var C=Math.floor((t.min_grid_width-l)/(i.length-g)),v=(t.min_grid_width-l)%(i.length-g);Debug.Text(" Grid columns CAN fit with equal sizes... Grid Width: "+t.min_grid_width+" Optimal Grid Width: "+this.grid_total_width+" Equal Size Width: "+C+" Remainder: "+v,"TTGrid.js","TTGrid","setGridColumnsWidth",10);var D=0,W=0;for(var x in c){if("cb"==x)this.grid.setColWidth("cb",l),D+=l;else{var z=C;1==W&&(z+=v),this.grid.getColProp(x).width!=z&&this.grid.setColWidth(x,z),D+=z}this.grid.setColProp(x,"fixed",!0),W++}Debug.Text(" Adjusted Grid Width: "+D+" Adjusted Column Remainder: "+v,"TTGrid.js","TTGrid","setGridColumnsWidth",10),this.grid_total_width=t.min_grid_width}else{Debug.Text(" Optimal Grid Width: "+this.grid_total_width+" Equal Size Width: "+u*i.length,"TTGrid.js","TTGrid","setGridColumnsWidth",10);var R=0,j=0,L=0,S=0;(t.max_grid_width>0&&this.grid_total_width>t.max_grid_width||t.min_grid_width>0&&this.grid_total_width<t.min_grid_width)&&(t.max_grid_width>0&&this.grid_total_width>t.max_grid_width?(R=this.grid_total_width-t.max_grid_width,this.grid_total_width=t.max_grid_width):(R=t.min_grid_width-this.grid_total_width,this.grid_total_width=t.min_grid_width),0!=R&&(L=t.column_width_override?i.length-t.column_width_override.length():i.length-g,j=Math.floor(R/L),S=R%L));D=0,W=0;for(var x in c){if("cb"==x)this.grid.setColWidth("cb",l),D+=l;else z=t.column_width_override&&t.column_width_override[n]?c[x]:c[x]+j,1==W&&(z+=S),Debug.Text("    Adjusted Column: "+x+" Width: Old: "+c[x]+" New: "+z+" Adjustment: "+j+" Body Difference: "+R+" Columns Adjusted: "+L,"TTGrid.js","TTGrid","setGridColumnsWidth",10),this.grid.getColProp(x).width!=z&&this.grid.setColWidth(x,z),D+=z;this.grid.setColProp(x,"fixed",!0),W++}}return Debug.Text(" FINAL Grid width: "+this.grid_total_width+" Body Width: "+Global.bodyWidth()+" Total Rows: "+h.length,"TTGrid.js","TTGrid","setGridColumnsWidth",10),this.grid_total_width}Debug.Text("ERROR: column_model is null or undefined","TTGrid.js","TTGrid","setGridColumnsWidth",10)}function y(i,t){return t.length>i.length?t:i}},$("#contentContainer").off("resize").on("resize",Global.debounce((function(i){if(i.stopPropagation(),Debug.Text(" Window resize event hit by TTGrid. Target: "+i.target,"TTGrid.js","TTGrid","setGridColumnsWidth",10),LocalCacheData.resizeable_grids.length>0){var t=LocalCacheData.resizeable_grids.filter((function(i){return null!=i}));for(var e in LocalCacheData.resizeable_grids=t,LocalCacheData.resizeable_grids){var r=LocalCacheData.resizeable_grids[e];r&&("function"!=typeof r.getTableIDElement||0!==r.getTableIDElement().length)&&r.grid&&!1!==r.setup.onResizeGrid?r.getTableIDElement().is(":visible")?(Debug.Text(" Processing: "+r.ui_id,"TTGrid.js","TTGrid","setGridColumnsWidth",10),r.setup.onResizeGrid&&"function"==typeof r.setup.onResizeGrid?(Debug.Text(" TTGrid invoked setup defined onResizeGrid() for "+r.ui_id,"TTGrid.js","TTGrid","setGridColumnsWidth",10),r.setup.onResizeGrid()):1==r.grid.length&&(Debug.Text(" TTGrid invoked TTgrid::setGridColumnsWidth() for "+r.ui_id,"TTGrid.js","TTGrid","setGridColumnsWidth",10),r.setGridColumnsWidth())):Debug.Text(" Skipping grid that is not visible: "+r.ui_id,"TTGrid.js","TTGrid","setGridColumnsWidth",10):(Debug.Arr(LocalCacheData.resizeable_grids," Grid ignored "+e,"TTGrid.js","TTGrid","setGridColumnsWidth",10),LocalCacheData.resizeable_grids[e]=null)}LocalCacheData.current_open_primary_controller&&LocalCacheData.current_open_primary_controller.grid&&(LocalCacheData.current_open_primary_controller.setGridColumnsWidth(),LocalCacheData.current_open_primary_controller.setGridSize()),LocalCacheData.current_open_sub_controller&&LocalCacheData.current_open_sub_controller.grid&&(LocalCacheData.current_open_sub_controller.setGridColumnsWidth(),LocalCacheData.current_open_sub_controller.setGridSize())}}),500))}else Debug.Text("ERROR: table_id not found in DOM","TTGrid.js","TTGrid","constructor",10)}else Debug.Text("ERROR: constructor requires all 3 arguments","TTGrid.js","TTGrid","constructor",10)}}}]);
//# sourceMappingURL=ttgrid-TTGrid.bundle.js.map?v=029a48a52d118d8a9a49