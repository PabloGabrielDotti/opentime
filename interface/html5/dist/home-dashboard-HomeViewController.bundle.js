(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["home-dashboard-HomeViewController"],{7657:(e,t,a)=>{"use strict";a.r(t),a.d(t,{"HomeViewController":()=>l});var n=a(8831),r=a.n(n),o=a(8751),i=a.n(o),s=a(6739);class l extends s.TTBackboneView{constructor(e={}){_.defaults(e,{el:".home-view",user_generic_data_api:null,context_menu_array:null,viewId:null,dashletControllerArray:null,initMasonryDone:!1,dashboard_container:!1,order_data:!1,current_scroll_position:!1,current_mouse_position:null}),super(e)}initialize(e){Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var t=this;super.initialize(e),t.viewId="Home",TopMenuManager.selected_menu_id="Home",LocalCacheData.current_open_primary_controller=t,t.user_generic_data_api=TTAPI.APIUserGenericData,t.api_dashboard=TTAPI.APIDashboard,r()("masonry",i(),$),t.dashboard_container=$(".dashboard-container:visible"),t.initMasonryDone=!1,t.initContextMenu(),t.initDashBoard(),t.setViewHeight(),t.autoOpenEditOnlyViewIfNecessary(),TTPromise.resolve("BaseViewController","initialize")}autoOpenEditOnlyViewIfNecessary(){LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().sm&&!LocalCacheData.current_open_edit_only_controller&&(LocalCacheData.getAllURLArgs().sm.indexOf("Report")<0?IndexViewController.openEditView(this,LocalCacheData.getAllURLArgs().sm,LocalCacheData.getAllURLArgs().sid):(IndexViewController.openReport(this,LocalCacheData.getAllURLArgs().sm),LocalCacheData.getAllURLArgs().sid&&(LocalCacheData.default_edit_id_for_next_open_edit_view=LocalCacheData.getAllURLArgs().sid)))}initContextMenu(){var e=this;this.buildContextMenu(),this.setDefaultMenu(),$(this.el).unbind("click").bind("click",(function(){e.setDefaultMenu()}))}buildContextMenu(){var e=this;LocalCacheData.current_open_sub_controller=null,this.context_menu_array=[];var t=this.buildContextMenuModels(),a=$(".ribbonTabLabel"),n=$(".ribbon");n.find(".context-menu").remove();for(var r,o=t.length,i=0;i<o;i++){var s=(r=t[i]).get("sub_menu_groups"),l=$('<div id="'+r.get("id")+'" class="ribbon-tab-out-side ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"><div class="context-ribbon-tab"><div class="ribbon-sub-menu"></div></div></div>');if(Global.isSet(LocalCacheData.currentShownContextMenuName)&&LocalCacheData.currentShownContextMenuName!==r.get("id"))this.removeContentMenuByName(LocalCacheData.currentShownContextMenuName);else if(Global.isSet(LocalCacheData.currentShownContextMenuName)&&LocalCacheData.currentShownContextMenuName===r.get("id"))return;this.subMenuNavMap={},LocalCacheData.currentShownContextMenuName=r.get("id");for(var d=s.length,u=0;u<d;u++){for(var c=s[u],h=c.get("sub_menus"),_=$("<ul></ul>"),b=$('<div class="menu top-ribbon-menu"></div>'),m=h.length,g=0;g<m;g++){var p=h[g];if(p.get("selected"))var v=$('<li ><div class="ribbon-sub-menu-icon selected-menu" id="'+p.get("id")+'"><img src="'+p.get("icon")+'" ><span class="ribbon-label">'+p.get("label")+"</span></div></li>");else v=$('<li ><div class="ribbon-sub-menu-icon" id="'+p.get("id")+'"><img src="'+p.get("icon")+'" ><span class="ribbon-label">'+p.get("label")+"</span></div></li>");this.context_menu_array.push(v),p.get("type")===RibbonSubMenuType.NAVIGATION?(v.children().eq(0).addClass("ribbon-sub-menu-nav-icon"),e.subMenuNavMap[p.get("id")]=p,v.click.off("click").on("click",(function(t){var a=$($(this).find(".ribbon-sub-menu-icon")).attr("id");e.onSubMenuNavClick(this,a)}))):v.off("click").on("click",(function(t){$($(this).find(".ribbon-sub-menu-icon")).attr("id");e.onContextMenuClick(this)})),_.append(v)}_.children().length>0&&(b.append(_),b.append($('<div class="menu-bottom"><span>'+c.get("label")+"</span></div>")),l.find(".ribbon-sub-menu").append(b))}a.append($('<li class="context-menu ui-state-default ui-corner-top"><a ref="'+r.get("id")+'" href="#'+r.get("id")+'">'+r.get("label")+"</a></li>")),n.append(l)}$("#ribbon_view_container").tabs("refresh")}onContextMenuClick(e){var t=this;e=$(e);var a=$(e.find(".ribbon-sub-menu-icon")).attr("id");if(!e.hasClass("disable-image")){switch(a){case ContextMenuIconName.add:ProgressBar.showOverlay(),this.onAddClick();break;case ContextMenuIconName.refresh_all:ProgressBar.showOverlay();for(var n=0;n<t.dashletControllerArray.length;n++)$(t.dashletControllerArray[n].el).find(".refresh-btn").trigger("click");break;case ContextMenuIconName.auto_arrange:TAlertManager.showConfirmAlert(Global.auto_arrange_dashlet_confirm_message,null,(function(e){e?(ProgressBar.showOverlay(),t.initDashBoard(!0)):ProgressBar.closeOverlay()}));break;case ContextMenuIconName.reset_all:TAlertManager.showConfirmAlert(Global.rese_all_dashlet_confirm_message,null,(function(e){if(e){ProgressBar.showOverlay();for(var a=[],n=0;n<t.dashlet_list.length;n++)a.push(t.dashlet_list[n].id);function r(){t.order_data?t.user_generic_data_api.deleteUserGenericData(t.order_data.id,{onResult:function(){t.initDashBoard()}}):t.initDashBoard()}a.length>0?t.user_generic_data_api.deleteUserGenericData(a,{onResult:function(e){e.isValid()?r():TAlertManager.showErrorAlert(e)}}):r()}else ProgressBar.closeOverlay()}));break;case ContextMenuIconName.in_out:case ContextMenuIconName.timesheet:case ContextMenuIconName.schedule:case ContextMenuIconName.request:case ContextMenuIconName.pay_stub:this.onNavigationClick(a)}Global.triggerAnalyticsContextMenuClick(e)}}onNavigationClick(e){switch(e){case ContextMenuIconName.in_out:IndexViewController.openEditView(LocalCacheData.current_open_primary_controller,"InOut");break;case ContextMenuIconName.timesheet:IndexViewController.goToView("TimeSheet");break;case ContextMenuIconName.schedule:IndexViewController.goToView("Schedule");break;case ContextMenuIconName.request:IndexViewController.goToView("Request");break;case ContextMenuIconName.pay_stub:IndexViewController.goToView("PayStub")}}selectContextMenu(){if(TopMenuManager.selected_menu_id!==this.viewId+"ContextMenu"&&TopMenuManager.ribbon_view_controller){var e=$(TopMenuManager.ribbon_view_controller.el);e&&(e.tabs("refresh"),e.find(".ui-tabs-panel").hide(),$("#"+this.viewId+"ContextMenu").show(),e.tabs("option","active",$(".ribbonTabLabel li:visible").length-1),Debug.Text("#"+this.viewId+"ContextMenu visible","HomeViewController","HomeViewController","selectContextMenu",10))}}setDefaultMenu(){this.context_menu_array&&this.selectContextMenu()}onAddClick(){var e=this;IndexViewController.openWizard("DashletWizard",null,(function(){e.initDashBoard()}))}removeContentMenuByName(e){if(LocalCacheData.current_open_primary_controller){var t=LocalCacheData.current_open_primary_controller.viewId,a=TopMenuManager.menus_quick_map[t];TopMenuManager.ribbon_view_controller&&TopMenuManager.selected_menu_id&&-1!==TopMenuManager.selected_menu_id.indexOf("ContextMenu")&&TopMenuManager.ribbon_view_controller.setSelectMenu(a),Global.isSet(e)||(e=this.context_menu_name);var n=$("#ribbon ul a").filter((function(){return $(this).attr("ref")===e})).parent();$("li",$("#ribbon")).index(n)>=0&&$("#ribbon_view_container").tabs("refresh")}}buildContextMenuModels(){var e=new RibbonMenu({label:"Dashboard",id:this.viewId+"ContextMenu",sub_menu_groups:[]}),t=new RibbonSubMenuGroup({label:$.i18n._("Editor"),id:this.viewId+"Editor",ribbon_menu:e,sub_menus:[]}),a=new RibbonSubMenuGroup({label:$.i18n._("Navigation"),id:this.viewId+"navigation",ribbon_menu:e,sub_menus:[]});new RibbonSubMenu({label:$.i18n._("Add Dashlet"),id:ContextMenuIconName.add,group:t,icon:Icons.new_add,permission_result:!0,permission:null}),new RibbonSubMenu({label:$.i18n._("Auto Arrange"),id:ContextMenuIconName.auto_arrange,group:t,icon:Icons.branches,permission_result:!0,permission:null}),new RibbonSubMenu({label:$.i18n._("Refresh All<br>Dashlets"),id:ContextMenuIconName.refresh_all,group:t,icon:Icons.restart,permission_result:!0,permission:null}),new RibbonSubMenu({label:$.i18n._("Restore<br>Default Dashlets"),id:ContextMenuIconName.reset_all,group:t,icon:Icons.save_and_continue,permission_result:!0,permission:null}),new RibbonSubMenu({label:$.i18n._("In/Out"),id:ContextMenuIconName.in_out,group:a,icon:Icons.in_out,permission_result:PermissionManager.checkTopLevelPermission("InOut"),permission:null}),new RibbonSubMenu({label:$.i18n._("TimeSheet"),id:ContextMenuIconName.timesheet,group:a,icon:Icons.timesheet,permission_result:PermissionManager.checkTopLevelPermission("TimeSheet"),permission:null}),new RibbonSubMenu({label:$.i18n._("Schedules"),id:ContextMenuIconName.schedule,group:a,icon:Icons.schedule,permission_result:PermissionManager.checkTopLevelPermission("Schedule"),permission:null}),new RibbonSubMenu({label:$.i18n._("Requests"),id:ContextMenuIconName.request,group:a,icon:Icons.request,permission_result:PermissionManager.checkTopLevelPermission("Request"),permission:null}),new RibbonSubMenu({label:$.i18n._("Pay<br>Stubs"),id:ContextMenuIconName.pay_stub,group:a,icon:Icons.pay_stubs,permission_result:PermissionManager.checkTopLevelPermission("PayStub"),permission:null});return[e]}unLoadCurrentDashlets(){if(this.dashletControllerArray)for(var e=0;e<this.dashletControllerArray.length;e++){this.dashletControllerArray[e].cleanWhenUnloadView()}this.dashletControllerArray=[]}initDashBoard(e){var t=this,a=0;function n(e){t.removeNoResultCover(),t.user_generic_data_api.getUserGenericData({filter_data:{script:"global_dashboard_order",name:"order_data",deleted:!1}},{onResult:function(n){if(n=n.getResult(),Global.isArray(n)&&1==n.length){t.order_data=n[0],t.is_getting_default_dashlet?(t.order_data.data=[],t.addMissedDashLetToOrder(e),t.is_getting_default_dashlet=!1):(t.order_data.data&&Global.isArray(t.order_data.data)||(t.order_data.data=[]),t.addMissedDashLetToOrder(e)),t.dashlet_list=[];for(var o=0,i=t.order_data.data.length;o<i;o++)for(var s=t.order_data.data[o],l=0,d=e.length;l<d;l++){var u=e[l];if(u.id.toString()===s.toString()){t.dashlet_list.push(u),!0;break}}}else t.dashlet_list=e;t.dashlet_list.length>0&&r(t.dashlet_list[a])}})}function r(n){Global.loadScript("views/home/dashlet/DashletController.js",(function(){var o="dashlet_"+n.id,i=$('<div class="dashlet-container" id="'+o+'"><div class="dashlet"><button class="refresh-btn"></button><span class="title"></span><div class="button-bar"><button class="view-btn button">View</button><button class="modify-btn button">Edit</button><button class="delete-btn button">Delete</button></div><div class="content"><table id="grid"></table><iframe class="report-iframe" id="iframe"></iframe></div></div><div class="dashlet-left-cover" ></div><div class="dashlet-right-cover" ></div></div>');n.data.height&&!e||(n.data.height=200),n.data.width&&!e||("custom_report"===n.data.dashlet_type?n.data.width=99:n.data.width=33.3),i.css("height",n.data.height+"px"),i.css("width",n.data.width+"%"),t.dashboard_container.append(i),i.find(".button").unbind("click").bind("click",(function(e){var a=e.target,n=$(a).parent().parent().parent();if(n.attr("id")){var r=n.attr("id").split("_")[1];$(a).hasClass("delete-btn")&&t.deleteDashlet(r,$(n)),$(a).hasClass("modify-btn")&&t.modifyDashlet(r)}}));var s=new DashletController;t.dashletControllerArray.push(s),s.el="#"+o,s.data=n,s.homeViewController=t,s.initContent(),e&&t.user_generic_data_api.setUserGenericData(n,{onResult:function(e){}}),(a+=1)<t.dashlet_list.length?r(t.dashlet_list[a]):t.updateLayout()}))}this.dashletControllerArray?this.unLoadCurrentDashlets():this.dashletControllerArray=[],this.initMasonryDone&&(this.dashboard_container=$(".dashboard-container"),this.dashboard_container.masonry(),this.dashboard_container.masonry("destroy"),this.dashboard_container.sortable("destroy"),this.dashboard_container.empty(),this.initMasonryDone=!1),t.dashlet_controller_dic={},this.user_generic_data_api.getUserGenericData({filter_data:{script:"global_dashboard",deleted:!1}},{onResult:function(e){var a=e.getResult();!Global.isArray(a)||a.length<1?t.api_dashboard.getDefaultDashlets({onResult:function(e){a=e.getResult(),t.is_getting_default_dashlet=!0,n(a)}}):n(a)}}),Global.detectMobileBrowser()&&this.dashboard_container.sortable({disabled:!0})}showNoResultCover(){this.removeNoResultCover(),this.no_result_box=Global.loadWidgetByName(WidgetNamesDic.NO_RESULT_BOX),this.no_result_box.NoResultBox({related_view_controller:this,is_new:!0,message:$.i18n._("No Dashlets Found"),iconLabel:$.i18n._("Add")}),this.no_result_box.attr("id","#dashboard_"+this.viewId+"_no_result_box"),$(this.el).find(".container").append(this.no_result_box)}removeNoResultCover(){this.no_result_box&&this.no_result_box.length>0&&this.no_result_box.remove(),this.no_result_box=null}addMissedDashLetToOrder(e){var t=this;if(t.order_data&&t.order_data.data)for(var a=0,n=e.length;a<n;a++){for(var r=e[a],o=!1,i=0,s=t.order_data.data.length;i<s;i++){var l=t.order_data.data[i];if(r.id.toString()===l.toString()){o=!0;break}}o||t.order_data.data.push(r.id.toString()),this.is_getting_default_dashlet&&t.order_data.data.sort()}}updateLayout(){var e=this;function t(e,t){return(e=$(e)).offset().left<=t.x&&e.offset().left+e.width()>=t.x&&e.offset().top<=t.y&&e.offset().top+e.height()>=t.y}this.saveScrollPosition(),this.initMasonryDone?(this.dashboard_container.masonry("destroy"),this.dashboard_container.sortable("destroy")):this.initMasonryDone=!0,this.dashboard_container.masonry({"columnWidth":1,itemSelector:".dashlet-container"}),this.dashboard_container.on("mouseup",(function(){$(".dashlet-cover--display-red").removeClass("dashlet-cover--display-red"),$(".dashlet-cover--display-green").removeClass("dashlet-cover--display-green")})),this.dashboard_container.on("mousemove",(function(t){var a=t.pageX,n=t.pageY;e.current_mouse_position={x:a,y:n}})),this.dashboard_container.sortable({forceHelperSize:!0,forcePlaceholderSize:!0,grid:[3,10],containment:".container",change:function(a,n){$(".dashlet-cover--display-red").removeClass("dashlet-cover--display-red"),$(".dashlet-cover--display-green").removeClass("dashlet-cover--display-green");var r=$(".ui-sortable-placeholder").index();if(-1!=r)for(var o=$(".dashlet-container"),i=0;i<o.length;i++){if($(o[i]).attr("id")!=n.item.attr("id"))if(($(o[i]).index()==r+1||$(o[i]).index()==r-1)&&t($(o[i]),e.current_mouse_position))e.current_mouse_position.x>=$(o[i]).offset().left+$(o[i]).width()/2&&e.current_mouse_position.x<=$(o[i]).offset().left+$(o[i]).width()?("RIGHT",$(o[i]).find(".dashlet-right-cover").addClass("dashlet-cover--display-green")):("LEFT",$(o[i]).find(".dashlet-left-cover").addClass("dashlet-cover--display-green"))}},stop:function(t,a){e.saveNewOrder(),e.updateLayout();for(var n=a.item.attr("id").split("_")[1],r=0,o=e.dashletControllerArray.length;r<o;r++){var i=e.dashletControllerArray[r];n==i.data.id&&i.refreshIfNecessary()}e.dashboard_container.masonry("reloadItems")}}),this.recoverCurrentScrollPosition(),TTPromise.resolve("init","init")}saveNewOrder(e){for(var t=this,a=$(this.el).find(".dashlet-container:not(.ui-sortable-placeholder)"),n=[],r=0,o=a.length;r<o;r++){var i=$(a[r]).attr("id").split("_")[1];n.push(i)}var s={};this.order_data?(this.order_data.data=n,s=this.order_data):(s.name="order_data",s.script="global_dashboard_order",s.is_default=!0,s.data=n),this.user_generic_data_api.setUserGenericData(s,{onResult:function(a){var r=a.getResult();1!=r&&TTUUID.isUUID(r)&&r!=TTUUID.zero_id&&r!=TTUUID.not_exist_id?(t.order_data={id:r},t.order_data.data=n,e&&e()):!0===r&&e&&e()}})}cleanWhenUnloadView(){this.unLoadCurrentDashlets()}modifyDashlet(e){var t=this;IndexViewController.openWizard("DashletWizard",{saved_dashlet_id:e},(function(){t.initDashBoard()}))}deleteDashlet(e,t){var a=this;TAlertManager.showConfirmAlert(Global.delete_dashlet_confirm_message,null,(function(n){n?(ProgressBar.showOverlay(),a.user_generic_data_api.deleteUserGenericData(e,{onResult:function(n){t.remove(),a.removeDeletedDashletsData(e),$(a.el).find(".dashboard-container").children().length<1?a.showNoResultCover():a.saveNewOrder((function(){a.updateLayout()}))}})):ProgressBar.closeOverlay()}))}removeDeletedDashletsData(e){for(var t=0,a=this.dashlet_list.length;t<a;t++)if(this.dashlet_list[t].id.toString()===e){this.dashlet_list.splice(t,1);break}}setViewHeight(){var e=this;$(this.el).find(".container").height($(this.el).height()-35),$(window).resize((function(){$(e.el).find(".container").height($(e.el).height()-35)}))}saveScrollPosition(){this.current_scroll_position=this.dashboard_container.parent().scrollTop()}recoverCurrentScrollPosition(){this.current_scroll_position>0&&this.dashboard_container.parent().scrollTop(this.current_scroll_position)}}}}]);
//# sourceMappingURL=home-dashboard-HomeViewController.bundle.js.map?v=9ab31521277e5fceee76