{"version":3,"sources":["webpack://timetrex/./interface/html5/views/my_account/password/ChangePasswordViewController.js"],"names":["ChangePasswordViewController","BaseViewController","options","_","defaults","showPassword","showPhonePassword","result_data","super","this","permission_id","viewId","script_name","context_menu_name","$","i18n","api","TTAPI","APIUser","initPermission","render","initData","PermissionManager","validate","exclude","include","ContextMenuIconName","save","cancel","context_btn","p_id","key","current_edit_record","widget","edit_view_ui_dic","Global","isSet","setValue","LocalCacheData","loginUser","user_name","phone_id","collectUIDataToCurrentEditRecord","setEditViewDataDone","$this","edit_only_mode","buildContextMenu","edit_view","initEditViewUI","initEditView","tab","retval","checkTabPermissions","target","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","getField","c_value","getValue","ignoreWarning","record","current_doing_context_action","clearErrorTips","getEditViewTabIndex","saveWebPassword","result","isValid","removeEditView","showErrorTips","TAlertManager","showAlert","ProgressBar","closeOverlay","savePhonePassword","index","tabKey","error_list","getDetails","found_in_current_tab","parseInt","replace","hasOwnProperty","is","setErrorStyle","edit_view_error_ui_dic","showEditViewError","callBack","onResult","buildEditViewUI","tab_model","setTabModel","tab_web_password_column1","edit_view_tab","find","edit_view_tabs","push","form_item_input","loadWidgetByName","FormItemType","TEXT","TText","field","addEditFieldToColumn","PASSWORD_INPUT","TPasswordInput","width","tab_quick_punch_password_column1"],"mappings":"uMAAO,MAAMA,UAAqCC,mBACjD,YAAaC,EAAU,IACtBC,EAAEC,SAAUF,EAAS,CACpBG,aAAc,KAEdC,kBAAmB,KAEnBC,YAAa,KAGdC,MAAON,GAGR,KAAMA,GAILO,KAAKC,cAAgB,OACrBD,KAAKE,OAAS,iBACdF,KAAKG,YAAc,qBACnBH,KAAKI,kBAAoBC,EAAEC,KAAKZ,EAAG,aACnCM,KAAKO,IAAMC,MAAMC,QAEjBT,KAAKU,iBAELV,KAAKW,SAELX,KAAKY,WAGN,iBACCb,MAAMW,iBAEDG,kBAAkBC,SAAU,OAAQ,qBACxCd,KAAKJ,cAAe,EAEpBI,KAAKJ,cAAe,EAGhBiB,kBAAkBC,SAAU,OAAQ,2BACxCd,KAAKH,mBAAoB,EAEzBG,KAAKH,mBAAoB,EAI3B,SACCE,MAAMY,SAGP,4BASC,MARyB,CACxBI,QAAS,CAAC,WACVC,QAAS,CACRC,oBAAoBC,KACpBD,oBAAoBE,SAOvB,aAAcC,EAAaC,IAI3B,2BAGC,IAAM,IAAIC,KAAOtB,KAAKuB,oBAAsB,CAC3C,IAAIC,EAASxB,KAAKyB,iBAAiBH,GACnC,GAAKI,OAAOC,MAAOH,GAClB,OAASF,GACR,IAAK,YACJE,EAAOI,SAAUC,eAAeC,UAAUC,WAC1C,MACD,IAAK,WAEEF,eAAeC,UAAUE,SAG9BR,EAAOI,SAAUC,eAAeC,UAAUE,UAF1CR,EAAOI,SAAUvB,EAAEC,KAAKZ,EAAG,kBAK5B,MACD,QACC8B,EAAOI,SAAU5B,KAAKuB,oBAAoBD,KAO9CtB,KAAKiC,mCACLjC,KAAKkC,sBAGN,eAEC,IAAIC,EAAQnC,KAEPmC,EAAMC,iBAAoBpC,KAAKJ,cAAgBI,KAAKH,qBAExDsC,EAAME,mBAEAF,EAAMG,WACXH,EAAMI,eAAgB,iBAAkB,+BAGzCJ,EAAMZ,oBAAsB,GAE5BY,EAAMK,gBAOR,oBAAqBC,GACpB,IAAIC,GAAS,EAEb,OAASD,GACR,IAAK,mBACCzC,KAAKJ,eACT8C,GAAS,GAEV,MACD,IAAK,2BACC1C,KAAKH,oBACT6C,GAAS,GAEV,MACD,QACCA,EAAS3C,MAAM4C,oBAAqBF,GAItC,OAAOC,EAGR,iBAAkBE,EAAQC,GAEzB7C,KAAK8C,aAAcF,GACnB5C,KAAK+C,mCAAoCH,GAEzC,IAAItB,EAAMsB,EAAOI,WAEbC,EAAUL,EAAOM,WAErBlD,KAAKuB,oBAAoBD,GAAO2B,EAGjC,YAAaE,GACZ,IAAIhB,EAAQnC,KAERoD,EAASpD,KAAKuB,oBAClBM,eAAewB,6BAA+B,OACxC3B,OAAOC,MAAOwB,KACnBA,GAAgB,GAEjBnD,KAAKsD,iBAEL,IAAIhC,EAAMtB,KAAKuD,sBACF,IAARjC,EACE8B,EAAO,wBAIZjB,EAAMqB,gBAAiBJ,GAAQ,SAAUK,GACnCA,EAAOC,UAEXvB,EAAMwB,iBAENxB,EAAMyB,cAAeH,EAAQ,OAR/BI,cAAcC,UAAWzD,EAAEC,KAAKZ,EAAG,uCACnCqE,YAAYC,gBAaM,IAAR1C,IACL8B,EAAO,0BAIZjB,EAAM8B,kBAAmBb,GAAQ,SAAUK,GACrCA,EAAOC,UAEXvB,EAAMwB,iBAENxB,EAAMyB,cAAeH,EAAQ,OAR/BI,cAAcC,UAAWzD,EAAEC,KAAKZ,EAAG,2CACnCqE,YAAYC,iBAcf,cAAeP,EAAQS,GAEtB,IAEIC,EADAC,EADUX,EAAOY,aAIjBC,GAAuB,EAC3B,IAAM,IAAIhD,KAAO8C,EAAa,CAC7B,GAA2B,IAAtBG,SAAUL,GAAgB,CAE9B,IAAKlE,KAAKuB,oBAAoB,wBAG7B,SAFA4C,EAAS,OAAS7C,EAOpB,GAA2B,IAAtBiD,SAAUL,GAAgB,CAC9B,IAAKlE,KAAKuB,oBAAoB,0BAG7B,SAFA4C,EAAS,SAAW7C,EAAIkD,QAAQ,SAAU,IAOtCJ,EAAWK,eAAgBnD,KAI3BI,OAAOC,MAAO3B,KAAKyB,iBAAiB0C,MAIrCnE,KAAKyB,iBAAiB0C,GAAQO,GAAI,cACtC1E,KAAKyB,iBAAiB0C,GAAQQ,cAAeP,EAAW9C,IAAM,GAC9DgD,GAAuB,GAGxBtE,KAAK4E,uBAAuBT,GAAUnE,KAAKyB,iBAAiB0C,KAIvDG,GAELtE,KAAK6E,kBAAmBpB,GAK1B,gBAAiBL,EAAQ0B,GAExB9E,KAAKO,IAAoB,eAAG6C,EAAO,wBAAyBA,EAAO,gBAAiBA,EAAO,iBAAkB,YAAa,CACzH2B,SAAU,SAAUtB,GACnBqB,EAAUrB,MAKb,kBAAmBL,EAAQ0B,GAE1B9E,KAAKO,IAAoB,eAAG6C,EAAO,0BAA2BA,EAAO,kBAAmBA,EAAO,mBAAoB,iBAAkB,CACpI2B,SAAU,SAAUtB,GACnBqB,EAAUrB,MAKb,kBAEC1D,MAAMiF,kBAEN,IAAIC,EAAY,CACf,mBAAoB,CAAE,QAAS5E,EAAEC,KAAKZ,EAAG,iBACzC,2BAA4B,CAAE,QAASW,EAAEC,KAAKZ,EAAG,0BAElDM,KAAKkF,YAAaD,GAIlB,IAEIE,EAFmBnF,KAAKoF,cAAcC,KAAM,qBAEAA,KAAM,iBAEtDrF,KAAKsF,eAAe,GAAK,GAEzBtF,KAAKsF,eAAe,GAAGC,KAAMJ,GAG7B,IAAIK,EAAkB9D,OAAO+D,iBAAkBC,aAAaC,MAC5DH,EAAgBI,MAAO,CAAEC,MAAO,cAChC7F,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,aAAe8F,EAAiBL,EAA0B,KAG/FK,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,uBAAwBI,MAAO,MACxEjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,oBAAsB8F,EAAiBL,IAG5EK,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,eAAgBI,MAAO,MAChEjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,gBAAkB8F,EAAiBL,IAGxEK,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,gBAAiBI,MAAO,MACjEjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,0BAA4B8F,EAAiBL,EAA0B,IAI5G,IAEIe,EAF2BlG,KAAKoF,cAAcC,KAAM,6BAEQA,KAAM,iBAEtErF,KAAKsF,eAAe,GAAK,GAEzBtF,KAAKsF,eAAe,GAAGC,KAAMW,IAG7BV,EAAkB9D,OAAO+D,iBAAkBC,aAAaC,OACxCC,MAAO,CAAEC,MAAO,aAChC7F,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,kBAAoB8F,EAAiBU,EAAkC,KAG5GV,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,yBAA0BI,MAAO,MAC1EjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,wBAA0B8F,EAAiBU,IAGhFV,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,iBAAkBI,MAAO,MAClEjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,4BAA8B8F,EAAiBU,IAGpFV,EAAkB9D,OAAO+D,iBAAkBC,aAAaK,iBACxCC,eAAgB,CAAEH,MAAO,kBAAmBI,MAAO,MACnEjG,KAAK8F,qBAAsBzF,EAAEC,KAAKZ,EAAG,sCAAwC8F,EAAiBU,EAAkC","file":"my_account-password-ChangePasswordViewController.bundle.js?v=0726471c8326e1e9767a","sourcesContent":["export class ChangePasswordViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tshowPassword: null,\n\n\t\t\tshowPhonePassword: null,\n\n\t\t\tresult_data: []\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\n\t\t//this._super('initialize', options );\n\n\t\tthis.permission_id = 'user';\n\t\tthis.viewId = 'ChangePassword';\n\t\tthis.script_name = 'ChangePasswordView';\n\t\tthis.context_menu_name = $.i18n._( 'Passwords' );\n\t\tthis.api = TTAPI.APIUser;\n\n\t\tthis.initPermission();\n\n\t\tthis.render();\n\n\t\tthis.initData();\n\t}\n\n\tinitPermission() {\n\t\tsuper.initPermission();\n\n\t\tif ( PermissionManager.validate( 'user', 'edit_own_password' ) ) {\n\t\t\tthis.showPassword = true;\n\t\t} else {\n\t\t\tthis.showPassword = false;\n\t\t}\n\n\t\tif ( PermissionManager.validate( 'user', 'edit_own_phone_password' ) ) {\n\t\t\tthis.showPhonePassword = true;\n\t\t} else {\n\t\t\tthis.showPhonePassword = false;\n\t\t}\n\t}\n\n\trender() {\n\t\tsuper.render();\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: ['default'],\n\t\t\tinclude: [\n\t\t\t\tContextMenuIconName.save,\n\t\t\t\tContextMenuIconName.cancel\n\t\t\t]\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\tsaveValidate( context_btn, p_id ) {\n\t\t// always show\n\t}\n\n\tsetCurrentEditRecordData() {\n\t\t//Set current edit record data to all widgets\n\n\t\tfor ( var key in this.current_edit_record ) {\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'user_name':\n\t\t\t\t\t\twidget.setValue( LocalCacheData.loginUser.user_name );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'phone_id':\n\n\t\t\t\t\t\tif ( !LocalCacheData.loginUser.phone_id ) {\n\t\t\t\t\t\t\twidget.setValue( $.i18n._( 'Not Specified' ) );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidget.setValue( LocalCacheData.loginUser.phone_id );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\topenEditView() {\n\n\t\tvar $this = this;\n\n\t\tif ( $this.edit_only_mode && ( this.showPassword || this.showPhonePassword ) ) {\n\n\t\t\t$this.buildContextMenu();\n\n\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t$this.initEditViewUI( 'ChangePassword', 'ChangePasswordEditView.html' );\n\t\t\t}\n\n\t\t\t$this.current_edit_record = {};\n\n\t\t\t$this.initEditView();\n\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tcheckTabPermissions( tab ) {\n\t\tvar retval = false;\n\n\t\tswitch ( tab ) {\n\t\t\tcase 'tab_web_password':\n\t\t\t\tif ( this.showPassword ) {\n\t\t\t\t\tretval = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'tab_quick_punch_password':\n\t\t\t\tif ( this.showPhonePassword ) {\n\t\t\t\t\tretval = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tretval = super.checkTabPermissions( tab );\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn retval;\n\t}\n\n\tonFormItemChange( target, doNotValidate ) {\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\t//this.current_edit_record[key] = target.getValue();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\t}\n\n\tonSaveClick( ignoreWarning ) {\n\t\tvar $this = this;\n\n\t\tvar record = this.current_edit_record;\n\t\tLocalCacheData.current_doing_context_action = 'save';\n\t\tif ( !Global.isSet( ignoreWarning ) ) {\n\t\t\tignoreWarning = false;\n\t\t}\n\t\tthis.clearErrorTips();\n\n\t\tvar key = this.getEditViewTabIndex();\n\t\tif ( key === 0 ) {\n\t\t\tif ( !record['web.current_password'] ) {\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Current password must be specified' ) );\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t} else {\n\t\t\t\t$this.saveWebPassword( record, function( result ) {\n\t\t\t\t\tif ( result.isValid() ) {\n\n\t\t\t\t\t\t$this.removeEditView();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.showErrorTips( result, 0 );\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\t\t} else if ( key === 1 ) {\n\t\t\tif ( !record['phone.current_password'] ) {\n\t\t\t\tTAlertManager.showAlert( $.i18n._( 'Current web password must be specified' ) );\n\t\t\t\tProgressBar.closeOverlay();\n\t\t\t} else {\n\t\t\t\t$this.savePhonePassword( record, function( result ) {\n\t\t\t\t\tif ( result.isValid() ) {\n\n\t\t\t\t\t\t$this.removeEditView();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$this.showErrorTips( result, 1 );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\tshowErrorTips( result, index ) {\n\n\t\tvar details = result.getDetails();\n\t\tvar error_list = details;\n\t\tvar tabKey;\n\n\t\tvar found_in_current_tab = false;\n\t\tfor ( var key in error_list ) {\n\t\t\tif ( parseInt( index ) === 0 ) {\n\n\t\t\t\tif ( this.current_edit_record['web.current_password'] ) {\n\t\t\t\t\ttabKey = 'web.' + key;\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( parseInt( index ) === 1 ) {\n\t\t\t\tif ( this.current_edit_record['phone.current_password'] ) {\n\t\t\t\t\ttabKey = 'phone.' + key.replace('phone_', '');\n\t\t\t\t} else {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( !error_list.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( !Global.isSet( this.edit_view_ui_dic[tabKey] ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( this.edit_view_ui_dic[tabKey].is( ':visible' ) ) {\n\t\t\t\tthis.edit_view_ui_dic[tabKey].setErrorStyle( error_list[key], true );\n\t\t\t\tfound_in_current_tab = true;\n\t\t\t}\n\n\t\t\tthis.edit_view_error_ui_dic[tabKey] = this.edit_view_ui_dic[tabKey];\n\n\t\t}\n\n\t\tif ( !found_in_current_tab ) {\n\n\t\t\tthis.showEditViewError( result );\n\n\t\t}\n\t}\n\n\tsaveWebPassword( record, callBack ) {\n\t\tvar $this = this;\n\t\tthis.api['changePassword']( record['web.current_password'], record['web.password'], record['web.password2'], 'user_name', {\n\t\t\tonResult: function( result ) {\n\t\t\t\tcallBack( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tsavePhonePassword( record, callBack ) {\n\t\tvar $this = this;\n\t\tthis.api['changePassword']( record['phone.current_password'], record['phone.password'], record['phone.password2'], 'quick_punch_id', {\n\t\t\tonResult: function( result ) {\n\t\t\t\tcallBack( result );\n\t\t\t}\n\t\t} );\n\t}\n\n\tbuildEditViewUI() {\n\t\tvar $this = this;\n\t\tsuper.buildEditViewUI();\n\n\t\tvar tab_model = {\n\t\t\t'tab_web_password': { 'label': $.i18n._( 'Web Password' ) },\n\t\t\t'tab_quick_punch_password': { 'label': $.i18n._( 'Quick Punch Password' ) },\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\t//Tab 0 start\n\n\t\tvar tab_web_password = this.edit_view_tab.find( '#tab_web_password' );\n\n\t\tvar tab_web_password_column1 = tab_web_password.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_web_password_column1 );\n\n\t\t// User Name\n\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'user_name' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'User Name' ), form_item_input, tab_web_password_column1, '' );\n\n\t\t// Current Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'web.current_password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Current Password' ), form_item_input, tab_web_password_column1 );\n\n\t\t// New Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'web.password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Password' ), form_item_input, tab_web_password_column1 );\n\n\t\t// New Password(confirm)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'web.password2', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Password (Confirm)' ), form_item_input, tab_web_password_column1, '' );\n\n\t\t//Tab 1 start\n\n\t\tvar tab_quick_punch_password = this.edit_view_tab.find( '#tab_quick_punch_password' );\n\n\t\tvar tab_quick_punch_password_column1 = tab_quick_punch_password.find( '.first-column' );\n\n\t\tthis.edit_view_tabs[1] = [];\n\n\t\tthis.edit_view_tabs[1].push( tab_quick_punch_password_column1 );\n\n\t\t// Quick Punch ID\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\tform_item_input.TText( { field: 'phone_id' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Quick Punch ID' ), form_item_input, tab_quick_punch_password_column1, '' );\n\n\t\t// Current Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'phone.current_password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Current Web Password' ), form_item_input, tab_quick_punch_password_column1 );\n\n\t\t// New Password\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'phone.password', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Quick Punch Password' ), form_item_input, tab_quick_punch_password_column1 );\n\n\t\t// New Password(confirm)\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.PASSWORD_INPUT );\n\t\tform_item_input.TPasswordInput( { field: 'phone.password2', width: 200 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'New Quick Punch Password (Confirm)' ), form_item_input, tab_quick_punch_password_column1, '' );\n\t}\n\n}"],"sourceRoot":""}