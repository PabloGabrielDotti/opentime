(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["BaseViewController","paging-Paging2"],{5583:()=>{!function(e){e.fn.Paging2=function(i){var t,a,s,r,n,o,l,d,_,c,u=e.extend({},e.fn.Paging2.defaults,i),h=this;return this.getPagerData=function(){return t},this.setPagerData=function(i){if(t=i){e(this.css("display","block")),e(o).empty();var a=t.last_page_number;if(-1===a)e(o).append('<option value="1">1</option>');else for(var s=1;s<=a;s++)e(o).append('<option value="'+s+'">'+s+"</option>");e(e(o).find("option")).filter((function(){return parseInt(e(this).attr("value"))===t.current_page})).prop("selected",!0).prop("selected",!0),!0===t.is_last_page?(d.addClass("disabled"),d.addClass("disabled-image"),c=!1):(d.removeClass("disabled"),d.removeClass("disabled-image"),c=!0),t.is_first_page?(l.addClass("disabled"),l.addClass("disabled-image"),_=!1):(l.removeClass("disabled"),l.removeClass("disabled-image"),_=!0),-1===a||t.is_first_page&&t.is_last_page?(l.addClass("disabled"),l.addClass("disabled-image"),_=!1,d.addClass("disabled"),d.addClass("disabled-image"),c=!1,h.hide()):h.show()}else e(this.css("display","none"))},this.each((function(){e.meta&&e.extend({},u,e(this).data());e(this).find(".page-label-span").text(e.i18n._("Page")+":"),l=e(this).find(".left-buttons-div"),d=e(this).find(".right-buttons-div"),a=e(this).find(".start"),s=e(this).find(".last"),r=e(this).find(".next"),n=e(this).find(".end"),o=e(this).find(".paging-selector"),a.text(e.i18n._("Start")),s.text(e.i18n._("Previous")),r.text(e.i18n._("Next")),n.text(e.i18n._("End")),e(this).hide(),a.click((function(){_&&h.trigger("paging",["start"])})),s.click((function(){_&&h.trigger("paging",["last"])})),r.click((function(){c&&h.trigger("paging",["next"])})),n.click((function(){c&&h.trigger("paging",["end"])})),e(o).change(e.proxy((function(){e(o).find("option:selected").each((function(){var i=e(this).attr("value");h.trigger("paging",["go_to",i])}))}),this))})),this},e.fn.Paging2.defaults={}}(jQuery)},121:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"BaseViewController":()=>n});var a=t(6739),s=t(7526),r=t(2548);t(5583);window.FormItemType=r.FormItemType,window.WidgetNamesDic=r.WidgetNamesDic;class n extends a.TTBackboneView{constructor(e={}){_.defaults(e,{real_this:null,sub_view_mode:!1,edit_only_mode:!1,can_cache_controller:!0,permission_id:"",api:null,user_generic_data_api:null,all_columns:[],display_columns:[],default_display_columns:[],script_name:"",filter_data:null,temp_basic_filter_data:null,temp_adv_filter_data:null,sortData:null,select_layout:null,layout_changed:!1,search_panel:null,grid:null,context_menu_name:"",navigation_label:"",context_menu_array:[],t_grid_header_array:[],column_selector:null,sort_by_selector:null,save_search_as_input:null,previous_saved_layout_selector:null,previous_saved_layout_div:null,need_select_layout_name:"",search_fields:null,basic_search_field_ui_dic:{},adv_search_field_ui_dic:{},edit_view_ui_dic:{},edit_view_ui_validation_field_dic:{},edit_view_form_item_dic:{},edit_view_error_ui_dic:{},edit_view:null,edit_view_tab:null,current_edit_record:null,refresh_id:null,navigation:null,is_mass_editing:!1,is_viewing:!1,is_edit:!1,is_add:!1,unique_columns:[],linked_fields:[],mass_edit_record_ids:[],edit_view_tabs:[],refresh_sub_view:!1,parent_key:null,parent_value:null,parent_edit_record:null,total_display_span:null,paging_widget:null,paging_widget_2:null,pager_data:null,viewId:null,init_options_complete:!1,no_result_box:null,table_name_key:null,sub_log_view_controller:null,parent_view_controller:null,ui_id:"",is_changed:!1,confirm_on_exit:!1,edit_view_tpl:"",subMenuNavMap:null,trySetGridSizeWhenTabShow:!1,copied_record_id:"",other_field_api:null,last_select_ids:null,saving_layout_in_layout_tab:!1,need_switch_to_context_menu:!1,show_search_tab:!0,grid_total_width:null,show_warning_when_validation:!1,pulse_time_dic:!1,edit_view_close_icon:null,enable_validation:!0,tab_model:null,grid_parent:null}),super(e)}preInit(){}initialize(e){Debug.Text("INITIALIZE","BaseViewController.js","BaseViewController","initialize",10),Global.setUINotready(),super.initialize(e),TTPromise.add("init","init"),TTPromise.add("BaseViewController","initialize"),TTPromise.wait();var i=this;this.layout_changed=!1,setTimeout((function(){if(i.preInit(e),i.options=e,i.options&&Global.isSet(i.options.can_cache_controller)&&(i.can_cache_controller=i.options.can_cache_controller),i.options&&Global.isSet(i.options.edit_only_mode)&&(i.edit_only_mode=i.options.edit_only_mode),i.options&&Global.isSet(i.options.sub_view_mode)?i.sub_view_mode=i.options.sub_view_mode:i.sub_view_mode=!1,i.options&&Global.isSet(i.options.parent_view)&&(i.parent_view=i.options.parent_view),i.options&&Global.isSet(i.options.parent_view_controller)&&(i.parent_view_controller=i.options.parent_view_controller),i.edit_only_mode)i.ui_id=Global.getRandomNum();else{i.can_cache_controller&&(i.sub_view_mode?LocalCacheData.current_open_sub_controller=i:LocalCacheData.current_open_primary_controller=i);var t=$(i.el),a=t.attr("id")+"_"+Global.getRandomNum();t.attr("id",a),i.el="#"+a,i.ui_id=a,i.user_generic_data_api=s.y.APIUserGenericData,i.total_display_span=$($(i.el).find(".total-number-span")[0]),LocalCacheData.loadViewRequiredJSReady&&(0===LocalCacheData.paging_type?i.paging_widget=Global.loadWidgetByName(r.WidgetNamesDic.PAGING):(i.paging_widget=Global.loadWidgetByName(r.WidgetNamesDic.PAGING_2),i.paging_widget_2=Global.loadWidgetByName(r.WidgetNamesDic.PAGING_2),i.paging_widget=i.paging_widget.Paging2(),i.paging_widget_2=i.paging_widget_2.Paging2()))}i.sub_log_view_controller=null,i.edit_view_ui_dic={},i.edit_view_ui_validation_field_dic={},i.basic_search_field_ui_dic={},i.adv_search_field_ui_dic={},i.edit_view_tabs=[],i.context_menu_array=[],i.other_field_api=s.y.APIOtherField,i.initKeyboardEvent(),i.init(e),i.postInit(e),TTPromise.resolve("BaseViewController","initialize"),TTPromise.resolve("init","init")}),1)}init(){}postInit(){}initKeyboardEvent(){var e=this;this.sub_view_mode||this.edit_only_mode||$(this.el).unbind("keyup").bind("keydown",(function(i){13===i.keyCode&&e.search_panel&&!e.search_panel.isCollapsed()&&(e.onSearch(),$(":focus").blur())}))}initPermission(){}setTotalDisplaySpan(){if(this.total_display_span){var e,i,t,a=this.getGridSelectIdArray(),s=0;a&&(s=a.length);if(LocalCacheData.getLoginUserPreference())var r=parseInt(LocalCacheData.getLoginUserPreference().items_per_page);0===LocalCacheData.paging_type?this.pager_data?(e=this.pager_data.total_rows,i=1,t=this.grid.getData().length):(e=0,i=0,t=0):this.pager_data?(e=this.pager_data.total_rows,i=0,t=0,this.pager_data.last_page_number>1?this.pager_data.is_last_page?(i=(this.pager_data.current_page-1)*r+1,t=e):t=(i=(this.pager_data.current_page-1)*r+1)+r-1:(i=1,t=e)):(e=0,i=0,t=0);var n=i+" - "+t;!1!==e&&(n=n+" "+$.i18n._("of")+" "+e+" "+$.i18n._("total")+"."),this.total_display_span.text($.i18n._("Displaying")+" "+n+" [ "+$.i18n._("Selected")+": "+s+" ]")}}setSelectRibbonMenuIfNecessary(){!TopMenuManager.ribbon_view_controller||TopMenuManager.selected_sub_menu_id===this.viewId||this.sub_view_mode||this.edit_only_mode||(TopMenuManager.ribbon_view_controller.setSelectMenu(this.viewId),TopMenuManager.ribbon_view_controller.setSelectSubMenu(this.viewId))}getContextIconByName(e){for(var i=this.context_menu_array.length,t=0;t<i;t++){var a=$(this.context_menu_array[t]);if($(a.find(".ribbon-sub-menu-icon")).attr("id")===e)return!(!a.hasClass("disable-image")&&!a.hasClass("invisible-image"))}return!1}initRightClickMenu(e){if($.hasOwnProperty("contextMenu")){var i=this,t="";switch(e){case RightClickMenuType.LISTVIEW:t="#gbox_"+this.ui_id+"_grid";break;case RightClickMenuType.EDITVIEW:t="#"+this.ui_id+"_edit_view_tab";break;case RightClickMenuType.NORESULTBOX:t="#"+this.ui_id+"_no_result_box";break;case RightClickMenuType.ABSENCE_GRID:t="#"+this.ui_id+"_absence_grid";break;case RightClickMenuType.VIEW_ICON:t="#"+ContextMenuIconName.view_html;break;default:t="#gbox_"+this.ui_id+"_grid"}if(0!=$(t).length){var a=this.getRightClickMenuItems();a&&!$.isEmptyObject(a)&&($.contextMenu("destroy",t),$.contextMenu({selector:t,callback:function(e,t){i.onContextMenuClick(null,e)},onContextMenu:function(){return!1},items:a}))}}}getRightClickMenuItems(){for(var e=this,i={},t=this.context_menu_array.length,a=0;a<t;a++){var s=$(this.context_menu_array[a]);if(!s.children().eq(0).hasClass("ribbon-sub-menu-nav-icon")&&!s.hasClass("invisible-image")){var r=$(s.html()),n=this.replaceRightClickLabel(r),o=$(s.find(".ribbon-sub-menu-icon")).attr("id");i[o]={name:n,icon:o,disabled:function(i){return e.getContextIconByName(i)}}}}return i}replaceRightClickLabel(e){var i=e.children().eq(1).html();return i=Global.htmlDecode(i.replace("<br>"," "))}initData(){var e=this;Global.removeViewTab(this.viewId),ProgressBar.showOverlay(),e.edit_only_mode||(e.initOptions(),e.getAllColumns((function(){e.initLayout()})))}initLayout(){var e=this;e.getAllLayouts((function(){e.getDefaultDisplayColumns((function(){e.setSelectLayout(),e.search()}))}))}initOptions(){}getDefaultContextMenuModel(){var e={"groups":{"editor":{label:$.i18n._("Editor"),id:"editor",sort_order:1e3},"navigation":{label:$.i18n._("Navigation"),id:"navigation",sort_order:8e3},"other":{label:$.i18n._("Other"),id:"other",sort_order:9e3}},"icons":{}};return e.icons[ContextMenuIconName.add]={label:$.i18n._("New"),id:ContextMenuIconName.add,group:"editor",icon:Icons.new_add,sort_order:1e3},e.icons[ContextMenuIconName.view]={label:$.i18n._("View"),id:ContextMenuIconName.view,group:"editor",icon:Icons.view,sort_order:1010},e.icons[ContextMenuIconName.edit]={label:$.i18n._("Edit"),id:ContextMenuIconName.edit,group:"editor",icon:Icons.edit,sort_order:1020},e.icons[ContextMenuIconName.mass_edit]={label:$.i18n._("Mass<br>Edit"),id:ContextMenuIconName.mass_edit,group:"editor",icon:Icons.mass_edit,sort_order:1030},e.icons[ContextMenuIconName.delete_icon]={label:$.i18n._("Delete"),id:ContextMenuIconName.delete_icon,group:"editor",icon:Icons.delete_icon,sort_order:1040},e.icons[ContextMenuIconName.delete_and_next]={label:$.i18n._("Delete<br>& Next"),id:ContextMenuIconName.delete_and_next,group:"editor",icon:Icons.delete_and_next,sort_order:1050},e.icons[ContextMenuIconName.copy]={label:$.i18n._("Copy"),id:ContextMenuIconName.copy,group:"editor",icon:Icons.copy_as_new,sort_order:1060},e.icons[ContextMenuIconName.copy_as_new]={label:$.i18n._("Copy<br>as New"),id:ContextMenuIconName.copy_as_new,group:"editor",icon:Icons.copy,sort_order:1070},e.icons[ContextMenuIconName.save]={label:$.i18n._("Save"),id:ContextMenuIconName.save,group:"editor",icon:Icons.save,sort_order:1080},e.icons[ContextMenuIconName.save_and_continue]={label:$.i18n._("Save<br>& Continue"),id:ContextMenuIconName.save_and_continue,group:"editor",icon:Icons.save_and_continue,sort_order:1090},e.icons[ContextMenuIconName.save_and_next]={label:$.i18n._("Save<br>& Next"),id:ContextMenuIconName.save_and_next,group:"editor",icon:Icons.save_and_next,sort_order:1100},e.icons[ContextMenuIconName.save_and_copy]={label:$.i18n._("Save<br>& Copy"),id:ContextMenuIconName.save_and_copy,group:"editor",icon:Icons.save_and_copy,sort_order:1110},e.icons[ContextMenuIconName.save_and_new]={label:$.i18n._("Save<br>& New"),id:ContextMenuIconName.save_and_new,group:"editor",icon:Icons.save_and_new,sort_order:1120},e.icons[ContextMenuIconName.cancel]={label:$.i18n._("Cancel"),id:ContextMenuIconName.cancel,group:"editor",icon:Icons.cancel,sort_order:1130},e.icons[ContextMenuIconName.export_excel]={label:$.i18n._("Export"),id:ContextMenuIconName.export_excel,group:"other",icon:Icons.export_excel,sort_order:9e3},e}getCustomContextMenuModel(){return{groups:{},exclude:[],include:["default"]}}buildContextMenuModels(){var e=this.getCustomContextMenuModel();if(e&&(e.include||e.exclude)){var i=new RibbonMenu({label:this.context_menu_name,id:this.viewId+"ContextMenu",sub_menu_groups:[]}),t=this.getDefaultContextMenuModel(),a={"icons":{},"groups":{}};for(var s in e.groups||(e.groups={}),e.include||(e.include=["default"]),-1===e.include.indexOf("default")&&e.include.unshift("default"),t.groups)t.groups[s].ribbon_menu=i,t.groups[s].sub_menus=[],a.groups[s]=t.groups[s];for(var s in e.groups)e.groups[s].ribbon_menu=i,e.groups[s].sub_menus=[],a.groups[s]=e.groups[s];if(e.hasOwnProperty("include"))for(var r in e.include.constructor!==Array&&(e.include=Array(e.include)),e.include)if("default"==e.include[r])for(var s in Debug.Text("Including All Default Icons...","BaseViewController.js","BaseViewController","buildContextMenuModels",10),t.icons)a.icons[s]=t.icons[s];else{var n=e.include[r];"object"!=typeof n&&t.icons[n]?a.icons[n]=t.icons[n]:a.icons[e.include[r].id]=e.include[r]}var o=e.include.map((function(e){return e.id||e}));if(e.hasOwnProperty("exclude"))for(var r in e.exclude.constructor!==Array&&(e.exclude=Array(e.exclude)),e.exclude)if("default"==e.exclude[r])for(var s in Debug.Text("Excluding All Default Icons...","BaseViewController.js","BaseViewController","buildContextMenuModels",10),t.icons)-1===o.indexOf(s)&&a.icons[s]&&delete a.icons[s];else{var l=e.exclude[r];a.icons[l]&&delete a.icons[l]}var d={};for(var s in a.groups)d[s]=new RibbonSubMenuGroup(a.groups[s]),Debug.Text("Creating Ribbon Menu Group: "+a.groups[s].label,"BaseViewController.js","BaseViewController","buildContextMenuModels",10);for(var s in a.icons)if(a.icons[s]&&a.icons[s].group&&(a.icons[s].group.constructor===String?a.icons[s].group=d[a.icons[s].group]:"object"==typeof a.icons[s].group&&(a.icons[s].group=d[a.icons[s].group.get("id")])),0==a.icons[s].hasOwnProperty("permission_result")&&(a.icons[s].permission_result=!0),0==!a.icons[s].hasOwnProperty("permission")&&(a.icons[s].permission=null),Debug.Text("Creating Ribbon Menu Icon: "+a.icons[s].label,"BaseViewController.js","BaseViewController","buildContextMenuModels",10),a.icons[s].items&&a.icons[s].items.length>0){var _=a.icons[s].items;a.icons[s].items=[];for(var c=new RibbonSubMenu(a.icons[s]),u=0;u<_.length;u++){var h=_[u];h.nav=c,new RibbonSubMenuNavItem(h),Debug.Text("Added Ribbon Menu Nav Icon: "+h.label+" to "+c.get("label"),"BaseViewController.js","BaseViewController","buildContextMenuModels",10)}}else new RibbonSubMenu(a.icons[s]);return[i]}Global.sendErrorReport("ContextMenuModel error. No valid contextmenu model defined.")}buildContextMenu(e){if(this.current_edit_record&&1==this.edit_only_mode&&LocalCacheData.current_open_edit_only_controller&&LocalCacheData.current_open_edit_only_controller.viewId!=LocalCacheData.current_open_edit_only_controller.viewId)return null;var i=this;Global.isSet(e)||(e=!0),this.sub_view_mode||(LocalCacheData.current_open_sub_controller=null),this.context_menu_array=[];for(var t,a=this.buildContextMenuModels(),s=$(".ribbonTabLabel"),r=$(".ribbon"),n=a.length,o=0;o<n;o++){var l=(t=a[o]).getSubMenuGroups(),d=$('<div id="'+t.get("id")+'" class="context-ribbon-menu ribbon-tab-out-side ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"><div class="context-ribbon-tab"><div class="ribbon-sub-menu"></div></div></div>');if(Global.isSet(LocalCacheData.currentShownContextMenuName)&&LocalCacheData.currentShownContextMenuName!==t.get("id")){var _=LocalCacheData.currentShownContextMenuName;this.context_menu_array=[]}$(".context-ribbon-menu").remove(),this.subMenuNavMap={},LocalCacheData.currentShownContextMenuName=t.get("id");for(var c=l.length,u=0;u<c;u++){for(var h=l[u],g=h.getSubMenus(),v=$("<ul></ul>"),b=$('<div class="menu top-ribbon-menu"></div>'),m=g.length,p=0;p<m;p++){var f=g[p];if(f.get("selected"))var w=$('<li ><div class="ribbon-sub-menu-icon selected-menu" id="'+f.get("id")+'"><img src="'+f.get("icon")+'" ><span class="ribbon-label">'+f.get("label")+"</span></div></li>");else w=$('<li ><div class="ribbon-sub-menu-icon" id="'+f.get("id")+'"><img src="'+f.get("icon")+'" ><span class="ribbon-label">'+f.get("label")+"</span></div></li>");w.addClass("disable-image"),this.context_menu_array.push(w),f.get("type")===RibbonSubMenuType.NAVIGATION?(w.children().eq(0).addClass("ribbon-sub-menu-nav-icon"),i.subMenuNavMap[f.get("id")]=f,w.click(Global.debounce((function(e){var t=$(this).find(".ribbon-sub-menu-icon").attr("id");i.onSubMenuNavClick(this,t)}),Global.calcDebounceWaitTimeBasedOnNetwork(),!0))):w.click(Global.debounce((function(e){$(this).find(".ribbon-sub-menu-icon").attr("id");i.onContextMenuClick(this)}),Global.calcDebounceWaitTimeBasedOnNetwork(),!0)),v.append(w)}v.children().length>0&&(b.append(v),b.append($('<div class="menu-bottom"><span>'+h.get("label")+"</span></div>")),d.find(".ribbon-sub-menu").append(b))}$(".ribbonTabLabel .context-menu").remove();var C="default";e&&(C="active"),s.append($('<li class="context-menu ui-state-'+C+' ui-corner-top"><a ref="'+t.get("id")+'" href="#'+t.get("id")+'">'+t.get("label")+"</a></li>")),r.append(d)}_&&this.removeContentMenuByName(_),e&&(this.need_switch_to_context_menu=!0)}getContextMenuGroupByName(e,i,t){var a;null==t&&(t=this.viewId);for(var s=0;s<e.attributes.sub_menu_groups.length;s++)e.attributes.sub_menu_groups[s].id==t+i&&(a=e.attributes.sub_menu_groups[s]);return a}onSubMenuNavClick(e,i){var t=this,a=this.subMenuNavMap[i];if(LocalCacheData.openRibbonNaviMenu){if(LocalCacheData.openRibbonNaviMenu.attr("id")==="sub_nav"+i)return void LocalCacheData.openRibbonNaviMenu.close();LocalCacheData.openRibbonNaviMenu.close()}!function(){for(var s=a.get("items"),r=$("<ul id='sub_nav"+i+"' class='ribbon-sub-menu-nav'> </ul>"),n=0;n<s.length;n++){var o=s[n],l=$("<li class='ribbon-sub-menu-nav-item' id='"+o.get("id")+"'><span class='label'>"+o.get("label")+"</span></li>");r.append(l),l.unbind("click").click((function(){var e=$(this).attr("id");t.onReportMenuClick(e)}))}r=r.RibbonSubMenuNavWidget(),LocalCacheData.openRibbonNaviMenu=r,$(e).append(r),r.offset().left+r.width()>Global.bodyWidth()&&r.css("left",Global.bodyWidth()-r.width()-10)}()}onReportMenuClick(e){}onContextMenuClick(e,i){var t;if(Global.isSet(i))t=i;else if(e=$(e),t=$(e.find(".ribbon-sub-menu-icon")).attr("id"),e.hasClass("disable-image"))return;if(ProgressBar.showOverlay(),1!=window.clickProcessing){switch(window.clickProcessing=!0,window.clickProcessingHandle=window.setTimeout((function(){1==window.clickProcessing&&(window.clickProcessing=!1,ProgressBar.closeOverlay(),TTPromise.wait())}),Global.calcDebounceWaitTimeBasedOnNetwork(2e3)),t){case ContextMenuIconName.add:this.onAddClick();break;case ContextMenuIconName.view:this.onViewClick();break;case ContextMenuIconName.save:this.onSaveClick();break;case ContextMenuIconName.save_and_next:this.onSaveAndNextClick();break;case ContextMenuIconName.save_and_continue:this.onSaveAndContinue();break;case ContextMenuIconName.save_and_new:this.onSaveAndNewClick();break;case ContextMenuIconName.save_and_copy:this.onSaveAndCopy();break;case ContextMenuIconName.edit:this.onEditClick();break;case ContextMenuIconName.mass_edit:this.onMassEditClick();break;case ContextMenuIconName.delete_icon:this.onDeleteClick();break;case ContextMenuIconName.delete_and_next:this.onDeleteAndNextClick();break;case ContextMenuIconName.copy:this.onCopyClick();break;case ContextMenuIconName.copy_as_new:this.onCopyAsNewClick();break;case ContextMenuIconName.cancel:this.onCancelClick(),ProgressBar.closeOverlay();break;case ContextMenuIconName.export_excel:this.onExportClick("export"+this.api.key_name),ProgressBar.closeOverlay();break;case ContextMenuIconName.map:this.onMapClick(),ProgressBar.closeOverlay();break;default:this.onCustomContextClick(t,e),ProgressBar.closeOverlay()}Global.triggerAnalyticsContextMenuClick(e,i)}}onCustomContextClick(e){return!1}onNavigationClick(e){this.onContextMenuClick(e)}getCurrentAPI(){return this.api}setCurrentEditViewState(e){switch(this.is_viewing=!1,this.is_edit=!1,this.is_add=!1,this.is_mass_editing=!1,this.is_mass_adding=!1,e){case"view":this.is_viewing=!0;break;case"new":this.is_add=!0;break;case"edit":this.is_edit=!0;break;case"mass_edit":this.is_mass_editing=!0}LocalCacheData.current_doing_context_action=e}onAddClick(){var e=this;this.setCurrentEditViewState("new"),e.openEditView(),e.api&&"function"==typeof e.api["get"+e.api.key_name+"DefaultData"]&&e.api["get"+e.api.key_name+"DefaultData"]({onResult:function(i){e.onAddResult(i)}})}onAddResult(e){var i=this,t={};(t=e.getResult?e.getResult():e)&&!0!==t||(t=[]),t.company=LocalCacheData.current_company.name,i.sub_view_mode&&i.parent_key&&(t[i.parent_key]=i.parent_value),i.current_edit_record=t,i.initEditView()}onDeleteAndNextClick(){this.setCurrentEditViewState("delete_and_next"),TAlertManager.showConfirmAlert(Global.delete_confirm_message,null,function(e){this.doDeleteClick(e)}.bind(this))}resetNavigationSourceData(){}getDeleteSelectedRecordId(){var e=[];if(this.edit_view&&this.current_edit_record)e.push(this.current_edit_record.id);else{var i=this.getGridSelectIdArray().slice();e=i.length?i:null}return e}doDeleteClick(e){if(e){ProgressBar.showOverlay();var i=this.getDeleteSelectedRecordId();if(i===[])return;return this.doDeleteAPICall(i)}ProgressBar.closeOverlay()}doDeleteAPICall(e,i){var t=this.getCurrentAPI();return i||(i={onResult:function(i){this.onDeleteResult(i,e)}.bind(this)}),t["delete"+t.key_name](e,i)}onDeleteClick(){this.setCurrentEditViewState("delete"),TAlertManager.showConfirmAlert(Global.delete_confirm_message,null,this.doDeleteClick.bind(this))}onDeleteResult(e,i){var t=this;ProgressBar.closeOverlay(),e.isValid()?"delete_and_next"===LocalCacheData.current_doing_context_action?(t.refresh_id=this.navigation.getNextSelectItemId(),t.search(!1,null,null,(function(e){var i=e.getResult();"array"!==$.type(i)||i.length<1?(t.removeEditView(),t.setDefaultMenu()):(t.navigation.setSourceData(i),t.navigation.setPagerData(t.pager_data),t.refresh_id?t.onRightOrLeftArrowClickCallBack(t.refresh_id):t.onCancelClick(),t.onDeleteAndNextDone(e))}))):(t.search(),t.onDeleteDone(e),t.edit_view&&"delete"===LocalCacheData.current_doing_context_action&&(t.removeEditView(),t.setDefaultMenu())):(e.getRecordDetails().valid&&e.getRecordDetails().valid>0&&t.search(),TAlertManager.showErrorAlert(e))}removeDeletedRows(e){var i=this;$.each(e,(function(e,t){i.grid.grid.deleteRow(t),i.paging_widget.minus()}))}clearNavigationData(){this.navigation&&this.navigation.setSourceData&&this.navigation.setSourceData(null)}onSaveAndCopy(e){var i=this;Global.isSet(e)||(e=!1),this.is_add=!0,this.is_changed=!1,LocalCacheData.current_doing_context_action="save_and_copy";var t=this.current_edit_record;t=this.uniformVariable(t),this.clearNavigationData(),this.api["set"+this.api.key_name](t,!1,e,{onResult:function(e){i.onSaveAndCopyResult(e)}})}onSaveAndCopyResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t&&i.current_edit_record&&i.current_edit_record.id?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.search(!1),i.onCopyAsNewClick()}else i.setErrorMenu(),i.setErrorTips(e)}onSaveAndNewClick(e){var i=this;Global.isSet(e)||(e=!1),this.setCurrentEditViewState("new");var t=this.current_edit_record;t=this.uniformVariable(t),this.api["set"+this.api.key_name](t,!1,e,{onResult:function(e){i.onSaveAndNewResult(e)}})}onSaveAndNewResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t&&i.current_edit_record&&i.current_edit_record.id?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(!1),i.onAddClick(!0)}))}else i.setErrorMenu(),i.setErrorTips(e)}onSaveAndContinue(e){var i=this;Global.isSet(e)||(e=!1),this.is_changed=!1,this.is_add=!1,LocalCacheData.current_doing_context_action="save_and_continue";var t=this.current_edit_record;t=this.uniformVariable(t),this.doSaveAPICall(t,e,{onResult:function(e){i.onSaveAndContinueResult(e)}})}onSaveAndContinueResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t&&i.current_edit_record&&i.current_edit_record.id?i.refresh_id=i.current_edit_record.id:t&&TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.search(!1),i.onEditClick(i.refresh_id,!0),i.onSaveAndContinueDone(e)}))}else i.setErrorTips(e),i.setErrorMenu()}onSaveAndNextClick(e){var i=this;Global.isSet(e)||(e=!1),this.is_add=!1,this.is_changed=!1;var t=this.getCurrentAPI(),a=this.current_edit_record;LocalCacheData.current_doing_context_action="save_and_next",a=this.uniformVariable(a),t["set"+t.key_name](a,!1,e,{onResult:function(e){i.onSaveAndNextResult(e)}})}onSaveAndNextResult(e){var i=this;if(e.isValid()){var t=e.getResult();!0===t&&i.current_edit_record&&i.current_edit_record.id?i.refresh_id=i.current_edit_record.id:t&&TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),i.saveInsideEditorData((function(){i.onRightArrowClick(),i.search(!1),i.onSaveAndNextDone(e)}))}else i.setErrorMenu(),i.setErrorTips(e)}uniformVariable(e){return e}saveInsideEditorData(e){e&&e()}getChangedFields(){var e={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];Global.isSet(t.isChecked)&&t.isChecked()&&t.getEnabled()&&(e[i]=this.current_edit_record[i])}return e}buildMassAddRecord(e){var i;return Global.isArray(e.user_id)&&e.user_id.length>0?(i=[],$.each(this.current_edit_record.user_id,(function(t,a){var s=Global.clone(e);s.user_id=a,i.push(s)}))):i=e,i}buildMassEditSaveRecord(e,i){var t=this,a=[];return $.each(e,(function(e,s){var r=Global.clone(i);r.id=s,r=t.uniformVariable(r),a.push(r)})),a}onSaveClick(e){var i;if(Global.isSet(e)||(e=!1),this.is_add=!1,LocalCacheData.current_doing_context_action="save",this.is_mass_editing){var t=this.getChangedFields();i=this.buildMassEditSaveRecord(this.mass_edit_record_ids,t)}else this.is_mass_adding?i=this.buildMassAddRecord(this.current_edit_record):(i=this.current_edit_record,i=this.uniformVariable(i));this.doSaveAPICall(i,e)}doSaveAPICall(e,i,t){var a=this.getCurrentAPI();return t||(t={onResult:function(e){this.onSaveResult(e)}.bind(this)}),a["set"+a.key_name](e,!1,i,t)}onSaveResult(e){var i=this;if(e.isValid()){i.is_add=!1;var t=e.getResult();this.edit_only_mode||(!0===t&&i.current_edit_record&&i.current_edit_record.id?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id?i.refresh_id=t:i.refresh_id=null,i.search());var a=i.onSaveDone(e);null!=a&&1!=a||i.removeEditView()}else i.setErrorTips(e),i.setErrorMenu()}onSaveDone(e){return!0}onSaveAndContinueDone(e){}onSaveAndNextDone(e){}onDeleteDone(e){this.removeDeletedRows()}onDeleteAndNextDone(e){}onMassEditClick(){var e=this;this.setCurrentEditViewState("mass_edit"),e.openEditView();var i={},t=this.getGridSelectIdArray();t.length;this.mass_edit_record_ids=[],$.each(t,(function(i,t){e.mass_edit_record_ids.push(t)})),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,this.api["getCommon"+this.api.key_name+"Data"](i,{onResult:function(i){var t=i.getResult();t||(t=[]),e.api.getOptions("unique_columns",{onResult:function(i){e.unique_columns=i.getResult(),e.api.getOptions("linked_columns",{onResult:function(i){e.linked_columns=i.getResult(),!0===e.linked_columns&&(e.linked_columns=[]),e.sub_view_mode&&e.parent_key&&(t[e.parent_key]=e.parent_value),e.current_edit_record=t,e.initEditView()}})}})}})}getViewSelectedRecordId(e){var i=!1,t=this.getGridSelectIdArray(),a=t.length;return Global.isSet(e)?Global.isObject(e)&&e.id?i=e.id:Global.isString(e)&&TTUUID.isUUID(e)&&(i=e):i=a>0?t[0]:null,i}doViewAPICall(e,i){var t={onResult:this.handleViewAPICallbackResult.bind(this)};return i?(i.push(t),this.api["get"+this.api.key_name].apply(this.api,i)):this.api["get"+this.api.key_name](e,t)}handleViewAPICallbackResult(e){var i;return e&&e.getResult?(i=e.getResult(),(i=this.processAPICallbackResult(i))||(i=[]),i=i[0]):i=e,i?this.doViewClickResult(i):(TAlertManager.showAlert($.i18n._("Record does not exist.")),this.onCancelClick())}doViewClickResult(e){return this.current_edit_record=e,this.initEditView(),this.clearCurrentSelectedRecord()}onViewClick(e,i){this.setCurrentEditViewState("view"),this.openEditView();var t=this.getViewSelectedRecordId(e);if(!Global.isFalseOrNull(t)){this.setCurrentSelectedRecord(t);var a=this.getAPIFilters();return this.doViewAPICall(a)}}setCurrentSelectedRecord(e){return!!e&&(this.current_selected_record=e,!0)}getCurrentSelectedRecord(){return this.current_selected_record}clearCurrentSelectedRecord(){return delete this.current_selected_record,!0}getRecordIdFromRecord(e){return Global.isObject(e)?object_id:!!Global.isString(e)&&e}processAPICallbackResult(e){return e}getAPIFilters(){var e=this.getCurrentSelectedRecord(),i={filter_data:{}};return i.filter_data.id=[e],i}getEditSelectedRecordId(e){var i=!1,t=this.getGridSelectIdArray(),a=t.length;return Global.isSet(e)?Global.isObject(e)&&e.id?i=e.id:Global.isString(e)&&TTUUID.isUUID(e)&&(i=e):i=(this.is_viewing||this.is_edit)&&this.current_edit_record&&this.current_edit_record.id?this.current_edit_record.id:a>0?t[0]:null,i}doEditAPICall(e,i,t){return t||(t={onResult:this.handleEditAPICallbackResult.bind(this)}),i?(i.push(t),this.api["get"+this.api.key_name].apply(this.api,i)):this.api["get"+this.api.key_name](e,t)}handleEditAPICallbackResult(e){var i;return e.getResult?(i=e.getResult(),(i=this.processAPICallbackResult(i))||(i=[]),i=i[0]):i=e,i?(this.sub_view_mode&&this.parent_key&&(i[this.parent_key]=this.parent_value),this.doEditClickResult(i)):(TAlertManager.showAlert($.i18n._("Record does not exist.")),this.onCancelClick())}doEditClickResult(e){this.current_edit_record=e,this.initEditView()}onEditClick(e,i){if(this.setCurrentEditViewState("edit"),this.openEditView(),e=this.getEditSelectedRecordId(e),!Global.isFalseOrNull(e)){this.setCurrentSelectedRecord(e);var t=this.getAPIFilters();return this.doEditAPICall(t)}}onCopyClick(){var e=this,i=[];e.is_add=!1,e.edit_view?(i.push(e.current_edit_record.id),this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(t){!0===t&&(e.is_changed=!1,e._continueDoCopy(i)),ProgressBar.closeOverlay()})):e._continueDoCopy(i)):(i=e.getGridSelectIdArray().slice(),e._continueDoCopy(i))}_continueDoCopy(e){var i=this;ProgressBar.showOverlay(),i.api["copy"+i.api.key_name](e,{onResult:function(e){i.onCopyResult(e)}})}onCopyResult(e){var i=this;e.isValid()?(i.search(),i.edit_view&&i.removeEditView()):(TAlertManager.showErrorAlert(e),e.getRecordDetails().total>1&&i.search())}onCopyAsNewClick(){var e=this;this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(i){!0===i&&e._continueDoCopyAsNew(),ProgressBar.closeOverlay()})):this._continueDoCopyAsNew()}copyAsNewResetIds(e){return e.id="",e}getCopyAsNewFilter(e){return e}_continueDoCopyAsNew(){var e=this;if(this.setCurrentEditViewState("new"),LocalCacheData.current_doing_context_action="copy_as_new",Global.isSet(this.edit_view)){this.current_edit_record=this.copyAsNewResetIds(this.current_edit_record),this.edit_view.find(".navigation-div").css("display","none"),this.setEditMenu(),this.setTabStatus(),this.editor||this.setCurrentEditRecordData(),this.is_changed=!1,ProgressBar.closeOverlay()}else{var i={},t=this.getGridSelectIdArray();if(!(t.length>0))return void TAlertManager.showAlert($.i18n._("No selected record"));var a=t[0];i.filter_data={},i.filter_data.id=[a],i=this.getCopyAsNewFilter(i),this.api["get"+this.api.key_name](i,{onResult:function(i){e.onCopyAsNewResult(i)}})}}onCopyAsNewResult(e){var i=e.getResult();if("object"==typeof i){this.openEditView(),i=i[0],i=this.copyAsNewResetIds(i),this.sub_view_mode&&this.parent_key&&(i[this.parent_key]=this.parent_value),this.current_edit_record=i;$(".PunchesEditView .edit-view-tab-bar").css("opacity",1),$(".PunchesEditView .edit-view-tab").css("opacity",1),this.initEditView()}else this.onAddClick()}setJobItemValueWhenJobChanged(e,i,t){var a=this;if(a.current_edit_record){TTPromise.add("BaseViewController","setJobItemValueWhenJobChanged"),null==i&&(i="job_item_id"),null==t&&(t={status_id:10}),null!=e&&0!=e&&(t.job_id=e.id);var s=a.edit_view_ui_dic[i],r=s.getValue();s.setSourceData(null),s.setCheckBox(!0),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0);var n={};if(n.filter_data=t,a.edit_view_ui_dic[i].setDefaultArgs(n),r&&r!=TTUUID.zero_id){var o=Global.clone(n);o.filter_data.job_id=e.id,o.filter_columns=a.edit_view_ui_dic[i].getColumnFilter(),a.job_item_api.getJobItem(o,{onResult:function(e){a.current_edit_record&&(e.getResult().length>0?(s.setValue(r),a.current_edit_record[i]=r):l(i))}})}else l(i)}function l(i){null==i&&(i="job_item_id"),a.current_edit_record.hasOwnProperty(i)?(s.setValue(e.default_item_id),a.current_edit_record[i]=e.default_item_id,!1!==e.default_item_id&&0!==e.default_item_id&&e.default_item_id!==TTUUID.zero_id&&e.default_item_id!==TTUUID.not_exist_id||a.edit_view_ui_dic.job_item_quick_search.setValue("")):(s.setValue(""),a.current_edit_record[i]=!1,a.edit_view_ui_dic.job_item_quick_search.setValue("")),TTPromise.resolve("BaseViewController","setJobItemValueWhenJobChanged")}}onJobQuickSearch(e,i,t,a,s){var r=this,n={};TTPromise.add("BaseViewController","onJobQuickSearch"),null==t&&(t="job_id"),null==a&&(a="job_item_id"),r.edit_view_ui_dic&&r.edit_view_ui_dic[t]&&("job_quick_search"===e?(n.filter_data={manual_id:i,user_id:this.current_edit_record.user_id,status_id:"10"},this.job_api.getJob(n,{onResult:function(e){if(r.edit_view_ui_dic&&r.edit_view_ui_dic[t]){var i=e.getResult();i.length>0?(r.edit_view_ui_dic[t].setValue(i[0].id),r.current_edit_record[t]=i[0].id,r.setJobItemValueWhenJobChanged(i[0],a,s)):(r.edit_view_ui_dic[t].setValue(""),r.current_edit_record[t]=!1,r.setJobItemValueWhenJobChanged(!1,a,s)),TTPromise.resolve("BaseViewController","onJobQuickSearch")}}}),r.edit_view_ui_dic.job_quick_search.setCheckBox(!0),r.edit_view_ui_dic[t].setCheckBox(!0)):"job_item_quick_search"===e&&(n.filter_data={manual_id:i,job_id:this.current_edit_record[t],status_id:"10"},this.job_item_api.getJobItem(n,{onResult:function(e){if(r.edit_view_ui_dic&&r.edit_view_ui_dic[a]){var i=e.getResult();i.length>0?(r.edit_view_ui_dic[a].setValue(i[0].id),r.current_edit_record[a]=i[0].id):(r.edit_view_ui_dic[a].setValue(""),r.current_edit_record[a]=!1),TTPromise.resolve("BaseViewController","onJobQuickSearch")}}}),this.edit_view_ui_dic.job_item_quick_search.setCheckBox(!0),this.edit_view_ui_dic[a].setCheckBox(!0)))}onCancelClick(e,i,t){TTPromise.add("base","onCancelClick");var a=this;function s(e,i,t){!a.edit_view&&a.parent_view_controller&&a.sub_view_mode?(a.parent_view_controller.is_changed=!1,a.parent_view_controller.confirm_on_exit=!1,a.parent_view_controller.buildContextMenu(!0),a.parent_view_controller.onCancelClick(!0)):a.removeEditView(!0),i&&(LocalCacheData.current_open_edit_only_controller?LocalCacheData.current_open_edit_only_controller.onCancelClick(e,i):LocalCacheData.current_open_sub_controller&&LocalCacheData.current_open_sub_controller.edit_view?LocalCacheData.current_open_sub_controller.onCancelClick(e,i):LocalCacheData.current_open_primary_controller&&LocalCacheData.current_open_primary_controller.edit_view?LocalCacheData.current_open_primary_controller.onCancelClick(e,i):LocalCacheData.current_open_report_controller&&LocalCacheData.current_open_report_controller.onCancelClick(e,i)),t&&t(),Global.setUIInitComplete(),TTPromise.resolve("base","onCancelClick")}!e&&(1==a.is_changed||LocalCacheData.current_open_primary_controller&&LocalCacheData.current_open_primary_controller.edit_view&&1==LocalCacheData.current_open_primary_controller.is_changed||LocalCacheData.current_open_report_controller&&1==LocalCacheData.current_open_report_controller.is_changed||LocalCacheData.current_open_edit_only_controller&&1==LocalCacheData.current_open_edit_only_controller.is_changed||LocalCacheData.current_open_sub_controller&&LocalCacheData.current_open_sub_controller.edit_view&&1==LocalCacheData.current_open_sub_controller.is_changed)&&(this.confirm_on_exit=!0),LocalCacheData.current_doing_context_action="cancel",1==this.confirm_on_exit?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(a){!0===a?s(e,i,t):TTPromise.reject("base","onCancelClick")})):s(e,i,t)}onFormItemChange(e,i){if(this.current_edit_record){this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var t=e.getField();this.current_edit_record[t]=e.getValue(),i||this.validate()}}setIsChanged(e){var i=e.getField();this.current_edit_record&&this.current_edit_record[i]!=e.getValue()&&(this.is_changed=!0)}onFormItemKeyUp(e){}onFormItemKeyDown(e){}setMassEditingFieldsWhenFormChange(e){var i=this;if(this.is_mass_editing){var t=e.getField(),a=[],s=!1;$.each(this.linked_columns,(function(e,i){i!==t?a.push(i):s=!0})),s&&$.each(a,(function(e,a){var s=i.edit_view_ui_dic[t].isChecked();i.edit_view_ui_dic[a].setCheckBox(s)}))}}setTabLabels(e){for(var i in e)this.edit_view.find("a[ref="+i+"]").text(e[i])}getTabModel(){return this.tab_model}setTabModel(e){var i={};for(var t in e)"tab_audit"==t&&!0===e[t]?e.tab_audit={"label":$.i18n._("Audit"),"init_callback":"initSubLogView","display_on_mass_edit":!1,"display_on_add":!1}:"tab_attachment"==t&&!0===e[t]&&(e.tab_attachment={"label":$.i18n._("Attachment"),"init_callback":"initSubDocumentView","display_on_mass_edit":!1}),e[t].hasOwnProperty("label")&&""!=e[t].label&&(i[t]=e[t].label);return this.tab_model=e,this.setTabLabels(i),!0}onTabShow(e,i){if(this.current_edit_record){var t=this.getEditViewTabIndex();this.editFieldResize(t);var a=this.getTabModel();if(null!=a){if(i&&i.oldTab){var s=i.oldTab.find("a")[0].getAttribute("href").substring(1);a[s]&&a[s].hasOwnProperty("on_exit_callback")&&""!=a[s].on_exit_callback&&this[a[s].on_exit_callback](s)}var r=null,n=null,o=this.edit_view.find(".edit-view-tab-bar li.ui-tabs-active").find("a");o.length>0&&(r=o[0].getAttribute("href").substring(1),n=this.edit_view_tab.find("#"+r).find(".first-column-sub-view")),n&&n.length>0&&this.tab_model[r]&&!this.tab_model[r].initialized&&(TTPromise.add("BaseViewController","onTabShow"),TTPromise.wait("BaseViewController","onTabShow",(function(){n.css("opacity","1")})),n.css("opacity","0"),this.tab_model[r].initialized=!0),a[r]?a[r].hasOwnProperty("init_callback")&&""!=a[r].init_callback?this[a[r].init_callback](r):this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(this.buildContextMenu(!0),this.setEditMenu()):this.edit_view.find(".save-and-continue-div").css("display","block"):(this.buildContextMenu(!0),this.setEditMenu())}else 1===t?this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","block"),this.initSubLogView("tab_audit")):(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".save-and-continue-div").css("display","block")):(this.buildContextMenu(!0),this.setEditMenu())}}checkTabPermissions(e){var i=!0;switch(e){case"tab_audit":i=this.subAuditValidate();break;case"tab_attachment":i=this.subDocumentValidate()}return i}setTabStatus(){if(this.edit_view_tab){var e=this.getTabModel();if(null!=e){var i=Array();for(var t in e){var a=$(this.edit_view_tab.find('ul li a[ref="'+t+'"]')).parent().index();this.is_mass_editing&&e[t].hasOwnProperty("display_on_mass_edit")&&0==e[t].display_on_mass_edit||(this.is_add||this.is_mass_adding)&&e[t].hasOwnProperty("display_on_add")&&0==e[t].display_on_add?$(this.edit_view_tab.find('ul li a[ref="'+t+'"]')).parent().hide():1==this.checkTabPermissions(t)?($(this.edit_view_tab.find('ul li a[ref="'+t+'"]')).parent().show(),i.push(a)):$(this.edit_view_tab.find('ul li a[ref="'+t+'"]')).parent().hide()}(i=i.sort((function(e,i){return e-i})))[0]&&this.edit_view_tab.tabs("option","active",i[0])}else this.is_mass_editing?($(this.edit_view_tab.find('ul li a[ref="tab_audit"]')).parent().hide(),this.edit_view_tab.tabs("option","active",0)):this.subAuditValidate()?$(this.edit_view_tab.find('ul li a[ref="tab_audit"]')).parent().show():($(this.edit_view_tab.find('ul li a[ref="tab_audit"]')).parent().hide(),this.edit_view_tab.tabs("option","active",0));this.editFieldResize(0)}}onTabIndexChange(e){if(TTPromise.add("BaseViewController","onTabIndexChange"),TTPromise.wait(),!this.sub_view_mode&&!this.edit_only_mode||"function"==typeof this.initReport){var i=window.location.href;i.indexOf("&tab")>0&&(i=i.substring(0,i.indexOf("&tab")));var t=this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text();i=i+"&tab="+(t=t.replace(/\/|\s+/g,"")),Global.setURLToBrowser(i)}this.hideErrorTips(),TTPromise.resolve("BaseViewController","onTabIndexChange")}hideErrorTips(){for(var e in this.edit_view_error_ui_dic)this.edit_view_error_ui_dic[e]&&"function"==typeof this.edit_view_error_ui_dic[e].hideErrorTip&&this.edit_view_error_ui_dic[e].hideErrorTip();this.removeEditViewErrorTip()}removeEditViewErrorTip(){$(".qtip2-error-tip:visible")&&$(".qtip2-error-tip").remove()}onCountryChange(){var e=this.edit_view_ui_dic.country.getValue();this.eSetProvince(e,!0),this.clearErrorTips(),this.setEditMenu()}validate(e){if(this.enable_validation){if(null==e)e=this.api;var i=this,t={};if(this.is_mass_editing){for(var a in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(a)){var s=this.edit_view_ui_dic[a];Global.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled()&&(t[a]=this.current_edit_record[a])}}else t=this.current_edit_record;t=this.uniformVariable(t),e["validate"+e.key_name](t,{onResult:function(e){i.validateResult(e)}})}else Debug.Text("Validation disabled","BaseViewController.js","BaseViewController","validate",10)}validateResult(e){var i=this;i.clearErrorTips(),i.edit_view&&e&&(e.isValid()?(i.edit_view.attr("validate_complete",!0),i.setEditMenu()):(i.setErrorMenu(),i.setErrorTips(e,this.show_warning_when_validation)))}clearErrorTips(){for(var e in this.edit_view_error_ui_dic)this.edit_view_error_ui_dic.hasOwnProperty(e)&&this.edit_view_error_ui_dic[e]&&this.edit_view_error_ui_dic[e].clearErrorStyle();if(this.removeEditViewErrorTip(),$(".error-tab").removeClass("error-tab"),$(".error-tab-hide").removeClass("error-tab-hide"),$(".warning-tab").removeClass("warning-tab"),$(".warning-tab-hide").removeClass("warning-tab-hide"),this.pulse_time_dic){for(var i in this.pulse_time_dic)clearInterval(this.pulse_time_dic[i]);this.pulse_time_dic={}}this.edit_view_error_ui_dic={},$(".qtip").remove()}setErrorTips(e,i){if(this.clearErrorTips(),Global.isSet(i)||(i=!0),this.edit_view_tab){var t=e.getDetails(),a=0;for(var a in t)break;t&&t[a]&&t[a].hasOwnProperty("error")?this.setErrorTipsError(e):t&&t[a]&&t[a].hasOwnProperty("warning")?(i&&this.setErrorTipsWarning(e),this.setEditMenu()):"PERMISSION"==e.getCode()?TAlertManager.showErrorAlert(e):this.setErrorTipsError(e)}}setErrorTipsWarning(e){var i,t=this,a=LocalCacheData.current_doing_context_action;"validate"!=a&&TAlertManager.showWarningAlert(e,(function(e){if(e)switch(a){case"save":t.onSaveClick(!0);break;case"save_and_continue":t.onSaveAndContinue(!0);break;case"save_and_next":t.onSaveAndNextClick(!0);break;case"save_and_copy":t.onSaveAndCopy(!0);break;case"new":t.onSaveAndNewClick(!0)}else t.show_warning_when_validation=!0}));var s=[];1==e.getDetails().length&&(s=e.getDetails()[0].warning);var r=!1;for(var n in s)if(s.hasOwnProperty(n)){if(Global.isSet(this.edit_view_ui_dic[n])&&this.edit_view_ui_dic[n].closest(document.documentElement).length>0)i=this.edit_view_ui_dic[n];else if(Global.isSet(this.edit_view_ui_validation_field_dic[n]))if(Global.isArray(this.edit_view_ui_validation_field_dic[n]))for(var o=this.edit_view_ui_validation_field_dic[n].length,l=0;l<o;l++){var d=this.edit_view_ui_validation_field_dic[n][l];if(d.closest(document.documentElement).length>0){i=d;break}}else{if(!(this.edit_view_ui_validation_field_dic[n].closest(document.documentElement).length>0))continue;i=this.edit_view_ui_validation_field_dic[n]}else{if(!(n.indexOf("_id")<0&&Global.isSet(this.edit_view_ui_dic[n+"_id"])&&this.edit_view_ui_dic[n+"_id"].closest(document.documentElement).length>0))continue;i=this.edit_view_ui_dic[n+"_id"]}if(s[n]){var _=!1;i.is(":visible")&&(_=!0,r=!0),"function"==typeof i.setErrorStyle&&i.setErrorStyle(s[n],_,!0)}this.showErrorStatusOnTab(i,!1),this.edit_view_error_ui_dic[n]=i}r||this.showEditViewError(e)}showErrorStatusOnTab(e,i){for(var t=e.parent(),a=0;!t.hasClass("edit-view-tab-outside")&&a<5;)a+=1,t=t.parent();if(t.hasClass("edit-view-tab-outside")){var s=t.attr("id"),r=this.edit_view.find('a[ref="'+s+'"]');i?(r.parent().addClass("error-tab"),this.startPulse(s,r.parent())):(r.parent().addClass("warning-tab"),this.startPulse(s,r.parent(),!0))}}startPulse(e,i,t){var a=this;function s(e){clearInterval(a.pulse_time_dic[e]),a.pulse_time_dic[e]=null}this.pulse_time_dic||(this.pulse_time_dic={}),this.pulse_time_dic[e]&&s(e),this.pulse_time_dic[e]=setInterval((function(){t?i.hasClass("warning-tab-hide")?i.removeClass("warning-tab-hide"):i.hasClass("warning-tab")?i.addClass("warning-tab-hide"):s(e):i.hasClass("error-tab-hide")?i.removeClass("error-tab-hide"):i.hasClass("error-tab")?(i.addClass("error-tab-hide"),s(e),setTimeout((function(){i.hasClass("error-tab-hide")&&i.removeClass("error-tab-hide"),a.startPulse(e,i,t)}),1700)):s(e)}),2e3)}setErrorTipsError(e){var i=e.getDetails()?e.getDetails():{},t=0;for(var t in i)break;var a,s=i?i[t]:{};s&&s.hasOwnProperty("error")&&(s=s.error);var r=!1;for(var n in s)if(s.hasOwnProperty(n)){if(Global.isSet(this.edit_view_ui_dic[n])&&this.edit_view_ui_dic[n].closest(document.documentElement).length>0)a=this.edit_view_ui_dic[n];else if(Global.isSet(this.edit_view_ui_validation_field_dic[n]))if(Global.isArray(this.edit_view_ui_validation_field_dic[n]))for(var o=this.edit_view_ui_validation_field_dic[n].length,l=0;l<o;l++){var d=this.edit_view_ui_validation_field_dic[n][l];if(d.closest(document.documentElement).length>0){a=d;break}}else{if(!(this.edit_view_ui_validation_field_dic[n].closest(document.documentElement).length>0))continue;a=this.edit_view_ui_validation_field_dic[n]}else{if(!(n.indexOf("_id")<0&&Global.isSet(this.edit_view_ui_dic[n+"_id"])&&this.edit_view_ui_dic[n+"_id"].closest(document.documentElement).length>0))continue;a=this.edit_view_ui_dic[n+"_id"]}a.is(":visible")?a.setErrorStyle&&"function"==typeof a.setErrorStyle?(a.setErrorStyle(s[n],!0),r=!0):Debug.Text("ERROR: widget.setErrorStyle is not a function.","BaseViewController.js","BaseViewController",null,10):a.setErrorStyle&&"function"==typeof a.setErrorStyle?a.setErrorStyle(s[n]):Debug.Text("ERROR: widget.setErrorStyle is not a function.","BaseViewController.js","BaseViewController",null,10),this.showErrorStatusOnTab(a,!0),this.edit_view_error_ui_dic[n]=a}r||this.showEditViewError(e)}showEditViewError(e){var i=e.getDetails()[0],t=!0;if(i){i.hasOwnProperty("error")?(i=i.error,t=!0):i.hasOwnProperty("warning")&&(t=!1,i=i.warning);var a;a=Global.convertValidationErrorToString(i),this.removeEditViewErrorTip(),this.edit_view.children().eq(0).children().eq(2).qtip({show:{when:!1,ready:!0},events:{hide:function(e,i){e.preventDefault()}},content:a,style:{classes:t?"qtip2-error-tip":"qtip2-warning-tip",tip:{corner:"bottom center"}},position:{my:"bottom left",at:"top center"}})}}selectContextMenu(){if(TopMenuManager.selected_menu_id!==this.viewId+"ContextMenu"&&TopMenuManager.ribbon_view_controller){var e=$(TopMenuManager.ribbon_view_controller.el);e&&(e.tabs("refresh"),e.find("[aria-controls="+this.viewId+"ContextMenu] a").trigger("click"))}}openEditView(){this.edit_view||this.initEditViewUI(this.viewId,this.edit_view_tpl)}setTabOVisibility(e){var i=$(this.edit_view_tab.find(".edit-view-tab")[0]);e?(i.css("opacity",1),this.setEditViewTabSize(),this.edit_view_close_icon&&this.edit_view_close_icon.show()):(this.edit_view_tab.find("ul li").hide(),i.css("opacity",0))}setEditViewWidgetsMode(){var e={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];t.css("opacity",1);var a=t.parent().parent().parent(),s=a.parent().attr("id");a.hasClass("v-box")||e[s]||(e[s]=!0),this.is_viewing?Global.isSet(t.setEnabled)&&t.setEnabled(!1):Global.isSet(t.setEnabled)&&t.setEnabled(!0)}}initEditViewUI(e,i){Global.setUINotready(),TTPromise.add("init","init"),TTPromise.wait();var t=this;this.edit_view&&this.edit_view.remove(),this.edit_view=$(Global.loadViewSource(e,i,null,!0)),this.edit_view_tab=$(this.edit_view.find(".edit-view-tab-bar")),this.edit_view_tab.css("opacity",0),this.edit_view_tab.attr("id",this.ui_id+"_edit_view_tab"),this.setTabOVisibility(!1),this.edit_view_tab=this.edit_view_tab.tabs({activate:function(e,i){t.edit_view_tab&&t.edit_view_tab.is(":visible")&&(t.onTabShow(e,i),Global.triggerAnalyticsTabs(e,i))}}),this.edit_view_tab.off("click").on("click",(function(e){t.onTabIndexChange(e)})),Global.contentContainer().append(this.edit_view),this.initRightClickMenu(RightClickMenuType.EDITVIEW),this.buildEditViewUI(),t.setEditViewTabHeight(),TTPromise.wait("init","init",(function(){$(".edit-view-tab-bar").css("opacity",1)}))}setEditViewTabHeight(){}initEditView(){this.show_warning_when_validation=!1,this.edit_view_tab&&(this.setURL(),this.setEditMenu(),ProgressBar.closeOverlay(),this.edit_view_tab&&this.edit_view_tab.find("ul li").show(),this.setTabStatus(),this.clearEditViewData(),this.setEditViewWidgetsMode(),this.setEditViewData(),this.setOtherFields(),this.setFocusToFirstInput())}setOtherFields(){var e=this,i=this.getOtherFieldTypeId();if(0!==i){var t={filter_data:{type_id:i}};$(this.edit_view_tab.find(".edit-view-tab-outside")[0]).find(".first-column");this.other_field_api.getOtherField(t,!0,{onResult:function(i){var t=i.getResult();if("array"===$.type(t)&&t.length>0){t=t[0];for(var a=1;a<10;a++)t["other_id"+a]&&e.buildOtherFieldUI("other_id"+a,t["other_id"+a]);e.editFieldResize(0)}e.resetLastWidgetStyle()}})}}getOtherFieldReferenceField(){return!1}buildOtherFieldUI(e,i){var t=PermissionManager.getPermissionData();if(Global.isSet(t[this.permission_id]["edit_"+e])&&0==PermissionManager.validate(this.permission_id,"edit_"+e))return!1;if(this.edit_view_tab){var a,s=this,n=$(this.edit_view_tab.find(".edit-view-tab-outside")[0]).find(".first-column");if(s.edit_view_ui_dic[e])(a=s.edit_view_ui_dic[e]).setValue(s.current_edit_record[e]);else{(a=Global.loadWidgetByName(r.FormItemType.TEXT_INPUT)).TTextInput({field:e});var o=s.addEditFieldToColumn(i,a,n);!1!==this.getOtherFieldReferenceField()&&null!=s.edit_view_ui_dic[this.getOtherFieldReferenceField()]&&o.insertBefore(s.edit_view_ui_dic[this.getOtherFieldReferenceField()].parent().parent()),this.current_edit_record&&a.setValue(this.current_edit_record[e])}a.css("opacity",1),a.css("minWidth",300),s.is_viewing?a.setEnabled(!1):a.setEnabled(!0),this.is_mass_editing&&a.setMassEditMode(!0)}}resetLastWidgetStyle(){this.edit_view_tab&&this.edit_view}getOtherFieldTypeId(){var e=0;switch(this.viewId){case"Employee":e=10;break;case"Document":e=80;break;case"Job":e=20;break;case"JobItem":e=30;break;case"Product":e=60;break;case"Invoice":e=70;break;case"ClientContact":e=55;break;case"Client":e=50;break;case"UserTitle":e=12;break;case"Department":e=5;break;case"Company":case"Companies":e=2;break;case"Branch":e=4;break;case"Schedule":case"ScheduleShift":e=18;break;case"TimeSheet":case"Punches":case"InOut":e=15}return e}setURL(){var e="";switch(LocalCacheData.current_doing_context_action){case"new":case"edit":case"view":e=LocalCacheData.current_doing_context_action;break;case"copy_as_new":e="new"}if(this.canSetURL()){var i=this.edit_view_tab?this.edit_view_tab.find(".edit-view-tab-bar-label").children().eq(this.getEditViewTabIndex()).text():"";i=i.replace(/\/|\s+/g,""),this.current_edit_record&&this.current_edit_record.id?(e?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a="+e+"&id="+this.current_edit_record.id+"&tab="+i):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&id="+this.current_edit_record.id),Global.trackView(this.viewId,LocalCacheData.current_doing_context_action)):e?"edit"===e?Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a=new&tab="+i):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId+"&a="+e+"&tab="+i):Global.setURLToBrowser(Global.getBaseURL()+"#!m="+this.viewId)}}canSetURL(){return!this.sub_view_mode&&!this.edit_only_mode}setFocusToFirstInput(){if(!Global.UNIT_TEST_MODE&&!$("body").hasClass("mobile-device-mode")&&!this.is_viewing)if("ScheduleView"===this.script_name)this.edit_view_ui_dic.start_time&&(this.edit_view_ui_dic.start_time.children().eq(0).focus(),this.edit_view_ui_dic.start_time.children().eq(0)[0].select());else for(var e in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];if(!0===i.is(":visible")){if(i.hasClass("t-text-input")&&!i.attr("readonly")){i.focus(),i[0].select();break}if(i.hasClass("t-time-picker-div")&&!i.children().eq(0).attr("readonly")){i.children().eq(0).focus(),i.children().eq(0)[0].select();break}if(i.hasClass("t-date-picker-div")&&!i.children().eq(0).attr("readonly")){i.children().eq(0).focus(),i.children().eq(0)[0].select();break}}}}initNavigationWidget(e){this.navigation||(this.navigation=Global.loadWidgetByName(r.FormItemType.AWESOME_BOX)),e.append(this.navigation)}buildEditViewUI(){var e=this;if(this.edit_view){if(!this.edit_only_mode){var i=this.edit_view.find(".navigation-div"),t=i.find(".navigation-label"),a=i.find(".left-click"),s=i.find(".right-click"),r=i.find(".navigation-widget-div");this.initNavigationWidget(r),a.attr("src",Global.getRealImagePath("images/left_arrow.png")),s.attr("src",Global.getRealImagePath("images/right_arrow.png")),t.text(this.navigation_label)}this.edit_view_close_icon=this.edit_view.find(".close-icon"),this.edit_view_close_icon.hide(),this.edit_view_close_icon.click((function(){e.onCloseIconClick()}))}this.edit_view_ui_dic={},this.edit_view_ui_validation_field_dic={},this.edit_view_form_item_dic={},this.edit_view_error_ui_dic={}}onCloseIconClick(){LocalCacheData.current_open_sub_controller?LocalCacheData.current_open_sub_controller.onCancelClick():this.onCancelClick(),Global.triggerAnalyticsNavigationOther("close-X","click",this.viewId)}setWidgetVisible(e){var i=e;if(Global.isArray(e))for(var t=0;t<e.length;t++)(i=e[t]).css("opacity",1);else i.css("opacity",1)}addEditFieldToColumn(e,i,t,a,s,n,o,l,d,_){var c=this,u=$(Global.loadWidgetByName(r.WidgetNamesDic.EDIT_VIEW_FORM_ITEM)),h=u.find(".edit-view-form-item-label-div"),g=u.find(".edit-view-form-item-label"),v=u.find(".edit-view-form-item-input-div"),b=i;if(Global.isArray(i))for(var m=0;m<i.length;m++)(b=i[m]).css("opacity",0);else b.css("opacity",0);if(_?(g.parent().append(_),g.remove()):(g.text(e+": "),e&&-1!==e.indexOf("\n")&&g.html(g.html().replace(/\n/g,"<br>"))),Global.isSet(s)?v.append(s):v.append(b),t.append(u),u.height()>35?h.css("height",u.height()):b.hasClass("a-dropdown")&&h.css("height",240),o&&!Global.UNIT_TEST_MODE&&(u.unbind("resize").bind("resize",(function(){h.height()!==u.height()&&u.height()>0&&h.css("height",u.height())})),b.unbind("setSize").bind("setSize",(function(){h.css("height",b.height()+10)}))),!e)return v.remove(),h.remove(),u.append(b),b.css("opacity",1),void(n&&l&&(this.edit_view_form_item_dic[l]=u));if(n&&(Global.isArray(i)?this.edit_view_form_item_dic[i[0].getField()]=u:this.edit_view_form_item_dic[b.getField()]=u),Global.isArray(i))for(m=0;m<i.length;m++)b=i[m],this.edit_view_ui_dic[b.getField()]=b,p(),b.unbind("formItemChange").bind("formItemChange",(function(e,i,t){c.onFormItemChange(i,t)})),d&&(b.unbind("formItemKeyUp").bind("formItemKeyUp",(function(e,i){c.onFormItemKeyUp(i)})),b.unbind("formItemKeyDown").bind("formItemKeyDown",(function(e,i){c.onFormItemKeyDown(i)})));else this.edit_view_ui_dic[b.getField()]=b,p(),b.bind("formItemChange",(function(e,i,t){c.onFormItemChange(i,t)})),d&&(b.bind("formItemKeyUp",(function(e,i){c.onFormItemKeyUp(i)})),b.bind("formItemKeyDown",(function(e,i){c.onFormItemKeyDown(i)})));function p(){b.hasOwnProperty("getValidationField")&&b.getValidationField()&&(c.edit_view_ui_validation_field_dic[b.getValidationField()]?Global.isArray(c.edit_view_ui_validation_field_dic[b.getValidationField()])?c.edit_view_ui_validation_field_dic[b.getValidationField()].push(b):c.edit_view_ui_validation_field_dic[b.getValidationField()]=[c.edit_view_ui_validation_field_dic[b.getValidationField()],b]:c.edit_view_ui_validation_field_dic[b.getValidationField()]=b)}return u}editFieldResize(e){if(Global.isSet(e)||(e=this.getEditViewTabIndex()),Global.isSet(this.edit_view_tabs[e])&&!Global.isFalseOrNull(this.edit_view_tabs[e])&&this.edit_view_tabs[e].length>0)for(var i=this.edit_view_tabs[e],t=0;t<i.length;t++){var a=i[t].find(".edit-view-form-item-label-div"),s=i[t].find(".edit-view-form-item-sub-label-div > span");Global.isSet(s)&&s.length>0&&this.setEditFieldSize(s),this.setEditFieldSize(a)}}setEditFieldSize(e,i){if(Global.isSet(i))e.each((function(){$(this).width(i)}));else{var t=[];e.each((function(){if(0===$(this).width())return!0;$(this).css("width","auto"),t.push($(this).width())})),t.sort((function(e,i){return i-e})),e.each((function(){t[0]>=0&&$(this).width(t[0]+1)}))}}setNavigation(){var e=this;this.grid&&(this.navigation.setPossibleDisplayColumns(this.buildDisplayColumnsByColumnModel(this.grid.getColumnModel()),this.buildDisplayColumns(this.default_display_columns)),this.navigation.unbind("formItemChange").bind("formItemChange",(function(i,t){t.getField();var a=t.getValue();a&&(a!==e.current_edit_record.id&&(ProgressBar.showOverlay(),e.is_viewing?e.onViewClick(a):e.onEditClick(a)),e.setNavigationArrowsEnabled(),Global.triggerAnalyticsEditViewNavigation("navigation",e.viewId))})))}clearEditViewData(){for(var e in this.edit_view_ui_dic)this.edit_view_ui_dic.hasOwnProperty(e)&&(_.isFunction(this.edit_view_ui_dic[e].setEmptyValueAndShowLoading)?this.edit_view_ui_dic[e].setEmptyValueAndShowLoading():this.edit_view_ui_dic[e].setValue(null),this.edit_view_ui_dic[e].clearErrorStyle())}setEditViewData(){this.is_changed=!1,this.initEditViewData(),this.initTabData(),this.switchToProperTab()}switchToProperTab(){if(LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().hasOwnProperty("tab")&&LocalCacheData.getAllURLArgs().tab.length>0&&LocalCacheData.current_open_primary_controller.viewId===this.viewId){var e=this.edit_view_tab.find(".edit-view-tab-bar-label").children().filter((function(){return $(this).text().replace(/\/|\s+/g,"")===LocalCacheData.getAllURLArgs().tab})),i=0;e.length>0&&(i=(e=$(e[0])).index()),this.edit_view_tab.tabs("option","active",i)}}initTabData(){null!=this.getTabModel()?this.onTabShow():1===this.getEditViewTabIndex()&&(this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","block"),this.initSubLogView("tab_audit")):(this.edit_view_tab.find("#tab_audit").find(".first-column-sub-view").css("display","none"),this.edit_view.find(".save-and-continue-div").css("display","block")))}getEditViewTabIndex(){return this.edit_view.find(".edit-view-tab-bar li.ui-tabs-active").index()}getEditViewActiveTabName(){return this.edit_view.find(".edit-view-tab-bar li.ui-tabs-active").attr("aria-controls")}needShowNavigation(){return!!(this.current_edit_record&&Global.isSet(this.current_edit_record.id)&&this.current_edit_record.id)}initEditViewData(){var e=this;if(!this.edit_only_mode&&this.navigation&&this.grid){var i=this.grid.getData(),t=this.edit_view.find(".navigation-div");if(this.needShowNavigation()){if(t.css("display","block"),this.navigation.setSourceData(i),this.navigation.setPagerData(this.pager_data),!this.navigation.getSourceData()){LocalCacheData.getLoginUserPreference()&&this.navigation.setRowPerPage(LocalCacheData.getLoginUserPreference().items_per_page),this.navigation.setPagerData(this.pager_data);var a={};a.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),a.filter_sort=this.select_layout.data.filter_sort,this.navigation.setDefaultArgs(a)}this.navigation.setValue(this.current_edit_record)}else t.css("display","none")}if(this.setUIWidgetFieldsToCurrentEditRecord(),this.is_mass_editing){for(var s in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(s))if(this.unique_columns&&this.unique_columns.length>0&&-1!=this.unique_columns.indexOf(s))e.edit_view_ui_dic[s].css("opacity","0"),e.edit_view_ui_dic[s].setEnabled&&e.edit_view_ui_dic[s].setEnabled(!1),e.edit_view_ui_dic[s].setMassEditMode&&e.edit_view_ui_dic[s].setMassEditMode(!1);else{var r=this.edit_view_ui_dic[s];Global.isSet(r.setMassEditMode)&&r.setMassEditMode(!0),e.edit_view_ui_dic[s].css("opacity","1")}}else for(var s in this.edit_view_ui_dic)e.edit_view_ui_dic[s].css("opacity","1");this.setNavigationArrowsStatus(),this.setCurrentEditRecordData(),this.edit_view.find(".save-and-continue-div").SaveAndContinueBox({related_view_controller:this}),this.edit_view.find(".save-and-continue-div").css("display","none")}setUIWidgetFieldsToCurrentEditRecord(){var e=this;for(var i in!0===e.current_edit_record&&(e.current_edit_record={}),this.edit_view_ui_dic)this.edit_view_ui_dic.hasOwnProperty(i)&&e.current_edit_record&&!Global.isSet(e.current_edit_record[i])&&(e.current_edit_record[i]=!1)}setDefaultData(e,i){var t=this;$.each(e,(function(e,a){1!=i&&Global.isSet(t.current_edit_record[e])||(1==i?t.edit_view_ui_dic[e]&&(t.edit_view_ui_dic[e].setValue(a),t.current_edit_record[e]=a):t.current_edit_record[e]=a)}))}collectUIDataToCurrentEditRecord(){if(!this.is_mass_editing){var e=this;for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];if(t.hasClass("t-select")){var a=t.getValue();a&&e.current_edit_record&&e.current_edit_record[i]!=a&&(!a||"0"===a||Global.isArray(a)&&0===a.length?e.current_edit_record[i]=!1:e.current_edit_record[i]=a)}}}}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];if(Global.isSet(i))switch(e){case"country":this.setCountryValue(i,e);break;default:i.setValue(this.current_edit_record[e])}}this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}setCountryValue(e,i){this.current_edit_record.province?this.eSetProvince(this.current_edit_record[i]):this.eSetProvince(this.current_edit_record[i],!0),e.setValue(this.current_edit_record[i])}putInputToInsideFormItem(e,i){var t=$(Global.loadWidgetByName(r.WidgetNamesDic.EDIT_VIEW_SUB_FORM_ITEM)),a=t.find(".edit-view-form-item-label"),s=t.find(".edit-view-form-item-input-div");return t.addClass("remove-margin"),a.text($.i18n._(i)+": "),s.append(e),t}setEditViewDataDone(){this.setTabOVisibility(!0),TTPromise.resolve("init","init"),$(".edit-view-tab-bar").css("opacity",1)}setNavigationArrowsStatus(){if(this.edit_view){var e=this.edit_view.find(".left-click"),i=this.edit_view.find(".right-click"),t=this;e.unbind("click").click((function(){e.hasClass("disabled")||t.onLeftArrowClick()})),i.unbind("click").click((function(){i.hasClass("disabled")||t.onRightArrowClick()})),this.setNavigationArrowsEnabled()}}setNavigationArrowsEnabled(){if(this.edit_view){var e=this.edit_view.find(".left-click"),i=this.edit_view.find(".right-click");if(e.removeClass("disabled"),i.removeClass("disabled"),this.navigation&&this.navigation.hasOwnProperty("getSelectIndex")){var t=this.navigation.getSelectIndex(),a=this.navigation.getSourceData();if(!a)return e.addClass("disabled"),void i.addClass("disabled");var s=this.navigation.getPagerData();s?(0===t&&1===s.current_page&&e.addClass("disabled"),t===a.length-1&&s.current_page===s.last_page_number&&i.addClass("disabled")):(0===t&&e.addClass("disabled"),t===a.length-1&&i.addClass("disabled"))}}}onLeftArrowClick(e){var i=this;function t(){var t,a=i.navigation.getSelectIndex(),s=(i.navigation.getSourceData(),i.navigation.getPagerData());if(a>0)t=i.navigation.getItemByIndex(a-1),i.onRightOrLeftArrowClickCallBack(t);else{if(!(0===a&&s&&s.current_page>1))return void i.onCancelClick(null,null,e);i.navigation.onADropDownSearch("unselect_grid",s.current_page-1,"last",(function(e){t=e,i.onRightOrLeftArrowClickCallBack(t)}))}}this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(e){!0===e&&(i.is_changed=!1,t()),ProgressBar.closeOverlay()})):t(),Global.triggerAnalyticsEditViewNavigation("left-arrow",this.viewId)}refreshCurrentRecord(){var e=this.navigation.getItemByIndex(this.navigation.getSelectIndex());ProgressBar.showOverlay(),this.is_viewing?this.onViewClick(e.id):this.onEditClick(e.id),this.setNavigationArrowsEnabled()}getRightArrowClickSelectedIndex(e){return e}onRightArrowClick(e){var i=this;function t(){var t,a=i.getRightArrowClickSelectedIndex(i.navigation.getSelectIndex()),s=i.navigation.getSourceData(),r=i.navigation.getPagerData();if(s)if(a<s.length-1)t=i.navigation.getItemByIndex(i.navigation.getSelectIndex()+1),i.onRightOrLeftArrowClickCallBack(t);else{if(!(a===s.length-1&&r&&r.current_page<r.last_page_number))return void i.onCancelClick(null,null,e);i.navigation.onADropDownSearch("unselect_grid",r.current_page+1,"first",(function(e){t=e,i.onRightOrLeftArrowClickCallBack(t)}))}}this.is_changed?TAlertManager.showConfirmAlert(Global.modify_alert_message,null,(function(e){!0===e&&(i.is_changed=!1,t()),ProgressBar.closeOverlay()})):t(),Global.triggerAnalyticsEditViewNavigation("right-arrow",this.viewId)}onRightOrLeftArrowClickCallBack(e){ProgressBar.showOverlay(),this.is_viewing?this.onViewClick(e):this.onEditClick(e.id),this.setNavigationArrowsEnabled(),this.sub_log_view_controller&&this.sub_log_view_controller.search()}setParentContextMenuAfterSubViewClose(){this.parent_view_controller&&(this.parent_view_controller.buildContextMenu(),this.parent_view_controller.edit_view?this.parent_view_controller.setEditMenu():this.parent_view_controller.setDefaultMenu())}clearEditView(){this.edit_view&&(this.clearErrorTips(),this.edit_view.remove()),this.edit_view=null,this.edit_view_tab=null}removeEditView(){if(this.clearEditView(),this.setCurrentEditViewState(""),this.is_changed=!1,this.confirm_on_exit=!1,this.mass_edit_record_ids=[],this.edit_only_mode){var e=window.location.href;e.indexOf("&sm")>0&&(e=e.substring(0,e.indexOf("&sm")),Global.setURLToBrowser(e)),LocalCacheData.current_open_edit_only_controller=null}this.edit_only_mode?this.setParentContextMenuAfterSubViewClose():(TopMenuManager.selected_menu_id+"ContextMenu"!=LocalCacheData.currentShownContextMenuName&&this.buildContextMenu(!0),this.setDefaultMenu()),this.reSetURL(),LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().a&&(LocalCacheData.current_doing_context_action=LocalCacheData.getAllURLArgs().a),this.sub_log_view_controller=null,this.edit_view_ui_dic={},this.edit_view_ui_validation_field_dic={},this.edit_view_form_item_dic={},this.edit_view_error_ui_dic={},this.current_edit_record=null,this.sub_document_view_controller&&(this.sub_document_view_controller=null)}reSetURL(){if(this.canSetURL()){var e="#!m="+this.viewId;Global.setURLToBrowser(Global.getBaseURL()+e),LocalCacheData.setAllURLArgs(Global.buildArgDic(e.split("&")))}}getGridSelectIdArray(){return this.grid?this.grid.getSelectedRows():[]}setDefaultMenuAddIcon(e,i,t){this.addPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image")}setDefaultMenuEditIcon(e,i,t){this.editPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),1===i&&this.editOwnerOrChildPermissionValidate(t)?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuViewIcon(e,i,t){this.viewPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),1===i&&this.viewOwnerOrChildPermissionValidate()?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuMassEditIcon(e,i,t){this.editPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),i>1?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuCopyIcon(e,i,t){this.copyPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),i>=1?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuDeleteIcon(e,i,t){this.deletePermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),i>=1&&this.deleteOwnerOrChildPermissionValidate(t)?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuDeleteAndNextIcon(e,i,t){this.deletePermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuSaveIcon(e,i,t){this.addPermissionValidate(t)||this.editPermissionValidate(t)||e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuSaveAndNextIcon(e,i,t){(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)||this.edit_only_mode)&&e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuSaveAndCopyIcon(e,i,t){(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)||this.edit_only_mode)&&e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuSaveAndContinueIcon(e,i,t){(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)||this.edit_only_mode)&&e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuSaveAndAddIcon(e,i,t){(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)||this.edit_only_mode)&&e.addClass("invisible-image"),e.addClass("disable-image")}setDefaultMenuCopyAsNewIcon(e,i,t){this.copyAsNewPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image"),1===i?e.removeClass("disable-image"):e.addClass("disable-image")}setDefaultMenuLoginIcon(e,i,t){PermissionManager.validate("company","login_other_user")||e.addClass("invisible-image"),1!==this.getGridSelectIdArray().length&&e.addClass("disable-image")}setDefaultMenuCancelIcon(e,i,t){this.sub_view_mode||e.addClass("disable-image")}setDefaultMenuExportIcon(e,i,t){this.edit_only_mode?e.addClass("invisible-image"):(0==i||this.is_add||this.is_viewing||this.is_mass_adding||this.is_edit||null==this.grid)&&e.addClass("disable-image")}setDefaultMenuImportIcon(e,i,t){this.addPermissionValidate(t)&&!this.edit_only_mode||e.addClass("invisible-image")}setDefaultMenuPermissionWizardIcon(e,i){e.addClass("disable-image")}setEditMenuPermissionWizardIcon(e,i){}setEditMenuImportIcon(e,i){this.edit_only_mode&&e.addClass("invisible-image")}setEditMenuAddIcon(e,i){this.addPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),1==this.is_add&&e.addClass("disable-image")}setEditMenuEditIcon(e,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.is_viewing&&this.editOwnerOrChildPermissionValidate(i)||e.addClass("disable-image")}setEditMenuNavEditIcon(e,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image")}setEditMenuNavViewIcon(e,i){this.viewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image")}setEditMenuViewIcon(e,i){this.viewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),e.addClass("disable-image")}setEditMenuMassEditIcon(e,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),e.addClass("disable-image")}setEditMenuDeleteIcon(e,i){this.deletePermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&this.deleteOwnerOrChildPermissionValidate(i)||e.addClass("disable-image")}setEditMenuDeleteAndNextIcon(e,i){this.deletePermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&this.deleteOwnerOrChildPermissionValidate(i)||e.addClass("disable-image")}setEditMenuCopyIcon(e,i){this.copyPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id||e.addClass("disable-image")}setEditMenuCopyAndAddIcon(e,i){this.copyAsNewPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&!this.is_viewing||e.addClass("disable-image")}setEditMenuSaveIcon(e,i){this.saveValidate(e,i),this.is_viewing&&e.addClass("disable-image")}setEditMenuSaveAndContinueIcon(e,i){this.saveAndContinueValidate(e,i),(this.is_mass_adding||this.is_mass_editing||this.is_viewing)&&e.addClass("disable-image")}setEditMenuSaveAndCopyIcon(e,i){this.saveAndCopyValidate(e,i),(this.is_mass_editing||this.is_viewing)&&e.addClass("disable-image")}setEditMenuSaveAndNextIcon(e,i){this.editPermissionValidate(i)&&!this.edit_only_mode||e.addClass("invisible-image"),this.current_edit_record&&this.current_edit_record.id&&!this.is_viewing||e.addClass("disable-image")}setEditMenuSaveAndAddIcon(e,i){this.saveAndNewValidate(e,i),(this.is_viewing||this.is_mass_editing)&&e.addClass("disable-image")}setEditMenuCancelIcon(e,i){}ifContextButtonExist(e){for(var i=this.context_menu_array.length,t=0;t<i;t++){var a=$(this.context_menu_array[t]);if($(a.find(".ribbon-sub-menu-icon")).attr("id")===e&&!a.hasClass("invisible-image"))return!0}return!1}setDefaultMenu(e){if(0==LocalCacheData.isLocalCacheExists("current_company"))return!1;if(Global.isSet(e)&&e||this.selectContextMenu(),this.context_menu_array){this.setTotalDisplaySpan();for(var i=this.context_menu_array.length,t=this.getGridSelectIdArray().length,a=0;a<i;a++){var s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).attr("id");switch(s.removeClass("invisible-image"),s.removeClass("disable-image"),r){case ContextMenuIconName.add:this.setDefaultMenuAddIcon(s,t);break;case ContextMenuIconName.edit:this.setDefaultMenuEditIcon(s,t);break;case ContextMenuIconName.view:this.setDefaultMenuViewIcon(s,t);break;case ContextMenuIconName.mass_edit:this.setDefaultMenuMassEditIcon(s,t);break;case ContextMenuIconName.copy:this.setDefaultMenuCopyIcon(s,t);break;case ContextMenuIconName.delete_icon:this.setDefaultMenuDeleteIcon(s,t);break;case ContextMenuIconName.delete_and_next:this.setDefaultMenuDeleteAndNextIcon(s,t);break;case ContextMenuIconName.save:this.setDefaultMenuSaveIcon(s,t);break;case ContextMenuIconName.save_and_next:this.setDefaultMenuSaveAndNextIcon(s,t);break;case ContextMenuIconName.save_and_continue:this.setDefaultMenuSaveAndContinueIcon(s,t);break;case ContextMenuIconName.save_and_new:this.setDefaultMenuSaveAndAddIcon(s,t);break;case ContextMenuIconName.save_and_copy:this.setDefaultMenuSaveAndCopyIcon(s,t);break;case ContextMenuIconName.copy_as_new:this.setDefaultMenuCopyAsNewIcon(s,t);break;case ContextMenuIconName.login:this.setDefaultMenuLoginIcon(s,t);break;case ContextMenuIconName.cancel:this.setDefaultMenuCancelIcon(s,t);break;case ContextMenuIconName.import_icon:this.setDefaultMenuImportIcon(s,t);break;case ContextMenuIconName.permission_wizard:this.setDefaultMenuPermissionWizardIcon(s,t);break;case ContextMenuIconName.map:this.setDefaultMenuMapIcon(s,t);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(s,t);break;default:this.setCustomDefaultMenuIcon(r,s,t)}}this.setContextMenuGroupVisibility()}}setCustomDefaultMenuIcon(e,i,t){return!1}setEditMenu(){for(var e=this.context_menu_array.length,i=0;i<e;i++){var t=$(this.context_menu_array[i]),a=$(t.find(".ribbon-sub-menu-icon")).attr("id");if(t.removeClass("disable-image"),t.removeClass("invisible-image"),this.is_mass_editing)switch(a){case ContextMenuIconName.save:this.setEditMenuSaveIcon(t);break;case ContextMenuIconName.cancel:break;default:t.addClass("disable-image")}else switch(a){case ContextMenuIconName.add:this.setEditMenuAddIcon(t);break;case ContextMenuIconName.edit:this.setEditMenuEditIcon(t);break;case ContextMenuIconName.view:this.setEditMenuViewIcon(t);break;case ContextMenuIconName.mass_edit:this.setEditMenuMassEditIcon(t);break;case ContextMenuIconName.copy:this.setEditMenuCopyIcon(t);break;case ContextMenuIconName.delete_icon:this.setEditMenuDeleteIcon(t);break;case ContextMenuIconName.delete_and_next:this.setEditMenuDeleteAndNextIcon(t);break;case ContextMenuIconName.save:this.setEditMenuSaveIcon(t);break;case ContextMenuIconName.save_and_continue:this.setEditMenuSaveAndContinueIcon(t);break;case ContextMenuIconName.save_and_new:this.setEditMenuSaveAndAddIcon(t);break;case ContextMenuIconName.save_and_next:this.setEditMenuSaveAndNextIcon(t);break;case ContextMenuIconName.save_and_copy:this.setEditMenuSaveAndCopyIcon(t);break;case ContextMenuIconName.copy_as_new:this.setEditMenuCopyAndAddIcon(t);break;case ContextMenuIconName.cancel:break;case ContextMenuIconName.import_icon:this.setEditMenuImportIcon(t);break;case ContextMenuIconName.permission_wizard:this.setEditMenuPermissionWizardIcon(t);break;case ContextMenuIconName.login:this.setEditMenuLoginIcon(t);break;case ContextMenuIconName.map:this.setEditMenuMapIcon(t);break;case ContextMenuIconName.export_excel:this.setDefaultMenuExportIcon(t)}}this.setContextMenuGroupVisibility()}setDefaultMenuMapIcon(e){Global.getProductEdition()<=10&&e.addClass("invisible-image");var i=!1;if(this.grid){var t=this.getSelectedItems();if(Debug.Arr(t,"selected items","BaseViewController.js","BaseViewController","setDefaultMenuMapIcon",10),t.length>0)for(var a=0;a<t.length;a++)if(t[a]&&t[a].latitude&&t[a].longitude){i=!0;break}}i?e.removeClass("disable-image"):e.addClass("disable-image")}setEditMenuMapIcon(e){this.setDefaultMenuMapIcon(e)}setEditMenuLoginIcon(e){e.addClass("disable-image")}setContextMenuGroupVisibility(){for(var e=Global.topContainer().find("#"+this.viewId+"ContextMenu").find(".menu"),i=e.length,t=0;t<i;t++){for(var a=$(e[t]),s=a.find("li"),r=!0,n=s.length,o=0;o<n;o++){if(!$(s[o]).hasClass("invisible-image")){r=!1;break}}r?a.addClass("invisible-image"):a.removeClass("invisible-image")}this.need_switch_to_context_menu&&this.selectContextMenu(),this.initRightClickMenu()}setErrorMenu(){for(var e=this.context_menu_array.length,i=0;i<e;i++){var t=$(this.context_menu_array[i]),a=$(t.find(".ribbon-sub-menu-icon")).attr("id");switch(t.removeClass("disable-image"),a){case ContextMenuIconName.cancel:break;default:t.addClass("disable-image")}}}render(){var e=this;if($(window).resize((function(){e.edit_view&&e.setEditViewTabSize()})),!this.sub_view_mode&&!this.edit_only_mode&&!this.tree_mode){var i=Global.loadWidget("global/widgets/search_panel/SearchPanel.html"),t=$(i);$(this.el).prepend(t),this.show_search_tab||t.hide(),this.search_panel=t.SearchPanel({viewController:this}),this.search_panel.on("searchTabSelect",(function(){e.onSearchTabSelect})),this.buildSearchFields(),this.buildBasicSearchUI(),this.buildAdvancedSearchUI(),this.buildSearchAndLayoutUI(),setTimeout((function(){e.setCurrentViewPosition()}),500)}}setCurrentViewPosition(){var e=this.search_panel.find(".layout-selector-div"),i=this.search_panel.find("a[ref='saved_layout']").parent();e&&i&&i.offset()&&e.css("left",i.offset().left+i.width()+20)}onSearchTabSelect(e,i,t){switch($(t).prop("id")){case"basic_search":"saved_layout"!==this.search_panel.getLastSelectTabId()&&(this.getSearchPanelFilter(1,!0),this.buildBasicSearchUI(),this.setSearchPanelFilter(!1,0));break;case"adv_search":"saved_layout"!==this.search_panel.getLastSelectTabId()&&(this.getSearchPanelFilter(0,!0),this.buildAdvancedSearchUI(),this.setSearchPanelFilter(!1,1));break;case"saved_layout":this.getSearchPanelFilter(this.search_panel.getLastSelectTabIndex())}}initDropDownOptions(e,i){for(var t=e.length,a=0,s=[],r=0;r<t;r++){var n=e[r];this.initDropDownOption(n.option_name,n.field_name,n.api,o)}function o(e){s.push(e),(a+=1)===t&&i(s)}}buildWidgetContainerWithTextTip(e,i){var t=$("<div class='h-box'></div>"),a=Global.loadWidgetByName(r.FormItemType.TEXT);return a.css("margin-left","10px"),a.TText(),a.setValue(i),t.append(e),t.append(a),t}initDropDownOption(e,i,t,a,s){var r=this;Global.isSet(t)||(t=this.api),Global.isSet(i)&&i||(i=e+"_id"),t.getOptions(e,{onResult:function(t){var n=t.getResult();s?r[s]=Global.buildRecordArray(n):r[e+"_array"]=Global.buildRecordArray(n),r.sub_view_mode||(Global.isSet(r.basic_search_field_ui_dic[i])&&r.basic_search_field_ui_dic[i].setSourceData(Global.buildRecordArray(n)),Global.isSet(r.adv_search_field_ui_dic[i])&&r.adv_search_field_ui_dic[i].setSourceData(Global.buildRecordArray(n))),Global.isSet(a)&&a(t)}})}clearSearchPanel(){for(var e in this.basic_search_field_ui_dic){var i=this.basic_search_field_ui_dic[e];i.setValue(null)}for(var e in this.adv_search_field_ui_dic)(i=this.adv_search_field_ui_dic[e]).setValue(null)}onSearch(){TTPromise.add("init","init"),TTPromise.wait();if(this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.getSearchPanelFilter(),this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0){var e=$(this.previous_saved_layout_selector).children("option:contains('"+n.default_layout_name+"')").attr("value");if(!e)return void this.onSaveNewLayout(n.default_layout_name);var i=n.default_layout_name}else{if(this.show_search_tab)return void this.onSaveNewLayout(n.default_layout_name);if(!this.show_search_tab)return this.search(),void this.setGridHeaderStyle()}var t=this.getSearchPanelSortFilter(),a=this.getSearchPanelDisplayColumns(),s=this.getValidSearchFilter(),r={};r.id=e,r.data={},r.data.display_columns=a,r.data.filter_data=s,r.data.filter_sort=t,ProgressBar.showOverlay();var o=this;this.user_generic_data_api.setUserGenericData(r,{onResult:function(e){e.isValid()&&(o.clearViewLayoutCache(),o.clearAwesomeboxLayoutCache(),o.need_select_layout_name=i,o.initLayout())}})}onClearSearch(){var e=!1;if(!(this.search_panel.getLayoutsArray()&&this.search_panel.getLayoutsArray().length>0))return this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.column_selector.setSelectGridData(this.default_display_columns),this.sort_by_selector.setValue(null),void this.onSaveNewLayout(n.default_layout_name);var i=$(this.previous_saved_layout_selector).children("option:contains('"+n.default_layout_name+"')").attr("value");if(!i)return this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,this.column_selector.setSelectGridData(this.default_display_columns),this.sort_by_selector.setValue(null),void this.onSaveNewLayout(n.default_layout_name);var t=n.default_layout_name;this.clearSearchPanel(),this.filter_data=null,this.temp_adv_filter_data=null,this.temp_basic_filter_data=null,e=!0,this.sort_by_selector.setValue(null);var a=this.getSearchPanelSortFilter(),s=this.getSearchPanelDisplayColumns(),r=this.getValidSearchFilter();if(e){var o={};o.id=i,o.data={},o.data.display_columns=s,o.data.filter_data=r,o.data.filter_sort=a}var l=this;this.user_generic_data_api.setUserGenericData(o,{onResult:function(e){e.isValid()&&(l.clearViewLayoutCache(),l.need_select_layout_name=t,l.initLayout())}})}onSaveNewLayout(e){if(Global.isSet(e))var i=e;else i=this.save_search_as_input.getValue();if(i&&!(i.length<1)){var t=this.getSearchPanelSortFilter(),a=this.getSearchPanelDisplayColumns(),s=this.getValidSearchFilter(),r={};r.script=this.script_name,r.name=i,r.is_default=!1,r.data={},r.data.display_columns=a,r.data.filter_data=s,r.data.filter_sort=t;var n=this,o=ALayoutCache.layout_dic[this.script_name];o&&ALayoutCache.layout_dic[o]&&(ALayoutCache.layout_dic[o]=null),this.user_generic_data_api.setUserGenericData(r,{onResult:function(e){e.isValid()?(n.clearAwesomeboxLayoutCache(),n.clearViewLayoutCache(),n.need_select_layout_name=i,n.initLayout()):TAlertManager.showErrorAlert(e)}})}}onUpdateLayout(){var e=$(this.previous_saved_layout_selector).children("option:selected").attr("value"),i=$(this.previous_saved_layout_selector).children("option:selected").text(),t=this.getSearchPanelSortFilter(),a=this.getSearchPanelDisplayColumns(),s=this.getValidSearchFilter(),r={};r.id=e,r.data={},r.data.display_columns=a,r.data.filter_data=s,r.data.filter_sort=t;var n=this,o=ALayoutCache.layout_dic[this.script_name];o&&ALayoutCache.layout_dic[o]&&(ALayoutCache.layout_dic[o]=null),this.user_generic_data_api.setUserGenericData(r,{onResult:function(e){e.isValid()&&(n.clearAwesomeboxLayoutCache(),n.clearViewLayoutCache(),n.need_select_layout_name=i,n.initLayout())}})}clearViewLayoutCache(){LocalCacheData.view_layout_cache&&LocalCacheData.view_layout_cache[this.script_name]&&(LocalCacheData.view_layout_cache[this.script_name]=null)}clearAwesomeboxLayoutCache(){ALayoutCache.layout_dic&&ALayoutCache.layout_dic[this.script_name]&&(ALayoutCache.layout_dic[ALayoutCache.layout_dic[this.script_name]]=null)}onDeleteLayout(){var e=$(this.previous_saved_layout_selector).children("option:selected").attr("value"),i=this;this.user_generic_data_api.deleteUserGenericData(e,{onResult:function(e){e.isValid()&&(i.clearAwesomeboxLayoutCache(),i.clearViewLayoutCache(),i.need_select_layout_name=i.select_layout.name,i.initLayout())}})}buildSearchFields(){}buildBasicSearchUI(){if(this.search_fields){var e=this.search_panel.find("div #basic_search_content_div"),i=(this.search_fields.length,this),t=e.find(".first-column"),a=e.find(".second-column"),s=e.find(".third-column"),r=!1;$.each(this.search_fields,(function(e,n){if(Global.isSet(i.basic_search_field_ui_dic[n.get("field")]))return r=!0,!1;if(!n.get("basic_search"))return!0;var o=$(Global.loadWidget("global/widgets/search_panel/FormItem.html")),l=o.find(".form-item-label"),d=o.find(".form-item-input-div"),_=i.getFormItemInput(n);switch(l.text(n.get("label")+": "),d.append(_),n.get("in_column")){case 1:t.append(o),t.append("<div class='clear-both-div'></div>");break;case 2:a.append(o),a.append("<div class='clear-both-div'></div>");break;case 3:s.append(o),s.append("<div class='clear-both-div'></div>")}i.basic_search_field_ui_dic[n.get("field")]=_})),r||this.onBuildBasicUIFinished()}}buildAdvancedSearchUI(){if(this.search_fields){var e=this.search_panel.find("div #adv_search_content_div"),i=this,t=e.find(".first-column"),a=e.find(".second-column"),s=e.find(".third-column"),r=!1,n=!0;$.each(this.search_fields,(function(e,o){if(Global.isSet(i.adv_search_field_ui_dic[o.get("field")]))return r=!0,n=!1,!1;if(!o.get("adv_search"))return!0;var l=$(Global.loadWidget("global/widgets/search_panel/FormItem.html")),d=l.find(".form-item-label"),_=l.find(".form-item-input-div"),c=i.getFormItemInput(o);switch(d.text(o.get("label")+": "),_.append(c),o.get("in_column")){case 1:t.append(l),t.append("<div class='clear-both-div'></div>");break;case 2:a.append(l),a.append("<div class='clear-both-div'></div>");break;case 3:s.append(l),s.append("<div class='clear-both-div'></div>")}i.adv_search_field_ui_dic[o.get("field")]=c,n=!1})),n&&this.search_panel.hideAdvSearchPanel(),r||this.onBuildAdvUIFinished()}}onSetSearchFilterFinished(){}onBuildAdvUIFinished(){}onBuildBasicUIFinished(){}getFormItemInput(e){var i,t=e.get("form_item_type");switch(t){case r.FormItemType.AWESOME_BOX:i=Global.loadWidget("global/widgets/awesomebox/AComboBox.html"),i=$(i);var a,s=!1;"global_option_column"!==e.get("layout_name")&&"global_tree_column"!==e.get("layout_name")?(s=!0,a="id"):a="global_tree_column"===e.get("layout_name")?"id":"value",i.AComboBox({api_class:e.get("api_class"),allow_multiple_selection:e.get("multiple"),layout_name:e.get("layout_name"),tree_mode:e.get("tree_mode"),default_args:e.get("default_args"),show_search_inputs:s,set_any:e.get("set_any"),addition_source_function:e.get("addition_source_function"),script_name:e.get("script_name"),custom_first_label:e.get("custom_first_label"),key:a,search_panel_model:!0,field:e.get("field")}),e.get("customSearchFilter")&&(i.customSearchFilter=e.get("customSearchFilter"));break;case r.FormItemType.TEXT_INPUT:i=Global.loadWidget("global/widgets/text_input/TTextInput.html"),(i=$(i)).TTextInput({field:e.get("field")});break;case r.FormItemType.PASSWORD_INPUT:i=Global.loadWidget("global/widgets/text_input/TPasswordInput.html"),(i=$(i)).TTextInput({field:e.get("field")});break;case r.FormItemType.COMBO_BOX:i=Global.loadWidget("global/widgets/combobox/TComboBox.html"),(i=$(i)).TComboBox({field:e.get("field"),set_any:!0});break;case r.FormItemType.TAG_INPUT:i=Global.loadWidget("global/widgets/tag_input/TTagInput.html"),(i=$(i)).TTagInput({field:e.get("field"),object_type_id:e.get("object_type_id")});break;case r.FormItemType.DATE_PICKER:i=Global.loadWidgetByName(t),(i=$(i)).TDatePicker({field:e.get("field")});break;case r.FormItemType.CHECKBOX:i=Global.loadWidget("global/widgets/checkbox/TCheckbox.html"),(i=$(i)).TCheckbox({field:e.get("field")});break;default:alert("ERROR: Form type does not exist: "+t);debugger}return i}buildSearchAndLayoutUI(){var e=this.search_panel.find("div #saved_layout_content_div"),i=$(Global.loadWidget("global/widgets/search_panel/FormItem.html")),t=i.find(".form-item-label"),a=i.find(".form-item-input-div"),s=Global.loadWidget("global/widgets/awesomebox/ADropDown.html");this.column_selector=$(s),this.column_selector=this.column_selector.ADropDown({display_show_all:!1,id:this.ui_id+"_column_selector",key:"value",allow_drag_to_order:!0,display_close_btn:!1,display_column_settings:!1,max_height:150}),this.column_selector.on("formItemChange",(function(){n.layout_changed=!0})),t.text($.i18n._("Display Columns")+":"),t.addClass("SearchPanel-displayColumns-label"),a.append(this.column_selector),e.append(i),e.append("<div class='clear-both-div'></div>"),this.column_selector.setColumns([{name:"label",index:"label",label:$.i18n._("Column Name"),width:100,sortable:!1}]),t=(i=$(Global.loadWidget("global/widgets/search_panel/FormItem.html"))).find(".form-item-label"),a=i.find(".form-item-input-div"),this.sort_by_selector=$(Global.loadWidget("global/widgets/awesomebox/AComboBox.html")),this.sort_by_selector=this.sort_by_selector.AComboBox({allow_drag_to_order:!0,allow_multiple_selection:!0,set_empty:!0,layout_name:"global_sort_columns"}),t.text($.i18n._("Sort By")+":"),a.append(this.sort_by_selector),e.append(i),e.append("<div class='clear-both-div'></div>"),t=(i=$(Global.loadWidget("global/widgets/search_panel/FormItem.html"))).find(".form-item-label"),a=i.find(".form-item-input-div"),t.text($.i18n._("Save Search As")+":"),this.save_search_as_input=Global.loadWidget("global/widgets/text_input/TTextInput.html"),this.save_search_as_input=$(this.save_search_as_input),this.save_search_as_input.TTextInput();var r=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Save")+"'></input>");a.append(this.save_search_as_input),a.append(r);var n=this;r.click((function(){n.saving_layout_in_layout_tab=!0,n.onSaveNewLayout(),n.search()})),this.previous_saved_layout_div=$("<div class='previous-saved-layout-div'></div>"),a.append(this.previous_saved_layout_div),t=$("<span style='margin-left: 5px' >"+$.i18n._("Previous Saved Searches")+":</span>"),this.previous_saved_layout_div.append(t),this.previous_saved_layout_selector=$("<select style='margin-left: 5px' class='t-select'>");var o=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Update")+"'></input>"),l=$("<input class='t-button' style='margin-left: 5px' type='button' value='"+$.i18n._("Delete")+"'></input>");o.click((function(){n.onUpdateLayout(),n.onSearch()})),l.click((function(){n.onDeleteLayout(),n.onSearch()})),this.previous_saved_layout_div.append(this.previous_saved_layout_selector),this.previous_saved_layout_div.append(o),this.previous_saved_layout_div.append(l),e.append(i),this.previous_saved_layout_div.css("display","none")}onGridSelectRow(){$("#ribbon_view_container .context-menu:visible a").click(),this.setDefaultMenu()}setPreviousSavedSearchSourcesAndValue(e){var i=this;if(this.previous_saved_layout_selector)if(this.previous_saved_layout_selector.empty(),e&&e.length>0){this.previous_saved_layout_div.css("display","inline");for(var t=e.length,a=0;a<t;a++){var s=e[a];this.previous_saved_layout_selector.append($('<option value="'+s.id+'"></option>').text(s.name))}$(this.previous_saved_layout_selector.find("option")).filter((function(){return parseInt($(this).attr("value"))===i.select_layout.id})).prop("selected",!0).attr("selected",!0)}else this.previous_saved_layout_div.css("display","none")}setSelectLayout(e){var i=this,t="grid";Global.isSet(this.grid)||($(this.el).find("#grid").attr("id",this.ui_id+"_grid"),t=this.ui_id+"_grid");var a=[];this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns);var s=this.select_layout.data;s.display_columns&&0!=s.display_columns.length||(s.display_columns=this.default_display_columns);var r=this.buildDisplayColumns(s.display_columns);if(!this.sub_view_mode&&this.search_panel){this.column_selector&&this.column_selector.setSelectGridData(r),this.sort_by_selector&&(this.sort_by_selector.setSourceData(this.buildSortSelectorUnSelectColumns(r)),this.sort_by_selector.setValue(this.buildSortBySelectColumns()));var n=this.search_panel.getLayoutsArray();this.setPreviousSavedSearchSourcesAndValue(n)}for(var o=r.length,l=0;l<o;l++){var d=r[l];if(-1===$.inArray(d.value,e)){var _={name:d.value,index:d.value,label:d.label,width:100,sortable:!1,title:!1};a.push(_)}}if(this.grid&&(t=this.ui_id+"_grid",1==this.layout_changed&&(i.layout_changed=!1,this.grid.grid.jqGrid("GridUnload"),this.grid=null)),this.showGridBorders(),!this.grid){var c=this.getGridSetup();this.sub_view_mode&&(c.height=1),this.grid=new TTGrid(t,c,a),this.sub_view_mode&&this.grid.grid.hide(),this.setGridColumnsWidth(),this.setGridSize(this.ui_id,this.sub_view_mode,this.sub_view_grid_autosize,this.pager_data)}this.grid,0===LocalCacheData.paging_type?(this.paging_widget.parent().length>0&&this.paging_widget.remove(),this.paging_widget.css("width",this.grid.grid.width()),this.grid.grid.append(this.paging_widget),this.paging_widget.click(i.onPaging())):($(this.el).find(".total-number-div").append(this.paging_widget),$(this.el).find(".bottom-div").append(this.paging_widget_2),this.paging_widget.on("paging",(function(e,t,a){i.onPaging2(e,t,a)})),this.paging_widget_2.bind("paging",(function(e,t,a){i.onPaging2(e,t,a)}))),this.bindGridColumnEvents(),this.setGridHeaderStyle(),LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.sub_view_mode||this.setSearchPanelFilter(!0)}getGridSetup(){var e=this,i=this.grid_parent?this.grid_parent:".grid-div";return!this.grid_parent&&this.sub_view_mode&&(i=$("#"+this.ui_id+"_grid").parents(".sub-view").length>0?".sub-grid-view-div":".edit-view-tab-bar"),{container_selector:i,sub_grid_mode:this.sub_view_mode,onResizeGrid:!0,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(i){e.onGridDblClickRow(i)},onRightClickRow:function(i){e.getGridSelectIdArray().indexOf(i)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(i),e.onGridSelectRow())},height:1}}onGridSelectAll(){this.setDefaultMenu()}unSelectAll(){this.grid.grid.resetSelection()}onGridDblClickRow(e){this.grid.grid.resetSelection(),this.grid.setSelection(e,!1),this.setDefaultMenu(!0);for(var i=this.context_menu_array.length,t=!1,a=0;a<i&&!t;a++){var s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).prop("id");switch(r){case ContextMenuIconName.edit:if(s.is(":visible")&&!s.hasClass("disable-image"))return ProgressBar.showOverlay(),void this.onEditClick()}}for(a=0;a<i&&!t;a++)switch(s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).prop("id")){case ContextMenuIconName.view:if(t=!0,s.is(":visible")&&!s.hasClass("disable-image"))return ProgressBar.showOverlay(),void this.onViewClick()}for(a=0;a<i;a++)switch(s=$(this.context_menu_array[a]),r=$(s.find(".ribbon-sub-menu-icon")).prop("id")){case ContextMenuIconName.add:if(s.is(":visible")&&!s.hasClass("disable-image"))return ProgressBar.showOverlay(),void this.onAddClick()}}onPaging(){this.search(!0,"next")}onPaging2(e,i,t){this.search(!0,i,t)}bindGridColumnEvents(){var e=this.grid.getColumnModel();if(e){var i=e.length;this.t_grid_header_array=[];for(var t=0;t<i;t++){var a=e[t],s=$($(this.el).find("#gbox_"+this.ui_id+"_grid").find("div #jqgh_"+this.ui_id+"_grid_"+a.name));this.t_grid_header_array.push(s.TGridHeader()),this.search_panel&&s.on("click",n)}var r=this}function n(e){var i=$(this).attr("id");"cb"!==(i=i.substring(10+r.ui_id.length+1,i.length))&&(e.preventDefault(),r.sorting_rows?Debug.Text("Skipping column sort call ","","BaseViewController","onColumnHeaderClick",10):(r.sorting_rows=!0,TTPromise.add("init","init"),TTPromise.wait(null,null,(function(){r.sorting_rows=!1})),e.metaKey||e.ctrlKey?r.buildSortCondition(!1,i):r.buildSortCondition(!0,i),r.sub_view_mode?(r.search(),r.setGridHeaderStyle()):(r.sort_by_selector&&r.sort_by_selector.setValue(r.buildSortBySelectColumns()),r.onSearch())))}}getValidSearchFilter(){var e={};for(var i in this.filter_data)Global.isSet(this.filter_data[i])&&Global.isSet(this.filter_data[i].value)&&""!==this.filter_data[i].value&&(e[i]=this.filter_data[i]);return e}getSearchPanelDisplayColumns(){var e=[],i=this.column_selector.getSelectItems();return i&&i.length>0&&$.each(i,(function(i,t){e.push(t.value)})),e&&0!=e.length||(e=this.default_display_columns),e}getSearchPanelSortFilter(){var e=[],i=this.sort_by_selector.getValue(!0);return i&&i.length>0&&$.each(i,(function(i,t){var a={};a[t.value]=t.sort,e.push(a)})),e}getSearchPanelFilter(e,i){if(this.search_panel){if(Global.isSet(e))var t=e;else t=this.search_panel.getSelectTabIndex();var a=null;if(0===t)this.filter_data=[],a=this.basic_search_field_ui_dic;else{if(1!==t||!this.search_panel.isAdvTabVisible())return;this.filter_data=[],a=this.adv_search_field_ui_dic}var s=this;$.each(a,(function(e,i){s.filter_data[e]={field:e,id:"",value:a[e].getValue(!0)},s.temp_basic_filter_data&&(s.temp_basic_filter_data[e]=s.filter_data[e]),s.temp_adv_filter_data&&(s.temp_adv_filter_data[e]=s.filter_data[e])})),i&&(0===t?s.temp_basic_filter_data=Global.clone(s.filter_data):1===t&&(s.temp_adv_filter_data=Global.clone(s.filter_data)))}}setSearchPanelFilter(e,i){this.clearSearchPanel(),Global.isSet(e)||(e=!1);var t=this.filter_data;if(Global.isSet(i)&&(0===i&&this.temp_basic_filter_data?t=this.temp_basic_filter_data:1===i&&this.temp_adv_filter_data&&(t=this.temp_adv_filter_data)),Global.isSet(t)&&this.search_fields){for(var a=this.search_fields.length,s=0;s<a;s++){var r=this.search_fields[s].get("field"),n=this.basic_search_field_ui_dic[r],o=this.adv_search_field_ui_dic[r];Global.isSet(t[r])&&(Global.isSet(n)?"string"===$.type(t[r])||"number"===$.type(t[r])?n.setValue(t[r]):t[r].hasOwnProperty("value")?n.setValue(t[r].value):n.setValue(t[r]):e&&!this.saving_layout_in_layout_tab&&1!==this.search_panel.getSelectTabIndex()&&this.search_panel.setSelectTabIndex(1,!1),Global.isSet(o)&&("string"===$.type(t[r])||"number"===$.type(t[r])?o.setValue(t[r]):t[r].hasOwnProperty("value")?o.setValue(t[r].value):o.setValue(t[r])))}this.getSearchPanelFilter(),this.search_panel.setSearchFlag(this.getValidSearchFilter()),this.onSetSearchFilterFinished()}}setGridHeaderStyle(){for(var e=0;e<this.t_grid_header_array.length;e++){var i=this.t_grid_header_array[e],t=i.attr("id");if(("string"==typeof t||t instanceof String)&&(t=t.substring(10+this.ui_id.length+1,t.length),i.cleanSortStyle(),this.select_layout.data.filter_sort))for(var a=this.select_layout.data.filter_sort.length,s=0;s<a;s++){var r=this.select_layout.data.filter_sort[s],n=Global.getFirstKeyFromObject(r);n===t&&(a>1?i.setSortStyle(r[n],s+1):i.setSortStyle(r[n],0))}}}buildSortCondition(e,i){var t="desc";if(e){if(this.select_layout.data.filter_sort&&this.select_layout.data.filter_sort.length>0)for(var a=this.select_layout.data.filter_sort.length,s=!1,r=0;r<a;r++){var n=this.select_layout.data.filter_sort[r];for(var o in n)n.hasOwnProperty(o)&&o===i&&(t="asc"===n[o]?"desc":"asc",s=!0);if(s)break}this.select_layout.data.filter_sort=[{}],this.select_layout.data.filter_sort[0][i]=t}else if(this.select_layout.data.filter_sort){a=this.select_layout.data.filter_sort.length,s=!1;for(r=0;r<a;r++){for(var o in n=this.select_layout.data.filter_sort[r])n.hasOwnProperty(o)&&o===i&&("asc"===n[o]?n[o]="desc":n[o]="asc",s=!0);if(s)break}s||(this.select_layout.data.filter_sort.push({}),this.select_layout.data.filter_sort[a][i]="asc")}else this.select_layout.data.filter_sort=[{}],this.select_layout.data.filter_sort[0][i]="asc"}search(e,i,t,a){Global.isSet(e)||(e=!0);var s={filter_data:{},filter_sort:{}};if(s.filter_columns=this.getFilterColumnsFromDisplayColumns(),s.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)s.filter_page="next"===i?this.pager_data.next_page:1;else switch(i){case"next":s.filter_page=this.pager_data.next_page;break;case"last":s.filter_page=this.pager_data.previous_page;break;case"start":s.filter_page=1;break;case"end":s.filter_page=this.pager_data.last_page_number;break;case"go_to":s.filter_page=t;break;default:s.filter_page=this.pager_data.current_page}else s.filter_page=1;if(void 0!==this.select_layout&&this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),void 0!==this.select_layout&&Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),s.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),this.select_layout&&this.select_layout.data&&(s.filter_sort=this.select_layout.data.filter_sort),TTUUID.isUUID(this.refresh_id))s.filter_data={},s.filter_data.id=[this.refresh_id],this.last_select_ids=s.filter_data.id;else{this.last_select_ids=[];for(var r=this.getGridSelectIdArray(),n=0;n<r.length;n++)this.last_select_ids.push(r[n])}var o=this;this.api["get"+this.api.key_name](s,{onResult:function(t){var s,r=t.getResult();if(e&&o.setDefaultMenu(!0),Global.isArray(r)||TTUUID.isUUID(o.refresh_id)&&o.refresh_id!=TTUUID.zero_id&&o.refresh_id!=TTUUID.not_exist_id?(o.removeNoResultCover(),Global.isSet(o.__createRowId)&&(r=o.__createRowId(r)),Global.isSet(o.showGridOptionFields)&&(r=o.showGridOptionFields(r)),s=(r=Global.formatGridData(r,o.api.key_name)).length):(o.refresh_id=null,o.showNoResultCover()),TTUUID.isUUID(o.refresh_id)){o.refresh_id=null;var n=o.grid.getData();s=n.length,"array"!==$.type(n)&&(n=[]);var l=!1,d=r[0];if(d){for(var _=0;_<s;_++){if(n[_].id==d.id){o.grid.setRowData(d.id,d),n[_]=d,l=!0;break}}l||(o.grid.setData(n.concat(d)),o.highLightGridRowById(d.id),o.reSelectLastSelectItems())}}else{if(o.pager_data=t.getPagerData(),0!==LocalCacheData.paging_type&&o.paging_widget&&o.paging_widget_2&&(o.paging_widget.setPagerData(o.pager_data),o.paging_widget_2.setPagerData(o.pager_data)),0===LocalCacheData.paging_type&&"next"===i)r=o.grid.getData().concat(r);r=o.processResultData(r),o.grid&&(o.grid.setData(r),o.reSelectLastSelectItems())}o.setGridCellBackGround(),ProgressBar.closeOverlay(),0===LocalCacheData.paging_type&&(!o.pager_data||o.pager_data.is_last_page?o.paging_widget.css("display","none"):o.paging_widget.css("display","block")),a&&a(t),e&&o.autoOpenEditViewIfNecessary(),o.searchDone()}})}resizeSubGrid(e){var i=26*e>=200?200:26*e;$(".edit-view-tab:visible .grid-div").length>1?i<100&&(i=100):i=$(".edit-view-tab:visible").parent().height()-85,this.setGridColumnsWidth(),this.setGridHeight(i)}setGridColumnsWidth(){this.grid&&this.grid.setGridColumnsWidth()}setGridHeight(e){this.grid&&this.grid.setGridHeight(e)}setGridWidth(e){this.grid&&this.grid.setGridWidth(e)}processResultData(e){return e}searchDone(){$(".button-rotate").removeClass("button-rotate"),this.setTotalDisplaySpan(),this.setGridColumnsWidth(),this.setGridSize(this.ui_id,this.sub_view_mode,this.sub_view_grid_autosize,this.pager_data),this.sub_view_mode&&this.grid&&this.grid.grid.show(),TTPromise.resolve("BaseViewController","onTabShow"),TTPromise.resolve("init","init")}reSelectLastSelectItems(){var e=this;this.last_select_ids&&this.last_select_ids.length>0&&($.each(this.last_select_ids,(function(i,t){e.grid.grid.setSelection(t,!1),e.grid_select_id_array&&e.grid_select_id_array.push(t)})),this.last_select_ids=[],this.edit_view||this.setDefaultMenu())}autoOpenEditViewIfNecessary(){switch(LocalCacheData.current_doing_context_action){case"edit":LocalCacheData.edit_id_for_next_open_view&&(this.onEditClick(LocalCacheData.edit_id_for_next_open_view),LocalCacheData.edit_id_for_next_open_view=null);break;case"view":LocalCacheData.edit_id_for_next_open_view&&(this.onViewClick(LocalCacheData.edit_id_for_next_open_view),LocalCacheData.edit_id_for_next_open_view=null);break;case"new":this.edit_view||this.onAddClick()}this.autoOpenEditOnlyViewIfNecessary()}autoOpenEditOnlyViewIfNecessary(){this.sub_view_mode||LocalCacheData.getAllURLArgs()&&LocalCacheData.getAllURLArgs().sm&&!LocalCacheData.current_open_edit_only_controller&&(LocalCacheData.getAllURLArgs().sm.indexOf("Report")<0?IndexViewController.openEditView(this,LocalCacheData.getAllURLArgs().sm,LocalCacheData.getAllURLArgs().sid):(IndexViewController.openReport(this,LocalCacheData.getAllURLArgs().sm),LocalCacheData.getAllURLArgs().sid&&(LocalCacheData.default_edit_id_for_next_open_edit_view=LocalCacheData.getAllURLArgs().sid)))}setGridCellBackGround(){if(this.grid&&(this.script_name.indexOf("Policy")>=0||"RecurringScheduleTemplateControlView"===this.script_name||"PayCodeView"===this.script_name||"RecurringHolidayView"===this.script_name||"LegalEntityView"===this.script_name||"RemittanceSourceAccountView"===this.script_name||"PayrollRemittanceAgencyView"===this.script_name||"RemittanceDestinationAccountView"===this.script_name)){var e=this.grid.getData();if(!e)return;for(var i=e.length,t=0;t<i;t++){var a=e[t];!1===a.is_in_use&&$("tr[id='"+a.id+"']").addClass("policy-not-in-use")}}}showGridBorders(){var e=$(this.el).find(".grid-top-border"),i=$(this.el).find(".grid-bottom-border");e.css("display","block"),i.css("display","block")}_setGridSizeGroupheight(e){this.grid.grid.setGridHeight($(this.el).height()-(this.search_panel&&this.search_panel.is(":visible")?this.search_panel.height():0)-43-e)}setEditViewTabSize(){var e=this,i=this.edit_view_tab.find(".edit-view-tab-bar-label"),t=this.edit_view_tab.width(),a=this.edit_view_tab.find(".navigation-div").width(),s=this.edit_view.find(".tab-label-wrap"),r=0;if(i.children().each((function(){r+=$(this).width()})),r>t-a-25){if(i.width(r+10),0===s.length){var n=$('<img class="tab-arrow tab-right-arrow" style="display: none" src="theme/default/images/right_big_arrow.png" >'),o=$('<img class="tab-arrow tab-left-arrow" style="display: none" src="theme/default/images/left_big_arrow.png" >');(s=$('<div class="tab-label-wrap"><div class="label-wrap"></div><div class="btn-wrap"></div></div>')).insertBefore(i),s.width(t-a-25),s.children().eq(0).width(t-a-100),s.children().eq(0).append(i),s.children().eq(1).append(o),s.children().eq(1).append(n),n.bind("click",(function(){s.children().eq(0).scrollLeft(s.children().eq(0).scrollLeft()+500),l()})),o.bind("click",(function(){s.children().eq(0).scrollLeft(s.children().eq(0).scrollLeft()-500),l()}))}else s.width(t-a-25),s.children().eq(0).width(t-a-100);i.children().eq(0).is(":visible")&&!this.is_mass_editing?this.edit_view_tab.find(".tab-arrow").show():this.edit_view_tab.find(".tab-arrow").hide(),l()}else i.width("auto"),s.length>0&&(i.insertBefore(s),s.remove());function l(){var i=e.edit_view_tab.find(".tab-left-arrow"),t=e.edit_view_tab.find(".tab-right-arrow"),a=s.children().eq(0);i.removeClass("disable-image"),t.removeClass("disable-image"),0===a.scrollLeft()&&i.addClass("disable-image"),a.scrollLeft()===a[0].scrollWidth-a.width()&&t.addClass("disable-image")}}getFilterColumnsFromDisplayColumns(e,i){return this._getFilterColumnsFromDisplayColumns(e,i)}_getFilterColumnsFromDisplayColumns(e,i){e||(e={}),null!=i&&1!=i||(e.is_owner=!0,e.id=!0,e.is_child=!0,e.in_use=!0,e.first_name=!0,e.last_name=!0);var t={};if(Global.isSet(LocalCacheData.view_layout_cache[this.script_name])){var a=LocalCacheData.view_layout_cache[this.script_name].getResult();null!=a&&a.length>0&&(t=a[0].data.display_columns)}if(this.select_layout&&this.select_layout.data&&this.select_layout.data.display_columns)for(var s in this.select_layout.data.display_columns)t[s]=this.select_layout.data.display_columns[s];if((null==t.length||0==t.length&&Global.isSet(this.default_display_columns))&&(t=this.default_display_columns),null!=t.length&&t.length>0)for(var r=t.length,n=0;n<r;n++)e[t[n]]=!0;return e}getAllLayouts(e){var i,t=this;if(this.need_select_layout_name?(i=this.need_select_layout_name,this.need_select_layout_name=""):i=n.default_layout_name,this.sub_view_mode||!this.show_search_tab)return t.select_layout=null,void(e&&e());function a(a){if(a){var s=a.getResult();if(t.select_layout=null,LocalCacheData.view_layout_cache[t.script_name]=a,s&&s.length>0){s.sort((function(e,i){return Global.compare(e,i,"name")}));for(var r=s.length,n=0;n<r;n++){var o=s[n];if(o.name===i){t.select_layout=o;break}}t.select_layout||(t.select_layout=s[0]),t.search_panel.setLayoutsArray(s)}else t.select_layout=null,t.search_panel&&t.search_panel.setLayoutsArray(null);e&&e()}}LocalCacheData.view_layout_cache[this.script_name]?setTimeout((function(){a(LocalCacheData.view_layout_cache[t.script_name])}),0):(this.user_generic_data_api||(this.user_generic_data_api=s.y.APIUserGenericData),this.user_generic_data_api.getUserGenericData({filter_data:{script:this.script_name,deleted:!1}},{onResult:function(e){a(e)}}))}getAllColumns(e){var i=this;this.api.getOptions("columns",{onResult:function(t){var a=t.getResult();i.all_columns=Global.buildColumnArray(a),!i.sub_view_mode&&i.column_selector&&(i.column_selector.setUnselectedGridData(i.all_columns),i.column_selector.setHeight(32*i.all_columns.length)),e&&e()}})}getDefaultDisplayColumns(e){var i=this;this.api.getOptions("default_display_columns",{onResult:function(t){var a=t.getResult();i.default_display_columns=a,e&&e()}})}buildSortBySelectColumns(){var e=this.select_layout.data.filter_sort,i=[],t=this.sort_by_selector.getSourceData();return e&&$.each(e,(function(e,a){for(var s in a)$.each(t,(function(e,t){if(t.value===s)return t.sort=a[s],i.push(t),!1}))})),i}buildSortSelectorUnSelectColumns(e){var i=[],t=100;return $.each(e,(function(e,a){var s=$.extend({},a);s.id=t,s.sort="asc",i.push(s),t+=1})),i}buildDisplayColumns(e){for(var i=this.all_columns.length,t=e.length,a=[],s=0;s<t;s++)for(var r=0;r<i;r++)e[s]===this.all_columns[r].value&&a.push(this.all_columns[r]);return a}buildDisplayColumnsByColumnModel(e){if(e){for(var i=e.length,t=[],a=2e3,s=0;s<i;s++){var r=e[s];"cb"!==r.name&&(t.push({label:r.label,value:r.name,id:a}),a+=1)}return t}}removeContentMenuByName(e){if(LocalCacheData.current_open_primary_controller){LocalCacheData.current_open_primary_controller.viewId;Global.isSet(e)||(e=this.context_menu_name);var i=$("#ribbon ul a").filter((function(){return $(this).attr("ref")===e})).parent();$("li",$("#ribbon")).index(i)>=0&&$("#ribbon_view_container").tabs("refresh")}}movePermissionValidate(e){return Global.isSet(e)||(e=this.permission_id),"report"===e||!(!this.addPermissionValidate(e)||!this.deletePermissionValidate(e))}subAuditValidate(){return!!this.editPermissionValidate()}subDocumentValidate(){return!!(Global.getProductEdition()>=20&&PermissionManager.checkTopLevelPermission("Document"))}addPermissionValidate(e){return Global.isSet(e)||(e=this.permission_id),"report"===e||!!PermissionManager.validate(e,"add")}getRecordFromGridById(e){var i=this.grid.getData(),t=null;return $.each(i,(function(i,a){if(a.id==e)return t=Global.clone(a),!1})),t}getSelectedItems(){var e=this,i=[];if(this.edit_view)i=[this.current_edit_record];else{var t=this.getGridSelectIdArray();t.length;i=_.map(t,(function(i){return e.getRecordFromGridById(i)}))}return i}getSelectedItem(){var e=null;if(this.edit_view)e=this.current_edit_record;else{var i=this.getGridSelectIdArray();i.length>0&&(e=this.getRecordFromGridById(i[0]))}return e?Global.clone(e):null}deleteOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),i||(i=this.getSelectedItem()),"report"===e||!!(PermissionManager.validate(e,"delete")||i&&i.is_owner&&PermissionManager.validate(e,"delete_own")||i&&i.is_child&&PermissionManager.validate(e,"delete_child"))}viewOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),"report"===e||(i||(i=this.getSelectedItem()),!!(PermissionManager.validate(e,"view")||i&&i.is_owner&&PermissionManager.validate(e,"view_own")||i&&i.is_child&&PermissionManager.validate(e,"view_child")))}editOwnerOrChildPermissionValidate(e,i){return e||(e=this.permission_id),i||(i=this.getSelectedItem()),"report"===e||!!(PermissionManager.validate(e,"edit")||i&&i.is_owner&&PermissionManager.validate(e,"edit_own")||i&&i.is_child&&PermissionManager.validate(e,"edit_child"))}ownerOrChildPermissionValidate(e,i,t){return i.indexOf("child")>-1?"is_child":"is_owner",!!PermissionManager.validate(e,i)}editChildPermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!!PermissionManager.validate(e,"enabled")&&!(!PermissionManager.validate(e,"edit")&&!this.ownerOrChildPermissionValidate(e,"edit_child",i))}editPermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!!(PermissionManager.validate(e,"edit")||this.ownerOrChildPermissionValidate(e,"edit_child",i)||this.ownerOrChildPermissionValidate(e,"edit_own",i))}copyPermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!(!this.viewPermissionValidate(e,i)||!this.addPermissionValidate(e,i))}copyAsNewPermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!(!this.viewPermissionValidate(e,i)||!this.addPermissionValidate(e,i))}viewPermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!!(PermissionManager.validate(e,"view")||this.ownerOrChildPermissionValidate(e,"view_child",i)||this.ownerOrChildPermissionValidate(e,"view_own",i))}deletePermissionValidate(e,i){return Global.isSet(e)||(e=this.permission_id),Global.isSet(i)||(i=this.getSelectedItem()),"report"===e||!!(PermissionManager.validate(e,"delete")||this.ownerOrChildPermissionValidate(e,"delete_child",i)||this.ownerOrChildPermissionValidate(e,"delete_own",i))}saveValidate(e,i){this.current_edit_record&&this.current_edit_record.id||this.is_mass_editing?(this.current_edit_record&&this.current_edit_record.id||!this.is_mass_editing)&&!this.current_edit_record.id||this.editPermissionValidate(i)||e.addClass("invisible-image"):this.addPermissionValidate(i)||e.addClass("invisible-image")}saveAndCopyValidate(e,i){this.current_edit_record&&this.current_edit_record.id||this.is_mass_editing?(this.current_edit_record&&this.current_edit_record.id||!this.is_mass_editing)&&!this.current_edit_record.id||this.editPermissionValidate(i)&&this.addPermissionValidate(i)||e.addClass("invisible-image"):this.addPermissionValidate(i)||e.addClass("invisible-image"),this.edit_only_mode&&e.addClass("invisible-image")}saveAndContinueValidate(e,i){this.current_edit_record&&this.current_edit_record.id||this.is_mass_editing?(this.current_edit_record&&this.current_edit_record.id||!this.is_mass_editing)&&!this.current_edit_record.id||this.editPermissionValidate(i)||e.addClass("invisible-image"):this.addPermissionValidate(i)&&this.editPermissionValidate(i)||e.addClass("invisible-image"),this.edit_only_mode&&e.addClass("invisible-image")}saveAndNewValidate(e,i){this.current_edit_record&&this.current_edit_record.id||this.is_mass_editing?(!Global.isSet(this.current_edit_record.id)&&this.is_mass_editing||Global.isSet(this.current_edit_record.id))&&(this.editPermissionValidate(i)&&this.addPermissionValidate(i)||e.addClass("invisible-image")):this.addPermissionValidate(i)||e.addClass("invisible-image"),this.edit_only_mode&&e.addClass("invisible-image")}setSubLogViewFilter(){return!!this.sub_log_view_controller&&(this.sub_log_view_controller.parent_key="object_id",this.sub_log_view_controller.parent_value=this.uniformVariable(this.current_edit_record).id,this.sub_log_view_controller.table_name_key=this.table_name_key,!0)}initSubLogView(e){var i=this;function t(){}function a(e){i.sub_log_view_controller=e,i.sub_log_view_controller.parent_view_controller=i,i.sub_log_view_controller.parent_edit_record=i.current_edit_record,i.setSubLogViewFilter(),i.sub_log_view_controller.postInit=function(){this.initData()}}this.current_edit_record.id&&this.current_edit_record.id!=TTUUID.zero_id?this.sub_log_view_controller?(this.sub_log_view_controller.buildContextMenu(!0),this.sub_log_view_controller.setDefaultMenu(),this.sub_log_view_controller.parent_edit_record=this.current_edit_record,this.setSubLogViewFilter(),this.sub_log_view_controller.search()):Global.loadScript("views/core/log/LogViewController.js",(function(){if(i.edit_view_tab){var s=i.edit_view_tab.find("#"+e).find(".first-column-sub-view");TTPromise.add("initSubAudit","init"),TTPromise.wait("initSubAudit","init",(function(){s.css("opacity","1")})),s.css("opacity","0"),Global.trackView("SubLogView",LocalCacheData.current_doing_context_action),LogViewController.loadSubView(s,t,a)}})):TTPromise.resolve("BaseViewController","onTabShow")}showNoResultCover(e){e||(e=this.ifContextButtonExist(ContextMenuIconName.add)),this.removeNoResultCover(),this.no_result_box=Global.loadWidgetByName(r.WidgetNamesDic.NO_RESULT_BOX),this.no_result_box.NoResultBox({related_view_controller:this,is_new:e}),this.no_result_box.attr("id",this.ui_id+"_no_result_box"),$(this.el).find(".grid-div").append(this.no_result_box),this.initRightClickMenu(RightClickMenuType.NORESULTBOX)}removeNoResultCover(){this.no_result_box&&this.no_result_box.length>0&&this.no_result_box.remove(),this.no_result_box=null}cleanWhenUnloadView(e){this.removeContentMenuByName(),Global.isSet(e)&&e()}gridScrollTop(){"TimeSheet"!==this.viewId&&"Schedule"!==this.viewId&&this.grid&&this.grid.grid.parent().parent().scrollTop(0)}gridScrollDown(){"TimeSheet"!==this.viewId&&"Schedule"!==this.viewId&&this.grid&&this.grid.grid.parent().parent().scrollTop(1e4)}selectAll(){if("TimeSheet"!==this.viewId&&"Schedule"!==this.viewId&&this.grid){this.grid.grid.resetSelection();for(var e=this.grid.getData(),i=e.length,t=0;t<i;t++){var a=e[t];Global.isSet(a.id)?this.grid.grid.setSelection(a.id,!1):this.grid.grid.setSelection(t+1,!1)}this.grid.grid.parent().parent().parent().find(".cbox-header").prop("checked",!0),this.setDefaultMenu()}}detachElement(e){if(this.edit_view_form_item_dic&&this.edit_view_form_item_dic[e]){var i=$('<p style="display: none">');i.addClass(".edit-view:visible place_holder_"+e),i.insertBefore(this.edit_view_form_item_dic[e]),this.edit_view_form_item_dic[e].detach()}}attachElement(e){if(this.edit_view_form_item_dic&&this.edit_view_form_item_dic[e]){var i=$(".edit-view:visible .place_holder_"+e);this.edit_view_form_item_dic[e].insertBefore(i),i.remove()}}getBalanceHandler(e,i){var t,a,s,r,n=this;if(n.edit_view_ui_dic&&n.edit_view_ui_dic.available_balance)if(Global.isObject(e)){var o=e.getResult();o?(n.attachElement("available_balance"),t=Global.getTimeUnit(o.available_balance),a=Global.getTimeUnit(o.current_time),s=Global.getTimeUnit(o.remaining_balance),r=Global.getTimeUnit(o.projected_remaining_balance),o.hasOwnProperty("remaining_dollar_balance")&&(t=t+" / "+LocalCacheData.getCurrentCurrencySymbol()+o.available_dollar_balance,a=a+" / "+LocalCacheData.getCurrentCurrencySymbol()+o.current_dollar_amount,s=s+" / "+LocalCacheData.getCurrentCurrencySymbol()+o.remaining_dollar_balance,r=r+" / "+LocalCacheData.getCurrentCurrencySymbol()+o.remaining_dollar_balance),n.edit_view_ui_dic.available_balance.setValue(r),o.projected_remaining_balance<0?n.edit_view_ui_dic.available_balance.css("color","red"):n.edit_view_ui_dic.available_balance.css("color","black"),n.available_balance_info.qtip({show:{event:"click",delay:10,effect:!0},hide:{event:"unfocus"},style:{width:340},content:'<div style="width:100%;"><div style="width:100%; clear: both;"><span style="float:left;">'+$.i18n._("Available Balance")+': </span><span style="float:right;">'+t+'</span></div><div style="width:100%; clear: both;"><span style="float:left;">'+$.i18n._("Current Time")+': </span><span style="float:right;">'+a+'</span></div><div style="width:100%; clear: both;"><span style="float:left;">'+$.i18n._("Remaining Balance")+': </span><span style="float:right;">'+s+'</span></div><div style="width:100%; height: 20px; clear: both;"></div><div style="width:100%; clear: both;"><span style="float:left;">'+$.i18n._("Projected Balance by")+" "+i+': </span><span style="float:right;">'+Global.getTimeUnit(o.projected_balance)+'</span></div><div style="width:100%; clear: both;"><span style="float:left;">'+$.i18n._("Projected Remaining Balance")+':</span><span style="float:right;">'+Global.getTimeUnit(o.projected_remaining_balance)+"</span></div></div>"})):n.detachElement("available_balance")}else n.detachElement("available_balance")}onExportClick(e){ProgressBar.showOverlay(),null==e&&(e=this.api["export"+this.api.key_name]);var i={};i.filter_columns=this._getFilterColumnsFromDisplayColumns(null,!1),i.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),Global.isSet(this.sort_by_selector)&&(i.filter_sort=this.getSearchPanelSortFilter());var t={0:"csv",1:i,2:!0};Global.APIFileDownload(this.api.className,e,t)}highLightGridRowById(e){this.grid&&this.grid.grid&&(this.grid.grid.find("tr#"+e).addClass("flashBackground"),this.gridScrollDown())}setConversionRateExampleText(e,i,t){var a={};a.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout);var r=s.y.APICurrency.getCurrency(a,{async:!1}).getResult(),n="";if(this.edit_view_ui_dic.round_decimal_places)var o=this.edit_view_ui_dic.round_decimal_places.getValue();for(var l=0;l<r.length;l++)r[l].is_base&&(n=r[l].iso_code),t&&!i&&r[l].id==t&&(i=r[l].iso_code,o||(o=r[l].round_decimal_places));i!=n?this.sub_view_mode?$("#rate_conversion_rate_clarification_box").html("&nbsp;&nbsp;1.00 "+n+" = "+Global.removeTrailingZeros(e,o)+" "+i):$("#conversion_rate_clarification_box").html("&nbsp;&nbsp;1.00 "+n+" = "+Global.removeTrailingZeros(e,o)+" "+i):$("#conversion_rate_clarification_box").hide()}startMapCoordinates(){var e=39.5,i=-98.35;if(0!=LocalCacheData.getCurrentCompany().latitude&&0!=LocalCacheData.getCurrentCompany().longitude)e=LocalCacheData.getCurrentCompany().latitude,i=LocalCacheData.getCurrentCompany().longitude,Debug.Text("Using company coordinates.","BaseViewController.js","BaseViewController","startMapCoordinates",10);else if(0!=LocalCacheData.getLoginUser().latitude&&0!=LocalCacheData.getLoginUser().longitude)e=LocalCacheData.getLoginUser().latitude,i=LocalCacheData.getLoginUser().longitude,Debug.Text("Using user coordinates.","BaseViewController.js","BaseViewController","startMapCoordinates",10);else{var t=s.y.APICompany,a=t.getOptions("country",{async:!1}).getResult(),r=t.getOptions("province",LocalCacheData.getCurrentCompany().country,{async:!1}).getResult();if(APIGlobal.pre_login_data.map_geocode_url&&r&&a&&r[LocalCacheData.getCurrentCompany().province]&&a[LocalCacheData.getCurrentCompany().country]){var n=LocalCacheData.getCurrentCompany().city+" "+r[LocalCacheData.getCurrentCompany().province]+", "+a[LocalCacheData.getCurrentCompany().country],o=APIGlobal.pre_login_data.map_geocode_url+"?q="+n+"&format=json&tt_key="+APIGlobal.pre_login_data.registration_key,l=jQuery.ajax({url:o,async:!1});Debug.Arr("Geocoding address: "+n,l,"BaseViewController.js","BaseViewController","startMapCoordinates",10)}l&&l.responseJSON&&l.responseJSON[0]&&l.responseJSON[0].lat&&l.responseJSON[0].lon?(e=l.responseJSON[0].lat,i=l.responseJSON[0].lon,Debug.Text("Using company address coordinates.","BaseViewController.js","BaseViewController","startMapCoordinates",10)):Debug.Text("Using default coordinates.","BaseViewController.js","BaseViewController","startMapCoordinates",10)}return Debug.Text("Coordinates (lat,long): "+e+","+i,"BaseViewController.js","BaseViewController","startMapCoordinates",10),new L.LatLng(e,i)}initSubDocumentView(){var e=this;if(this.current_edit_record.id){if(this.sub_document_view_controller)return this.sub_document_view_controller.buildContextMenu(!0),this.sub_document_view_controller.setDefaultMenu(),e.sub_document_view_controller.parent_value=e.current_edit_record.id,e.sub_document_view_controller.parent_edit_record=e.current_edit_record,void e.sub_document_view_controller.initData();Global.loadScript("views/document/DocumentViewController.js",(function(){if(e.edit_view_tab){var a=e.edit_view_tab.find("#tab_attachment").find(".first-column-sub-view");TTPromise.add("initSubDocumentView","init"),TTPromise.wait("initSubDocumentView","init",(function(){a.css("opacity","1")})),a.css("opacity","0"),Global.trackView("SubDocumentView"),DocumentViewController.loadSubView(a,i,t)}}))}else TTPromise.resolve("BaseViewController","onTabShow");function i(){}function t(i){e.sub_document_view_controller=i,e.sub_document_view_controller.parent_key="object_id",e.sub_document_view_controller.parent_value=e.current_edit_record.id,e.sub_document_view_controller.document_object_type_id=e.document_object_type_id,e.sub_document_view_controller.parent_edit_record=e.current_edit_record,e.sub_document_view_controller.parent_view_controller=e,e.sub_document_view_controller.initData()}}onDeleteImage(e){var i=this;this.api.deleteImage(this.current_edit_record.id,{onResult:function(e){i.onEditClick(i.current_edit_record.id,!0)}})}onTreeGridNavigationRowSelect(e){e&&(1!=LocalCacheData.currently_collapsing_navigation_tree_element?(this.onEditClick(e),$(".a-dropdown-div").remove(),LocalCacheData.openAwesomeBox=null):(LocalCacheData.currently_collapsing_navigation_tree_element=!1,this.onEditClick(e,!0),this.setNavigation()))}parserDatesRange(e){for(var i=e.split(" - "),t=[],a=Global.strToDate(i[0]),s=Global.strToDate(i[1]),r=a;r.getTime()<s.getTime();)t.push(r.format()),r=new Date(new Date(r.getTime()).setDate(r.getDate()+1));return t.push(i[1]),t}baseViewSubTabGridResize(e){if(e?-1===e.indexOf("#")&&0!=e.indexOf(".")&&(e="#"+e):e=".edit-view-tab-outside-sub-view",this.grid.grid.parents(e).length>0){var i=53;this.grid.grid.parents(e).find(".audit-info").length>0&&(i+=this.grid.grid.parents(e).find(".audit-info").height()+20),this.grid.grid.parents(e).parents(".wizard").length>0&&(i+=this.getDefaultHeightOffset()-90),this.paging_widget&&this.paging_widget.getPagerData()&&(0==this.paging_widget.getPagerData().total_rows||this.paging_widget.getPagerData().total_rows>=LocalCacheData.getLoginUserPreference().items_per_page)&&(i+=25),this.grid.grid.parents(".ui-jqgrid-bdiv").width()>this.grid.grid.parents(".ui-jqgrid-jquery-ui").width()&&(i+=24,Debug.Text("Scrollbar offset detected: 15","BaseViewController.js","BaseViewController","baseViewSubTabGridResize",10));var t=this.grid.grid.parents(e).innerHeight()-i;this.grid.setup.container_selector=e,Debug.Text("Special SubView ID: "+e+" Height: "+t+" Offset: "+i,"TTGrid.js","TTGrid","baseViewSubTabGridResize",10)}else{i=this.getDefaultHeightOffset(),t=this.grid.grid.parents(".edit-view-tab").innerHeight()-i;Debug.Text("Normal SubView ID: "+e+" Height: "+t+" Offset: "+i,"TTGrid.js","TTGrid","baseViewSubTabGridResize",10)}this.setGridHeight(t),this.setGridWidth()}setGridSize(e,i,t,a){if(this.grid&&this.grid.setup&&this.grid.setup.setGridSize&&"function"==typeof this.grid.setup.setGridSize)this.grid.setup.setGridSize();else if((e||this.ui_id)&&this.grid){!e&&this.ui_id&&(e=this.ui_id),!i&&this.sub_view_mode&&(i=this.sub_view_mode),!t&&this.sub_view_grid_autosize&&(t=this.sub_view_grid_autosize);var s=100;if(i&&this.grid.grid.parents(".grid-div").find(".no-result-div:visible").length>0&&this.grid.grid.parents("#tab_history, #tab_qualifications").length>0)s=100;else if(this.grid.setup.static_height)s=this.grid.setup.static_height;else if(this.grid.setup.verticalResize&&!0===this.grid.setup.verticalResize){var r=$("table[aria-labelledby=gbox_"+e+"_grid]").height();if(this.grid.setup.tree_mode&&(r=0),i)if(Debug.Text("SubView resize triggered","BaseViewController.js","BaseViewController","setGridSize",10),t&&!0===t){var n=this.grid.getRecordCount(),o=this.grid.grid.find("tr:last td:first").height();o<18&&(o=22),(s=0==n?1:n>10?10*o:n*o)<100&&(s+=32)}else{var l=this.grid.grid.parents(".edit-view-tab-outside-sub-view").height();s=a&&a.last_page_number>1?l-r-56:l-r-22}else{var d=this.getDefaultHeightOffset();s=this.grid.grid.parents("#contentContainer").height()-d,Debug.Text("NEW GRID HEIGHT: this.grid.grid.parents('.view').height() - offset: ("+this.grid.grid.parents(".view").height()+" - "+d+") "+(this.grid.grid.parents(".view").height()-d),"BaseViewController.js","BaseViewController","setGridSize",10)}}this.grid.grid.setGridHeight(s),$(".sub-view .bottom-div:has(.paging-2-div:visible)").css("height","20px"),$(".sub-view .bottom-div:has(.paging-2-div:hidden)").css("height","auto")}else Debug.Text("ERROR: You must provide at least a ui_id for setGridSize()","TTGrid.js","TTGrid","setGridSize",10)}getDefaultHeightOffset(){var e=this.grid.grid.parents(".ui-jqgrid-jquery-ui").find(".ui-jqgrid-hbox").height()-22;Debug.Text("Initial offset: "+e,"BaseViewController.js","BaseViewController","getDefaultHeightOffset",10),this.grid.grid.parents(".ui-jqgrid-bdiv").width()>this.grid.grid.parents(".ui-jqgrid-jquery-ui").width()&&(e+=15,Debug.Text("Scrollbar offset detected: 15","BaseViewController.js","BaseViewController","getDefaultHeightOffset",10)),this.search_panel&&1==this.search_panel.is(":visible")&&(e+=this.search_panel.height(),Debug.Text("Search panel detected: "+this.search_panel.height(),"BaseViewController.js","BaseViewController","getDefaultHeightOffset",10));var i=$(".total-number-div:visible").length>0?$(".total-number-div:visible").height():0;(i||0===i)&&(e+=i,Debug.Text("Total number DIV height offset detected: "+$(".total-number-div:visible").height(),"BaseViewController.js","BaseViewController","getDefaultHeightOffset",10));var t=$(".bottom-div").height()+5;(t||0===t)&&(e+=t,Debug.Text("Footer height offset detected: "+t,"BaseViewController.js","BaseViewController","getDefaultHeightOffset",10));var a=2*$(".grid-top-border").height();return(a||0===a)&&(e+=a,Debug.Text("Red border height offset detected: "+a,"BaseViewController.js","BaseViewController","getDefaultHeightOffset",10)),e}}n.loadView=function(e){Global.loadViewSource(e,e+"View.html",(function(i){var t={};switch(e){case"TimeSheet":Global.loadViewSource(e,e+"View.css"),t={accumulated_time:$.i18n._("Accumulated Time"),verify:$.i18n._("Verify"),timesheet_verification:$.i18n._("TimeSheet Verification")};break;case"Login":$("body").addClass("login-bg"),$("body").removeClass("application-bg"),t={secure_login:$.i18n._("Secure Login"),user_name:$.i18n._("User Name"),password:$.i18n._("Password"),forgot_your_password:$.i18n._("Forgot Your Password"),quick_punch:$.i18n._("Quick Punch"),login:$.i18n._("Login"),language:$.i18n._("Language")};break;case"PortalJobVacancyDetail":t={search_label:$.i18n._("Search")};break;case"PortalJobVacancy":t={search_label:$.i18n._("Search"),load_more:$.i18n._("Loading")+"..."};break;case"MyJobApplication":case"MyProfile":break;case"Schedule":Global.loadViewSource(e,e+"View.css")}IndexViewController.instance.router.removeCurrentView();var a=_.template(i);Global.contentContainer().html(a(t)),LocalCacheData.current_open_view_id=e,Global.trackView(e,LocalCacheData.current_doing_context_action)}))},n.default_layout_name=$.i18n._("-- Default --")}}]);
//# sourceMappingURL=BaseViewController.bundle.js.map?v=dab82a64c60d05f47375