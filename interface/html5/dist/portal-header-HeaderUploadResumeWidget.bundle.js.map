{"version":3,"sources":["webpack://timetrex/./interface/html5/views/portal/header/HeaderUploadResumeWidget.js"],"names":["HeaderUploadResumeWidget","TTBackboneView","options","_","defaults","super","initialize","tpl","Global","loadWidget","this","setElement","template","document_id","profileView","$this","uploader","$","TImageBrowser","field","name","accept_filter","changeHandler","a","file_name","find","files","val","IndexViewController","instance","router","showFormModal","$el","title","i18n","actions","label","isClose","callBack","e","uploadResume","file","attr","getValue","document_api","document_name","LocalCacheData","getPortalLoginUser","first_name","last_name","result","addAttachment","async","getResult","uploadFile","file_data","document_revision_id","url","className","getAllURLArgs","hasOwnProperty","company_id","message_id","ProgressBar","showProgressBar","changeProgressBarMessage","ajax","headers","getCookie","type","data","success","res","removeProgressBar","uploaded","error","showUploadedMessage","refreshSubDocument","cache","contentType","processData","addDocumentRow","hideFormModal","message","showTipModal"],"mappings":"mOAKO,MAAMA,UAAiC,EAAAC,eAC7C,YAAaC,EAAU,IACtBC,EAAEC,SAAUF,EAAS,IAErBG,MAAOH,GAGR,WAAYA,GACXG,MAAMC,WAAYJ,GAClB,IAAIK,EAAMC,OAAOC,WAAY,qDAC7BC,KAAKC,WAAYR,EAAES,SAAUL,EAAZJ,IACjBO,KAAKG,YAAc,KACnBH,KAAKI,YAAc,KACdZ,EAAQY,cACZJ,KAAKI,YAAcZ,EAAQY,aAK7B,SACC,IAAIC,EAAQL,KACNA,KAAKM,WACVN,KAAKM,SAAWN,KAAKO,EAAG,oBAAqBC,cAAe,CAC3DC,MAAO,OACPC,KAAM,WACNC,cAAe,IACfC,cAAe,SAAUC,GACxB,IAAIC,EAAYP,EAAGP,MAAOe,KAAM,YAAa,GAAGC,MAAM,GAAGN,KACzDL,EAAME,EAAG,aAAcU,IAAKH,OAK/BI,oBAAoBC,SAASC,OAAOC,cAAerB,KAAKsB,IAAK,CAC5DC,MAAOhB,EAAEiB,KAAK/B,EAAG,iBACjBgC,QAAS,CACR,CAAEC,MAAO,QAASC,SAAS,GAC3B,CACCD,MAAOnB,EAAEiB,KAAK/B,EAAG,iBAAmBmC,SAAU,SAAUC,GACvDxB,EAAMyB,oBAOX,eAEC,IAAM9B,KAAKM,SACV,OAAO,EAER,IAAIA,EAAWN,KAAKM,SAEhByB,GADOzB,EAAS0B,KAAM,aACf1B,EAAS2B,YACpB,GAAKF,EAAO,CACX/B,KAAKkC,aAAe,sBACpB,IAAIC,EAAgB,YAAmBC,eAAeC,qBAAqBC,WAAa,IAAMF,eAAeC,qBAAqBE,UAC9HC,EAASxC,KAAKkC,aAAaO,cAAeN,EAAe,GAAI,CAAEO,OAAO,IAAUC,YACpF3C,KAAKG,YAAcqC,EAAoB,YACvCxC,KAAK4C,WAAYb,EAAMS,EAA6B,uBAItD,WAAYK,EAAWC,GACtB,IAAIzC,EAAQL,KACR+C,EAAM,cAAyB,SAAW/C,KAAKkC,aAAac,UAA7B,gCAC9BZ,eAAea,iBACdb,eAAea,gBAAgBC,eAAgB,gBACnDH,EAAMA,EAAM,eAAiBX,eAAea,gBAAgBE,YAG9DJ,EAAMA,EAAM,cAAgBD,EAC5B,IAAIM,EAAa,mBACjBC,YAAYC,gBAAiBF,GAC7BC,YAAYE,yBAA0BhD,EAAEiB,KAAK/B,EAAG,kBAAqB,OACrEc,EAAEiD,KAAM,CACPT,IAAKA,EACLU,QAAS,CAER,cAAe,mBACf,eAAgBC,UAAW,eAE5BC,KAAM,OACNC,KAAMf,EACNgB,QAAS,SAAUC,GAClBT,YAAYU,oBACZ1D,EAAM2D,WACDF,EAAIG,MACR5D,EAAM6D,oBAAqBJ,EAAIG,QAE/B5D,EAAM6D,oBAAqB3D,EAAEiB,KAAK/B,EAAG,uBACrCY,EAAM8D,uBAGRC,OAAO,EACPC,aAAa,EACbC,aAAa,IAIf,qBACMtE,KAAKI,aACTJ,KAAKI,YAAYmE,eAAgBvE,KAAKG,aAIxC,WACCH,KAAKM,SAAW,KAChBY,oBAAoBC,SAASC,OAAOoD,gBAGrC,oBAAqBC,GACpBvD,oBAAoBC,SAASC,OAAOsD,aAAcD","file":"portal-header-HeaderUploadResumeWidget.bundle.js?v=d1d7502538dd90d3c6b0","sourcesContent":["import { TTBackboneView } from '@/views/TTBackboneView';\nimport { TTAPI } from '@/services/TimeTrexClientAPI';\nimport { TTUUID } from '@/global/TTUUID';\nimport { ServiceCaller } from '@/services/ServiceCaller';\n\nexport class HeaderUploadResumeWidget extends TTBackboneView {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {} );\n\n\t\tsuper( options );\n\t}\n\n\tinitialize( options ) {\n\t\tsuper.initialize( options );\n\t\tvar tpl = Global.loadWidget( 'views/portal/header/HeaderUploadResumeWidget.html' );\n\t\tthis.setElement( _.template( tpl )() );\n\t\tthis.document_id = null;\n\t\tthis.profileView = null;\n\t\tif ( options.profileView ) {\n\t\t\tthis.profileView = options.profileView;\n\t\t}\n\t\t// this.render();\n\t}\n\n\trender() {\n\t\tvar $this = this;\n\t\tif ( !this.uploader ) {\n\t\t\tthis.uploader = this.$( '.register-resume' ).TImageBrowser( {\n\t\t\t\tfield: 'file',\n\t\t\t\tname: 'filedata',\n\t\t\t\taccept_filter: '*',\n\t\t\t\tchangeHandler: function( a ) {\n\t\t\t\t\tvar file_name = $( this ).find( '.browser' )[0].files[0].name;\n\t\t\t\t\t$this.$( '#fileName' ).val( file_name );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tIndexViewController.instance.router.showFormModal( this.$el, {\n\t\t\ttitle: $.i18n._( 'Upload Resume' ),\n\t\t\tactions: [\n\t\t\t\t{ label: 'Close', isClose: true },\n\t\t\t\t{\n\t\t\t\t\tlabel: $.i18n._( 'Upload Resume' ), callBack: function( e ) {\n\t\t\t\t\t\t$this.uploadResume();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t} );\n\t}\n\n\tuploadResume() {\n\t\tvar $this = this;\n\t\tif ( !this.uploader ) {\n\t\t\treturn false;\n\t\t}\n\t\tvar uploader = this.uploader;\n\t\tvar name = uploader.attr( 'file_name' );\n\t\tvar file = uploader.getValue();\n\t\tif ( file ) {\n\t\t\tthis.document_api = TTAPI.APIDocumentPortal;\n\t\t\tvar document_name = 'Resume' + ' - ' + LocalCacheData.getPortalLoginUser().first_name + ' ' + LocalCacheData.getPortalLoginUser().last_name;\n\t\t\tvar result = this.document_api.addAttachment( document_name, '', { async: false } ).getResult();\n\t\t\tthis.document_id = result['document_id'];\n\t\t\tthis.uploadFile( file, result['document_revision_id'] );\n\t\t}\n\t}\n\n\tuploadFile( file_data, document_revision_id ) {\n\t\tvar $this = this;\n\t\tvar url = ServiceCaller.getAPIURL( 'Class=' + this.document_api.className + '&Method=uploadAttachment' + '&v=2' );\n\t\tif ( LocalCacheData.getAllURLArgs() ) {\n\t\t\tif ( LocalCacheData.getAllURLArgs().hasOwnProperty( 'company_id' ) ) {\n\t\t\t\turl = url + '&company_id=' + LocalCacheData.getAllURLArgs().company_id;\n\t\t\t}\n\t\t}\n\t\turl = url + '&object_id=' + document_revision_id;\n\t\tvar message_id = TTUUID.generateUUID();\n\t\tProgressBar.showProgressBar( message_id );\n\t\tProgressBar.changeProgressBarMessage( $.i18n._( 'File Uploading' ) + '...' );\n\t\t$.ajax( {\n\t\t\turl: url, //Server script to process data\n\t\t\theaders: {\n\t\t\t\t//Handle CSRF tokens and related headers here.\n\t\t\t\t'X-Client-ID': 'Browser-TimeTrex',\n\t\t\t\t'X-CSRF-Token': getCookie( 'CSRF-Token' ),\n\t\t\t},\n\t\t\ttype: 'POST',\n\t\t\tdata: file_data,\n\t\t\tsuccess: function( res ) {\n\t\t\t\tProgressBar.removeProgressBar();\n\t\t\t\t$this.uploaded();\n\t\t\t\tif ( res.error ) {\n\t\t\t\t\t$this.showUploadedMessage( res.error );\n\t\t\t\t} else {\n\t\t\t\t\t$this.showUploadedMessage( $.i18n._( 'Upload Successful!' ) );\n\t\t\t\t\t$this.refreshSubDocument();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcache: false,\n\t\t\tcontentType: false,\n\t\t\tprocessData: false\n\t\t} );\n\t}\n\n\trefreshSubDocument() {\n\t\tif ( this.profileView ) {\n\t\t\tthis.profileView.addDocumentRow( this.document_id );\n\t\t}\n\t}\n\n\tuploaded() {\n\t\tthis.uploader = null;\n\t\tIndexViewController.instance.router.hideFormModal();\n\t}\n\n\tshowUploadedMessage( message ) {\n\t\tIndexViewController.instance.router.showTipModal( message );\n\t}\n}"],"sourceRoot":""}