{"version":3,"sources":["webpack://timetrex/./interface/html5/global/widgets/filebrowser/TImageBrowser.js","webpack://timetrex/./interface/html5/views/my_account/expense/LoginUserExpenseViewController.js"],"names":["$","fn","TImageBrowser","options","Global","addCss","field","browser","opts","extend","defaults","$this","this","name","accept_filter","default_width","default_height","setEnabled","val","btn","find","removeAttr","removeClass","attr","addClass","clearErrorStyle","getFileName","getField","setEnableDelete","image","getValue","FormData","getImageSrc","setImage","hide","d","Date","getTime","css","setValue","each","o","meta","data","isSet","on","image_height","height","naturalHeight","image_width","width","naturalWidth","trigger","show","onImageLoad","changeHandler","bind","deleteImageHandler","FileReader","files","length","window","reader","readAsDataURL","onloadend","url","result","jQuery","LoginUserExpenseViewController","BaseViewController","_","el","hierarchy_level_array","status_array","payment_method_array","sub_document_view_controller","document_object_type_id","relatedExpenseArray","document_api","super","edit_view_tpl","permission_id","viewId","script_name","table_name_key","context_menu_name","i18n","navigation_label","api","TTAPI","APIUserExpense","getProductEdition","job_api","APIJob","job_item_api","APIJobItem","APIDocument","hierarchy_type_id","render","buildContextMenu","initData","setSelectRibbonMenuIfNecessary","exclude","ContextMenuIconName","copy","mass_edit","include","target","doNotValidate","setIsChanged","setMassEditingFieldsWhenFormChange","key","c_value","current_edit_record","amount_arr","onExpensePolicyChange","onResult","res","getResult","setRelatedExpense","related_expense_policy_id","setRelatedExpenseData","edit_view_ui_dic","manual_id","setJobItemValueWhenJobChanged","job_id","setCheckBox","onJobQuickSearch","validate","expense_policies","getSourceData","unit_name","n","type_id","id","parents","html","hasOwnProperty","widget","args","filter_data","setDefaultArgs","collectUIDataToCurrentEditRecord","setEditViewDataDone","user_id","LocalCacheData","getLoginUser","initDropDownOption","basic_search_field_ui_dic","getHierarchyLevelOptions","async","buildRecordArray","setSourceData","buildEditViewUI","tab_model","setTabModel","navigation","AComboBox","api_class","allow_multiple_selection","layout_name","navigation_mode","show_search_inputs","setNavigation","form_item_input","widgetContainer","label","tab_expense","edit_view_tab","tab_expense_column1","tab_expense_column2","edit_view_tabs","push","loadWidgetByName","FormItemType","DATE_PICKER","TDatePicker","addEditFieldToColumn","TEXT_AREA","TTextArea","parent","COMBO_BOX","TComboBox","AWESOME_BOX","APIExpensePolicy","set_empty","always_include_columns","init_data_immediately","TEXT_INPUT","TTextInput","widget_checkbox","CHECKBOX","TCheckbox","append","APICurrency","APIBranch","APIDepartment","setRealValueCallBack","job_coder","disable_keyup_event","job_item_coder","TAG_INPUT","TTagInput","object_type_id","inside_editor_div","inside_editor_args","action","editor","INSIDE_EDITOR","InsideEditor","addRow","insideEditorAddRow","removeRow","insideEditorRemoveRow","insideEditorGetValue","insideEditorSetValue","parent_controller","render_args","row_render","buildSearchFields","search_fields","SearchField","in_column","multiple","basic_search","adv_search","form_item_type","filter","loginUser","initInsideEditorData","AuthorizationHistory","init","object_id","edit_view","removeAllRows","getDefaultData","len","i","row","rows_widgets_array","file","index","getRowRender","getRender","widgets","form_item_file_name","TEXT","TText","setClassStyle","children","eq","document_revision_id","download","view","document_id","downloadFile","form_item_file","IMAGE_BROWSER","file_browser","a","file_name","insertAfter","splice","is_viewing","addIconsEvent","removeLastRowLine","document_attachment_id","ServiceCaller","getURLByObjectType","APIFileDownload","rowIndex","remove_id","TTUUID","isUUID","zero_id","not_exist_id","TAlertManager","showConfirmAlert","text","ProgressBar","showOverlay","key_name","closeOverlay","isValid","remove","expenses","selected_related_expense_policy_id","tab_expense_column3","tax_inputs","amount","empty","net_amount","gross_amount","reimburse_amount","Object","keys","item","editFieldResize","records","related_expenses","setCurrentEditViewState","current_doing_context_action","_continueDoCopyAsNew","result_data","refresh_id","saveInsideEditorData","search","onCopyAsNewClick","setErrorTips","setErrorMenu","onSaveDone","removeEditView","callBack","success","fileItem","addAttachment","uploadFile","document_result","file_data","upload_file_result","method","filter_columns","_getFilterColumnsFromDisplayColumns","filter_sort","getSearchPanelSortFilter","post_data","0","1","2","undefined","className","onAddClick"],"mappings":"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","file":"my_account-expense-LoginUserExpenseViewController.bundle.js?v=2bb677567417a9284fa5","sourcesContent":["( function( $ ) {\n\n\t$.fn.TImageBrowser = function( options ) {\n\t\tGlobal.addCss( 'global/widgets/filebrowser/TImageBrowser.css' );\n\t\tvar opts = $.extend( {}, $.fn.TImageBrowser.defaults, options );\n\n\t\tvar $this = this;\n\t\tvar field;\n\t\tvar id = 'file_browser';\n\t\tvar name = 'filedata';\n\t\tvar browser;\n\n\t\tvar accept_filter = '';\n\n\t\tvar default_width = 177;\n\t\tvar default_height = 42;\n\t\tvar enabled = true;\n\n\t\tthis.setEnabled = function( val ) {\n\t\t\tenabled = val;\n\n\t\t\tvar btn = this.find( '.browser-form input' );\n\n\t\t\tif ( !val ) {\n\t\t\t\tbtn.attr( 'disabled', true );\n\t\t\t\tbtn.removeClass( 'disable-element' ).addClass( 'disable-element' );\n\t\t\t} else {\n\t\t\t\tbtn.removeAttr( 'disabled' );\n\t\t\t\tbtn.removeClass( 'disable-element' );\n\t\t\t}\n\n\t\t};\n\n\t\tthis.clearErrorStyle = function() {\n\n\t\t};\n\n\t\tthis.getFileName = function() {\n\n\t\t\treturn browser.val();\n\t\t};\n\n\t\tthis.getField = function() {\n\t\t\treturn field;\n\t\t};\n\n\t\tthis.setEnableDelete = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\tif ( !val ) {\n\t\t\t\timage.removeAttr( 'enable-delete' );\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\timage.attr( 'enable-delete', 1 );\n\t\t\t}\n\t\t};\n\n\t\tthis.getValue = function() {\n\t\t\tvar form_data;\n\t\t\tif ( browser && browser.val() ) {\n\n\t\t\t\tif ( typeof FormData == 'undefined' ) {\n\t\t\t\t\tform_data = $this.find( '.browser-form' );\n\t\t\t\t} else {\n\t\t\t\t\tform_data = new FormData( $( $this.find( '.browser-form' ) )[0] );\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tform_data = null;\n\t\t\t}\n\n\t\t\treturn form_data;\n\t\t};\n\n\t\tthis.getImageSrc = function() {\n\t\t\tvar image = $this.find( '.image' );\n\t\t\treturn image.attr( 'src' );\n\t\t};\n\n\t\tthis.setImage = function( val ) {\n\t\t\tvar image = $this.find( '.image' );\n\n\t\t\tif ( !val ) {\n\t\t\t\timage.attr( 'src', '' );\n\t\t\t\timage.hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar d = new Date();\n\t\t\timage.hide();\n\t\t\timage.attr( 'src', val + '&t=' + d.getTime() );\n\t\t\timage.css( 'height', 'auto' );\n\t\t\timage.css( 'width', 'auto' );\n\n\t\t};\n\n\t\tvar onImageLoad = function( image ) {\n\n\t\t\tvar image_height = $( image ).height() > 0 ? $( image ).height() : image.naturalHeight;\n\t\t\tvar image_width = $( image ).width() > 0 ? $( image ).width() : image.naturalWidth;\n\n\t\t\tif ( image_height > default_height ) {\n\t\t\t\t$( image ).css( 'height', default_height );\n\n\t\t\t}\n\n\t\t\tif ( image_width > default_width ) {\n\t\t\t\t$( image ).css( 'width', default_width );\n\t\t\t\t$( image ).css( 'height', 'auto' );\n\t\t\t}\n\n\t\t\t$this.trigger( 'setSize' );\n\n\t\t\tif ( image_height < 5 ) {\n\t\t\t\t$( image ).hide();\n\t\t\t} else {\n\t\t\t\t$( image ).show();\n\t\t\t}\n\t\t};\n\n\t\tthis.setValue = function( val ) {\n\n\t\t\tif ( !val ) {\n\t\t\t\tval = '';\n\t\t\t}\n\n\t\t};\n\n\t\tthis.each( function() {\n\t\t\tvar o = $.meta ? $.extend( {}, opts, $( this ).data() ) : opts;\n\n\t\t\tfield = o.field;\n\n\t\t\t// var $this = this;\n\n\t\t\tif ( o.default_width > 0 ) {\n\t\t\t\tdefault_width = o.default_width;\n\t\t\t}\n\n\t\t\tif ( o.default_height > 0 ) {\n\t\t\t\tdefault_height = o.default_height;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( o.name ) ) {\n\t\t\t\tname = o.name;\n\t\t\t}\n\n\t\t\tif ( Global.isSet( accept_filter ) ) {\n\t\t\t\taccept_filter = o.accept_filter;\n\t\t\t}\n\n\t\t\tbrowser = $( this ).find( '.browser' );\n\t\t\tvar image = $( this ).find( '.image' );\n\t\t\timage.hide();\n\t\t\timage.on( 'load', function() {\n\t\t\t\tonImageLoad( this );\n\n\t\t\t} );\n\n\t\t\tif ( accept_filter ) {\n\t\t\t\tbrowser.attr( 'accept', accept_filter );\n\t\t\t} else {\n\t\t\t\taccept_filter = 'image/*';\n\t\t\t\tbrowser.attr( 'accept', 'image/*' );\n\t\t\t}\n\n\t\t\tbrowser.attr( 'id', id );\n\t\t\tbrowser.attr( 'name', name );\n\n\t\t\tif ( Global.isSet( o.changeHandler ) ) {\n\n\t\t\t\t$this.bind( 'imageChange', o.changeHandler );\n\t\t\t}\n\t\t\tif ( Global.isSet( o.deleteImageHandler ) ) {\n\t\t\t\tthis.find( '.file-browser' ).on( 'deleteClick', function() {\n\t\t\t\t\to.deleteImageHandler();\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tbrowser.bind( 'change', function() {\n\t\t\t\timage.hide();\n\n\t\t\t\tif ( typeof FileReader != 'undefined' ) {\n\n\t\t\t\t\tvar files = !!this.files ? this.files : [];\n\n\t\t\t\t\t// If no files were selected, or no FileReader support, return\n\t\t\t\t\tif ( !files.length || !window.FileReader ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( accept_filter === 'image/*' ) {\n\t\t\t\t\t\t// Create a new instance of the FileReader\n\t\t\t\t\t\tvar reader = new FileReader();\n\n\t\t\t\t\t\t// Read the local file as a DataURL\n\t\t\t\t\t\treader.readAsDataURL( files[0] );\n\n\t\t\t\t\t\t// When loaded, set image data as background of div\n\t\t\t\t\t\treader.onloadend = function() {\n\t\t\t\t\t\t\tvar url = this.result;\n\t\t\t\t\t\t\timage.attr( 'src', url );\n\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t$this.trigger( 'imageChange', [$this] );\n\n\t\t\t} );\n\n\t\t} );\n\n\t\treturn this;\n\n\t};\n\n\t$.fn.TImageBrowser.defaults = {};\n\n} )( jQuery );","import '@/global/widgets/filebrowser/TImageBrowser';\n\nexport class LoginUserExpenseViewController extends BaseViewController {\n\tconstructor( options = {} ) {\n\t\t_.defaults( options, {\n\t\t\tel: '#login_user_expense_view_container',\n\n\t\t\t// _required_files: ['TImageBrowser'],\n\n\t\t\thierarchy_level_array: null,\n\t\t\tstatus_array: null,\n\n\t\t\tpayment_method_array: null,\n\n\t\t\tsub_document_view_controller: null,\n\n\t\t\tdocument_object_type_id: null,\n\n\t\t\trelatedExpenseArray: null,\n\n\t\t\tdocument_api: null\n\t\t} );\n\n\t\tsuper( options );\n\t}\n\n\tinit( options ) {\n\t\t//this._super('initialize', options );\n\t\tthis.edit_view_tpl = 'LoginUserExpenseEditView.html';\n\t\tthis.permission_id = 'user_expense';\n\t\tthis.viewId = 'LoginUserExpense';\n\t\tthis.script_name = 'LoginUserExpenseView';\n\t\tthis.table_name_key = 'user_expense';\n\t\tthis.context_menu_name = $.i18n._( 'Expenses' );\n\t\tthis.navigation_label = $.i18n._( 'Expense' ) + ':';\n\t\tthis.api = TTAPI.APIUserExpense;\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\tthis.job_api = TTAPI.APIJob;\n\t\t\tthis.job_item_api = TTAPI.APIJobItem;\n\t\t}\n\n\t\tthis.document_api = TTAPI.APIDocument;\n\n\t\tthis.document_object_type_id = 400;\n\t\tthis.hierarchy_type_id = 200;\n\n\t\tthis.render();\n\t\tthis.buildContextMenu();\n\n\t\tthis.initData();\n\t\tthis.setSelectRibbonMenuIfNecessary( 'LoginUserExpense' );\n\t}\n\n\tgetCustomContextMenuModel() {\n\t\tvar context_menu_model = {\n\t\t\texclude: [ContextMenuIconName.copy, ContextMenuIconName.mass_edit],\n\t\t\tinclude: []\n\t\t};\n\n\t\treturn context_menu_model;\n\t}\n\n\t/* jshint ignore:start */\n\n\tonFormItemChange( target, doNotValidate ) {\n\t\tvar $this = this;\n\n\t\tthis.setIsChanged( target );\n\t\tthis.setMassEditingFieldsWhenFormChange( target );\n\n\t\tvar key = target.getField();\n\t\tvar c_value = target.getValue();\n\n\t\tthis.current_edit_record[key] = c_value;\n\n\t\tvar amount_arr = false;\n\t\tswitch ( key ) {\n\t\t\tcase 'expense_policy_id':\n\t\t\t\tthis.onExpensePolicyChange();\n\t\t\t\tbreak;\n\t\t\tcase 'gross_amount1':\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tif ( this.current_edit_record['expense_policy_id'] && this.current_edit_record['gross_amount1'] ) {\n\t\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'is_reimbursable':\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tamount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\t\t\t\tif ( this.current_edit_record['expense_policy_id'] && this.current_edit_record['gross_amount1'] ) {\n\t\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'amount':\n\t\t\t\tvar related_expense_policy_id = target.attr( 'id' );\n\t\t\t\tthis.current_edit_record['gross_amount1'] = this.current_edit_record['gross_amount1'] ? this.current_edit_record['gross_amount1'] : this.current_edit_record['gross_amount'];\n\t\t\t\tthis.relatedExpenseArray['taxes'][related_expense_policy_id]['amount'] = c_value;\n\n\t\t\t\tif ( this.current_edit_record['expense_policy_id'] && this.current_edit_record['gross_amount1'] ) {\n\n\t\t\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount1'], this.relatedExpenseArray, this.current_edit_record['is_reimbursable'],\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t\t\t$this.setRelatedExpenseData( $this.relatedExpenseArray );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.setJobItemValueWhenJobChanged( target.getValue( true ), 'job_item_id', { job_id: this.current_edit_record.job_id } );\n\t\t\t\t\tthis.edit_view_ui_dic['job_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_item_id':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setValue( target.getValue( true ) ? ( target.getValue( true ).manual_id ? target.getValue( true ).manual_id : '' ) : '' );\n\t\t\t\t\tthis.edit_view_ui_dic['job_item_quick_search'].setCheckBox( true );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'job_quick_search':\n\t\t\tcase 'job_item_quick_search':\n\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\tthis.onJobQuickSearch( key, c_value );\n\n\t\t\t\t\t//Don't validate immediately as onJobQuickSearch is doing async API calls, and it would cause a guaranteed validation failure.\n\t\t\t\t\tdoNotValidate = true;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( !doNotValidate ) {\n\t\t\tthis.validate();\n\t\t}\n\t}\n\n\tonExpensePolicyChange() {\n\t\tvar expense_policies = this.edit_view_ui_dic['expense_policy_id'].getSourceData();\n\n\t\tvar unit_name = $.i18n._( 'Amount' );\n\t\tfor ( var n in expense_policies ) {\n\t\t\tif ( expense_policies[n].type_id == 30 && expense_policies[n].id == this.edit_view_ui_dic['expense_policy_id'].getValue() && expense_policies[n].unit_name && expense_policies[n].unit_name.length > 0 ) {\n\t\t\t\tunit_name = expense_policies[n].unit_name;\n\t\t\t}\n\t\t}\n\t\tthis.edit_view_ui_dic['gross_amount1'].parents( '.edit-view-form-item-div' ).find( '.edit-view-form-item-label' ).html( unit_name + ':' );\n\t}\n\n\tsetCurrentEditRecordData() {\n\n\t\t//Set current edit record data to all widgets\n\t\tfor ( var key in this.current_edit_record ) {\n\n\t\t\tif ( !this.current_edit_record.hasOwnProperty( key ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar widget = this.edit_view_ui_dic[key];\n\n\t\t\tif ( Global.isSet( widget ) ) {\n\t\t\t\tswitch ( key ) {\n\t\t\t\t\tcase 'gross_amount1':\n\t\t\t\t\t\twidget.setValue( this.current_edit_record['gross_amount'] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'gross_amount':\n\t\t\t\t\tcase 'reimburse_amount':\n\t\t\t\t\tcase 'net_amount':\n\t\t\t\t\t\t// Don't do anything.\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_id':\n\t\t\t\t\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t\t\t\t\tvar args = {};\n\t\t\t\t\t\t\targs.filter_data = { job_id: this.current_edit_record.job_id };\n\t\t\t\t\t\t\twidget.setDefaultArgs( args );\n\t\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_id'] ? this.current_edit_record['job_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'job_item_quick_search':\n//\t\t\t\t\t\twidget.setValue( this.current_edit_record['job_item_id'] ? this.current_edit_record['job_item_id'] : 0 );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\twidget.setValue( this.current_edit_record[key] );\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tthis.collectUIDataToCurrentEditRecord();\n\t\tthis.setEditViewDataDone();\n\t}\n\n\t/* jshint ignore:end */\n\tinitOptions() {\n\t\tvar $this = this;\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\tthis.initDropDownOption( 'status' );\n\t\tthis.initDropDownOption( 'payment_method' );\n\n\t\targs.filter_data = filter_data;\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['expense_policy_id'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['expense_policy_id'].setDefaultArgs( args );\n\t\t}\n\n\t\tvar res = this.api.getHierarchyLevelOptions( [-1], { async: false } );\n\t\tvar data = res.getResult();\n\t\t$this['hierarchy_level_array'] = Global.buildRecordArray( data );\n\t\tif ( Global.isSet( $this.basic_search_field_ui_dic['hierarchy_level'] ) ) {\n\t\t\t$this.basic_search_field_ui_dic['hierarchy_level'].setSourceData( Global.buildRecordArray( data ) );\n\t\t}\n\t}\n\n\tbuildEditViewUI() {\n\n\t\tsuper.buildEditViewUI();\n\n\t\tvar $this = this;\n\n\t\tvar tab_model = {\n\t\t\t'tab_expense': { 'label': $.i18n._( 'Expense' ) },\n\t\t\t'tab_attachment': true,\n\t\t\t'tab_audit': true,\n\t\t};\n\t\tthis.setTabModel( tab_model );\n\n\t\tthis.navigation.AComboBox( {\n\t\t\tapi_class: TTAPI.APIUserExpense,\n\t\t\tid: this.script_name + '_navigation',\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense',\n\t\t\tnavigation_mode: true,\n\t\t\tshow_search_inputs: true\n\t\t} );\n\n\t\tthis.setNavigation();\n\n\t\t//Tab 0 start\n\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\n\t\tvar tab_expense_column1 = tab_expense.find( '.first-column' );\n\t\tvar tab_expense_column2 = tab_expense.find( '.second-column' );\n\n\t\tthis.edit_view_tabs[0] = [];\n\n\t\tthis.edit_view_tabs[0].push( tab_expense_column1 );\n\t\tthis.edit_view_tabs[0].push( tab_expense_column2 );\n\n\t\tvar form_item_input;\n\t\tvar widgetContainer;\n\t\tvar label;\n\n\t\t// Date Incurred\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.DATE_PICKER );\n\n\t\tform_item_input.TDatePicker( { field: 'incurred_date' } );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Date Incurred' ), form_item_input, tab_expense_column1, '', null );\n\n\t\t// Description\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_AREA );\n\t\tform_item_input.TTextArea( { field: 'description', width: '100%' } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Description' ), form_item_input, tab_expense_column1, '', null, null, true );\n\n\t\tform_item_input.parent().width( '45%' );\n\n\t\t// Payment Method\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.COMBO_BOX );\n\n\t\tform_item_input.TComboBox( { field: 'payment_method_id' } );\n\t\tform_item_input.setSourceData( $this.payment_method_array );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Payment Method' ), form_item_input, tab_expense_column1 );\n\n\t\t// Type\n\n\t\tvar args = {};\n\t\tvar filter_data = {};\n\t\tfilter_data.type_id = [10, 20, 30];\n\t\tfilter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_data = filter_data;\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_expense_policy',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'expense_policy_id',\n\t\t\talways_include_columns: ['type_id', 'unit_name'],\n\t\t\tinit_data_immediately: false\n\t\t} );\n\n\t\tform_item_input.setDefaultArgs( args );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Type' ), form_item_input, tab_expense_column1 );\n\n\t\t//Amount\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\tform_item_input.TTextInput( { field: 'gross_amount1' } );\n\n\t\twidgetContainer = $( '<div class=\\'widget-h-box \\'></div>' );\n\t\tlabel = $( '<span class=\\'widget-right-label\\'> ' + $.i18n._( 'Reimburse' ) + ': </span>' );\n\n\t\tvar widget_checkbox = Global.loadWidgetByName( FormItemType.CHECKBOX );\n\t\twidget_checkbox.TCheckbox( { field: 'is_reimbursable' } );\n\n\t\twidgetContainer.append( form_item_input );\n\t\twidgetContainer.append( label );\n\t\twidgetContainer.append( widget_checkbox );\n\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), [form_item_input, widget_checkbox], tab_expense_column1, '', widgetContainer );\n\n\t\t// Currency\n\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APICurrency,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_currency',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'currency_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Currency' ), form_item_input, tab_expense_column2, '' );\n\n\t\t//Branch\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIBranch,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_branch',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'branch_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Branch' ), form_item_input, tab_expense_column2 );\n\n\t\t//Department\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\tform_item_input.AComboBox( {\n\t\t\tapi_class: TTAPI.APIDepartment,\n\t\t\tallow_multiple_selection: false,\n\t\t\tlayout_name: 'global_department',\n\t\t\tshow_search_inputs: true,\n\t\t\tset_empty: true,\n\t\t\tfield: 'department_id'\n\t\t} );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Department' ), form_item_input, tab_expense_column2 );\n\n\t\tif ( ( Global.getProductEdition() >= 20 ) ) {\n\t\t\t//Job\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJob,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_coder.TTextInput( { field: 'job_quick_search', disable_keyup_event: true } );\n\t\t\tjob_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Job' ), [form_item_input, job_coder], tab_expense_column2, '', widgetContainer );\n\n\t\t\t// Task\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.AWESOME_BOX );\n\n\t\t\tform_item_input.AComboBox( {\n\t\t\t\tapi_class: TTAPI.APIJobItem,\n\t\t\t\tallow_multiple_selection: false,\n\t\t\t\tlayout_name: 'global_job_item',\n\t\t\t\tshow_search_inputs: true,\n\t\t\t\tset_empty: true,\n\t\t\t\tsetRealValueCallBack: ( function( val ) {\n\n\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\tjob_item_coder.setValue( val.manual_id );\n\t\t\t\t\t}\n\t\t\t\t} ),\n\t\t\t\tfield: 'job_item_id'\n\t\t\t} );\n\n\t\t\twidgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\n\t\t\tvar job_item_coder = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\tjob_item_coder.TTextInput( { field: 'job_item_quick_search', disable_keyup_event: true } );\n\t\t\tjob_item_coder.addClass( 'job-coder' );\n\n\t\t\twidgetContainer.append( job_item_coder );\n\t\t\twidgetContainer.append( form_item_input );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Task' ), [form_item_input, job_item_coder], tab_expense_column2, '', widgetContainer );\n\t\t}\n\n\t\t//Tags\n\t\tform_item_input = Global.loadWidgetByName( FormItemType.TAG_INPUT );\n\n\t\tform_item_input.TTagInput( { field: 'tag', object_type_id: 930 } );\n\t\tthis.addEditFieldToColumn( $.i18n._( 'Tags' ), form_item_input, tab_expense_column2, '', null, null, true );\n\n\t\t//Inside editor\n\n\t\tvar inside_editor_div = tab_expense.find( '.inside-editor-div' );\n\n\t\tvar inside_editor_args = {\n\t\t\tname: $.i18n._( 'Attachment  Name' ),\n\t\t\taction: $.i18n._( 'Action' )\n\t\t};\n\n\t\tthis.editor = Global.loadWidgetByName( FormItemType.INSIDE_EDITOR );\n\t\tthis.editor.InsideEditor( {\n\t\t\taddRow: this.insideEditorAddRow,\n\t\t\tremoveRow: this.insideEditorRemoveRow,\n\t\t\tgetValue: this.insideEditorGetValue,\n\t\t\tsetValue: this.insideEditorSetValue,\n\t\t\tparent_controller: this,\n\t\t\tapi: this.document_api,\n\t\t\trender: 'views/my_account/expense/DocumentViewInsideEditorRender.html',\n\t\t\trender_args: inside_editor_args,\n\t\t\trow_render: 'views/my_account/expense/DocumentViewInsideEditorRow.html'\n\n\t\t} );\n\n\t\tinside_editor_div.append( this.editor );\n\t}\n\n\tbuildSearchFields() {\n\n\t\tsuper.buildSearchFields();\n\t\tthis.search_fields = [\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Type' ),\n\t\t\t\tin_column: 1,\n\t\t\t\tfield: 'expense_policy_id',\n\t\t\t\tlayout_name: 'global_expense_policy',\n\t\t\t\tapi_class: TTAPI.APIExpensePolicy,\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Tags' ),\n\t\t\t\tfield: 'tag',\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tin_column: 1,\n\t\t\t\tobject_type_id: 930,\n\t\t\t\tform_item_type: FormItemType.TAG_INPUT\n\t\t\t} ),\n\n\t\t\tnew SearchField( {\n\t\t\t\tlabel: $.i18n._( 'Status' ),\n\t\t\t\tin_column: 2,\n\t\t\t\tfield: 'status_id',\n\t\t\t\tmultiple: true,\n\t\t\t\tbasic_search: true,\n\t\t\t\tadv_search: false,\n\t\t\t\tlayout_name: 'global_option_column',\n\t\t\t\tform_item_type: FormItemType.AWESOME_BOX\n\t\t\t} )\n\t\t];\n\t}\n\n\tgetSubViewFilter( filter ) {\n\n\t\tif ( filter.length === 0 ) {\n\t\t\tfilter = {};\n\t\t}\n\n\t\tfilter['parent_id'] = 0;\n\t\tfilter['user_id'] = LocalCacheData.loginUser.id;\n\n\t\treturn filter;\n\t}\n\n\tsetEditViewDataDone() {\n\t\tsuper.setEditViewDataDone();\n\t\tif ( this.current_edit_record['related_expenses'] ) {\n\t\t\tthis.relatedExpenseArray = this.current_edit_record['related_expenses'];\n\t\t} else {\n\t\t\t//this.relatedExpenseArray = {};\n\t\t\tvar $this = this;\n\t\t\tvar amount_arr = this.relatedExpenseArray ? this.relatedExpenseArray : false;\n\t\t\tthis.api['calcRelatedExpenses'](\n\t\t\t\tthis.current_edit_record['expense_policy_id'], this.current_edit_record['gross_amount'], amount_arr, this.current_edit_record['is_reimbursable'],\n\t\t\t\t{\n\t\t\t\t\tonResult: function( res ) {\n\t\t\t\t\t\t$this.relatedExpenseArray = res.getResult();\n\t\t\t\t\t\t$this.setRelatedExpense( $this.relatedExpenseArray );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t}\n\n\t\tthis.setRelatedExpense( this.relatedExpenseArray );\n\n\t\tthis.initInsideEditorData();\n\t\tAuthorizationHistory.init( this );\n\n\t\tthis.onExpensePolicyChange();\n\t}\n\n\tinitInsideEditorData() {\n\t\tvar $this = this;\n\t\tvar args = {};\n\t\targs.filter_data = {};\n\n\t\tif ( !this.current_edit_record || !this.current_edit_record.id ) {\n\t\t\t$this.editor.removeAllRows();\n\t\t\t$this.editor.getDefaultData();\n\n\t\t} else {\n\n\t\t\targs.filter_data.object_type_id = this.document_object_type_id;\n\t\t\targs.filter_data.object_id = this.current_edit_record['id'];\n\n\t\t\t$this.api['getAttachment']( args, {\n\t\t\t\tonResult: function( res ) {\n\n\t\t\t\t\tif ( !$this.edit_view ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvar data = res.getResult();\n\t\t\t\t\t$this.editor.setValue( data );\n\n\t\t\t\t}\n\t\t\t} );\n\n\t\t}\n\t}\n\n\tinsideEditorSetValue( val ) {\n\t\tvar len = val.length;\n\t\tthis.removeAllRows();\n\n\t\tif ( len > 0 ) {\n\t\t\tfor ( var i = 0; i < val.length; i++ ) {\n\t\t\t\tif ( Global.isSet( val[i] ) ) {\n\t\t\t\t\tvar row = val[i];\n\t\t\t\t\tthis.addRow( row );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.getDefaultData();\n\t\t}\n\t}\n\n\tinsideEditorGetValue() {\n\n\t\tvar len = this.rows_widgets_array.length;\n\n\t\tvar result = [];\n\n\t\tfor ( var i = 0; i < len; i++ ) {\n\t\t\tvar row = this.rows_widgets_array[i];\n\t\t\tif ( Global.isSet( row.file ) ) {\n\t\t\t\tvar data = {\n\t\t\t\t\tname: row.name.getValue(),\n\t\t\t\t\tfile: row.file.getValue()\n\t\t\t\t};\n\n\t\t\t\tif ( data.name === 'No File Selected' ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresult.push( data );\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsideEditorAddRow( data, index ) {\n\n\t\tif ( !data ) {\n\t\t\tthis.getDefaultData( index );\n\t\t} else {\n\t\t\tvar row = this.getRowRender(); //Get Row render\n\t\t\tvar render = this.getRender(); //get render, should be a table\n\t\t\tvar widgets = {}; //Save each row's widgets\n\n\t\t\t//Build row widgets\n\n\t\t\t// Attachment Name\n\t\t\tvar form_item_file_name = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_file_name.TText( { field: 'name', width: 400 } );\n\t\t\tform_item_file_name.setValue( data.name ? data.name : $.i18n._( 'No File Selected' ) );\n\t\t\tform_item_file_name.setClassStyle( data.name ? { 'font-weight': 'bold' } : null );\n\t\t\twidgets[form_item_file_name.getField()] = form_item_file_name;\n\t\t\trow.children().eq( 0 ).append( form_item_file_name );\n\t\t\tform_item_file_name.attr( 'document_id', ( data.id && this.parent_controller.current_edit_record.id ) ? data.id : '' );\n\t\t\tform_item_file_name.attr( 'document_revision_id', ( data.document_revision_id && this.parent_controller.current_edit_record.id ) ? data.document_revision_id : '' );\n\n\t\t\t// Action\n\t\t\tif ( data.name ) {\n\n\t\t\t\tvar widgetContainer = $( '<div class=\\'widget-h-box\\'></div>' );\n\t\t\t\tvar download = $( '<button type=\\'button\\' class=\\' download-button t-button widget-right-label\\'>' + $.i18n._( 'Download' ) + '</button>' );\n\t\t\t\tvar view = $( '<button type=\\'button\\' class=\\' view-button t-button widget-right-label\\'>' + $.i18n._( 'View' ) + '</button>' );\n\n\t\t\t\tdownload.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\t\t\t\tview.attr( {\n\t\t\t\t\tdocument_id: data.id,\n\t\t\t\t\tdocument_revision_id: data.document_revision_id,\n\t\t\t\t\tobject_type_id: this.parent_controller.document_object_type_id\n\t\t\t\t} );\n\n\t\t\t\tdownload.bind( 'click', this.parent_controller.downloadFile );\n\t\t\t\tview.bind( 'click', this.parent_controller.downloadFile );\n\n\t\t\t\twidgetContainer.append( download );\n\t\t\t\twidgetContainer.append( view );\n\n\t\t\t\trow.children().eq( 1 ).append( widgetContainer );\n\t\t\t} else {\n\t\t\t\tvar form_item_file = Global.loadWidgetByName( FormItemType.IMAGE_BROWSER );\n\n\t\t\t\tvar $this = this.file_browser = form_item_file.TImageBrowser( {\n\t\t\t\t\t\tfield: 'file',\n\t\t\t\t\t\tname: 'filedata',\n\t\t\t\t\t\taccept_filter: '*',\n\t\t\t\t\t\tchangeHandler: function( a ) {\n\t\t\t\t\t\t\tvar file_name = $( this ).find( '.browser' )[0].files[0].name;\n\t\t\t\t\t\t\tform_item_file_name.setValue( file_name );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\twidgets[form_item_file.getField()] = form_item_file;\n\t\t\t\trow.children().eq( 1 ).append( form_item_file );\n\n\t\t\t}\n\n\t\t\t// end\n\n\t\t\tif ( typeof index != 'undefined' ) {\n\n\t\t\t\trow.insertAfter( $( render ).find( 'tr' ).eq( index ) );\n\t\t\t\tthis.rows_widgets_array.splice( ( index ), 0, widgets );\n\n\t\t\t} else {\n\t\t\t\t$( render ).append( row );\n\t\t\t\tthis.rows_widgets_array.push( widgets );\n\t\t\t}\n\t\t\tif ( this.parent_controller.is_viewing ) {\n\t\t\t\trow.find( '.control-icon' ).hide();\n\t\t\t}\n\n\t\t\tthis.addIconsEvent( row ); //Bind event to add and minus icon\n\t\t\tthis.removeLastRowLine();\n\t\t}\n\t}\n\n\tdownloadFile() {\n\t\tvar $this = $( this );\n\t\tvar document_attachment_id = $this.attr( 'document_id' );\n\t\tvar document_revision_id = $this.attr( 'document_revision_id' );\n\t\tvar object_type_id = $this.attr( 'object_type_id' );\n\n\t\tvar url = ServiceCaller.getURLByObjectType( 'file_download' ) + '&object_type=document&parent_id=' + document_attachment_id + '&parent_object_type_id=' + object_type_id + '&object_id=' + document_revision_id;\n\n\t\tGlobal.APIFileDownload( null, null, null, url );\n\t}\n\n\tinsideEditorRemoveRow( row ) {\n\n\t\tvar $this = this;\n\t\tvar index = row[0].rowIndex - 1;\n\t\tvar remove_id = this.rows_widgets_array[index].name.attr( 'document_id' );\n\t\tif ( TTUUID.isUUID( remove_id ) && remove_id != TTUUID.zero_id && remove_id != TTUUID.not_exist_id ) {\n\t\t\tTAlertManager.showConfirmAlert( 'Are you sure to ' + this.rows_widgets_array[index].name.text() + '?', null, function( result ) {\n\t\t\t\tif ( result ) {\n\t\t\t\t\tProgressBar.showOverlay();\n\t\t\t\t\t$this.api['delete' + $this.api.key_name]( remove_id, $this.parent_controller.document_object_type_id, {\n\t\t\t\t\t\tonResult: function( result ) {\n\t\t\t\t\t\t\tProgressBar.closeOverlay();\n\t\t\t\t\t\t\tif ( result.isValid() ) {\n\t\t\t\t\t\t\t\trow.remove();\n\t\t\t\t\t\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t\t\t\t\t\t\tif ( $this.rows_widgets_array.length === 0 ) {\n\t\t\t\t\t\t\t\t\t$this.getDefaultData();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t\t} else {\n\t\t\trow.remove();\n\t\t\t$this.rows_widgets_array.splice( index, 1 );\n\t\t}\n\n\t\tthis.removeLastRowLine();\n\t}\n\n\t/**\n\t * this just sets the subform data\n\t * should be called in most cases\n\t *\n\t * @param expenses\n\t */\n\tsetRelatedExpenseData( expenses, selected_related_expense_policy_id ) {\n\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' );\n\n\t\ttab_expense_column3.find( '#net_amount' ).val( expenses['net_amount'] );\n\t\ttab_expense_column3.find( '#gross_amount' ).val( expenses['gross_amount'] );\n\t\ttab_expense_column3.find( '#reimburse_amount' ).val( expenses['reimburse_amount'] );\n\n\t\tvar tax_inputs = tab_expense_column3.find( '.tax_input' );\n\t\tfor ( var n = 0; n < tax_inputs.length; n++ ) {\n\t\t\tvar el = $( tax_inputs[n] );\n\t\t\tif ( el.length > 0 ) {\n\t\t\t\tvar id = el.attr( 'id' );\n\t\t\t\tif ( !selected_related_expense_policy_id || selected_related_expense_policy_id != id ) {\n\t\t\t\t\tel.val( expenses['taxes'][id].amount );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tsetRelatedExpense( expenses ) {\n\t\t// Third column start\n\t\tif ( this.edit_view_tab ) { //Fix: Uncaught TypeError: Cannot read property 'find' of null\n\t\t\tvar tab_expense = this.edit_view_tab.find( '#tab_expense' );\n\t\t\tvar tab_expense_column3 = tab_expense.find( '.third-column' ).empty();\n\n\t\t\tif ( this.edit_view_tabs[0].length < 3 ) {\n\t\t\t\tthis.edit_view_tabs[0].push( tab_expense_column3 );\n\t\t\t}\n\n\t\t\tif ( !expenses ) {\n\t\t\t\texpenses = {\n\t\t\t\t\tnet_amount: 0,\n\t\t\t\t\tgross_amount: 0,\n\t\t\t\t\treimburse_amount: this.current_edit_record.reimburse_amount\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( expenses && expenses['taxes'] && Object.keys( expenses['taxes'] ).length > 0 ) {\n\t\t\t\t// Net Amount\n\t\t\t\tvar form_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\tform_item_input.TTextInput( { field: 'net_amount' } );\n\t\t\t\tform_item_input.setValue( expenses['net_amount'] );\n\t\t\t\tform_item_input.setEnabled( !this.is_viewing );\n\t\t\t\tform_item_input.attr( 'id', 'net_amount' );\n\t\t\t\tform_item_input.setEnabled( false );\n\t\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Net Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\t\t\t\tthis.edit_view_ui_dic['net_amount'].css( 'opacity', 1 );\n\n\t\t\t\tfor ( var key in expenses['taxes'] ) {\n\t\t\t\t\tvar item = expenses['taxes'][key];\n\n\t\t\t\t\t// taxes\n\t\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT_INPUT );\n\t\t\t\t\tform_item_input.TTextInput( { field: 'amount' } );\n\t\t\t\t\tform_item_input.setValue( item['amount'] );\n\t\t\t\t\tform_item_input.attr( 'id', item['expense_policy_id'] );\n\t\t\t\t\tform_item_input.addClass( 'tax_input' );\n\t\t\t\t\tform_item_input.setEnabled( !this.is_viewing );\n\t\t\t\t\tthis.addEditFieldToColumn( $.i18n._( item['expense_policy_name'] ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\t\t\tthis.edit_view_ui_dic['amount'].css( 'opacity', 1 );\n\t\t\t\t}\n\n\t\t\t\t// Amount\n\t\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\t\tform_item_input.TText( { field: 'gross_amount' } );\n\t\t\t\tform_item_input.setValue( expenses['gross_amount'] );\n\t\t\t\tform_item_input.attr( 'id', 'gross_amount' );\n\t\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\t\t\t\tthis.edit_view_ui_dic['gross_amount'].css( 'opacity', 1 );\n\n\t\t\t}\n\t\t\t// Reimburse Amount\n\t\t\tform_item_input = Global.loadWidgetByName( FormItemType.TEXT );\n\t\t\tform_item_input.TText( { field: 'reimburse_amount' } );\n\n\t\t\tif ( expenses && expenses['reimburse_amount'] && expenses['unit_amount'] && expenses['unit_name'] ) {\n\t\t\t\tform_item_input.setValue( expenses['reimburse_amount'] + ' (' + expenses['unit_amount'] + '/' + expenses['unit_name'] + ')' );\n\t\t\t} else {\n\t\t\t\tform_item_input.setValue( expenses['reimburse_amount'] );\n\t\t\t}\n\n\t\t\tform_item_input.attr( 'id', 'reimburse_amount' );\n\t\t\tthis.addEditFieldToColumn( $.i18n._( 'Reimburse Amount' ), form_item_input, tab_expense_column3, '', null, true );\n\n\t\t\tthis.edit_view_ui_dic['reimburse_amount'].css( 'opacity', 1 );\n\n\t\t\tthis.editFieldResize( 0 );\n\t\t}\n\t}\n\n\tuniformVariable( records ) {\n\t\tif ( this.relatedExpenseArray ) {\n\t\t\trecords.related_expenses = this.relatedExpenseArray;\n\t\t\trecords.gross_amount = this.relatedExpenseArray.gross_amount;\n\t\t\trecords.net_amount = this.relatedExpenseArray.net_amount;\n\t\t\trecords.reimburse_amount = this.relatedExpenseArray.reimburse_amount;\n\t\t}\n\t\treturn records;\n\t}\n\n\t// onSaveAndContinueResult( result ) {\n\t//\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onEditClick( $this.refresh_id, true );\n\t//\n\t// \t\t\t$this.onSaveAndContinueDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t// onSaveAndNewResult: function( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) { // as new\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onAddClick( true );\n\t//\n\t// \t\t} );\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\t_continueDoCopyAsNew() {\n\t\tthis.setCurrentEditViewState( 'new' );\n\t\tLocalCacheData.current_doing_context_action = 'copy_as_new';\n\n\t\tif ( Global.isSet( this.edit_view ) ) {\n\t\t\tthis.editor.removeAllRows();\n\t\t\tthis.editor.getDefaultData();\n\t\t}\n\t\tsuper._continueDoCopyAsNew();\n\t}\n\n\tonSaveAndCopyResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search( false );\n\n\t\t\t\t$this.onCopyAsNewClick();\n\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorTips( result );\n\t\t\t$this.setErrorMenu();\n\t\t}\n\t}\n\n\t// onSaveAndNextResult( result ) {\n\t// \tvar $this = this;\n\t// \tif ( result.isValid() ) {\n\t// \t\tvar result_data = result.getResult();\n\t// \t\tif ( result_data === true ) {\n\t// \t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t//\n\t// \t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t// \t\t\t$this.refresh_id = result_data;\n\t// \t\t}\n\t//\n\t// \t\t$this.saveInsideEditorData( function() {\n\t// \t\t\t$this.onRightArrowClick();\n\t// \t\t\t$this.search( false );\n\t// \t\t\t$this.onSaveAndNextDone( result );\n\t//\n\t// \t\t} );\n\t//\n\t// \t} else {\n\t// \t\t$this.setErrorTips( result );\n\t// \t\t$this.setErrorMenu();\n\t// \t}\n\t// },\n\n\tonSaveResult( result ) {\n\t\tvar $this = this;\n\t\tif ( result.isValid() ) {\n\t\t\tvar result_data = result.getResult();\n\t\t\tif ( result_data === true ) {\n\t\t\t\t$this.refresh_id = $this.current_edit_record.id;\n\t\t\t} else if ( TTUUID.isUUID( result_data ) && result_data != TTUUID.zero_id && result_data != TTUUID.not_exist_id ) {\n\t\t\t\t$this.refresh_id = result_data;\n\t\t\t}\n\n\t\t\t$this.saveInsideEditorData( function() {\n\t\t\t\t$this.search();\n\t\t\t\t$this.onSaveDone( result );\n\n\t\t\t\t$this.removeEditView();\n\t\t\t} );\n\n\t\t} else {\n\t\t\t$this.setErrorMenu();\n\t\t\t$this.setErrorTips( result );\n\n\t\t}\n\t}\n\n\t/* jshint ignore:start */\n\tsaveInsideEditorData( callBack ) {\n\t\tvar $this = this;\n\t\tvar data = this.editor.getValue();\n\t\tvar files = data.length;\n\t\tif ( files > 0 ) {\n\t\t\tvar success = 0;\n\t\t\tfor ( var key in data ) {\n\t\t\t\tvar fileItem = data[key];\n\t\t\t\tif ( Global.isSet( fileItem.file ) ) {\n\t\t\t\t\tvar document_revision_id = this.api.addAttachment( fileItem.name, this.document_object_type_id, this.refresh_id, { async: false } ).getResult();\n\t\t\t\t\t$this.api.uploadFile( fileItem.file, 'object_type=document_revision&object_id=' + document_revision_id + '&parent_object_type_id=' + this.document_object_type_id, {} );\n\t\t\t\t\tsuccess++;\n\n\t\t\t\t} else {\n\t\t\t\t\tcallBack();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( success === files ) {\n\t\t\t\tcallBack();\n\t\t\t}\n\n\t\t} else {\n\t\t\tcallBack();\n\t\t}\n\t}\n\n\t/* jshint ignore:end */\n\tuploadFile( document_result, file_data ) {\n\t\tvar document_revision_id = document_result.getResult();\n\t\tvar $this = this;\n\n\t\t$this.api.uploadFile( file_data, 'object_type=document_revision&object_id=' + document_revision_id, {\n\t\t\tonResult: function( upload_file_result ) {\n\t\t\t}\n\t\t} );\n\t}\n\n\tonExportClick( method ) {\n\t\tvar args = {};\n\t\targs.filter_columns = this._getFilterColumnsFromDisplayColumns( null, false );\n\t\targs.filter_data = {};\n\t\targs.filter_data.type_id = [10, 20, 30];\n\t\targs.filter_data.user_id = [LocalCacheData.getLoginUser().id];\n\n\t\targs.filter_sort = this.getSearchPanelSortFilter();\n\t\tvar post_data = { 0: 'csv', 1: args, 2: true };\n\n\t\tif ( method == undefined ) {\n\t\t\tmethod = this.api['export' + this.api.key_name];\n\t\t}\n\t\tGlobal.APIFileDownload( this.api.className, method, post_data );\n\t}\n\n\tonAddClick() {\n\t\tthis.relatedExpenseArray = null;\n\t\tsuper.onAddClick();\n\t}\n\n\t// onDeleteResult: function( result, remove_ids ) {\n\t// \tvar $this = this;\n\t// \tProgressBar.closeOverlay();\n\t// \t$this.search();\n\t// \tif ( result.isValid() ) {\n\t// \t\t$this.onDeleteDone( result );\n\t// \t\tif ( $this.edit_view ) {\n\t// \t\t\t$this.removeEditView();\n\t// \t\t}\n\t// \t} else {\n\t// \t\tTAlertManager.showErrorAlert( result );\n\t// \t}\n\t// },\n\n}"],"sourceRoot":""}