(self.webpackChunktimetrex=self.webpackChunktimetrex||[]).push([["policy-accrual_policy-AccrualPolicyUserModifierViewController"],{7369:(e,i,t)=>{"use strict";t.r(i),t.d(i,{"AccrualPolicyUserModifierViewController":()=>a});class a extends BaseViewController{constructor(e={}){_.defaults(e,{el:"#accrual_policy_user_modifier_view_container",user_api:null,parent_view:null,result_details:null}),super(e)}init(e){"employee"===this.parent_view?(this.context_menu_name=$.i18n._("Accruals"),this.navigation_label=$.i18n._("Accrual")+":"):"accrual_policy"===this.parent_view&&(this.context_menu_name=$.i18n._("Employee Settings"),this.navigation_label=$.i18n._("Employee Accrual Modifier")+":"),this.edit_view_tpl="AccrualPolicyUserModifierEditView.html",this.permission_id="accrual_policy",this.script_name="AccrualPolicyUserModifierView",this.viewId="AccrualPolicyUserModifier",this.table_name_key="accrual_policy_user_modifier",this.api=TTAPI.APIAccrualPolicyUserModifier,this.user_api=TTAPI.APIUser,this.render(),this.sub_view_mode?this.buildContextMenu(!0):this.buildContextMenu(),this.sub_view_mode||this.initData(),this.setSelectRibbonMenuIfNecessary()}getCustomContextMenuModel(){return{exclude:[ContextMenuIconName.add,ContextMenuIconName.copy],include:["default"]}}setSubLogViewFilter(){return!!this.sub_log_view_controller&&(this.sub_log_view_controller.getSubViewFilter=function(e){return e.table_name_object_id={"accrual_policy_user_modifier":[this.parent_edit_record.accrual_policy_id]},e},!0)}onAddClick(){var e,i=this;if(this.setCurrentEditViewState("new"),i.openEditView(),i.sub_view_mode&&i.parent_key)switch(i.parent_key){case"user_id":e=i.parent_value;break;case"accrual_policy_id":e=!1}else e=!1;i.api["get"+i.api.key_name+"DefaultData"](e,{onResult:function(e){i.onAddResult(e)}})}setSelectLayout(e){Global.isSet(this.grid)||($(this.el).find("#grid").attr("id",this.ui_id+"_grid"),$(this.el).find("#"+this.ui_id+"_grid"));var i,t=[];this.select_layout||(this.select_layout={id:""},this.select_layout.data={filter_data:{},filter_sort:{}},this.select_layout.data.display_columns=this.default_display_columns);var a=this.select_layout.data;a.display_columns.length<1&&(a.display_columns=this.default_display_columns);var l=this.buildDisplayColumns(a.display_columns);if(!this.sub_view_mode){this.column_selector.setSelectGridData(l),this.sort_by_selector.setSourceData(this.buildSortSelectorUnSelectColumns(l)),this.sort_by_selector.setValue(this.buildSortBySelectColumns());var r=this.search_panel.getLayoutsArray();this.setPreviousSavedSearchSourcesAndValue(r)}l.length;if(Global.isSet(e)&&e>0&&e,!this.grid){"accrual_policy"===this.parent_view?(i={name:"full_name",index:"full_name",label:$.i18n._("Employee"),width:50,sortable:!1,title:!1},t.push(i)):"employee"===this.parent_view&&(i={name:"accrual_policy",index:"accrual_policy",label:$.i18n._("Accrual Policy"),width:50,sortable:!1,title:!1},t.push(i)),i={name:"length_of_service_date",index:"length_of_service_date",label:$.i18n._("Length of Service Date"),width:80,sortable:!1,title:!1},t.push(i),i={name:"length_of_service_modifier",index:"length_of_service_modifier",label:$.i18n._("Length of Service Modifier"),width:90,sortable:!1,title:!1},t.push(i),i={name:"accrual_rate_modifier",index:"accrual_rate_modifier",label:$.i18n._("Accrual Rate Modifier"),width:80,sortable:!1,title:!1},t.push(i),i={name:"annual_maximum_time_modifier",index:"annual_maximum_time_modifier",label:$.i18n._("Annual Accrual Maximum Modifier"),width:110,sortable:!1,title:!1},t.push(i),i={name:"maximum_time_modifier",index:"maximum_time_modifier",label:$.i18n._("Accrual Maximum Balance Modifier"),width:110,sortable:!1,title:!1},t.push(i),i={name:"rollover_time_modifier",index:"rollover_time_modifier",label:$.i18n._("Annual Maximum Rollover Modifier"),width:110,sortable:!1,title:!1},t.push(i);this.sub_view_mode&&($("#tab_accruals:visible").length>0?"#tab_accruals":"#tab_employee_settings");var s=this.getGridSetup();this.grid=new TTGrid(this.ui_id+"_grid",s,t)}0===LocalCacheData.paging_type?(this.paging_widget.parent().length>0&&this.paging_widget.remove(),this.paging_widget.css("width",this.grid.width()),this.grid.grid.append(this.paging_widget),this.paging_widget.click($.proxy(this.onPaging,this))):this.paging_widget.parent().length<1&&($(this.el).find(".total-number-div").append(this.paging_widget),$(this.el).find(".bottom-div").append(this.paging_widget_2),this.paging_widget.bind("paging",$.proxy(this.onPaging2,this)),this.paging_widget_2.bind("paging",$.proxy(this.onPaging2,this))),this.bindGridColumnEvents(),this.setGridHeaderStyle(),LocalCacheData.default_filter_for_next_open_view&&(this.select_layout.data.filter_data=LocalCacheData.default_filter_for_next_open_view.filter_data,LocalCacheData.default_filter_for_next_open_view=null),this.filter_data=this.select_layout.data.filter_data,this.sub_view_mode||this.setSearchPanelFilter(!0),this.showGridBorders()}setGridSetup(){var e=this;return{height:200,onResizeGrid:!0,sub_grid_mode:this.sub_view_mode,container_selector:container,onSelectRow:function(){e.onGridSelectRow()},onCellSelect:function(){e.onGridSelectRow()},onSelectAll:function(){e.onGridSelectAll()},ondblClickRow:function(i){e.onGridDblClickRow(i)},onRightClickRow:function(i){e.getGridSelectIdArray().indexOf(i)<0&&(e.grid.grid.resetSelection(),e.grid.grid.setSelection(i),e.onGridSelectRow())}}}getFilterColumnsFromDisplayColumns(){var e=[];this.grid&&(e=this.grid.grid.getGridParam("colModel"));var i={is_owner:!0,id:!0,user_id:!0,accrual_policy_id:!0,is_child:!0,in_use:!0,first_name:!0,last_name:!0,type_id:!0};if(e)for(var t=e.length,a=0;a<t;a++){i[e[a].name]=!0}return i}doEditAPICall(e,i,t){var a=this.getCurrentSelectedRecord();if(TTUUID.isUUID(a)&&a!=TTUUID.not_exist_id&&a!=TTUUID.zero_id)return super.doEditAPICall(e,i,t);var l=this.getRecordFromGridById(a);return l&&l.id&&(l.id=""),this.handleEditAPICallbackResult(l)}doViewAPICall(e,i,t){var a=this.getCurrentSelectedRecord();if(TTUUID.isUUID(a)&&a!=TTUUID.not_exist_id&&a!=TTUUID.zero_id)return super.doViewAPICall(e,i,t);var l=this.getRecordFromGridById(a);return l&&l.id&&(l.id=""),this.handleViewAPICallbackResult(l)}onSaveResult(e){var i=this;if(e.isValid()){i.is_add=!1;var t=e.getResult();this.edit_only_mode||(!0===t?i.refresh_id=i.current_edit_record.id:TTUUID.isUUID(t)&&t!=TTUUID.zero_id&&t!=TTUUID.not_exist_id&&(i.refresh_id=t),!1===Global.isSet(i.refresh_id)&&(i.result_details=e.getDetails()),i.search()),i.onSaveDone(e),i.removeEditView()}else i.setErrorMenu(),i.setErrorTips(e)}search(e,i,t,a){Global.isSet(e)||(e=!0);var l=this,r={filter_data:{},filter_sort:{}};if(r.filter_columns=this.getFilterColumnsFromDisplayColumns(),r.filter_items_per_page=0,this.pager_data)if(0===LocalCacheData.paging_type)r.filter_page="next"===i?this.pager_data.next_page:1;else switch(i){case"next":r.filter_page=this.pager_data.next_page;break;case"last":r.filter_page=this.pager_data.previous_page;break;case"start":r.filter_page=1;break;case"end":r.filter_page=this.pager_data.last_page_number;break;case"go_to":r.filter_page=t;break;default:r.filter_page=this.pager_data.current_page}else r.filter_page=1;this.sub_view_mode&&this.parent_key&&(this.select_layout.data.filter_data[this.parent_key]=this.parent_value),Global.isSet(this.getSubViewFilter)&&(this.select_layout.data.filter_data=this.getSubViewFilter(this.select_layout.data.filter_data)),r.filter_data=Global.convertLayoutFilterToAPIFilter(this.select_layout),r.filter_sort=this.select_layout.data.filter_sort,TTUUID.isUUID(this.refresh_id)?(r.filter_data={},r.filter_data.id=[this.refresh_id],this.last_select_ids=r.filter_data.id):Global.isSet(this.result_details)&&this.result_details.length>0?(this.result_details=$.map(this.result_details,(function(e){return!0===e?0:e})),this.last_select_ids=Global.concatArraysUniqueWithSort(this.result_details,this.getGridSelectIdArray())):this.last_select_ids=this.getGridSelectIdArray(),this.api["get"+this.api.key_name](r,{onResult:function(t){var r,s=t.getResult();if(Global.isArray(s)?(l.removeNoResultCover(),Global.isSet(l.__createRowId)&&(s=l.__createRowId(s)),r=(s=Global.formatGridData(s,l.api.key_name)).length):l.showNoResultCover(),TTUUID.isUUID(l.refresh_id)){l.refresh_id=null;var d=l.grid.getData();r=d.length,"array"!==$.type(d)&&(d=[]);var o=!1,_=s[0];if(_){for(var n=[],c=0;c<r;c++){var u=d[c];if(u.id==_.id){l.grid.grid.setRowData(_.id,_),o=!0;break}u.id<0&&u.user_id==_.user_id||n.push(u)}o||(l.search(),l.reSelectLastSelectItems(),l.highLightGridRowById(_.id))}}else{if(l.pager_data=t.getPagerData(),0!==LocalCacheData.paging_type&&(l.paging_widget.setPagerData(l.pager_data),l.paging_widget_2.setPagerData(l.pager_data)),0===LocalCacheData.paging_type&&"next"===i)s=l.grid.getData().concat(s);l.grid&&(l.grid.setData(s),l.reSelectLastSelectItems())}l.result_details=null,l.setGridCellBackGround(),ProgressBar.closeOverlay(),e&&l.setDefaultMenu(!0),0===LocalCacheData.paging_type&&(!l.pager_data||l.pager_data.is_last_page?l.paging_widget.css("display","none"):l.paging_widget.css("display","block")),a&&a(t),e&&l.autoOpenEditViewIfNecessary(),l.searchDone()}})}buildEditViewUI(){super.buildEditViewUI();var e={"tab_employee_accrual_modifier":{"label":"employee"===this.parent_view?$.i18n._("Accrual"):$.i18n._("Employee Accrual Modifier")},"tab_audit":!0};this.setTabModel(e),this.navigation.AComboBox({api_class:TTAPI.APIAccrualPolicyUserModifier,id:this.script_name+"_navigation",allow_multiple_selection:!1,layout_name:"global_wage",show_search_inputs:!0,navigation_mode:!0}),this.setNavigation();var i,t=this.edit_view_tab.find("#tab_employee_accrual_modifier").find(".first-column");this.edit_view_tabs[0]=[],this.edit_view_tabs[0].push(t),(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIUser,allow_multiple_selection:!1,layout_name:"global_user",show_search_inputs:!0,set_empty:!0,field:"user_id"}),this.addEditFieldToColumn($.i18n._("Employee"),i,t,"",null,!0);var a={filter_data:{}};a.filter_data.type_id=[20,30],(i=Global.loadWidgetByName(FormItemType.AWESOME_BOX)).AComboBox({api_class:TTAPI.APIAccrualPolicy,allow_multiple_selection:!1,layout_name:"global_accrual",show_search_inputs:!0,set_empty:!0,field:"accrual_policy_id"}),i.setDefaultArgs(a),this.addEditFieldToColumn($.i18n._("Accrual Policy"),i,t,""),(i=Global.loadWidgetByName(FormItemType.DATE_PICKER)).TDatePicker({field:"length_of_service_date",width:120}),this.addEditFieldToColumn($.i18n._("Length of Service Date"),i,t,"",null),(i=Global.loadWidgetByName(FormItemType.SEPARATED_BOX)).SeparatedBox({label:$.i18n._("Modifier Rates")}),this.addEditFieldToColumn(null,i,t,"",null,!0,!1,"separated_1"),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"length_of_service_modifier",width:40}),this.addEditFieldToColumn($.i18n._("Length of Service"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"accrual_rate_modifier",width:40}),this.addEditFieldToColumn($.i18n._("Accrual Rate"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"annual_maximum_time_modifier",width:40}),this.addEditFieldToColumn($.i18n._("Annual Accrual Maximum"),i,t,"",null,!0),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"maximum_time_modifier",width:40}),this.addEditFieldToColumn($.i18n._("Accrual Maximum Balance"),i,t),(i=Global.loadWidgetByName(FormItemType.TEXT_INPUT)).TTextInput({field:"rollover_time_modifier",width:40}),this.addEditFieldToColumn($.i18n._("Annual Maximum Rollover"),i,t),(i=Global.loadWidgetByName(FormItemType.SEPARATED_BOX)).SeparatedBox({label:$.i18n._("Current Milestone")+": "}),this.addEditFieldToColumn(null,i,t,"",null,!0,!1,"separated_2"),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"accrual_rate"}),this.addEditFieldToColumn($.i18n._("Accrual Rate"),i,t,"",null,!0),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"maximum_time"}),this.addEditFieldToColumn($.i18n._("Accrual Maximum Balance Time"),i,t,"",null,!0),(i=Global.loadWidgetByName(FormItemType.TEXT)).TText({field:"rollover_time"}),this.addEditFieldToColumn($.i18n._("Accrual Maximum Rollover"),i,t,"",null,!0)}setCurrentEditRecordData(){for(var e in this.current_edit_record)if(this.current_edit_record.hasOwnProperty(e)){var i=this.edit_view_ui_dic[e];Global.isSet(i)&&i.setValue(this.current_edit_record[e])}30==this.current_edit_record.type_id?this.attachElement("annual_maximum_time_modifier"):this.detachElement("annual_maximum_time_modifier"),this.setAccrualPolicyDataFromUserModifier(),this.getAccrualPolicyDataFromUserModifier(),this.collectUIDataToCurrentEditRecord(),this.setEditViewDataDone()}onFormItemChange(e,i){var t=this;this.setIsChanged(e),this.setMassEditingFieldsWhenFormChange(e);var a=e.getField(),l=e.getValue();switch(a){case"user_id":this.is_add?this.api["get"+this.api.key_name+"DefaultData"](l,{onResult:function(e){var i=e.getResult();i||(i=[]),t.sub_view_mode&&"accrual_policy_id"===t.parent_key&&(i[t.parent_key]=t.parent_value),t.current_edit_record=i,t.setCurrentEditRecordData(),t.validate()}}):(this.current_edit_record[a]=l,this.validate(),this.getAccrualPolicyDataFromUserModifier());break;default:this.current_edit_record[a]=l,this.validate(),this.getAccrualPolicyDataFromUserModifier()}}getAccrualPolicyDataFromUserModifier(){var e=this,i={};if(this.is_mass_editing){for(var t in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(t)){var a=this.edit_view_ui_dic[t];Global.isSet(a.isChecked)&&a.isChecked()&&a.getEnabled()&&(i[t]=a.getValue())}}else i=this.current_edit_record;i=this.uniformVariable(i),this.api.getAccrualPolicyDataFromUserModifier(i,{onResult:function(i){var t=i.getResult();e.setAccrualPolicyDataFromUserModifier(t)}})}setAccrualPolicyDataFromUserModifier(e){var i=this;if(Global.isSet(e)&&!Global.isFalseOrNull(e)){var t=0;t=e&&e.accrual_policy_type_id&&20==e.accrual_policy_type_id?Global.getTimeUnit(e.accrual_rate):e.accrual_rate,i.edit_view_form_item_dic.separated_2.find(".label").text($.i18n._("Current Milestone")+": "+e.milestone_number),i.edit_view_ui_dic.accrual_rate.setValue(t),i.edit_view_ui_dic.maximum_time.setValue(Global.getTimeUnit(e.maximum_time)),i.edit_view_ui_dic.rollover_time.setValue(Global.getTimeUnit(e.rollover_time)),i.attachElement("separated_2"),i.attachElement("accrual_rate"),i.attachElement("maximum_time"),i.attachElement("rollover_time")}else i.is_edit||(i.detachElement("separated_2"),i.detachElement("accrual_rate"),i.detachElement("maximum_time"),i.detachElement("rollover_time"))}removeEditView(){super.removeEditView(),"accrual_policy"===this.parent_view&&(this.context_menu_name=$.i18n._("Employee Settings"),$(".ribbonTabLabel").find("a[ref="+this.viewId+"ContextMenu]").text($.i18n._("Employee Settings")))}getAPIFilters(){var e=super.getAPIFilters();return this.sub_view_mode&&this.parent_key&&(e.filter_data[this.parent_key]=this.parent_value),e}onMassEditClick(){var e=this;e.is_add=!1,e.is_viewing=!1,e.is_mass_editing=!0,LocalCacheData.current_doing_context_action="mass_edit",e.openEditView();var i={},t=this.getGridSelectIdArray();t.length;this.mass_edit_record_ids=[],$.each(t,(function(i,t){e.mass_edit_record_ids.push(t)})),i.filter_data={},i.filter_data.id=this.mass_edit_record_ids,this.sub_view_mode&&this.parent_key&&(i.filter_data[this.parent_key]=this.parent_value),this.api["getCommon"+this.api.key_name+"Data"](i,{onResult:function(i){var t=i.getResult();t||(t=[]),e.api.getOptions("unique_columns",{onResult:function(i){e.unique_columns=i.getResult(),e.api.getOptions("linked_columns",{onResult:function(i){e.linked_columns=i.getResult(),e.sub_view_mode&&e.parent_key&&(t[e.parent_key]=e.parent_value),e.current_edit_record=t,e.initEditView()}})}})}})}validate(){var e,i=this;this.is_mass_editing?(e=[],$.each(this.mass_edit_record_ids,(function(t,a){var l={};for(var r in a<0?l=i.getRecordFromGridById(a):l.id=a,i.edit_view_ui_dic)if(i.edit_view_ui_dic.hasOwnProperty(r)){var s=i.edit_view_ui_dic[r];if(Global.isSet(s.isChecked)&&s.isChecked()&&s.getEnabled())switch(r){case"user_id":break;default:l[r]=s.getValue()}}var d=Global.clone(l);d=i.uniformVariable(d),e.push(d)}))):e=this.current_edit_record,e=this.uniformVariable(e),this.api["validate"+this.api.key_name](e,{onResult:function(e){i.validateResult(e)}})}onSaveClick(e){var i,t=this;Global.isSet(e)||(e=!1),LocalCacheData.current_doing_context_action="save",this.is_mass_editing?(i=[],$.each(this.mass_edit_record_ids,(function(e,a){var l={};for(var r in a<0?l=t.getRecordFromGridById(a):l.id=a,t.edit_view_ui_dic){var s=t.edit_view_ui_dic[r];if(Global.isSet(s.isChecked)&&s.isChecked())switch(r){case"user_id":break;default:l[r]=t.current_edit_record[r]}}var d=Global.clone(l);d=t.uniformVariable(d),i.push(d)}))):(i=this.current_edit_record,i=this.uniformVariable(i)),this.api["set"+this.api.key_name](i,!1,e,{onResult:function(e){t.onSaveResult(e)}})}setDefaultMenuDeleteIcon(e,i,t){(!this.addPermissionValidate(t)&&!this.editPermissionValidate(t)||this.edit_only_mode)&&e.addClass("invisible-image");var a=this.getGridSelectIdArray(),l=!1;for(var r in a)TTUUID.isUUID(a[r])&&(l=!0);l||e.addClass("disable-image")}searchDone(){super.searchDone(),TTPromise.resolve("AccrualView","init")}setEditViewWidgetsMode(){var e={};for(var i in this.edit_view_ui_dic)if(this.edit_view_ui_dic.hasOwnProperty(i)){var t=this.edit_view_ui_dic[i];t.css("opacity",1);var a=t.parent().parent().parent(),l=a.parent().attr("id");a.hasClass("v-box")||e[l]||(e[l]=!0),this.is_viewing||"employee"===this.parent_view&&("accrual_policy_id"===i||"user_id"===i)?Global.isSet(t.setEnabled)&&t.setEnabled(!1):Global.isSet(t.setEnabled)&&t.setEnabled(!0)}}}a.loadSubView=function(e,i,t){Global.loadViewSource("AccrualPolicyUserModifier","SubAccrualPolicyUserModifierView.html",(function(a){var l={};if(Global.isSet(i)){var r=i(a),s=r.template;l=r.args}Global.isSet(e)&&(e.html(s(l)),Global.isSet(t)&&t(sub_accrual_policy_user_modifier_view_controller))}))}}}]);
//# sourceMappingURL=policy-accrual_policy-AccrualPolicyUserModifierViewController.bundle.js.map?v=c1ec69f47baa2f9e7657